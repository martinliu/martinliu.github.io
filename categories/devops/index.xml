<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>DevOps on Martin Liu's Blog</title><link>https://martinliu.cn/categories/devops/</link><description>Recent content in DevOps on Martin Liu's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><atom:link href="https://martinliu.cn/categories/devops/index.xml" rel="self" type="application/rss+xml"/><item><title>DevOps 的七个隐形痛点（以及五个靠谱解法）</title><link>https://martinliu.cn/blog/7-hidden-pains-every-devops-engineer-faces/</link><pubDate>Thu, 28 Aug 2025 15:30:00 +0800</pubDate><guid>https://martinliu.cn/blog/7-hidden-pains-every-devops-engineer-faces/</guid><description>&lt;img src="https://martinliu.cn/blog/7-hidden-pains-every-devops-engineer-faces/1_jBaUuJtCdz0DTwlD0JF9dw.jpeg" alt="Featured image of post DevOps 的七个隐形痛点（以及五个靠谱解法）" />&lt;p>舞台上的 DevOps 常被描绘成技术乌托邦：自动化流水线顺滑运行，开发与运维无缝协作，代码提交到上线一气呵成。可在我七年、三家公司的一线实践里，另外一面从不出现在主题演讲里。&lt;/p>
&lt;p>下面这 7 个“隐形痛点”，几乎每位 DevOps 都会遇到。&lt;/p>
&lt;h2 id="1-没人愿意做的大扫除">1. 没人愿意做的“大扫除”
&lt;/h2>&lt;blockquote>
&lt;p>“像打扫房子一样——每天清一点，比几个月不管再硬抠强太多。”&lt;/p>&lt;/blockquote>
&lt;p>我接手过一批年久失修的仓库，本以为只是更个依赖，结果一路演变成数周拉锯战：硬编码的功能分支、成百上千个孤儿仓库、以及对版本控制“我行我素”的开发者。&lt;/p>
&lt;p>最扎心的是：&lt;strong>从初创到巨头，技术债都会悄悄堆积，最后往往让 DevOps 收拾残局。&lt;/strong>&lt;/p>
&lt;h2 id="2-提速透支未来">2. “提速”=“透支未来”
&lt;/h2>&lt;blockquote>
&lt;p>“有人为了‘这一次快一点’绕过流程，等出事了再说 DevOps 拖慢速度。”&lt;/p>&lt;/blockquote>
&lt;p>我经历过团队为了赶版本绕过 CI/CD：三个月后，我们还在填坑——环境不一致、配置缺失、只在生产复现的幽灵 Bug。&lt;/p>
&lt;p>讽刺的是：&lt;strong>绕过护栏的人，很少是修坑的人。&lt;/strong>&lt;/p>
&lt;h2 id="3-请你看下日志吧的沟通鸿沟">3. “请你看下日志吧”的沟通鸿沟
&lt;/h2>&lt;p>“我的流水线挂了，能帮修下吗？”——这是 DevOps 的日常高频语句。可很多时候，&lt;strong>日志已经把问题写明白了&lt;/strong>。
我曾陪一位开发排查一上午，最终错误是“Service Account 缺少存储桶权限”。我指出时，对方说：“我以为那是背景噪音。”&lt;/p>
&lt;p>这不是技术问题，而是沟通问题：对 DevOps 明晃晃的信息，对部分开发并不显眼。&lt;/p>
&lt;h2 id="4-身份危机devops--ops">4. 身份危机：DevOps ≠ Ops
&lt;/h2>&lt;p>很多岗位把 DevOps 和传统运维混为一谈。
有的所谓 “DevOps 工程师”，实际是换了头衔的系统管理员；也有的更像开发，只是多了点云权限。
现实是：&lt;strong>DevOps 处在一个光谱上&lt;/strong>——有的周几乎全是运营工作，另一些时期几乎全是开发，不同公司/团队/项目的比例差异巨大。&lt;/p>
&lt;h2 id="5-yaml-工程的瘟疫">5. YAML 工程的瘟疫
&lt;/h2>&lt;blockquote>
&lt;p>“30 个 K8s 集群、几十万个 Pod、数个 GitOps 仓库、上十万份 YAML。”&lt;/p>&lt;/blockquote>
&lt;p>YAML 本身不难，难在规模。一份“简单”的部署配置，能迅速演化成少数人看得懂的迷宫。
我曾为一个神秘的 K8s 故障排查数天，根因竟是某个在多仓库间复制的 YAML 文件里——一个&lt;strong>错位的空格&lt;/strong>。&lt;/p>
&lt;h2 id="6-漏网之鱼全都变成你的问题">6. “漏网之鱼”全都变成“你的问题”
&lt;/h2>&lt;p>数据库、监控、告警、安全、合规、成本优化……很多组织把一切边界模糊的事都丢给 DevOps。
范围过宽，焦点就会被稀释，&lt;strong>职业倦怠&lt;/strong>如影随形。正如同事所言：“所有‘没人接’的，最后都是你的。”&lt;/p>
&lt;h2 id="7-隐形的悖论">7. 隐形的悖论
&lt;/h2>&lt;blockquote>
&lt;p>“只有出问题时，人们才想起我们。”&lt;/p>&lt;/blockquote>
&lt;p>当一切顺滑时，没有人注意到精心打磨的流水线、前瞻性的监控和成百上千小时的部署优化；一旦出事，所有目光立刻投向 DevOps。
&lt;strong>成功意味着无感失败；失败意味着全员关注。&lt;/strong>&lt;/p>
&lt;h2 id="五个确实有效的应对策略">五个确实有效的应对策略
&lt;/h2>&lt;p>这些年踩过无数坑之后，我总结了 5 个在不同团队都验证过的做法：&lt;/p>
&lt;h3 id="1-把清理产品化常态化">1. 把“清理”产品化、常态化
&lt;/h3>&lt;p>别把技术债当独立项目，而是纳入日常节奏。&lt;/p>
&lt;p>一个简单且有效的做法：&lt;strong>给“清债”固定预算&lt;/strong>——例如每周一第一个小时，明确要关掉一项债务（更新依赖、重构脚本、补文档都算）。&lt;/p>
&lt;h3 id="2-构建自助化解决方案">2. 构建自助化解决方案
&lt;/h3>&lt;p>不要做每一次失败的“人工兜底”。**投入在“开发者自助”**更省总成本：&lt;/p>
&lt;ul>
&lt;li>更清晰的错误信息与行动建议&lt;/li>
&lt;li>成体系的文档与排障手册&lt;/li>
&lt;li>自动化诊断脚本与按钮式修复&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>我做过一个简单的 Slack 机器人，用规则识别常见流水线故障并自动回复修复建议，让 DevOps 中断减少了近 &lt;strong>40%&lt;/strong>。&lt;/p>&lt;/blockquote>
&lt;h3 id="3-落地谁破坏谁修复">3. 落地“谁破坏，谁修复”
&lt;/h3>&lt;p>绕过流程或引入有风险变更的人，要负责后续修复与复盘。&lt;strong>把反馈闭环拉到本人&lt;/strong>，是最有效的流程教育。&lt;/p>
&lt;h3 id="4-画清边界与期望">4. 画清边界与期望
&lt;/h3>&lt;p>写下来、讲清楚：&lt;strong>团队的职责是什么，不是什么&lt;/strong>。不是拒绝协作，而是让协作可预期、可计划。&lt;/p>
&lt;h3 id="5-让价值可见化">5. 让价值“可见化”
&lt;/h3>&lt;p>在一切顺利时，也要持续对外沟通：&lt;/p>
&lt;ul>
&lt;li>部署频率（Deployment Frequency）&lt;/li>
&lt;li>平均恢复时间（MTTR）&lt;/li>
&lt;li>变更失败率（Change Failure Rate）&lt;/li>
&lt;/ul>
&lt;p>用趋势和对比讲故事，让大家&lt;strong>看见稳定背后的投入&lt;/strong>。&lt;/p>
&lt;h2 id="devops-的人文侧技术之外的关键">DevOps 的人文侧：技术之外的关键
&lt;/h2>&lt;p>最优秀的 DevOps，不只会写基础设施代码，更是&lt;strong>沟通者、导师与推动者&lt;/strong>。&lt;/p>
&lt;p>我早期犯过的错，是只盯着自动化与基础设施。很快我发现，&lt;strong>帮助团队理解“为什么”&lt;/strong>，往往比“怎么做”更有价值。
一位前辈对我说过一句一直受用的话：&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>DevOps 的核心不是让机器协同，而是让人协同。&lt;/strong>&lt;/p>&lt;/blockquote>
&lt;h2 id="继续向前">继续向前
&lt;/h2>&lt;p>尽管有这些痛点，DevOps 社区在不断进化：工具更易用、实践更成熟，组织也在从“为了更快”转向“为了更稳、更可持续”的战略视角。&lt;/p>
&lt;p>如果你正在考虑进入这个领域，或正被这些挫折困扰——记住：&lt;strong>这些问题真实存在，但并非不可解&lt;/strong>。通过清晰沟通、稳健流程与重视协作，我们可以逐步化解它们。&lt;/p>
&lt;p>当某天感觉一切都不顺时，也请记住：你并不孤单。一个庞大的同行社区正面对同样问题、分享解法，并一起向更好的工程实践迈进。&lt;/p>
&lt;p>&lt;strong>你在 DevOps 之路上遇到过哪些“隐形痛点”？欢迎在评论区分享你的经历与招数。&lt;/strong>&lt;/p></description></item><item><title>2025 年别再使用 Jenkins！</title><link>https://martinliu.cn/blog/stop-using-jenkins-in-2025/</link><pubDate>Thu, 28 Aug 2025 10:00:00 +0800</pubDate><guid>https://martinliu.cn/blog/stop-using-jenkins-in-2025/</guid><description>&lt;img src="https://martinliu.cn/blog/stop-using-jenkins-in-2025/1_9wQ57gpbdI9JwUHpJmtFdA.jpeg" alt="Featured image of post 2025 年别再使用 Jenkins！" />&lt;h2 id="阻碍你前进的遗留巨头">阻碍你前进的遗留巨头
&lt;/h2>&lt;p>认识一下 Janet。她是一家中型科技公司的 DevOps 工程师，工作了五年。每个周一早上，她都会像闹钟一样，为不可避免的事情做好准备：“Jenkins 服务器又宕机了。”或者“构建失败了，没人知道为什么。”又或者她最喜欢的那句，“我们需要更新所有的 Jenkins 插件，但我们担心一切都会崩溃。”&lt;/p>
&lt;p>听起来很熟悉？你并不孤单。&lt;/p>
&lt;p>Jenkins 在过去的 15 年里一直是首选的 CI/CD 工具。它就像那辆老旧的家庭汽车，虽然总是进修理店，但你仍然保留着，因为，嗯，你习惯了它。但正如你在 2025 年不会再使用翻盖手机一样，现在或许是时候重新审视你与 Jenkins 的关系了 😒。&lt;/p>
&lt;h2 id="为什么-jenkins-正在显露老态">为什么 Jenkins 正在显露老态
&lt;/h2>&lt;p>Jenkins 在 2005 年推出时是革命性的。但 iPod 也是。技术发展迅速，曾经的尖端产品很快就会过时。以下是 Jenkins 正在落后的原因：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>让安全团队彻夜难眠的安全漏洞: Jenkins 有着令人不安的安全问题历史。仅在 2021 年，Jenkins 安全团队就披露了 30 多个漏洞，并且新的漏洞还在不断出现。许多组织以提升的权限运行 Jenkins，这使得这些漏洞尤为危险。以 Acme Corp（化名）为例。他们的 Jenkins 实例通过 CVE-2023–27898 被攻破，这是一个在脚本安全插件 (Script Security Plugin) 中的关键漏洞。攻击者获得了他们生产凭证的访问权限，并在其基础设施中部署了加密货币挖矿程序 (crypto miners)。清理工作让他们花费了三天的工程时间，并损害了客户信任。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>拖慢整个团队效率的性能问题: “我趁构建运行的时候去喝杯咖啡”这不仅仅是开发人员的玩笑，更是一个生产力问题。Jenkins 实例通常会随着时间的推移变得越来越慢，特别是当你添加更多作业和插件时。Michael，一个游戏初创公司的开发人员，描述了他的经历：“我们的 Jenkins 构建以前需要 10 分钟。在增加了两年功能和测试之后，它们需要 45 分钟。我们花在等待 Jenkins 上的时间比实际编码的时间还要多。”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>滋生“Jenkins 专家”的配置复杂性: Jenkins 的灵活性是有代价的：复杂性。组织往往最终只有一两个“Jenkins 大师”，他们是唯一了解一切如何运作的人。当他们去度假或离开公司时，恐慌就会随之而来。一位工程经理曾这样说：“我们有超过 200 个 Jenkins 流水线，每个的配置都略有不同。没人敢碰它们，因为我们担心它们会中断。这简直是最纯粹的技术债。”&lt;/p>
&lt;/li>
&lt;li>
&lt;p>消耗资源的维护开销: 自行托管的 Jenkins 需要持续维护。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>你需要：&lt;/p>
&lt;ul>
&lt;li>管理 Jenkins 服务器本身&lt;/li>
&lt;li>定期更新 Jenkins 核心&lt;/li>
&lt;li>更新几十甚至上百个插件&lt;/li>
&lt;li>处理备份和灾难恢复&lt;/li>
&lt;li>配置和维护构建代理 (build agents)&lt;/li>
&lt;/ul>
&lt;p>这些维护工作不会增加业务价值；它只是为了维持系统运行。&lt;/p>
&lt;h2 id="github-actions现代替代方案">GitHub Actions：现代替代方案
&lt;/h2>&lt;p>Janet 的故事有一个圆满的结局。她的团队从 Jenkins 迁移到了 GitHub Actions，周一早上的“救火”式应对也成为了历史。&lt;/p>
&lt;p>GitHub Actions 代表了一种截然不同的持续集成/持续部署 (CI/CD) 方法：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>内置安全性，无需维护服务器 : GitHub Actions 在 GitHub 的云中运行。你无需担心 Jenkins 服务器的安全或应用安全补丁。GitHub 的安全团队会为你处理这些。最好的安全服务器是你根本无需管理的服务器。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>自动扩展的性能 ： 需要更多构建能力？GitHub Actions 会自动扩展以满足需求。你可以并行运行构建，而无需管理额外的构建代理。Janet 的团队在迁移到 GitHub Actions 后，构建时间缩短了 60%，仅仅是因为他们可以并行执行测试，而无需担心基础设施 (infrastructure) 限制。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>人人都能理解的代码化配置：GitHub Actions 使用直接存储在你的代码仓库 (repository) 中的 YAML 文件。这种方法有几个优点：&lt;/p>
&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>配置与它所构建的代码共存&lt;/li>
&lt;li>变更通过常规代码审查 (code reviews) 进行追踪&lt;/li>
&lt;li>新团队成员可以快速理解设置&lt;/li>
&lt;li>无需专业知识&lt;/li>
&lt;/ul>
&lt;p>一位开发人员报告说：“GitHub Actions 的学习曲线比 Jenkins 平缓得多。我可以在一个下午，而不是几周内，理解我们整个 CI/CD 流水线。”&lt;/p>
&lt;ol start="4">
&lt;li>零维护开销 ：使用 GitHub Actions，你将拥有：&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>无需维护服务器&lt;/li>
&lt;li>无需更新插件&lt;/li>
&lt;li>无需配置构建代理&lt;/li>
&lt;li>无需管理备份&lt;/li>
&lt;/ul>
&lt;p>这让工程师可以将时间投入到实际的产品开发中，而不是基础设施的维护。&lt;/p>
&lt;p>&lt;strong>实际影响&lt;/strong>&lt;/p>
&lt;p>让我告诉你 Realtime Analytics, Inc. 从 Jenkins 切换到 GitHub Actions 后发生了什么。&lt;/p>
&lt;p>在切换之前，他们有：&lt;/p>
&lt;ul>
&lt;li>两名全职工程师专门负责 Jenkins 维护&lt;/li>
&lt;li>每周发生的故障影响开发者生产力&lt;/li>
&lt;li>平均构建时间 35 分钟&lt;/li>
&lt;li>定期出现安全隐患，需要紧急修补&lt;/li>
&lt;/ul>
&lt;p>切换到 GitHub Actions 六个月后：&lt;/p>
&lt;ul>
&lt;li>两名工程师都被重新分配到产品开发工作&lt;/li>
&lt;li>零 CI/CD 故障&lt;/li>
&lt;li>构建时间缩短到 12 分钟&lt;/li>
&lt;li>安全问题由 GitHub 自动处理&lt;/li>
&lt;/ul>
&lt;p>他们的 CTO 估算，仅工程时间一项，这项改变每年就为他们节省了大约 30 万美元，这还不包括改善的开发者体验和更快的上市时间。&lt;/p>
&lt;h2 id="切换比你想象的更容易">切换：比你想象的更容易
&lt;/h2>&lt;p>从 Jenkins 迁移到 GitHub Actions 的想法可能看起来令人生畏，但实际上它比你想象的要简单直接得多。&lt;/p>
&lt;p>这里有一个简化的方法：&lt;/p>
&lt;ol>
&lt;li>从一个小型、非关键项目开始&lt;/li>
&lt;li>将其 Jenkins 流水线 (pipeline) 转换为 GitHub Actions 工作流 (workflow)&lt;/li>
&lt;li>并行运行这两个系统以建立信心&lt;/li>
&lt;li>随着团队适应，逐步迁移更多项目&lt;/li>
&lt;/ol>
&lt;p>GitHub 甚至专门为 Jenkins 用户提供了迁移指南和示例。&lt;/p>
&lt;h2 id="github-actions-完美吗不但它是一个重大改进">GitHub Actions 完美吗？不，但它是一个重大改进
&lt;/h2>&lt;p>公平地说，GitHub Actions 并非没有局限性：&lt;/p>
&lt;ul>
&lt;li>对于非常专业的构建要求，你可能需要定制解决方案&lt;/li>
&lt;li>如果你没有使用 GitHub 进行源代码管理 (source control)，集成就不会那么无缝&lt;/li>
&lt;li>一些复杂的 Jenkins 设置可能需要你重新思考方法&lt;/li>
&lt;/ul>
&lt;p>然而，对于绝大多数开发团队来说，GitHub Actions 几乎在所有方面都代表着对 Jenkins 的巨大改进。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>&lt;strong>Jenkins 多年来一直为我们服务得很好&lt;/strong>，但软件开发已经演进。现代的 CI/CD (持续集成/持续交付) 解决方案，例如 GitHub Actions，专为当今的开发实践而设计：云原生 (cloud-native)、注重安全，并优化了开发者生产力 (developer productivity)。&lt;/p>
&lt;p>正如 Janet 所发现的，最初的迁移努力会迅速带来回报。她的团队现在部署更频繁，问题更少，并且几乎不花时间维护他们的 CI/CD 基础设施。&lt;/p>
&lt;p>&lt;strong>问问自己：&lt;/strong> 上个月你的团队花了多少时间与 Jenkins 搏斗？如果把这些时间用于其他工作，你本可以构建出什么？&lt;/p>
&lt;p>CI/CD 的未来已经到来。&lt;strong>也许&lt;/strong>是时候让 Jenkins 成为过去式了。&lt;/p></description></item><item><title>90% 的人 DevOps 转型失败：一份真正奏效的路线图</title><link>https://martinliu.cn/blog/90-of-people-fail-at-devops-heres-the-roadmap-that/</link><pubDate>Thu, 28 Aug 2025 10:00:00 +0800</pubDate><guid>https://martinliu.cn/blog/90-of-people-fail-at-devops-heres-the-roadmap-that/</guid><description>&lt;img src="https://martinliu.cn/blog/90-of-people-fail-at-devops-heres-the-roadmap-that/image_0_94126cb8.png" alt="Featured image of post 90% 的人 DevOps 转型失败：一份真正奏效的路线图" />&lt;p>几年前，我困在了一个没有前途的 Linux 技术支持岗位上，上夜班，看不到任何成长。尽管有9年经验，我的薪水却微薄，健康状况每况愈下，也没有社交生活。我眼看着大学同学在事业上平步青云，而我却仍旧陷在自己的舒适区里。&lt;/p>
&lt;p>但当我决定转型到 DevOps 时，一切都改变了。经过4-5个月的集中学习，我找到了一份薪水翻了3倍的工作。这种转变不仅仅是职业上的，更是个人生活上的。我找回了生活，重拾了自信，最终找到了既有挑战又令我兴奋的工作。&lt;/p>
&lt;p>今天，我想分享正是这个路线图，让我的转型成为可能。这不仅仅是另一篇泛泛的“学习这些工具”的文章——这是一条真实、经过实践检验的路径，它帮助我在没有任何该领域经验的情况下，成功进入了 DevOps (开发运维) 领域。&lt;/p>
&lt;h2 id="什么是-devops">什么是 DevOps？
&lt;/h2>&lt;p>简单来说，DevOps 是一种组织遵循的方法论 (methodology)，旨在将开发团队 (development team) 和运维团队 (operations team) 合并成一个统一的团队。通过这种方式，两个团队共同协作，高效地开发和部署应用程序。&lt;/p>
&lt;p>DevOps 是一个广义术语 (umbrella term)，它涵盖了各种用于自动化应用程序开发和部署过程的工具。DevOps 的主要好处之一是，通过自动化这些过程，与手动方法相比，它更省时，也更不容易出错。这种自动化缩短了产品上市时间 (Time to Market, TTM)，使其成为快速发展公司的理想选择。&lt;/p>
&lt;h2 id="你将面临哪些困难以及如何克服它们">你将面临哪些困难（以及如何克服它们）？
&lt;/h2>&lt;p>让我坦诚地谈谈你将遇到的挑战：&lt;/p>
&lt;p>&lt;strong>资源过多&lt;/strong> 最大的问题不是找不到教程，而是不知道该选择哪个！有成千上万的课程、博客和视频。你可能会浪费几周时间只为了决定学什么，结果反而更困惑，而不是取得进展。&lt;/p>
&lt;p>&lt;strong>到处都是糟糕的路线图&lt;/strong> 大多数在线学习路径要么过于简单（“只需学习 Docker！”），要么过于复杂（列出50多种工具）。你需要一个切合你初学者水平和繁忙日程的现实路线图。&lt;/p>
&lt;p>&lt;strong>试图一次性学完所有东西&lt;/strong> 你会想同时学习 Docker、Kubernetes、AWS 和 Terraform。这种跳跃式的学习会导致知识掌握不深，并带来倦怠。&lt;strong>一次只专注于一件事。&lt;/strong>&lt;/p>
&lt;p>&lt;strong>工具过载和社媒喧嚣&lt;/strong>
你会看到人们每周都在社媒上谈论“最新最棒”的工具。不要落入这个陷阱。专注于核心基础知识，并首先掌握必要的工具。忽略这些喧嚣，保持简单——你不需要 20 种工具才能成功。&lt;/p>
&lt;p>&lt;strong>感到力不从心&lt;/strong>
DevOps 拥有大量的工具和令人困惑的术语。你有时会感到迷茫。别担心——即使是经验丰富的工程师也会有这种感觉。这是正常的，随着时间推移会好转。&lt;/p>
&lt;h2 id="完整的-6-个月-devops-路线图">完整的 6 个月 DevOps 路线图
&lt;/h2>&lt;p>本路线图旨在让你从完全的初学者成长为能够胜任工作的 DevOps 工程师。每个月的内容都在前一个月的基础上进行，在增加复杂性之前打下坚实的基础。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/90-of-people-fail-at-devops-heres-the-roadmap-that/image_1_2eeeb884.png"
width="640"
height="427"
srcset="https://martinliu.cn/blog/90-of-people-fail-at-devops-heres-the-roadmap-that/image_1_2eeeb884_hu_998e192d4afb0653.png 480w, https://martinliu.cn/blog/90-of-people-fail-at-devops-heres-the-roadmap-that/image_1_2eeeb884_hu_fd4c3f5b3227c065.png 1024w"
loading="lazy"
alt="DevOps 6个月学习路线图"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="359px"
>&lt;/p>
&lt;h2 id="第一月基础技能--linux网络shell-脚本和-git">第一月：基础技能 — Linux、网络、Shell 脚本和 Git
&lt;/h2>&lt;p>&lt;strong>第 1-2 周：Linux 基础知识&lt;/strong> Linux 构成了大多数 DevOps 基础设施 (infrastructure) 的支柱。首先学习你作为 DevOps 工程师每天都会用到的基本命令行技能。&lt;/p>
&lt;p>需要掌握的关键技能：&lt;/p>
&lt;ul>
&lt;li>文件和目录管理 (ls, cd, mkdir, rm, cp, mv)&lt;/li>
&lt;li>文件权限和所有权 (chmod, chown, umask)&lt;/li>
&lt;li>进程管理 (ps, top, htop, kill, jobs)&lt;/li>
&lt;li>系统监控 (df, du, free, uptime, iostat)&lt;/li>
&lt;li>文本处理工具 (grep, awk, sed, cut, sort, uniq)&lt;/li>
&lt;li>包管理 (apt, yum, rpm)&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>第 3 周：网络基础知识&lt;/strong> 理解网络对于故障排除和设计可扩展系统至关重要。&lt;/p>
&lt;p>基本网络概念：&lt;/p>
&lt;ul>
&lt;li>IP 地址和子网划分 (IPv4, IPv6)&lt;/li>
&lt;li>OSI 模型 (OSI model) 和 TCP/IP 协议栈 (TCP/IP stack)&lt;/li>
&lt;li>DNS 解析 (DNS resolution) 和配置&lt;/li>
&lt;li>网络诊断工具 (ping, traceroute, netstat, ss)&lt;/li>
&lt;li>防火墙 (Firewall) 和安全组 (Security Group)&lt;/li>
&lt;li>负载均衡 (Load Balancing) 概念&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>第 4 周：Shell 脚本和 Git&lt;/strong> 通过脚本实现自动化和版本控制是基本的 DevOps 技能。&lt;/p>
&lt;p>Shell 脚本技能：&lt;/p>
&lt;ul>
&lt;li>变量 (Variable) 和环境变量 (Environment Variable)&lt;/li>
&lt;li>控制结构 (if/else, 循环, case 语句)&lt;/li>
&lt;li>函数 (Function) 和脚本组织&lt;/li>
&lt;li>错误处理和退出码 (Exit Code)&lt;/li>
&lt;li>Cron 任务 (Cron Job) 和任务调度&lt;/li>
&lt;/ul>
&lt;p>Git 版本控制：&lt;/p>
&lt;ul>
&lt;li>仓库初始化和克隆&lt;/li>
&lt;li>基本命令 (add, commit, push, pull, status)&lt;/li>
&lt;li>分支策略和合并&lt;/li>
&lt;li>冲突解决&lt;/li>
&lt;li>GitHub 工作流 (workflow) 和协作&lt;/li>
&lt;/ul>
&lt;h2 id="第二月云平台和容器化">第二月：云平台和容器化
&lt;/h2>&lt;p>&lt;strong>第 1-2 周：AWS 云基础知识&lt;/strong> 专注于一个主要的云平台来建立深厚的专业知识。AWS 在市场中处于领先地位，使其成为初学者的最佳选择。&lt;/p>
&lt;p>核心 AWS 服务：&lt;/p>
&lt;ul>
&lt;li>EC2 (弹性计算云) 用于虚拟服务器&lt;/li>
&lt;li>VPC (虚拟私有云) 用于网络&lt;/li>
&lt;li>S3 (简单存储服务) 用于对象存储&lt;/li>
&lt;li>IAM (身份和访问管理) 用于安全&lt;/li>
&lt;li>RDS (关系型数据库服务) 用于托管数据库&lt;/li>
&lt;li>负载均衡器 (ALB, NLB) 用于流量分发&lt;/li>
&lt;li>自动扩缩组 (Auto Scaling Groups) 用于弹性&lt;/li>
&lt;li>CloudWatch 用于监控和日志记录&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>第 3-4 周：Docker 容器化&lt;/strong> 容器化通过在不同阶段提供一致的环境，彻底改变了应用程序部署方式。&lt;/p>
&lt;p>Docker 基础：&lt;/p>
&lt;ul>
&lt;li>容器与虚拟机概念&lt;/li>
&lt;li>Docker 架构和组件&lt;/li>
&lt;li>镜像创建与管理&lt;/li>
&lt;li>Dockerfile 最佳实践和优化&lt;/li>
&lt;li>容器网络和卷&lt;/li>
&lt;li>注册表管理 (Docker Hub, ECR)&lt;/li>
&lt;/ul>
&lt;p>Docker Compose：&lt;/p>
&lt;ul>
&lt;li>多容器应用编排&lt;/li>
&lt;li>服务定义和网络&lt;/li>
&lt;li>环境变量和 Secrets 管理&lt;/li>
&lt;li>卷挂载和数据持久化&lt;/li>
&lt;/ul>
&lt;h2 id="第三个月基础设施即代码和-cicd-自动化">第三个月：基础设施即代码和 CI/CD 自动化
&lt;/h2>&lt;p>&lt;strong>第 1-2 周：使用 Terraform 实现基础设施即代码&lt;/strong>&lt;/p>
&lt;p>基础设施即代码 (IaC) 是区分初级 DevOps 工程师和高级专业人士的关键。&lt;/p>
&lt;p>Terraform 要点：&lt;/p>
&lt;ul>
&lt;li>Terraform (HCL) 语法&lt;/li>
&lt;li>Provider 和资源管理&lt;/li>
&lt;li>状态管理和远程后端&lt;/li>
&lt;li>变量、输出和数据源&lt;/li>
&lt;li>模块化可重用基础设施&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>第 3 周：使用 GitHub Actions 实现 CI/CD&lt;/strong>&lt;/p>
&lt;p>持续集成 (Continuous Integration) 和持续部署 (Continuous Deployment) 自动化了软件交付管道。&lt;/p>
&lt;p>CI/CD 管道组件：&lt;/p>
&lt;ul>
&lt;li>工作流触发器和事件&lt;/li>
&lt;li>作业 (Jobs)、步骤 (Steps) 和操作 (Actions)&lt;/li>
&lt;li>针对多环境的矩阵构建 (Matrix Builds)&lt;/li>
&lt;li>Secrets 和环境变量管理&lt;/li>
&lt;li>部署策略 (滚动部署、蓝绿部署、金丝雀部署)&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>第 4 周：AWS ECS 容器编排&lt;/strong>&lt;/p>
&lt;p>在初期阶段，学习容器编排可以避开 Kubernetes 的复杂性。&lt;/p>
&lt;p>ECS 基础：&lt;/p>
&lt;ul>
&lt;li>集群管理和容量提供程序 (Capacity Providers)&lt;/li>
&lt;li>任务定义和服务配置&lt;/li>
&lt;li>服务发现和负载均衡&lt;/li>
&lt;li>自动扩缩策略和方案&lt;/li>
&lt;/ul>
&lt;h2 id="第四个月kubernetes-生态系统和高级编排">第四个月：Kubernetes 生态系统和高级编排
&lt;/h2>&lt;p>&lt;strong>第 1 周：Kubernetes 基础&lt;/strong>&lt;/p>
&lt;p>Kubernetes 是大规模容器编排的行业标准。&lt;/p>
&lt;p>Kubernetes 核心概念：&lt;/p>
&lt;ul>
&lt;li>集群架构 (主节点、工作节点、etcd)&lt;/li>
&lt;li>Pods、Deployments 和 ReplicaSets&lt;/li>
&lt;li>Services 和 Ingress 控制器&lt;/li>
&lt;li>用于配置的 ConfigMaps 和 Secrets&lt;/li>
&lt;li>持久卷 (Persistent Volumes) 和存储类 (Storage Classes)&lt;/li>
&lt;li>用于资源隔离的命名空间 (Namespaces)&lt;/li>
&lt;li>RBAC (基于角色的访问控制)&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>第 2 周：Kubernetes 高级特性&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>用于有状态应用的 StatefulSets&lt;/li>
&lt;li>用于节点级服务的 DaemonSets&lt;/li>
&lt;li>用于批处理的 Jobs 和 CronJobs&lt;/li>
&lt;li>水平 Pod 自动扩缩 (Horizontal Pod Autoscaling, HPA)&lt;/li>
&lt;li>用于流量控制的网络策略 (Network Policies)&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>第 3 周：使用 Prometheus 和 Grafana 进行监控&lt;/strong>&lt;/p>
&lt;p>可观测性 (Observability) 对于维护大规模可靠系统至关重要。&lt;/p>
&lt;p>Prometheus 监控：&lt;/p>
&lt;ul>
&lt;li>指标收集和存储&lt;/li>
&lt;li>服务发现配置&lt;/li>
&lt;li>告警规则和通知路由&lt;/li>
&lt;/ul>
&lt;p>Grafana 可视化：&lt;/p>
&lt;ul>
&lt;li>仪表盘创建和模板化&lt;/li>
&lt;li>面板类型和可视化选项&lt;/li>
&lt;li>告警管理和通知渠道&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>第 4 周：使用 ArgoCD 和 Helm 进行 GitOps&lt;/strong>&lt;/p>
&lt;p>GitOps 代表了部署自动化的未来。&lt;/p>
&lt;p>ArgoCD 实现：&lt;/p>
&lt;ul>
&lt;li>GitOps 原则和工作流&lt;/li>
&lt;li>应用定义和同步策略&lt;/li>
&lt;li>多集群管理&lt;/li>
&lt;li>渐进式交付策略&lt;/li>
&lt;/ul>
&lt;p>Helm 包管理：&lt;/p>
&lt;ul>
&lt;li>Chart 结构和模板化&lt;/li>
&lt;li>Values 文件和环境定制&lt;/li>
&lt;li>Chart 仓库和分发&lt;/li>
&lt;/ul>
&lt;h2 id="第五个月python-自动化和事件驱动架构">第五个月：Python 自动化和事件驱动架构
&lt;/h2>&lt;p>&lt;strong>第 1-2 周：用于 DevOps 自动化的 Python&lt;/strong>&lt;/p>
&lt;p>Python 因其简洁性和丰富的库生态系统而成为 DevOps 自动化的首选语言。&lt;/p>
&lt;p>Python DevOps 要点：&lt;/p>
&lt;ul>
&lt;li>自动化所需的 Python 基础知识&lt;/li>
&lt;li>使用 API 和 JSON 数据&lt;/li>
&lt;li>错误处理和日志记录最佳实践&lt;/li>
&lt;li>用于云自动化的 AWS SDK (boto3)&lt;/li>
&lt;li>基础设施自动化脚本&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>第 2 周：AWS Lambda 和无服务器架构&lt;/strong>&lt;/p>
&lt;p>无服务器计算 (Serverless Computing) 消除了基础设施管理开销。&lt;/p>
&lt;p>Lambda 基础：&lt;/p>
&lt;ul>
&lt;li>函数创建和部署&lt;/li>
&lt;li>事件源和触发器&lt;/li>
&lt;li>环境变量和配置&lt;/li>
&lt;li>性能优化和冷启动&lt;/li>
&lt;/ul>
&lt;p>事件驱动架构：&lt;/p>
&lt;ul>
&lt;li>用于消息队列的 Amazon SQS&lt;/li>
&lt;li>用于发布/订阅消息的 Amazon SNS&lt;/li>
&lt;li>用于事件路由的 Amazon EventBridge&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>第 3-4 周：高级无服务器模式&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>用于工作流编排的 Step Functions&lt;/li>
&lt;li>API Gateway 集成&lt;/li>
&lt;li>成本优化策略&lt;/li>
&lt;/ul>
&lt;h2 id="第六个月真实项目和求职准备">第六个月：真实项目和求职准备
&lt;/h2>&lt;p>最后一个月将专注于构建一个项目作品集，以展示你解决实际业务问题的能力。&lt;/p>
&lt;p>&lt;strong>能让你获得工作的 5 个项目作品集：&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;strong>自动化基础设施监控与告警系统&lt;/strong>&lt;/li>
&lt;li>&lt;strong>基于 GitOps 自动化（GitOps Automation）的多环境基础设施&lt;/strong>&lt;/li>
&lt;li>&lt;strong>容器化微服务平台（Containerized Microservices Platform）&lt;/strong>&lt;/li>
&lt;li>&lt;strong>事件驱动的无服务器（Serverless）数据处理管线&lt;/strong>&lt;/li>
&lt;li>&lt;strong>带合规自动化（Compliance Automation）的 DevSecOps（开发安全运维一体化）管线&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>求职准备策略：&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>简历优化，突出量化成就&lt;/li>
&lt;li>GitHub 作品集开发，包含清晰且文档完善的代码仓库&lt;/li>
&lt;li>面试准备，重点关注场景题&lt;/li>
&lt;li>拓展人脉和参与社区活动&lt;/li>
&lt;/ul>
&lt;h2 id="成功的心智框架">成功的心智框架
&lt;/h2>&lt;p>&lt;strong>第 1–3 个月：一次精通一个工具&lt;/strong> 不要试图同时学习多个工具。你的大脑需要时间为每个新概念建立神经通路（neural pathways）。全身心投入一个工具，直到你觉得运用自如，然后再转向下一个。&lt;/p>
&lt;p>&lt;strong>第 4–5 个月：开始在项目中混合使用工具&lt;/strong> 既然你已经打下了坚实的基础，就可以开始组合使用工具了。构建使用 Docker + AWS，或者 Terraform + Kubernetes 的项目。奇迹将在此发生——你将理解工具是如何协同工作的。&lt;/p>
&lt;p>&lt;strong>第 6 个月：复杂项目与面试准备&lt;/strong> 构建能够解决实际业务问题的出色项目。练习向他人解释你的工作。通过理解不仅是工具的使用方法，更是你选择这些工具的原因，来准备技术面试。&lt;/p>
&lt;h2 id="如何欺骗你的大脑在学习中不感到不知所措">如何欺骗你的大脑，在学习中不感到不知所措
&lt;/h2>&lt;ul>
&lt;li>有些日子你觉得自己是天才，有些日子你觉得自己一无所知。这两种感觉都很正常，也是学习过程的一部分。关键在于持之以恒，即使在动力不足时也要坚持下去。&lt;/li>
&lt;li>不要被庞大的工具和技术生态系统所压倒。相反，一次只关注一件事，持续构建，并相信这个过程。&lt;/li>
&lt;li>当学习感觉不可能，你的大脑快要爆炸时，请休息一下。看看 Netflix，散散步，睡一觉。第二天或几天后再回来，突然间那个“不可能”的概念就会豁然开朗。&lt;/li>
&lt;/ul>
&lt;p>请记住，在前 3 个月，抵制过度思考或在工具之间跳跃的冲动。掌握基础知识。在第 4-5 个月，开始在实际项目中混合使用工具。第 6 个月是关于构建令人印象深刻的项目作品集并为面试做准备。&lt;/p>
&lt;h2 id="结论">结论
&lt;/h2>&lt;p>你的现状，无论是死胡同般的工作、低薪，还是缺乏职业成长，除非你采取行动，否则一切都不会改变。我分享的这条路并不容易，但它已被证明是有效的。我曾走过这条路，数百人也同样如此。&lt;/p>
&lt;p>&lt;strong>如果你不做出改变，一切都不会改变。&lt;/strong>&lt;/p></description></item><item><title>Scrum 正在演变，许多团队正在尝试替代方案</title><link>https://martinliu.cn/blog/scrum-is-evolving-and-many-teams-are-experimenting/</link><pubDate>Thu, 28 Aug 2025 10:00:00 +0800</pubDate><guid>https://martinliu.cn/blog/scrum-is-evolving-and-many-teams-are-experimenting/</guid><description>&lt;img src="https://martinliu.cn/blog/scrum-is-evolving-and-many-teams-are-experimenting/0_RoRZP60AWsV890oG.jpg" alt="Featured image of post Scrum 正在演变，许多团队正在尝试替代方案" />&lt;p>Scrum 对许多团队而言仍然很有价值，但近年来，从初创公司到大型科技公司（Big Tech）的软件企业一直在尝试新的实践，以适应更快的周期和更高的自主性。本文将重点介绍 10 种现代方法，它们可以补充甚至超越传统的 Scrum。本文揭示了 10 种正在取代 Scrum 的现代方法，并解释了如何在你的 Java 开发团队中实施它们。&lt;/p>
&lt;p>Scrum 使用率从 2020 年至 2024 年的下降，以及 Kanban、Shape Up 和持续交付（Continuous Delivery）等替代方法在软件开发团队中的兴起。&lt;/p>
&lt;h2 id="1-团队自主性优于流程仪式">1. 团队自主性优于流程仪式
&lt;/h2>&lt;p>一些大型科技公司（Big Tech）正在尝试更自主的模型——即使是小型团队也可以尝试其中的一些元素，赋能的工程师比流程驱动的团队能交付更好的结果。虽然 Scrum 强调明确的角色，但一些团队正在尝试更高的自主性，赋予工程师对其代码、部署和决策的端到端所有权。这种转变通常会提高生产力，并减少代码、部署和决策制定中的流程开销。&lt;/p>
&lt;p>核心原则很简单：聘用聪明人，然后让他们自由发挥。当工程师可以选择自己的工具、设定自己的时间表并在准备就绪时进行部署时，生产力会飙升高达 30%。这种方法消除了冲刺规划会议（sprint planning meetings）和故事点估算（story point estimation）的开销。&lt;/p>
&lt;p>Java 实施示例（任何人都能懂的伪代码）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Autonomous team deployment pipeline&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Component&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">AutonomousDeployment&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GitRepository&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">repo&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CIService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">continuousIntegration&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Engineers trigger deployments directly&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">deployWhenReady&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">featureBranch&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">continuousIntegration&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">allTestsPass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">featureBranch&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">repo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">mergeToMain&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">featureBranch&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">deployToProduction&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">deployToProduction&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Automated deployment without ceremony&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Deploying autonomously - no approval needed&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="2-持续交付而非冲刺发布">2. 持续交付而非冲刺发布
&lt;/h2>&lt;p>许多 Scrum 团队以 2-4 周的周期进行交付。持续交付（Continuous Delivery）扩展了这一理念，实现了每天多次发布，提供了更快的反馈和更小、更安全的变更。持续交付消除了冲刺（sprint）边界的人为限制，并实现了用户的实时反馈。&lt;/p>
&lt;p>Amazon 平均每 11.7 秒部署一次代码。这种方法降低了风险，因为每次更改都更小，更容易调试（debug）。如果出现问题，你只需回滚（roll back）一个小的更改，而不是解开一个复杂冲刺所累积的功能。&lt;/p>
&lt;p>Java 持续交付（CD）流水线示例（任何人都能懂的伪代码）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@RestController&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">FeatureFlagController&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Autowired&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FeatureToggleService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">toggleService&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Deploy features behind flags - no sprint waiting&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@GetMapping&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/api/new-feature&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ResponseEntity&lt;/span>&lt;span class="o">&amp;lt;?&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getNewFeature&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">toggleService&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isEnabled&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;new-checkout-flow&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ResponseEntity&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">EnhancedCheckout&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ResponseEntity&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">ok&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StandardCheckout&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>对比展示了大型科技公司（Big Tech）如何与传统 Scrum 驱动的组织不同地进行项目管理，强调自主性、持续交付（Continuous Delivery）和工程师主导的举措。&lt;/p>
&lt;h2 id="3-shape-upbasecamp-的-6-周专注周期">3. Shape Up：Basecamp 的 6 周专注周期
&lt;/h2>&lt;p>Basecamp 创建了 Shape Up，旨在解决无休止的积压工作 (backlogs) 和范围蔓延 (scope creep) 等挑战。团队不再管理数百张工单（bug修复或者线上支持），而是专注于一个重要问题整整 6 周，然后进行为期 2 周的冷却期 (cooldown)。&lt;/p>
&lt;p>其中一个出色的洞察是“投入预设 (appetite setting)”——即预先决定一个问题值得投入多少时间。如果你无法在 6 周内解决它，那么要么缩减范围，要么放弃它。这消除了困扰 Scrum 团队的无休止的范围谈判。&lt;/p>
&lt;p>Shape Up 的 Java 项目结构（任何人都能懂的伪代码）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Six-week focused development approach&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">ShapeUpProject&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CYCLE_WEEKS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">6&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LocalDate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">startDate&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">appetite&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// &amp;#34;6 weeks max&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Problem&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">problemToSolve&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">ShapeUpProject&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Problem&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">problem&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">timeAppetite&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">problemToSolve&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">problem&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">appetite&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">timeAppetite&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">startDate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LocalDate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">now&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Circuit breaker - kill if scope grows too large&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">shouldContinue&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ChronoUnit&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">WEEKS&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">between&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">startDate&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LocalDate&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">now&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">CYCLE_WEEKS&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="4-看板-kanban可视流优于冲刺规划">4. 看板 (Kanban)：可视流优于冲刺规划
&lt;/h2>&lt;p>Netflix、Microsoft 和许多其他公司都采用了看板 (Kanban) 流系统。与基于冲刺 (sprint) 的规划不同，看板强调限制在制品 (Work In Progress, WIP) 并优化流系统。团队不再承诺冲刺目标，而是专注于限制在制品并优化其价值交付流。&lt;/p>
&lt;p>看板的强大之处在于其简洁性。你有三列：待办 (To Do)、进行中 (Doing)、已完成 (Done)。你对“进行中”状态的项目数量设定限制。这可以防止上下文切换 (context switching)，并帮助团队更快地完成工作，而不是启动更多工作。&lt;/p>
&lt;p>看板板实现：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Traditional&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scrum&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Board&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">┌──────────────┐&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">┌──────────────┐&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">┌──────────────┐&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BACKLOG&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SPRINT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">DONE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">COMMITTED&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">200&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">15&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">12&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Endless&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Fixed&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Groomed&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Estimated&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">└──────────────┘&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">└──────────────┘&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">└──────────────┘&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Modern&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Kanban&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Flow&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">┌──────────────┐&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">┌──────────────┐&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">┌──────────────┐&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">TODO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">DOING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">DONE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">WIP&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Just&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Next&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Feature&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">X&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Priority&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bug&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Fix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Ready&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">•&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Item&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">C&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">│&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">└──────────────┘&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">└──────────────┘&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">└──────────────┘&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="5-无估算-no-estimates-运动关注流而非预测">5. 无估算 (No Estimates) 运动：关注流，而非预测
&lt;/h2>&lt;p>一些团队正在尝试 NoEstimates (无估算) 运动，从故事点 (story points) 转向。他们将工作分解成大小相似的块并跟踪流，这可以减少估算开销。团队不再争论一个任务是 5 个点还是 8 个点，而是专注于将工作分解成大小相似的块并衡量实际流速 (flow rates)。&lt;/p>
&lt;p>NoEstimates 方法会问：“我们能在 2-3 天内完成这个任务吗？”如果能，就去做。如果不能，就进一步分解。这完全消除了估算会议，并比传统的故事点提供了更可预测的交付。==&lt;/p>
&lt;p>NoEstimates 的 Java 实现（任何人都能懂的伪代码）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Entity&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">WorkItem&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LocalDateTime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">startTime&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LocalDateTime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">completeTime&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">isSmallEnough&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Can complete in 2-3 days?&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Track cycle time instead of story points&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Duration&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">getCycleTime&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">completeTime&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Duration&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">between&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">startTime&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">completeTime&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Duration&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">between&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">startTime&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">LocalDateTime&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">now&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Predictability through consistent sizing&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">boolean&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">isRightSize&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">getCycleTime&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="na">toDays&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">3&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="6-okrs-加工程领导力">6. OKRs 加工程领导力
&lt;/h2>&lt;p>Intel、Google 和 LinkedIn 等公司将目标与关键结果 (Objectives and Key Results, OKRs) 与工程师主导的执行相结合。工程师不再由产品负责人 (product owners) 编写详细需求，而是理解业务目标并找出最佳技术方案。&lt;/p>
&lt;p>该模型将开发者视为问题解决者，而非功能生产机器。工程师与客户沟通，理解各项指标，并提出解决方案。这带来了更具创新性的产品和更高的工作满意度。&lt;/p>
&lt;p>Java OKR 集成示例（任何人都能懂的伪代码）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Component&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">TeamOKRTracker&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Objective: Reduce customer checkout abandonment by 20%&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">final&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectiveMetric&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">checkoutAbandonment&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ObjectiveMetric&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;checkout_abandonment&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">20&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Engineers decide HOW to achieve the objective&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">implementSolution&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">checkoutAbandonment&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">isOnTrack&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Current approach working - continue&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Engineers pivot based on data, not requirements&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tryNewApproach&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="7-spotify-的小队模型大规模自主团队">7. Spotify 的小队模型：大规模自主团队
&lt;/h2>&lt;p>Spotify 彻底改变了大型组织保持敏捷性的方式。他们的模型将人员组织成小队 (squads)（团队）、部落 (tribes)（小队的集合）、章节 (chapters)（基于技能的群体）和兴趣组 (guilds)（共同兴趣社区）。&lt;/p>
&lt;p>关键洞察在于，文化和自主性比流程更重要。每个小队选择自己的方法论——有些使用 Scrum，有些使用 Kanban，许多采用混合方法。重要的是在使命和价值观上保持一致。&lt;/p>
&lt;p>Java 中的小队结构（任何人都能懂的伪代码）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Spotify-style autonomous squad organization&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">AutonomousSquad&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mission&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Make checkout delightful&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Developer&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">squadMembers&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">WorkingMethod&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">chosenMethod&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Squad decides!&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Squads have end-to-end responsibility&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">deliverFeature&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Feature&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">feature&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">design&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">feature&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">develop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">feature&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">feature&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">deploy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">feature&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">monitor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">feature&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Cross-pollination with other squads&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">shareLearningSessions&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Guilds facilitate knowledge sharing&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="8-devops-集成开发与运维合二为一">8. DevOps 集成：开发与运维合二为一
&lt;/h2>&lt;p>最成功的公司已经消除了开发和运维团队之间的移交。开发者不再将代码“一扔了之”，而是端到端 (end-to-end) 地拥有他们的应用程序，包括部署、监控和维护。&lt;/p>
&lt;p>这种方法消除了“在我机器上可以运行”的问题，因为开发者要对生产环境性能负责。它还能够实现更快的反馈周期，并减少团队之间的推诿扯皮。&lt;/p>
&lt;p>DevOps 流水线集成：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Traditional&lt;/span> &lt;span class="n">Handoff&lt;/span> &lt;span class="nl">Model&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">┌───────────┐&lt;/span> &lt;span class="err">┌───────────┐&lt;/span> &lt;span class="err">┌───────────┐&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">│&lt;/span> &lt;span class="n">DEV&lt;/span> &lt;span class="err">│───►│&lt;/span> &lt;span class="n">QA&lt;/span> &lt;span class="err">│───►│&lt;/span> &lt;span class="n">OPS&lt;/span> &lt;span class="err">│&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">│&lt;/span> &lt;span class="s">&amp;#34;Done&amp;#34;&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="s">&amp;#34;Test&amp;#34;&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="s">&amp;#34;Deploy&amp;#34;&lt;/span> &lt;span class="err">│&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">└───────────┘&lt;/span> &lt;span class="err">└───────────┘&lt;/span> &lt;span class="err">└───────────┘&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">▼&lt;/span> &lt;span class="err">▼&lt;/span> &lt;span class="err">▼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Blame&lt;/span> &lt;span class="n">Dev&lt;/span> &lt;span class="n">Blame&lt;/span> &lt;span class="n">QA&lt;/span> &lt;span class="n">Blame&lt;/span> &lt;span class="n">Ops&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Modern&lt;/span> &lt;span class="n">DevOps&lt;/span> &lt;span class="nl">Integration&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">┌─────────────────────────────────────────────────────┐&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">│&lt;/span> &lt;span class="n">FULL&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">STACK&lt;/span> &lt;span class="n">OWNERSHIP&lt;/span> &lt;span class="err">│&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">│&lt;/span> &lt;span class="err">┌─────────┐&lt;/span> &lt;span class="err">┌─────────┐&lt;/span> &lt;span class="err">┌─────────┐&lt;/span> &lt;span class="err">┌─────────┐│&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="n">Code&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="n">Test&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="n">Deploy&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="n">Monitor&lt;/span> &lt;span class="err">││&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">│&lt;/span> &lt;span class="err">││&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">│&lt;/span> &lt;span class="err">└─────────┘&lt;/span> &lt;span class="err">└─────────┘&lt;/span> &lt;span class="err">└─────────┘&lt;/span> &lt;span class="err">└─────────┘│&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">│&lt;/span> &lt;span class="n">Same&lt;/span> &lt;span class="n">Team&lt;/span> &lt;span class="err">│&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">└─────────────────────────────────────────────────────┘&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="9-精益开发消除浪费最大化价值">9. 精益开发：消除浪费，最大化价值
&lt;/h2>&lt;p>源自丰田制造的精益原则在软件开发中焕发了新的活力。其核心思想是消除任何不能直接为客户创造价值的活动。&lt;/p>
&lt;p>在实践中，这意味着更少的会议、更少的文档、更短的反馈周期和更快的决策。采用精益方法的团队将更多时间用于编码，更少时间用于仪式性活动。&lt;/p>
&lt;p>精益 Java 开发原则（任何人都能懂的伪代码）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">LeanDevelopmentService&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Principle 1: Eliminate waste (unnecessary meetings, docs)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">eliminateWaste&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// No daily standups if async communication works&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// No estimation meetings if flow is predictable&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// No detailed specs if quick prototypes suffice&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Principle 2: Build quality in (automated testing)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Test&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">testDrivenDevelopment&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Write tests first, eliminate manual testing waste&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">assertTrue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Quality built into process&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Principle 3: Deliver fast (continuous deployment)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">deliverFast&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Small batches, frequent releases&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">out&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Value delivered in hours, not sprints&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="10-混合方法多种方法论的精华">10. 混合方法：多种方法论的精华
&lt;/h2>&lt;p>最明智的公司不会只选择一种方法论并永远墨守成规。他们根据特定背景下的有效性，持续试验和调整，结合不同方法的要素。&lt;/p>
&lt;p>例如，一个团队可能使用 Shape Up 的六周周期进行功能开发，使用 Kanban 进行 Bug 修复，并采用持续交付 (continuous delivery) 进行部署。关键在于衡量结果并调整流程，以优化成果，而不是墨守方法论。&lt;/p>
&lt;p>混合实现示例（任何人都能懂的伪代码）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Java" data-lang="Java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Component&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">HybridMethodology&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Use different approaches for different work types&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">handleWork&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">WorkType&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">switch&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">FEATURE_DEVELOPMENT&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">useShapeUpCycle&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// 6-week focused cycles&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BUG_FIXES&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">useKanbanFlow&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Continuous flow&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">EXPERIMENTS&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">useNoEstimates&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Quick validation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">case&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">INFRASTRUCTURE&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">useDevOpsPipeline&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Automated deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">break&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="未来已来">未来已来
&lt;/h2>&lt;p>数据表明 Scrum 不再是唯一的（或绝对主导的）框架——团队正在将其与更新的实践相结合。那些拥抱自主性、持续交付 (Continuous Delivery) 和以结果为导向的方法的团队，始终优于那些过度依赖流程的团队。适应这些新方法的公司将蓬勃发展，而那些根据自身需求调整流程的团队往往能更快地行动并交付更多价值。&lt;/p>
&lt;p>不要等待你的组织强制推行变革。今天就开始在你的团队中试验这些方法吧。尝试一个月不进行估算，为你的下一个功能实现持续部署 (Continuous Deployment)，或者让你的开发人员完全拥有其部署流水线 (Deployment Pipeline)。&lt;/p>
&lt;p>你会首先尝试什么？在下面的评论中分享你的实验和结果。&lt;/p>
&lt;p>将复杂的技术拆解为简单的文字。如果你正在学习，那么我正是为你而写。&lt;/p></description></item><item><title>我为什么要从 Kubernetes Ingress 迁移到 Gateway API</title><link>https://martinliu.cn/blog/why-im-moving-from-kubernetes-ingress-to-gateway/</link><pubDate>Thu, 28 Aug 2025 10:00:00 +0800</pubDate><guid>https://martinliu.cn/blog/why-im-moving-from-kubernetes-ingress-to-gateway/</guid><description>&lt;img src="https://martinliu.cn/blog/why-im-moving-from-kubernetes-ingress-to-gateway/1_rhwXmfU4EZHiwcLjTUxOaQ.png" alt="Featured image of post 我为什么要从 Kubernetes Ingress 迁移到 Gateway API" />&lt;p>对于每一位踏入 Kubernetes 世界的 DevOps 工程师来说，Ingress 通常是他们遇到的第一个资源，甚至可能是他们的“初恋”。当需要简单的 HTTP(S) 路由时，Ingress 就会派上用场，为集群内部的服务打开了通往外部世界的大门。多年来，它一直运行良好。但技术世界永不停歇，需求不断演变，现有解决方案也开始触及其局限性。正是在这种背景下，Gateway API 进入了 Kubernetes 生态系统。&lt;/p>
&lt;p>那么，既然我们已经有了像 Ingress 这样成熟且广泛采用的解决方案，为什么还需要一个新的 API 呢？Gateway API 解决了哪些问题？它缓解了哪些痛点？在这篇博客文章中，我们将探讨我使用 Ingress 的经验、Gateway API 带来的创新，以及为什么这种转变是完全合理的。我们的目标是以技术性强但友好的语调来解释这些内容。&lt;/p>
&lt;h2 id="ingress-的局限性">Ingress 的局限性
&lt;/h2>&lt;p>&lt;strong>注解地狱 (Annotation Hell)：&lt;/strong> Ingress 最大的缺点之一是它对注解 (annotations) 的依赖，以实现高级功能。对于限流 (rate limiting)、URL 重写 (URL rewrites)、请求体大小限制 (body size limits)、CORS 设置 (CORS settings) 等类似功能，我们不得不使用每个 Ingress 控制器 (Ingress Controller) 特定的注解。这导致了不同 Ingress 控制器（Nginx、Traefik、HAProxy 等）之间的不一致性。您在使用 Nginx Ingress 时编写的注解，在切换到 Traefik 后可能会变得毫无意义。当然，如果您像我一样通常只使用 Nginx Ingress，这可能对您来说不是问题，但未来您可能需要替代方案。&lt;/p>
&lt;p>&lt;strong>缺乏高级流量管理：&lt;/strong> Ingress 自身不足以支持现代部署策略，例如金丝雀部署 (canary deployments) 和蓝绿部署 (blue/green deployments)。这些场景通常需要额外的工具，比如服务网格 (Service Mesh) 或复杂的注解组合。这增加了架构的复杂性和运维开销 (operational overhead)。&lt;/p>
&lt;p>&lt;strong>协议限制：&lt;/strong> Ingress 从根本上是为 HTTP 和 HTTPS 流量设计的。它没有内置支持其他协议，如 TCP 和 UDP。这使得在 Kubernetes 上运行使用不同协议的应用程序时，需要寻找替代解决方案。&lt;/p>
&lt;h2 id="为什么选择-gateway-apikubernetes-流量管理的新时代">为什么选择 Gateway API？Kubernetes 流量管理的新时代
&lt;/h2>&lt;p>考虑到 Ingress 的局限性，Kubernetes 社区认识到需要一种更全面、更灵活的流量管理解决方案。Gateway API 应运而生。Gateway API 不仅支持 HTTP(S) 流量，还支持 TCP 和 UDP 等其他协议。它提供了一个基于角色且可扩展的结构。让我们深入了解 Gateway API 的核心组件以及它解决的问题：&lt;/p>
&lt;p>Gateway API 围绕三个主要的自定义资源定义 (Custom Resource Definitions, CRDs) 构建：&lt;/p>
&lt;p>&lt;strong>GatewayClass：&lt;/strong> 该资源定义了网关 (Gateway) 的行为和功能。就像 Ingress Controllers 一样，不同的 Gateway Controllers (例如 NGINX Gateway) 提供自己的 GatewayClass。&lt;/p>
&lt;p>&lt;strong>Gateway：&lt;/strong> 该资源表示集群中的一个网络网关，通常是一个负载均衡器或代理。它定义了监听器 (listeners)，并指定哪些路由 (Route) 对象可以附加到这些监听器。例如，一个 Gateway 对象可能在 80 端口和 443 端口监听 HTTP 和 HTTPS 流量。&lt;/p>
&lt;p>&lt;strong>Route：&lt;/strong> Route 资源定义了到达 Gateway 的流量应如何路由。HTTPRoute 用于 HTTP/HTTPS 流量，而 TCPRoute 和 UDPRoute 等其他类型则用于不同的协议。路由根据主机 (host)、路径 (path)、请求头 (headers) 等匹配流量，并将其路由到后端服务 (backend services)。这是开发人员可以定义自己的路由规则的地方。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/why-im-moving-from-kubernetes-ingress-to-gateway/1__1TVbXaobEeF2gWCENYxkw.png"
width="640"
height="560"
srcset="https://martinliu.cn/blog/why-im-moving-from-kubernetes-ingress-to-gateway/1__1TVbXaobEeF2gWCENYxkw_hu_9a9ca8f5c7e8bae2.png 480w, https://martinliu.cn/blog/why-im-moving-from-kubernetes-ingress-to-gateway/1__1TVbXaobEeF2gWCENYxkw_hu_51ef272340507958.png 1024w"
loading="lazy"
alt="Gateway API 架构图"
class="gallery-image"
data-flex-grow="114"
data-flex-basis="274px"
>&lt;/p>
&lt;p>这种三层结构完美地实现了 Gateway API 最重要的创新之一：关注点分离 (separation of concerns)。&lt;/p>
&lt;p>&lt;strong>基础设施提供商 (Infrastructure Providers)：&lt;/strong> 管理 GatewayClass 并决定可以使用哪些 Gateway Controllers。&lt;/p>
&lt;p>&lt;strong>集群操作员 (Cluster Operators)：&lt;/strong> 创建和管理 Gateway 对象。这包括面向公众的配置、监听器和基本的安全设置。&lt;/p>
&lt;p>&lt;strong>应用程序开发人员 (Application Developers)：&lt;/strong> 为其应用程序定义 Route 对象，例如 HTTPRoute。这些规则包括基于主机/路径/请求头的路由、流量拆分 (traffic splitting) 和重写 (rewrites)。&lt;/p>
&lt;h2 id="实践示例">实践示例
&lt;/h2>&lt;p>假设我们有以下 Ingress 资源，它通过 k8senol.com 根据路径将流量路由到两个服务（message-service 和 swap-service）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">networking.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">oldfriend-ingress&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">annotations&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">nginx.ingress.kubernetes.io/rewrite-target&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">rules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">k8senol.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">paths&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/message&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">pathType&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Prefix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">backend&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">message-service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">number&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/swap&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">pathType&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Prefix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">backend&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">swap-service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">number&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>现在，让我们使用 Gateway API 通过三个步骤（GatewayClass、Gateway 和 HTTPRoute）来实现相同的场景。&lt;/p>
&lt;p>&lt;strong>第一步：&lt;/strong> 定义 GatewayClass 首先，我们需要创建一个 GatewayClass 来指定将使用的 Gateway Controller。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">gateway.networking.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GatewayClass&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">k8senol-gw-class&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">controllerName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">k8senol.com/gateway-controller&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个 YAML 定义了一个由 k8senol.com/gateway-controller 控制器管理的网关类 (GatewayClass)。在实际应用中，这个值会是你所使用的网关控制器 (Gateway Controller) 的具体名称（例如，gateway.nginx.org/nginx-gateway-controller）。&lt;/p>
&lt;p>&lt;strong>第二步 Step 2: 创建网关 (Gateway)&lt;/strong>
接下来，我们将创建网关 (Gateway) 资源，它将集群暴露给外部流量，并定义要监听的端口和协议。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">gateway.networking.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Gateway&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">k8senol-gateway&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">default&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gatewayClassName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">k8senol-gw-class&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">listeners&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">HTTP&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hostname&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;*.k8senol.com&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">allowedRoutes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">namespaces&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">from&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Same&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个网关 (Gateway) 对象使用 k8senol-gw-class 监听端口 80 上的 HTTP 流量。主机名 “*.k8senol.com” 允许该域下的所有子域名进行路由。allowedRoutes 部分限制路由 (Route) 附件只能在同一命名空间（默认）中。&lt;/p>
&lt;p>&lt;strong>第三步: 创建 HTTP 路由 (HTTPRoute)&lt;/strong>
最后，我们使用 HTTP 路由 (HTTPRoute) 对象来定义路由规则。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">gateway.networking.k8s.io/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">HTTPRoute&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">k8senol-routes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">namespace&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">default&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">parentRefs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">k8senol-gateway&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">hostnames&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;k8senol.com&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">rules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PathPrefix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/message&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">backendRefs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">message-service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">matches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PathPrefix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/swap&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">backendRefs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">swap-service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个 HTTP 路由 (HTTPRoute) 对象附加到 k8senol-gateway。hostnames 字段将这些规则应用于 k8senol.com。rules 部分复制了 Ingress (Ingress) 的路由逻辑：/message 路由到 message-service，/swap 路由到 swap-service。&lt;/p>
&lt;p>如你所见，单个 Ingress YAML 现在在 Gateway API 中被拆分为三个不同的资源。虽然这最初看起来更复杂，但每个资源都有明确的职责。从长远来看，这会带来更清晰、更易管理且更安全的流量管理架构。&lt;/p>
&lt;p>Kubernetes Ingress 毫无疑问是 Kubernetes 生态系统的基石，在将服务暴露给外部世界方面发挥了关键作用。凭借其简单易懂的结构，它在早期阶段为我们提供了良好的服务。但随着技术发展和需求变得日益复杂，对灵活强大解决方案的需求也随之增长。&lt;/p>
&lt;p>Gateway API 应运而生，以应对 Ingress (Ingress) 的局限性，并将 Kubernetes 流量管理提升到一个全新的水平。凭借角色分离、可扩展性、多协议支持和高级流量控制能力，它能更有效地满足现代云原生应用的需求。&lt;/p>
&lt;p>这不仅仅是技术上的变革。它也反映了我们对 Kubernetes 中网络认知的转变。从今天开始探索 Gateway API 是朝着构建更强大、更灵活、更易管理的基础设施迈出的有意义的一步。&lt;/p>
&lt;p>请记住，持续学习和适应是 DevOps (DevOps) 世界成功的关键。这次转型不仅会提升你的技术技能，还会提高你理解和管理复杂系统的能力。&lt;/p></description></item><item><title>用这些鲜为人知（且大多数开发者都忽略）的技巧，让你的 Python 代码提速 10 倍</title><link>https://martinliu.cn/blog/i-made-my-python-code-10x-faster-using-these/</link><pubDate>Wed, 27 Aug 2025 16:00:00 +0800</pubDate><guid>https://martinliu.cn/blog/i-made-my-python-code-10x-faster-using-these/</guid><description>&lt;img src="https://martinliu.cn/blog/i-made-my-python-code-10x-faster-using-these/1_JtvDNgonwDl8sRlYYW69kA.webp" alt="Featured image of post 用这些鲜为人知（且大多数开发者都忽略）的技巧，让你的 Python 代码提速 10 倍" />&lt;p>如果你是一名在云计算基础架构 (cloud infrastructure)、SRE (Site Reliability Engineering) 和应用数据科学领域工作的从业者，你一定很欣赏 Python 提供的清晰性和简洁性。无论你是在原型化机器学习模型、编排后端工作流，还是在生产级系统 (production-grade system) 中构建自动化管道，Python 始终是你工具库中的首选。但说实话—— &lt;strong>Python 有时会很慢&lt;/strong>。慢得令人痛苦。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/i-made-my-python-code-10x-faster-using-these/0_VXY46SwRfsnWJKIC.webp"
width="640"
height="360"
srcset="https://martinliu.cn/blog/i-made-my-python-code-10x-faster-using-these/0_VXY46SwRfsnWJKIC_hu_aa960e03568e00c7.webp 480w, https://martinliu.cn/blog/i-made-my-python-code-10x-faster-using-these/0_VXY46SwRfsnWJKIC_hu_dacac778015c9775.webp 1024w"
loading="lazy"
alt="Python"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="426px"
>&lt;/p>
&lt;p>然而，你需要了解并牢记的是，&lt;strong>Python 的大多数性能问题都是开发者自己造成的&lt;/strong>。问题不在于语言本身，而在于你使用它的方式。事实上，Python 的瓶颈往往是由被忽视的细节引起的：低效的数据结构 (data structures)、不必要的内存分配 (allocations)、重复的计算 (redundant computations)，或者仅仅是你从其他语言带来的、不完全适用的习惯。&lt;/p>
&lt;p>你可能见过太多的工程师（尤其是在高性能计算 (high-performance computing) 领域之外）低估了一些小决定的成本。比如循环方式不当、内置函数使用效率低下、忽视性能分析 (profiling)，或者过度依赖 Pandas (Pandas) 来执行本可以使用 NumPy (NumPy) 或 Polars (Polars) 提速 50 倍的操作。更别提那些仍然在 Pandas 中使用 &lt;code>apply&lt;/code> 而不是向量化 (vectorization) 的人了。&lt;/p>
&lt;p>在这篇文章中，作者不会谈论你随处可见的那些显而易见的建议，比如&amp;quot;使用 NumPy&amp;quot;或&amp;quot;避免 for 循环&amp;quot;。这些你都听过了。这是一次&lt;strong>深入探讨那些被低估、被忽视、有时甚至有些奇特的技巧，它们能够显著加速你的 Python 代码&lt;/strong>——这些技巧你真希望能早点知道。本文将通过实际案例、你可能没用过（但应该用）的库，以及那些悄悄侵蚀你性能的习惯，为你一一讲解。&lt;/p>
&lt;p>所以，如果你正在处理大型数据管道 (data pipelines)、后端 API (Application Programming Interface)、科学计算 (scientific computing)，甚至是自动化基础架构 (infrastructure) 的工作——并且你觉得 Python 正在拖累你——那么这篇文章就是为你准备的。&lt;/p>
&lt;h2 id="-1-停止使用-rangelen--改用-enumerate">🚀 1. 停止使用 range(len(&amp;hellip;)) — 改用 enumerate
&lt;/h2>&lt;p>这看起来可能微不足道，但在某些紧密的循环中，它却出乎意料地常见且代价高昂：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Slow&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">my_list&lt;/span>&lt;span class="p">)):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">my_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Faster and more Pythonic&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">enumerate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">my_list&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用 &lt;code>enumerate&lt;/code>（枚举）可以避免重复的索引和方法调用。它更简洁，并有助于解释器在底层进行更好的优化。&lt;/p>
&lt;h2 id="-2-避免将-list-用于大型集合--改用-arraydeque-或-numpy-数组">⚡ 2. 避免将 list 用于大型集合 — 改用 array、deque 或 numpy 数组
&lt;/h2>&lt;p>Python 列表 (lists) 通用且灵活，但对于大型数值运算来说，它们的&lt;strong>内存效率不高&lt;/strong>且速度不快。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">array&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">array&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">my_array&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">array&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;i&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="c1"># Much faster than list for ints&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或者更好的是，对数值数据使用 &lt;code>numpy&lt;/code> 或 &lt;code>polars.Series&lt;/code>。NumPy 使用由 C 语言支持的固定类型数组，而 Polars（见下文）是用 Rust 编写的，并针对速度进行了优化。&lt;/p>
&lt;h2 id="-3-使用-functoolslru_cache-加速纯函数">🧠 3. 使用 functools.lru_cache 加速纯函数
&lt;/h2>&lt;p>如果你有计算开销大的纯函数（即，相同输入 → 相同输出），记忆化 (memoization) 可以带来显著的性能提升：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">functools&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">lru_cache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@lru_cache&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">maxsize&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">expensive_computation&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这在许多机器学习 (Machine Learning) 管线中被严重低估。&lt;/p>
&lt;h2 id="-4-使用-numba-将-python-编译成机器码--无需更改代码">🏁 4. 使用 Numba 将 Python 编译成机器码 — 无需更改代码
&lt;/h2>&lt;p>这是一个改变游戏规则的工具。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">numba&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">jit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@jit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">nopython&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">compute&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>被 &lt;code>@jit&lt;/code> 包装的函数可以运行得&lt;strong>快 100 倍&lt;/strong>。Numba 使用 LLVM 编译你的代码，只需极少的语法改动。它最适用于循环和数值计算代码。&lt;/p>
&lt;h2 id="-5-将-pandas-切换到-polars-处理-dataframe">⚙️ 5. 将 Pandas 切换到 Polars 处理 DataFrame
&lt;/h2>&lt;p>Pandas 很棒。但对于大型数据集来说，它速度慢且是单线程的。此时，让开发者引入 &lt;code>[Polars](https://pola.rs/)&lt;/code>，一个用 Rust 编写并支持原生多线程的极速 DataFrame 库。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">polars&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">pl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read_csv&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;data.csv&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;sales&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">1000&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在实际的 ETL (Extract, Transform, Load) 管线中，Polars 的性能可以比 Pandas &lt;strong>高 10 倍甚至更多&lt;/strong>。&lt;/p>
&lt;h2 id="-6-使用内置性能分析工具--不要盲目优化">🔍 6. 使用内置性能分析工具 — 不要盲目优化
&lt;/h2>&lt;p>在优化任何东西之前，请先进行&lt;strong>性能分析 (Profiling)&lt;/strong>。你无法改进无法衡量的事物。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">python -m cProfile my_script.py
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或者更好的是，使用 &lt;code>line_profiler&lt;/code>：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">pip install line_profiler
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@profile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">my_func&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后使用以下命令运行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kernprof -l my_script.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">python -m line_profiler my_script.py.lprof
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这显示了逐行的瓶颈，是性能调试 (Performance Debugging) 的利器。&lt;/p>
&lt;h2 id="-7-在紧密循环中最小化属性查找">⛏️ 7. 在紧密循环中最小化属性查找
&lt;/h2>&lt;p>这一个细微但非常真实：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Bad&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">my_object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">some_attribute&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Better&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">attr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">my_object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">some_attribute&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">attr&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>每一次属性访问 (attribute access) 都是一次字典查找 (dictionary lookup)。在大型循环中，这会累积起来。&lt;/p>
&lt;h2 id="-8-预分配列表而不是在循环中追加">🧬 8. 预分配列表而不是在循环中追加
&lt;/h2>&lt;p>追加操作方便，但在大规模操作时会很慢：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Slow&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Faster&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">1000000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">i&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这在数据预处理中尤为重要。&lt;/p>
&lt;h2 id="-9-尝试-pydantic-v2-或-msgspec-进行快速数据验证">📦 9. 尝试 Pydantic V2 (或 msgspec) 进行快速数据验证
&lt;/h2>&lt;p>如果你正在构建 API (Application Programming Interface) 或摄取数据，你可能正在使用 Pydantic。但 v2 &lt;strong>用 Rust 重写&lt;/strong>，速度快得多：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pydantic&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">BaseModel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">User&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BaseModel&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">id&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">str&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或者，为了极致性能：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">msgspec&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">User&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">msgspec&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Struct&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">id&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">int&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">str&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>msgspec&lt;/code> 比 Pydantic 和 dataclasses 都快。&lt;/p>
&lt;h2 id="-10-尽可能使用生成器而不是列表">🧪 10. 尽可能使用生成器而不是列表
&lt;/h2>&lt;p>如果你不需要一次性获取所有结果，请使用生成器 (Generators)：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">slow&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">fast&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>内存使用量将从千兆字节降到几乎为零。&lt;/p>
&lt;h2 id="-额外提示使用-mypyc-编译你的脚本-实验性但有前景">⚙️ 额外提示：使用 mypyc 编译你的脚本 (实验性但有前景)
&lt;/h2>&lt;p>如果你的模块中使用了类型提示 (type hints)：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">pip install mypy mypyc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Compiles your script to C extension&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mypyc my_module.py
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这对于数值计算代码尤其强大，而且如果你已经在使用类型标注 (typing)，只需要进行极小的改动。&lt;/p>
&lt;h2 id="最终思考">最终思考
&lt;/h2>&lt;p>大多数开发者认为 Python 运行缓慢。然而，如果使用得当，Python 的速度会&lt;strong>出人意料地快&lt;/strong>。真正的瓶颈不在于语言本身，而在于我们的使用习惯。通过结合智能利用原生特性、未被充分利用的库以及性能优先的思维模式，我们可以在高吞吐量的生产工作负载中，也能实现全新的速度水平。&lt;/p>
&lt;p>在自己的案例中，优化了生产环境中几个关键的推理评分和数据转换流水线，将运行时间从&lt;strong>数分钟缩短到数秒&lt;/strong>。最棒的是什么？不要更换语言，也不要用 C++ 重写一切。你只需要开始将 Python 视为它本应有的强大语言——只要使用得当。&lt;/p>
&lt;p>如果你认真想要从 Python 中榨取性能，请从这些建议开始。然后进行性能分析 (profile)、测试，并持续学习。总会有更快的方法。&lt;/p></description></item><item><title>技能不是问题，可见性才是关键 —— 我的 DevOps 职场经验分享</title><link>https://martinliu.cn/blog/devops-wasnt-my-problem-nobody-just-knew-i-existed/</link><pubDate>Tue, 26 Aug 2025 20:00:00 +0800</pubDate><guid>https://martinliu.cn/blog/devops-wasnt-my-problem-nobody-just-knew-i-existed/</guid><description>&lt;img src="https://martinliu.cn/blog/devops-wasnt-my-problem-nobody-just-knew-i-existed/1_3vFTMBRkvLlFBa3v3VukRA.webp" alt="Featured image of post 技能不是问题，可见性才是关键 —— 我的 DevOps 职场经验分享" />&lt;blockquote>
&lt;p>作者：Zudonu Osomudeya&lt;/p>&lt;/blockquote>
&lt;p>我确实具备一些实打实的技能。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Terraform&lt;/strong>：我能写模块，并且大多数时候看起来还算清晰有条理。&lt;/li>
&lt;li>&lt;strong>Kubernetes&lt;/strong>：我与集群的缠斗已经久到，连梦里都在敲 &lt;code>kubectl apply -f&lt;/code>。&lt;/li>
&lt;li>&lt;strong>CI/CD&lt;/strong>：GitHub Actions 对我来说就像心情晴雨表，有时流畅，有时又不明所以地失败。&lt;/li>
&lt;/ul>
&lt;p>然而，问题来了：为什么我依然一无所有、默默无闻，甚至感觉自己只是在对着虚空呐喊？&lt;/p>
&lt;h2 id="学习--出路">学习 ≠ 出路
&lt;/h2>&lt;p>我一度认为，答案可能是再多拿一张证书，或者去掌握一些没人真正用、但在简历上好看的小众工具。&lt;/p>
&lt;p>于是我陷入了无休止的循环：学习，再学习。&lt;/p>
&lt;p>可现实是：没有发生过任何改变。&lt;/p>
&lt;ul>
&lt;li>没有新工作机会&lt;/li>
&lt;li>没有兼职&lt;/li>
&lt;li>没有私信&lt;/li>
&lt;li>猎头也视我为空气&lt;/li>
&lt;/ul>
&lt;p>只剩下我和终端，以及那句越来越刺耳的问题：&lt;strong>“我到底做错了什么？”&lt;/strong>&lt;/p>
&lt;h2 id="问题的真正根源">问题的真正根源
&lt;/h2>&lt;p>后来我才意识到，问题根本不在于技能，而在于：&lt;strong>没人知道我存在&lt;/strong>。&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>如果没人看到你，你就无法被雇佣。&lt;/li>
&lt;li>如果没人记住你的名字，你就不会获得推荐。&lt;/li>
&lt;li>DevOps 的职业发展，不可能在真空里发生。&lt;/li>
&lt;/ul>&lt;/blockquote>
&lt;p>然而，我却一直在“隐身”。&lt;/p>
&lt;p>我常常安慰自己：&lt;strong>等我什么都懂了&lt;/strong>，再出来分享。
可事实是，在 DevOps 领域，&lt;strong>你永远不可能什么都懂&lt;/strong>。&lt;/p>
&lt;p>今天你是 YAML 大师，明天可能就被一个缩进打回原形。&lt;/p>
&lt;h2 id="打破沉默从一次小小的分享开始">打破沉默：从一次小小的分享开始
&lt;/h2>&lt;p>很长一段时间里，我都选择沉默：不发帖、不展示、不寻求帮助。&lt;/p>
&lt;p>原因只有一个——我觉得自己还没有资格。&lt;/p>
&lt;p>直到有一天，我鼓起勇气，发了一条看似微不足道的朋友圈：&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>“还在学习，还在犯错，但这个集群在调试了四天之后终于能用了。DevOps 真是令人谦卑😅。”&lt;/strong>&lt;/p>&lt;/blockquote>
&lt;p>差点我就没点下“发布”。我担心它太傻，太微小，不够“专业”。
但结果让我意外：很多人留言分享了他们的经历。&lt;/p>
&lt;p>那一刻，我明白了：&lt;strong>你永远不知道谁在关注你。&lt;/strong>&lt;/p>
&lt;h2 id="真实比完美更有价值">真实比完美更有价值
&lt;/h2>&lt;p>从那之后，我不再试图“证明”自己有多聪明。
我开始选择真实地展现自己：&lt;/p>
&lt;ul>
&lt;li>分享学到的知识&lt;/li>
&lt;li>偶尔发一张 YAML 崩溃的梗图&lt;/li>
&lt;li>写下一篇像这样的经验分享&lt;/li>
&lt;/ul>
&lt;p>渐渐地，人们开始注意到我。
我并没有变成专家，我只是变得&lt;strong>可见&lt;/strong>了。&lt;/p>
&lt;h2 id="devops-不只是技术更是个人品牌">DevOps 不只是技术，更是个人品牌
&lt;/h2>&lt;p>我们谈论 DevOps 时，总是聚焦在容器和集群，但其实它还有更重要的商业层面：&lt;strong>你需要像品牌一样去思考自己的职业发展&lt;/strong>。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>GitHub&lt;/strong>：是我的作品集&lt;/li>
&lt;li>&lt;strong>LinkedIn&lt;/strong>：是我的个人着陆页&lt;/li>
&lt;li>&lt;strong>博客/Medium&lt;/strong>：是我的产品展示&lt;/li>
&lt;/ul>
&lt;p>本质上，我不仅仅是一个 DevOps 工程师。
我同时也是一个“产品”，一种“服务”，一个可以被认同、被记住的“故事”。&lt;/p>
&lt;h2 id="参与比完美更重要">参与比完美更重要
&lt;/h2>&lt;p>是的，我依然在学习，也依然在犯错。
但我不再等待“完美”的时机。&lt;/p>
&lt;p>我理解了：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>自信不是无所不知&lt;/strong>&lt;/li>
&lt;li>&lt;strong>自信是坦然接受“不知道”，并依然选择分享和参与&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h2 id="给仍在犹豫的你">给仍在犹豫的你
&lt;/h2>&lt;p>如果你还在等待那个“合适的时机”，去发帖、去展示、去申请机会——
请把这段文字当作信号：&lt;/p>
&lt;ul>
&lt;li>发布那篇文章&lt;/li>
&lt;li>展示那个项目&lt;/li>
&lt;li>讲述你的故事&lt;/li>
&lt;/ul>
&lt;p>因为，你永远不知道：在某个角落，或许就有人在默默关注你，而那个人，可能就是改变你职业生涯的关键。&lt;/p>
&lt;h2 id="写在最后">写在最后
&lt;/h2>&lt;p>如果这篇文章让你有所共鸣，或者让你心里一笑，请点赞、评论、转发，或者关注我。
我写作的目的，是和那些同样在一次次集群崩溃与重建中成长的 DevOps 同行们建立连接。&lt;/p>
&lt;p>&lt;strong>记住：你不仅仅是在做 DevOps，你正在创造价值。&lt;/strong>
&lt;strong>别忘了，也要成就自己。&lt;/strong>&lt;/p></description></item><item><title>在 DevOps 实践中的两次思维转变，彻底改变了我</title><link>https://martinliu.cn/blog/two-mindset-shifts-that-changed-everything-for-me/</link><pubDate>Mon, 25 Aug 2025 10:00:00 +0800</pubDate><guid>https://martinliu.cn/blog/two-mindset-shifts-that-changed-everything-for-me/</guid><description>&lt;img src="https://martinliu.cn/blog/two-mindset-shifts-that-changed-everything-for-me/1_7OnOS2Hlt5vIKFVozBhN-g.webp" alt="Featured image of post 在 DevOps 实践中的两次思维转变，彻底改变了我" />&lt;blockquote>
&lt;p>作者：Andrey Byhalenko&lt;/p>&lt;/blockquote>
&lt;p>DevOps 不仅仅是工具，更是一种思维模式。了解团队如何卓越协作、重视持续改进、分担责任并乐于接受变化。深入探讨 DevOps (Development and Operations) 的核心理念，以简单易懂的方式呈现给每个人，无论其语言背景如何。&lt;/p>
&lt;p>当我开始学习 DevOps 时，我做了大多数初学者都会做的事。&lt;/p>
&lt;p>我追逐工具。&lt;/p>
&lt;p>Docker &amp;raquo; Kubernetes &amp;raquo; AWS &amp;raquo; Terraform。&lt;/p>
&lt;p>我跟着教程学习，搭建了一些宠物项目，甚至通过了几项认证。我从技术上讲会使用这些工具，但我并没有真正理解&lt;strong>为什么&lt;/strong>要使用它们。我不知道它们究竟解决了哪些实际问题。&lt;/p>
&lt;p>在某个时刻，我碰壁了。&lt;/p>
&lt;p>然后一切都变了。&lt;/p>
&lt;h2 id="转变-1从以工具为导向到以解决方案为导向">转变 1：从以工具为导向到以解决方案为导向
&lt;/h2>&lt;p>有一天，我不再问：
&lt;strong>“我接下来应该学什么？”&lt;/strong>
我开始问：
&lt;strong>“我正在解决什么问题？”&lt;/strong>&lt;/p>
&lt;p>我不再试图掌握所有热门的新工具，而是设想我正在为一家真正的公司构建基础设施。是我自己的初创公司。&lt;/p>
&lt;p>从那时起，事情就豁然开朗了。&lt;/p>
&lt;p>我不再一切从工具开始。而是从&lt;strong>需求&lt;/strong>开始，然后寻找正确的解决方案。&lt;/p>
&lt;p>例如：&lt;/p>
&lt;ul>
&lt;li>我有供给虚拟服务器的需要 → &lt;strong>使用 EC2 或 VMware。&lt;/strong>&lt;/li>
&lt;li>我有版本控制的需要 → &lt;strong>使用 Git。&lt;/strong>&lt;/li>
&lt;li>我有将微服务 (Microservices) 容器化的需要 → &lt;strong>使用 Docker 和 Docker Compose。&lt;/strong>&lt;/li>
&lt;li>我有编排 (Orchestrate) 它们的需要 → &lt;strong>使用 Kubernetes。&lt;/strong>&lt;/li>
&lt;li>我有集中式日志的需要 → &lt;strong>使用 ELK stack。&lt;/strong>&lt;/li>
&lt;li>我有监控我的服务器的需要 → &lt;strong>使用 Grafana。&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>我使用的每个工具都成为了&lt;strong>思考&lt;/strong>后的结果，而不是起点。&lt;/p>
&lt;p>这种思维模式让我的学习速度提升了 10 倍，也更有意义。
我不再只是练习命令。我正在解决实际的基础设施挑战。&lt;/p>
&lt;h2 id="转变-2从技术思维到业务思维">转变 2：从技术思维到业务思维
&lt;/h2>&lt;p>这个转变让我花了更长的时间才意识到。&lt;/p>
&lt;p>即使在我对工具和架构充满信心之后，我仍然缺少一些关键的东西：&lt;strong>业务背景&lt;/strong>。&lt;/p>
&lt;p>我过去常常想，&lt;/p>
&lt;p>“这些都是最佳实践。他们为什么接受呢？”&lt;/p>
&lt;p>但现在我明白，&lt;strong>最佳&lt;/strong>技术解决方案，并不总是对业务来说&lt;strong>正确&lt;/strong>的解决方案。&lt;/p>
&lt;ul>
&lt;li>也许它太昂贵了。&lt;/li>
&lt;li>也许它对团队来说太复杂了。&lt;/li>
&lt;li>也许它解决了一个根本不存在的问题。&lt;/li>
&lt;li>也许它正在制造另一个问题。&lt;/li>
&lt;/ul>
&lt;p>作为 DevOps 工程师，我们不仅仅是构建系统。&lt;/p>
&lt;p>我们的最终目标是用技术解决业务问题。&lt;/p>
&lt;p>第二次思维模式的转变改变了我工作的方式、思考的方式以及与团队沟通的方式。&lt;/p>
&lt;h2 id="如果你是-devops-新手请记住这一点">如果你是 DevOps 新手，请记住这一点
&lt;/h2>&lt;p>✅ 工具很重要。
✅ 教程有帮助。
✅ 项目涨经验。&lt;/p>
&lt;p>但是，拥有&lt;strong>正确的心态&lt;/strong>会让你比获得任何证书或 Udemy 课程走得更远。&lt;/p>
&lt;p>要着眼于&lt;strong>解决方案&lt;/strong>，而不是工具。
要着眼于&lt;strong>业务价值&lt;/strong>，而不仅仅是技术上的优雅。&lt;/p>
&lt;p>这才是让你成为一名真正的 DevOps 工程师 (DevOps engineer) 的关键。&lt;/p></description></item><item><title>使用 Terraform、AWS 和 Python 构建无服务器实时数据管道</title><link>https://martinliu.cn/blog/building-a-serverless-real-time-data-pipeline-with-terraform-aws-and-python/</link><pubDate>Sat, 02 Aug 2025 15:42:33 +0800</pubDate><guid>https://martinliu.cn/blog/building-a-serverless-real-time-data-pipeline-with-terraform-aws-and-python/</guid><description>&lt;img src="https://martinliu.cn/blog/building-a-serverless-real-time-data-pipeline-with-terraform-aws-and-python/serverless-data-pipeline.webp" alt="Featured image of post 使用 Terraform、AWS 和 Python 构建无服务器实时数据管道" />&lt;p>最近，我一直在利用业余时间学习和试验 AWS 的数据服务，发现它们非常引人入胜。&lt;/p>
&lt;p>在本文中，我们将探讨我是如何利用 AWS 服务（如 Data Catalog、DataBrew 和 DynamoDB）构建一个实时无服务器数据管道的，以及如何借助 Terraform 将其无缝部署到 AWS。&lt;/p>
&lt;p>无论您是数据工程领域的新手还是经验丰富的专家，本指南都将为您提供帮助！&lt;/p>
&lt;h2 id="前提条件">前提条件
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://aws.amazon.com/" target="_blank" rel="noopener"
>AWS&lt;/a> 账户&lt;/li>
&lt;li>&lt;a class="link" href="https://www.python.org/downloads/" target="_blank" rel="noopener"
>Python&lt;/a> 3&lt;/li>
&lt;li>&lt;a class="link" href="https://developer.hashicorp.com/terraform/install" target="_blank" rel="noopener"
>Terraform&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="为什么选择-terraform">为什么选择 Terraform
&lt;/h2>&lt;ul>
&lt;li>开源&lt;/li>
&lt;li>庞大的开发者社区&lt;/li>
&lt;li>不可变基础设施 (Immutable Infrastructure)&lt;/li>
&lt;li>IaC (Infrastructure as Code)&lt;/li>
&lt;li>云无关性 (Cloud agnostic)&lt;/li>
&lt;li>旨在提升我对新技术的了解&lt;/li>
&lt;/ul>
&lt;h2 id="项目结构">项目结构
&lt;/h2>&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*eEvDjru5qOJc73wpcie1Hw.png"
loading="lazy"
alt="项目结构"
>&lt;/p>
&lt;h2 id="概述">概述
&lt;/h2>&lt;p>我即不是数据工程师，也没有在构建数据管道项目中；但是，我最近接触了一些数据服务。结合我对 AWS 的普遍了解，我决定亲手探索一些新服务。&lt;/p>
&lt;p>本文源于我将构建数据管道作为一个有趣的项目来实践的经验，我发现整个过程非常有趣且富有成效。&lt;/p>
&lt;h2 id="使用到的关键服务">使用到的关键服务
&lt;/h2>&lt;h3 id="1-amazon-s3">1. Amazon S3
&lt;/h3>&lt;ul>
&lt;li>作为数据存储层。&lt;/li>
&lt;li>存储了项目中使用的 JSON 文件&lt;/li>
&lt;/ul>
&lt;h3 id="2-amazon-dynamodb">2. Amazon DynamoDB
&lt;/h3>&lt;ul>
&lt;li>作为数据库层。&lt;/li>
&lt;li>使用 DynamoDB 流 (DynamoDB streams) 和 AWS Lambda 将 JSON 数据从 DynamoDB 导出到 S3&lt;/li>
&lt;/ul>
&lt;h3 id="3-aws-glue">3. AWS Glue
&lt;/h3>&lt;ul>
&lt;li>负责数据提取、转换和加载 (ETL - Extraction, Transformation, and Loading)。&lt;/li>
&lt;li>使用 Glue Data Catalog 管理数据集的元数据 (metadata)。&lt;/li>
&lt;li>它还支持使用爬网程序 (crawler) 进行爬网，该程序自动发现架构 (schema) 并创建表；然而，在这个项目中，我们手动定义了架构，因此不需要此功能。&lt;/li>
&lt;/ul>
&lt;h3 id="4-amazon-databrew">4. Amazon DataBrew
&lt;/h3>&lt;ul>
&lt;li>用于转换 S3 中存储的数据，方法是删除重复条目。&lt;/li>
&lt;li>一旦项目放置在 S3 存储桶的路径 &lt;code>/data&lt;/code> 中，它就会作为触发作业（来自 Lambda）运行。&lt;/li>
&lt;li>指向 Glue Data Catalog 作为输入数据集。&lt;/li>
&lt;/ul>
&lt;h3 id="5-amazon-athena">5. Amazon Athena
&lt;/h3>&lt;ul>
&lt;li>使用标准 SQL 查询存储在 Glue Catalog 中的转换数据。&lt;/li>
&lt;li>完全无服务器，并与 Glue Data Catalog 集成。&lt;/li>
&lt;/ul>
&lt;h2 id="最终架构">最终架构
&lt;/h2>&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*0v_rLNRcapex3MRovi_luA.png"
loading="lazy"
alt="数据管道架构"
>&lt;/p>
&lt;h2 id="架构解释">架构解释
&lt;/h2>&lt;h3 id="第一流程">第一流程
&lt;/h3>&lt;ul>
&lt;li>一个 &lt;em>.json&lt;/em> 文件被添加到 S3 上的路径 &lt;code>/data&lt;/code>&lt;/li>
&lt;li>第一个 Glue 数据目录表 (Glue Catalog Table) 从 S3 的 &lt;code>/data&lt;/code> 路径读取数据&lt;/li>
&lt;li>上传到 &lt;code>/data&lt;/code> 会触发一个 Lambda 函数，该函数启动 DataBrew 转换作业，通过移除 &lt;code>email&lt;/code> 列中的任何重复行来清理第一个 Glue 数据目录表（输入数据集）中的数据&lt;/li>
&lt;li>DataBrew 作业将转换后的数据输出到 S3 中的新路径 &lt;code>/cleaned&lt;/code> 下，覆盖该路径中的其他项目以避免输出路径中出现重复&lt;/li>
&lt;li>第二个 Glue 数据目录表从 S3 的 &lt;code>/cleaned&lt;/code> 路径读取数据&lt;/li>
&lt;li>Athena 工作组 (workgroup) 从第二个 Glue 数据目录表读取数据并对其运行查询。这反过来又将查询结果存储在 S3 中的新输出位置 &lt;code>/athena-results/&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="第二流程">第二流程
&lt;/h3>&lt;ul>
&lt;li>一条数据被添加到 DynamoDB。&lt;/li>
&lt;li>随着新数据的增加，DynamoDB 流 (stream) 被触发&lt;/li>
&lt;li>连接到 DynamoDB 流的 Lambda 函数（用 Python 编写）被调用，它将新项目转换为 &lt;em>.json&lt;/em> 文件&lt;/li>
&lt;li>执行第一个流程中的所有步骤&lt;/li>
&lt;/ul>
&lt;p>总而言之，实时数据处理的目标是通过 DynamoDB Streams 和 S3 存储桶通知 (S3 Bucket Notification) 与 Lambda 的集成来实现的。&lt;/p>
&lt;h2 id="代码定义">代码定义
&lt;/h2>&lt;h2 id="maintf">main.tf
&lt;/h2>&lt;p>提供商 (Provider)：第一步通常是定义提供商。这里我们将云提供商定义为 &lt;em>aws&lt;/em>。&lt;/p>
&lt;p>此外，我们还包含了将在项目中使用的各种模块 (module)，并传入所有必需的变量。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-terraform" data-lang="terraform">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">terraform&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">required_providers&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">aws&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;hashicorp/aws&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">version&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;~&amp;gt; 5.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">required_version&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&amp;gt;= 1.3.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-terraform" data-lang="terraform">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">provider&lt;/span> &lt;span class="s2">&amp;#34;aws&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">region&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;us-east-1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="nb">module&lt;/span> &lt;span class="s2">&amp;#34;s3_bucket&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;./modules/s3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">bucket_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;upload-bucket-data-pipeline-234&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="nb">module&lt;/span> &lt;span class="s2">&amp;#34;dynamodb_table&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;./modules/dynamodb&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">table_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;dynamodb-table&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="nb">module&lt;/span> &lt;span class="s2">&amp;#34;lambda_function&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;./modules/lambda&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">lambda_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;dynamodb_to_s3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">handler_trigger&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;dynamodb_to_s3_trigger.lambda_handler&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">s3_bucket&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">s3_bucket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">bucket_name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">table_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dynamodb_table&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">table_name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">dynamodb_stream_arn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dynamodb_table&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stream_arn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="nb">module&lt;/span> &lt;span class="s2">&amp;#34;glue_catalog&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;./modules/glue/glue_raw&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">database_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;catalog_db&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">table_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;catalog_json_table&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">s3_location&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;s3://&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nb">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">s3_bucket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">bucket_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">/data/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="nb">module&lt;/span> &lt;span class="s2">&amp;#34;databrew&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;./modules/databrew&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">glue_table&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">glue_catalog&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">table_name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">glue_db&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">glue_catalog&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">database_name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">s3_bucket_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">s3_bucket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">bucket_name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">data_zip&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">lambda_function&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">data_zip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="nb">module&lt;/span> &lt;span class="s2">&amp;#34;glue_catalog_cleaned&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;./modules/glue/glue_cleaned&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">database_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;catalog_cleaned_db&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">table_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;catalog_cleaned_json_table&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">s3_location&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;s3://&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nb">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">s3_bucket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">bucket_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">/cleaned/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="nb">module&lt;/span> &lt;span class="s2">&amp;#34;athena&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">source&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;./modules/athena&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">result_output_location&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;s3://&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nb">module&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">s3_bucket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">bucket_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">/athena-results/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="backendtf">backend.tf
&lt;/h2>&lt;p>首先，创建 S3 存储桶用于远程存储 Terraform 状态文件 (state file)，这有助于促进协作。&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*wNoK6qiZ3af-6HkhCDH48A.png"
loading="lazy"
alt="Terraform 状态文件所在的 S3 存储桶"
>&lt;/p>
&lt;p>创建后，将以下内容添加到 &lt;code>backend.tf&lt;/code> 文件中：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-terraform" data-lang="terraform">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">terraform&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">backend&lt;/span> &lt;span class="s2">&amp;#34;s3&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">bucket&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;serverless-data-pipeline-backend-bucket&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;serverless-pipeline/dev/terraform.tfstate&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">region&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;us-east-1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>一旦我们运行 &lt;code>terraform init&lt;/code> 和 &lt;code>terraform apply&lt;/code> 来部署项目，我们就应该看到状态存储在存储桶中，如下所示：&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*bJ3LTvt6vayJgGsRZsQc5A.png"
loading="lazy"
alt="S3 中的 Terraform 状态文件"
>&lt;/p>
&lt;ul>
&lt;li>module/main.tf : 每个服务的基础设施和配置都放置在各自的 &lt;code>main.tf&lt;/code> 文件中&lt;/li>
&lt;li>module/output.tf : 每个服务的输出详情 (output detail) 都放置在各自的 &lt;code>output.tf&lt;/code> 文件中&lt;/li>
&lt;li>module/variable.tf : 每个服务期望的输入变量 (input variables) 都放置在各自的 &lt;code>variable.tf&lt;/code> 文件中&lt;/li>
&lt;/ul>
&lt;h2 id="部署应用程序">部署应用程序
&lt;/h2>&lt;p>现在我们已准备好部署应用程序。运行以下命令进行部署。&lt;/p>
&lt;p>&lt;strong>Terraform init&lt;/strong>：这会初始化项目，拉取部署所需的所有必要软件包。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">terraform init
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Terraform plan&lt;/strong>：这会显示提议的更改，在部署前发现任何意外更改时非常有用。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">terraform plan
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>Terraform apply&lt;/strong>：这会将项目部署到 AWS。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">terraform apply
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="测试应用程序">测试应用程序
&lt;/h2>&lt;p>S3 存储桶 (S3 bucket) 最初加载了一个 &lt;code>sample.json&lt;/code> 文件，其内容如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;John Doe&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;email&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;john@example.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2025-04-19T12:00:00Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Mary Doe&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;email&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;mary@example.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2025-06-20T12:00:00Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Jane Doe&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;email&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;john@example.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timestamp&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2025-06-22T12:00:00Z&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;em>注：&lt;/em> 如您所见，我们有一个重复的电子邮件地址 &lt;code>*john@example.com*&lt;/code>，理想的结果是移除这个重复条目。&lt;/p>
&lt;p>这个文件是在使用 Terraform 创建存储桶后立即上传的，因此它不会触发 DataBrew 作业，因为该触发器设置是在项目的后期才进行的。&lt;/p>
&lt;p>为了测试实时功能 (Real-time feature) 和项目的完整流程，我们可以向 S3 上传新对象，或向 DynamoDB 添加新条目。我们将向 DynamoDB 添加一个新条目来测试完整流程：&lt;/p>
&lt;p>通过 AWS 控制台 (console) 进入 DynamoDB，并添加一条新数据：&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Wq6-HKR3_Itogo9ncr3C-Q.png"
loading="lazy"
>&lt;/p>
&lt;p>添加此条目将触发 DynamoDB 流 (stream)，它会使用关联的 Lambda 函数 (lambda function) 将新对象插入 S3。&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*HEIxp2piYd2b9y5pxqV2xA.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*MGNKOjFIP0mJQ4DDgG8Agw.png"
loading="lazy"
>&lt;/p>
&lt;p>前往 S3，我们看到新条目 &lt;code>7.json&lt;/code> 已添加：&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*dhhBJ1oL-3OSa9JHP832oA.png"
loading="lazy"
>&lt;/p>
&lt;p>接下来，前往数据目录 (Data Catalog)，我们看到数据库 (Databases) 和表 (Tables)。&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*XFt97o-Egelq4T-PdDUQmA.png"
loading="lazy"
>&lt;/p>
&lt;p>数据目录数据库&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*V1EV7KY8iSVvMgeGIX4Fsw.png"
loading="lazy"
>&lt;/p>
&lt;p>数据目录表&lt;/p>
&lt;p>前往 DataBrew，我们看到该项目。&lt;/p>
&lt;p>一旦 Lambda 函数被添加到 &lt;code>/data&lt;/code> 路径的新内容触发，它就会启动 DataBrew 转换作业 (transformation job)：&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*YeJ5a_JzUjWoD8vD9-4n-A.png"
loading="lazy"
>&lt;/p>
&lt;p>完成后，它看起来像这样：&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*GZNvEGrYWP4Wom1VKMAwBQ.png"
loading="lazy"
>&lt;/p>
&lt;p>已完成的 DataBrew 作业&lt;/p>
&lt;p>DataBrew 数据血缘 (Data lineage) 允许我们查看使用 DataBrew 的流程的图形化表示。&lt;/p>
&lt;p>&lt;strong>空闲作业&lt;/strong>：&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*arMXfxrhANbnvXymY8ejBg.png"
loading="lazy"
alt="空闲作业的数据血缘"
>&lt;/p>
&lt;p>&lt;strong>运行中作业&lt;/strong>：&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*CgVAhqi82C2tZcIRpCtz6A.png"
loading="lazy"
alt="数据血缘的作业运行中"
>&lt;/p>
&lt;p>最后，前往 Athena，并选择 &lt;code>my-athena-workgroup&lt;/code> 工作组 (workgroup) 来运行查询。&lt;/p>
&lt;p>在 DataBrew 作业运行之前，如果我们使用 Athena 运行查询，将不会有任何结果，因为 &lt;code>/cleaned&lt;/code> 路径中还没有任何项目：&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*8K6f2X_uNLtstmSxZu1q9g.png"
loading="lazy"
>&lt;/p>
&lt;p>然而，在 DataBrew 作业成功运行后，我们点击 &lt;em>&lt;strong>Run again&lt;/strong>&lt;/em> 按钮以在 Athena 中重新运行查询：&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*NDVMRuZ4Kh5GdTGIIkcHnQ.png"
loading="lazy"
>&lt;/p>
&lt;p>结果如下：&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*kjeCuYwKZMO-2RJJgpd0Dw.png"
loading="lazy"
>&lt;/p>
&lt;p>如果你仔细观察，会发现它移除了在项目创建时上传到 S3 的 &lt;code>sample.json&lt;/code> 文件中发现的邮箱为 &lt;code>john@example.com&lt;/code> 的重复条目。&lt;/p>
&lt;p>它还添加了邮箱为 &lt;code>mathew@gmail.com&lt;/code> 的新的 DynamoDB 条目。&lt;/p>
&lt;p>这意味着我们的管道按预期工作！！&lt;/p>
&lt;h2 id="通过-dynamodb-添加重复条目">通过 DynamoDB 添加重复条目
&lt;/h2>&lt;p>让我们通过向 DynamoDB 添加一个新条目来进一步测试，但这次它的邮箱将与我们现有的记录匹配。&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*bWxYzQotL_N0JyVhsCzpTA.png"
loading="lazy"
>&lt;/p>
&lt;p>我们添加了一个邮箱为 &lt;code>mathew@gmail.com&lt;/code> 的新冲突条目&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*C0iTx5McyVuu5836kCQ2-Q.png"
loading="lazy"
>&lt;/p>
&lt;p>这将触发一个新的 DataBrew 作业 (Job)：&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Rz50Z-SHv_PHcq1UUcKIgg.png"
loading="lazy"
>&lt;/p>
&lt;p>一旦成功了，我们会看到下图：&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*iKPaL44m6-cWhAfAW1gTJg.png"
loading="lazy"
>&lt;/p>
&lt;p>接下来，前往 Athena 再次运行查询，这次它不再包含重复记录了！&lt;/p>
&lt;p>&lt;img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Er8Fx7_rGw4IFALgSGq6ag.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="结论">结论
&lt;/h2>&lt;p>我创建这个项目和文章是为了提高我在 Terraform 方面的技能，并亲自动手实践数据工程领域，同时磨练我的 Python 技能。&lt;/p>
&lt;p>你可以在 &lt;a class="link" href="https://github.com/chyke007/serverless-data-pipeline" target="_blank" rel="noopener"
>这里&lt;/a> 找到完整的源代码。&lt;/p>
&lt;p>我希望这篇文章能帮助你对在 AWS 中构建数据工程项目更有信心。我很高兴看到你将创造出什么！&lt;/p>
&lt;p>全栈开发人员、技术作家和 Jamstack 爱好者。热爱终身学习。&lt;/p></description></item><item><title>Docker、Jenkins、Prometheus，本地能跑？！这套技术栈你需要搞定</title><link>https://martinliu.cn/blog/docker-jenkins-prometheus-locally-heres-the-stack/</link><pubDate>Mon, 28 Jul 2025 17:58:33 +0800</pubDate><guid>https://martinliu.cn/blog/docker-jenkins-prometheus-locally-heres-the-stack/</guid><description>&lt;img src="https://martinliu.cn/blog/docker-jenkins-prometheus-locally-heres-the-stack/1_izxF5LhLRecc_epDuvJmhg.webp" alt="Featured image of post Docker、Jenkins、Prometheus，本地能跑？！这套技术栈你需要搞定" />&lt;h2 id="-tldr--一套真正可用的本地-devops-技术栈">✨ TL;DR — 一套真正可用的本地 DevOps 技术栈
&lt;/h2>&lt;p>&lt;strong>问题&lt;/strong>：云端 DevOps 费用高、迭代慢，还难调试。&lt;br>
&lt;strong>解决方案&lt;/strong>：用 Docker Compose 跑起来的一套完整 DevOps 技术栈，全部本地化。&lt;/p>
&lt;h2 id="核心组件包括">核心组件包括：
&lt;/h2>&lt;ul>
&lt;li>Jenkins（CI/CD）&lt;/li>
&lt;li>Prometheus + Grafana（监控）&lt;/li>
&lt;li>Loki + Promtail（日志聚合）&lt;/li>
&lt;li>NGINX / Traefik（反向代理）&lt;/li>
&lt;li>Mailhog（邮件测试）&lt;/li>
&lt;li>Postgres + Redis（辅助服务）&lt;/li>
&lt;/ul>
&lt;h2 id="我的经验总结">我的经验总结：
&lt;/h2>&lt;ul>
&lt;li>从小起步，逐步扩展。&lt;/li>
&lt;li>固定版本，避免意外变更。&lt;/li>
&lt;li>健康检查能救命。&lt;/li>
&lt;li>Docker Compose 胜过过早引入 Kubernetes。&lt;/li>
&lt;li>养成写“技术栈日志”的习惯。&lt;/li>
&lt;/ul>
&lt;p>我的需求其实很简单。&lt;/p>
&lt;p>我只想要一个稳的 CI 流水线、一套能看懂的监控指标，以及在部署前能本地测试全部功能的方式，不必再为云服务花冤枉钱。&lt;/p>
&lt;p>结果呢？Jenkins 启动就挂，Prometheus 抓不到数据，Docker Compose 日志铺天盖地像在写小说。&lt;/p>
&lt;p>我差点放弃。但在无数次试错、两次烧坏电脑，还有通宵翻遍 DevOps 博客之后，我终于搞出了一套真的能用的本地环境。&lt;/p>
&lt;p>&lt;strong>不用 Kubernetes。不付 AWS 账单。没有凌晨四点的 Slack 报警。&lt;/strong>&lt;/p>
&lt;p>这不是教程，而是我自己打磨出来的生存指南，你完全可以照着用。🤝&lt;/p>
&lt;h2 id="什么才是-devops-技术栈本地而非理论">什么才是 DevOps 技术栈（本地，而非理论）
&lt;/h2>&lt;p>提到 DevOps，大多数人想到的是云原生架构、Kubernetes 自动扩容集群，还有那种比房租还贵的精美仪表盘。但如果你是独立开发者、在搞实验，或只是想学习而不影响线上环境，&lt;strong>你需要的，是能直接在自己电脑上跑的东西。&lt;/strong>&lt;/p>
&lt;p>对我来说，一个“本地优先”的 DevOps 技术栈应该包含：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Docker：&lt;/strong> 容器的基础设施。所有服务都运行在容器里，包括 Jenkins 和 Prometheus。&lt;/li>
&lt;li>&lt;strong>Jenkins：&lt;/strong> 仍然是最灵活的 CI/CD 引擎。虽说有点老派，但用得好依然顶用。&lt;/li>
&lt;li>&lt;strong>Prometheus + Grafana：&lt;/strong> 用于采集与可视化监控指标。Prometheus 负责抓，Grafana 负责看。&lt;/li>
&lt;li>&lt;strong>Loki：&lt;/strong> 日志聚合利器。因为容器一多，&lt;code>docker logs&lt;/code> 根本不够用。&lt;/li>
&lt;li>&lt;strong>NGINX 或 Traefik：&lt;/strong> 做反向代理，把多个服务统一映射到本地域名下。&lt;/li>
&lt;li>&lt;strong>Mailhog / Redis / Postgres：&lt;/strong> 可选组件，用于测试邮件、缓存或数据库相关功能。&lt;/li>
&lt;/ul>
&lt;p>这就是基础配置。没有 AWS，没有 GCP，也不用托管的 EKS。只有 &lt;strong>容器、端口，以及偶尔崩溃的终端窗口&lt;/strong>。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/docker-jenkins-prometheus-locally-heres-the-stack/1_izxF5LhLRecc_epDuvJmhg.webp"
width="1536"
height="1024"
srcset="https://martinliu.cn/blog/docker-jenkins-prometheus-locally-heres-the-stack/1_izxF5LhLRecc_epDuvJmhg_hu_a1da576b3cf30d7e.webp 480w, https://martinliu.cn/blog/docker-jenkins-prometheus-locally-heres-the-stack/1_izxF5LhLRecc_epDuvJmhg_hu_601f3c02d55a9d91.webp 1024w"
loading="lazy"
alt="devops stack"
class="gallery-image"
data-flex-grow="150"
data-flex-basis="360px"
>&lt;/p>
&lt;h2 id="让我豁然开朗的-docker-composeyml-配置">让我豁然开朗的 docker-compose.yml 配置
&lt;/h2>&lt;p>谈本地 DevOps，绕不开 &lt;code>docker-compose.yml&lt;/code>。它是整个系统的指挥中枢，决定了你是轻松一键部署，还是陷入无尽的手动操作噩梦。&lt;/p>
&lt;p>下面是我用的一个简化版本配置：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;3.8&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">jenkins&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">jenkins/jenkins:lts-jdk17&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;8080:8080&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">jenkins_home:/var/jenkins_home&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">prometheus&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">prom/prometheus&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;9090:9090&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">./prometheus.yml:/etc/prometheus/prometheus.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">grafana&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">grafana/grafana&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;3000:3000&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">grafana_data:/var/lib/grafana&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">loki&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">grafana/loki:2.9.0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;3100:3100&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>-&lt;span class="l">config.file=/etc/loki/local-config.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">nginx&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx:stable&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;80:80&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">./nginx.conf:/etc/nginx/nginx.conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mailhog&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mailhog/mailhog&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;8025:8025&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;1025:1025&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">redis&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;6379:6379&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">postgres&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">postgres:14&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;5432:5432&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">POSTGRES_USER&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dev&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">POSTGRES_PASSWORD&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dev&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">POSTGRES_DB&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">app_db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">pgdata:/var/lib/postgresql/data&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">jenkins_home&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">grafana_data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">pgdata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="让我少走弯路的配置笔记">让我少走弯路的配置笔记
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>分离 &lt;code>.env&lt;/code> 文件&lt;/strong>：不要在配置中硬编码密钥或端口。&lt;/li>
&lt;li>&lt;strong>挂载配置文件&lt;/strong>：Prometheus 和 NGINX 的配置最好通过挂载方式管理，方便随时调整。&lt;/li>
&lt;li>&lt;strong>状态服务使用数据卷&lt;/strong>：Jenkins、Grafana、Postgres 等需要持久化的服务应该使用数据卷。&lt;/li>
&lt;li>&lt;strong>尽量避免使用 &lt;code>depends_on&lt;/code>&lt;/strong>：它不会真正等待服务就绪。建议用 &lt;code>restart: unless-stopped&lt;/code> 配合健康检查来提升稳定性。&lt;/li>
&lt;/ul>
&lt;p>这套配置让我可以放心地搭建和试验。每个服务都在容器里运行，出问题直接重建，简单又高效。&lt;/p>
&lt;h2 id="我的本地-devops-文件结构也就是理智的来源">我的本地 DevOps 文件结构（也就是理智的来源）
&lt;/h2>&lt;p>尝试了多个混乱结构之后，我最终找到了这样一套清晰、模块化的目录布局，让调试更高效。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">/devops-stack
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── docker-compose.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── .env
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── prometheus/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── prometheus.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── grafana/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── provisioning/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── datasources/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── dashboards/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── loki/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── local-config.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── nginx/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── nginx.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── jenkins/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── jobs/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── sample-job.groovy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── volumes/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── grafana/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── jenkins/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── postgres/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── logs/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── stack.log
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="为什么这套结构有效">为什么这套结构有效？
&lt;/h2>&lt;ul>
&lt;li>🔹 prometheus/ 自定义抓取配置都放在这里。我用 Git 做版本管理，便于追踪每次修改。&lt;/li>
&lt;li>🔹 grafana/provisioning/ 通过这个目录预配置仪表盘和数据源，重建容器时无需手动重复设置。&lt;/li>
&lt;li>🔹 loki/ Loki 的 &lt;code>local-config.yaml&lt;/code> 存放位置。如果你聚合多个容器日志，这个配置经常需要调整。&lt;/li>
&lt;li>🔹 nginx/ 将代理配置从项目根目录独立出来，便于快速热更新和测试路由变更。&lt;/li>
&lt;li>🔹 jenkins/jobs/ 用于保存流水线定义、Groovy 脚本或种子任务，比每次在 Jenkins UI 操作方便得多。&lt;/li>
&lt;li>🔹 volumes/ 可选目录，用于挂载持久化数据。无需深入 Docker 内部也能查看状态数据。&lt;/li>
&lt;li>🔹 logs/ 集中存放容器日志或自定义输出，调试更高效。特别是在 Promtail 表现不稳定时很有用。&lt;/li>
&lt;/ul>
&lt;h2 id="如果重来一次我会这样做">如果重来一次，我会这样做：
&lt;/h2>&lt;h3 id="1-不要从-jenkins-起步">1. 不要从 Jenkins 起步
&lt;/h3>&lt;p>Jenkins 虽然强大，但太笨重。如果你只是想学习 CI/CD，建议先从 GitHub Actions（可通过 &lt;a class="link" href="https://github.com/nektos/act" target="_blank" rel="noopener"
>act&lt;/a> 本地运行）或 Drone CI 开始。Jenkins 附带插件多、配置烦人，还有那些让人头大的 XML 配置文件（Extensible Markup Language）。&lt;/p>
&lt;h3 id="2-不要过度设计监控">2. 不要过度设计监控
&lt;/h3>&lt;p>就算你是为了跑个博客，也没必要一开始就上 Prometheus + Grafana + Loki + Tempo。先用简单的日志输出（&lt;code>docker logs&lt;/code>，或者加个 Mailhog）起步，有需要时再慢慢加监控。&lt;/p>
&lt;h3 id="3-坚持用-docker-compose">3. 坚持用 Docker Compose
&lt;/h3>&lt;p>我曾花了好几天尝试 Minikube、Kind 和 Kubernetes，结果发现其实一个靠谱的 &lt;code>docker-compose.yml&lt;/code> 足以应付本地需求。除非你要部署到云上或准备考 Kubernetes 认证，不然 &lt;strong>K8s 只会拖慢你的前期学习节奏&lt;/strong>。&lt;/p>
&lt;h3 id="4-保持技术栈日志">4. 保持“技术栈日志”
&lt;/h3>&lt;p>每次出错或修好 bug，我都会记一笔。这份日志成了我的生存手册，也成了这篇文章的基础。强烈推荐你也开始记录，真的有用。&lt;/p>
&lt;h2 id="复制即用最简本地-devops-技术栈">复制即用：最简本地 DevOps 技术栈
&lt;/h2>&lt;p>如果你读到这里心想“我就想马上试一把”，下面就是你需要的——一套&lt;strong>最小可行的 DevOps 技术栈&lt;/strong>：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mkdir devops-mini &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> devops-mini
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">touch docker-compose.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>编辑 &lt;em>docker-compose.yml&lt;/em> 文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;3.8&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">jenkins&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">jenkins/jenkins:lts-jdk17&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;8080:8080&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">jenkins_home:/var/jenkins_home&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">grafana&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">grafana/grafana&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;3000:3000&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">jenkins_home&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>启动本地技术栈。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker compose up -d
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>搞定了。CI + 监控，完全本地，不靠云。&lt;/p>
&lt;p>等你准备好折腾时，再加上 Postgres、Redis、Loki、Prometheus 或 NGINX。&lt;br>
放心，总会出点问题。&lt;/p>
&lt;h2 id="收尾搭建它搞崩它掌握它">收尾：搭建它，搞崩它，掌握它
&lt;/h2>&lt;p>搭一套本地 DevOps 技术栈并不轻松、不优雅，更不会很快。&lt;/p>
&lt;p>但这个过程教会我的，比任何云服务仪表盘或 YouTube 教程都更接近真实世界。&lt;/p>
&lt;p>当你亲手跑 Jenkins、从头配置 Grafana 仪表盘、或者搞清楚容器间为什么无法通信时，&lt;br>
&lt;strong>你就不再只是执行脚本的人，而是真的开始具备系统工程师的思维了。&lt;/strong>&lt;/p>
&lt;p>所以，如果你还在等 CI 部署完成，或厌倦了在黑盒云服务里调 bug……&lt;/p>
&lt;p>🔥 &lt;strong>自己动手搭一套。搞崩它。修复它。大胆去学。&lt;/strong>&lt;/p>
&lt;p>如果这篇文章哪怕帮到你一点点， &lt;strong>点个赞、写评论、转发一下。&lt;/strong> 让更多开发者不再害怕从零搭建基础架构。&lt;/p>
&lt;blockquote>
&lt;p>source: Medium - Level Up Coding&lt;/p>&lt;/blockquote></description></item><item><title>如何寻找占用空间最大的容器，并删除它所使用的卷，释放占用的空间？</title><link>https://martinliu.cn/blog/identify-clean-up-large-docker-containers-volumes/</link><pubDate>Wed, 13 Nov 2024 22:44:45 +0800</pubDate><guid>https://martinliu.cn/blog/identify-clean-up-large-docker-containers-volumes/</guid><description>&lt;img src="https://martinliu.cn/blog/identify-clean-up-large-docker-containers-volumes/91625BFA-9860-451D-B947-558D4B63D207.webp" alt="Featured image of post 如何寻找占用空间最大的容器，并删除它所使用的卷，释放占用的空间？" />&lt;p>在 Docker 环境中，容器和卷的空间占用可能会随着时间的推移而增长，导致磁盘空间不足。本文将介绍如何寻找占用空间最大的容器，并删除它们使用的卷，以释放磁盘空间。&lt;/p>
&lt;p>在 Azure 的环境中，我使用了 Portainer 来管理这个服务器上的所有容器。Portainer 在发生某种未知的故障后，在一段时间中产生了大量的错误日志，导致它所占用的数据卷空间暴涨，以至于沾满了所有可用磁盘空间，最后整个服务器上的所有其他容器都不工作了。&lt;/p>
&lt;p>下面是解决这个运维故障的过程中的一些笔记，希望对读者有所帮助。&lt;/p>
&lt;h2 id="1-查找占用空间最大的容器">1. 查找占用空间最大的容器
&lt;/h2>&lt;h3 id="查看容器日志文件的大小">&lt;strong>查看容器日志文件的大小&lt;/strong>
&lt;/h3>&lt;p>容器的日志文件通常会占用大量磁盘空间。可以通过以下命令查找 Docker 容器日志文件的大小：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">find /var/lib/docker/containers/ -type f -name &lt;span class="s2">&amp;#34;*.log&amp;#34;&lt;/span> -exec du -h &lt;span class="o">{}&lt;/span> + &lt;span class="p">|&lt;/span> sort -hr &lt;span class="p">|&lt;/span> head -n &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>该命令会列出所有容器日志文件的大小，并按从大到小排序。你可以通过查看输出结果，找出占用空间最大的容器日志文件。&lt;/p>
&lt;h3 id="查看容器的挂载数据大小">&lt;strong>查看容器的挂载数据大小&lt;/strong>
&lt;/h3>&lt;p>除了日志文件，容器的挂载数据（例如文件系统层）也可能占用大量空间。要查看某个容器的挂载数据大小，可以使用以下命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker ps -a --size
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>该命令将列出所有容器及其占用的磁盘空间。通过 &lt;code>SIZE&lt;/code> 列，你可以查看每个容器的磁盘使用情况，并根据需要找出占用空间最大的容器。&lt;/p>
&lt;h2 id="2-停止并删除容器">2. 停止并删除容器
&lt;/h2>&lt;p>找到占用空间大的容器后，下一步是停止并删除它。&lt;/p>
&lt;h3 id="停止容器">&lt;strong>停止容器&lt;/strong>
&lt;/h3>&lt;p>首先，停止正在运行的容器：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker stop &amp;lt;container-id_or_name&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="删除容器">&lt;strong>删除容器&lt;/strong>
&lt;/h3>&lt;p>容器停止后，可以通过以下命令删除容器：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker rm &amp;lt;container-id_or_name&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="3-删除容器使用的卷">3. 删除容器使用的卷
&lt;/h2>&lt;p>容器删除后，挂载的卷可能依然存在并占用磁盘空间。要删除容器使用的卷，请按照以下步骤操作：&lt;/p>
&lt;h3 id="查看容器使用的卷">&lt;strong>查看容器使用的卷&lt;/strong>
&lt;/h3>&lt;p>你可以使用以下命令查看容器使用的卷：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker inspect &amp;lt;container-id_or_name&amp;gt; &lt;span class="p">|&lt;/span> grep Mounts -A &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这将输出容器的挂载信息，包括挂载的卷。你可以根据输出的信息找出容器使用的卷。&lt;/p>
&lt;h3 id="删除卷">&lt;strong>删除卷&lt;/strong>
&lt;/h3>&lt;p>如果确定不再需要该卷，可以删除它：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker volume rm &amp;lt;volume-name&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果不确定卷是否仍然被其他容器使用，可以先列出所有卷并检查未使用的卷：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker volume ls
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="删除所有未使用的卷">&lt;strong>删除所有未使用的卷&lt;/strong>
&lt;/h3>&lt;p>如果你想删除所有没有挂载到容器的卷，可以使用以下命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker volume prune
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>该命令将删除所有未挂载的卷，释放磁盘空间。&lt;/p>
&lt;h2 id="4-释放卷占用的空间">4. 释放卷占用的空间
&lt;/h2>&lt;p>如果某个卷占用了大量空间（例如 &lt;code>portainer_data&lt;/code> 卷占用了 54G 空间），可以先检查卷的内容，并根据需要删除不必要的数据。&lt;/p>
&lt;h3 id="检查卷的内容">&lt;strong>检查卷的内容&lt;/strong>
&lt;/h3>&lt;p>可以进入卷的 &lt;code>_data&lt;/code> 目录查看它的内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ls -l /var/lib/docker/volumes/portainer_data/_data
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="删除卷中的数据">&lt;strong>删除卷中的数据&lt;/strong>
&lt;/h3>&lt;p>如果确认不再需要卷中的数据，可以删除这些数据：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">rm -rf /var/lib/docker/volumes/portainer_data/_data/*
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这将删除卷中的所有数据。&lt;/p>
&lt;h3 id="删除卷-1">&lt;strong>删除卷&lt;/strong>
&lt;/h3>&lt;p>数据删除后，可以删除整个卷：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker volume rm portainer_data
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果你不再需要该卷，删除它将释放空间。&lt;/p>
&lt;h2 id="5-自动清理-docker-系统资源">5. 自动清理 Docker 系统资源
&lt;/h2>&lt;p>为了避免未来容器和卷占用过多磁盘空间，可以定期清理 Docker 的未使用资源。你可以使用 &lt;code>docker system prune&lt;/code> 命令来删除所有未使用的容器、镜像、网络和卷。&lt;/p>
&lt;h3 id="清理所有未使用的资源">&lt;strong>清理所有未使用的资源&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker system prune -a --volumes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>-a&lt;/code> 参数表示删除所有未使用的镜像。&lt;/li>
&lt;li>&lt;code>--volumes&lt;/code> 参数表示删除所有未挂载的卷。&lt;/li>
&lt;/ul>
&lt;p>此命令会清理 Docker 系统中的所有不再使用的资源，释放磁盘空间。&lt;/p>
&lt;h2 id="6-检查释放后的空间">6. 检查释放后的空间
&lt;/h2>&lt;p>完成清理操作后，可以通过以下命令检查卷是否已经释放空间：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">du -sh /var/lib/docker/volumes/portainer_data
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果卷中的数据已被删除，空间占用应当会显著减少。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;ol>
&lt;li>&lt;strong>查找占用空间大的容器：&lt;/strong>
&lt;ul>
&lt;li>查看容器日志文件和挂载数据的大小。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>停止并删除容器：&lt;/strong>
&lt;ul>
&lt;li>使用 &lt;code>docker stop&lt;/code> 和 &lt;code>docker rm&lt;/code> 停止并删除容器。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>删除容器使用的卷：&lt;/strong>
&lt;ul>
&lt;li>使用 &lt;code>docker volume rm&lt;/code> 删除不再需要的卷。&lt;/li>
&lt;li>使用 &lt;code>docker volume prune&lt;/code> 清理未使用的卷。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>释放卷占用的空间：&lt;/strong>
&lt;ul>
&lt;li>删除卷中的数据，或者删除整个卷。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>定期清理 Docker 系统资源：&lt;/strong>
&lt;ul>
&lt;li>使用 &lt;code>docker system prune -a --volumes&lt;/code> 清理所有未使用的资源。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>通过这些操作，你可以有效地管理 Docker 容器和卷，确保磁盘空间不会被占用过多，保持系统的清洁和高效。&lt;/p>
&lt;h2 id="参考">参考
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://docs.docker.com/" target="_blank" rel="noopener"
>Docker Documentation&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://docs.docker.com/engine/reference/commandline/cli/" target="_blank" rel="noopener"
>Docker CLI Reference&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>《DORA 2024年 加速：DevOps 现状报告》概述</title><link>https://martinliu.cn/blog/state-of-devops-2024-summary/</link><pubDate>Sun, 27 Oct 2024 15:43:33 +0800</pubDate><guid>https://martinliu.cn/blog/state-of-devops-2024-summary/</guid><description>&lt;img src="https://martinliu.cn/blog/state-of-devops-2024-summary/state_of_dora_2024.max-2500x2500.webp" alt="Featured image of post 《DORA 2024年 加速：DevOps 现状报告》概述" />&lt;blockquote>
&lt;p>作者 Nathen Harvey （DORA Lead），Derek DeBellis （DORA 研究项目负责人）&lt;/p>&lt;/blockquote>
&lt;p>&lt;strong>&lt;a class="link" href="https://martinliu.cn/blog/state-of-devops-2024-zh-cn/" >下载中文版报告 PDF 文件&lt;/a>&lt;/strong>&lt;/p>
&lt;p>DORA 研究项目已经对高绩效技术团队和组织的能力、实践和度量标准进行了长达十多年的研究。该项目基于每年对技术人员（包括软件开发人员、管理者和高管）的调查数据发布报告。&lt;/p>
&lt;p>今天，我们正式发布《2024 年 加速：DevOps 现状报告》，标志着 DORA 已经在高绩效技术团队和组织的研究领域持续了十年。DORA 在 2013 年提出的四项关键指标已成为衡量软件交付绩效的行业标准。&lt;/p>
&lt;p>每年，我们都深入研究 DORA 标准绩效指标，并探索它们如何与个人、工作流、团队和产品绩效相互作用。今年，我们还新增了 AI 采用在各个层面上对软件开发影响的分析。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/state-of-devops-2024-summary/1_CY0uOJ4.max-800x800.webp"
width="770"
height="389"
srcset="https://martinliu.cn/blog/state-of-devops-2024-summary/1_CY0uOJ4.max-800x800_hu_144d6ed67f572db6.webp 480w, https://martinliu.cn/blog/state-of-devops-2024-summary/1_CY0uOJ4.max-800x800_hu_54e34326ba373640.webp 1024w"
loading="lazy"
alt="度量软件交付效能"
class="gallery-image"
data-flex-grow="197"
data-flex-basis="475px"
>&lt;/p>
&lt;p>我们每年设立基准，帮助团队了解他们相对于同行的表现，并激励他们认识到每个行业都可以实现卓越的表现。DORA 过去十年的研究旨在帮助团队不断提升自身的能力，力求每年改进都能取得更大进展。&lt;/p>
&lt;p>如果想快速了解今年的报告内容，可以阅读我们的 DORA 报告摘要，聚焦于技术采用趋势、AI 的影响、平台工程的兴起，以及开发者体验的重要性。&lt;/p>
&lt;p>各行业的组织都在优先考虑将 AI 集成到应用和服务中。开发人员越来越依赖 AI 提高工作效率，并更好地履行其核心职责。今年的研究揭示了 AI 采用带来的复杂利弊和权衡。&lt;/p>
&lt;p>报告强调平台工程需要慎重实施，并指出开发者体验在实现高绩效中的关键作用。&lt;/p>
&lt;h3 id="ai-的优势挑战与信任建设">AI 的优势、挑战与信任建设
&lt;/h3>&lt;p>AI 的广泛应用正在改变软件开发方式。超过 75% 的受访者表示，他们在日常工作中至少有一个职责依赖于 AI。最常见的使用场景包括代码编写、信息总结和代码解释。&lt;/p>
&lt;p>报告显示，AI 有效地提升了开发人员的生产力。超过三分之一的受访者表示，AI 为他们带来了“中等”到“极大”的生产力提升。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/state-of-devops-2024-summary/2_wccUD78.max-1300x1300.webp"
width="1275"
height="768"
srcset="https://martinliu.cn/blog/state-of-devops-2024-summary/2_wccUD78.max-1300x1300_hu_c48b37e9862abe39.webp 480w, https://martinliu.cn/blog/state-of-devops-2024-summary/2_wccUD78.max-1300x1300_hu_857df10a336eea69.webp 1024w"
loading="lazy"
alt="AI 任务渗透率"
class="gallery-image"
data-flex-grow="166"
data-flex-basis="398px"
>&lt;/p>
&lt;p>AI 采用率提升 25% 带来了几个关键领域的改进：&lt;/p>
&lt;ul>
&lt;li>文档质量提升 7.5%&lt;/li>
&lt;li>代码质量提升 3.4%&lt;/li>
&lt;li>代码审查速度提升 3.1%&lt;/li>
&lt;/ul>
&lt;p>然而，尽管 AI 有其优势，我们的研究也发现了一个重要问题：AI 采用可能对软件交付绩效产生负面影响。随着 AI 应用的增加，软件交付吞吐量估计下降了 1.5%，交付稳定性下降了 7.2%。我们的数据显示，仅改进开发流程并不足以自动提升交付绩效，尤其是在没有遵循如小批量处理和完善测试机制等基本原则的情况下。虽然 AI 对个人和组织的多个方面有积极影响，为高软件交付绩效创造了条件，但它并非万能的解决方案。&lt;/p>
&lt;p>此外，尽管生产力有所提升，39% 的受访者对 AI 生成的代码仍缺乏信任。这一低信任度表明，AI 的集成需要更加谨慎的管理。团队必须仔细评估 AI 在开发流程中的作用，以减轻潜在的负面影响。&lt;/p>
&lt;p>基于以上发现，我们提出三项核心建议：&lt;/p>
&lt;ol>
&lt;li>通过调整 AI 采用策略，使其更好地赋能员工，减少繁琐任务，从而提升员工的工作效率。&lt;/li>
&lt;li>制定明确的 AI 使用规范，解决相关程序问题，并鼓励就其影响进行公开讨论。&lt;/li>
&lt;li>鼓励团队持续探索 AI 工具，并提供实验时间，以通过实际操作建立信任感。&lt;/li>
&lt;/ol>
&lt;h3 id="平台工程新的转变">平台工程：新的转变
&lt;/h3>&lt;p>我们今年研究的另一个新兴领域是平台工程，专注于搭建和运营内部开发平台，以优化流程并提升效率。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/state-of-devops-2024-summary/3_ou7kqZc.max-2000x2000.webp"
width="1999"
height="1204"
srcset="https://martinliu.cn/blog/state-of-devops-2024-summary/3_ou7kqZc.max-2000x2000_hu_c4462adb9e2d0e19.webp 480w, https://martinliu.cn/blog/state-of-devops-2024-summary/3_ou7kqZc.max-2000x2000_hu_36b4b39a1af479c3.webp 1024w"
loading="lazy"
alt="平台寿命"
class="gallery-image"
data-flex-grow="166"
data-flex-basis="398px"
>&lt;/p>
&lt;p>我们的研究总结了平台工程的 4 个关键发现：&lt;/p>
&lt;ul>
&lt;li>提升开发人员效率：内部开发平台能够有效提升开发人员的生产力。&lt;/li>
&lt;li>更常见于大型企业：这些平台通常在大型组织中使用，表明它们更适合应对复杂的开发环境。&lt;/li>
&lt;li>可能出现的性能下滑：在平台工程计划实施初期，性能可能会有所下降，直至平台逐渐成熟后才能显现出改进效果。&lt;/li>
&lt;li>强调用户导向和开发人员自主性：为了达到最佳效果，平台工程应优先考虑用户导向的设计、开发人员的独立性，以及产品导向的方法。&lt;/li>
&lt;/ul>
&lt;p>一个重视用户需求、赋能开发人员、并能预见潜在挑战的周全策略，是最大化平台工程计划收益的关键。&lt;/p>
&lt;h3 id="开发者体验成功的关键">开发者体验：成功的关键
&lt;/h3>&lt;p>去年报告中指出，健康的工作文化有助于减少倦怠、提升生产力和提高工作满意度。今年的研究结果依然如此。那些营造稳定、支持性环境并激励开发者发挥潜力的团队，往往能够取得显著的积极成果。&lt;/p>
&lt;p>“快速行动、频繁调整”的心态会对开发者的身心健康产生负面影响，进而影响整体绩效。即便拥有强有力的领导、完善的文档以及用户导向的开发方式，若优先级不稳定，仍然可能显著阻碍团队的进展。&lt;/p>
&lt;p>创造一个支持、重视团队，并让开发者有机会展现自身价值的工作环境，是实现卓越绩效的基础。&lt;/p>
&lt;h3 id="如何利用这些发现来帮助你的-devops-团队">如何利用这些发现来帮助你的 DevOps 团队
&lt;/h3>&lt;p>十年的研究表明，软件开发的成功不仅依赖于技术实力，更取决于建立支持性的文化、重视用户需求和提升开发者体验。我们鼓励各团队在实际环境中验证和应用我们的研究成果。&lt;/p>
&lt;p>这些发现可以成为你团队实验和持续改进项目的依据。我们也欢迎你将这些实践分享给我们和 DORA 社区，让你的经验成为我们共同学习和进步的一部分。&lt;/p>
&lt;p>我们开展这项研究是为了为那些希望改进实践、推动创新和合作，并实现业务成功的团队和组织提供一条清晰的路径。未来十年，我们将继续开展平台无关的研究，专注于技术中的人性化因素。&lt;/p>
&lt;p>了解更多：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://martinliu.cn/blog/state-of-devops-2024-zh-cn/" >下载完整报告&lt;/a>&lt;/li>
&lt;li>分享你的经验，&lt;a class="link" href="https://dora.community/" target="_blank" rel="noopener"
>加入 DORA 社区&lt;/a>，学习他人的做法并获取灵感&lt;/li>
&lt;li>使用 &lt;a class="link" href="https://dora.dev/quickcheck/" target="_blank" rel="noopener"
>DORA 快速检查&lt;/a>，在不到一分钟内评估你的团队的软件交付绩效&lt;/li>
&lt;/ul></description></item><item><title>Pulumi IaC 之 Azure 快速入门指南（MacOS &amp; Python 本地）</title><link>https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/</link><pubDate>Sat, 12 Oct 2024 11:49:22 +0800</pubDate><guid>https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/</guid><description>&lt;img src="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/azure-nextgen.webp" alt="Featured image of post Pulumi IaC 之 Azure 快速入门指南（MacOS &amp; Python 本地）" />&lt;p>本快速上手指南包含的内容：&lt;/p>
&lt;ul>
&lt;li>安装和准备 Pulumi CLI 工具&lt;/li>
&lt;li>准备 Pulumi Cloud 账号，并创建个人的 Access Token&lt;/li>
&lt;li>准备 Azure 的账号，用交互的方式登录 Azure CLI&lt;/li>
&lt;li>创建一个简单的 Pulumi 项目，用于 Python 语言的主程序部署 Azure 资源&lt;/li>
&lt;li>删除环境中的所有资源&lt;/li>
&lt;/ul>
&lt;h2 id="准备工作">准备工作
&lt;/h2>&lt;p>在 MacOS 环境中安装 Pulumi CLI 可以通过 Homebrew 安装，也可以通过下载二进制文件安装。Pulumi CLI 在本地环境中用于创建、部署和管理 Pulumi 项目。它需要依赖于 Pulumi Cloud 服务，作为命令行工具交互的后端。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">brew install pulumi/tap/pulumi
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装完成后，可以通过 &lt;code>pulumi version&lt;/code> 命令查看 Pulumi CLI 的版本信息。&lt;/p>
&lt;p>Pulumi Cloud 是 Pulumi 的后端服务，用于存储 Pulumi 项目的状态信息，以及提供一些其他的服务。在使用 Pulumi CLI 之前，需要先登录 Pulumi Cloud 服务。&lt;/p>
&lt;p>Pulumi CLI 在本地环境中，可以使用 ‘pulumi login’ 默认的交互方式，完成在命令行中的用户认证；我推荐使用Pulumi 的 Access Token 来在本地 完成命令行的登录认证过程。这种非交付方式，可以在后续的 CI/CD 环境中使用。&lt;/p>
&lt;p>参考下图，登录 Pulumi Cloud 服务，获取 Access Token。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/pulumi-login-access-token.webp"
width="1146"
height="574"
srcset="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/pulumi-login-access-token_hu_eb87a597dc624bb5.webp 480w, https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/pulumi-login-access-token_hu_fbb37aa764933137.webp 1024w"
loading="lazy"
alt="个人 Access Token"
class="gallery-image"
data-flex-grow="199"
data-flex-basis="479px"
>&lt;/p>
&lt;p>在命令行中，将 Access Token 设置为环境变量，用于后续的登录认证。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PULUMI_ACCESS_TOKEN&lt;/span>&lt;span class="o">=&lt;/span>pul-ACT+++++++++++++++++++++++++++++++++++++++++++++++
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pulumi whoami
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">martinliu
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>实际上，Pulumi CLI 会先在环境变量中查找 &lt;code>PULUMI_ACCESS_TOKEN&lt;/code>，如果找到了就直接使用 Token 完成登录认证的过程，可以使用 ‘pulumi whoami’ 命令确认是否登录成功，以及当前所使用的 Pulumi Cloud 的用户名。&lt;/p>
&lt;p>当然，也可以使用 &lt;code>pulumi login&lt;/code> 命令，通过交互的方式登录 Pulumi Cloud 服务。&lt;/p>
&lt;p>Azure CLI 是 Azure 的命令行工具，用于在本地环境中与 Azure 云服务进行交互。本文省略了 Azure CLI 的登录认证过程，为了方便期间，可以使用 &lt;code>az login&lt;/code> 命令，用网页交互的方式，完成命令行中本地 Azure CLI 的登录认证。&lt;/p>
&lt;p>可以校验一下 Azure CLI 的登录认证是否成功。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az account show
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在上面的信息输出中，你可以看到当前的 Azure 账号订阅等信息。Pulumi CLI 会使用 Azure CLI 的登录认证信息，来完成 Azure 云服务的资源部署。&lt;/p>
&lt;p>在完成了上述的 Pulumi CLI 和 Azure CLI 的准备工作后，我们可以开始创建一个简单的 Pulumi 项目，用于部署 Azure 资源。&lt;/p>
&lt;h2 id="创建-pulumi-项目">创建 Pulumi 项目
&lt;/h2>&lt;p>在本地环境中，使用 Pulumi 命令 ‘pulumi new azure-python’ 创建一个新的 Pulumi 项目，用于部署 Azure 资源。&lt;/p>
&lt;p>‘pulumi new&amp;rsquo; 命令会在一个空目录中初始化一个 Pulumi 项目。在初始化的过程中，Pulumi CLI 会询问一些问题，用于生成一个简单的 Python 代码文件。在下面的示例中，我只是制定了 Azure 的区域为 &amp;lsquo;East Asia&amp;rsquo;，其他的都使用默认值。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;span class="lnt">94
&lt;/span>&lt;span class="lnt">95
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>base&lt;span class="o">)&lt;/span> ➜ first-project pulumi new azure-python
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Logging in using access token from PULUMI_ACCESS_TOKEN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">This &lt;span class="nb">command&lt;/span> will walk you through creating a new Pulumi project.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter a value or leave blank to accept the &lt;span class="o">(&lt;/span>default&lt;span class="o">)&lt;/span>, and press &amp;lt;ENTER&amp;gt;.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press ^C at any &lt;span class="nb">time&lt;/span> to quit.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Project name &lt;span class="o">(&lt;/span>first-project&lt;span class="o">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Project description &lt;span class="o">(&lt;/span>A minimal Azure Native Python Pulumi program&lt;span class="o">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Created project &lt;span class="s1">&amp;#39;first-project&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Please enter your desired stack name.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To create a stack in an organization, use the format &amp;lt;org-name&amp;gt;/&amp;lt;stack-name&amp;gt; &lt;span class="o">(&lt;/span>e.g. &lt;span class="sb">`&lt;/span>acmecorp/dev&lt;span class="sb">`&lt;/span>&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Stack name &lt;span class="o">(&lt;/span>dev&lt;span class="o">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Created stack &lt;span class="s1">&amp;#39;dev&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The toolchain to use &lt;span class="k">for&lt;/span> installing dependencies and running the program pip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The Azure location to use &lt;span class="o">(&lt;/span>azure-native:location&lt;span class="o">)&lt;/span> &lt;span class="o">(&lt;/span>WestUS2&lt;span class="o">)&lt;/span>: eastasia
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Saved config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installing dependencies...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Creating virtual environment...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Finished creating virtual environment
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Updating pip, setuptools, and wheel in virtual environment...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Requirement already satisfied: pip in ./venv/lib/python3.10/site-packages &lt;span class="o">(&lt;/span>22.3.1&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting pip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached pip-24.2-py3-none-any.whl &lt;span class="o">(&lt;/span>1.8 MB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Requirement already satisfied: setuptools in ./venv/lib/python3.10/site-packages &lt;span class="o">(&lt;/span>65.5.0&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting setuptools
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached setuptools-75.1.0-py3-none-any.whl &lt;span class="o">(&lt;/span>1.2 MB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting wheel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached wheel-0.44.0-py3-none-any.whl &lt;span class="o">(&lt;/span>&lt;span class="m">67&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installing collected packages: wheel, setuptools, pip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Attempting uninstall: setuptools
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Found existing installation: setuptools 65.5.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Uninstalling setuptools-65.5.0:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Successfully uninstalled setuptools-65.5.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Attempting uninstall: pip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Found existing installation: pip 22.3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Uninstalling pip-22.3.1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Successfully uninstalled pip-22.3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Successfully installed pip-24.2 setuptools-75.1.0 wheel-0.44.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Finished updating
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installing dependencies in virtual environment...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting pulumi&amp;lt;4.0.0,&amp;gt;&lt;span class="o">=&lt;/span>3.0.0 &lt;span class="o">(&lt;/span>from -r requirements.txt &lt;span class="o">(&lt;/span>line 1&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached pulumi-3.136.1-py3-none-any.whl.metadata &lt;span class="o">(&lt;/span>&lt;span class="m">11&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting pulumi-azure-native&amp;lt;3.0.0,&amp;gt;&lt;span class="o">=&lt;/span>2.0.0 &lt;span class="o">(&lt;/span>from -r requirements.txt &lt;span class="o">(&lt;/span>line 2&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached pulumi_azure_native-2.66.0-py3-none-any.whl.metadata &lt;span class="o">(&lt;/span>4.2 kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting protobuf~&lt;span class="o">=&lt;/span>4.21 &lt;span class="o">(&lt;/span>from pulumi&amp;lt;4.0.0,&amp;gt;&lt;span class="o">=&lt;/span>3.0.0-&amp;gt;-r requirements.txt &lt;span class="o">(&lt;/span>line 1&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached protobuf-4.25.5-cp37-abi3-macosx_10_9_universal2.whl.metadata &lt;span class="o">(&lt;/span>&lt;span class="m">541&lt;/span> bytes&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting grpcio~&lt;span class="o">=&lt;/span>1.66.2 &lt;span class="o">(&lt;/span>from pulumi&amp;lt;4.0.0,&amp;gt;&lt;span class="o">=&lt;/span>3.0.0-&amp;gt;-r requirements.txt &lt;span class="o">(&lt;/span>line 1&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached grpcio-1.66.2-cp310-cp310-macosx_12_0_universal2.whl.metadata &lt;span class="o">(&lt;/span>3.9 kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting dill~&lt;span class="o">=&lt;/span>0.3 &lt;span class="o">(&lt;/span>from pulumi&amp;lt;4.0.0,&amp;gt;&lt;span class="o">=&lt;/span>3.0.0-&amp;gt;-r requirements.txt &lt;span class="o">(&lt;/span>line 1&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached dill-0.3.9-py3-none-any.whl.metadata &lt;span class="o">(&lt;/span>&lt;span class="m">10&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting six~&lt;span class="o">=&lt;/span>1.12 &lt;span class="o">(&lt;/span>from pulumi&amp;lt;4.0.0,&amp;gt;&lt;span class="o">=&lt;/span>3.0.0-&amp;gt;-r requirements.txt &lt;span class="o">(&lt;/span>line 1&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached six-1.16.0-py2.py3-none-any.whl.metadata &lt;span class="o">(&lt;/span>1.8 kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting semver~&lt;span class="o">=&lt;/span>2.13 &lt;span class="o">(&lt;/span>from pulumi&amp;lt;4.0.0,&amp;gt;&lt;span class="o">=&lt;/span>3.0.0-&amp;gt;-r requirements.txt &lt;span class="o">(&lt;/span>line 1&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached semver-2.13.0-py2.py3-none-any.whl.metadata &lt;span class="o">(&lt;/span>5.0 kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting pyyaml~&lt;span class="o">=&lt;/span>6.0 &lt;span class="o">(&lt;/span>from pulumi&amp;lt;4.0.0,&amp;gt;&lt;span class="o">=&lt;/span>3.0.0-&amp;gt;-r requirements.txt &lt;span class="o">(&lt;/span>line 1&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached PyYAML-6.0.2-cp310-cp310-macosx_11_0_arm64.whl.metadata &lt;span class="o">(&lt;/span>2.1 kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting debugpy~&lt;span class="o">=&lt;/span>1.8.5 &lt;span class="o">(&lt;/span>from pulumi&amp;lt;4.0.0,&amp;gt;&lt;span class="o">=&lt;/span>3.0.0-&amp;gt;-r requirements.txt &lt;span class="o">(&lt;/span>line 1&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached debugpy-1.8.7-py2.py3-none-any.whl.metadata &lt;span class="o">(&lt;/span>1.1 kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting parver&amp;gt;&lt;span class="o">=&lt;/span>0.2.1 &lt;span class="o">(&lt;/span>from pulumi-azure-native&amp;lt;3.0.0,&amp;gt;&lt;span class="o">=&lt;/span>2.0.0-&amp;gt;-r requirements.txt &lt;span class="o">(&lt;/span>line 2&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached parver-0.5-py3-none-any.whl.metadata &lt;span class="o">(&lt;/span>2.7 kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting typing-extensions&amp;gt;&lt;span class="o">=&lt;/span>4.11 &lt;span class="o">(&lt;/span>from pulumi-azure-native&amp;lt;3.0.0,&amp;gt;&lt;span class="o">=&lt;/span>2.0.0-&amp;gt;-r requirements.txt &lt;span class="o">(&lt;/span>line 2&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached typing_extensions-4.12.2-py3-none-any.whl.metadata &lt;span class="o">(&lt;/span>3.0 kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting arpeggio&amp;gt;&lt;span class="o">=&lt;/span>1.7 &lt;span class="o">(&lt;/span>from parver&amp;gt;&lt;span class="o">=&lt;/span>0.2.1-&amp;gt;pulumi-azure-native&amp;lt;3.0.0,&amp;gt;&lt;span class="o">=&lt;/span>2.0.0-&amp;gt;-r requirements.txt &lt;span class="o">(&lt;/span>line 2&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached Arpeggio-2.0.2-py2.py3-none-any.whl.metadata &lt;span class="o">(&lt;/span>2.4 kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting attrs&amp;gt;&lt;span class="o">=&lt;/span>19.2 &lt;span class="o">(&lt;/span>from parver&amp;gt;&lt;span class="o">=&lt;/span>0.2.1-&amp;gt;pulumi-azure-native&amp;lt;3.0.0,&amp;gt;&lt;span class="o">=&lt;/span>2.0.0-&amp;gt;-r requirements.txt &lt;span class="o">(&lt;/span>line 2&lt;span class="o">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Using cached attrs-24.2.0-py3-none-any.whl.metadata &lt;span class="o">(&lt;/span>&lt;span class="m">11&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached pulumi-3.136.1-py3-none-any.whl &lt;span class="o">(&lt;/span>&lt;span class="m">274&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached pulumi_azure_native-2.66.0-py3-none-any.whl &lt;span class="o">(&lt;/span>89.7 MB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached debugpy-1.8.7-py2.py3-none-any.whl &lt;span class="o">(&lt;/span>5.2 MB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached dill-0.3.9-py3-none-any.whl &lt;span class="o">(&lt;/span>&lt;span class="m">119&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached grpcio-1.66.2-cp310-cp310-macosx_12_0_universal2.whl &lt;span class="o">(&lt;/span>10.7 MB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached parver-0.5-py3-none-any.whl &lt;span class="o">(&lt;/span>&lt;span class="m">15&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached protobuf-4.25.5-cp37-abi3-macosx_10_9_universal2.whl &lt;span class="o">(&lt;/span>&lt;span class="m">394&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached PyYAML-6.0.2-cp310-cp310-macosx_11_0_arm64.whl &lt;span class="o">(&lt;/span>&lt;span class="m">171&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached semver-2.13.0-py2.py3-none-any.whl &lt;span class="o">(&lt;/span>&lt;span class="m">12&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached six-1.16.0-py2.py3-none-any.whl &lt;span class="o">(&lt;/span>&lt;span class="m">11&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached typing_extensions-4.12.2-py3-none-any.whl &lt;span class="o">(&lt;/span>&lt;span class="m">37&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached Arpeggio-2.0.2-py2.py3-none-any.whl &lt;span class="o">(&lt;/span>&lt;span class="m">55&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cached attrs-24.2.0-py3-none-any.whl &lt;span class="o">(&lt;/span>&lt;span class="m">63&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installing collected packages: arpeggio, typing-extensions, six, semver, pyyaml, protobuf, grpcio, dill, debugpy, attrs, pulumi, parver, pulumi-azure-native
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Successfully installed arpeggio-2.0.2 attrs-24.2.0 debugpy-1.8.7 dill-0.3.9 grpcio-1.66.2 parver-0.5 protobuf-4.25.5 pulumi-3.136.1 pulumi-azure-native-2.66.0 pyyaml-6.0.2 semver-2.13.0 six-1.16.0 typing-extensions-4.12.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Finished installing dependencies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Finished installing dependencies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your new project is ready to go! ✨
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To perform an initial deployment, run &lt;span class="sb">`&lt;/span>pulumi up&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>base&lt;span class="o">)&lt;/span> ➜ first-project
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>下图是初始化后的项目目录结构。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/pulumi-project-structure.webp"
width="585"
height="271"
srcset="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/pulumi-project-structure_hu_d86091b7db897651.webp 480w, https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/pulumi-project-structure_hu_b5fbef00498e59ca.webp 1024w"
loading="lazy"
alt="Pulumi 项目目录结构"
class="gallery-image"
data-flex-grow="215"
data-flex-basis="518px"
>&lt;/p>
&lt;p>在项目目录中，有一个 &lt;code>Pulumi.yaml&lt;/code> 文件，用于描述项目的基本信息，如项目名称、描述、编程语言等。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">first-project&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">A minimal Azure Native Python Pulumi program&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">runtime&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">python&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">options&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">toolchain&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">pip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">virtualenv&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">venv&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">pulumi:tags&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">pulumi:template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">azure-python&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在项目目录中，有一个 &lt;code>Pulumi.dev.yaml&lt;/code> 文件，用于描述项目的配置信息，如 Azure 的订阅 ID、资源组名称、区域等。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">azure-native:location&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">eastasia&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在项目目录中，有一个 &lt;code>__main__.py&lt;/code> 文件，用于描述项目的主程序，用于部署 Azure 资源。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&amp;#34;&amp;#34;An Azure RM Python Pulumi program&amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">pulumi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pulumi_azure_native&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">storage&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pulumi_azure_native&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">resources&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create an Azure Resource Group 创建一个 Azure 资源组&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">resource_group&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">resources&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ResourceGroup&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;resource_group&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create an Azure resource (Storage Account) 创建一个 Azure 资源（存储账户）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">account&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">storage&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">StorageAccount&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;sa&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resource_group_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">resource_group&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sku&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">storage&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SkuName&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">STANDARD_LRS&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">kind&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Kind&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">STORAGE_V2&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Export the primary key of the Storage Account 导出存储账户的主键&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">primary_key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pulumi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Output&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resource_group&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">account&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">.&lt;/span>&lt;span class="n">apply&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">lambda&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">storage&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">list_storage_account_keys&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resource_group_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">account_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">.&lt;/span>&lt;span class="n">apply&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">lambda&lt;/span> &lt;span class="n">accountKeys&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">accountKeys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">keys&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pulumi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">export&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;primary_storage_key&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">primary_key&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在项目目录中，有一个 &lt;code>requirements.txt&lt;/code> 文件，用于描述项目的依赖信息，如 Pulumi 和 Azure Native SDK 的版本信息。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">pulumi&amp;gt;=3.0.0,&amp;lt;4.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pulumi-azure-native&amp;gt;=2.0.0,&amp;lt;3.0.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在使用 &lt;code>pulumi new&lt;/code> 创建新项目时，可以通过指定 &lt;code>--language&lt;/code> 参数来选择所需的语言。例如，默认语言确实是 Python，但你可以根据需求选择其他支持的语言，如 TypeScript、JavaScript、Go 或 C#。以下是示例用法：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">pulumi new &amp;lt;template-name&amp;gt; --language &amp;lt;language&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其中 &lt;code>&amp;lt;language&amp;gt;&lt;/code> 可以是以下几种：&lt;/p>
&lt;ul>
&lt;li>&lt;code>typescript&lt;/code>（TypeScript）&lt;/li>
&lt;li>&lt;code>javascript&lt;/code>（JavaScript）&lt;/li>
&lt;li>&lt;code>python&lt;/code>（Python）&lt;/li>
&lt;li>&lt;code>go&lt;/code>（Go）&lt;/li>
&lt;li>&lt;code>csharp&lt;/code>（C#）&lt;/li>
&lt;/ul>
&lt;p>如果想创建一个 TypeScript 项目，命令可以如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">pulumi new &amp;lt;template-name&amp;gt; --language typescript
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果没有指定语言，则会默认使用 Python。&lt;/p>
&lt;p>当前生成了一个默认的 Python 主程序模板，Pulumi CLI 会启动本地的语言服务器，执行此 Python 程序，完成和 Azure Cloud 的交互工作，实现 Python 程序中资源部署的意图，开发人员可以在此基础上，根据自己的需求，修改和扩展 Python 代码，实现对 Azure 资源的部署和更新。模板 Python 代码中，创建了一个 Azure 资源组和一个 Azure 存储账，在最后将 ‘primary_key’导出显示在命令中，实现了 Python 程序对外的输出。&lt;/p>
&lt;h2 id="部署-pulumi-项目">部署 Pulumi 项目
&lt;/h2>&lt;p>在项目目录中，使用 &lt;code>pulumi up&lt;/code> 命令，完成 Azure 资源的部署。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>base&lt;span class="o">)&lt;/span> ➜ first-project pulumi up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Previewing update &lt;span class="o">(&lt;/span>dev&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">View in Browser &lt;span class="o">(&lt;/span>Ctrl+O&lt;span class="o">)&lt;/span>: https://app.pulumi.com/martinliu/first-project/dev/previews/539d74d9-64ec-4fb8-aa69-eb08ddbe4eea
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Name Plan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + pulumi:pulumi:Stack first-project-dev create
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + ├─ azure-native:resources:ResourceGroup resource_group create
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + └─ azure-native:storage:StorageAccount sa create
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Outputs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> primary_storage_key: output&amp;lt;string&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + &lt;span class="m">3&lt;/span> to create
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Do you want to perform this update? yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Updating &lt;span class="o">(&lt;/span>dev&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">View in Browser &lt;span class="o">(&lt;/span>Ctrl+O&lt;span class="o">)&lt;/span>: https://app.pulumi.com/martinliu/first-project/dev/updates/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Name Status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + pulumi:pulumi:Stack first-project-dev created &lt;span class="o">(&lt;/span>36s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + ├─ azure-native:resources:ResourceGroup resource_group created &lt;span class="o">(&lt;/span>3s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + └─ azure-native:storage:StorageAccount sa created &lt;span class="o">(&lt;/span>29s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Outputs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> primary_storage_key: &lt;span class="s2">&amp;#34;key++++++++++++++++++++++++++++++++++++++++++++++++++++++&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + &lt;span class="m">3&lt;/span> created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Duration: 38s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上 &lt;code>pulumi up&lt;/code> 命令是一个交互式的执行过程，可以在命令行中输入 &lt;code>yes&lt;/code>，确认是否执行资源的创建。在执行过程中，Pulumi CLI 会生成一个更新信息，用于展示资源的创建状态，以及资源的状态。在更新信息中，可以看到已经创建的资源类型、名称、状态等信息。在更新信息中，还会显示一个 URL，用于在浏览器中查看更新信息。&lt;/p>
&lt;p>在部署完毕之后，我们可以在 Pulumi Cloud 网页中看到此项目的部署过程，以及资源的状态信息。如下图所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/pulumi-cloud-project-deploy.webp"
width="1465"
height="969"
srcset="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/pulumi-cloud-project-deploy_hu_84c6ac43a7bb9a0e.webp 480w, https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/pulumi-cloud-project-deploy_hu_cf6224f0e6dfadca.webp 1024w"
loading="lazy"
alt="Pulumi Cloud 项目部署"
class="gallery-image"
data-flex-grow="151"
data-flex-basis="362px"
>&lt;/p>
&lt;p>下面在 Azure 门户中，可以看到创建的资源组和存储账户。我们可以看到，资源组的名称是 &lt;code>resource_group&lt;/code>，存储账户的名称是 &lt;code>sa&lt;/code>开头的资源，后面跟随着一些随机字符。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/azure-portal-resources.webp"
width="1463"
height="868"
srcset="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/azure-portal-resources_hu_530750cd313da8e2.webp 480w, https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/azure-portal-resources_hu_bd89b5800882abc.webp 1024w"
loading="lazy"
alt="Azure 门户中的资源"
class="gallery-image"
data-flex-grow="168"
data-flex-basis="404px"
>&lt;/p>
&lt;p>根据以上的操作体验，我们可以参考下图，理解 Pulumi CLI 和 Azure 云服务之间的交互过程。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/engine-block-diagram.webp"
width="1686"
height="1186"
srcset="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/engine-block-diagram_hu_e10293342bdc6b98.webp 480w, https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/engine-block-diagram_hu_fdadfd47ae52d92d.webp 1024w"
loading="lazy"
alt="Pulumi CLI 和 Azure 云服务交互"
class="gallery-image"
data-flex-grow="142"
data-flex-basis="341px"
>&lt;/p>
&lt;p>pulumi 命令行工具本身是一个部署引擎，它会启动一个本地的语言服务器，用于执行 Python 程序，完成对 Azure 云服务的资源部署。&lt;/p>
&lt;p>本 Python 测试项目是一个典型的 Pulumi 项目模板，它使用 IaC 的方式，将 Azure 资源的部署和更新，通过 Python 代码的方式，实现了对 Azure 资源的管理。这个 Pulumi 项目的部署结果称为 ‘Stack’，是一个 Azure 基础设施的技术栈，本项目模板目录可以在你的业务应用项目的根目录中，作为一个子目录，用于管理 Azure 资源的部署和更新。随着业务项目的开发和迭代，可以通过 Pulumi CLI 工具，完成 Azure 多个环境资源的部署和更新，例如开发环境、测试环境、生产环境等。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/infra-project.webp"
width="743"
height="454"
srcset="https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/infra-project_hu_9af4161a74bb9d6.webp 480w, https://martinliu.cn/blog/pulumi-azure-quickstart-guide-macos-local/infra-project_hu_b7ca6c4c1b313945.webp 1024w"
loading="lazy"
alt="Pulumi 项目模板"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="392px"
>&lt;/p>
&lt;h2 id="更新-pulumi-项目">更新 Pulumi 项目
&lt;/h2>&lt;p>在准备好以上的环境后，假设我们收到了一个新的业务需求，需要在 Azure 存储账户中部署一个 &lt;code>index.html&lt;/code> 文件，用于展示一个简单的静态网页。我们可以通过修改 &lt;code>__main__.py&lt;/code> 文件，增加一个 Azure Blob 存储的资源，用于部署 &lt;code>index.html&lt;/code> 文件。&lt;/p>
&lt;p>为了演示这个过程，我们现在命令，在当前的项目目录中，创建一个 &lt;code>index.html&lt;/code> 文件。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cat &lt;span class="s">&amp;lt;&amp;lt;EOT &amp;gt; index.html
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;lt;html&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;body&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;h1&amp;gt;Hello, Pulumi!&amp;lt;/h1&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;lt;/body&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">&amp;lt;/html&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOT&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当然，这个 &lt;code>index.html&lt;/code> 文件是业务需求成果，是不应该放在 IaC 程序代码的目录中的。&lt;/p>
&lt;p>下面需要在 &lt;code>__main__.py&lt;/code> 文件中，修改 Azure Blob 存储的资源属性，用于部署 &lt;code>index.html&lt;/code> 文件。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Enable static website support 启用静态网站支持&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">static_website&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">storage&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">StorageAccountStaticWebsite&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;staticWebsite&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">account_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">account&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resource_group_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">resource_group&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">index_document&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;index.html&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Upload the file 将文件上传到存储账户&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">index_html&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">storage&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Blob&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;index.html&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resource_group_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">resource_group&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">account_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">account&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">container_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">static_website&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">container_name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">pulumi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">FileAsset&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;index.html&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">content_type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;text/html&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Web endpoint to the website 在命令行中导出网站的 Web 端点&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pulumi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">export&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;staticEndpoint&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">account&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">primary_endpoints&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">web&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在完成了以上的修改后，我们可以使用 &lt;code>pulumi up&lt;/code> 命令，完成 Azure 资源的更新。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>base&lt;span class="o">)&lt;/span> ➜ first-project ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Pulumi.dev.yaml __main__.py index.html venv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Pulumi.yaml __pycache__ requirements.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>base&lt;span class="o">)&lt;/span> ➜ first-project pulumi up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Previewing update &lt;span class="o">(&lt;/span>dev&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">View in Browser &lt;span class="o">(&lt;/span>Ctrl+O&lt;span class="o">)&lt;/span>: https://app.pulumi.com/martinliu/first-project/dev/previews/613fd4dc-ce8b-4a32-a8f6-713c2e4dc839
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Name Plan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pulumi:pulumi:Stack first-project-dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + ├─ azure-native:storage:StorageAccountStaticWebsite staticWebsite create
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + └─ azure-native:storage:Blob index.html create
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Outputs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + staticEndpoint : &lt;span class="s2">&amp;#34;https://sa4ecf74cb.z7.web.core.windows.net/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + &lt;span class="m">2&lt;/span> to create
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">3&lt;/span> unchanged
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Do you want to perform this update? yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Updating &lt;span class="o">(&lt;/span>dev&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">View in Browser &lt;span class="o">(&lt;/span>Ctrl+O&lt;span class="o">)&lt;/span>: https://app.pulumi.com/martinliu/first-project/dev/updates/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Name Status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pulumi:pulumi:Stack first-project-dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + ├─ azure-native:storage:StorageAccountStaticWebsite staticWebsite created &lt;span class="o">(&lt;/span>5s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + └─ azure-native:storage:Blob index.html created &lt;span class="o">(&lt;/span>3s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Outputs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> primary_storage_key: &lt;span class="s2">&amp;#34;key++++++++++++++++++++++++++++++++++++++++++++++++++++++&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + staticEndpoint : &lt;span class="s2">&amp;#34;https://sa4ecf74cb.z7.web.core.windows.net/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + &lt;span class="m">2&lt;/span> created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">3&lt;/span> unchanged
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Duration: 13s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在以上命令执行的过程中，我们也可以在 Pulumi Cloud 网页中看到此项目的部署过程，以及资源的状态信息。还可以在 Azure 门户中，看到更新后的资源组和存储账户。&lt;/p>
&lt;p>现在，让我们在命令行中，查看导出的 &lt;code>staticEndpoint&lt;/code> 输出，用于验证所部署的静态网站。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">curl &lt;span class="k">$(&lt;/span>pulumi stack output staticEndpoint&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>base&lt;span class="o">)&lt;/span> ➜ first-project curl &lt;span class="k">$(&lt;/span>pulumi stack output staticEndpoint&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;html&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;body&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;h1&amp;gt;Hello, Pulumi!&amp;lt;/h1&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/body&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/html&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>base&lt;span class="o">)&lt;/span> ➜ first-project
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在浏览器中，访问 &lt;code>staticEndpoint&lt;/code> 输出的 URL，可以看到部署的静态网站。&lt;/p>
&lt;h2 id="删除-pulumi-项目">删除 Pulumi 项目
&lt;/h2>&lt;p>假设我们完成了今天的开发和测试工作，我们可以使用 &lt;code>pulumi destroy&lt;/code> 命令，删除所有当前在 Azure 上所部署的资源。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>base&lt;span class="o">)&lt;/span> ➜ first-project pulumi destroy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Previewing destroy &lt;span class="o">(&lt;/span>dev&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">View in Browser &lt;span class="o">(&lt;/span>Ctrl+O&lt;span class="o">)&lt;/span>: https://app.pulumi.com/martinliu/first-project/dev/previews/3d3257e7-c853-4d89-bfc0-461a37bf94ee
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Name Plan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - pulumi:pulumi:Stack first-project-dev delete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - ├─ azure-native:storage:Blob index.html delete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - ├─ azure-native:storage:StorageAccountStaticWebsite staticWebsite delete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - ├─ azure-native:storage:StorageAccount sa delete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - └─ azure-native:resources:ResourceGroup resource_group delete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Outputs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - primary_storage_key: &lt;span class="s2">&amp;#34;key++++++++++++++++++++++++++++++++++++++++++++++++++++++&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - staticEndpoint : &lt;span class="s2">&amp;#34;https://sa4ecf74cb.z7.web.core.windows.net/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &lt;span class="m">5&lt;/span> to delete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Do you want to perform this destroy? yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Destroying &lt;span class="o">(&lt;/span>dev&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">View in Browser &lt;span class="o">(&lt;/span>Ctrl+O&lt;span class="o">)&lt;/span>: https://app.pulumi.com/martinliu/first-project/dev/updates/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type Name Status
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - pulumi:pulumi:Stack first-project-dev deleted &lt;span class="o">(&lt;/span>0.69s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - ├─ azure-native:storage:Blob index.html deleted &lt;span class="o">(&lt;/span>5s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - ├─ azure-native:storage:StorageAccountStaticWebsite staticWebsite deleted &lt;span class="o">(&lt;/span>1s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - ├─ azure-native:storage:StorageAccount sa deleted &lt;span class="o">(&lt;/span>7s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - └─ azure-native:resources:ResourceGroup resource_group deleted &lt;span class="o">(&lt;/span>83s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Outputs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - primary_storage_key: &lt;span class="s2">&amp;#34;key++++++++++++++++++++++++++++++++++++++++++++++++++++++&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - staticEndpoint : &lt;span class="s2">&amp;#34;https://sa4ecf74cb.z7.web.core.windows.net/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &lt;span class="m">5&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Duration: 1m42s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The resources in the stack have been deleted, but the &lt;span class="nb">history&lt;/span> and configuration associated with the stack are still maintained.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">If you want to remove the stack completely, run &lt;span class="sb">`&lt;/span>pulumi stack rm dev&lt;span class="sb">`&lt;/span>.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在以上命令执行的过程中，我们也可以在 Pulumi Cloud 网页中看到此项目的部署过程，以及资源的状态信息。还可以在 Azure 门户中，看到删除后的资源组和存储账户。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>您已成功使用 Pulumi 部署了一些云资源。在本指南中，您完成了以下操作：&lt;/p>
&lt;ul>
&lt;li>创建了一个新的 Pulumi 项目。&lt;/li>
&lt;li>在 Azure 上部署了一个新的存储账户和容器。&lt;/li>
&lt;li>将一个 index.html 文件添加到容器中。&lt;/li>
&lt;li>将 index.html 文件托管为静态网站。&lt;/li>
&lt;li>销毁了已部署的资源。&lt;/li>
&lt;/ul>
&lt;p>在本指南中，您了解了如何使用 Pulumi CLI 和 Azure CLI 在本地 macOS 环境中，部署 Azure 资源。您还了解了如何使用 Pulumi Cloud 服务，用于存储 Pulumi 项目的状态信息，以及提供一些其他的服务。&lt;/p>
&lt;p>参考文档：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.pulumi.com/docs/" target="_blank" rel="noopener"
>Pulumi 官方文档&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.pulumi.com/docs/iac/get-started/azure/" target="_blank" rel="noopener"
>Get started with Pulumi &amp;amp; Azure&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>2024 年 Gartner DevOps平台魔力象限</title><link>https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/</link><pubDate>Fri, 20 Sep 2024 09:49:13 +0800</pubDate><guid>https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/</guid><description>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/66da11103b54e7739f860dd8_blog-gartner-mq.webp" alt="Featured image of post 2024 年 Gartner DevOps平台魔力象限" />&lt;p>DevOps 平台提供了集成化的工具替代方案，帮助组织优化软件开发流程，减少工具链复杂性。软件工程领导者应评估这些平台，以降低开发复杂性、提升安全性，并加速软件交付进程。&lt;/p>
&lt;p>&lt;strong>战略规划假设&lt;/strong>&lt;/p>
&lt;p>预计到 2027 年，80% 的组织将采用 DevOps 平台来简化工具链并优化软件交付流程，这一比例将从 2023 年的 25% 大幅上升。&lt;/p>
&lt;h2 id="市场定义与描述">市场定义与描述
&lt;/h2>&lt;p>Gartner 将 DevOps 平台定义为能够提供完整集成功能的平台，支持通过敏捷 (Agile) 和 DevOps 实践实现软件的持续交付。该平台功能覆盖了持续集成/持续交付 (CI/CD) 管道的开发和交付生命周期，包括版本控制、测试、安全性、文档及合规性等。DevOps 平台能够促进团队协作、一致性、简化工具使用，并衡量软件交付的各项指标。&lt;/p>
&lt;p>DevOps 平台简化了现代软件应用交付中所需组件的创建、维护和管理过程。平台提供统一的工作流和数据模型，简化用户访问，保证一致的用户体验 (UX)，有效减轻用户的操作负担。这些平台还能提升软件开发过程中的可见性、可审计性和可追溯性，鼓励团队采用系统化的思维方式，并加速反馈循环。&lt;/p>
&lt;p>企业通过使用 DevOps 平台，减少因复杂工具链、手动交接和整个软件开发生命周期 (SDLC) 中可见性不足所引发的工具摩擦。这样，产品团队能够在确保质量的前提下更快地为客户交付价值。DevOps 平台市场反映了开发、安全、基础设施和运营技术的整合，旨在简化软件交付流程。&lt;/p>
&lt;p>DevOps 平台支持多种应用场景，包括但不限于：&lt;/p>
&lt;ul>
&lt;li>敏捷软件交付——实现敏捷开发实践的运营&lt;/li>
&lt;li>云原生应用交付——在混合和多云环境中构建并交付云原生应用&lt;/li>
&lt;li>MLOps——支持对机器学习模型的管理，包括版本控制和反馈循环&lt;/li>
&lt;li>移动应用交付——构建、测试和交付本地移动应用和移动 Web 应用&lt;/li>
&lt;li>平台工程——提供自助服务的内部开发者平台，扩展 DevOps 和软件工程实践&lt;/li>
&lt;li>受监管的交付——支持合规、审计、可追溯性及治理&lt;/li>
&lt;/ul>
&lt;h3 id="必备功能">必备功能
&lt;/h3>&lt;p>该市场的强制性功能包括：&lt;/p>
&lt;ul>
&lt;li>持续集成——原生支持持续构建代码，并协调验证和验证流程，如测试自动化、安全性和合规扫描。&lt;/li>
&lt;li>持续交付和发布协调——支持无审批的持续部署，以及通过审批机制进行的发布协调（如满足监管要求或正处于 ITIL 过渡期的组织）。&lt;/li>
&lt;li>Web 应用的交付——包括但不限于容器化应用的交付。&lt;/li>
&lt;/ul>
&lt;h3 id="常见功能">常见功能
&lt;/h3>&lt;p>该市场的常见功能包括：&lt;/p>
&lt;ul>
&lt;li>团队协作与开发流程的可视化——通过统一仪表板支持多角色用户的工作流展示。&lt;/li>
&lt;li>价值流分析——如吞吐量指标、DORA 指标等。&lt;/li>
&lt;li>安全功能的协调——涵盖源代码、软件包和配置管理。&lt;/li>
&lt;li>配置自动化——支持环境管理，包括基础设施的部署、配置管理及漂移检测。&lt;/li>
&lt;li>产品规划与管理——包括功能和缺陷管理、路线图规划、待办事项管理、看板和 Scrum 方法。&lt;/li>
&lt;li>源代码库、工件库和集成开发环境 (IDEs)。&lt;/li>
&lt;li>软件测试自动化——支持功能性和非功能性测试的执行、测试管理、代码覆盖率分析、性能测试、混沌测试、模糊测试、渗透测试以及通过自动化工具进行的验收测试。&lt;/li>
&lt;li>应用监控与可观测性——帮助提高服务质量目标 (SLO)，收集生产数据（如日志、指标、事件、跟踪），并支持自动化事故响应。&lt;/li>
&lt;li>AI 辅助和 AI 驱动的持续集成与部署——优化 DevOps 流程，如软件测试自动化、基础设施部署、安全漏洞检测和操作数据分析。&lt;/li>
&lt;li>集成开发者门户——提供软件目录和可定制的仪表板，帮助团队深入了解软件组件及其依赖关系和环境；此外，还可包括基础设施 KPIs、协作论坛和知识库等功能。&lt;/li>
&lt;/ul>
&lt;h2 id="魔力象限">魔力象限
&lt;/h2>&lt;p>图 1：DevOps 平台魔力象限&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/figure.webp"
width="570"
height="592"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/figure_hu_4dbc6f9d52f01a8d.webp 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/figure_hu_3ae23bae0045e44b.webp 1024w"
loading="lazy"
alt="图 1：DevOps 平台魔力象限"
class="gallery-image"
data-flex-grow="96"
data-flex-basis="231px"
>&lt;/p>
&lt;h3 id="供应商优劣分析">供应商优劣分析
&lt;/h3>&lt;h3 id="amazon-web-services">Amazon Web Services
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/amazon-ec2.webp"
width="288"
height="288"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/amazon-ec2_hu_b1bbcb268f89f406.webp 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/amazon-ec2_hu_1b5cf31d9967330f.webp 1024w"
loading="lazy"
alt="Amazon Web Services"
class="gallery-image"
data-flex-grow="100"
data-flex-basis="240px"
>&lt;/p>
&lt;p>亚马逊网络服务 (AWS) 在此魔力象限中被列为具有远见的领导者。其 DevOps 平台 Amazon CodeCatalyst 集成了多项 AWS 工具，包括 AWS CodeArtifact、AWS CodeBuild、AWS CodeCommit、AWS CodeDeploy、AWS CodePipeline 和 AWS CodeStar。（评估期间，亚马逊已停止为 CodeCommit 接受新用户。）Amazon CodeCatalyst 平台正在迅速开发更多的协作和报告功能。&lt;/p>
&lt;p>AWS 拥有全球业务网络，为各类规模和行业的客户提供服务。Amazon CodeCatalyst 于 2023 年 4 月正式推出，通过支持 Amazon Elastic Kubernetes Service (EKS) 和 Terraform，增强了计划工作流和账户管理等功能。此外，AWS 进一步拓展了 CodeCatalyst 的集成功能，支持 GitHub 以外的平台，如 GitLab 和 Bitbucket，并与 Amazon Q for Developers 进行了集成。&lt;/p>
&lt;h4 id="优势">优势
&lt;/h4>&lt;ul>
&lt;li>深度集成 AWS 云服务：AWS 一直在 IaaS 和 PaaS 市场中占据领导地位，提供的工具使用户能够随时跟进最新技术。然而，过去的工具较为零散，CodeCatalyst 通过一个统一的平台简化了构建和部署流程，让用户能够更高效地使用 AWS 云服务。&lt;/li>
&lt;li>价格竞争力：相比其他 DevOps 平台，CodeCatalyst 提供从规划到交付的完整功能，且价格更具优势。这是因为最终用户的应用程序将推动 AWS 云服务的收入。&lt;/li>
&lt;li>安全开发环境：AWS 响应了客户对更高安全性和隐私的需求。过去一年中，AWS 添加了单点登录功能，并通过 Amazon 虚拟专用网 (VPC) 创建了隔离的开发和测试环境。AWS PrivateLink 允许 AWS CodeBuild、Amazon EC2 和本地应用程序之间建立私密安全的连接，客户无需借助额外的访问网关技术就能限制网络流量。&lt;/li>
&lt;/ul>
&lt;h4 id="劣势">劣势
&lt;/h4>&lt;ul>
&lt;li>功能仍在发展：Amazon CodeCatalyst 推出时间较短，尽管功能全面，但仍缺少如 DORA 等 DevOps 指标的支持。此外，平台缺乏内置的 wiki，且第三方工作流的数量有限（不过用户可以使用 GitHub Actions）。&lt;/li>
&lt;li>第三方集成有限：虽然 Amazon CodeCatalyst 提供了与第三方开发工具和服务的扩展，但目前只有少数供应商与其进行集成。这也是 AWS DevOps 工具链（如 AWS CodePipeline）的历史问题之一。&lt;/li>
&lt;li>内置安全功能不足：在代码和应用程序安全的支持上，Amazon CodeCatalyst 相较市场仍有不足。&lt;/li>
&lt;/ul>
&lt;h3 id="atlassian">Atlassian
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/atlassian-atlas.webp"
width="364"
height="364"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/atlassian-atlas_hu_bd772b42ac1fa3c3.webp 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/atlassian-atlas_hu_1fb18456fdda646b.webp 1024w"
loading="lazy"
alt="Atlassian"
class="gallery-image"
data-flex-grow="100"
data-flex-basis="240px"
>&lt;/p>
&lt;p>Atlassian 被评为本魔力象限中的领导者。其 DevOps 平台由多个工具组成，包括 Jira、Bitbucket、Jira Service Management、Confluence、Compass 和 Jira Product Discovery。这些工具提供了从产品发现到工作管理、问题跟踪、源代码管理、发布编排、CI/CD、事故管理、变更管理和团队协作的全方位支持。&lt;/p>
&lt;p>Atlassian 的业务遍布全球，为各行各业、不同规模的客户提供服务。自 2023 年以来，Atlassian 在 DevSecOps 方面的能力得到了提升，尤其是在敏捷工作流中的漏洞管理。此外，Atlassian 还持续改进其内部开发者门户 Compass。&lt;/p>
&lt;h4 id="优势-1">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>工作和服务管理以及协作&lt;/strong>：Atlassian 有效地将 Jira、Jira Service Management 和 Confluence 集成在一起，帮助 DevOps 团队高效协作管理工作。客户普遍认为，这些工具已经成为他们日常工作中的关键组成部分。尤其是 Confluence 作为知识管理工具，几乎没有直接竞争者，并且在许多软件开发团队中被广泛使用。&lt;/li>
&lt;li>&lt;strong>强大的平台生态系统&lt;/strong>：Atlassian Marketplace 提供了成千上万的第三方应用程序和插件，扩展了平台的功能。此外，Atlassian 还拥有一个全球合作伙伴网络，提供强大的实施、咨询和支持服务。&lt;/li>
&lt;li>&lt;strong>持续创新&lt;/strong>：Atlassian 持续推出创新功能，如集成的 DevSecOps 规划工具，进一步强化了平台的敏捷工作管理能力。通过通用数据模型，该平台还能在 AI 和数据分析领域推动更多创新。&lt;/li>
&lt;/ul>
&lt;h4 id="劣势-1">劣势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>销售模式受限&lt;/strong>：Atlassian 主要采用固定价格的销售模式，这让部分客户感到不满。一些客户希望通过合作伙伴获得更多的定制化服务和折扣，尤其是企业客户可以通过企业许可协议获得更多灵活性和价格优惠。&lt;/li>
&lt;li>&lt;strong>CI/CD 采用率较低&lt;/strong>：虽然 Atlassian 的 Bitbucket 提供了与其他产品相当的源代码管理和 CI/CD 功能，但其客户采用率相对较低。为实现功能开关（标志）管理等特定功能，客户往往需要依赖外部工具的集成。&lt;/li>
&lt;li>&lt;strong>云产品的法规合规性不足&lt;/strong>：目前，Atlassian 的云产品尚未通过如 FedRAMP 这样的重要法规认证。同时，在 2024 年初 Atlassian 停止了对本地 Server 产品的支持，这意味着一些受监管行业的客户可能只能选择更昂贵的本地 Data Center 产品。&lt;/li>
&lt;/ul>
&lt;h3 id="buildkite">Buildkite
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/buildkite.webp"
width="364"
height="364"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/buildkite_hu_67cd13cdbc8b189f.webp 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/buildkite_hu_319d289901fc688f.webp 1024w"
loading="lazy"
alt="Buildkite"
class="gallery-image"
data-flex-grow="100"
data-flex-basis="240px"
>&lt;/p>
&lt;p>Buildkite 是本次魔力象限中的利基玩家。其 DevOps 平台包含 Pipelines、Packages 和 Test Analytics，支持 CI/CD 流水线、包管理（测试版）以及测试套件优化和分析功能。&lt;/p>
&lt;p>Buildkite 的主要业务位于北美，同时在亚太地区也有一定的客户基础，服务于多个行业的客户。2023 年，Buildkite 收购了 Packagecloud，一个软件制品包管理平台，从而进一步扩展了其 DevOps 平台，支持多种现代编程语言的包格式，并以 Buildkite Packages 的形式交付给用户。&lt;/p>
&lt;h4 id="优势-2">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>高扩展性与优异性能&lt;/strong>：Buildkite 旨在帮助大型企业实现构建代理的无限并行运行，缩短构建和测试周期，提升开发效率。一些大型企业用户已经实现了超过 13 万个并行流水线的应用。&lt;/li>
&lt;li>&lt;strong>智能化工作流&lt;/strong>：Buildkite 平台支持智能化工作流，可以根据不同的运行时条件（例如分支、环境或前置步骤的结果）灵活执行构建过程中的不同步骤，满足用户的特定需求。&lt;/li>
&lt;li>&lt;strong>测试优化功能&lt;/strong>：通过 Buildkite 的测试分析工具，用户可以监控测试套件的性能与可靠性。该工具提供详细的跟踪与报告，帮助开发团队识别长时间运行或不稳定的测试，并为优化测试套件和加快测试周期提供洞见。&lt;/li>
&lt;/ul>
&lt;h4 id="劣势-2">劣势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>功能覆盖较窄&lt;/strong>：Buildkite 仅覆盖 CI/CD 流程的部分环节，用户如果需要构建完整的 CI/CD 流水线，仍需依赖其他工具或平台进行集成。&lt;/li>
&lt;li>&lt;strong>云数据中心的区域支持有限&lt;/strong>：Buildkite 的服务主要托管在美国的云数据中心，非美国用户无法在当地托管 Buildkite。需要确保 Buildkite 提供的数据驻留解决方案符合要求。此外，Buildkite 不提供备份或灾难恢复数据中心的选择。&lt;/li>
&lt;li>&lt;strong>托管服务较新&lt;/strong>：由于 Buildkite 的托管服务刚刚推出，用户需要关注其性能反馈，同时在便捷的全托管服务与需要更多运维投入的混合自管基础设施之间做出平衡选择。&lt;/li>
&lt;/ul>
&lt;h3 id="circleci">CircleCI
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/circleci.webp"
width="364"
height="364"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/circleci_hu_8ce97bbd536f024f.webp 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/circleci_hu_5b78337653957f84.webp 1024w"
loading="lazy"
alt="CircleCI"
class="gallery-image"
data-flex-grow="100"
data-flex-basis="240px"
>&lt;/p>
&lt;p>CircleCI 是本次魔力象限中的挑战者。它的 DevOps 平台同样叫做 CircleCI，提供托管和自托管的构建基础设施、自托管运行器、CI/CD 流水线、测试自动化、构建性能洞察以及支持 LLM 的应用程序。&lt;/p>
&lt;p>CircleCI 的业务主要集中在北美，同时在欧洲也有一定的客户群，覆盖多个行业，尤其是技术行业。2023 年，CircleCI 推出了新的安全功能，包括 OpenID Connect (OIDC)、组管理和配置策略，以更好地满足企业客户的需求。此外，CircleCI 还增强了其智能平台，支持成本优化，并通过改进测试执行、自愈流水线和智能发布编排器，提升了开发者体验。&lt;/p>
&lt;h4 id="优势-3">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>FedRAMP 和 SOC 2 Type II 认证&lt;/strong>：CircleCI 是市场上为数不多的通过 FedRAMP 和 SOC 2 Type II 认证的平台之一，非常适合在高度受监管行业中的客户使用。&lt;/li>
&lt;li>&lt;strong>客户满意度高&lt;/strong>：在 Gartner Peer Insights 上，CircleCI 的 DevOps 平台获得了 4.7 分的高评分，尤其是在产品评估、合同签订和功能表现方面，得分达到了 4.8 分。客户普遍认为该平台可靠，并且与其他常见的 DevOps 工具集成良好。&lt;/li>
&lt;li>&lt;strong>操作简便&lt;/strong>：CircleCI 在使用方便性方面表现出色，客户特别赞赏其部署、管理、配置和调试的简便性。在 Peer Insights 的评审中，86% 的用户推荐使用 CircleCI。平台还集成了 AI，帮助开发者在工作流程中进行调试并提供智能建议。&lt;/li>
&lt;/ul>
&lt;h4 id="劣势-3">劣势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>功能覆盖有限&lt;/strong>：CircleCI 的主要功能是优化开发者的构建和测试流程，但在 DevOps 生命周期的 Ops 阶段功能较弱。要部署完整的 CI/CD 解决方案，用户仍需结合其他工具或平台。&lt;/li>
&lt;li>&lt;strong>数据中心覆盖不足&lt;/strong>：CircleCI 目前的云数据中心仅限于美国和加拿大，对于有数据驻留需求的国际客户来说选择有限。&lt;/li>
&lt;li>&lt;strong>定价模式复杂&lt;/strong>：虽然 CircleCI 提供免费套餐，但随着使用量的增长，费用可能迅速增加。由于定价基于点卡（信用）消耗，客户在依赖该平台时需要仔细查看定价表。&lt;/li>
&lt;/ul>
&lt;h3 id="cloudbees">CloudBees
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/cloudbees.webp"
width="364"
height="318"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/cloudbees_hu_efbc346a1f4a62b1.webp 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/cloudbees_hu_8458dec4382ce191.webp 1024w"
loading="lazy"
alt="CloudBees"
class="gallery-image"
data-flex-grow="114"
data-flex-basis="274px"
>&lt;/p>
&lt;p>CloudBees 是魔力象限中的挑战者，其 DevOps 平台包括 CloudBees CI、CloudBees 持续交付与发布编排 (CD/RO)、特性管理和合规工具。&lt;/p>
&lt;p>CloudBees 主要在北美运营，同时在欧洲也有一定业务，客户涵盖多个行业。2023 年，CloudBees 加强了其平台的高可用性和扩展性架构，确保大规模企业能够持续高效地运行 CI/CD 流水线，提升负载管理和流水线执行的效率。&lt;/p>
&lt;h4 id="优势-4">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>持续合规支持&lt;/strong>：CloudBees 在支持高度合规的行业中表现出色。其合规工具帮助客户自动遵守多种安全标准，如 CIS、NIST 和 HIPAA 等，减少安全漏洞的风险。&lt;/li>
&lt;li>&lt;strong>强大的特性管理&lt;/strong>：CloudBees 是少数几家原生支持特性管理的 DevOps 平台之一，功能媲美第三方专用工具。随着用户对功能测试的需求增加，平台的简化和合规能力体现了价值，且提供区域数据保护。&lt;/li>
&lt;li>&lt;strong>客户参与度高&lt;/strong>：CloudBees 在客户参与和运营方面表现出色。这得益于其在 Jenkins 领域的深厚经验、CloudBees CI 和 University 项目的支持，以及其强大的企业客户群。客户评价也证明了这一点。&lt;/li>
&lt;/ul>
&lt;h4 id="劣势-4">劣势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>功能覆盖不足&lt;/strong>：CloudBees 平台主要优化了开发者的构建、测试和发布流程，但在 DevOps 生命周期的其他阶段（如版本控制、开发和工件管理）功能较弱，需要与其他工具整合才能实现完整的 DevOps 流程。&lt;/li>
&lt;li>&lt;strong>客户满意度较低&lt;/strong>：CloudBees 的 Peer Insights 评分为 4.3（满分 5 分），在同行中相对较低，客户对其文档质量和 Kubernetes 支持表现出不满。&lt;/li>
&lt;li>&lt;strong>Jenkins 的传统印象&lt;/strong>：尽管 CloudBees 基于 Jenkins 平台，但用户普遍认为它是一个传统工具。随着企业寻求更现代的开发工具，CloudBees 的营销策略未能有效吸引对云原生平台感兴趣的客户，这使得许多企业转向其他具有更广泛功能的平台。&lt;/li>
&lt;/ul>
&lt;h3 id="gitlab">GitLab
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/gitlab.webp"
width="364"
height="364"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/gitlab_hu_9093bc19d988eb07.webp 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/gitlab_hu_b629da9c795f02f0.webp 1024w"
loading="lazy"
alt="GitLab"
class="gallery-image"
data-flex-grow="100"
data-flex-basis="240px"
>&lt;/p>
&lt;p>GitLab 是魔力象限中的领导者，其 DevOps 平台包括 GitLab 和 GitLab Duo，涵盖了计划、源代码管理、CI、部署自动化、可观测性、应用安全测试、软件供应链安全、合规报告、价值流分析和事故管理等多项功能。&lt;/p>
&lt;p>GitLab 的业务遍布全球，客户群涵盖各行业的不同规模企业。2023 年，GitLab 对其平台进行了更新，新增了对生成式 AI、云开发环境、合规报告、价值流仪表板以及构建基础设施改进的支持。公司频繁发布新功能和安全更新，所有版本（托管、自管理和专用版）都能获得这些更新。&lt;/p>
&lt;h4 id="优势-5">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>内置安全功能强大&lt;/strong>：GitLab 持续扩展其安全能力，并通过收购如 Oxeye 这样的公司进一步加强了这些功能。这使 GitLab 能在 DevOps 安全领域保持领先地位，并提升了其在 2023 年应用安全测试魔力象限中的表现。&lt;/li>
&lt;li>&lt;strong>广泛的市场理解力&lt;/strong>：GitLab 提供了覆盖软件开发全生命周期的工具，从任务管理、计划，到代码库创建、云开发环境、解决方案安全以及部署，全面支持开发人员的工作。GitLab 的这一战略显著提升了其在企业开发者中的价值。&lt;/li>
&lt;li>&lt;strong>客户满意度高&lt;/strong>：在 Gartner Peer Insights 中，GitLab 的客户净推荐值非常高，92% 的用户愿意推荐 GitLab。客户尤其看重其全功能平台和对 DevSecOps 的全面支持。&lt;/li>
&lt;/ul>
&lt;h4 id="劣势-5">劣势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>销售策略不够灵活&lt;/strong>：GitLab 针对企业客户的折扣策略较为保守，尤其是在其高级产品方面。这对希望获得优惠定价的客户来说是个挑战。&lt;/li>
&lt;li>&lt;strong>单一产品模式&lt;/strong>：GitLab 将其 DevOps 平台作为一个整体产品出售，这对仅需要部分功能的客户来说可能不够灵活。虽然最近有所改进，客户可以为现有的 GitLab Ultimate 许可证添加企业敏捷规划功能，但整体选择依然有限。&lt;/li>
&lt;li>&lt;strong>文档和功能支持不足&lt;/strong>：GitLab 通过整合开源软件快速扩展了平台功能，但部分新功能的文档支持较弱，且功能质量参差不齐。此外，一些新功能还处于测试版，且尚未给出明确的全面上线时间表。&lt;/li>
&lt;/ul>
&lt;h3 id="harness">Harness
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/harness-platform.webp"
width="364"
height="312"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/harness-platform_hu_bc25db20101bdc47.webp 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/harness-platform_hu_2743177a5555607e.webp 1024w"
loading="lazy"
alt="Harness"
class="gallery-image"
data-flex-grow="116"
data-flex-basis="280px"
>&lt;/p>
&lt;p>Harness 是本魔力象限的领导者之一，其 DevOps 平台包括代码库、持续集成、持续交付和 GitOps、特性管理、服务可靠性管理、混沌工程、软件工程洞察、内部开发者门户、安全测试编排、基础设施即代码管理、软件供应链保障和云成本管理等模块。&lt;/p>
&lt;p>Harness 的业务遍及北美、欧洲和印度，客户主要为来自多个行业的大型组织，分布在北美、欧洲和亚洲。2023 年，Harness 通过收购 Propelo 扩展了其软件工程智能分析能力。同时，Harness 推出了基于开源项目 Gitness 的代码库、基于 Backstage 的内部开发者门户 (IDP) 和基础设施即代码管理 (IaCM)。此外，通过 Harness AIDA 引入生成式 AI，使平台具备了多种应用场景，例如安全漏洞检测与修复。&lt;/p>
&lt;h4 id="优势-6">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>云原生支持强大&lt;/strong>：Harness 为平台工程团队提供了丰富的功能，能够全面支持云原生 DevOps。近期收购的 Armory 等公司进一步增强了其平台能力，覆盖了整个产品交付生命周期。&lt;/li>
&lt;li>&lt;strong>迅速响应市场需求&lt;/strong>：在过去一年中，Harness 增加了更多 DevOps 特定功能，包括推出 Harness 代码库，减少了对其他工具的依赖；通过 IaCM 扩展了 Terraform 的使用，同时加强了安全性和管理控制；并通过 Harness IDP 更好地支持平台工程团队。&lt;/li>
&lt;li>&lt;strong>特性管理功能强大&lt;/strong>：Harness 平台自带的特性管理功能可取代专用的第三方工具。它使产品团队能够通过将发布与部署分离，实现渐进式交付，并提供特性监控和报告，帮助识别和移除不再需要的功能标志（功能开关）。&lt;/li>
&lt;/ul>
&lt;h4 id="劣势-6">劣势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>客户满意度欠佳&lt;/strong>：根据 Gartner Peer Insights 的反馈，Harness 在集成、部署、服务支持和产品功能方面的评分低于其他竞争对手。客户主要不满的是文档不完整以及客户支持的不足。&lt;/li>
&lt;li>&lt;strong>数据驻留限制&lt;/strong>：目前 Harness 仅提供美国地区的云托管服务，这对需要满足数据驻留合规要求的非美国客户来说是一个难题。&lt;/li>
&lt;li>&lt;strong>学习曲线陡峭&lt;/strong>：随着 Harness 不断扩展其 DevSecOps 支持，用户发现难以跟上新功能的更新节奏，尤其是平台的界面不够直观，且缺乏详细的最佳实践和标准使用指导。&lt;/li>
&lt;/ul>
&lt;h3 id="jetbrains">JetBrains
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/teamcity.webp"
width="256"
height="256"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/teamcity_hu_850b4c4f8dc1400c.webp 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/teamcity_hu_a13582a5be5d9d21.webp 1024w"
loading="lazy"
alt="JetBrains"
class="gallery-image"
data-flex-grow="100"
data-flex-basis="240px"
>&lt;/p>
&lt;p>JetBrains 是本次魔力象限中的一个利基玩家，其 DevOps 平台由 Space、TeamCity 和 YouTrack 组成。（在本次评估过程中，JetBrains 宣布将停止支持 Space，并计划推出新产品。）此外，JetBrains 拥有多款面向不同编程语言的集成开发环境 (IDE)。YouTrack 主要提供项目管理和知识管理功能，适用于传统和敏捷开发方式；而 TeamCity 是 JetBrains 的 CI/CD 平台，可在本地部署或云上使用。&lt;/p>
&lt;p>JetBrains 的业务遍及全球，但未公布其客户的具体规模或细节。自 2023 年以来，JetBrains 推出了静态代码分析工具 Qodana，并在其 IDE 和 YouTrack 中集成了生成式 AI 功能，帮助开发者减少上下文切换，提升工作体验。&lt;/p>
&lt;h4 id="优势-7">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>平台安全性强&lt;/strong>：JetBrains 在平台安全性方面表现突出，采用了全面的“红队”安全策略。在过去一年中，JetBrains 保持了零安全漏洞的记录。&lt;/li>
&lt;li>&lt;strong>协作功能出色&lt;/strong>：JetBrains 的 DevOps 平台在支持软件开发团队的协作与沟通方面表现优异。据 Gartner 2024 年的调查，开发人员普遍认为这类工具是提高生产力的关键。&lt;/li>
&lt;li>&lt;strong>市场认知度高&lt;/strong>：JetBrains 在 IDE 市场有很强的影响力，且是最早提供 CI 工具的厂商之一，这让其在开发者社区中获得了较高的认知度。&lt;/li>
&lt;/ul>
&lt;h4 id="劣势-7">劣势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>创新能力不足&lt;/strong>：JetBrains 的主要精力集中在其 IDE 产品上，因此在 DevOps 工具的创新上显得相对不足。公司也没有通过收购其他企业来增强创新能力。&lt;/li>
&lt;li>&lt;strong>销售执行力和定价策略存疑&lt;/strong>：与其他供应商相比，JetBrains 在销售执行和定价策略上表现一般。客户可能会通过与其合作伙伴建立联系来谈判购买条款。&lt;/li>
&lt;li>&lt;strong>市场营销战略有限&lt;/strong>：与竞争对手相比，JetBrains 的市场营销策略相对薄弱，这可能会影响其在市场上推行愿景的能力。&lt;/li>
&lt;/ul>
&lt;h3 id="jfrog">JFrog
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/jfrog-2024-03-28.webp"
width="225"
height="225"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/jfrog-2024-03-28_hu_4162687b4cfbf9c0.webp 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/jfrog-2024-03-28_hu_82f14b63c326ce28.webp 1024w"
loading="lazy"
alt="JFrog"
class="gallery-image"
data-flex-grow="100"
data-flex-basis="240px"
>&lt;/p>
&lt;p>JFrog 是本次魔力象限中的一位挑战者，其 DevOps 平台包括 JFrog Artifactory、JFrog Pipelines、JFrog Distribution、JFrog Security Essentials（Xray）、JFrog Advanced Security、JFrog Curation、JFrog Connect 和 JFrog Catalog。&lt;/p>
&lt;p>JFrog 的业务主要集中在北美和欧洲，拥有来自各行业、不同规模的客户。自 2023 年以来，JFrog 新增了主动拦截恶意或高风险开源包的功能，并提供了这些新包的审计跟踪。此外，JFrog 还增加了机器学习模型的管理功能，并进一步提升了发布生命周期的管理能力。&lt;/p>
&lt;h4 id="优势-8">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>工件管理的广泛认可&lt;/strong>：Artifactory 是 JFrog 最为人熟知的产品，它在二进制工件的管理和分发方面拥有广泛的用户基础。JFrog 通过新增例如 ML 模型管理等功能，不断提升其平台的能力，并借此扩大 DevOps 平台的市场。&lt;/li>
&lt;li>&lt;strong>对安全需求的快速响应&lt;/strong>：JFrog 针对软件供应链的安全性需求，推出了 Xray、Curation 和 Advanced Security 等工具，帮助客户提高安全性和可审计性。此外，JFrog Pipelines 满足了客户对于简化工具链的需求。&lt;/li>
&lt;li>&lt;strong>出色的客户支持和体验&lt;/strong>：与同类供应商相比，JFrog 在客户满意度、服务质量和技术支持方面表现突出。例如，所有客户支持问题都会自动进行总监级别的升级处理。&lt;/li>
&lt;/ul>
&lt;h4 id="劣势-8">劣势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>CI/CD 能力较弱&lt;/strong>：虽然 JFrog 主要专注于软件供应链管理，但其 CI/CD 工具 JFrog Pipelines 的能力相对较弱。大多数客户虽然使用 JFrog Artifactory，但仍选择与第三方 CI/CD 解决方案集成，而非使用 Pipelines。&lt;/li>
&lt;li>&lt;strong>协作与规划工具的缺乏&lt;/strong>：在协作和规划工具方面，JFrog 落后于竞争对手，公司的创新更多集中在 Artifactory 的功能扩展，如 ML 模型管理和安全性提升。&lt;/li>
&lt;li>&lt;strong>合作伙伴渠道发展有限&lt;/strong>：尽管 JFrog 拥有全球合作伙伴，但通过合作伙伴渠道的销售额仅占总销售额的一小部分，渠道建设还有待加强。&lt;/li>
&lt;/ul>
&lt;h3 id="microsoft">Microsoft
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/microsoft-teams.webp"
width="216"
height="46"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/microsoft-teams_hu_284047780c50bac8.webp 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/microsoft-teams_hu_a4c8dcce109668f2.webp 1024w"
loading="lazy"
alt="Microsoft"
class="gallery-image"
data-flex-grow="469"
data-flex-basis="1126px"
>&lt;/p>
&lt;p>Microsoft 是本次魔力象限中的领导者，提供 GitHub 和 Azure DevOps 两个独立的 DevOps 平台。当前，Microsoft 更加专注于 GitHub 平台，平台功能包括 Dependabot、GitHub Actions、GitHub Advisory Database、GitHub Codespaces、GitHub Copilot、GitHub Discussions、GitHub Issues、GitHub Packages、GitHub Projects 和 GitHub Repositories。&lt;/p>
&lt;p>Microsoft 的业务遍布全球，服务于来自各行各业的客户。在 2023 年，Microsoft 扩展了 GitHub Copilot 的功能，改进了 GitHub Codespaces 的所有权和计费管理，新增了 GitHub Projects 的模板和 Copilot 集成，并提升了与 Azure DevOps（例如 Azure Boards）的集成。为提升性能和能源效率，Microsoft 还增加了 macOS runners 和对 ARM64 的支持。此外，GitHub 在安全功能上继续提升，并成为 Gartner 2023 年应用安全测试魔力象限中的挑战者。&lt;/p>
&lt;h4 id="优势-9">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>庞大的开发者社区&lt;/strong>：Microsoft 拥有强大的开发者基础。根据 Gartner Peer Insights 数据，96% 的评测者推荐使用 GitHub，这在所有平台中得分最高。GitHub 也是全球最大开源项目的集合地，Microsoft 利用其强大的开发者社区，通过反馈和测试项目来持续改进产品功能。&lt;/li>
&lt;li>&lt;strong>生成式 AI 的创新&lt;/strong>：通过 GitHub Copilot，Microsoft 引入了大量创新功能，推动了生成式 AI 在 DevOps 流程中的应用。GitHub Copilot 的吸引力也是许多用户选择投资 GitHub 平台的重要原因之一。&lt;/li>
&lt;li>&lt;strong>协作功能的突出表现&lt;/strong>：GitHub 平台高度重视团队协作，其功能如 Discussions、支持自动化工作流的 Actions、强大的代码审查工具和移动设备操作支持，凸显了其社交编码的理念。&lt;/li>
&lt;/ul>
&lt;h4 id="劣势-9">劣势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>平台选择的困惑&lt;/strong>：GitHub 和 Azure DevOps 是两个独立平台，某些功能有所重叠，另一些则各有特色。虽然 GitHub 是创新的核心，但对于 Azure DevOps 的大批用户来说，平台定位信息可能并不清晰。Azure DevOps 的发展方向主要集中在与 GitHub 的功能整合上。&lt;/li>
&lt;li>&lt;strong>使用复杂度&lt;/strong>：与某些 CI 工具相比，GitHub 缺乏可视化的管道构建界面，因此如果用户不熟悉 YAML 语言，学习曲线较为陡峭。尽管 GitHub 支持多种集成，但其设置和管理过程可能较为复杂。&lt;/li>
&lt;li>&lt;strong>缺少高层次管理功能&lt;/strong>：虽然 GitHub 适合大型团队使用，并专注于提升开发者体验，但它在满足工程管理或项目组合管理者的需求方面相对不足，例如缺少对价值流指标或企业级敏捷开发的支持。用户通常需要结合使用 Azure Boards 才能获得这些功能。&lt;/li>
&lt;/ul>
&lt;h3 id="red-hat">Red Hat
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/red-hat-openshift-container-platform.webp"
width="364"
height="364"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/red-hat-openshift-container-platform_hu_d0228c2537db7f0.webp 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-devops-platforms/red-hat-openshift-container-platform_hu_a82b4af9f86a1242.webp 1024w"
loading="lazy"
alt="Red Hat"
class="gallery-image"
data-flex-grow="100"
data-flex-basis="240px"
>&lt;/p>
&lt;p>Red Hat 是本次魔力象限中的挑战者。它通过 Red Hat OpenShift 和 Red Hat Ansible Automation Platform 提供 DevOps 功能支持，涵盖 CI/CD 和基础设施自动化。这一平台利用云开发环境、标准模板和 playbooks，支持平台工程的实施，基于 Kubernetes、Tekton、Ansible 和 Argo CD 等开源技术构建。&lt;/p>
&lt;p>Red Hat 的业务遍布全球，客户来自各个行业和不同规模的企业。在 2023 年，Red Hat 发布了 Red Hat Developer Hub，这是一个基于 Backstage 的内部开发者门户。同时，Red Hat 将 IBM watsonX 集成到其 DevOps 平台中，提供基于大语言模型的代码辅助功能。Red Hat 还推出了 Event-Driven Ansible，并增加了集成功能，帮助应对实时自动化场景，减少重复工作。&lt;/p>
&lt;h4 id="优势-10">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>全球覆盖&lt;/strong>：Red Hat 的 DevOps 平台作为 SaaS 服务在全球范围内（除中国外）均可使用。&lt;/li>
&lt;li>&lt;strong>支持混合云与多云&lt;/strong>：借助 Red Hat Ansible Automation Platform 和 Red Hat OpenShift，用户可以将应用程序部署到各种云平台，支持自动扩展，并拥有从边缘设备到 IBM 主机的强大管理工具。&lt;/li>
&lt;li>&lt;strong>服务承诺&lt;/strong>：Red Hat 提供的服务质量协议（SLA）相较于其他供应商，具备更快速的响应时间和更高的服务可用性。&lt;/li>
&lt;/ul>
&lt;h4 id="劣势-10">劣势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>OpenShift 定向&lt;/strong>：Red Hat 的 DevOps 平台主要围绕 OpenShift 容器平台构建。使用其他容器管理平台的用户可能会觉得它比本次象限中的其他供应商更难实施。&lt;/li>
&lt;li>&lt;strong>报告功能有限&lt;/strong>：虽然 Red Hat 的各个组件能够收集丰富的数据，但缺乏一个统一的报告系统。它集成了 Prometheus 来进行数据收集，需要通过 Grafana 来构建可视化仪表板。&lt;/li>
&lt;li>&lt;strong>Ansible 与第三方工具集成较少&lt;/strong>：尽管 Red Hat Ansible 可以与多种第三方工具集成，但与其他供应商的 DevOps 平台相比，其直接支持的集成数量较少。&lt;/li>
&lt;/ul>
&lt;h2 id="供应商的新增与删除">供应商的新增与删除
&lt;/h2>&lt;p>随着市场的不断变化，我们会定期审查并调整魔力象限的纳入标准。因此，魔力象限中的供应商组合可能会随时间变化。某个供应商在某一年出现，下一年没有出现，并不一定意味着我们对该供应商的看法发生了变化。这可能更多反映了市场的变化，从而导致评估标准的调整，或是供应商自身业务重心的改变。&lt;/p>
&lt;h3 id="新增">新增
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>Buildkite&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h3 id="删除">删除
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>Bitrise&lt;/strong>：Gartner 将 2024 年的魔力象限焦点收窄至不包括专注于单一 DevOps 用例的供应商，例如 Bitrise 专注于移动开发，而是更多关注具有通用功能的平台。&lt;/li>
&lt;li>&lt;strong>Codefresh&lt;/strong>：该供应商未能在 Gartner 定义的客户兴趣指标（CII）中进入前 20 名，因此未被纳入。&lt;/li>
&lt;li>&lt;strong>Google Cloud Platform&lt;/strong>：该供应商已停止提供专门的 DevOps 平台服务。&lt;/li>
&lt;li>&lt;strong>VMware&lt;/strong>：该供应商未达到客户数量和收入增长的相关标准。&lt;/li>
&lt;/ul>
&lt;h2 id="纳入与排除标准">纳入与排除标准
&lt;/h2>&lt;p>为了确保魔力象限集中评估市场上最具影响力的供应商，Gartner 将供应商数量限制为 20 家。&lt;/p>
&lt;p>以下为本次评估中，供应商必须满足的纳入标准。&lt;/p>
&lt;h3 id="市场参与标准">市场参与标准
&lt;/h3>&lt;p>截至 2024 年 1 月 1 日，入选魔力象限的 DevOps 平台供应商需要满足以下条件：&lt;/p>
&lt;ul>
&lt;li>提供一个正式发布的、可供购买的 DevOps 平台，并且在公开的定价页面中可以找到该产品。&lt;/li>
&lt;li>直接向客户销售解决方案，并提供至少一级的支持，无需客户购买额外的专业服务支持。&lt;/li>
&lt;li>展示积极的产品规划和市场销售策略。&lt;/li>
&lt;li>提供全面的客户支持，包括电话、邮件和网络服务，且支持英语。&lt;/li>
&lt;li>客户群体至少有 10% 分布在以下三个地区中的两个：
&lt;ul>
&lt;li>美国和加拿大&lt;/li>
&lt;li>欧洲（包括英国和爱尔兰）&lt;/li>
&lt;li>亚太地区&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="平台功能标准">平台功能标准
&lt;/h3>&lt;p>DevOps 平台需要具备以下功能：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>持续集成（CI）&lt;/strong>：支持代码的持续构建和验证，包括自动化测试、安全性和合规扫描。&lt;/li>
&lt;li>&lt;strong>持续交付（CD）与发布管理&lt;/strong>：支持无门槛的持续部署以及满足合规性要求的门控审批机制。&lt;/li>
&lt;li>&lt;strong>集成的安全开发与团队协作平台&lt;/strong>，能够在多个用户角色之间提供统一的工作流可视化。&lt;/li>
&lt;li>&lt;strong>提供价值流度量工具&lt;/strong>：用于衡量整个软件交付过程中的工作流效率和价值传递（例如，吞吐量指标、DORA 指标）。&lt;/li>
&lt;li>&lt;strong>安全软件交付&lt;/strong>：将安全功能作为软件开发生命周期（SDLC）中的核心部分进行管理和协调。&lt;/li>
&lt;/ul>
&lt;h3 id="表现纳入标准">表现纳入标准
&lt;/h3>&lt;p>供应商必须满足以下财务标准（以美元为单位）。默认采用公认会计准则（GAAP）：&lt;/p>
&lt;ol>
&lt;li>DevOps 平台在截至 2024 年 1 月前的 12 个月内，年收入需达到至少 6000 万美元。同时，该平台应拥有至少 200 名付费的实际生产环境用户（不包括托管服务提供商），每个客户平均需使用至少 75 个席位的 CI/CD 功能。&lt;/li>
&lt;li>或者，DevOps 平台在 2023 日历年内年收入需至少达到 1500 万美元，并且与 2022 年相比，新增了 35 名净新客户，这些客户均使用了 CI/CD 核心功能。&lt;/li>
&lt;/ol>
&lt;p>此外，供应商必须在 Gartner 定义的客户兴趣指标（CII）中位居前 20 名。CII 基于以下平衡的指标计算：&lt;/p>
&lt;ul>
&lt;li>Gartner 客户的搜索、查询量和价格请求。&lt;/li>
&lt;li>在 Gartner 同行洞察论坛中，作为其他供应商的竞争对手出现的频率（截至 2024 年 1 月 1 日）。&lt;/li>
&lt;li>在 Gartner 同行洞察中的评分和提及频率。&lt;/li>
&lt;li>主要市场创新、产品更新、行业奖项等方面的表现。&lt;/li>
&lt;li>企业的重大动态（如并购活动）。&lt;/li>
&lt;li>在美洲、欧洲和亚太地区的招聘网站上，相关岗位的发布数量。&lt;/li>
&lt;/ul>
&lt;h3 id="排除标准">排除标准
&lt;/h3>&lt;p>以下供应商不被纳入分析：&lt;/p>
&lt;ul>
&lt;li>主要用于低代码应用程序、业务应用程序或 SaaS 应用交付的 DevOps 平台（如 Salesforce、Microsoft Dynamics 365、Oracle、SAP、ServiceNow 的开发或定制）。这类平台的市场需求和功能与本魔力象限定义的不同。&lt;/li>
&lt;li>平台仅作为定制软件开发或专业服务的一部分销售。&lt;/li>
&lt;/ul>
&lt;h3 id="荣誉提名">荣誉提名
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>Alauda&lt;/strong>：Alauda 提供基于 Kubernetes 的 DevOps 平台，称为 Alauda Container Platform (ACP)，利用开源组件为云原生开发和交付提供集成功能，适合平台工程应用。功能还包括容器管理、Kubernetes 集群管理、服务网格、多云管理等。Alauda 未满足 Gartner 的 CII 标准，因此未入选本魔力象限。&lt;/li>
&lt;li>&lt;strong>Bitrise&lt;/strong>：Bitrise 提供专为移动平台构建应用的 DevOps 平台，但未能满足本魔力象限的市场定义要求。&lt;/li>
&lt;li>&lt;strong>CodeNOW&lt;/strong>：CodeNOW 通过开源组件提供云原生持续交付 (CD) 平台。CodeNOW 未达到本魔力象限的最低收入和增长要求。&lt;/li>
&lt;li>&lt;strong>华为&lt;/strong>：华为 CodeArts 是一个 DevSecOps 平台，覆盖整个软件开发生命周期，具备需求管理、源代码管理、自动化测试等功能。尽管 CodeArts 在中国市场表现突出，但其未能满足全球化扩展要求。&lt;/li>
&lt;li>&lt;strong>Opsera&lt;/strong>：Opsera 提供一个统一的 DevOps 平台，覆盖整个 SDLC，集成了开源工具和预配置工作流，提供软件交付指标的可视化。Opsera 未达到最低收入和增长要求，因此未入选本魔力象限。&lt;/li>
&lt;/ul></description></item><item><title>嵌套虚拟化：在 Azure Ubuntu VM 中运行 VirtualBox 虚拟机</title><link>https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/</link><pubDate>Fri, 02 Aug 2024 16:28:51 +0800</pubDate><guid>https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/</guid><description>&lt;img src="https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/pexels-cottonbro-4966171.webp" alt="Featured image of post 嵌套虚拟化：在 Azure Ubuntu VM 中运行 VirtualBox 虚拟机" />&lt;h2 id="azure-支持嵌套虚拟化">Azure 支持嵌套虚拟化
&lt;/h2>&lt;p>嵌套虚拟化是一种经常在物理服务器实验环境中所使用到的场景。例如，你可以在 VMware ESXi 或者 Hyper-V 虚拟机中运行 ESXi，KVM，Hyper-V 等一种或者多种虚拟机管理服务器，然后最内层的 Hypervisor 上运行虚拟机。在 Azure 的虚拟机中，运行 VirtualBox ，重建 VirtualBox 的虚拟机测试环境，就这种情况。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/a085cd14-acfe-42ba-aec9-470a149cb855.webp"
width="168"
height="107"
srcset="https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/a085cd14-acfe-42ba-aec9-470a149cb855_hu_351ede347f970671.webp 480w, https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/a085cd14-acfe-42ba-aec9-470a149cb855_hu_391a75cc99a47a4e.webp 1024w"
loading="lazy"
alt="Azure 嵌套虚拟化"
class="gallery-image"
data-flex-grow="157"
data-flex-basis="376px"
>&lt;/p>
&lt;p>Azure 是在 2017 年 1 月，宣布支持两个新的可支持嵌套虚拟化的机型 Dv3 和 Ev3。「参见：&lt;a class="link" href="https://azure.microsoft.com/en-us/blog/nested-virtualization-in-azure/%e3%80%8d%ef%bc%9b%e5%9c%a8%e5%88%9b%e5%bb%ba%e8%99%9a%e6%8b%9f%e6%9c%ba%e6%97%b6%ef%bc%8c%e4%bd%a0%e9%9c%80%e8%a6%81%e5%9c%a8" target="_blank" rel="noopener"
>https://azure.microsoft.com/en-us/blog/nested-virtualization-in-azure/」；在创建虚拟机时，你需要在&lt;/a> Azure CLI 或者 Azure PowerShell 中设置 &lt;code>--nested-virtualization&lt;/code> 参数。或者在 Azure 门户中，需要在创建虚拟机时选择 &lt;code>Dv3 或者 Ev3&lt;/code> 系列的虚拟机。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/88616c64-c513-44ac-8259-c201e1798106.webp"
width="750"
height="413"
srcset="https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/88616c64-c513-44ac-8259-c201e1798106_hu_acfbc00d79e7d47f.webp 480w, https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/88616c64-c513-44ac-8259-c201e1798106_hu_9e2d8c4b018daaa4.webp 1024w"
loading="lazy"
alt="嵌套虚拟化"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="435px"
>&lt;/p>
&lt;p>注意：如果没有选择合适于嵌套虚拟化的机型，你依然可以在虚拟机中安装 VirtualBox，可以创建虚拟机，但是无法正常启动运行嵌套的虚拟机。&lt;/p>
&lt;h2 id="创建-azure-虚拟机">创建 Azure 虚拟机
&lt;/h2>&lt;p>在 Azure 门户中，选择 &lt;code>虚拟机&lt;/code>，然后选择 &lt;code>创建&lt;/code>，选择 &lt;code>Dv3 或者 Ev3&lt;/code> 系列的虚拟机，其它相关选项如下图所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/2024-07-27_23-01-57.webp"
width="950"
height="1312"
srcset="https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/2024-07-27_23-01-57_hu_7ab2b1de6cac7232.webp 480w, https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/2024-07-27_23-01-57_hu_9b7c7c5ae58c3dda.webp 1024w"
loading="lazy"
alt="创建虚拟机"
class="gallery-image"
data-flex-grow="72"
data-flex-basis="173px"
>&lt;/p>
&lt;ol>
&lt;li>安全类型：这里选择 “Standard” ，这里默认的是 “Trusted launch virtual machines” , 如果选择了默认选项，嵌套虚拟机的虚拟机是无法正常启动的。&lt;/li>
&lt;li>在选择机型的时候，选择 &lt;code>D&lt;/code> 或者 &lt;code>E&lt;/code> 开头的，并且是 &lt;code>v3&lt;/code> 结尾的系列。&lt;/li>
&lt;li>这里操作系统的选择的是 &lt;code>Ubuntu Server 22.04 LTS&lt;/code>，Ubuntu 操作系统可以使用 VirtualBox 或者 Kvm 等虚拟化技术。&lt;/li>
&lt;/ol>
&lt;p>在使用了上面的选项之后，你就可以在 Azure 虚拟机中正常安装和使用虚拟化软件了。就可以使用你所选择的虚拟机管理软件，在 Ubuntu 操作系统中运行虚拟机测试环境。当然你也可以使用 Windows Server 系列操作系统中的 Hyper-V 虚拟化技术。&lt;/p>
&lt;h2 id="用-vagrant-管理虚拟机环境">用 Vagrant 管理虚拟机环境
&lt;/h2>&lt;p>Vagrant 是一个用于构建和管理虚拟机环境的工具，它可以用于在虚拟机中自动化的安装软件，配置网络等操作。Vagrant 使用 Ruby 语言编写，使用 Ruby 的 DSL 语言来描述虚拟机的配置。&lt;/p>
&lt;p>请参考 Vagrant 的官方文档，学习如何安装和 Vagrant 来管理虚拟机环境。&lt;/p>
&lt;p>在 Ubuntu 系统中，可以通过以下命令安装 VirtualBox 和 Vagrant。&lt;/p>
&lt;h3 id="安装-virtualbox-和-ansible">安装 VirtualBox 和 Ansible
&lt;/h3>&lt;ol>
&lt;li>更新系统软件包列表：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>安装 VirtualBox：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo apt-get install virtualbox ansible
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="安装-vagrant">安装 Vagrant
&lt;/h3>&lt;ol>
&lt;li>下载 Vagrant 的 Debian 安装包。请访问 &lt;a class="link" href="https://www.vagrantup.com/downloads" target="_blank" rel="noopener"
>Vagrant 官方下载页面&lt;/a> 获取最新版本的链接。例如：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">wget https://releases.hashicorp.com/vagrant/2.3.4/vagrant_2.3.4_x86_64.deb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>使用 &lt;code>dpkg&lt;/code> 安装 Vagrant：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo dpkg -i vagrant_2.3.4_x86_64.deb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>如果安装过程中出现依赖问题，可以使用以下命令解决：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo apt-get install -f
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="验证安装">验证安装
&lt;/h3>&lt;p>安装完成后，可以通过以下命令验证安装是否成功：&lt;/p>
&lt;ol>
&lt;li>检查 VirtualBox 版本：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">virtualbox --help
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>检查 Vagrant 版本：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">vagrant --version
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>检查 Ansible 版本：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ansible --version
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>通过这些步骤，你可以在 Ubuntu 系统中安装并配置好 VirtualBox、ansible 和 Vagrant。&lt;/p>
&lt;h3 id="创建-vagrantfile">创建 Vagrantfile
&lt;/h3>&lt;p>Vagrantfile 是 Vagrant 的配置文件，用于描述虚拟机的配置。你可以使用 Vagrantfile 来定义虚拟机的操作系统、网络、共享文件夹等配置。&lt;/p>
&lt;p>以下是一个简单的 Vagrantfile 示例：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -*- mode: ruby -*-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vi: set ft=ruby :&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="no">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;geerlingguy/rockylinux8&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Provisioning configuration for Ansible.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">provision&lt;/span> &lt;span class="s2">&amp;#34;ansible&amp;#34;&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">ansible&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ansible&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">playbook&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;playbook.yml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>z这个 Vagrantfile 使用 &lt;code>geerlingguy/rockylinux8&lt;/code> 作为基础镜像，并使用 Ansible 来配置虚拟机。你可以根据自己的需求修改 Vagrantfile。&lt;/p>
&lt;p>下面创建一个简单的 Ansible playbook 文件 &lt;code>playbook.yml&lt;/code>：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">all&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">become&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Ensure chrony (for time synchronization) is installed.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dnf&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">chrony&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">state&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">present&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Ensure chrony is running.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">chronyd&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">state&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">started&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># The same as the above play, but in super-compact form!&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">all&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">become&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">dnf&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">name=chrony state=present&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">service&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">name=chronyd state=started enabled=yes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个 playbook 会安装 &lt;code>chrony&lt;/code> 时间同步服务，并启动该服务。&lt;/p>
&lt;p>这个测试示例的目的是：在 Ubuntu 虚拟机中运行 Vagrant，使用 Vagrantfile 来配置虚拟机，使用 Ansible playbook 来配置虚拟机。&lt;/p>
&lt;h3 id="启动-vagrant">启动 Vagrant
&lt;/h3>&lt;p>在包含 Vagrantfile 的目录中，运行以下命令启动 Vagrant：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">vagrant up
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Vagrant 会根据 Vagrantfile 的配置创建虚拟机，并使用 Ansible playbook 配置虚拟机。&lt;/p>
&lt;h3 id="连接到虚拟机">连接到虚拟机
&lt;/h3>&lt;p>使用以下命令连接到虚拟机：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">vagrant ssh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>登录到虚拟机后，你可以验证 &lt;code>chrony&lt;/code> 服务是否已经安装并运行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">systemctl status chronyd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果一切正常，你应该看到 &lt;code>chronyd&lt;/code> 服务已经启动。&lt;/p>
&lt;p>使用 vagrant 查看虚拟机的状态。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">vagrant status
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用 virtualbox 查看虚拟机的状态。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">vboxmanage list vms
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用 virtualbox 查看虚拟机的详细信息。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">vboxmanage showvminfo &amp;lt;vm-name&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>到目前为止，我们成功的完成了 Azure Ubuntu 虚拟机 + virtualBox 虚拟化 + vagrant + Ansible 的环境搭建。这是一个非常好的学习和开发环境，你可以在这个环境中学习DevOps技术，Ansible 自动化运维管理的知识。&lt;/p>
&lt;h2 id="推荐学习资源">推荐学习资源
&lt;/h2>&lt;p>强烈推荐这本书《&lt;a class="link" href="https://www.ansiblefordevops.com/" target="_blank" rel="noopener"
>Ansible for DevOps&lt;/a>》，这是一本非常好的 Ansible 入门书籍，作者 Jeff Geerling 是一位非常有经验的 DevOps 工程师，他在这本书中详细介绍了 Ansible 的基本概念和高级用法，非常适合初学者学习。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/ansible-for-devops-cover-2x.webp"
width="593"
height="782"
srcset="https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/ansible-for-devops-cover-2x_hu_843347e374ff5103.webp 480w, https://martinliu.cn/blog/nested-virtualization-ubuntu-run-virutalbox-azure-vm/ansible-for-devops-cover-2x_hu_8015cb1713430674.webp 1024w"
loading="lazy"
alt="Ansible for DevOps"
class="gallery-image"
data-flex-grow="75"
data-flex-basis="181px"
>&lt;/p>
&lt;ul>
&lt;li>书的代码库：&lt;a class="link" href="https://github.com/geerlingguy/ansible-for-devops.git" target="_blank" rel="noopener"
>https://github.com/geerlingguy/ansible-for-devops.git&lt;/a>&lt;/li>
&lt;li>书的全文：&lt;a class="link" href="https://github.com/geerlingguy/ansible-for-devops-manuscript.git" target="_blank" rel="noopener"
>https://github.com/geerlingguy/ansible-for-devops-manuscript.git&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>经过我的测试，Azure 的 Ubuntu 虚拟机中运行的 VirtualBox 虚拟机，可以正常运行，但是性能会有所下降。请选择具有足够内存和 CPU 的机型，加快 Ansible playbook 的执行速度。在有些时候也发现：嵌套虚拟机的网络下载速度非常慢，这可能是 Azure 的网络问题，或者是虚拟机的网络配置问题。在网络速度上应该还有优化的空间。&lt;/p>
&lt;p>❤️ Photo by cottonbro studio: &lt;a class="link" href="https://www.pexels.com/photo/2-blue-and-yellow-ceramic-owl-figurines-4966171/" target="_blank" rel="noopener"
>https://www.pexels.com/photo/2-blue-and-yellow-ceramic-owl-figurines-4966171/&lt;/a>&lt;/p></description></item><item><title>平台工程团队如何利用 AI 增强 DevOps</title><link>https://martinliu.cn/blog/pe-team-augment-devops-with-ai/</link><pubDate>Wed, 05 Jun 2024 16:36:07 +0800</pubDate><guid>https://martinliu.cn/blog/pe-team-augment-devops-with-ai/</guid><description>&lt;img src="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/pexels-pavel-danilyuk-8439093.webp" alt="Featured image of post 平台工程团队如何利用 AI 增强 DevOps" />&lt;blockquote>
&lt;p>本文来源 Gartner ：&lt;a class="link" href="https://www.gartner.com/doc/reprints?id=1-2G9VK5IK&amp;amp;ct=240117&amp;amp;st=sb" target="_blank" rel="noopener"
>《How Platform Engineering Teams Can Augment DevOps With AI》&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h2 id="概述">概述
&lt;/h2>&lt;h3 id="主要发现">主要发现
&lt;/h3>&lt;ul>
&lt;li>许多组织已经在使用 AI 编码助手、AI 测试工具和 AIOps 平台来优化 DevOps 的特定活动。然而，要缩短整体交付时间，必须识别并克服软件交付各阶段的瓶颈。&lt;/li>
&lt;li>生成式 AI 为在软件开发生命周期 (SDLC) 的多个阶段中，减少开发者摩擦，并提升开发者体验方面，带来了新机遇。这些摩擦包括：对代码库的理解不足，以及调试、代码审查和根本原因分析中花费的大量时间。&lt;/li>
&lt;li>提升软件交付流程的效率需要优化和协调 SDLC 的所有阶段。常见的低效表现包括：长时间的构建过程、分析构建流水线错误、变更影响分析和缓慢的事件响应。&lt;/li>
&lt;li>AI 提供了传统自动化无法比拟的优势，帮助产品团队以更可靠、可持续和成本效益高的方式，来管理其软件交付基础设施。&lt;/li>
&lt;/ul>
&lt;h3 id="建议">建议
&lt;/h3>&lt;p>推动平台工程计划的软件工程领导者应：&lt;/p>
&lt;ul>
&lt;li>通过识别和优先解决软件交付流程中的瓶颈，确定适合的 AI 应用场景，从而系统地改进 SDLC。注意供应商的“AI 洗涤”现象，避免在传统自动化手段已经足够的情况下，还要使用 AI 技术进行过度设计。&lt;/li>
&lt;li>通过支持 AI 增强的工作流来改善开发者体验，减少认知负担，帮助开发者在开发、交付和运营阶段实现流畅的工作状态。&lt;/li>
&lt;li>通过将 AI 优化集成到 DevOps 流程中，提高各个 SDLC 活动的反馈效率。&lt;/li>
&lt;li>在内部开发平台中，提供自助式 AI 基础设施管理能力，以优化软件交付基础设施。&lt;/li>
&lt;/ul>
&lt;h2 id="战略规划假设">战略规划假设
&lt;/h2>&lt;p>预计到2027年，使用 AI 增强 SDLC 每个阶段的平台工程团队的比例将从 5% 增至 40%。&lt;/p>
&lt;h2 id="介绍">介绍
&lt;/h2>&lt;p>随着 AI 编码助手和 ChatGPT 的推出，软件开发成为生成式 AI 的主要应用领域之一。在 2023 年 Gartner 关于生成式 AI 的 IT 领导者调查中，52% 的 IT 领导者表示：他们期望团队在软件开发中使用生成式 AI。Gartner 同行社区成员的调查显示，61% 的软件工程领导者对生成式 AI 在代码生成中的潜力感到兴奋。&lt;/p>
&lt;p>然而，开发人员并不总是花大部分时间在编写代码上。他们平均只有 10% 到 25% 的时间用于编写代码。其余的时间则用在阅读规范、写文档、做代码审查、参加会议、帮助同事、调试代码、与其他团队协作、配置环境、处理生产故障、学习技术及业务知识等方面。因此，若只关注代码编写，而忽略了 DevOps 流程的其他环节，可能就不会暴露出开发周期中的其他低效问题，而无法提升整体性能。&lt;/p>
&lt;p>因此，我们的客户开始从更广泛的角度看待 AI 在 DevOps 中的应用，并提出诸如：“在未来三年内，AI 将如何影响 DevOps/DevSecOps？”，以及“我们如何在敏捷和 DevOps 流程中全面应用 AI？”等问题。&lt;/p>
&lt;blockquote>
&lt;p>集中化平台的快速发展，以及在软件开发生命周期各阶段（从构思和规划到生产部署管理）整合 AI/ML，将彻底改变软件工程。
——JPMorgan Chase 工程师平台和体验负责人 Sandhya Sridharan&lt;/p>&lt;/blockquote>
&lt;p>平台工程团队将在解决这些问题中起到关键作用，因为他们的职责是：帮助开发团队提升交付速度、软件质量和大规模的开发者体验。他们需要了解现有和潜在平台用户的需求，从多个产品开发团队的挑战中获取独特的洞见。&lt;/p>
&lt;p>平台工程团队应采取三管齐下的方法，通过 AI 工具和技术来增强 DevOps 工作流（见图 1）：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>改善开发者体验&lt;/strong>：在 SDLC 各阶段，AI 增强的用例包括：代码建议和代码解释、总结拉取请求的变更，解释流水线错误，以及使用自然语言查询操作数据和服务健康状态。&lt;/li>
&lt;li>&lt;strong>提升软件交付工作流的效率&lt;/strong>：AI 优化的例子包括：测试影响分析（缩短构建时间）、自动化代码审查和变更影响分析（辅助人工监督）、以及事件关联（缩短事故解决时间）。&lt;/li>
&lt;li>&lt;strong>优化软件交付基础设施&lt;/strong>：AI 技术的例子包括：自主工作负载优化和增强的 FinOps，从而优化可靠性、成本和环境可持续性。&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/1.webp"
width="1280"
height="770"
srcset="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/1_hu_de06ed4affb850cd.webp 480w, https://martinliu.cn/blog/pe-team-augment-devops-with-ai/1_hu_2cc4ced9c314d065.webp 1024w"
loading="lazy"
alt="图 1: 三种使用 AI 增强 DevOps 的方法"
class="gallery-image"
data-flex-grow="166"
data-flex-basis="398px"
>&lt;/p>
&lt;h2 id="分析">分析
&lt;/h2>&lt;h3 id="识别并优先解决-sdlc-中的瓶颈">识别并优先解决 SDLC 中的瓶颈
&lt;/h3>&lt;p>想要通过 AI 增强 DevOps 工作流的平台工程团队，应该先识别并优先解决阻碍 SDLC 工作流的瓶颈。&lt;/p>
&lt;p>这些瓶颈主要有两种：&lt;/p>
&lt;ol>
&lt;li>跨越 SDLC 各阶段的工作流障碍&lt;/li>
&lt;li>SDLC 每个阶段内部的工作流障碍&lt;/li>
&lt;/ol>
&lt;p>第一类瓶颈可以在系统性审视整个软件交付价值流时得到显现。系统性视角让我们能够识别到，哪些存在于 SDLC 各角色和团队“交接工作”过程中的瓶颈。&lt;/p>
&lt;p>涉及多个阶段或多个团队的瓶颈示例如下：&lt;/p>
&lt;ul>
&lt;li>开发人员等待设计师和产品经理的输入&lt;/li>
&lt;li>运营团队等待分析变更的影响&lt;/li>
&lt;li>安全团队执行部署前检查&lt;/li>
&lt;/ul>
&lt;p>某些瓶颈可能被认为是“必要的”，但无论如何，这些延迟对客户来说并没有增加价值（见图 2）。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/2.webp"
width="1280"
height="571"
srcset="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/2_hu_5624d26412b2ad3f.webp 480w, https://martinliu.cn/blog/pe-team-augment-devops-with-ai/2_hu_591eb45ea83f77f5.webp 1024w"
loading="lazy"
alt="图 2: 识别工作项在软件交付生命周期中移动时的瓶颈"
class="gallery-image"
data-flex-grow="224"
data-flex-basis="538px"
>&lt;/p>
&lt;p>第二类限制更容易发现，因为它们出现在“单一工作线程”中。这些逻辑上的工作线程的例子如下：&lt;/p>
&lt;ul>
&lt;li>开发流程内部（编码、构建、测试、调试、重构、提交）&lt;/li>
&lt;li>代码检入过程（拉取请求、代码审查、安全检查）&lt;/li>
&lt;li>持续集成（构建代码、运行单元测试、运行 SAST/DAST 测试、运行服务健康检查）&lt;/li>
&lt;li>环境管理（创建虚拟机、容器编排、设置基础设施）&lt;/li>
&lt;li>事故响应（分类警报、事件关联、分析日志、根本原因分析）&lt;/li>
&lt;/ul>
&lt;p>在每个阶段，不同团队可能面临着不同的限制。例如，处理遗留代码库，并进行增量更改的团队发现最大的限制不是编码效率，而是对旧代码库缺乏理解。因此，平台工程团队需要与产品工程团队合作，了解开发者的痛点，确保 AI 功能的实现是基于实际需求的。&lt;/p>
&lt;p>图 3 重点分析了在每个工作线程中的具体活动，并展示了 AI 如何解决这些限制和瓶颈。无法一次解决所有问题—— 因此，应识别并迭代地解决此时此刻的最大的限制约束点（见注释 1）。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/3.webp"
width="1280"
height="786"
srcset="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/3_hu_7f81d68ed7d02caf.webp 480w, https://martinliu.cn/blog/pe-team-augment-devops-with-ai/3_hu_99590f00880832fa.webp 1024w"
loading="lazy"
alt="图 3: 在软件交付生命周期的每个阶段中迭代地解决最大的限制"
class="gallery-image"
data-flex-grow="162"
data-flex-basis="390px"
>&lt;/p>
&lt;h3 id="改善开发者体验">改善开发者体验
&lt;/h3>&lt;p>改善开发者体验已成为软件工程领导者的关键优先事项，58% 的领导者表示，这对他们的组织高管层非常重要。提升开发者体验或生产力是开发者平台和工具类技术和实践的首要价值因素。因此，平台工程团队在使用 AI 增强 DevOps 工作流的第一步应集中在改善使用平台的人员体验上。&lt;/p>
&lt;p>图 4 展示了在软件开发、交付和运营过程中，通过 AI 增强改善开发者体验的使用案例。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/4.webp"
width="1280"
height="1051"
srcset="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/4_hu_df2f59828d5aedf4.webp 480w, https://martinliu.cn/blog/pe-team-augment-devops-with-ai/4_hu_da76268fea5bc97e.webp 1024w"
loading="lazy"
alt="图 4: 使用 AI 增强改善 DevOps 中的开发者体验"
class="gallery-image"
data-flex-grow="121"
data-flex-basis="292px"
>&lt;/p>
&lt;p>通过 AI 使能开发者的使用案例改善的开发者体验涵盖整个 SDLC，从开发、交付到运营。以下是 AI 在各阶段提升开发者体验的方式：&lt;/p>
&lt;h4 id="开发">开发
&lt;/h4>&lt;p>在开发阶段，开发者体验主要受认知负荷和上下文切换次数的影响。AI 编码助手可以在 IDE 内提供相关信息，减少开发者的上下文切换，避免他们需要离开开发环境去网上查找信息。&lt;/p>
&lt;p>帮助开发者减少认知负荷并实现流畅工作的 AI 功能包括：&lt;/p>
&lt;ul>
&lt;li>代码生成&lt;/li>
&lt;li>代码理解&lt;/li>
&lt;li>辅助调试&lt;/li>
&lt;li>文档生成&lt;/li>
&lt;li>漏洞解释&lt;/li>
&lt;li>自动修复&lt;/li>
&lt;/ul>
&lt;p>有关提供这些功能的代表性工具的详细分析，请参见《AI 编码助手创新指南》和《AI 增强软件测试工具市场指南》。&lt;/p>
&lt;h4 id="交付">交付
&lt;/h4>&lt;p>在软件交付阶段，改善开发者体验的重点是缩短反馈周期和减少重复的低价值工作。AI 使能的功能示例包括：&lt;/p>
&lt;ul>
&lt;li>自动建议修复构建错误&lt;/li>
&lt;li>预防变更失败（通过变更影响分析和变更风险预测）&lt;/li>
&lt;li>缩短构建时间（使用智能测试选择）&lt;/li>
&lt;/ul>
&lt;p>这些功能可以为开发者提供更快的反馈。CircleCI、Digital.ai、GitLab 和 Harness 等供应商正将 AI 增强功能集成到 DevOps 平台中（见《DevOps 平台魔力象限》）。&lt;/p>
&lt;h4 id="运营">运营
&lt;/h4>&lt;p>这一阶段传统上主要依靠 AIOps（预测 AI）功能，通过异常检测、事件关联和基于警报和遥测数据生成见解来加速事故响应（见《AIOps 平台市场指南》）。&lt;/p>
&lt;p>生成式 AI 可以通过以下方式进一步消减常规任务：&lt;/p>
&lt;ul>
&lt;li>根据事故模式自动生成运行手册-run-book（例如 Shoreline 和 Transposit 等供应商）&lt;/li>
&lt;li>在事故响应期间通过总结、解释、翻译、内容生成、预测和建议来减少值班工程师的认知负荷。这在值班工程师不熟悉引发事故的代码时尤为重要（例如 BMC、PagerDuty、ServiceNow、Shoreline 和 Transposit 等供应商）。&lt;/li>
&lt;li>在故障排除或自动化 DevOps 工作流时，使用自然语言（例如“描述最近对生产环境的变更有哪些？”）（例如 Cortex、Kubiya、New Relic 和 Dynatrace 等供应商）。&lt;/li>
&lt;/ul>
&lt;h3 id="提升软件交付效率">提升软件交付效率
&lt;/h3>&lt;p>除了改善软件交付工作流中的开发者体验，AI 还具有优化工作流效率的潜力。平台工程团队可以在创建“铺装道路”时集成 AI 功能，以简化从构思到生产的价值流动。在此过程中，他们可以系统地了解从客户承诺到客户看到结果的整个工作过程。系统视图通常是价值流映射的一部分（见《DevOps 流程价值流映射指南》）。&lt;/p>
&lt;p>单靠自动代码生成来提升软件交付性能，在超过一定阈值后会，所产生收益会递减——因为最大的价值交付瓶颈可能在其他地方（见注释 1）。图 5 显示了帮助克服 SDLC 限制（约束点）的 AI 使能案例（如第一部分所述）。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/5.webp"
width="1280"
height="1115"
srcset="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/5_hu_9ada618c90f03d87.webp 480w, https://martinliu.cn/blog/pe-team-augment-devops-with-ai/5_hu_d43cb572cf9da0a3.webp 1024w"
loading="lazy"
alt="图 5: AI 增强的 DevOps 使用案例以优化 SDLC"
class="gallery-image"
data-flex-grow="114"
data-flex-basis="275px"
>&lt;/p>
&lt;p>图 6 展示了用于实现上述使用案例的一些工具，并不限于所展示的示例。供应商正在迅速扩展其功能，因此一个供应商可能支持比这里描述的更多使用案例。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/6.webp"
width="1280"
height="1115"
srcset="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/6_hu_bc77ceddb1c9232d.webp 480w, https://martinliu.cn/blog/pe-team-augment-devops-with-ai/6_hu_8d408cbb7c266099.webp 1024w"
loading="lazy"
alt="图 6: AI 增强的 DevOps 工具在 SDLC 中的应用"
class="gallery-image"
data-flex-grow="114"
data-flex-basis="275px"
>&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>AI 增强开发的下游影响&lt;/strong>&lt;/p>
&lt;p>AI 编码助手使开发者的编写代码效率提升，但这也带来一个意外的副作用：代码审查和安全审查的工作量积压增加。缓慢的代码审查会降低整体开发效率。根据 2023 年 DORA 报告，代码审查速度快的团队其软件交付性能提高了 50%。平台工程团队可以看清这些系统性互相关系，适合推动系统性变革，而不仅仅是局部改进。&lt;/p>
&lt;p>因此，平台工程团队在支持 AI 增强开发工具的同时，必须补充卓越的 DevSecOps 实践。否则，我们将面临开发者产生虚假的安全感、重复代码和未经审查的代码推送，进而导致质量和安全问题。&lt;/p>&lt;/blockquote>
&lt;h3 id="优化软件交付基础设施">优化软件交付基础设施
&lt;/h3>&lt;p>平台工程团队负责管理、治理并向产品团队提供软件交付基础设施。然而，规模化管理软件交付基础设施非常复杂，如下公式所示：&lt;/p>
&lt;blockquote>
&lt;p>软件交付基础设施 = （支持所有环境中应用及其组件的完整 SDLC 的基础设施）x（应用数量）&lt;/p>&lt;/blockquote>
&lt;p>软件交付基础设施不仅限于生产环境，还包括开发、测试、压力测试和预发布环境。此外，基础设施还必须支持部署和测试应用所需的各个组件。这些组件可能包括源代码管理系统、云开发环境、持续集成服务器、数据库服务器，以及运行时基础设施堆栈（由物理主机、虚拟机容器和应用运行时组成）。&lt;/p>
&lt;p>产品团队越来越期望自助工具能够在成本、可靠性和可持续性之间实现优化（见图 7）。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/7.webp"
width="1280"
height="962"
srcset="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/7_hu_101254c2069f5a1e.webp 480w, https://martinliu.cn/blog/pe-team-augment-devops-with-ai/7_hu_e3ffc13988590c49.webp 1024w"
loading="lazy"
alt="图 7: 在可靠性、成本优化和可持续性目标之间实现权衡"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="319px"
>&lt;/p>
&lt;p>&lt;strong>通过自助内部开发平台优化云原生软件交付基础设施&lt;/strong>&lt;/p>
&lt;p>优化公有云基础设施变得尤为困难，但也非常重要。这主要是由于云服务种类繁多、定价模式不一致、云原生应用的分布式特性以及流量模式的季节性变化。为了可靠、经济和可持续地管理基础设施，平台工程团队应为产品团队提供支持 AI 增强的自助平台和工具，以优化成本、可靠性和可持续性。&lt;/p>
&lt;p>新兴技术如自主工作负载优化和增强的 FinOps，可以自动化优化价格和性能，同时实现预定义的业务目标。供应商包括 Akamas、Anodot、Apptio、Avesha、CAST AI、Densify、Google Cloud（Active Assist、Duet AI）、IBM（Turbonomic）、Sedai 和 StormForge。图 8 显示了这些工具支持的 AI 增强使用案例。&lt;/p>
&lt;p>平台工程团队应将这些技术整合到内部开发平台中，以优化计算基础设施。这使开发人员和站点可靠性工程师能够可靠且经济地管理和运行应用程序（见 2023 年 IT 管理智能炒作周期）。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/8.webp"
width="1280"
height="1040"
srcset="https://martinliu.cn/blog/pe-team-augment-devops-with-ai/8_hu_37b61d09f28c09f9.webp 480w, https://martinliu.cn/blog/pe-team-augment-devops-with-ai/8_hu_f67de5d4035fc5e3.webp 1024w"
loading="lazy"
alt="图 8: 平台工程团队支持的 AI 增强基础设施成本、可靠性和可持续性优化工具"
class="gallery-image"
data-flex-grow="123"
data-flex-basis="295px"
>&lt;/p>
&lt;h3 id="快速回答">快速回答
&lt;/h3>&lt;p>&lt;strong>在使用 AI 增强 DevOps 工作流时需要注意哪些陷阱？&lt;/strong>&lt;/p>
&lt;p>软件工程领导者必须警惕潜在的陷阱和意外的副作用：&lt;/p>
&lt;ul>
&lt;li>注意供应商的“AI 洗涤”，避免在传统自动化选项足够时，还用 AI 技术过度再造设计。通过组建跨职能团队进行试点，创建和验证相关假设进行前后对比分析。使用结果驱动的 KPI 来定义和衡量成功。&lt;/li>
&lt;li>将 AI 应用于 SDLC 的某个部分（局部），可能会导致工作量的转移，而不是节省，从而产生一种虚假的时间节省感。例如，在编码过程中节省了时间，可能会因为代码审查和调试时间的增加，而正负抵消（见评估生成式 AI 如何改善开发者体验）。&lt;/li>
&lt;li>尽管 AI 旨在降低认知负荷，但它也可能无意中降低认知技能水平。是人类员工的认知技能在不使用的情况下，而随之退化，这使我们在 AI 工具达到其极限时，反而无法做出正确决策。使用 AI 作为决策引擎的另一个风险是，它会降低人类对系统运行方式的理解，并导致缺乏情境意识。&lt;/li>
&lt;li>大多数生成式 AI 工具无法确保输出的一致性、准确性、可重复性和可预测性。“幻觉”使当前的技术难以胜任关键任务。然而，涉及检索增强生成（RAG）和模型微调的技术，可以通过访问最新的知识源和特定上下文数据来减少幻觉。使用基础模型作为控制器来构建执行狭窄任务的智能体也有前景。例如，Adept、AgentGPT、AutoGPT 和 Agents for Amazon Bedrock。Gartner 称这些为“自主智能体”（见 2023 年生成式 AI 炒作周期）。&lt;/li>
&lt;/ul>
&lt;h2 id="证据">证据
&lt;/h2>&lt;ol>
&lt;li>Gartner IT 领导者对软件工程生成式 AI 的调查：这项调查于 2023 年 5 月 2 日至 8 日在线进行，旨在收集生成式 AI 在软件工程中的当前和预期使用情况数据。共有 91 名 IT 领导者参加，他们是 Gartner 研究圈的成员，一个由 Gartner 管理的小组。参与者主要来自北美（n = 44）和 EMEA（n = 33）；其他受访者来自亚太地区（n = 12）和拉丁美洲（n = 2）。免责声明：本次调查结果仅反映受访者和其公司的观点，不代表全球情况或整个市场。&lt;/li>
&lt;li>生成式 AI 对软件工程团队的影响&lt;/li>
&lt;li>软件开发人员的日常工作：微软&lt;/li>
&lt;li>软件开发中 AI 的现状，GitLab&lt;/li>
&lt;li>全球代码时间报告，基于 25 万多名开发人员的数据，Software.com&lt;/li>
&lt;li>2023 年 DevOps 状态报告，基于 3000 名专业人员的数据，Google Cloud&lt;/li>
&lt;li>自动化的讽刺——Lisanne Bainbridge&lt;/li>
&lt;li>国家人类系统集成委员会（BOHSI）小组：人类与 AI 团队合作：研究前沿，ResearchGate&lt;/li>
&lt;/ol>
&lt;h2 id="注释-1">注释 1
&lt;/h2>&lt;p>在《目标》一书中，Eliyahu Goldratt 博士将约束定义为“限制系统实现更高性能的因素”。&lt;/p>
&lt;p>缓解最关键的约束对整体系统性能有着巨大影响。因此，我们必须迭代地识别、优先处理，并解决阻碍团队交付价值的最大约束。&lt;/p>
&lt;p>❤️ Photo by Pavel Danilyuk: &lt;a class="link" href="https://www.pexels.com/photo/a-robot-holding-a-cup-8439093/" target="_blank" rel="noopener"
>https://www.pexels.com/photo/a-robot-holding-a-cup-8439093/&lt;/a>&lt;/p></description></item><item><title>推荐尝试 Github 系列认证考试</title><link>https://martinliu.cn/blog/github-certifications-ga/</link><pubDate>Thu, 25 Jan 2024 09:38:21 +0800</pubDate><guid>https://martinliu.cn/blog/github-certifications-ga/</guid><description>&lt;img src="https://martinliu.cn/blog/github-certifications-ga/Collaboration-DarkMode-2.webp" alt="Featured image of post 推荐尝试 Github 系列认证考试" />&lt;blockquote>
&lt;p>通过GitHub认证释放您的全部潜力！获得GitHub认证将让您在展示为GitHub专家方面具有竞争优势。&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://martinliu.cn/blog/github-certifications-ga/Certifiedtocat_full__2_.svg"
loading="lazy"
alt="cert"
>&lt;/p>
&lt;p>认证是打开职业机会之门的黄金钥匙，可以为您的职业生涯提供强大动力，提升工作效率，增加薪资。对雇主而言，认证是增加生产力的秘密武器，它在招聘过程中为您的技能提供不可辩驳的证明，并在组织内激发创新。&lt;/p>
&lt;p>之前GitHub的认证计划，仅供员工和合作伙伴使用，现在已经向全球所有客户开放！现在每个人都可以访问注册站点，开始学习并准备考试。&lt;/p>
&lt;h2 id="4-门认证课程">4 门认证课程
&lt;/h2>&lt;p>获得GitHub认证将让您在展示为GitHub专家方面具有竞争优势。让我们来看看每个路径。&lt;/p>
&lt;h3 id="github基础认证">GitHub基础认证
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/github-certifications-ga/foundations-river-image__1_.webp"
width="616"
height="424"
srcset="https://martinliu.cn/blog/github-certifications-ga/foundations-river-image__1__hu_f4248ed34665fa59.webp 480w, https://martinliu.cn/blog/github-certifications-ga/foundations-river-image__1__hu_a93ad09fa3df4d52.webp 1024w"
loading="lazy"
alt="foundations"
class="gallery-image"
data-flex-grow="145"
data-flex-basis="348px"
>&lt;/p>
&lt;p>GitHub基础认证计划：旨在向初学者介绍GitHub平台的基本概念和产品。您将学习如何使用git，并探索GitHub的核心功能，如存储库管理、提交、分支、合并和项目管理。您还将了解如何为GitHub上的开源项目做贡献，并有效地使用markdown。您可以在此查看完整课程表（&lt;a class="link" href="https://learn.microsoft.com/en-us/collections/o1njfe825p602p" target="_blank" rel="noopener"
>https://learn.microsoft.com/en-us/collections/o1njfe825p602p&lt;/a>），以了解此路径中涵盖的更多主题。&lt;/p>
&lt;h3 id="github-actions认证">GitHub Actions认证
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/github-certifications-ga/actions-river-image__1_.webp"
width="616"
height="424"
srcset="https://martinliu.cn/blog/github-certifications-ga/actions-river-image__1__hu_9dd8c5219a7db296.webp 480w, https://martinliu.cn/blog/github-certifications-ga/actions-river-image__1__hu_367072844b9ffe49.webp 1024w"
loading="lazy"
alt="Actions"
class="gallery-image"
data-flex-grow="145"
data-flex-basis="348px"
>&lt;/p>
&lt;p>GitHub Actions证书:向您介绍GitHub Actions，以便您可以学会自动化软件开发工作流程。您将学习如何构建CI/CD管道，管理GitHub Actions，以及许多其他内容。到最后，您将准备好成为团队中处理所有与操作有关事务的人。在此查看完整课程表（&lt;a class="link" href="https://learn.microsoft.com/en-us/collections/n5p4a5z7keznp5" target="_blank" rel="noopener"
>https://learn.microsoft.com/en-us/collections/n5p4a5z7keznp5&lt;/a>）。&lt;/p>
&lt;h3 id="github高级安全认证">GitHub高级安全认证
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/github-certifications-ga/ghas-river-image__1_.webp"
width="616"
height="424"
srcset="https://martinliu.cn/blog/github-certifications-ga/ghas-river-image__1__hu_cabe5a4d053d1ad8.webp 480w, https://martinliu.cn/blog/github-certifications-ga/ghas-river-image__1__hu_12a037c0602c69d3.webp 1024w"
loading="lazy"
alt="security"
class="gallery-image"
data-flex-grow="145"
data-flex-basis="348px"
>&lt;/p>
&lt;p>GitHub高级安全（GHAS）证书：旨在教您如何在开发生命周期的每个阶段使用高级安全功能保护您的代码。GHAS专门针对GitHub企业版，因此该证书旨在供企业开发人员评估和配置私有存储库上的秘密扫描、使用CodeQL进行代码扫描、依赖关系管理等等。在此查看完整课程表（&lt;a class="link" href="https://learn.microsoft.com/en-us/collections/rqymc6yw8q5rey" target="_blank" rel="noopener"
>https://learn.microsoft.com/en-us/collections/rqymc6yw8q5rey&lt;/a>）。&lt;/p>
&lt;h3 id="github管理认证">GitHub管理认证
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/blog/github-certifications-ga/admin-river-image__1_.webp"
width="616"
height="424"
srcset="https://martinliu.cn/blog/github-certifications-ga/admin-river-image__1__hu_ff2f1b1782b29f62.webp 480w, https://martinliu.cn/blog/github-certifications-ga/admin-river-image__1__hu_11fce38a6ca73afc.webp 1024w"
loading="lazy"
alt="admin"
class="gallery-image"
data-flex-grow="145"
data-flex-basis="348px"
>&lt;/p>
&lt;p>GitHub管理认证:将教您如何维护一个健康、强大和安全的GitHub环境，以满足组织的需求。您可以在此查看完整课程表（&lt;a class="link" href="https://learn.microsoft.com/en-us/collections/mom7u1gzjdxw03" target="_blank" rel="noopener"
>https://learn.microsoft.com/en-us/collections/mom7u1gzjdxw03&lt;/a>）。&lt;/p>
&lt;h2 id="学习备考指南">学习备考指南
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/blog/github-certifications-ga/image2.webp"
width="1999"
height="650"
srcset="https://martinliu.cn/blog/github-certifications-ga/image2_hu_4bce7f218ed42b7c.webp 480w, https://martinliu.cn/blog/github-certifications-ga/image2_hu_999798cccd1e71fb.webp 1024w"
loading="lazy"
alt="guide"
class="gallery-image"
data-flex-grow="307"
data-flex-basis="738px"
>&lt;/p>
&lt;p>GitHub认证官网为每个认证计划创建了详细的学习指南。您可以从此存储库【&lt;a class="link" href="https://github.com/LadyKerr/github-certification-guide" target="_blank" rel="noopener"
>https://github.com/LadyKerr/github-certification-guide&lt;/a>】获取每个证书的学习指南，以及帮助您准备考试的资源。&lt;/p>
&lt;p>每一门课程的学习资料都可以在微软学习网站上免费访问并学习。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/github-certifications-ga/2024-01-25_09-58-51.webp"
width="1039"
height="1250"
srcset="https://martinliu.cn/blog/github-certifications-ga/2024-01-25_09-58-51_hu_db8278ba6fa19918.webp 480w, https://martinliu.cn/blog/github-certifications-ga/2024-01-25_09-58-51_hu_80214650619e3af3.webp 1024w"
loading="lazy"
alt="learn"
class="gallery-image"
data-flex-grow="83"
data-flex-basis="199px"
>&lt;/p>
&lt;p>建议的学习路径是：&lt;/p>
&lt;ol>
&lt;li>GitHub Foundations ：【推荐】这虽然是一门基础的课程，但是可以说它为你提供了非常丰富的学习内容，包括：GitHub Copilot、Codespaces。还涵盖了项目管理、如何参与开源项目、安全防护代码仓库、处理 PR 等高级内容。即使不一定参加考试，也建议完成的学习一遍。适合人群：想更多了解 GitHub 的人群。&lt;/li>
&lt;li>GitHub Actions：【推荐】这门课程主要是讲解 GitHub Actions 的使用，包括：如何使用 GitHub Actions、如何创建流水线进行 CI、如何管理软件包、如何开发和发布 GitHub Actions 等。适合人群：长期在工作在 GitHub 项目上的人群，你想在项目上使用自动化的 DevOps 流水线和 CI、CD 实践。&lt;/li>
&lt;li>GitHub Advanced Security：【可选】这门课程主要是讲解 GitHub 的安全防护，在 GitHub 上如何做 DevSecOps，需要的产品功能是GitHub企业版的附加功能，如果你的公司没有购买 GitHub企业版，那么这门课程并不适合学习。&lt;/li>
&lt;li>GitHub Administration：【可选】这门课程主要是讲解：如果你是你们公司的一名 GitHub 管理员，你如何维护一个健康、强大、安全的 GitHub 环境，以满足组织的需求。如果你不是你们公司的 GitHub 管理员，或者没有这个想法，那么这门课程可以不用学习。&lt;/li>
&lt;/ol>
&lt;p>在学习完之后，如果你想报名考试，请访问：&lt;a class="link" href="https://examregistration.github.com/overview" target="_blank" rel="noopener"
>https://examregistration.github.com/overview&lt;/a>&lt;/p>
&lt;p>每一门认证考试的费用是 $99，；由于这个培训认证是刚刚 GA 不久，目前 “GitHub基础认证” 认证考试是打折促销，折后只需要
$49 。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/github-certifications-ga/2024-01-25_10-56-28.webp"
width="1414"
height="1047"
srcset="https://martinliu.cn/blog/github-certifications-ga/2024-01-25_10-56-28_hu_33fc513e8e177c7.webp 480w, https://martinliu.cn/blog/github-certifications-ga/2024-01-25_10-56-28_hu_695e88b8717cb561.webp 1024w"
loading="lazy"
alt="exam"
class="gallery-image"
data-flex-grow="135"
data-flex-basis="324px"
>&lt;/p>
&lt;p>我目测了一下考试的范围和难度：感觉广度是一个挑战，毕竟不是每个人都会参与项目管理、协作、安全、开源/内源这些相关的工作内容。深度上应该不太难，毕竟假如你是天天在 GitHub 上工作的人，都会有一定最基础的经验。建议可以先学习了在说，毕竟学习的内容是免费的。如果想报名考试，报名和考试都是线上进行的，还是比较方便的，特别是 GAF 的折后价格还不错。&lt;/p>
&lt;p>在考试通过之后，就可以获取Credly验证的凭证：您将收到Credly徽章和证书，以验证您的资格。就像其他的电子徽章一样，你可以发朋友圈或者在 LinkedIn 上展示你的徽章。&lt;/p>
&lt;p>下面是四种GitHub认证考试的徽章：GitHub基础、GitHub Actions、GitHub高级安全和GitHub管理。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/github-certifications-ga/image1.webp"
width="1999"
height="501"
srcset="https://martinliu.cn/blog/github-certifications-ga/image1_hu_64e67969e4d790e.webp 480w, https://martinliu.cn/blog/github-certifications-ga/image1_hu_93ac659d789ac84c.webp 1024w"
loading="lazy"
alt="4 cert"
class="gallery-image"
data-flex-grow="399"
data-flex-basis="957px"
>&lt;/p>
&lt;p>GitHub 的官网和微软的学习网站所提供的学习资料和备考指南手册文档都是丰富且详尽的。如果您对认证计划有任何疑问，请务必查看官方的FAQ页面「&lt;a class="link" href="https://examregistration.github.com/faq" target="_blank" rel="noopener"
>https://examregistration.github.com/faq&lt;/a>」和备考人手册『&lt;a class="link" href="https://examregistration.github.com/handbook" target="_blank" rel="noopener"
>https://examregistration.github.com/handbook&lt;/a>』。&lt;/p></description></item><item><title>告别Terraform：使用为人类设计的基础设施即代码Pulumi</title><link>https://martinliu.cn/blog/infrastructure-as-code-for-humans-with-pulumi/</link><pubDate>Mon, 08 Jan 2024 11:01:38 +0800</pubDate><guid>https://martinliu.cn/blog/infrastructure-as-code-for-humans-with-pulumi/</guid><description>&lt;img src="https://martinliu.cn/blog/infrastructure-as-code-for-humans-with-pulumi/0_94eq9GcVBbFH3TeR.webp" alt="Featured image of post 告别Terraform：使用为人类设计的基础设施即代码Pulumi" />&lt;p>本文原作者：&lt;a class="link" href="https://medium.com/aws-tip/say-goodbye-to-terraform-infrastructure-as-code-for-humans-with-pulumi-76e72de1c3d9" target="_blank" rel="noopener"
>Santiago González&lt;/a>&lt;/p>
&lt;p>事先声明一下：本文并非另一篇黑HashiCorp更改Terraform许可的文章。我还有很多不再使用Terraform的考虑。在这篇文章中，我们将回顾Pulumi相对于Terraform的一些优势。这并不意味着要成为Pulumi的追捧者。它只是Terraform的替代解决方案之一，使开发人员能够直观地使用基础设施配置工具。&lt;/p>
&lt;h2 id="为什么讨厌terraform">为什么讨厌Terraform？
&lt;/h2>&lt;p>显然，我在这里写的一切都是主观的，也可能是错的。但这里总结的一切表明了，与我类似的其他许多尝试拥抱Terraform的人，希望用它作为IcA工具所遭受的挫折。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>学习曲线&lt;/strong>：Terraform拥有自己专用的领域特定语言（HCL），作为一种定义基础设施的独特方式，与传统编程语言迥然不同。这种语言遵循着对其他语言而言比较陌生的逻辑。因此，对团队来说，学习它是需要：付出极大努力，并且遵循这种&amp;hellip; 魔鬼般逻辑的语言更是需要额外的努力。&lt;/li>
&lt;li>&lt;strong>违背DevOps原则的DevOps工具&lt;/strong>：如果你在Terraform中编写代码的已经很复杂了，想象一下去编写测试，有可能是什么样子。在这里，您可以了解一下要如何才能做到这一点。这绝对是疯狂的。实际上，这意味着：并非在Terraform的代码上直接实施测试。至少我从来没见过这样的。&lt;/li>
&lt;li>&lt;strong>秘钥管理&lt;/strong>：Terraform需要与第三方解决方案集成来实现秘钥的管理。或者，您大可以使用环境变量。&lt;/li>
&lt;li>&lt;strong>团队生产力&lt;/strong>：其实很难找到一个开发人员的简历上，就写着他已经熟悉了 Terraform。因此，这意味着：你必须使用一种与项目上所使用的语言相异的语言来实现基础设施的配置，由于使用和学习其他新语言的额外工作量，会导致生产力的下降。&lt;/li>
&lt;/ul>
&lt;h2 id="pulumi能做什么">Pulumi能做什么？
&lt;/h2>&lt;p>以下是使Pulumi相对于Terraform更好的功能。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.pulumi.pulumi&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.pulumi.pulumi.aws.ec2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.pulumi.pulumi.aws.rds&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.pulumi.pulumi.aws.vpc&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">Main&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">static&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">void&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="o">[]&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Crear una VPC&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Vpc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">myVpc&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Vpc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;myVpc&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">VpcArgs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">builder&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">cidrBlock&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;10.0.0.0/16&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">build&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Crear un grupo de subredes&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">SubnetGroup&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dbSubnetGroup&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SubnetGroup&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;myDbSubnetGroup&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SubnetGroupArgs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">builder&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">subnetIds&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">myVpc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getPrivateSubnetIds&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">build&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Crear una instancia de AWS DocumentDB&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Cluster&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">documentDbCluster&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cluster&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;myDocumentDBCluster&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ClusterArgs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">builder&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">clusterIdentifier&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;my-docdb-cluster&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">availabilityZones&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;us-east-1a&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;us-east-1b&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">dbSubnetGroupName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dbSubnetGroup&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getId&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">masterUsername&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;admin&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">masterPassword&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;mysecretpassword&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">skipFinalSnapshot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">storageEncrypted&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">applyImmediately&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">engine&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;docdb&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">engineVersion&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;4.0&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">instanceType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;db.r5.large&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">build&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">pulumi&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">export&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;clusterEndpoint&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">documentDbCluster&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getEndpoint&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="语言支持">语言支持
&lt;/h3>&lt;p>多语言和多云支持：使其具有很大的灵活性。这使您能够使用与软件项目相同的编程语言，让它对开发人员而言更加友好。此外，它实现了对所需架构的更好抽象，并且还能实现“在产生云账单之前就进行代码测试”。&lt;/p>
&lt;h3 id="pulumi具有秘钥存储">Pulumi具有秘钥存储
&lt;/h3>&lt;p>它使用集成的秘钥存储来保护所有敏感数据。这个秘钥存储解决方案在各种部署场景中无缝运行，无论您是使用我们托管的Pulumi服务、自托管的Pulumi服务、还是自我管理的后端。当您使用&amp;rsquo;pulumi new&amp;rsquo;或&amp;rsquo;pulumi stack init&amp;rsquo;创建堆栈时，Pulumi服务会自动保护好秘钥信息。如果你选择使用AWS S3或Google Cloud Storage等自我管理的云存储后端，也是在使用&amp;rsquo;pulumi new&amp;rsquo;初始化新堆栈时定义的口令来保护秘钥。无论场景如何，每个Pulumi堆栈都会收到唯一的加密密钥。&lt;/p>
&lt;h3 id="团队生产力">团队生产力
&lt;/h3>&lt;p>如果团队使用了与其项目相关联（相同）的程序开发语言，那么，他们就将更容易的对所需使用的组件负责和提供支持。这样，使用和理解具有HCL结构的项目的工作量就被消除了，团队可以继续专注于开发功能，而减少了开发成本和时间。&lt;/p>
&lt;h3 id="使用terraform状态">使用Terraform状态
&lt;/h3>&lt;p>Pulumi提供了访问和利用本地和远程Terraform状态的能力。在过渡到Pulumi或您组织内的各个团队具有不同的工具偏好时，这可能非常有价值。通过诸如状态引用支持之类的功能，您基于Terraform的构建的基础架构之上，构建Pulumi中的项目，例如利用Terraform所创建的关键VPC详细信息，如VPC ID和子网ID等信息。这简化了Pulumi和Terraform之间的集成，使其从 Terraform 的迁移变成了一个无缝的过程。&lt;/p>
&lt;h3 id="测试">测试
&lt;/h3>&lt;p>您可以选择所喜欢的测试框架，并开发进行对基础设施进行必要验证的单元和集成测试。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">spock.lang.Specification&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">io.pulumi.pulumi&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">io.pulumi.pulumi.aws.s3.Bucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">io.pulumi.pulumi.runtime.Mocks&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.mockito.Mockito&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">PulumiIntegrationTest&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">extends&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Specification&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">def&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">setup&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Set up AWS and Pulumi configurations for testing&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">pulumi&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">runtime&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setMocks&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Mocks&lt;/span>&lt;span class="p">())&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Configure Pulumi mocks&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">def&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">cleanup&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Clean up configurations after tests&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">pulumi&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">runtime&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">setMocks&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Restore Pulumi mocks&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">def&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;test AWS S3 bucket creation&amp;#34;&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">given&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Set up the environment for the Pulumi program&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">def&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">program&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pulumi&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Stack&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;mystack&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nl">when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Execute the Pulumi program that creates the S3 bucket&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">program&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">apply&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nl">then&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Verify that the S3 bucket was created successfully&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">def&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bucketName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">program&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">getOutput&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Bucket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">BucketName&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">assert&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bucketName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;amp;&amp;amp;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">bucketName&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nl">cleanup&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// Perform additional cleanup tasks if necessary&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="tldr-太长不读">TL;DR; 太长不读
&lt;/h2>&lt;p>尽管Terraform拥有着强大的社区支持，但实际上，对于开发团队来说，通常大家还是觉得太复杂，难以用它实现 IaC 基础设施即代码的管理。这主要是由于学习曲线及其HCL语言，它与命令性语言的逻辑不一致。由于替代解决方案如Pulumi的出现，我们可以使用软件项目中的程序语言配置基础设施资源。实际上，与Terraform相比，Pulumi会提高效率和生产力。如果您尚未决定使用哪种IaC工具，值得 先考虑Terraform可能对您的组织产生的潜在影响。&lt;/p>
&lt;p>来源：&lt;a class="link" href="https://medium.com/aws-tip/say-goodbye-to-terraform-infrastructure-as-code-for-humans-with-pulumi-76e72de1c3d9" target="_blank" rel="noopener"
>https://medium.com/aws-tip/say-goodbye-to-terraform-infrastructure-as-code-for-humans-with-pulumi-76e72de1c3d9&lt;/a>&lt;/p>
&lt;p>Feature picture ❤️ : kike &lt;a class="link" href="https://unsplash.com/@kikekiks?utm_source=medium&amp;amp;utm_medium=referral" target="_blank" rel="noopener"
>vega on Unsplash&lt;/a>&lt;/p></description></item><item><title>DevOps 从业者需要理解的 DORA Core 模型</title><link>https://martinliu.cn/blog/dora-core/</link><pubDate>Thu, 04 Jan 2024 09:12:31 +0800</pubDate><guid>https://martinliu.cn/blog/dora-core/</guid><description>&lt;img src="https://martinliu.cn/blog/dora-core/1_j4QaVlm5rlBlSsyluXH2Dg.webp" alt="Featured image of post DevOps 从业者需要理解的 DORA Core 模型" />&lt;h2 id="dora-core-模型">DORA Core 模型
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/blog/dora-core/dora-core-model-v1.2.2.webp"
width="8448"
height="4752"
srcset="https://martinliu.cn/blog/dora-core/dora-core-model-v1.2.2_hu_355f72f46b874b9d.webp 480w, https://martinliu.cn/blog/dora-core/dora-core-model-v1.2.2_hu_7090e406331335b7.webp 1024w"
loading="lazy"
alt="DORA Core 英文版"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="426px"
>
&lt;a class="link" href="dora-core-model-v1.2.2.pdf" >下载 PDF 版&lt;/a>&lt;/p>
&lt;p>关于这个模型：DORA Core是DORA研究计划的成果，它是从历史和广度上发现到的，一系列最坚实存在的能力、指标和成果的集合。核心是从DORA的持续研究中得出的，包括我们年度《加速DevOps状态报告》中提出的分析。核心旨在在从业者的背景中作为指南使用：它有意追随研究，更保守地发展。核心模型中显示的概念和关系已经在我们的研究中反复证明，并已成功被软件工程团队用于优先考虑持续改进。常见问题解答见下文。&lt;/p>
&lt;h2 id="dora-core-是什么">DORA Core 是什么？
&lt;/h2>&lt;p>DORA的研究项目是持续而不断的；每年都带来新的调查方向，每次分析都带来新的见解。在前沿领域，新概念经常被引入，而文献（尤其是DevOps状态加速报告）的不断发布，揭示新的见解和动态。随着每项研究，一些先前的发现得到强化，而其他一些可能受到质疑。这是良好科学的标志：任何新发现都应该被视为可疑的——引人入胜，但可疑——直到通过复制和应用得到验证。与此同时，鼓励从业者将研究应用于自己的专业背景中。在这种背景下，跟上DORA的最新发展可能是具有挑战性的：在大型组织中进行文化转型需要稳健的手段，要在跨越多年的时间段内持续进行。试图更新实践以匹配研究的速度可能导致逆生产的变动。在这些情境中，更实际的做法是依赖于“常青”文献。DORA Core代表了DORA最基础的发现的精髓：研究一再展现的指标、能力和结果。它使团队能够更精确地将改进努力集中在可能为其组织目标和生活质量产生有形利益的方面。&lt;/p>
&lt;h2 id="核心包含哪些概念">核心包含哪些概念？
&lt;/h2>&lt;p>DORA Core涵盖了DORA长期研究并得到良好支持的概念集。这些概念包括连续交付和生成性组织文化等能力，以及“四个关键”指标等指标，以及组织绩效等结果。这些已建立的思想与研究中表现出有希望但（尚未）得到DORA预测模型支持的领域或不同的预测路径形成对比。如果一个概念符合以下条件之一，则可以考虑纳入核心：&lt;/p>
&lt;ul>
&lt;li>a)已研究至少两次；&lt;/li>
&lt;li>b)从业者发现它有价值；&lt;/li>
&lt;li>c)继续探索是有必要的。&lt;/li>
&lt;/ul>
&lt;p>这个标准是有意主观的：它在很大程度上依赖于数据和分析，但最终是由直觉引导的。因此，请贡献出你的观点！您的直觉是宝贵的；如果您觉得某事没有准确反映研究，请告诉我们。&lt;/p>
&lt;h2 id="核心会变吗">核心会变吗？
&lt;/h2>&lt;p>会！研究的应用比研究本身更稳定。但它并非静止不动。核心会随着时间的推移而发展，我们目前正在调查的事物将来一旦确立，就会“毕业”进入核心。纳入核心需要一定的支持阈值；同样，如果收集到足够的证据来支持核心中的某个部分的移除或修改，它将被弃用。核心是由研究启发并随研究演变的——但速度较慢。&lt;/p>
&lt;h2 id="什么是核心模型">什么是核心模型？
&lt;/h2>&lt;p>DORA核心模型是DORA自成立以来一直在开发的预测框架的视觉总结。它借鉴了多年来开发的所有结构方程模型（SEMs），以突出最受支持的实体和预测路径。鼓励从业者研究模型并将其用于指导他们的持续改进之旅。&lt;/p>
&lt;h2 id="所有研究年份都被平等对待吗">所有研究年份都被平等对待吗？
&lt;/h2>&lt;p>不是。一些发现被证明非常耐久，年复一年地复制。但是，当研究动态背景时，其他发现已经发生了变化。此外，每年我们都会增加或减少研究领域。我们的目标是在多年内创造出一些持久的东西，同时在我们继续学习的过程中发展。为此，比起较旧的研究，最近的研究权重更大。这就是为什么，例如，“安全向左移”与技术能力分开的原因，它反映了从2021年和2022年的研究中显示出安全实践对软件交付性能的独特影响的发现。&lt;/p>
&lt;p>扩展阅读：感兴趣下载中文版本的研究报告，可以在这里下载&lt;a class="link" href="https://www.devopschina.org/sdm_downloads/" target="_blank" rel="noopener"
>https://www.devopschina.org/sdm_downloads/&lt;/a>&lt;/p></description></item><item><title>通过统计数据看 2024 年的 DevOps 趋势</title><link>https://martinliu.cn/blog/devops-statistics/</link><pubDate>Tue, 02 Jan 2024 10:32:21 +0800</pubDate><guid>https://martinliu.cn/blog/devops-statistics/</guid><description>&lt;img src="https://martinliu.cn/blog/devops-statistics/download.webp" alt="Featured image of post 通过统计数据看 2024 年的 DevOps 趋势" />&lt;h2 id="2024年devops-的采用统计">2024年DevOps 的采用统计
&lt;/h2>&lt;p>DevOps 市场庞大，相应的，它离停滞不前还差得远，仍在不断演变，最重要的是，DevOps已经证明了自己的重要性，以往任何时候都更为重要。您将惊讶地了解，在DevOps中发生了一些非凡的事情。您想知道这些事情是什么吗？继续阅读以了解它们。&lt;/p>
&lt;p>根据Gartner的研究，到2025年，超过85%的组织将采纳云为先的原则。这不是很有趣吗？当然，是的，对吧？现在让我们带您了解一下2024年的DevOps采用统计数据。&lt;/p>
&lt;ol>
&lt;li>DevOps有助于企业将处理支持工单所花费的时间减少60% - 对于寻求在2024年采用DevOps的组织而言，这是一个很好的前景。&lt;/li>
&lt;li>组织通过DevOps能够将33%的时间投资于基础设施改进。&lt;/li>
&lt;li>94%的组织认为平台工程有助于他们充分实现DevOps的好处 - 这对于那些想在2024年在企业中取得规模化成功的人来说是一个很好的统计数据。&lt;/li>
&lt;/ol>
&lt;p>这些统计数据令人兴奋，不是吗？这些统计数据描绘了：DevOps已经改变了企业的工作方式，并产生了成果。&lt;/p>
&lt;h2 id="devops-的增长统计">DevOps 的增长统计
&lt;/h2>&lt;p>全球DevOps市场规模预计将从2023年的104亿美元增至2028年的255亿美元，增长率为18.95%。根据Global Newswire的研究，到2026年，预计将达到12215.54百万美元，复合年增长率为18.95%。&lt;/p>
&lt;ol>
&lt;li>86%的企业表示，他们的公司必须迅速开发和投产新软件，因此他们认为DevOps具有价值。不容忽视的是，能够迅速向消费者交付数字产品的企业具有竞争优势。&lt;/li>
&lt;li>Google收集的数据和研究也表明，77%的组织目前依赖DevOps部署软件，或计划不久将会这样做。&lt;/li>
&lt;/ol>
&lt;h2 id="2024年devops的容器化统计">2024年DevOps的容器化统计
&lt;/h2>&lt;p>灵活性和快速发布是孕育容器理念的最重要基石，它已经成为当今IT世界的主流。现在让我们介绍一下DevOps容器化服务的一些统计数据，这些数据最终会让您感到惊讶。&lt;/p>
&lt;ol>
&lt;li>根据Gartner的新预测，全球容器管理收入预计将从2020年的465.8百万美元小幅增长到2024年的944百万美元。&lt;/li>
&lt;li>Gartner还预测，到2024年，15%的企业应用将在容器生态系统中运行。这一估计较2020年的不到5%有所增加，受技术债务、应用积压和预算约束的限制。&lt;/li>
&lt;li>46%的软件开发人员的首要任务是容器化，43%是质量和安全性，32%是CI/CD实施。&lt;/li>
&lt;li>应用容器市场规模在2021年估值为27.6亿美元，预计将在2030年达到338.6亿美元，复合年增长率为32.12%。&lt;/li>
&lt;/ol>
&lt;h2 id="devops-cicd-的统计">DevOps CI/CD 的统计
&lt;/h2>&lt;p>CI/CD流水线是一组在公司技术引入变更时运行的自动化流程。现在让我们看一下DevOps CI/CD的统计数据。&lt;/p>
&lt;ol>
&lt;li>全球CI工具市场规模在2022年估值为970.52百万美元，预计在2031年达到4377.77百万美元，在预测期间（2023-2031年）以18.22%的复合年增长率增长。&lt;/li>
&lt;li>随着企业对DevOps团队提出更高效率的需求，CI工具市场继续扩大，2021年估值为802.2百万美元。预计到2030年将达到37.6亿美元，代表18.74%的复合年增长率。&lt;/li>
&lt;/ol>
&lt;h2 id="aws-devops-的统计">AWS DevOps 的统计
&lt;/h2>&lt;p>首要的事情是，AWS DevOps有着令人印象深刻的声誉。2010年从物理服务器过渡到Amazon Web Services（AWS）云使应用程序和服务能够以更高的速度交付。&lt;/p>
&lt;ol>
&lt;li>它开始使用由内部Apollo系统管理的持续部署过程。该系统允许开发人员随时在任何服务器上开发代码，在任何需要的地方部署。&lt;/li>
&lt;li>截至2011年5月底，亚马逊平均每11.6秒向生产服务器部署新软件。在最繁忙的时候，每小时向生产环境发送1000多个新的版本。&lt;/li>
&lt;/ol>
&lt;h2 id="2024年azure-devops-的统计">2024年Azure DevOps 的统计
&lt;/h2>&lt;p>截至2023年，全球超过10695家公司已经开始使用Microsoft Azure DevOps Server作为版本控制工具。使用Azure DevOps服务器进行版本控制的企业主要来自美国，约5073家客户，占Microsoft Azure DevOps服务器客户总数的60.76%。&lt;/p>
&lt;ol>
&lt;li>Azure DevOps的市场份额为8.81%。它在版本控制类别中与三个竞争工具竞争。&lt;/li>
&lt;li>Azure DevOps用户数量接近10亿。根据Azure Active Directory的数据，Azure用户有7.222亿。&lt;/li>
&lt;li>在2023财年第一季度，Microsoft Azure的收入增长率为31%。&lt;/li>
&lt;/ol>
&lt;h2 id="2024年devops工程师统计分析">2024年DevOps工程师统计分析
&lt;/h2>&lt;p>DevOps已经进入了多个组织，引发了对多个DevOps人才的竞价战。因此，让我们看看一些揭示或描绘DevOps工作蓬勃发展的统计数据。&lt;/p>
&lt;ol>
&lt;li>DevOps工程师的平均薪水是133,133美元，美国的DevOps工程师的额外现金补偿为16,860美元。&lt;/li>
&lt;li>美国目前有超过6,881名DevOps工程师。&lt;/li>
&lt;li>所有DevOps工程师中，13.8%是女性，86.2%是男性。&lt;/li>
&lt;li>就业DevOps工程师的平均年龄为39岁。&lt;/li>
&lt;/ol>
&lt;h2 id="2024年devops市场统计">2024年DevOps市场统计
&lt;/h2>&lt;p>DevOps市场规模在2023年超过104亿美元，并预计从2024年到2028年将以19.7%的复合年增长率增长。此外，它受到缩短软件开发周期和加速交付的需求的推动。&lt;/p>
&lt;ol>
&lt;li>来自本地部分的DevOps市场规模预计将在2032年达到450亿美元，原因是人们对云环境中数据隐私的担忧增强。&lt;/li>
&lt;li>全球DevOps市场规模预计将在预测期间以19.7%的复合年增长率增长，从2023年的估计值104亿美元增至2028年的255亿美元。&lt;/li>
&lt;/ol>
&lt;h2 id="devops使用统计">DevOps使用统计
&lt;/h2>&lt;p>Atlassian调查了一些激动人心的DevOps趋势，揭示了一些有趣的统计数据；大多数人可能想知道结果描绘了什么，对吧？&lt;/p>
&lt;ol>
&lt;li>99%的受访者表示DevOps对他们的组织产生了积极影响。此外，78%的人说，由于DevOps，他们不得不学习新的技能，而48%的人说，这帮助他们得到了加薪。&lt;/li>
&lt;li>61%的受访者表示，DevOps有助于生产更高质量的可交付成果。&lt;/li>
&lt;li>49%的受访者表示，DevOps改善了他们的发布实验。&lt;/li>
&lt;li>99%的受访者表示，DevOps对他们的组织产生了积极影响。&lt;/li>
&lt;/ol>
&lt;h2 id="2024年devsecops统计">2024年DevSecOps统计
&lt;/h2>&lt;p>DevSecOps确保在整个开发过程中都有安全控制。它通过将安全性集成到CI/CD管道中所需的地方来实现这一目标。现在让我们带您了解DevSecOps的统计数据。&lt;/p>
&lt;ol>
&lt;li>34%的组织拥有经验丰富的DevSecOps文化，对于那些寻求在2024年采用DevSecOps的人来说，这是一个好兆头。&lt;/li>
&lt;li>到2024年，组织在DevSecOps自动化方面的年度投资将约增加35%。&lt;/li>
&lt;li>将DevSecOps文化扩展到组织中的更多团队和应用程序是数字转型和更快、更安全软件发布的关键驱动因素，占94%的CIO。&lt;/li>
&lt;li>根据90%的IT领导者的说法，通过在DevOps和安全项目中增加AIOps的使用，可以在2024年及以后扩大DevSecOps。&lt;/li>
&lt;li>96%的受访者表示，自动化安全和合规性操作，这是DevOps的核心原则，对他们的业务产生了好处。&lt;/li>
&lt;li>60%的工程师能够以两倍的速度发布代码，这归功于DevSecOps的原则。&lt;/li>
&lt;/ol>
&lt;h2 id="2024年devops收益统计">2024年DevOps收益统计
&lt;/h2>&lt;p>在实施DevOps之后，组织必须了解，这需要组织变革和转变。这不仅仅是关于实施新技术，更是关于以人和流程为重心的方法。让我们看一些DevOps收益的统计数据。&lt;/p>
&lt;ol>
&lt;li>操作在最高安全级别运行的22%的企业已经达到了DevOps的高级阶段，根据Puppet的报告。&lt;/li>
&lt;li>根据Forrester收集的数据，51%的DevOps用户将DevOps应用于新的和现有的应用程序，其中只有13%表示他们的DevOps方法仅限于概念验证实施。&lt;/li>
&lt;li>Forrester的另一项研究表明，71%的DevOps采用者使用微服务和容器。&lt;/li>
&lt;/ol>
&lt;p>这是关于2024年DevOps采用和增长的一些统计数据，让我们深入了解了DevOps的影响和趋势。&lt;/p>
&lt;p>&lt;a class="link" href="https://radixweb.com/blog/devops-statistics" target="_blank" rel="noopener"
>来源：https://radixweb.com/blog/devops-statistics&lt;/a>&lt;/p></description></item><item><title>2024年 DevOps 的10大趋势</title><link>https://martinliu.cn/blog/devops-top-trends-for-2024/</link><pubDate>Tue, 02 Jan 2024 10:03:49 +0800</pubDate><guid>https://martinliu.cn/blog/devops-top-trends-for-2024/</guid><description>&lt;img src="https://martinliu.cn/blog/devops-top-trends-for-2024/devops-trends-thumbnail.webp" alt="Featured image of post 2024年 DevOps 的10大趋势" />&lt;p>我们迎接2024年的到来，很明显，DevOps正在迅速发展。这一领域正在经历重大变革，开发人员和组织需要及时了解新兴趋势，以保持竞争力和效率。在本文中，我们将探讨正在塑造DevOps未来的十大趋势。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>AI和ML在DevOps中的应用：AI和自动化在DevOps中的使用并非新鲜事物。然而，我们预计在未来一年内这些技术的采用将显著增加。AI和ML正在增强智能自动化，实现预测性分析，并改善DevOps过程中的异常检测。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DevSecOps和安全集成：网络威胁的频率和复杂性不断增加，这促使安全性集成到DevOps管道的每个阶段，从而催生了DevSecOps的崛起。这一趋势强调在软件开发生命周期的每个步骤都纳入安全措施，培养一种安全责任由所有团队成员共享的文化。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>NoOps和高级自动化：NoOps的概念正在迅速获得推动力，操作流程被自动化到了很高的程度，甚至于感觉保持专门的运维团队都变得多余了。NoOps设想未来的系统将变得自我管理和自我修复，由AI自动化驱动。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>无服务器计算：在2024年，无服务器计算的采用是显著影响了DevOps的趋势。无服务器计算，其中云提供商动态分配机器资源，使开发人员更专注于编写代码而不是管理基础设施。这一趋势受到了对可伸缩性、成本效益以及简化部署过程需求的推动。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>增强的可观测性和监控：全面的可观测性和监控正在成为DevOps的关键优先事项。随着系统变得越来越复杂，对先进监控、日志记录和追踪解决方案的需求变得至关重要，以获得对应用程序性能的深入洞察。增强的可观测性使DevOps团队能够预先解决问题，提高应用程序的可靠性和性能。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>强调多云和边缘计算策略：多云和边缘计算策略的不断普及是2024年影响DevOps的另一趋势。多云方法通过在多个云提供商之间优化工作流程来提供灵活性。这一趋势受到了组织避免供应商锁定，并确保资源高效利用的需求推动。边缘计算也因其能够在数据生成的地方附近处理数据的能力而受到青睐，这对于需要低延迟的应用程序至关重要。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>GitOps和基础架构即代码（IaC）：GitOps和基础架构即代码（IaC）是2024年改变DevOps的两个重要趋势。这些趋势是：对管理日益复杂的基础架构，和更高效的基础设施供应方法的挑战的回应。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DevOps中的ChatOps：ChatOps，将聊天平台与运维工具集成在一起，是2024年影响DevOps的另一个趋势。与传统通信工具不同，ChatOps允许在聊天应用程序内直接与软件开发工具进行交互，实现即时响应和操作。通信和操作工具的直接集成表明了减少响应时间和增强团队灵活性的实际方法。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>低代码和无代码开发：在2024年，低代码/无代码开发正因组织寻求加速开发流程和降低成本而获得动力。低代码/无代码平台正在通过实现更快速的应用程序开发和部署改变DevOps的格局。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>不断增长的DevOps市场和云采用：根据MarketsandMarkets™的报告，DevOps市场预计将在2023年从104亿美元增长到2028年的255亿美元，年复合增长率（CAGR）为19.7%。这些趋势突显了DevOps在现代软件开发中日益重要的地位，强调了其不断增长的市场潜力和影响。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="结论">结论
&lt;/h2>&lt;p>当我们审视2024年的DevOps格局时，很明显，这一领域正在经历重大变革。采用AI和ML，将安全性整合到DevOps中，以及不断增加的自动化使用是塑造DevOps未来的一些趋势。&lt;/p>
&lt;p>&lt;a class="link" href="https://blog.codegiant.io/the-next-wave-of-devops-top-trends-for-2024/" target="_blank" rel="noopener"
>本文转自：https://blog.codegiant.io/the-next-wave-of-devops-top-trends-for-2024/&lt;/a>&lt;/p></description></item><item><title>先睹为快 Azure OpenAI 驱动的 Elastic 可观测性 ‘AI 助理’</title><link>https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/</link><pubDate>Tue, 05 Dec 2023 13:10:43 +0800</pubDate><guid>https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/</guid><description>&lt;img src="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/pexels-cottonbro-studio-6153354.webp" alt="Featured image of post 先睹为快 Azure OpenAI 驱动的 Elastic 可观测性 ‘AI 助理’" />&lt;p>在最近的 ElasticON 大会上，Elastic 可观测性的 AI Assistant 得到了充分曝光。在 Keynote 中，还专门做了一个演示，展示了 AI Assistant 的功能，以及如何使用 AI Assistant 来解决问题。&lt;/p>
&lt;p>我最近好在学习微软的 Azure OpenAI 服务，在我的 Azure 环境中，已经创建了一个 OpenAI 服务，可以用于AI Assistant 的测试。因此，我就想看看 Elastic 的 AI Assistant 和 Azure 的 OpenAI 服务结合起来的效果如何。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/AIOps_blog-720x420.webp"
width="720"
height="420"
srcset="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/AIOps_blog-720x420_hu_180396ed0104d7fe.webp 480w, https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/AIOps_blog-720x420_hu_87886cc9cafaa591.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="411px"
>&lt;/p>
&lt;h2 id="elastic-可观测性的-ai-assistant">Elastic 可观测性的 AI Assistant
&lt;/h2>&lt;p>它有两个使用方式：&lt;/p>
&lt;ol>
&lt;li>Contextual insights ： 在可观测性 APP 的界面中，在很多特定的位置，都可以点击右上角的 AI Assistant 链接，然后进入当前界面的上下文分析，在日志和 APM 中都已经做了集成。此功能的目标是：帮你理解错误日志和指标信息，并尽可能的给你一定的解释和建议。
&lt;ol>
&lt;li>Universal Profiling - 解释了运行的应用里最昂贵的库和函数，并提供优化建议。&lt;/li>
&lt;li>应用性能监控（APM） - 解释了APM错误并提供纠正建议。&lt;/li>
&lt;li>基础设施可观测性 （Infrastructure observability）- 解释了在主机上运行的进程。&lt;/li>
&lt;li>日志 （log）- 解释了日志消息并生成搜索模式以查找类似问题。&lt;/li>
&lt;li>告警 （alerting） - 为日志速率变化提供可能的原因和纠正建议。&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>Chat 聊天会话 ： 以可观测性数据为基础，你可以请求机器人为你汇总、分析、和可视化数据。从而得到你想要的结果，可能是为了制作某个报表，也可以能是开始探索分析某个性能问题。&lt;/li>
&lt;/ol>
&lt;p>运行这个功能的前提条件：&lt;/p>
&lt;ul>
&lt;li>Elastic Stack version 8.9 或者更高&lt;/li>
&lt;li>拥有 Elastic Enterprise 订阅&lt;/li>
&lt;li>一个 AI 服务方的账号，比如 Azure OpenAI gpt-4(0613) 或 gpt-4-32k(0613) 服务， 或者 OpenAI gpt-4 服务&lt;/li>
&lt;li>为了使用私域文档作为知识库，还需要一个至少 4GB 的机器学习节点。&lt;/li>
&lt;/ul>
&lt;h2 id="准备-azure-openai-服务">准备 Azure OpenAI 服务
&lt;/h2>&lt;p>首先，你需要在 Azure 的 Portal 中创建一个 OpenAI 服务，这个服务提供 OpenAI GPT-4 模型，我创建的服务名称是 &lt;code>ai4elasticstack&lt;/code>。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_13-44-47.webp"
width="1175"
height="789"
srcset="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_13-44-47_hu_45ba0d556f91b72e.webp 480w, https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_13-44-47_hu_8c0282827f8b9ac6.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="148"
data-flex-basis="357px"
>&lt;/p>
&lt;p>这里确保选择 Azure OpenAI 的服务所在区域里能提供 gpt-4 模型，比如我选择的是瑞士中部。&lt;/p>
&lt;p>然后，是在这个区域中部署所需要的模型。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_13-52-26.webp"
width="1087"
height="956"
srcset="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_13-52-26_hu_dc8455a9ffc2dd4b.webp 480w, https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_13-52-26_hu_131514403fd28ff5.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="113"
data-flex-basis="272px"
>&lt;/p>
&lt;p>这里我部署了 gpt-4-32k 模型，需要注意的是：token 的限速需要调整到最大，这样才能保证 AI Assistant 的正常使用。&lt;/p>
&lt;h2 id="创建-ai-assistant-的连接器">创建 AI Assistant 的连接器
&lt;/h2>&lt;p>在 Elastic Cloud 中，创建一个 AI Assistant 所需要使用到的连接器，这个连接器的类型是 Azure OpenAI，然后，填写 Azure OpenAI 服务的相关信息，如下图所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_13-56-18.webp"
width="1257"
height="1109"
srcset="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_13-56-18_hu_f68ec64b93c842ea.webp 480w, https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_13-56-18_hu_2566a6697d9bca30.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="113"
data-flex-basis="272px"
>&lt;/p>
&lt;p>URL 是一个重要的参数，它的格式如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">https://{your-resource-name}.openai.azure.com/openai/deployments/{deployment-id}/completions?api-version={api-version}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其中，&lt;code>{your-resource-name}&lt;/code> 是你创建的 Azure OpenAI 服务的名称，&lt;code>{deployment-id}&lt;/code> 是你创建的 Azure OpenAI 服务的部署 ID（即名称），&lt;code>{api-version}&lt;/code> 是你创建的 Azure OpenAI 服务的 API 版本。这里的 &lt;code>{deployment-id}&lt;/code> 与 &lt;code>{api-version}&lt;/code> 有一定的排列组合，某些组合是不工作的，我当前的选择是可以工作：&lt;code>gpt4（32k 0613 版本） 和 2023-07-01-preview&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">https://ai4elasticstack.openai.azure.com/openai/deployments/gpt432k0613/chat/completions?api-version=2023-07-01-preview
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里配置完 URL 和 API 秘钥之后，点击“测试”页面，如果一切正常，你会看到一个绿色的正常调用 OpenAI 的返回。这样你的 AI Assistant 就可以正常工作了。&lt;/p>
&lt;h2 id="理解日志中的错误">理解日志中的错误
&lt;/h2>&lt;p>进入可观测性 app，点击 Stream，在这里选中一条报错的日志，内容如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">16:23:13.729
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">elastic_agent.metricbeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[elastic_agent.metricbeat][error] Error fetching data for metricset docker.memory: No memory stats data available
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>点击 &lt;code>view detail&lt;/code>，查看这条日志的详细信息。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_09-59-13.webp"
width="1781"
height="1173"
srcset="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_09-59-13_hu_d6410336f2863e9.webp 480w, https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_09-59-13_hu_87389571c5caeb0b.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="151"
data-flex-basis="364px"
>&lt;/p>
&lt;p>AI Assistant 会自动分析这条日志，然后给出两个选项。&lt;/p>
&lt;ol>
&lt;li>点击“What&amp;rsquo;s this message?”, AI Assistant 会给出这条日志的解释，以及可能的原因。这个 host 上由于 Docker 服务没有启动，导致 Metricbeat 无法获取到 Docker 的内存信息。AI Assistant 首先对这条日志，做了解释，解释内容里包含了你可能会关注的元数据信息，包括：版本号、操作系统、日志级别等。然后推测出是 Docker 服务没有启动的原因。最后，说明这是不正常的情况，应该尽快排查 Docker 服务。同一条错误信息，也可能会出现不同的解释。下面是整个 AI Assistant 的解释内容：&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>The log entry you provided is from an Elastic Agent running on a host named &amp;ldquo;linux-dev-02&amp;rdquo; with the IP address &amp;ldquo;10.1.0.4&amp;rdquo;. The host is running Ubuntu 22.04.3 LTS (Jammy Jellyfish) with kernel version 6.2.0-1017-azure. The Elastic Agent version is 8.10.4 and it&amp;rsquo;s not a snapshot version. The agent is running on a cloud instance in the &amp;ldquo;eastasia&amp;rdquo; region of Azure.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>The component that generated this log entry is Metricbeat, which is a lightweight shipper that you can install on your servers to periodically collect metrics from the operating system and from services running on the server. The specific Metricbeat module in use here is the Docker module, which collects metrics and logs from Docker containers.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>The log level of the message is &amp;ldquo;error&amp;rdquo;, which indicates that an error or problem has occurred. The specific error message is &amp;ldquo;Error fetching data for metricset docker.memory: No memory stats data available&amp;rdquo;. This suggests that Metricbeat was unable to fetch memory statistics for a Docker container. This could be due to a number of reasons, such as the Docker container not being active, the Docker daemon not being accessible, or the Docker API not returning memory statistics.&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>Whether this is expected or an issue depends on your specific setup and expectations. If you expect to be collecting memory statistics from Docker containers and this error is preventing that, then it would be an issue. If you&amp;rsquo;re not using Docker or not interested in collecting memory statistics from Docker containers, then it might not be an issue. However, it&amp;rsquo;s generally not expected for errors to be occurring, so it might be worth investigating further to understand why this error is happening.&lt;/p>&lt;/blockquote>
&lt;ol start="2">
&lt;li>如果点击“How do i find similar log messages?” , AI Assistant 会给出一个 KQL 查询语句，使用这个查询语句会返回与这条日志相似的日志。这个查询语句的结果，可以帮助你更好的理解这条日志的上下文。&lt;/li>
&lt;li>链接器选择：你可以在 Elastic Stack 中，配置多个 AI Assistant 的连接器，可能对应到不同的 OpenAI 服务+版本的组合。&lt;/li>
&lt;/ol>
&lt;p>这个功能的好处：&lt;/p>
&lt;ul>
&lt;li>通过 AI Assistant 的解释，它可以帮助你更全面的理解日志的内容本身，由于每个人并不是熟悉所有的技术领域，AI 在这里可以很好的补充你的知识短板。&lt;/li>
&lt;li>在高压力的排错环境中，从模糊的日志事件内容中，很快的得出下一步排查的方向是比较有意义的。人脑很有可能在疲惫状态下，很难准确地得出下一个排查的动作。&lt;/li>
&lt;li>AI 对错误原因的推理，看着并不一定高明，但是作为排错的起点，还是比较有用的。你可以在这个基础上，点击界面上的 “Start Chat” 按钮，进入到 Chat 聊天会话功能模式，然后，继续与 AI 机器人对话，追问：“其他潜在的故障原因是那些？”；这样 AI 给我了另外不同的 4 种故障可能，涉及 Docker 服务器、配置、Metricbeat 的配置等等。可见 AI 在细分领域里的知识的深度还是一些的。&lt;/li>
&lt;/ul>
&lt;p>下面是我的追问和 AI 的回答，这里是支持中文：&lt;/p>
&lt;p>“
You：还有什么可能的原因会导致这个问题？&lt;/p>
&lt;p>Elastic Assistant ：这个错误信息表示 Metricbeat 无法获取 Docker 容器的内存统计信息。可能的原因包括：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Docker 容器未运行：如果你试图获取一个未运行或不存在的 Docker 容器的内存统计信息，将会出现这个错误。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Docker 守护进程无法访问：Metricbeat 需要能够访问 Docker 守护进程来获取容器的统计信息。如果由于某种原因（例如权限问题或网络问题）无法访问 Docker 守护进程，将会出现这个错误。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Docker API 未返回内存统计信息：Metricbeat 通过 Docker API 获取容器的统计信息。如果 Docker API 未返回内存统计信息，将会出现这个错误。这可能是因为 Docker API 的问题，或者是因为容器本身没有生成内存统计信息。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Metricbeat 配置问题：如果 Metricbeat 的 Docker 模块没有正确配置，可能也会导致这个问题。例如，如果 Metricbeat 没有正确配置 Docker 守护进程的地址，或者没有提供正确的证书来访问需要 TLS 的 Docker 守护进程，将会出现这个错误。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>你可以根据这些可能的原因进行排查，看看哪一项可能是问题所在。
”&lt;/p>
&lt;p>这个功能还在可观测性的其它功能模块中也做了深度的集成，例如在 APM 等模块中，也可以调用到 AI Assistant 的 “上下文洞见”；基本上，就是 Elastic Stack 在多个场景中，人类可用将自己分析错误信息的工作一定程度的交给 AI 去做；这样，我们就可以更加专注于问题的解决，而不是在监控数据、时序信息的分析上浪费更多的时间。从长远来看，这个上下文洞见的辅助排查功能，确实是有辅助驾驶和导航的意义，还是比较有用的。&lt;/p>
&lt;h2 id="chat-聊天会话功能">Chat 聊天会话功能
&lt;/h2>&lt;p>我测试了一个开放式的问题，希望 AI 能帮我分析出：我的服务器是否即将有磁盘空间用尽的情况发生。如下图所示：&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_17-13-51.webp"
width="1546"
height="1336"
srcset="https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_17-13-51_hu_365df5492613d35d.webp 480w, https://martinliu.cn/blog/elastic-elastic-obs-ai-assistant-aoai/2023-12-05_17-13-51_hu_3aa799cb1f96d187.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="115"
data-flex-basis="277px"
>&lt;/p>
&lt;p>下面解释一下 AI Assistant 的回答：&lt;/p>
&lt;ol>
&lt;li>我使用英语提问，其实你可以用任何语言提问，OpenAI 都可以正确理解。&lt;/li>
&lt;li>点击这里折叠隐藏的 7 个步骤，这些步骤是 AI Assistant 为了回答我的问题，所做的推理思考和处理过程。这里使用了多个方法调用，包括在 Elasticsearch 数据库中查找任何它想要的信息。 AI Assistant 的知识库【你可以将知识库配置在 Elasticsearch 中，AI 的分析流水线，读取并理解知识条目内容，并调用这些知识】，以及我的问题的上下文信息，AI Assistant 会根据这些信息，做出推理，然后给出回答。&lt;/li>
&lt;li>最终 AI 用绘图的方式给出主机的磁盘空间利用率的汇总情况，很可惜的是，它几乎就做对了；这个图形没有显示出来的原因是：在最后还应该调用一个 max 或者 avg 的运算函数。&lt;/li>
&lt;li>最后一句话，再次解释并总结了我的提问。&lt;/li>
&lt;/ol>
&lt;p>我并没有继续这个会话，如果继续问答下去的话，如果 AI Assistant 的聊天内容总是我所期望的正确的结果内容；那么，很可能我们就不需要去各种界面里到处点击、查看和分析各种数据图表和原始数据了。假如以后接入了自然语音的输入界面，那么，未来这种排错和分析场景还确实是一种比较科幻的感觉。&lt;/p>
&lt;p>AI助手使用函数通过文本、数据和可视化组件在聊天对话中包含相关上下文。您和AI助手都可以提出函数建议。您还可以编辑AI助手的函数建议并检查函数响应。&lt;/p>
&lt;p>以下表格列出了可用的函数：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>summarize ：总结对话的部分。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>recall ：回顾先前的学习。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>lens ：使用Lens创建自定义可视化，可以添加到仪表板中。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>elasticsearch ：代表您调用Elasticsearch API。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>kibana ：代表您调用Kibana API。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>alerts ：获取可观测性的警报。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>get_apm_timeseries ：显示任何服务或所有服务及其任何或所有依赖项的不同APM指标（如吞吐量、故障率或延迟）。既显示为时间序列，也显示为单一统计数据。此外，该函数返回任何更改，如峰值、步进和趋势更改或下降。您还可以使用它通过请求两个不同的时间范围，或者例如两个不同的服务版本来比较数据。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>get_apm_error_document ：根据分组名称获取示例错误文档。这还包括错误的堆栈跟踪，这可能提示错误的原因。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>get_apm_correlations ：获取在前景集中比背景集更突出的字段值。这对于确定哪些属性（例如error.message、service.node.name或transaction.name）对高延迟的贡献是有用的。另一个选项是基于时间的比较，您可以在更改点之前和之后进行比较。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>get_apm_downstream_dependencies ：获取服务的下游依赖项（服务或未被检测的后端）。通过返回span.destination.service.resource和service.name两者将下游依赖项名称映射到服务。如果需要，可以使用此功能进一步深入挖掘。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>get_apm_service_summary ： 获取单个服务的摘要，包括语言、服务版本、部署、环境以及它运行的基础设施。例如，pod的数量和它们的下游依赖项列表。它还返回活动警报和异常。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>get_apm_services_list ：获取受监控服务的列表，它们的健康状态和警报。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>由于时间有限，我并没有做知识库的导入，从文档中看到，知识库私域信息的注入基本上是这样的过程：首先将知识库文档整理后导入到 Elasticsearch 的一个索引中，然后使用结合 Elasticsearch 本身的 ELSER 自然语音处理能力和 OpenAI 的理解推理能力，来支撑 AI 辅助分析排查问题的过程。&lt;/p>
&lt;p>以上功能测试的配置非常简单，在 Elastic Cloud 的环境中，参考本文，你应该在 10 分钟内就可以完成所有配置。从上下文分析和聊天的两个场景中，我们可以很快的找到 AI 辅助运维的感觉。&lt;/p>
&lt;blockquote>
&lt;p>参考文章 ：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.elastic.co/guide/en/observability/current/obs-ai-assistant.html" target="_blank" rel="noopener"
>https://www.elastic.co/guide/en/observability/current/obs-ai-assistant.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.youtube.com/watch?v=AQ4sPC_O2Ck&amp;amp;ab_channel=Elastic" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=AQ4sPC_O2Ck&amp;ab_channel=Elastic&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.elastic.co/blog/context-aware-insights-elastic-ai-assistant-observability" target="_blank" rel="noopener"
>https://www.elastic.co/blog/context-aware-insights-elastic-ai-assistant-observability&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.elastic.co/blog/whats-new-elastic-observability-8-9-0" target="_blank" rel="noopener"
>https://www.elastic.co/blog/whats-new-elastic-observability-8-9-0&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.elastic.co/blog/whats-new-elastic-observability-8-10-0" target="_blank" rel="noopener"
>https://www.elastic.co/blog/whats-new-elastic-observability-8-10-0&lt;/a>&lt;/li>
&lt;/ul>&lt;/blockquote>
&lt;p>Feature picture ❤️ cottonbro studio : &lt;a class="link" href="https://www.pexels.com/zh-cn/photo/6153354/" target="_blank" rel="noopener"
>https://www.pexels.com/zh-cn/photo/6153354/&lt;/a>&lt;/p></description></item><item><title>创建用于命令行登录认证 Azure 的 Service Principal 必读</title><link>https://martinliu.cn/blog/create-azure-sp-for-cli/</link><pubDate>Tue, 14 Nov 2023 11:03:55 +0800</pubDate><guid>https://martinliu.cn/blog/create-azure-sp-for-cli/</guid><description>&lt;img src="https://martinliu.cn/blog/create-azure-sp-for-cli/pexels-miguel-2882566.webp" alt="Featured image of post 创建用于命令行登录认证 Azure 的 Service Principal 必读" />&lt;p>DevOps的工作流程中所需要到各种各样的命令行工具，在 Azure 的环境中，不同的 DevOps 工具在运行之前，都必须先完成 Azuore 账号的登录认证。而且，最好是在非用户干预和交互的方式下，完成登录认证。在这种情况下就可以使用 Service Principal 的方式，来完成 Azure 账号的登录认证。本文介绍如何创建一个用于在命令行登录认证 Azure 的 Service Principal。&lt;/p>
&lt;h2 id="创建-service-principal">创建 Service Principal
&lt;/h2>&lt;p>首先你需要安装或者准备好 Azure CLI，然后使用 Azure CLI 命令行工具，创建一个 Service Principal 的命令如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az ad sp create-for-rbac --name azure-sp-4-devops &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--role Contributor &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--scopes /subscriptions/&lt;span class="si">${&lt;/span>&lt;span class="nv">SUBSCRIPTION&lt;/span>&lt;span class="si">}&lt;/span>/resourceGroups/&lt;span class="si">${&lt;/span>&lt;span class="nv">RESOURCE_GROUP&lt;/span>&lt;span class="si">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>参数说明：&lt;/p>
&lt;ul>
&lt;li>&lt;code>--name&lt;/code>：Service Principal 的名称，这个名称可以随意指定，但是最好是有意义的名称，方便后续的管理。&lt;/li>
&lt;li>&lt;code>--role&lt;/code>：Service Principal 的角色，这里指定为 &lt;code>Contributor&lt;/code>，表示这个 Service Principal 在 Azure 中的权限是 &lt;code>Contributor&lt;/code>。&lt;/li>
&lt;li>&lt;code>--scopes&lt;/code>：Service Principal 的作用域，这里指定为 &lt;code>/subscriptions/${SUBSCRIPTION}/resourceGroups/${RESOURCE_GROUP}&lt;/code>，表示这个 Service Principal 的作用域是 &lt;code>${RESOURCE_GROUP}&lt;/code> 资源组。
&lt;ul>
&lt;li>&lt;code>${SUBSCRIPTION}&lt;/code>：是一个环境变量，用于指定 Azure 订阅 ID。&lt;/li>
&lt;li>&lt;code>${RESOURCE_GROUP}&lt;/code>：是一个环境变量，用于指定 Azure 资源组名称。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>在上面的命令中，应该注意的是 &lt;code>--role&lt;/code> 需要是权限合理的值。应该保持最小可用权限的原则，不要使用 &lt;code>Owner&lt;/code> 这样的权限。如果你不知道应该使用什么权限，可以先使用 &lt;code>Contributor&lt;/code> 权限，然后在后续的使用中，逐步降低权限。&lt;/p>
&lt;p>在我最近的测试中，由于我需要在多个教程项目间切换不同的资源组，而且资源组都是短期的，用完了就用删除的资源组，删除整个资源组是彻底清除已用资源的一个好方法。因此我在 &lt;code>--scopes&lt;/code> 这个参数中，最经常使用的 SP 作用范围是 &amp;ndash;scopes /subscriptions/${SUBSCRIPTION} ，这样就可以在任何一个资源组中使用这个 SP 了。假如你需要在多个不同订阅之间工作，可以灵活的使用 ${SUBSCRIPTION} 这个环境变量，来指定不同的订阅 ID。&lt;/p>
&lt;p>以上命令行的输出结果类似如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;appId&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;3930xxxx-xxxx-xxxx-xxxx-xxxxd0e2xxxx&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;displayName&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;azure-sp-4-devops&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;password&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;eKxxxxxxxxxxxxxxxxxxxxxxxxxxxxX&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;#34;tenant&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;21d7xx-xxxxxx-xxxxxxx-xxxxxxx-xxxxxx55&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="将-sp-的细节信息用于命令行变量">将 SP 的细节信息用于命令行变量
&lt;/h2>&lt;p>以上输出结果默认是 JSON 格式的，如果你需要将它直接用于命令行变量，可以使用 &lt;code>--query&lt;/code> 参数，来指定输出的格式。例如，如果你需要将 &lt;code>appId&lt;/code> 等的值，用于命令行变量，参考使用如下的命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SERVICE_PRINCIPAL_JSON&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>az ad sp create-for-rbac --name aks-getting-started-sp --role Contributor --scopes /subscriptions/&lt;span class="si">${&lt;/span>&lt;span class="nv">SUBSCRIPTION&lt;/span>&lt;span class="si">}&lt;/span> -o json&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SERVICE_PRINCIPAL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$SERVICE_PRINCIPAL_JSON&lt;/span> &lt;span class="p">|&lt;/span> jq -r &lt;span class="s1">&amp;#39;.appId&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SERVICE_PRINCIPAL_SECRET&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$SERVICE_PRINCIPAL_JSON&lt;/span> &lt;span class="p">|&lt;/span> jq -r &lt;span class="s1">&amp;#39;.password&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">TENANT_ID&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$SERVICE_PRINCIPAL_JSON&lt;/span> &lt;span class="p">|&lt;/span> jq -r &lt;span class="s1">&amp;#39;.tenant&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上命令中，使用了 &lt;code>jq&lt;/code> 命令，来从 JSON 格式的输出中，提取出 &lt;code>appId&lt;/code> 和 &lt;code>password&lt;/code> 的值，并且分别用于命令行变量 &lt;code>SERVICE_PRINCIPAL&lt;/code> 和 &lt;code>SERVICE_PRINCIPAL_SECRET&lt;/code>。这样的好处是，避免了手工的复制和粘贴，也避免了数据在命令行的泄露。但是，如果是用于测试目的的 SP，也可以将这三个变量的值，直接复制保持到一个安全的地方，方便后续的反复使用。&lt;/p>
&lt;h2 id="登录-azure">登录 Azure
&lt;/h2>&lt;p>使用以上准备好的 Service Principal 登录 Azure 的命令如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az login &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--service-principal &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--tenant &lt;span class="nv">$TENANT_ID&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--username &lt;span class="nv">$SERVICE_PRINCIPAL&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--password &lt;span class="nv">$SERVICE_PRINCIPAL_SECRET&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--output table
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在以上三个变量都正确的情况下，运行完以上命令后，会输出当前登录的 Azure 账号的相关信息，类似如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Environment Name Tenant Id Subscription Id State Is Default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">------------- ------------------- ------------------------------------ ------------------------------------ ------- -----------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AzureCloud azure-sp-4-devops 21d7xx-xxxxxx-xxxxxxx-xxxxxxx-xxxxxx55 3930xxxx-xxxx-xxxx-xxxx-xxxxd0e2xxxx Enabled True
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这样，就完成了 Azure 账号的登录认证。&lt;/p>
&lt;h2 id="查看当前登录的-azure-账号">查看当前登录的 Azure 账号
&lt;/h2>&lt;p>如果不确定，当前是否已经登录，或者不确定在什么 Azure 的账号下，可使用以下命令，可以查看当前登录的 Azure 账号：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az account show
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="参考">参考
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest#az-ad-sp-create-for-rbac" target="_blank" rel="noopener"
>az ad sp create-for-rbac&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://docs.microsoft.com/en-us/cli/azure/reference-index?view=azure-cli-latest#az-login" target="_blank" rel="noopener"
>az login&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://docs.microsoft.com/en-us/cli/azure/reference-index?view=azure-cli-latest#az-account-show" target="_blank" rel="noopener"
>az account show&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>❤️ Feature Photo by Miguel Á. Padriñán: &lt;a class="link" href="https://www.pexels.com/photo/close-up-shot-of-keyboard-buttons-2882566/" target="_blank" rel="noopener"
>https://www.pexels.com/photo/close-up-shot-of-keyboard-buttons-2882566/&lt;/a>&lt;/p></description></item><item><title>使用 Terraform 创建 Aks 集群</title><link>https://martinliu.cn/blog/terraform-create-aks-cluster/</link><pubDate>Mon, 13 Nov 2023 09:49:03 +0800</pubDate><guid>https://martinliu.cn/blog/terraform-create-aks-cluster/</guid><description>&lt;img src="https://martinliu.cn/blog/terraform-create-aks-cluster/154.webp" alt="Featured image of post 使用 Terraform 创建 Aks 集群" />&lt;p>本文介绍如何使用 Terraform 创建一个基础配置的 Azure Kubernetes Service (AKS) 集群，可以用于快速的启动一个开发测试环境，基础特性如下。&lt;/p>
&lt;ul>
&lt;li>使用尽可能多的默认值&lt;/li>
&lt;li>node pool 使用了自动扩展，最小节点数为 1，最大节点数为 10&lt;/li>
&lt;li>AKS将使用由Azure自动创建和管理的托管身份&lt;/li>
&lt;/ul>
&lt;h2 id="登录-azure">登录 Azure
&lt;/h2>&lt;p>参考这篇文章《&lt;a class="link" href="https://martinliu.cn/blog/create-azure-sp-for-cli/" target="_blank" rel="noopener"
>创建用于命令行登录认证 Azure 的 Service Principal 必读&lt;/a>》，创建一个用于在命令行登录认证 Azure 的 Service Principal。&lt;/p>
&lt;p>为了将创建的 Service Principal 的细节信息，用于命令行变量，方便 Azure CLI 命令的参数化，还为了将所有必要的变量带入 &lt;code>.tf&lt;/code> 文件的变量中。可以参考下面的命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">TF_VAR_subscription_id&lt;/span>&lt;span class="o">=&lt;/span>XXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXXXX
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SERVICE_PRINCIPAL_JSON&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>az ad sp create-for-rbac --name aks-getting-started-sp --role Contributor --scopes /subscriptions/&lt;span class="si">${&lt;/span>&lt;span class="nv">TF_VAR_subscription_id&lt;/span>&lt;span class="si">}&lt;/span> -o json&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">TF_VAR_client_id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$SERVICE_PRINCIPAL_JSON&lt;/span> &lt;span class="p">|&lt;/span> jq -r &lt;span class="s1">&amp;#39;.appId&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">TF_VAR_client_secret&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$SERVICE_PRINCIPAL_JSON&lt;/span> &lt;span class="p">|&lt;/span> jq -r &lt;span class="s1">&amp;#39;.password&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">TF_VAR_tenant_id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$SERVICE_PRINCIPAL_JSON&lt;/span> &lt;span class="p">|&lt;/span> jq -r &lt;span class="s1">&amp;#39;.tenant&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">az login &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--service-principal &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--tenant &lt;span class="nv">$TF_VAR_tenant_id&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--username &lt;span class="nv">$TF_VAR_client_id&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--password &lt;span class="nv">$TF_VAR_client_secret&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--output table
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上在创建 Service Principal 的时候，使用了 &lt;code>--scopes /subscriptions/${TF_VAR_subscription_id}&lt;/code>，这样就可以在任何一个资源组中使用这个 SP 了。假如你需要在多个不同订阅之间工作，可以灵活的使用 &lt;code>${TF_VAR_subscription_id}&lt;/code> 这个环境变量，来指定不同的订阅 ID。&lt;/p>
&lt;p>这段命令中一共设置了四个命令行的环境变量，由于需要在 .tf 文件中作为变量使用，因此需要使用 &lt;code>TF_VAR_&lt;/code> 前缀，这样 Terraform 才能识别到这些变量。&lt;/p>
&lt;h2 id="登录-terraform-cloud">登录 Terraform Cloud
&lt;/h2>&lt;p>Terrafrom 命令行工具的安装本文忽略，详见官方文档 &lt;a class="link" href="https://www.terraform.io/docs/cli/index.html" target="_blank" rel="noopener"
>Terraform CLI&lt;/a> 。&lt;/p>
&lt;p>Terraform Cloud 是 Terraform 官方提供的一种 SaaS 服务，可以用于管理 Terraform 的状态文件，以及执行 Terraform 的计划和应用。本文中使用 Terraform Cloud 来管理状态文件，以及执行计划和应用。&lt;/p>
&lt;p>首先，你需要在 Terraform Cloud 中创建一个组织，然后创建一个工作区，用于存放状态文件。然后，你需要在本地安装 Terraform CLI 命令行工具，然后使用 Terraform CLI 命令行工具，登录 Terraform Cloud。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">terraform login
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="创建-aks-集群">创建 AKS 集群
&lt;/h2>&lt;p>本文使用的样例代码在 &lt;a class="link" href="https://github.com/martinliu/azure-labs/tree/main/lab02" target="_blank" rel="noopener"
>GitHub&lt;/a> 上，你可以直接使用这个样例代码，也可以参考这个样例代码，自己创建一个 AKS 集群。&lt;/p>
&lt;p>下面是样例代码中的 &lt;code>main.tf&lt;/code> 文件，这个文件中包含了创建 AKS 集群的所有必要的配置。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-hcl" data-lang="hcl">&lt;span class="line">&lt;span class="cl">&lt;span class="k">terraform&lt;/span> {&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # 使用远程 Cloud 后端
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">cloud&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> organization&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;DevOpsCoach&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">workspaces&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;aks-labs&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">provider&lt;/span> &lt;span class="s2">&amp;#34;azurerm&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">features&lt;/span> {}&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # 下面的配置允许 Terraform 以您的身份与 Azure API 进行交互，从而管理您的资源。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # 从 CLI 的环境变量中取得这些实际的数值
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n"> tenant_id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">tenant_id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> subscription_id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">subscription_id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> client_id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">client_id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> client_secret&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">var&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">client_secret&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">resource&lt;/span> &lt;span class="s2">&amp;#34;azurerm_resource_group&amp;#34; &amp;#34;example&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;${local.prefix}-rg&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> location&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">local&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">location&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上文件中引用了两种变量，一种是从 locals.tf 文件中引用的本地变量，另一种是从命令行的环境变量中读取到的&lt;code>TF_VAR&lt;/code> 开头的变量。这样从 Terraform 命令行执行之前，就可以将这些变量设置好，然后 Terraform 就可以使用这些变量了。&lt;/p>
&lt;p>下面是样例代码中的 &lt;code>locals.tf&lt;/code> 文件，这个文件中包含了创建 AKS 集群的所有必要的本地变量。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-hcl" data-lang="hcl">&lt;span class="line">&lt;span class="cl">&lt;span class="k">locals&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> prefix&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;aks4devops&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> location&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;eastasia&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">variable&lt;/span> &lt;span class="s2">&amp;#34;client_id&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> description&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;Client ID for the Azure provider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">variable&lt;/span> &lt;span class="s2">&amp;#34;client_secret&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> description&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;Client Secret for the Azure provider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">variable&lt;/span> &lt;span class="s2">&amp;#34;subscription_id&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> description&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;Subscription ID for the Azure provider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">variable&lt;/span> &lt;span class="s2">&amp;#34;tenant_id&amp;#34;&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> description&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;Tenant ID for the Azure provider&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里文件中设定了两个变量参数，另外还声明了四个命令带入的变量，它们是从命令行的环境变量中读取到的&lt;code>TF_VAR&lt;/code> 开头的变量。&lt;/p>
&lt;p>下面是样例代码中的 &lt;code>aks.tf&lt;/code> 文件，这个文件中包含了创建 AKS 集群的所有必要的配置。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-hcl" data-lang="hcl">&lt;span class="line">&lt;span class="cl">&lt;span class="k">resource&lt;/span> &lt;span class="s2">&amp;#34;azurerm_kubernetes_cluster&amp;#34; &amp;#34;example&amp;#34;&lt;/span> {&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # AKS cluster basic information
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n"> name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;${local.prefix}-k8s&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> location&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">azurerm_resource_group&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">example&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">location&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> resource_group_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">azurerm_resource_group&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">example&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> dns_prefix&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;${local.prefix}-k8s&amp;#34;&lt;/span>&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # node pool settings
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">default_node_pool&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;default&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> node_count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> min_count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> max_count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> vm_size&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;Standard_DS2_v2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> enable_auto_scaling&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kt">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"> # AKS use system auto created identity
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">identity&lt;/span> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n"> type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;SystemAssigned&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上集群基本上使用了所有的系统默认配置，除了设定了一个 node pool，这个 node pool 使用了自动扩展，最小节点数为 1，最大节点数为 10。&lt;/p>
&lt;p>在阅读了这些文件之后，就可以在本地执行 Terraform 的计划和应用了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">terraform init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">terraform plan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">terraform apply
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在执行以上命令的过程中，我们可以在 Terraform Cloud 的 Web 界面中，看到 Terraform 的执行过程。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/terraform-create-aks-cluster/2023-11-14_23-14-28.webp"
width="1578"
height="1044"
srcset="https://martinliu.cn/blog/terraform-create-aks-cluster/2023-11-14_23-14-28_hu_15e051fad001baca.webp 480w, https://martinliu.cn/blog/terraform-create-aks-cluster/2023-11-14_23-14-28_hu_356008a6fc51a38f.webp 1024w"
loading="lazy"
alt="terraform runs"
class="gallery-image"
data-flex-grow="151"
data-flex-basis="362px"
>&lt;/p>
&lt;p>在测试完成了之后，可以使用下面的命令，删除 AKS 集群。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">terraform destroy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="参考">参考
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://www.terraform.io/docs/cloud/index.html" target="_blank" rel="noopener"
>Terraform Cloud&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.terraform.io/docs/cloud/cli/install-bash.html" target="_blank" rel="noopener"
>Terraform Cloud - CLI&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.terraform.io/docs/cloud/cli/login.html" target="_blank" rel="noopener"
>Terraform Cloud - CLI - Login&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://docs.microsoft.com/en-us/cli/azure/reference-index?view=azure-cli-latest#az-login" target="_blank" rel="noopener"
>Azure CLI Login&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://docs.microsoft.com/en-us/azure/aks/" target="_blank" rel="noopener"
>Azure AKS documentation&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster" target="_blank" rel="noopener"
>Azure AKS Terraform documentation&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>使用 Azure CLI 创建 K8S 集群</title><link>https://martinliu.cn/blog/az-cli-create-aks-cluster/</link><pubDate>Fri, 10 Nov 2023 22:52:40 +0800</pubDate><guid>https://martinliu.cn/blog/az-cli-create-aks-cluster/</guid><description>&lt;img src="https://martinliu.cn/blog/az-cli-create-aks-cluster/hb9riivbne1jpgrnh77w.webp" alt="Featured image of post 使用 Azure CLI 创建 K8S 集群" />&lt;p>使用 Azure CLI 创建 K8S 集群是一种非常简单易用的方式。你可以在任何操作系统中安装 Azure CLI 命令行工具； 或者启动含有 Azure CLI 的容器，然后在容器内使用 Azure CLI 。&lt;/p>
&lt;p>
&lt;div class="video-wrapper">
&lt;iframe src="https://player.bilibili.com/player.html?as_wide=1&amp;amp;high_quality=1&amp;amp;page=1&amp;bvid=BV18Q4y187ng"
scrolling="no"
frameborder="no"
framespacing="0"
allowfullscreen="true"
>
&lt;/iframe>
&lt;/div>
&lt;div class="video-wrapper">
&lt;iframe src="https://player.bilibili.com/player.html?as_wide=1&amp;amp;high_quality=1&amp;amp;page=1&amp;bvid=BV1d4411N7zD"
scrolling="no"
frameborder="no"
framespacing="0"
allowfullscreen="true"
>
&lt;/iframe>
&lt;/div>
&lt;/p>
&lt;h2 id="准备-azure-cli">准备 Azure CLI
&lt;/h2>&lt;p>本文的演示命令都是在 macOS 上操作的，Azure CLI 在任何 OS 上安装的文档见 &lt;a class="link" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli" target="_blank" rel="noopener"
>Install Azure CLI&lt;/a> 。&lt;/p>
&lt;p>如果你不想在本机安装 Azure CLI 命令行工具，可以使用 Docker 容器的方式，启动一个含有 Azure CLI 的容器，然后在容器内使用 Azure CLI 命令行工具。下面这个参考命令，是在此容器中带入当前路径做为容器内工作目录，并且指定运行特定 Azure CLI 版本的例子：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker run -it --rm -v &lt;span class="k">$(&lt;/span>&lt;span class="nb">pwd&lt;/span>&lt;span class="k">)&lt;/span>:/work -w /work mcr.microsoft.com/azure-cli:2.0.80
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="登录-azure">登录 Azure
&lt;/h2>&lt;p>参考命令如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az login
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>假设你是使用本机安装的 Azure CLI 做 Azure CLI 的命令行登录认证，那么在运行了以上命令后，会弹出一个浏览器窗口，让你输入 Azure 的账号和密码，然后完成登录认证。&lt;/p>
&lt;p>然后，你可以查看当前账号中的订阅；确保随后使用中一个正确的订阅，用于创建 K8S 集群。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az account list -o table
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>为了确保后续的命令行操作使用正确的订阅，可以用下面的命令设定订阅 ID；并且使用命令行变量的方式，设置当前使用的订阅。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az account &lt;span class="nb">set&lt;/span> --subscription &amp;lt;subscription-id&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">SUBSCRIPTION&lt;/span>&lt;span class="o">=&lt;/span>XXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXXXX
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="创建资源组">创建资源组
&lt;/h2>&lt;p>为了让本次操作的过程产物，都放在一个资源组中，我们先创建一个资源组。这样方便在测试完的时候，可以一次性删除所有曾经用到过的资源。&lt;/p>
&lt;p>使用命令行变量设定资源组的名称和所在的区域，以及其他的参数：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">RESOURCE_GROUP_NAME&lt;/span>&lt;span class="o">=&lt;/span>aks-getting-started
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">LOCATION&lt;/span>&lt;span class="o">=&lt;/span>eastasia
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">AKS_CLUSTER_NAME&lt;/span>&lt;span class="o">=&lt;/span>aks-4-devops
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">AKS_CLUSTER_VERSION&lt;/span>&lt;span class="o">=&lt;/span>1.28.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">AKS_NODE_COUNT&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">AKS_NODE_VM_SIZE&lt;/span>&lt;span class="o">=&lt;/span>Standard_B2s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">AKS_NODE_DISK_SIZE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">50&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>创建资源组：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az group create --name &lt;span class="nv">$RESOURCE_GROUP_NAME&lt;/span> --location &lt;span class="nv">$LOCATION&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="创建-service-principal">创建 Service Principal
&lt;/h2>&lt;p>为了让 K8S 可以使用到 Azure 账号中的各种必要的资源服务（disk，负载均衡，存储等等），需要创建一个 Service Principal，用于 K8S 访问 Azure 资源。下面用新的命令行变量携带 Service Principal 的相关信息：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SERVICE_PRINCIPAL_JSON&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>az ad sp create-for-rbac --skip-assignment --name aks-getting-started-sp -o json&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SERVICE_PRINCIPAL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$SERVICE_PRINCIPAL_JSON&lt;/span> &lt;span class="p">|&lt;/span> jq -r &lt;span class="s1">&amp;#39;.appId&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SERVICE_PRINCIPAL_SECRET&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$SERVICE_PRINCIPAL_JSON&lt;/span> &lt;span class="p">|&lt;/span> jq -r &lt;span class="s1">&amp;#39;.password&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">az role assignment create --assignee &lt;span class="nv">$SERVICE_PRINCIPAL&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--scope &lt;span class="s2">&amp;#34;/subscriptions/&lt;/span>&lt;span class="nv">$SUBSCRIPTION&lt;/span>&lt;span class="s2">/resourceGroups/&lt;/span>&lt;span class="nv">$RESOURCE_GROUP_NAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--role Contributor
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>关于 Service Principal 的更多信息，可以参考 &lt;a class="link" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/app-objects-and-service-principals" target="_blank" rel="noopener"
>Azure AD Service Principal&lt;/a> 。&lt;/p>
&lt;h2 id="创建-k8s-集群">创建 K8S 集群
&lt;/h2>&lt;p>可以先使用下面的命令获取创建 aks 集群详细的帮助信息，以及丰富的可用选项；&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az aks create -h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看当前可用区中的 AKS 服务中的 Kubernetes 版本：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az aks get-versions --location &lt;span class="nv">$LOCATION&lt;/span> -o table
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>运行创建 AKS 集群的命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az aks create -n &lt;span class="nv">$AKS_CLUSTER_NAME&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--resource-group &lt;span class="nv">$RESOURCE_GROUP_NAME&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--location &lt;span class="nv">$LOCATION&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--kubernetes-version &lt;span class="nv">$AKS_CLUSTER_VERSION&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--load-balancer-sku standard &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--nodepool-name default &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--node-count &lt;span class="nv">$AKS_NODE_COUNT&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--node-vm-size &lt;span class="nv">$AKS_NODE_VM_SIZE&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--node-osdisk-size &lt;span class="nv">$AKS_NODE_DISK_SIZE&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--network-plugin kubenet &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--service-principal &lt;span class="nv">$SERVICE_PRINCIPAL&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--client-secret &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$SERVICE_PRINCIPAL_SECRET&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="连接到-k8s-集群">连接到 K8S 集群
&lt;/h2>&lt;p>使用下面的命令，获取 AKS 集群的连接信息：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az aks get-credentials --resource-group &lt;span class="nv">$RESOURCE_GROUP_NAME&lt;/span> --name &lt;span class="nv">$AKS_CLUSTER_NAME&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这条命令会将 AKS 集群的连接信息，写入到 &lt;code>~/.kube/config&lt;/code> 文件中，然后你就可以使用 &lt;code>kubectl&lt;/code> 命令行工具，连接到 AKS 集群了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kubectl get nodes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上忽略命令行 kubectl 的安装方式，详见 &lt;a class="link" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener"
>Install and Set Up kubectl&lt;/a> 。&lt;/p>
&lt;h2 id="部署应用">部署应用
&lt;/h2>&lt;p>下面参考 &lt;a class="link" href="https://learn.microsoft.com/zh-cn/azure/aks/learn/quick-kubernetes-deploy-cli" target="_blank" rel="noopener"
>https://learn.microsoft.com/zh-cn/azure/aks/learn/quick-kubernetes-deploy-cli&lt;/a> 文档中的操作步骤，部署
&lt;a class="link" href="https://github.com/Azure-Samples/aks-store-demo" target="_blank" rel="noopener"
>AKS 应用商店应用程序&lt;/a> 。该应用系统的示意图如下：&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/az-cli-create-aks-cluster/aks-store-architecture.webp"
width="1424"
height="525"
srcset="https://martinliu.cn/blog/az-cli-create-aks-cluster/aks-store-architecture_hu_6ab6d2f5cbb87087.webp 480w, https://martinliu.cn/blog/az-cli-create-aks-cluster/aks-store-architecture_hu_2ba8c0a80c5e1ed1.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="271"
data-flex-basis="650px"
>&lt;/p>
&lt;p>创建名为 &lt;a class="link" href="aks-store-quickstart.yaml" >aks-store-quickstart.yaml ，清单文件点此下载&lt;/a> ，并将以下清单复制到其中：&lt;/p>
&lt;p>使用 kubectl apply 命令部署上面的应用：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kubectl apply -f aks-store-quickstart.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用 kubectl get pods 命令，查看应用程序的所有 Pod 都处于 Running 状态：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kubectl get pods
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用下面的命令获取 store-front 服务的外网 IP 地址：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kubectl get service store-front --watch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后，打开 Web 浏览器并转到服务的外网 IP 地址，以查看 Azure 应用商店应用的实际效果。&lt;/p>
&lt;h2 id="清理资源">清理资源
&lt;/h2>&lt;p>使用下面的命令，删除整个测试的资源组、Service Principal 和 AKS 集群，以及当前命令行中 kubctl 的配置文件中的 K8S 集群的上下文。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az aks delete --resource-group &lt;span class="nv">$RESOURCE_GROUP_NAME&lt;/span> --name &lt;span class="nv">$RESOURCE_GROUP_NAME&lt;/span> --yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">az ad sp delete --id aks-getting-started-sp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl config delete-content &lt;span class="nv">$AKS_CLUSTER_NAME&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="总结">总结
&lt;/h2>&lt;p>本文主要讲解了使用 Azure CLI 创建 K8S 集群所使用到的一般性流程和选项，目标是为你更复杂的使用场景打下基础。&lt;/p>
&lt;p>Azure CLI、Terraform 和 Pulumi 都是创建和管理云资源的工具，但它们各有优势：&lt;/p>
&lt;p>Azure CLI：&lt;/p>
&lt;ul>
&lt;li>简单易用：Azure CLI 的命令结构简洁明了，易于理解和使用。&lt;/li>
&lt;li>Azure 专用：Azure CLI 是专为 Azure 设计的，对 Azure 的各种服务和资源有深度集成。&lt;/li>
&lt;/ul>
&lt;p>Terraform：&lt;/p>
&lt;ul>
&lt;li>提供声明式语法：Terraform 使用声明式语法，用户只需描述他们希望达到的最终状态，Terraform 将处理如何达到这个状态。
提供状态管理：Terraform 能够跟踪和管理每个部署的状态，这对于管理复杂的系统非常有用。&lt;/li>
&lt;li>跨平台：Terraform 支持多个云服务提供商，不仅限于 Azure。&lt;/li>
&lt;/ul>
&lt;p>Pulumi：&lt;/p>
&lt;ul>
&lt;li>使用常规编程语言：Pulumi 允许使用常规编程语言（如 Python、JavaScript、TypeScript、Go 等）来描述和管理云资源，这使得开发者可以利用他们已有的编程知识和技能。&lt;/li>
&lt;li>提供状态管理：与 Terraform 类似，Pulumi 也提供状态管理功能。
跨平台：Pulumi 同样支持多个云服务提供商。&lt;/li>
&lt;/ul>
&lt;p>选择哪种工具取决于你的具体需求和偏好。后续我们演示使用 Terraform 和 Pulumi 创建 K8S 集群的方式。&lt;/p>
&lt;h2 id="参考">参考
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://docs.microsoft.com/en-us/azure/aks/kubernetes-walkthrough" target="_blank" rel="noopener"
>Quickstart: Deploy an Azure Kubernetes Service (AKS) cluster using the Azure CLI&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/marcel-dempers/docker-development-youtube-series" target="_blank" rel="noopener"
>https://github.com/marcel-dempers/docker-development-youtube-series&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>可观测性的定义和真实含义是什么？</title><link>https://martinliu.cn/blog/what-is-o11y/</link><pubDate>Tue, 29 Aug 2023 15:04:00 +0800</pubDate><guid>https://martinliu.cn/blog/what-is-o11y/</guid><description>&lt;img src="https://martinliu.cn/blog/what-is-o11y/pexels-joshua-woroniecki-3832684.webp" alt="Featured image of post 可观测性的定义和真实含义是什么？" />&lt;p>“可观测性”英文 observability ，缩写 o11y 。&lt;/p>
&lt;h2 id="常见定义">常见定义
&lt;/h2>&lt;p>最常见的引用来自机械工程领域中关于“控制论”的研究，1960 年鲁道夫·E.卡尔曼首次提出了“可观测性”这个词。&lt;/p>
&lt;p>在控制论中，这个概念涉及：物理机械系统和与之对偶关系的数学模型。然而，这个机械工程师用来研究物理系统的术语，并一定能完全的适用于我们所研究软件应用系统。&lt;/p>
&lt;p>大多数人将“可以根据系统的外部输出信息推断出系统内部状态的好坏（源自于《控制论》）”全盘接受，并套用在了软件行业相关讨论的上下文中。&lt;/p>
&lt;h2 id="常见误解">常见误解
&lt;/h2>&lt;p>降维误读：“可观测性”就是“遥测-telemetry”和“监控-monitor”的同义词。它与监控并没啥区别。就是通常所说的三大支柱（日志、指标和 Trace）。&lt;/p>
&lt;p>厂商的市场宣传：由于市场宣传的需要，目前几乎所有传统做指标、日志和 APM - Trace 的厂商都直接宣称他们都是做可观测性的厂商，提供可观测性产品、解决方案或者 SaaS 服务。常见做法：可观测性是他们扩展出来的，用旧产品改名。&lt;/p>
&lt;p>有些公司会直接的进行概念替换：“我们就是可观测性”。&lt;/p>
&lt;p>以上现实情况，给所有人对可观测性的理解带来了一定的障碍。&lt;/p>
&lt;h2 id="应有的定义">应有的定义
&lt;/h2>&lt;p>在我们排除以上学术上的认祖归宗，以及市场宣传的张冠李戴以后。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/what-is-o11y/o11y-def.webp"
width="1264"
height="557"
srcset="https://martinliu.cn/blog/what-is-o11y/o11y-def_hu_418926a44bd6b454.webp 480w, https://martinliu.cn/blog/what-is-o11y/o11y-def_hu_48b461b0c1bfcc9a.webp 1024w"
loading="lazy"
alt="可观测性定义"
class="gallery-image"
data-flex-grow="226"
data-flex-basis="544px"
>&lt;/p>
&lt;p>我们应该可以给出一个关于可观测性更加严谨的定义：&lt;/p>
&lt;ol>
&lt;li>可观测性是应用系统的一种内在属性，我们可以通过可观测性管理工具将其显性的展现出来，用于探索分析。&lt;/li>
&lt;li>度量能力：无论系统中发生着多么费解的现象，它的度量数据能帮助你更好地理解和解释系统当前的状态。可以解答：系统处于什么状态？&lt;/li>
&lt;li>探索能力：我们能够在各类系统状态数据的所有维度和组合之间进行关联分析，并无需遵循某种预定的调试&amp;amp;排查模式和路径，用于解答：系统中发生了什么变化？为什么会发生这样的变化？&lt;/li>
&lt;li>可按需调整能力：最好是不需要改变原有软件系统的代码，如有需要，也能随心所欲的按需埋点覆盖新的洞察认知。&lt;/li>
&lt;/ol>
&lt;p>以上是关于可观测性定义应该具备的描述信息。适用于我们在对软件系统进行运行和维护的上下文中，这个概念应该具有的含义和外延还有很多。&lt;/p>
&lt;h2 id="为何现在o11y很重要">为何现在o11y很重要？
&lt;/h2>&lt;p>特别是在云原生的运维场景中，传统监控并非唯一的最佳方法；而且，传统的指标和日志监控已经捉襟见肘；产品团队和运维人员始终处于很被动的状态，传统监控数据仅限于让我们了解有限的历史状态，很难推理和预测未知故障。在创建了大量告警规则后，告警事件的数量和信噪比都居高不下，运维值守人员终日忙于关闭噪音事件，很难聚焦在有意义的事件上。&lt;/p>
&lt;h2 id="调试排查应用系统">调试&amp;amp;排查应用系统
&lt;/h2>&lt;p>在生产环境中，调试和排查应用系统的故障和性能问题充满着各种挑战。任意一个人是无法完全的理解复杂的软件系统，大部分人都是习惯于使用分解法思考系统故障；先脑补系统的整体架构，然后怀疑某个系统组件，再考虑组件之间的关联关系。在云原生系统中，我们很难准确的在大脑中勾勒出系统架构的全貌，甚至都不能准确的定位出某个组件（子服务）是运行在什么地方（AZ，Host，Pods）。而且，现代分布式系统所发生的故障，是一系列持续的不同的新问题，发生故障的代码有可能是自己开发的，也很可能是第三方依赖组件&amp;amp;外部服务。人的诊断故障的直觉和经验只能对已知的错误模式有效，传统监控就是面向已知问题的，先假设每一个监控点都是确定的未来的故障点。而使用可观测性进行故障诊断，是面向未知问题的，是用来解释未知问题是如何发生的。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/what-is-o11y/know-unknow.webp"
width="793"
height="715"
srcset="https://martinliu.cn/blog/what-is-o11y/know-unknow_hu_d7ac51710150154.webp 480w, https://martinliu.cn/blog/what-is-o11y/know-unknow_hu_43090a8e6c8ed661.webp 1024w"
loading="lazy"
alt="已知的未知"
class="gallery-image"
data-flex-grow="110"
data-flex-basis="266px"
>&lt;/p>
&lt;p>用可观测数据度量和感知应用系统的状态，以及状态的变化，就需要认识到数据的两个维度“基数”和“维度”。&lt;/p>
&lt;h3 id="基数">基数
&lt;/h3>&lt;p>基数的定义：关注于一条可观测性数据的某个字段，如果每个字段都是一个 Key - value 对，维度指的是这个组合中 value 的唯一性，也就是值的唯一数量。&lt;/p>
&lt;ul>
&lt;li>高基数字段的例子：用户 ID、UUID、购物车 ID、请求 ID、容器 ID、主机名（弹性、不可变架构）、Pod ID等等。&lt;/li>
&lt;li>低基数字段的例子：性别、种族、国家、婚姻状态等等&lt;/li>
&lt;/ul>
&lt;p>基数对于可观测性的作用是：通过聚合采集到的高基数数据集合，得到低基数的分析结果；可观测性管理拥抱高基数数据，也就拥抱更多未知的可能性，因此它具备感知未知故障模式的先天优势。&lt;/p>
&lt;p>而传统监控（日志、指标）数据的基数一般处于一个合理的规模，默认规避高基数，希望用尽可能少的指标分析定位问题，从工具上反映出来的是枚举法；在日常实践中：监控工具的使用者，倾向于关闭大量的认为没什么用的，或者不会出问题的故障采集点。即使是指标全开，日志尽采，而后续的数据分析和洞察手段往往是低效且滞后的，数据后期处理的高价值工作不是没有能力做，就是没有人力和成本做。&lt;/p>
&lt;p>工具厂商（指标、日志、APM）可能会按照所能覆盖到的监控指标的数量，而增加工具使用的费用。&lt;/p>
&lt;h3 id="维度">维度
&lt;/h3>&lt;p>维度的定义：关注于一条可观测性数据的所有字段的数量，如果每个字段都是一个 Key - value 对，维度指的是这个组合中 key 的数量，也就各种 key 键的多寡。&lt;/p>
&lt;p>高维度可观测性数据是一条结构化数据，代表这一次事件，亦或是一个状态，它的“宽度”可以高达上千个键值对（字段），事件越宽所携带的上线文信息就越丰富。高维度数据的作用是用来回答：到底发生了什么？&lt;/p>
&lt;p>用一组可观测性数据，在多个维度上进行排列组合分析，就是剖析现代软件系统中的所有故障模式的可能性。&lt;/p>
&lt;p>最常见维度组合包括：&lt;/p>
&lt;ol>
&lt;li>用户&lt;/li>
&lt;li>代码&lt;/li>
&lt;li>系统-运行环境&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://martinliu.cn/blog/what-is-o11y/3d.webp"
width="957"
height="875"
srcset="https://martinliu.cn/blog/what-is-o11y/3d_hu_31d2dc4403e568be.webp 480w, https://martinliu.cn/blog/what-is-o11y/3d_hu_dda187836acca9fd.webp 1024w"
loading="lazy"
alt="排错维度"
class="gallery-image"
data-flex-grow="109"
data-flex-basis="262px"
>&lt;/p>
&lt;h2 id="使用可观测性调试">使用可观测性调试
&lt;/h2>&lt;p>基于充足的应用系统的可观测性数据，进行开放式的探索数据分析，你就能理解系统所进入的任何状态，而且通过多维度的关联分析，还能知道为什么会形成这个状态。&lt;/p>
&lt;p>可观测性管理工具是鼓励开发人员主动的收集应用运行时可能发生的任何事件，包括携带丰富的上下文，充足的遥测数据是日后探索分析的基础。&lt;/p>
&lt;p>可观测性管理工具平台应该是专门为高基数、高维度的遥测数据而设计的，它鼓励应用系统的所有参与方都参与：主动建立有利于故障调试的可观测性数据的活动中来。包括分工完成下面的各种工作：&lt;/p>
&lt;ul>
&lt;li>开发者在可观测性驱动开发思想的指导下，有意识的在代码中引用埋点框架（如 OpenTelemetry），对代码进行必要&amp;amp;足够的埋点。&lt;/li>
&lt;li>运维人员确保不同语言的应用程序在运行前都携带了自动化埋点的探针（Agent）程序，如果是容器化程序，还可以在打镜像的时候设置这个检查点。确保在任何运行环境（开发、测试、准生产、生产）里APM 或者 RUM 的埋点数据都可以在正确的配置下发送回后台的可观测性管理平台，完成数据的采集。操作系统及以下系统环境的指标和日志是基础工作，是参考数据，这里不赘述。&lt;/li>
&lt;li>测试人员和其他，都有使用可观测性数据的习惯，利用可观测性数据回答：bug 修复了么？性能回顾解决了么？错误率和延迟是否都很低了？&lt;/li>
&lt;li>产品经理和服务交付经理通过可观测性数据整理出每一套应用系统的 SLO 管理报告，指导下个迭代的工作方向，安排 bug 修复和特性交付的优先级，评估生产的运行风险。&lt;/li>
&lt;/ul>
&lt;p>分析调试现代化应用系统的难度包括两个层面：&lt;/p>
&lt;ol>
&lt;li>相对简单：系统的硬件和基础设施、云平台等方面，也就是代码以下的所有。&lt;/li>
&lt;li>相对困难：代码、真实用户的问题，也就是代码本身及以上的所有。&lt;/li>
&lt;/ol>
&lt;h2 id="适用于现代应用系统">适用于现代应用系统
&lt;/h2>&lt;p>现代化应用系统指的是运行在云上的，并经过适配改造的，与云平台的各种服务有很多集成的应用系统。它也可能是一个单体的运行在云主机中的应用，但更多的是容器化、微服务化、分布式的应用系统。前者用传统的监控方法也可以有效管理；后者使用可观测性管理方式更加适合。&lt;/p>
&lt;p>具备可观测性的软件的各种运行状态天然能被理解，我们无须猜测其内部状态，无须提前预判可能的故障模式，无须更新程序代码来暴露盲区。&lt;/p>
&lt;p>现代应用系统的故障模式的特点是：以新的、罕见、没发生过的故障模式为主；通常不可预测；需要使用支持高基数、高维度、可自由探索分析的可观测性管理平台进行配套管理。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/what-is-o11y/what-is-o11y.webp"
width="3774"
height="5622"
srcset="https://martinliu.cn/blog/what-is-o11y/what-is-o11y_hu_169d1e9b61088ffe.webp 480w, https://martinliu.cn/blog/what-is-o11y/what-is-o11y_hu_c772fe1534b1e633.webp 1024w"
loading="lazy"
alt="脑图"
class="gallery-image"
data-flex-grow="67"
data-flex-basis="161px"
>&lt;/p>
&lt;p>点击以上图片查看或者下载高清大图。&lt;/p>
&lt;blockquote>
&lt;p>本文参考《可观测性工程》第一章内容。&lt;/p>&lt;/blockquote>
&lt;p>❤️ Feature Photo by Joshua Woroniecki: &lt;a class="link" href="https://www.pexels.com/photo/person-holding-a-compass-3832684/" target="_blank" rel="noopener"
>https://www.pexels.com/photo/person-holding-a-compass-3832684/&lt;/a>&lt;/p></description></item><item><title>为什么我们不支持 OpenTF？</title><link>https://martinliu.cn/blog/why-we-are-not-supporting-opentf/</link><pubDate>Tue, 29 Aug 2023 09:46:45 +0800</pubDate><guid>https://martinliu.cn/blog/why-we-are-not-supporting-opentf/</guid><description>&lt;img src="https://martinliu.cn/blog/why-we-are-not-supporting-opentf/0_djNEkw3EPJvERiqT.webp" alt="Featured image of post 为什么我们不支持 OpenTF？" />&lt;blockquote>
&lt;p>作者：dragondrop.cloud
来源：&lt;a class="link" href="https://medium.com/@hello_9187/" target="_blank" rel="noopener"
>https://medium.com/@hello_9187/&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h2 id="背景">背景
&lt;/h2>&lt;p>2021年8月10日，HashiCorp 将其之前的“开源”项目的许可证更改为商业源代码许可证（BSL），从而使它们成为未来所有版本的“源代码可用”。我们在这里详细讨论了此变更的原因和动机。&lt;/p>
&lt;p>2021年8月15日，OpenTF 宣言发布。其主要观点是，他们希望HashiCorp将 Terraform 的许可证恢复为真正的开源许可证，否则承诺者联盟将支持由基金会管理的 Terraform 分支。&lt;/p>
&lt;h2 id="我们的看法">我们的看法
&lt;/h2>&lt;p>我们认为 OpenTF 宣言对新许可证的描述方式有失偏颇，有利于那些受到许可证变更影响最大的盈利公司，而如果发生分支，Terraform 生态系统的潜在成本太高。此外，作为受影响方，我们不介意将 Terraform 许可给嵌入到我们自己的解决方案中，因为 HashiCorp 建立和维护的庞大支持生态系统。&lt;/p>
&lt;p>让我们详细分析这个说法*。&lt;/p>
&lt;p>*以下内容不构成法律建议，请咨询熟悉您特定情况的律师。&lt;/p>
&lt;h2 id="许可证偏颇和扭曲的陈述">许可证偏颇和扭曲的陈述
&lt;/h2>&lt;p>&lt;strong>1）&lt;/strong> 在宣言的开头部分“我们的关切：BUSL 许可证是 Terraform 的毒丸”，他们声称：
“&amp;hellip;现在，使用 Terraform 的每家公司、供应商和开发人员都必须考虑他们的行为是否可能被视为与 HashiCorp 的产品竞争。”&lt;/p>
&lt;p>这个说法似乎相当不准确。唯一需要担心许可证变更的公司是那些将“在托管或嵌入的基础上为第三方提供 Licensed Work”的公司，这些行为与 HashiCorp 的产品竞争。&lt;/p>
&lt;p>最初确实有一些关于某些具体问题的合理疑问，即如果 HashiCorp 发布与您先前发布的工具重叠的功能，会发生什么情况？然而，在 HashiCorp 的首席技术官回答了其中一些常见问题后，似乎很明显，这只会影响那些向其他公司销售软件，并且该软件与 HashiCorp 的 Terraform Cloud 和 Terraform Enterprise 产品竞争，或者将 Terraform（源代码或 CLI 二进制文件）托管或嵌入的公司。&lt;/p>
&lt;p>值得注意的是，与 HashiCorp 管理的 Terraform 产品直接竞争的三家最大公司，Spacelift、Env0 和 Scalr，在支持一个 Terraform 分支的多年里，已经做出了数百万美元的承诺（这三家公司之间共有13个全职员工，为期五年）。他们的员工和创始人一直是 OpenTF 宣言的最积极的贡献者和传播者。&lt;/p>
&lt;p>&lt;strong>2）&lt;/strong> 对于一个分支可能带来的好处的引用，这些好处在 2021 年和现在一样成立。
OpenTF 宣言列出了分支的关键原因，包括创建一个“真正的开源”、“社区驱动”、“公正”和“分层和模块化”的 Terraform。这些都是 Terraform 核心的有效关切，实际上是任何拥有的开源项目公司的问题，但是这些与 Terraform 核心仓库的问题并不是新问题。多年来，HashiCorp 社区接受社区提交的速度一直很慢，他们从未在核心中添加某些企业风格的功能（像任何拥有开源工具的公司一样）。&lt;/p>
&lt;p>在过去的大约14天里，唯一的实质性变化是一些公司的利润状况发生了变化。&lt;/p>
&lt;h2 id="分支生态系统潜在的成本非常高">分支生态系统潜在的成本非常高
&lt;/h2>&lt;p>如果发生了分支，Terraform的主干版本可能不会闲置。HashiCorp可能会感到迫切，加强其地位，并在新版本的Terraform和主干云供应商中引入不兼容的差异。在最好的情况下，这可能会导致社区为了采用新的Terraform主要版本而做很多额外的工作，在最坏的情况下，导致主干版本和分支之间的兼容性裂痕。&lt;/p>
&lt;p>这样的裂痕对于工具的应用将是毁灭性的（我应该使用哪个版本的Terraform？有什么区别？算了，我只是去选择一个替代品）以及纯粹支持Terraform的开源项目（我为哪个分支编写？我是否支持两者并增加维护工具所需的工作？）。这还可能导致巨大的重复工作量，需要永久地并行维护镜像库、provider（提供者）和Terraform核心。&lt;/p>
&lt;p>即使在发生分支的情况下，HashiCorp继续照常运营，对整个社区来说，这也像是一个巨大的重复劳动，因为分支的主要受益者只是不同的营利实体及其用户。&lt;/p>
&lt;p>总之，分支对Terraform社区可能非常、非常代价高昂。&lt;/p>
&lt;h2 id="hashicorp支持terraform社区的投入巨大">HashiCorp支持Terraform社区的投入巨大
&lt;/h2>&lt;p>Terraform社区主要是由HashiCorp维护的，与之相关的成本非常高。&lt;/p>
&lt;p>他们每年支持数十亿的提供者下载，免费的模块托管（我们的组织将其作为一个关键的分发机制）以及数十亿的Terraform二进制下载。&lt;/p>
&lt;p>上述成本投入不包括主干云Terraform提供者和Terraform核心本身的维护。不用说，HashiCorp会持续的在社区大量投入，并将继续这样做。&lt;/p>
&lt;h2 id="反论bsl的改变不就是遏制竞争吗">反论：BSL的改变不就是遏制竞争吗？
&lt;/h2>&lt;p>许多Terraform Cloud替代品，特别是Spacelift、Env0、Scalr和Digger，都为Terraform管理开发了创新的工具和功能。与此同时，他们已经从HashiCorp所做的大型生态系统投资中取得了利益。明确地说，这种方法没有错，只要能继续以接近零成本的方式进行，这是一个聪明的商业策略。&lt;/p>
&lt;p>许可证更改至少提高了所有Terraform Cloud/Enterprise竞争对手的运营成本。这些成本很可能以某种形式转嫁给他们自己的客户。这可能是通过更高的定价结构，因为许可费冲击了他们的利润率，或者是某些企业完全放弃了Terraform管理，从而选择较少（这种后续响应当然最能遏制竞争）。&lt;/p>
&lt;p>还有一件事需要记住，那就是HashiCorp也是一家企业，因此期望它们继续亏损，而与此同时，不受维护和运营Terraform社区资产所需的固定成本的约束的竞争对手直接针对它们，是不现实的。虽然这个领域的产品价格几乎肯定会因为生态系统成本更加均匀地被承担而变得更加昂贵，但如果HashiCorp变成一个不存在的实体，那也不是理想情况。&lt;/p>
&lt;h2 id="结论">结论
&lt;/h2>&lt;p>从我们的角度看，Terraform社区主干分叉的潜在成本可能非常高昂，并可能对Terraform的未来造成严重破坏。HashiCorp继续使用BSL对&amp;gt;99%的Terraform用户没有影响；但主要的OpenTF宣言作者有明确的利润动机，并已经从不同的角度呈现了这种情况。&lt;/p>
&lt;p>我们认为Terraform的分支对社区的维护成本，远远超过了少数那几家被改变了营利模式企业的商业价值，并因此我们不支持OpenTF项目。&lt;/p>
&lt;h2 id="背景-1">背景
&lt;/h2>&lt;blockquote>
&lt;p>本文作者所在的公司：如果对我们自己的偏见感到好奇，我们的公司构建了一个嵌入了Terraform CLI的产品，并具有与Terraform Cloud重叠的一些功能，特别是漂移检测，因此受到了BSL更改对Terraform 1.5.5之后版本的影响。dragondrop.cloud的使命是在使用基础设施作为代码时自动化开发者的最佳实践。我们的旗舰开源产品cloud-concierge允许开发者将他们的云计算进行编码，检测漂移，估计云计算成本和安全风险等，更多地通过拉取请求提供结果。对于大规模运行cloud-concierge的企业，我们提供了一个自托管的管理平台。&lt;/p>&lt;/blockquote></description></item><item><title>究竟可观测性能给我们带来什么？</title><link>https://martinliu.cn/blog/what-observability-give-us/</link><pubDate>Tue, 15 Aug 2023 16:17:43 +0800</pubDate><guid>https://martinliu.cn/blog/what-observability-give-us/</guid><description>&lt;img src="https://martinliu.cn/blog/what-observability-give-us/pexels-pixabay-237258.webp" alt="Featured image of post 究竟可观测性能给我们带来什么？" />&lt;p>可观测性并不是空穴来风，也非关键词炒作。大家不妨回顾一下我们所熟知的运维管理的演化历程，抛开运维管理中关于流程和人的那些繁文缛节。让我们只关注于：基础设施和应用架构的变迁，关注于这些层出不穷的技术工具侧面。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/what-observability-give-us/o11y-infographic.webp"
width="840"
height="1858"
srcset="https://martinliu.cn/blog/what-observability-give-us/o11y-infographic_hu_c8cb6fad77771851.webp 480w, https://martinliu.cn/blog/what-observability-give-us/o11y-infographic_hu_7a998b1f70430ada.webp 1024w"
loading="lazy"
alt="可观测性简史"
class="gallery-image"
data-flex-grow="45"
data-flex-basis="108px"
>&lt;/p>
&lt;h2 id="兼容全域信号量">兼容全域信号量
&lt;/h2>&lt;p>从遥测方式的角度看来：任何类型的信号都有各自的用途和道理。武断地选取其一作为可观测性的代名词是一种比较偏激的想法，在Debug生产环境的道路上，我们难以依靠单一方法，一招鲜吃遍天的情况是不可能存在的。我们要根据不同应用系统的特点和服务类型，选择合理的SLI组合，用恰当的信号量来覆盖目标应用系统，目标是打造应用系统本身的可观测性“属性”。这样，你就必须要明智地选择、添加或变化信号类型，要能做到按需求，对症下药。这里不是监控数据源越多越好，盲目的全面覆盖亦是事倍功半的做法；在应对高维度、高基数的运维大数据的场景中，我们很容易走向存储成本飙升的局面，无效杂音数据还能严重稀释有价值的信息点。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/what-observability-give-us/o11y-sig.webp"
width="1002"
height="1102"
srcset="https://martinliu.cn/blog/what-observability-give-us/o11y-sig_hu_783397027cbc52df.webp 480w, https://martinliu.cn/blog/what-observability-give-us/o11y-sig_hu_12a8c0d008dae23.webp 1024w"
loading="lazy"
alt="可观测性信号量类型"
class="gallery-image"
data-flex-grow="90"
data-flex-basis="218px"
>&lt;/p>
&lt;p>所谓全域信号量究竟都有那些：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>日志 Log&lt;/strong>：文本记录系统和应用的活动、事件和错误，提供详细上下文。&lt;/li>
&lt;li>&lt;strong>指标 Metric&lt;/strong>：定量的性能度量，如CPU使用率、请求速率，帮助监控系统状态。&lt;/li>
&lt;li>&lt;strong>分布式追踪 Trace&lt;/strong>：跟踪请求在分布式系统中的路径和性能瓶颈。&lt;/li>
&lt;li>&lt;strong>流数据 Stream&lt;/strong>：实时产生的数据，如用户行为，用于即时监测和分析。&lt;/li>
&lt;li>&lt;strong>用户体验数据 RUM&lt;/strong>：记录用户在应用中的交互、操作和反应，评估体验质量。&lt;/li>
&lt;li>&lt;strong>eBPF&lt;/strong>：扩展 Berkeley Packet Filter，收集内核级别的数据，用于分析和监控。&lt;/li>
&lt;li>&lt;strong>网络性能管理 NPM&lt;/strong>：监测网络带宽、延迟和连接状况，优化网络性能。&lt;/li>
&lt;li>&lt;strong>Profiling&lt;/strong>：分析代码运行时的性能特征，帮助优化应用程序。&lt;/li>
&lt;li>&lt;strong>云服务 Cloud&lt;/strong>：从云提供商获取的监测数据，跟踪资源使用和性能。&lt;/li>
&lt;li>&lt;strong>拨测数据 Uptime/synthetics&lt;/strong>：定期对系统进行外部测试，监测系统在不同地点和条件下的可用性和性能。&lt;/li>
&lt;li>未来新技术：未知类型数据。&lt;/li>
&lt;/ol>
&lt;p>“可观测性管理平台”应当以兼容并蓄全方位的信号量为初始设计目标。这意味着：在观测数据的采集、上传、存储、展示以及关联分析的整个过程中，各类数据都需要能被正确的处理，要能更能合理、有效地进行跨类型的数据关联；在数据下钻的过程中，可以自由地在各种时间线之间跳转和探索。&lt;/p>
&lt;p>当然，监控已知的“未知”是一项基本的管理需求，你应当能使用某一种信号量即可实现。而可观测性更多的是要讨论：对“未知”对象，在“未知”状态间进行变化的管理；这就需要“可观测性平台”能处理多层级、高依赖、多云环境、分布式系统下的高“复杂度”，信号量的全面准备和按需取用往往也只是一个必要条件。&lt;/p>
&lt;p>目前市场上已经有许多运维管理平台都自称为“可观测性”管理平台。但他们中的大多数都是从某个特定监控类型开始，并逐渐扩展覆盖其他更多信号类型的。通常，只有能够涵盖3种以上信号类型的平台，才可能具有出色的实用效果；对于那些已经是有3至5年历史的‘可观测性’产品而言，他们不太可能在短期内实现华丽的转身，也不可能会从头重构一遍自己的产品。&lt;/p>
&lt;h2 id="统一采集和上传工具">统一采集和上传工具
&lt;/h2>&lt;p>在物理机大行其道的时代中，对于一台主机（虚拟机或者物理机）而言，由于它很可能承担着多重角色。而且根据不同团队的管理需求，在其操作系统中会安装多种管理监控代理程序Agent，例如：操作系统指标、日志、数据库、中间件、安全巡检等等；这种叠罗汉的形式不仅给操作系统的资源带来了严重的消耗，甚至还给服务器的管理带来了大量的琐事，例如：数据库监控 Agent 还需要创建专用的用户账号等。为了解决这个问题，很多公司希望使用尽可能少的单一采集代理的模式，例如：BMC 公司的 Patrol 监控产品，拥有多种采集模块 KM（数据库、中间、web 服务器等等），用户可以按需要进行配置，而不需要部署多个采集代理程序。然而，BMC 公司会逐渐收购很多新产品，后来的产品有动态性能基线管理、自动化配置管理等等。从工具厂商的角度看， 他们无法进行快速的产品整合，很难维持单一采集代理的局面。&lt;/p>
&lt;p>在甲方企业的环境中，不同部门会根据自己的需求采购不同的管理工具，部门间的差异导致了工具的重复建设，数据的重复采集，而且数据并不会很轻易的在部门间共享。这样不仅带来了采集工具在同一个主机上的叠加部署，还会导致：独立的运行着大量具有重复数据的孤岛运维数据数据库。这种局面进一步导致了其他问题，例如：同一个主机的同一个故障会在各种工具中都触发多条告警事件；事件风暴来临了。这种混沌的局面，给 AIOps 的工具带来了生存的空间，即使可以产生一些事件收敛和压缩的收益，但这里存在着一个很明显的“治标不治本”的错误。&lt;/p>
&lt;p>时光穿梭到了虚拟化&amp;amp;云原生时代，以上局面并没有发生根本性的改变。反而带来了套娃式深层依赖关系的困境。我们不会把 web、中间件、数据库、消息队列等功能跑在一个 POD 中，但是将其各自独立部署在可横向扩容的子服务（容器服务）中后，这就带来了管理对象的数量呈现指数级飙升的现状。&lt;/p>
&lt;p>容器时代带来了新鲜的监控工具，包括：Prometheus、Grafana、FluntD、Graphite、cAdvisor、Loki、EFK等等。我们可以观察到，新生的工具并不会完全改变：多种采集功能代理并存&amp;amp;叠加的局面。Elastic 看到了部署多种相似代理程序的问题后，最近几年很快的将之前的多种 Beats 程序（多次收购的项目）整合成到了一个统一代理 Elastic Agent中，而这个程序目前还只是多个 Beats 程序的马甲（包装壳）程序。Zabbix 是一个依然长期存在的常见采集代理，我个人推测：在当今容器环境居多的情况下，容器内用云原生监控工具集，容器外依然使用老牌监控工具的组合做法，依然是一个普遍存在的现状。&lt;/p>
&lt;p>多种采集工具集不仅在端点上会造成大量部署和配置的琐事，而且，它们的后台都对应着各自的独立的数据库部署。同一个管理对象在不同的数据库中的字段描述基本上都不同，这导致了：工具集的使用者很难在各类数据库中实现关联分析，用人脑携带着排错的上下文，在一堆控制台之间跳转是相当消耗体力的工作，对齐时间线和监控对象会很快耗尽人的认知上限。CMDB 可能是一个解决方法，而 CMDB 的设计和建设的难度并不亚于构建任何一个监控系统项目本身， 用CMDB解决这个问题的实现难度大，成本高。数据治理也会是一个常见做法，而在这些运维数据库集合之间做 ELT，做数据治理工作，最终实现异类运维信息的归一化的解决方式，也只是一个顺坡下驴的无奈之举，相关实施人员在项目中必将饱尝：将计就计的辛酸。&lt;/p>
&lt;p>貌似最早由 Elastic 推出的统一数据模型（ECS）&lt;a class="link" href="https://www.elastic.co/cn/elasticsearch/common-schema" target="_blank" rel="noopener"
>https://www.elastic.co/cn/elasticsearch/common-schema&lt;/a> 是一个让数据走向标准化定义的可行之道。我们也看到了：OpenTelemetry 项目很快就采纳了 Elastic ECS。CNCF 在随后也推出了相似的观测数据定义模型。我相信 CNCF 一定是看到了，在它的技术蓝图中，可观测性和分析分类中相似&amp;amp;同类工具的快速繁荣。而这些标准也只能让我们望梅止渴，由于目前还没有看到多数厂商、大量开源项目都快速跟随实现和兼容落地的局面。&lt;/p>
&lt;p>观测云的 DataKit 是一款多功能的采集代理程序，它具备解决上述问题的设计，它已经在兼容和对接更广泛的技术生态系统。任何采集代理程序在采集或者对接到了目标数据之后，它其实还需要处理一些列的细节，否则就仍然无法实现“源头治理”，无法避免“garbage in gargage out”的窘境。首先，DataKit 在组织封装数据的时候，所有字段的定义都遵从着一个观测云定义的数据字典（等同于 Elastic ECS ）；其次，上报数据包在封包前，还能做数据的 Pipline 处理，实现了数据字段的丢弃、质量控制、治理和脱敏等问题。最后，DataKit 的采集还可实现对接开源&amp;amp;闭源生态系统，例如接收 DataDog 的 APM 探针数据，对接 OpenTelemetry 的数据等等。它还能实现观测数据在网际、网络间的转发等。&lt;/p>
&lt;h2 id="统一的存储后台">统一的存储后台
&lt;/h2>&lt;p>在构建可观测性平台的过程中，每种类型的信号量都理应得到它最佳的容身之处：&lt;/p>
&lt;ul>
&lt;li>Elasticsearch ：在 Elastic 的 ECS 的加持之下，貌似它是一个很恰当的一库存所有的方案，但前提是你需要能 hold 住性价比。&lt;/li>
&lt;li>时序数据库：不一一列举，适合指标类时序数据。&lt;/li>
&lt;li>列数据库：以 ClickHouse 为代表的实时数据分析的列数据库，可兼容多种信号。&lt;/li>
&lt;li>关系型数据库：WHY NOT。&lt;/li>
&lt;/ul>
&lt;p>从数据入库的角度看，给每种信号量配置其最佳的数据库类型，貌似是一个皆大欢喜的局面。这也不辜负，目前各种开源数据库百花齐放的形势。&lt;/p>
&lt;p>略过上面已经提到的数据孤岛和治理问题不谈。从查询的角度看，用户将不得不学会多种查询语言，前方有 n 种 SQL 语法需要你学习，否则你不得不开发维护一个一对多的查询界面。这里我们暂且不论述：你会如何实现可观测性数据的跨库数据关联分析。&lt;/p>
&lt;p>问题：是否存在一种多模态的统一数据库，将多种类型的信号量数据融入一个统一的数据仓库中？&lt;/p>
&lt;p>实际上，目前的可观测性 SaaS 提供商们，已经给他们的用户提供了这样一种统一融合的数据后端，起码从查询探索可观测性数据的使用体感的角度上，确实是已经做到了。而观测云也正在推出这样一款解决以上统一融合多态并存管理需求的数据库。观测云用户很快将在 SaaS服务中，在私有部署的产品上使用到这种技术。&lt;/p>
&lt;h2 id="自由探索和综合使用数据">自由探索和综合使用数据
&lt;/h2>&lt;p>可观测性数据的价值体现在使用上，能自由的探索和综合的使用各种数据，才能放大数据的价值。在考虑到可观测性数据使用场景的时候，我强烈建议大家运用“第一性原理”来进行思考。这样才能避免对经验的依赖，排除对新可观测性技术能平替所有旧技术的单纯幻想，才能回到可观测性技术的概念本源。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/what-observability-give-us/o11y-define.webp"
width="1358"
height="669"
srcset="https://martinliu.cn/blog/what-observability-give-us/o11y-define_hu_42cd1f6bd0ba3a62.webp 480w, https://martinliu.cn/blog/what-observability-give-us/o11y-define_hu_829ef1cd8fe691cf.webp 1024w"
loading="lazy"
alt="可观测性定义"
class="gallery-image"
data-flex-grow="202"
data-flex-basis="487px"
>&lt;/p>
&lt;p>此处省略 n 百字，仅以上图与读者们一起随时随刻的校准自己对“可观测性”定义的理解。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>本文从四个层面对可观测性平台实现的技术要点，做出了一定深度和时间跨度上的探讨。希望：在您的工作环境中，统一融合的可观测性平台可以很快的落地。穿上两只靴子的你，可以脱离以前赤足上阵，光脚救火的困境。希望可观测性平台能够帮助到软件交付流水线中的所有人，运用可观测性来补Ops的锅，助SRE的威，壮Dev胆。&lt;/p></description></item><item><title>如何在 Azure 中使用 Red Hat 的开发者订阅</title><link>https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/</link><pubDate>Sun, 21 May 2023 10:21:15 +0800</pubDate><guid>https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/</guid><description>&lt;img src="https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/virtual-machine.webp" alt="Featured image of post 如何在 Azure 中使用 Red Hat 的开发者订阅" />&lt;p>如果你是红帽开源软件的个人开发者（用户），你可以通过“红帽开发者计划”实现访问、下载和使用红帽全系列产品的福利。&lt;/p>
&lt;p>红帽开发者会员的好处是可以免费获得广泛的资料库，包括：&lt;/p>
&lt;ul>
&lt;li>所有红帽软件 （含所有产品及时的更新）&lt;/li>
&lt;li>开发者资源 (technical articles, e-books, cheat sheets, and more)&lt;/li>
&lt;li>Interactive tutorials on the latest technology and Red Hat products&lt;/li>
&lt;li>Free in-person and virtual events with Developer experts&lt;/li>
&lt;li>Free Developer Sandbox to build your apps&lt;/li>
&lt;/ul>
&lt;p>会员资格包括访问：&lt;/p>
&lt;ul>
&lt;li>Red Hat 所有和刹那品，包括 Red Hat Enterprise Linux, OpenShift 和 Ansible 等等&lt;/li>
&lt;li>Red Hat Customer Portal 客户门户的访问权限&lt;/li>
&lt;/ul>
&lt;p>重要资源：&lt;/p>
&lt;ul>
&lt;li>开发者计划介绍：&lt;a class="link" href="https://developers.redhat.com/about" target="_blank" rel="noopener"
>https://developers.redhat.com/about&lt;/a>&lt;/li>
&lt;li>无费用的 Red Hat Enterprise Linux 个人开发者订阅的常见问题：&lt;a class="link" href="https://developers.redhat.com/articles/faqs-no-cost-red-hat-enterprise-linux#" target="_blank" rel="noopener"
>https://developers.redhat.com/articles/faqs-no-cost-red-hat-enterprise-linux#&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="red-hat-提供开发者订阅">Red Hat 提供开发者订阅
&lt;/h2>&lt;ul>
&lt;li>Red Hat Enterprise Linux 个人开发者订阅的数量为16个RHEL操作系统实例。&lt;/li>
&lt;li>需要在使用开发者订阅的操作系统上联网激活订阅&lt;/li>
&lt;li>激活的账号和密码与开发者门户的账号相同。&lt;/li>
&lt;li>在 Red Hat 客户门户网站上，你可以管理和续订开发者订阅。&lt;/li>
&lt;/ul>
&lt;p>下图是在客户门户网站上查看当前订阅使用状况的界面。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/red-hat-dev-sub.webp"
width="1133"
height="829"
srcset="https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/red-hat-dev-sub_hu_fa687480d607bb6f.webp 480w, https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/red-hat-dev-sub_hu_f87d79721316f63f.webp 1024w"
loading="lazy"
alt=" Red Hat 客户门户网站"
class="gallery-image"
data-flex-grow="136"
data-flex-basis="328px"
>&lt;/p>
&lt;p>如果你所使用的公有云里有Red Hat官方支持的 RHEL 镜像，你可以将你的开发者订阅使用在公有云的虚拟机上。在Cloud Access这个页面上，可以看到我将微软的Azure账户和红帽开发者订阅做了关联。&lt;/p>
&lt;p>这样就可以实现：有限数量的 Azure 虚拟机可以运行最新版的 RHEL 操作系统，这些操作系统的 License 计费到了 Red Hat 开发者订阅上；而开发者订阅又是有限免费的，因此实现了这些虚拟机的免费使用 RHEL 订阅。由于我在 Azure 中的长运行虚拟机并不多，因此这些虚拟机目前都是使用的 Red Hat Enterprise Linux。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/red-hat-dev-sub-cloud-access.webp"
width="1123"
height="847"
srcset="https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/red-hat-dev-sub-cloud-access_hu_23d447a9020136b5.webp 480w, https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/red-hat-dev-sub-cloud-access_hu_d46ebd7a1ff95545.webp 1024w"
loading="lazy"
alt="Red Hat 客户门户中的 Cloud Access 管理"
class="gallery-image"
data-flex-grow="132"
data-flex-basis="318px"
>&lt;/p>
&lt;h2 id="azure-支持-ahb-的混合权益">Azure 支持 AHB 的混合权益
&lt;/h2>&lt;p>参考这篇 Azure 的官方文档&lt;a class="link" href="https://learn.microsoft.com/zh-cn/azure/virtual-machines/linux/azure-hybrid-benefit-linux?tabs=rhelpayg%2Crhelbyos%2CrhelEnablebyos%2Crhelcompliance" target="_blank" rel="noopener"
>《Red Hat Enterprise Linux (RHEL) 和 SUSE Linux Enterprise Server (SLES) 虚拟机的Azure 混合权益》&lt;/a>&lt;/p>
&lt;p>Azure 提供的 AHB（Azure Hybrid Benefit）使用中携带你自己的订阅到公有云里使用的方式。如下图所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/azure-hybrid-benefit-compare.webp"
width="1228"
height="761"
srcset="https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/azure-hybrid-benefit-compare_hu_ae8ab6ac6fb2f050.webp 480w, https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/azure-hybrid-benefit-compare_hu_b683e1f926558d7.webp 1024w"
loading="lazy"
alt="即用即付”(PAYG) 和“自带订阅”(BYOS)"
class="gallery-image"
data-flex-grow="161"
data-flex-basis="387px"
>&lt;/p>
&lt;p>右侧的这个框的说明了 Azure 虚拟机的成本结构。除了计算资源这部分需要计费意外。如果你在 Azure 中开启了 RHEL 虚拟机实例，默认情况下 RHEL 的许可证费用是有 Azure 代收的，Azure 的账单里包含了这部分。&lt;/p>
&lt;p>对于我在 Azrue 中的长运行虚拟机来说，经过我的配置之后，Azure 的账号和 RedHat 开发者订阅关联在了一起。所以这些 RHEL 虚拟机实例上的 RHEL 许可证费用就是在 RedHat 客户门户账号（来自于红帽开发者计划福利）中计费，最多支持 16 个虚拟机的免费使用。&lt;/p>
&lt;h2 id="如何在-azure-中配置个人公司的-rhel-订阅">如何在 Azure 中配置个人（公司）的 RHEL 订阅
&lt;/h2>&lt;p>如下图所示，在创建 Azure 的虚拟机的时候，选择 Red Hat Enterprise Linux 模板。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/azure-rhel-sub.webp"
width="926"
height="1326"
srcset="https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/azure-rhel-sub_hu_729a1f8e12cd90ce.webp 480w, https://martinliu.cn/blog/use-rhel-dev-sub-in-azure/azure-rhel-sub_hu_a95d806538142f98.webp 1024w"
loading="lazy"
alt="配置 RHEL 订阅授权"
class="gallery-image"
data-flex-grow="69"
data-flex-basis="167px"
>&lt;/p>
&lt;p>在授权这个部分，点击第二个“了解更多信息”链接。这时候，浏览器会跳转到红帽客户门户中，在输入了用户名和密码登录了以后，你就完成了红帽开发者订阅和当前 Azure 账户的关联。&lt;/p>
&lt;p>在虚拟机创建完成以后，你可以用 RHEL 的订阅管理命令将当前的 RHEL Linux 操作系统注册到红帽客户门户的订阅上。参考命令如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">subscription-manager register --org=1234567 --activationkey=DevOps
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&amp;mdash;org ：是你在红帽门户中的组织 ID。&lt;/li>
&lt;li>&amp;ndash;activationkey ： 是自己定义的激活秘钥；一个组织可以定义多个激活秘钥，用户部门和用途的区分。&lt;/li>
&lt;/ul>
&lt;p>这条命令中虽然 ID 是不适合明文暴露的；但是，这样避免了将红帽客户门户账户的用户名和密码都以明文的形式写入配置文件，或者在命令中出现：&lt;code>subscription-manager register --username &amp;lt;username&amp;gt; --password &amp;lt;password&amp;gt; --auto-attach&lt;/code>&lt;/p>
&lt;p>在当前操作系统注册成功以后，你可以在&lt;code>/etc/yum.repos.d&lt;/code>下能找到一个&lt;code>redhat.repo&lt;/code>文件。这个文件里包含了当前操作系统所有能使用的红帽产品的订阅。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@mysql yum.repos.d]# dnf repolist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Updating Subscription Management repositories.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">repo id repo name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">packages-microsoft-com-prod packages-microsoft-com-prod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rhel-8-for-x86_64-appstream-rpms Red Hat Enterprise Linux 8 for x86_64 - AppStream (RPMs)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rhel-8-for-x86_64-baseos-rpms Red Hat Enterprise Linux 8 for x86_64 - BaseOS (RPMs)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>参考这篇文章《&lt;a class="link" href="https://access.redhat.com/solutions/253273%e3%80%8b" target="_blank" rel="noopener"
>https://access.redhat.com/solutions/253273》&lt;/a>》；就可以启用或者禁用所需要的产品。&lt;/p>
&lt;h2 id="在其他环境中的使用">在其他环境中的使用
&lt;/h2>&lt;p>红帽开发者订阅可以让你在客户门户中下载 RHEL 安装 DVD。可以用 DVD 在私有云或者个人电脑（Home Lab）中安装 RHEL 操作系统。&lt;/p>
&lt;p>使用上面相同的方法，既可以实现 RHEL Linux 操作系统的注册，然后完全合理合法的使用全套红帽产品线。&lt;/p>
&lt;p>红帽开发者订阅的有效期是一年；在到期之后，在还需要在客户门户中免费续签。如果当前的开发者订阅过期了，所有 RHEL 操作系统实例就都不能正常更新和安装新的软件包了。在网站上完成了开发者订阅的免费续签之后，所有系统就可以恢复正常使用，无需做其他任何操作。&lt;/p>
&lt;p>开发者订阅的数量是 16 个，更具我最近一年的使用体验看来，这个数量是足够用的。假如你的虚拟机模板激活了订阅，根据这个虚拟机克隆出来的虚拟机是不需要使用注册命令就可以正常更新和安装软件包的。如果订阅数量真的被用完了，可以暂时从红帽客户门户中暂时删除几个不常用的系统，这样就释放出来几个可用的 RHEL 订阅。&lt;/p>
&lt;h2 id="排错">排错
&lt;/h2>&lt;p>新创建的 RHEL 8 的虚拟机，在激活红帽 RHEL 订阅之后，在更新系统软件安装包的时候，报 SSL 证书过期错误，可以参考下面的命令进行解决。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">yum --disablerepo=&amp;#39;*&amp;#39; remove &amp;#39;rhui-azure-rhel8&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget https://rhelimage.blob.core.windows.net/repositories/rhui-microsoft-azure-rhel8.config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yum --config=rhui-microsoft-azure-rhel8.config install rhui-azure-rhel8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yum update ca-certificates
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yum clean all
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>DevOps 在 2023 年的趋势和预测</title><link>https://martinliu.cn/blog/deveops-trands-in-2023/</link><pubDate>Wed, 04 Jan 2023 10:19:53 +0800</pubDate><guid>https://martinliu.cn/blog/deveops-trands-in-2023/</guid><description>&lt;img src="https://martinliu.cn/blog/deveops-trands-in-2023/pexels-samar-mourya-13378403.webp" alt="Featured image of post DevOps 在 2023 年的趋势和预测" />&lt;p>随着技术的发展，与之相关的趋势也在不断变化。DevOps也不例外。现在，企业比以往任何时候，都更加认识到DevOps的价值，及其优化开发和运营的能力。随着我们走过2022年，进入2023年，重要的是要保持领先，了解未来几年推动DevOps的趋势。&lt;/p>
&lt;p>2022年对于DevOps技术来说是令人兴奋的一年，因为企业越来越认识到自动化和协作对于实现业务成功的重要性。采取敏捷的DevOps方法的公司在效率和生产力方面有了相当大的改善。这是由云计算的持续采用和容器化的崛起所做出的支撑。此外，随着 DevOps-as-a-Service（DaaS）解决方案的日益普及，意味着所有规模的组织都能够从DevOps实践中受益，而不需要专门的DevOps团队。&lt;/p>
&lt;p>云原生架构、无服务器计算和容器被广泛的采用，更多的组织将它们作为未来的方向。这使团队能够以敏捷和高效的方式快速部署、扩展和管理应用程序。人工智能/ML工具成为DevOps工具箱中的一部分，使团队能够更快速、高效地提供软件更新和功能，并检测代码中的异常情况，从而更容易在潜在问题变成严重问题之前发现它们。安全性仍然是一个重要的优先事项，企业在最新的技术和最佳实践方面进行了大量投资，以确保他们的系统是安全可靠的。&lt;/p>
&lt;p>同时，DevOps团队也开始专注于改善他们的协作和沟通，使团队能够更快地行动，并对客户的需求和反馈做出更多响应。&lt;/p>
&lt;p>在过去的一年里，我们在DevOps领域看到了很多令人兴奋的发展，但2023年的趋势是什么？让我们来看看今年我们在DevOps领域可以看到的主要趋势。&lt;/p>
&lt;h2 id="kubernetes-的采用和部署的增加">Kubernetes 的采用和部署的增加
&lt;/h2>&lt;p>2022年，Kubernetes的采用显著增加，使其成为事实上的容器编排平台。这是由于它的灵活性和可扩展性，使企业能够在云中快速旋转和拆解应用程序。此外，DevOps的兴起使该平台成为云基础设施的一个关键组成部分。&lt;/p>
&lt;p>Kubernetes的流行因其与云原生堆栈的整合而得到进一步支持。它支持各种应用，包括微服务、无服务器和数据库，使其成为希望利用云的组织的首选。因此，Kubernetes的部署数量在2022年急剧增加。这一趋势预计将持续到2023年，更多的公司将采用Kubernetes作为其云原生解决方案。&lt;/p>
&lt;p>预计Kubernetes将很快主导市场，每个组织都会转向这个平台进行部署。社区的支持水平和该平台令人印象深刻的增长速度没有放缓的迹象，使Kubernetes仍然是满足部署需求的首选。&lt;/p>
&lt;h2 id="无服务器计算将得到广泛的应用">无服务器计算将得到广泛的应用
&lt;/h2>&lt;p>无服务器计算已经成为科技行业的一个主要趋势，预计在2023年将变得更加流行。这种计算方法允许企业在不需要管理服务器的情况下，开发和运行服务和应用程序，使其成为一种高度创新和高效的软件部署方法。据Gartner称，到2025年，超过85%的组织将使用云计算策略，95%的新数字工作负载将在云平台上进行。这意味着，任何不采用无服务器计算的组织都可能难以跟上竞争的脚步。&lt;/p>
&lt;p>预计到2030年，无服务器市场将达到300亿美元。目前，已经有超过50%的基于云计算进程的企业将无服务器计算整合到他们的系统中。DevOps流程尤其受益于这一趋势，因为它有助于缩小开发和运营之间的隔阂，简化DevOps流水线的代码。成功实施无服务器计算的一个例子是 Autodesk，一家专门为建筑、工程、施工和制造设计软件的公司。通过扩大其在AWS的业务范围并实施AWS Dynamodb和AWS Lambda，Autodesk能够将创建账户所需的时间从两周大幅减少到十分钟。&lt;/p>
&lt;p>无服务器计算为工程师提供了许多好处，包括通过消除服务器管理来减少工作量，通过只在需要时支付服务器空间来降低成本，以及在减少延迟的同时轻松扩展和部署。因此，这是一个值得在2023年关注的趋势。&lt;/p>
&lt;h2 id="微服务架构的采用将继续增长">微服务架构的采用将继续增长
&lt;/h2>&lt;p>微服务架构是一种越来越流行的设计、构建和管理应用程序的结构。这种方法有助于DevOps专业人员开发出更加模块化、与其他组件解耦、更易于维护和扩展的应用程序。通过将一个复杂的应用程序分离成更小、更容易管理的服务，DevOps专业人士对应用程序的各个部分有更多的控制。这使得更新和排除错误更加容易。此外，微服务允许DevOps专业人员通过创建新的服务或更新现有服务来快速响应客户需求。&lt;/p>
&lt;p>以提供可扩展性、灵活性和敏捷性的方式开发和部署服务的能力是DevOps专业人士开始接受微服务的主要原因。在一个不断发展的IT环境中，公司需要能够快速、轻松地适应行业的变化。微服务是实现这一目标的好方法，因为它们允许在小的、易于管理的部分中开发和部署服务。因此，DevOps专业人员应该关注微服务在未来几年的持续发展。&lt;/p>
&lt;h2 id="安全自动化将获得发展势头">安全自动化将获得发展势头
&lt;/h2>&lt;p>安全自动化涉及自动化安全流程和任务，以确保应用程序和系统的安全和保护，使其免受潜在威胁。在2023年，DevOps专业人士应密切关注安全自动化的增长和安全即代码方法的采用。&lt;/p>
&lt;p>企业实施安全自动化的一种方式是使用Harness安全测试自动化（STO）等工具，该工具允许在CI/CD管道内进行单元、集成和负载测试的自动化。这可以节省宝贵的工程时间，并降低整体云计算成本。集成到CI/CD流水线中的安全自动化保证了代码在部署到生产之前接受严格的安全测试。这确保了只有被验证为安全的代码才被允许进行。此外，在软件开发生命周期（SDLC）中使用人工智能和机器学习正变得越来越普遍，因为这些技术可以被训练来识别代码中的违规行为并提供改进建议。&lt;/p>
&lt;p>另一方面，安全即代码解决方案将安全测试整合到CI/CD流水线中，使企业能够在整个开发过程中执行安全策略。这有助于确保安全在开发过程的每个阶段都得到考虑，而不是事后才想到。安全自动化和安全即代码解决方案都可以节省宝贵的工程时间，降低整体云计算成本，同时保持高水平的安全性。&lt;/p>
&lt;p>2023年，随着企业寻求简化和自动化其安全流程，安全自动化将获得更大的发展势头。安全自动化工具将变得越来越复杂，具有自动安全测试、漏洞扫描和持续安全监控等功能。这将使企业能够在安全风险成为重大问题之前快速有效地识别和解决这些风险。&lt;/p>
&lt;h2 id="混沌工程实验的增加">混沌工程实验的增加
&lt;/h2>&lt;p>混沌工程是一个相对较新的领域，近年来得到了普及，预计在未来几年将继续增长。&lt;/p>
&lt;p>混沌工程是一种战略方法，涉及到通过将产品、服务和系统置于极端条件下测试其复原力和可靠性。这有助于组织了解其系统和应用在这种条件下的行为，并确保它们能够承受这些条件。混沌工程的目标是识别部署过程中的 &amp;ldquo;不完美&amp;rdquo;，如漫长的周期时间，并防止故障发生。混沌工程师的目标不是要消除故障，而是要减轻故障，具体方法是找出不完善的地方并自动修复。&lt;/p>
&lt;p>我们相信，随着企业认识到确保其产品和服务的高可用性和弹性的重要性，混沌工程和混沌原则的使用将在2023年变得更加广泛。随着混沌工程的采用越来越多，也可能会开发出新的工具和最佳实践，以帮助组织更好地理解和管理其系统的复杂性。&lt;/p>
&lt;h2 id="docker将继续提升开发者的体验">Docker将继续提升开发者的体验
&lt;/h2>&lt;p>Docker是一个深受开发者欢迎的工具，它通过允许开发者在云中快速构建、打包和部署应用程序，简化了开发生命周期。Docker的吸引力在于它的简单性，以及它将容器化应用快速带入生产环境的方式。&lt;/p>
&lt;p>Docker是一个深受开发者欢迎的工具，它通过允许开发者在云中快速构建、打包和部署应用程序，简化了开发生命周期。Docker的吸引力在于它的简单性，以及它将容器化应用快速带入生产环境的方式。&lt;/p>
&lt;p>尽管最初的假设是，当Kubernetes取消支持时，Docker将被淘汰，但事实并非如此。值得注意的是，Docker的设计从一开始就没有考虑到Kubernetes。Docker之所以能够保持其受欢迎程度，是因为有大量的开发者社区在使用它，而且它提供了易用性。&lt;/p>
&lt;p>围绕Docker的社区令人印象深刻，无与伦比，它的广泛采用和强大的社区支持使它成为寻求简化工作流程和提高生产力的开发者的可靠选择。因此，Docker预计在未来几年仍将是DevOps领域的一个关键角色，为更多协作开发工作流程的趋势推波助澜。&lt;/p>
&lt;p>2023年值得关注的一个DevOps趋势是Docker继续增强开发者的体验。该公司已经在开发新的工具和功能，使部署过程更简单、更快、更有效。它的重点是简化操作，同时也提供直观的用户体验。因此，采用Docker的公司可望体验到更大程度的灵活性和可扩展性。&lt;/p>
&lt;h2 id="gitops将获得更多的信任">GitOps将获得更多的信任
&lt;/h2>&lt;p>在GitOps中，开发人员将他们的代码存储在Git仓库中，然后将其部署到Kubernetes集群中。这种方法的好处是，开发人员可以将他们的代码保存在源码控制中，而不必担心管理Kubernetes集群的问题。&lt;/p>
&lt;p>在过去的几年里，GitOps作为一种提高软件交付速度、可靠性和安全性的方法，在DevOps专业人士中获得了巨大的吸引力。在2023年，我们希望看到GitOps在希望改善其软件交付流程的组织中获得更多的信任和采用。&lt;/p>
&lt;p>我们相信GitOps在2023年将继续流行，有几个原因。首先，GitOps使企业能够采用更加声明性的方法来管理其应用程序和基础设施。这意味着，开发人员不必手动配置和部署资源，只需将他们想要的状态提交给Git，剩下的就交给自动化工具处理。这可以帮助减少错误的风险，提高软件交付的速度和可靠性。&lt;/p>
&lt;p>GitOps促进了开发团队内部的协作和透明度。通过使用Git作为真理的中心来源，团队中的每个人都可以看到正在进行的更改和系统的当前状态。这可以帮助减少冲突，改善团队成员之间的沟通。&lt;/p>
&lt;p>GitOps可以帮助企业提高其软件交付过程的安全性。通过使用Git作为唯一的真理源，并使部署过程自动化，企业可以减少未经授权的更改的风险，并确保只有经过批准的更改被部署到生产中。&lt;/p>
&lt;p>随着GitOps继续在DevOps领域获得关注，预计它在未来几年只会继续增长。这是因为它能够简化DevOps流程，使开发者更容易部署他们的代码。因此，GitOps肯定会成为2023年值得关注的领先DevOps趋势之一。具体来说，随着开发者越来越了解GitOps的好处，对GitOps的信任将继续增加。随着越来越多的组织采用GitOps，并成为DevOps流程的标准部分，GitOps将获得更多信任。&lt;/p>
&lt;h2 id="aiops将变得突出">AIOps将变得突出
&lt;/h2>&lt;p>MLOps和AIOps是两个最突出的DevOps工具，预计将成为该行业的主要参与者，到2026年预计价值为409.1亿美元。这些工具对于优化DevOps操作和实现高质量的快速发布至关重要。MLOps有助于加强机器学习的开发系统，而AIOps则使IT流程和操作自动化。&lt;/p>
&lt;p>AIOps是一个强大的工具，可以使复杂的DevOps流程自动化，使团队能够快速检测和解决任何潜在的问题。它还可以提供对DevOps流程性能的洞察力，并在造成任何破坏之前确定任何潜在的问题。AIOps通常被用作DevOps工具链的一部分，实时监控和管理这些系统，为集成工具和DevOps工程师提供自动反馈。AIOps也可用于自动化某些任务，如应用测试和部署，这可以大大减少完成DevOps任务所需的时间和精力。&lt;/p>
&lt;p>2023年，随着企业寻求提高IT效能，减少管理复杂数字系统的人工劳动，预计AIOps将继续流行。&lt;/p>
&lt;h2 id="内部开发者平台将变得更加重要">内部开发者平台将变得更加重要
&lt;/h2>&lt;p>到2022年，颠覆公司构建软件方式的DevOps趋势已经发展成为一种软件交付方式，通过打破孤岛将开发和运营联系起来。&lt;/p>
&lt;p>内部开发者平台是一套专门为企业的开发者设计的工具和服务，通常托管在企业自己的基础设施内。&lt;/p>
&lt;p>内部开发者平台为工程团队提供了一个集中的中心，以进行合作和共享资源。这可以帮助内部开发人员的学习和发展，使他们能够增加技术知识，并使他们能够轻松地与其他工程团队一起进行项目工作。这种平台还可以帮助减少错误，提高代码质量，因为资源共享和审查更容易。在2023年，我们预计会看到企业内部越来越多地采用内部开发者平台的趋势。&lt;/p>
&lt;h2 id="devops协作将成为主流">DevOps协作将成为主流
&lt;/h2>&lt;p>DevOps的理念包括打破软件开发人员和开发运营团队之间的围墙，允许他们在构建、测试和部署软件方面进行协作。随着越来越多的组织追求敏捷开发，他们也在提高开发人员和系统之间的障碍。亚马逊、谷歌和Stripe等组织都依靠DevOps协作来促进速度和创新。&lt;/p>
&lt;p>协作工作正在改变，高管们正在使用新的软件工具来帮助他们监控工作流程。使用Slack、Microsoft Teams、GitHub和Atlassian的工具的DevOps团队对他们的工作流程有更大的可见性。在未来两年，DevOps领导层将继续看到DevOps协作成为主流，新的管理方式将出现。&lt;/p>
&lt;h2 id="低代码平台">低代码平台
&lt;/h2>&lt;p>低代码平台的确是扩展敏捷和DevOps优势的有用工具。它们允许开发人员快速、轻松地构建和部署应用程序，而不需要编写大量的代码。这对于需要快速开发和部署应用程序的组织来说特别有利，因为这可以让他们更有效地应对不断变化的业务需求和市场条件。&lt;/p>
&lt;p>低代码平台也可以很好地适用于想要采用DevOps方法的组织，因为它们可以促进开发人员和IT运营团队之间的合作。通过使用低代码平台，开发人员可以专注于构建和测试应用程序，而IT运营团队可以专注于部署和监控。这些平台通常与所有主要的DevOps工具集成，从而有助于成为管理CI/CD的单一界面。&lt;/p>
&lt;p>总的来说，对于希望采用敏捷和DevOps实践的组织来说，低代码平台可以成为一个有价值的工具，因为它们可以帮助加速开发过程，提高应用程序的质量和可靠性。&lt;/p>
&lt;h2 id="向标准化部署和真正的自动化转变">向标准化部署和真正的自动化转变
&lt;/h2>&lt;p>现在出现了许多端到端的DevOps平台，它们都是以低代码的方式构建的。此外，他们专注于为部署引入标准化；这一直是阻碍团队扩展和控制其部署的主要障碍。使用标准化的CI/CD管道使团队能够重新使用特定的管道来部署性质相似的微服务，只需在需要时调整一些参数。这有助于解决管道臃肿的问题，简化管道管理。&lt;/p>
&lt;p>这些低代码平台还有助于实现真正意义上的自动化，这一直是DevOps的一个关键原则，但由于各团队的工具和工作流程分散，其实施一直是孤立和不统一的。这种趋势在未来可能会继续，重点是通过DevOps平台实现真正的端到端自动化。自动化可以帮助减少构建、测试和部署软件所需的时间和精力，这可以提高效率并加快开发过程。部署后的自动化在帮助检测故障和启动即时回滚以确保更高的应用可用性方面也有很大的作用。&lt;/p>
&lt;h2 id="混合云环境的兴起">混合云环境的兴起
&lt;/h2>&lt;p>许多组织正朝着混合云模式发展，其中一些工作负载在企业内部运行，另一些在云中运行。要求也决定了需要让应用程序在多个云区域运行，并有许多共享资源。这种趋势在未来几年可能会继续下去，DevOps实践将需要适应，不仅要支持混合云的部署，还要支持简化的跨集群监控、备份等。&lt;/p>
&lt;h2 id="基础设施即代码">基础设施即代码
&lt;/h2>&lt;p>基础设施即代码（IAC）将成为DevOps的领先趋势之一。这一趋势有利于通过自动化而不是人工的方式来管理和配置基础设施。这是一个基本的DevOps最佳实践，将持续监控、虚拟化测试和版本控制应用于指导基础设施开发和管理的基础代码。&lt;/p>
&lt;p>基础设施即代码使采用DevOps技术以及基础设施团队和软件开发团队之间更紧密的合作成为可能。当基础设施是代码并被纳入你公司的软件生命周期时，有一个共同的词汇和一套共同的标准，利益相关者已经理解。团队之间的沟通因这种共享的知识而得到促进，这对DevOps至关重要。&lt;/p>
&lt;h2 id="devsecops">DevSecOps
&lt;/h2>&lt;p>DevSecOps是指开发、安全和运营。它是一种软件开发实践，在每个阶段都集成了安全元素，直到开发的解决方案不能成功交付。DevSecOps是从DevOps演变而来的，因此，实施DevSecOps而不是DevOps将在未来获得更大的发展。DevSecOps将安全整合到CI/CD管道中，使开发团队能够以DevOps的速度解决目前最紧迫的一些安全问题。&lt;/p>
&lt;h2 id="sre-网站可靠性工程">SRE (网站可靠性工程)
&lt;/h2>&lt;p>DevOps部署的下一个层次是站点可靠性工程。在DevOps的未来趋势中，似乎采用SRE作为战略，以实现高可用性、可靠性和增强的数字消费者体验。SRE技术对于完成内部服务水平目标和服务水平协议（SLA）（SLO）也是必要的。&lt;/p>
&lt;h2 id="可观测性">可观测性
&lt;/h2>&lt;p>可观察性将是DevOps的关键趋势之一。它提到了协助开发和运营团队记录、收集、关联和分析来自分布式应用的大量性能数据的方法和软件工具，以获得当下的洞察力。&lt;/p>
&lt;h2 id="多云环境">多云环境
&lt;/h2>&lt;p>DevOps和多云环境相辅相成，具有同义关系。他们的结合提供了好处，在提高生产力的同时，也为彼此增加了价值数。尽管如此，DevOps和多云在一起仍然是不寻常的。大多数拥有完善的DevOps管道的企业离将多云安排到位还有一段距离。&lt;/p>
&lt;h2 id="结论">结论
&lt;/h2>&lt;p>随着IT组织实施DevOps计划，他们无疑将面临一些挑战，这些挑战将考验他们在不断的压力下管理变化、跨团队协作和有效工作的能力。大多数IT组织将意识到，有必要让所有利益相关者参与到DevOps中来，包括业务部门，这样他们都能理解正在实施的方法背后的原因。&lt;/p>
&lt;p>2023年，DevOps团队将继续推进他们的采用率，因为他们从企业高管那里得到的支持越来越多。DevOps团队将继续关注自动化，将应用程序迁移到云平台，推出Docker容器，建立容器协调工具，以及将他们的关注点扩展到安全方面。更多的公司将把DevOps嵌入到他们的运营结构中。这一发展将使企业开发、部署和运行应用程序的方式以及支持其团队的方式发生重大变化。除了采用DevOps实践外，企业还将调整数字化实践，从他们开发和部署的软件中获得更大的价值和质量，并管理企业的数字化转型。&lt;/p>
&lt;h2 id="参考">参考
&lt;/h2>&lt;p>本文参考的文章资料如下：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://alltechmagazine.com/devops-trends-to-watch-for-in-2023/" target="_blank" rel="noopener"
>https://alltechmagazine.com/devops-trends-to-watch-for-in-2023/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://ozone.one/top-6-devops-trends-to-look-for-in-2023/" target="_blank" rel="noopener"
>https://ozone.one/top-6-devops-trends-to-look-for-in-2023/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.solutionanalysts.com/blog/top-10-trends-of-devops-in-2023/" target="_blank" rel="noopener"
>https://www.solutionanalysts.com/blog/top-10-trends-of-devops-in-2023/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.analyticsinsight.net/top-10-devops-trends-and-predictions-to-follow-up-in-2023/" target="_blank" rel="noopener"
>https://www.analyticsinsight.net/top-10-devops-trends-and-predictions-to-follow-up-in-2023/&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Elastic Agent 和 Fleet 服务器 安装手册 v8.4</title><link>https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/</link><pubDate>Tue, 18 Oct 2022 21:32:14 +0800</pubDate><guid>https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/</guid><description>&lt;img src="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/observability.webp" alt="Featured image of post Elastic Agent 和 Fleet 服务器 安装手册 v8.4" />&lt;p>测试过程和环境概述：&lt;/p>
&lt;ul>
&lt;li>用一个 RHEL 9 虚拟机安装 Elasticsearch 和 Kibana；然后部署 Fleet 服务器。&lt;/li>
&lt;li>在另外一个虚拟机安装 Elastic Agent，初始化注册到 Fleet 服务器，然后更新对它的管理策略。&lt;/li>
&lt;li>在 Kibana 的可观测性和安全解决方案中观察采集到的数据。&lt;/li>
&lt;/ul>
&lt;h2 id="安装-elasticsearch">安装 Elasticsearch
&lt;/h2>&lt;p>下载 Elasticsearch 的 rpm 安装包，用 rpm 的方式安装 Elasticssearch 服务器。 &lt;code>dnf install elasticsearch-8.4.3-x86_64.rpm &lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># dnf install elasticsearch-8.4.3-x86_64.rpm &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Updating Subscription Management repositories.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Red Hat Enterprise Linux &lt;span class="m">9&lt;/span> &lt;span class="k">for&lt;/span> x86_64 - BaseOS &lt;span class="o">(&lt;/span>RPMs&lt;span class="o">)&lt;/span> 3.9 kB/s &lt;span class="p">|&lt;/span> 4.1 kB 00:01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Red Hat Enterprise Linux &lt;span class="m">9&lt;/span> &lt;span class="k">for&lt;/span> x86_64 - AppStream &lt;span class="o">(&lt;/span>RPMs&lt;span class="o">)&lt;/span> 3.9 kB/s &lt;span class="p">|&lt;/span> 4.1 kB 00:01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dependencies resolved.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=============================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Package Architecture Version Repository &lt;span class="nv">Size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=============================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installing:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elasticsearch x86_64 8.4.3-1 @commandline &lt;span class="m">540&lt;/span> M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transaction &lt;span class="nv">Summary&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=============================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Install &lt;span class="m">1&lt;/span> Package
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total size: &lt;span class="m">540&lt;/span> M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed size: 1.1 G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Is this ok &lt;span class="o">[&lt;/span>y/N&lt;span class="o">]&lt;/span>: y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Downloading Packages:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running transaction check
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transaction check succeeded.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running transaction &lt;span class="nb">test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transaction &lt;span class="nb">test&lt;/span> succeeded.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running transaction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Preparing : 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Running scriptlet: elasticsearch-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Creating elasticsearch group... OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Creating elasticsearch user... OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Installing : elasticsearch-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Running scriptlet: elasticsearch-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------- Security autoconfiguration information ------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Authentication and authorization are enabled.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TLS &lt;span class="k">for&lt;/span> the transport and HTTP layers is enabled and configured.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The generated password &lt;span class="k">for&lt;/span> the elastic built-in superuser is : guJrLagKN5bsmUh72bha
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">If this node should join an existing cluster, you can reconfigure this with
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;/usr/share/elasticsearch/bin/elasticsearch-reconfigure-node --enrollment-token &amp;lt;token-here&amp;gt;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">after creating an enrollment token on your existing cluster.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You can &lt;span class="nb">complete&lt;/span> the following actions at any time:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Reset the password of the elastic built-in superuser with
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;/usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic&amp;#39;&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generate an enrollment token &lt;span class="k">for&lt;/span> Kibana instances with
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;/usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana&amp;#39;&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generate an enrollment token &lt;span class="k">for&lt;/span> Elasticsearch nodes with
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;/usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s node&amp;#39;&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### NOT starting on installation, please execute the following statements to configure elasticsearch service to start automatically using systemd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo systemctl &lt;span class="nb">enable&lt;/span> elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### You can start elasticsearch service by executing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo systemctl start elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/lib/tmpfiles.d/elasticsearch.conf:1: Line references path below legacy directory /var/run/, updating /var/run/elasticsearch → /run/elasticsearch&lt;span class="p">;&lt;/span> please update the tmpfiles.d/ drop-in file accordingly.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Verifying : elasticsearch-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed products updated.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elasticsearch-8.4.3-1.x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Complete!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装完毕之后，用 vi 编辑器打开 &lt;code>/etc/elasticsearch/elasticsearch.yml&lt;/code> 配置文件 ； 在这个默认配置文件中寻找类似这样的一行 &lt;code>cluster.initial_master_nodes: [&amp;quot;elk8&amp;quot;]&lt;/code> ；将这一行注释掉。&lt;/p>
&lt;p>然后在此配置文件的最下面增加下面这几行。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">cluster.name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">homelab-elk8&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">discovery.type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">single-node&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">network.host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.authc.api_key.enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>启动 Elasticsearch 服务，并查看服务的状态。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status elasticsearch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在使用 ES 前，可以先修改ES服务初始化的内建用户密码，改成自己好记的安全可控密码。否则需要到 ES 的启动日志里寻找系统自动生产的管理员密码。&lt;/p>
&lt;p>运行 &lt;code>/usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic -i&lt;/code> 命令修改 ES 的管理员账号 elastic 的密码。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic -i&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">This tool will reset the password of the &lt;span class="o">[&lt;/span>elastic&lt;span class="o">]&lt;/span> user.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You will be prompted to enter the password.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Please confirm that you would like to &lt;span class="k">continue&lt;/span> &lt;span class="o">[&lt;/span>y/N&lt;span class="o">]&lt;/span>y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter password &lt;span class="k">for&lt;/span> &lt;span class="o">[&lt;/span>elastic&lt;span class="o">]&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Re-enter password &lt;span class="k">for&lt;/span> &lt;span class="o">[&lt;/span>elastic&lt;span class="o">]&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password &lt;span class="k">for&lt;/span> the &lt;span class="o">[&lt;/span>elastic&lt;span class="o">]&lt;/span> user successfully reset.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在启动 ES 服务前，打开后续测试所需要的防火墙端口。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">firewall-cmd --permanent --add-port&lt;span class="o">=&lt;/span>9200/tcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --permanent --add-port&lt;span class="o">=&lt;/span>5601/tcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --permanent --add-port&lt;span class="o">=&lt;/span>8220/tcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在浏览器里访问 es 的访问网址 https://10.0.30.105:9200/ ，忽略关于证书的安全提示，输入上面所修改的 elastic 账户信息，测试是否可以正常登录。&lt;/p>
&lt;h2 id="安装-kibana">安装 Kibana
&lt;/h2>&lt;p>下载 Kibana 的 rpm 安装包到服务器，然后执行下面的安装命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># dnf install kibana-8.4.3-x86_64.rpm &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Updating Subscription Management repositories.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Last metadata expiration check: 0:22:56 ago on Sun &lt;span class="m">16&lt;/span> Oct &lt;span class="m">2022&lt;/span> 02:20:20 PM CST.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dependencies resolved.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=======================================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Package Architecture Version Repository &lt;span class="nv">Size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=======================================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installing:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kibana x86_64 8.4.3-1 @commandline &lt;span class="m">274&lt;/span> M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transaction &lt;span class="nv">Summary&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=======================================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Install &lt;span class="m">1&lt;/span> Package
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total size: &lt;span class="m">274&lt;/span> M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed size: &lt;span class="m">649&lt;/span> M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Is this ok &lt;span class="o">[&lt;/span>y/N&lt;span class="o">]&lt;/span>: y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Downloading Packages:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running transaction check
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transaction check succeeded.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running transaction &lt;span class="nb">test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transaction &lt;span class="nb">test&lt;/span> succeeded.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running transaction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Preparing : 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Running scriptlet: kibana-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Installing : kibana-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Running scriptlet: kibana-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Creating kibana group... OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Creating kibana user... OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Created Kibana keystore in /etc/kibana/kibana.keystore
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/lib/tmpfiles.d/elasticsearch.conf:1: Line references path below legacy directory /var/run/, updating /var/run/elasticsearch → /run/elasticsearch&lt;span class="p">;&lt;/span> please update the tmpfiles.d/ drop-in file accordingly.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Verifying : kibana-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed products updated.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kibana-8.4.3-1.x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Complete!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在启动 Kiban 服务器之前，先需要创建 Kibana 需要的各种加密 key ，执行下面的命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">/usr/share/kibana/bin/kibana-encryption-keys generate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.encryptedSavedObjects.encryptionKey: 2e71f1b16031c2b111b76276268dbf9e
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.reporting.encryptionKey: 84cb58b5e944fa9f65f73382384612a5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.encryptionKey: c5ac5b306ee011838a67e2eaf4154dd0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>记录以上三行配置参数，并增加2行新参数，将它们全部添加到 Kibana 默认的配置文件中。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">server.host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server.publicBaseUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;http://10.0.30.105:5601&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.encryptedSavedObjects.encryptionKey&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">2e71f1b16031c2b111b76276268dbf9e&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.reporting.encryptionKey&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">84cb58b5e944fa9f65f73382384612a5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.encryptionKey&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">c5ac5b306ee011838a67e2eaf4154dd0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>用 vi 打开 Kibana 的默认配置文件 &lt;code>/etc/kibana/kibana.yml&lt;/code> ，将上面的 5 行配置参数添加到文件中。&lt;/p>
&lt;p>在命令行执行 &lt;code>systemctl enable --now kibana&lt;/code> 命令启动 Kibana 服务器.&lt;/p>
&lt;p>然后执行命令 &lt;code>tail -f /var/log/messages&lt;/code> ， 在日志中寻找 Kibana 服务启动的信息，等待出现 Kibana 配置的访问 URL。在日志中寻找类似这样的信息：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="err">Oct&lt;/span> &lt;span class="mi">18&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">36&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">48&lt;/span> &lt;span class="err">elk&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="err">kibana&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2163&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="err">i&lt;/span> &lt;span class="err">Kibana&lt;/span> &lt;span class="err">has&lt;/span> &lt;span class="err">not&lt;/span> &lt;span class="err">been&lt;/span> &lt;span class="err">configured.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">Oct&lt;/span> &lt;span class="mi">18&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">36&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">48&lt;/span> &lt;span class="err">elk&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="err">kibana&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2163&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="err">Go&lt;/span> &lt;span class="err">to&lt;/span> &lt;span class="err">http:&lt;/span>&lt;span class="c1">//0.0.0.0:5601/?code=732948 to get started.
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将 0.0.0.0 替换为这台虚拟机的 IP 地址，然后在浏览器中打开这个类似这个 &lt;code>http://10.0.30.105:5601/?code=732948&lt;/code> 网址。网页中会出现一个大输入框，等待输入Kibana 注册秘钥。&lt;/p>
&lt;p>在命令行执行 &lt;code>/usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana&lt;/code> 命令，从而获取 Kibana 的注册令牌。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">eyJ2ZXIiOiI4LjQuMyIsImFkciI6WyIxOTIuMTY4LjEwLjEwOjkyMDAiXSwiZmdyIjoiZTdlOTdlZWU2YWVlYjVmYTczZWM1YTVkNzBiNDJkZGUzZjlkZmNjMDJhNTVmZDcwZjAxOTQwZmExNzE5YWM2MSIsImtleSI6IjNHLVEzNE1CYnA4c3p4TEZEZXpCOk0wUDMzRC1VVFAyT0ZxQVFBekNKSWcifQ&lt;/span>&lt;span class="o">==&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将这个 Token 复制到网页里，完成Kibana 的初始化配置，最后用 es 的管理员账号登录 Kibana。&lt;/p>
&lt;p>从 kiban 目录中找到 es 的根 ca 证书，将其安装在系统的默认根证书目录中。查看 Kibana 的配置文件找到类似这样的一行配置信息。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">elasticsearch.ssl.certificateAuthorities: &lt;span class="o">[&lt;/span>/var/lib/kibana/ca_1666060779947.crt&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>运行下面的命令安装这个根证书。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">update-ca-trust &lt;span class="nb">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp /var/lib/kibana/ca_1666060779947.crt /etc/pki/ca-trust/source/anchors/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">update-ca-trust extract
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>建议将这个根证书也用这个方法复制到其他需要用 Elastic Agent 采集监控数据的操作系统中，并安装备用。也可以在 Elastic Agent 安装的时候指定忽略 ES 证书校验的参数。&lt;/p>
&lt;h2 id="安装-fleet-服务器">安装 Fleet 服务器
&lt;/h2>&lt;p>在 Kibana 的菜单中找到， Fleet 选项，点击 Settings，然后点击 Edit Hosts ，选择增加 Fleet server 配置信息，输入 &lt;code>https://10.0.30.105:8220&lt;/code> ，注意这里必须是 https协议。&lt;/p>
&lt;p>回到 Fleet 主页，找到 agent 管理的地方，按照流程做，点击创建 Fleet Server 配置。然后就会在页面上生成 Fleet 服务器的安装配置命令。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_10-46-39.webp"
width="1280"
height="1090"
srcset="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_10-46-39_hu_353c859e47b50488.webp 480w, https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_10-46-39_hu_d3a71f9e9ac28864.webp 1024w"
loading="lazy"
alt="Fleet server"
class="gallery-image"
data-flex-grow="117"
data-flex-basis="281px"
>&lt;/p>
&lt;p>按着提示的命令参数安装 Fleet 服务器。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar xzvf elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> elastic-agent-8.4.3-linux-x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ./elastic-agent install &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --fleet-server-es&lt;span class="o">=&lt;/span>https://192.168.10.10:9200 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --fleet-server-service-token&lt;span class="o">=&lt;/span>AAEAAWVsYXN0aWMvZmxlZXQtc2VydmVyL3Rva2VuLTE2NjU5MTM3ODg1NTA6aWdrR1pvNk9SWmk5N09tV3pUQktTUQ &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --fleet-server-policy&lt;span class="o">=&lt;/span>fleet-server-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --insecure
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面是连续四条安装命令，需要在最后一条命中，增加一个参数 &lt;code>--insecure&lt;/code> ；这样可以确保 Fleet 服务器的正常配置。&lt;/p>
&lt;p>在 Fleet 服务器正常启动以后，上面创建 Fleet 服务器配置的网页上的最后一步就会显示：Fleet 服务器已经连接正常，等待注册 Elastic Agent 。这样表明 Fleet 服务器已经安装正常，并且运行在默认的代理配置采集策略下。&lt;/p>
&lt;p>可以在 Kibana 的界面里查看 Fleet 服务器的监控信息。点击 Kibana 左上角的菜单：Observability -&amp;gt; Infrastructure -&amp;gt; Inventory ，即可看到 Fleet 服务器的监控数据。&lt;/p>
&lt;h2 id="安装-elastic-agent-监控代理">安装 Elastic Agent 监控代理
&lt;/h2>&lt;p>在 Fleet 的管理界面中新增一个名为 my-policy1 的管理策略，避免和 Fleet 服务器使用相同的策略。点击 Add agent 连接，获取如下代理注册命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar xzvf elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> elastic-agent-8.4.3-linux-x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ./elastic-agent install --url&lt;span class="o">=&lt;/span>https://10.0.30.105:8220 --enrollment-token&lt;span class="o">=&lt;/span>&lt;span class="nv">NW9ZTjZZTUJtUENhc0ZFTDI5SV86MkZQT1hlc2dUOEdWZnRrWWhNbXVjdw&lt;/span>&lt;span class="o">==&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将上面的命令复制到一个写字板中，修改最后一条命令，在最后增加&lt;code>--insecure&lt;/code> 参数&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">./elastic-agent install --url&lt;span class="o">=&lt;/span>https://10.0.30.105:8220 --enrollment-token&lt;span class="o">=&lt;/span>&lt;span class="nv">NW9ZTjZZTUJtUENhc0ZFTDI5SV86MkZQT1hlc2dUOEdWZnRrWWhNbXVjdw&lt;/span>&lt;span class="o">==&lt;/span> --insecure
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>通过执行上面的命令，我们就在被管理服务器上，一键式的安装了用于数据采集功能的 Elastic Agent ，并将其注册到 Fleet 服务器上。你也可以手工下载好 &lt;code>elastic-agent-8.4.3-linux-x86_64.tar.gz &lt;/code> 文件，但是反复在多个被管理服务器上复制也很麻烦。&lt;/p>
&lt;h2 id="搭建本地安装包下载服务器">搭建本地安装包下载服务器
&lt;/h2>&lt;p>为了让局域网中的操作系统能就近下载 Elastic Stack 技术栈中，所有可以通过 Fleet 服务器管理（安装、配置、升级、删除等）的组件，我们可以参考文档的方法：https://www.elastic.co/guide/en/fleet/8.4/air-gapped.html#host-artifact-registry 在本地部署一个安装包下载服务器。&lt;/p>
&lt;p>首先，安装一个 Nginx 服务器，在根目录下创建目录 downloads ，并且运行下面的下载脚本。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/apm-server/apm-server-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/apm-server/apm-server-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/apm-server/apm-server-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/auditbeat/auditbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/auditbeat/auditbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/auditbeat/auditbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/heartbeat/heartbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/heartbeat/heartbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/heartbeat/heartbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/osquerybeat/osquerybeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/osquerybeat/osquerybeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/osquerybeat/osquerybeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/packetbeat/packetbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/packetbeat/packetbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/packetbeat/packetbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/cloudbeat/cloudbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/cloudbeat/cloudbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/cloudbeat/cloudbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/endpoint-dev/endpoint-security-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/endpoint-dev/endpoint-security-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/endpoint-dev/endpoint-security-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/fleet-server/fleet-server-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/fleet-server/fleet-server-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/fleet-server/fleet-server-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将下载后的目录结构整理的和下载路径一致，目录结构如下所示：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 html&lt;span class="o">]&lt;/span>&lt;span class="c1"># tree downloads/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">downloads/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── apm-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── apm-server-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── apm-server-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── apm-server-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── beats
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── auditbeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── auditbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── auditbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── auditbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── elastic-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── elastic-agent-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── elastic-agent-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── filebeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── filebeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── filebeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── filebeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── heartbeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── heartbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── heartbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── heartbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── metricbeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── metricbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── metricbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── metricbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── osquerybeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── osquerybeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── osquerybeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── osquerybeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── packetbeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── packetbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── packetbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── packetbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── cloudbeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── cloudbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── cloudbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── cloudbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── endpoint-dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── endpoint-security-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── endpoint-security-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── endpoint-security-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── fleet-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── fleet-server-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── fleet-server-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── fleet-server-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── pull-bin.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">12&lt;/span> directories, &lt;span class="m">34&lt;/span> files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 html&lt;span class="o">]&lt;/span>&lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>为了方便查看这个目录的内容，修改 nginx 的默认配置文件，在 http 这个部分增加下面三个参数：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">autoindex on; &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">autoindex_exact_size off;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">autoindex_localtime on; &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>重启 Nginix 服务器后，在浏览器中可以访问： http://192.168.10.10/downloads/ ，确保可以看到正确的目录结构和文件。&lt;/p>
&lt;p>进入 Fleet 的配置页面，在 &lt;code>Agent Binary Download&lt;/code> 下面点击 “Add agent binary source” ，新建一个新的代理安装包下载来源网站。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_14-21-44.webp"
width="1920"
height="1436"
srcset="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_14-21-44_hu_81f6549ac98b5cf0.webp 480w, https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_14-21-44_hu_5513f1e8fc13f2ca.webp 1024w"
loading="lazy"
alt="Agent Binary Download"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
>&lt;/p>
&lt;p>在 Agent Policies 页面新建一个新的测试用 Agent 管理策略，名为 “my-policy2”；进入这个策略的配置界面，修改 &lt;em>Agent Binary Download&lt;/em> 为刚才创建的下载源。保存并测试这个策略。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_14-25-35.webp"
width="1920"
height="1860"
srcset="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_14-25-35_hu_1ee19fedc7a1e756.webp 480w, https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_14-25-35_hu_e38bd9d16b2624f.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="103"
data-flex-basis="247px"
>&lt;/p>
&lt;p>点击 “Add agent” 连接，获取下面的新注册代理注册命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz tar xzvf elastic-agent-8.4.3-linux-x86_64.tar.gz &lt;span class="nb">cd&lt;/span> elastic-agent-8.4.3-linux-x86_64 sudo ./elastic-agent install --url&lt;span class="o">=&lt;/span>https://10.0.30.105:8220 --enrollment-token&lt;span class="o">=&lt;/span>&lt;span class="nv">R29qRDZZTUJtUENhc0ZFTFNDSW06bVFOeW5vcUpTQmFmZDBwLUgyTDBYZw&lt;/span>&lt;span class="o">==&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改这些命令参数，如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">curl -L -O http://192.168.10.10/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar xzvf elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> elastic-agent-8.4.3-linux-x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ./elastic-agent install --url&lt;span class="o">=&lt;/span>https://10.0.30.105:8220 --enrollment-token&lt;span class="o">=&lt;/span>&lt;span class="nv">R29qRDZZTUJtUENhc0ZFTFNDSW06bVFOeW5vcUpTQmFmZDBwLUgyTDBYZw&lt;/span>&lt;span class="o">==&lt;/span> --insecure
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>SSH 登录到另外一个虚拟机，用新创建的 Agent 管理策略，一键式安装 Elastic Agent 并注册到 Fleet 服务器。由于这个策略使用了本地的安装包（默认会使用到 Filebeat 和 Metricbeat），所以它的部署速度应该会比较快。&lt;/p>
&lt;p>在 Elastic Agent 的日志文件中应该可以看到类似这样的信息。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">cat /opt/Elastic/Agent/elastic-agent-20221018.ndjson
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">```&lt;/span>json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;log.level&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;info&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;@timestamp&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;2022-10-18T14:37:26.697+0800&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;log.origin&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;file.name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;artifact/config.go&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;file.line&amp;#34;&lt;/span>:138&lt;span class="o">}&lt;/span>,&lt;span class="s2">&amp;#34;message&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Source URI changed from \&amp;#34;https://artifacts.elastic.co/downloads/\&amp;#34; to \&amp;#34;http://192.168.10.10/downloads/\&amp;#34;&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;ecs.version&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;1.6.0&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个信息表示：当前的 Agent 会使用上面自建的安装包下载源服务器。&lt;/p>
&lt;p>用这个命令 &lt;code>elastic-agent inspect&lt;/code> 也可以确认这个配置。&lt;/p>
&lt;h2 id="万用采集端的好处">万用采集端的好处
&lt;/h2>&lt;p>在上一篇文章中已经说过了这个问题，这里不赘述。&lt;/p>
&lt;p>为了验证这个功能，可以尝试更新当前的一个 policy，增加 Packetbeat 数据采集能力。操作步骤如下：&lt;/p>
&lt;ol>
&lt;li>打开当前的一个正在使用中 policy&lt;/li>
&lt;li>点击 Add intergation 按钮，在众多选项中选择 Network Packet Capture 模块。&lt;/li>
&lt;li>增加新的采集模块后，保存这个策略。&lt;/li>
&lt;li>它更新了版本，观察 Fleet 界面上所有使用这个策略的节点的状态变化。&lt;/li>
&lt;li>这些节点会自动的，很快的更新到新的管理策略中，Elastic Agent 会自动化安装 Packetbeat 采集模块。&lt;/li>
&lt;li>返回 Kiban ，进入安全管理解决方案，我们可以看到 Filebeat 和 Packetbeat 的采集结果。&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_22-49-08.webp"
width="1920"
height="817"
srcset="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_22-49-08_hu_9315233f52a0deb3.webp 480w, https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_22-49-08_hu_6f705180b238a5b3.webp 1024w"
loading="lazy"
alt="添加 Packetbeat 模块"
class="gallery-image"
data-flex-grow="235"
data-flex-basis="564px"
>&lt;/p>
&lt;p>在策略更新了以后，我们没有在 Elastic Agent 端做任何操作，它就已经自动化的下载新的策略，并更新了自身。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_22-53-55.webp"
width="1920"
height="1675"
srcset="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_22-53-55_hu_e565716a7037207b.webp 480w, https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_22-53-55_hu_77b42a837a097172.webp 1024w"
loading="lazy"
alt="查看 安全管理解决方案"
class="gallery-image"
data-flex-grow="114"
data-flex-basis="275px"
>&lt;/p>
&lt;h2 id="常见问题">常见问题
&lt;/h2>&lt;p>Elastic Agent 在采集数据的服务上安装正常，在 Fleet 服务器的管理界面中也可以看到其状态正常。但是在可观测性的页面中看不到它的任何数据。&lt;/p>
&lt;p>可能的原因：Elastic Agent 采集端程序和 ES 后台服务器的通讯不正常，检查 9200 端口，用 curl + ES 服务器端的数字证书，用户名和密码，尝试访问 ES 的服务地址 &lt;code>https://192.168.10.10:9200&lt;/code>。&lt;/p>
&lt;p>也可以尝试在 Fleet 的管理页面上删除这个 Agent；然后在被管理服务器上，用命令 &lt;code>elastic-agent uninstall&lt;/code> 删除服务，然后重新安装注册这个被管理服务器，注意在注册命令的最后面可以尝试增加这两个参数：&lt;code> --insecure --fleet-server-es-insecure&lt;/code> 第一个参数是忽略 Fleet 服务器的 ssl 证书校验，第二个参数是忽略 es 服务器的 ssl 证书校验。或者尝试重新手工安装一遍 es 服务器上的 ca 根证书。&lt;/p>
&lt;p>Feature picture ❤️ Brett Sayles图片: &lt;a class="link" href="https://www.pexels.com/zh-cn/photo/2881224/" target="_blank" rel="noopener"
>https://www.pexels.com/zh-cn/photo/2881224/&lt;/a>&lt;/p></description></item><item><title>面向未来的 Elastic Stack 数据摄入架构</title><link>https://martinliu.cn/blog/fleet-and-elastic-agent/</link><pubDate>Mon, 17 Oct 2022 21:09:52 +0800</pubDate><guid>https://martinliu.cn/blog/fleet-and-elastic-agent/</guid><description>&lt;img src="https://martinliu.cn/blog/fleet-and-elastic-agent/pexels-analogicus-5516029.webp" alt="Featured image of post 面向未来的 Elastic Stack 数据摄入架构" />&lt;h2 id="数据摄入的痛点">数据摄入的痛点
&lt;/h2>&lt;p>安装、升级和维护各种数据采集工具，包括 Filebeat、Metricbeat、APM 埋点、Logstash数据重整转发、端点安全控制，还有很多很多其它功能选项，貌似每增加一丁点功能，以前的数据采集项目又要重新再来一遍。&lt;/p>
&lt;p>采集管理的配置文件不光只是 YAML 文件，越写越长的 YAML 文件渐渐将你带入了十八层地狱。&lt;/p>
&lt;p>在每个端点上启用和配置不同采集模块行为参数，很多情况下，你不得不在大量采集点的命令行里执行配置命令。&lt;/p>
&lt;p>不同采集模块在采集节点上都需要创建新的用户，不仅复杂化了操作系统用户的管理，还可能引入更多的风险。&lt;/p>
&lt;p>自动化配置管理工具可以批量分发和部署这些数据摄入配置文件，但是你又不得不为此学习另外一种新的武功。&lt;/p>
&lt;h2 id="优化的方向">优化的方向
&lt;/h2>&lt;h3 id="简化采集端部署">简化采集端部署
&lt;/h3>&lt;p>下面是 Elastic Agent 所实现的效果。减少采集不同类型数据的采集代理程序的种类，最好能只使用一个全功能的采集代理程序；有可能的话用一种万能的采集代理程序替代所有单点采集程序，诸如：Filebeat， Metricbeat， APM Agent， Heartbeat， Winlogbeat 等等各种 Elastic Stack 的采集程序。其他的这种类型的各个厂商和各种开源工具你可以自己联想。&lt;/p>
&lt;p>尽量发挥万能型采集代理程序的特性，最好它能够一键式的安装，能支持上百种流行的开源软件、商业软件和云服务。&lt;/p>
&lt;p>在采集代理程序开始正常工作以后，避免在端点的命令做任何配置工作。&lt;/p>
&lt;p>以上的数据采集端点程序部署在大多数情况下，都是覆盖可观测性解决方案的需求；如果可能的话，能够兼顾信息安全管理需求是一种更高效的做法；如果能一石二鸟，那又何乐而不为呢。&lt;/p>
&lt;h3 id="直观的集中统一管理">直观的集中统一管理
&lt;/h3>&lt;p>使用一个统一的采集代理管理中间层 Fleet 掌控全局。在这里一站式的实现采集代理的配置分发、更新等变更；实现采集代理程序的持续版本升级；随着采集端点数量的蔓延，横向扩展 Fleet 层，用一个 Fleet 服务器对接分布在各地的数千个 Elastic Agent。&lt;/p>
&lt;h2 id="elk-数据摄入架构变迁">ELK 数据摄入架构变迁
&lt;/h2>&lt;p>7.13 的 ELK 架构是持续了很久的传统模式，是社区里存在着大量描述文章，本文忽略对其的解释。&lt;/p>
&lt;p>渐进式的架构变化是从 7.13 开始初具雏形的，Fleet 功能组件作为 Kibana 的内置功能，正式登场。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/fleet-and-elastic-agent/2022-10-17_23-34-49.webp"
width="1986"
height="872"
srcset="https://martinliu.cn/blog/fleet-and-elastic-agent/2022-10-17_23-34-49_hu_6d3758f32d91841a.webp 480w, https://martinliu.cn/blog/fleet-and-elastic-agent/2022-10-17_23-34-49_hu_3d0e6750348ab4a.webp 1024w"
loading="lazy"
alt="7.13 前的架构图"
class="gallery-image"
data-flex-grow="227"
data-flex-basis="546px"
>&lt;/p>
&lt;p>Kiban 的定位是作为 Elastic Stack 的数据探索窗口，和管理控制平面。统一管理 Elastic Agent 需要增加两个功能：策略管理器和配置包管理器。需要引入新的 Fleet 服务器实现下面的需求：&lt;/p>
&lt;ul>
&lt;li>对 n 多采集点的更小暴露平面。&lt;/li>
&lt;li>降低了 Kibana 服务器本身资源消耗和部署工作量。&lt;/li>
&lt;li>更容易管理并发模式。&lt;/li>
&lt;/ul>
&lt;p>从 7.14 以后的架构图如下。这是以后的发展方向。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/fleet-and-elastic-agent/2022-10-17_23-36-03.webp"
width="2062"
height="880"
srcset="https://martinliu.cn/blog/fleet-and-elastic-agent/2022-10-17_23-36-03_hu_55f0c3b332a246ca.webp 480w, https://martinliu.cn/blog/fleet-and-elastic-agent/2022-10-17_23-36-03_hu_29832e41cd4d0175.webp 1024w"
loading="lazy"
alt="7.14 后的架构图"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="562px"
>&lt;/p>
&lt;p>Fleet 服务器的代码和 Elastic Agent 是一套程序。它就像是一个万能工具一样。&lt;/p>
&lt;p>它在对底层的采集端点上，实现的是全能型代理程序的管理。他在 Fleet 这个模式的主要功能是：从 Elasticsearch 后端或许最新版的 Agent 管理策略；相应采集端点上采集代理的管理策略拉取请求。管理策略的单向下发，采集数据的单向上传可以有几个选项，或者集中目标：&lt;/p>
&lt;ol>
&lt;li>自己部署管理的 Elasticsearch 集群&lt;/li>
&lt;li>自己部署管理的 Logstash 服务器&lt;/li>
&lt;li>Elastic Cloud SaaS 服务里的 Elasticsearch 服务端点&lt;/li>
&lt;li>Elastic Cloud SaaS 服务里的 Logstash 服务端点&lt;/li>
&lt;/ol>
&lt;p>Elastic Agent 采集端进程管理所有其他 Beats 进程，使用 GRPC 通讯协议发送数据，和下拉管理策略更新。&lt;/p>
&lt;p>Elastic Agent 可以工作在被 Fleet 服务器统一管理的模式；也还可以运行在独立自管理状态，从而满足极端少量的特殊需求。&lt;/p>
&lt;p>其他周边的重要组件：&lt;/p>
&lt;ol>
&lt;li>Elastic Package Registry - 包含了 Elastic Stack 技术栈中所有组件的配置细节，包括安装、升级、更新和删除等等。用 zip 压缩包文件的方式分发。&lt;/li>
&lt;li>Policy Builder - 在 Kibana 的界面里展现所有可以让用户掌控/修改定制的配置细节，用简单的开关按钮和输入框完成不容易出错的采集配置细节的定制，这样就消除了对 YAML 配置文件的管理。&lt;/li>
&lt;/ol>
&lt;p>参考信息：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.elastic.co/guide/en/fleet/current/index.html" target="_blank" rel="noopener"
>Fleet and Elastic Agent Guide&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.elastic.co/blog/review-testing-methods-for-elastic-integrations-using-the-elastic-package-tool" target="_blank" rel="noopener"
>Review testing methods for Elastic integrations using the elastic-package tool&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Feature picture ❤️ analogicus图片: &lt;a class="link" href="https://www.pexels.com/zh-cn/photo/5516029/" target="_blank" rel="noopener"
>https://www.pexels.com/zh-cn/photo/5516029/&lt;/a>&lt;/p></description></item><item><title>HCI | 超融合平台线上训练营第二期</title><link>https://martinliu.cn/blog/hci-nutanix-ce-training-camp/</link><pubDate>Sun, 20 Feb 2022 23:05:40 +0800</pubDate><guid>https://martinliu.cn/blog/hci-nutanix-ce-training-camp/</guid><description>&lt;img src="https://martinliu.cn/img/cos/2022-02-21-hci-nutanix.jpeg" alt="Featured image of post HCI | 超融合平台线上训练营第二期" />&lt;p>本文总结了我从单机的 Home Lab 环境，发展到三节点 Nutanix 超融合混合盘集群的经验和教训。&lt;/p>
&lt;h2 id="为什么需要超融合集群">为什么需要超融合集群
&lt;/h2>&lt;p>我的 Home lab 的进化史&lt;/p>
&lt;ul>
&lt;li>长期保持一些特定功能的虚拟机&lt;/li>
&lt;li>在本地保持丰富的虚拟机模版和快照&lt;/li>
&lt;li>将照片和视频家庭资料放到媒体服务器中【Plex】&lt;/li>
&lt;li>探索IoT智能家居，家庭安防等项目&lt;/li>
&lt;li>充分利用虚拟话带来的福利，计算和存储资源超量分配&lt;/li>
&lt;li>利用高级分布式软件定义存储都高级功能，空间的节省：压缩，去重，纠删码等；性能提升：虚拟机享受全闪存本地磁盘+精简制备；同时享用性能和空间：通过 SSD+HDD的混合容量存储池实现鱼和熊掌兼得。&lt;/li>
&lt;li>本地实验室网速提升到万兆以太网，尝试最新的数据中心DPU（智能网卡）、边缘计算和IoT趣味设备。&lt;/li>
&lt;li>排除家用 NAS主机（群晖）、ALL in One 主机、云和容器等选项&lt;/li>
&lt;/ul>
&lt;p>其他可能选项&lt;/p>
&lt;ul>
&lt;li>VMware 的 ESXi 平台 + VSAN ；熟悉 VMware 技术栈； 或被人带着追捧者多用。&lt;/li>
&lt;li>Citrix 的 XenServer + 家用集中存储；少见家用的人。&lt;/li>
&lt;li>其他的开源虚拟化选项 Proxmox ，单机版家用服务区比较常见。&lt;/li>
&lt;/ul>
&lt;h2 id="各种系统使用体验">各种系统使用体验
&lt;/h2>&lt;p>不论是单机的服务器/NAS，总之使用场景的需求是越用越多的，HomeLab 用的时间越久，想要做的事情就会越多。&lt;/p>
&lt;h3 id="intel-nuc">Intel NUC
&lt;/h3>&lt;p>这是一台 Nutanix 售前工程师标配的测试机。我用了好几年，非常皮实耐用。&lt;/p>
&lt;p>&lt;strong>硬件平台&lt;/strong>：&lt;/p>
&lt;ul>
&lt;li>集成主板，i7 8 Core + 集成 Intel 显卡&lt;/li>
&lt;li>32GB 内存，DDR4 - 2133 MHz&lt;/li>
&lt;li>SSD 500GB x 2 ， M.2 nvme 接口&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>使用体验&lt;/strong>：&lt;/p>
&lt;ol>
&lt;li>CPU和内存资源都比较有限&lt;/li>
&lt;li>散热不理想，风扇噪音越用越大&lt;/li>
&lt;li>无法扩展&lt;/li>
&lt;li>不适合长期开机&lt;/li>
&lt;li>安装 Nutanix CE （AHV） 超级轻松，从不会遇到失败，hypervisor 安装在U盘上。安装后，调低 cvm 的资源，剩余可用资源，所剩无几。&lt;/li>
&lt;/ol>
&lt;h3 id="lenovo-p720">Lenovo P720
&lt;/h3>&lt;p>公有云虽然是完全可用的，但是无法满足我企业数据中心相关技术的本地体验。还是需要搞一台配置高的，资源更多的机器，因此入手了第二台测试机，为了放置空间和电费都更容易接受，折中选择了二手的品牌机工作站。&lt;/p>
&lt;p>硬件平台：&lt;/p>
&lt;ul>
&lt;li>Intel(R) Xeon(R) CPU E5-2680 v4 @ 2.40GHz 14 core x 2&lt;/li>
&lt;li>64 GB ，还有很多空余插槽&lt;/li>
&lt;li>SSD ：120 GB + 256GB ，一共有四个 3.5 寸的标准磁盘位。&lt;/li>
&lt;li>安装 VMWare ESXi + vCenter
&lt;ul>
&lt;li>超分资源+精简存储制备&lt;/li>
&lt;li>广泛的开源虚拟机模版下载&lt;/li>
&lt;li>大量开源和私有企业技术支持&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>经过一年多的扩容，截止到现在的配置如下：&lt;/p>
&lt;ul>
&lt;li>56 logical core： 2 x Intel(R) Xeon(R) CPU E5-2680 v4 @ 2.40GHz -14 core 【保持】&lt;/li>
&lt;li>128 GB DDR4 2011Mhz 【感谢上海网友】&lt;/li>
&lt;li>HDD：西部数据WD 4Tb 5400rpm x 2 【增加了两块 HDD】&lt;/li>
&lt;li>SSD：三星750 Evo 120GB，三星870 Evo 250 GB，三星870 Evo 1TB 【新增一块 SSD】&lt;/li>
&lt;li>NIC：Boardcom BCM57412 NetXtreme-E 10Gb SPF+双口 【感谢panpan】&lt;/li>
&lt;/ul>
&lt;p>使用体验：&lt;/p>
&lt;ol>
&lt;li>存储空间不足，虚拟机越来越多，需要不断买新磁盘扩容&lt;/li>
&lt;li>CPU&amp;amp;内存有限，无法做一些性能基准测试&lt;/li>
&lt;li>想扩展为单机版 VSAN ，或者 VSAN 群集，但是它无法支持SSD+HDD的混合容量磁盘组&lt;/li>
&lt;li>只有两张千兆网卡（主板集成），无法实现集群情况下高速的网络数据I/O&lt;/li>
&lt;li>虚拟机开多了，导致CPU过热，机器会自动关机后，机器暂时无法启动，不得不替换了更好的散热器&lt;/li>
&lt;/ol>
&lt;p>单机工作站的 HomeLab 模式无法实现，我对更多集群型软件的部署使用场景，包括：&lt;/p>
&lt;ul>
&lt;li>Elasticsearch 冷热温多层架构 + ELK 全家桶的长期数据本地保留&lt;/li>
&lt;li>高可用 K8S 集群搭建和长期持有
*更多 DevOps 开源工具链的搭建，新版本更新，长期随时可用&lt;/li>
&lt;li>还有其它，不赘述。&lt;/li>
&lt;/ul>
&lt;h2 id="建议平台选型">建议平台选型
&lt;/h2>&lt;p>为了实现三节点的超融合群集，双十一出手购买了一些产品。&lt;/p>
&lt;h3 id="国产主板套装-x-2">国产主板套装 x 2
&lt;/h3>&lt;p>国产套版的性价比和评价其实都还是ok的，满心怀疑的开始测试起来。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>华南金牌 x99-AD4 - 单路&lt;/p>
&lt;ul>
&lt;li>12 CPUs x Intel(R) Xeon(R) CPU E5-2690 v3 @ 2.60GHz&lt;/li>
&lt;li>64 GB - DDR4 - 2400Mhz&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>磁盘接口：&lt;/p>
&lt;ul>
&lt;li>nvme接口：1 x M.2 - AHV 可用，ESXi不可用&lt;/li>
&lt;li>NGFF接口: 1 x M.2 - 同上&lt;/li>
&lt;li>sSATA x 2：空闲&lt;/li>
&lt;li>SATA x 6:
&lt;ul>
&lt;li>SSD1: KINGSTON 60GB x 2&lt;/li>
&lt;li>SSD2: Samsung SSD 860 500GB + Samsung MZ7TE 256GB&lt;/li>
&lt;li>HDD3/4: 西部数据WD 4Tb 5400rpm x 4&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>主板集成RTL8111/8168/8411 千兆网卡，ESXi 7/6 都不能直接兼容&lt;/p>
&lt;/li>
&lt;li>
&lt;p>显卡：无集成显卡，ATI Radeon HD 2GB x 2 - 买错了，最好是集成显卡。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>万兆网卡： Boardcom BCM57412 NetXtreme-E 10Gb SPF+双口 【感谢panpan】 x 2&lt;/p>
&lt;/li>
&lt;li>
&lt;p>千兆网卡：&lt;/p>
&lt;ul>
&lt;li>Intel 82576 千兆双口 x 1 （ESX i 6/7 兼容）&lt;/li>
&lt;li>Intel I340-T2 千兆双口 x 1 （ESX i 7 不兼容）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>机箱：开放式亚克力透明双层机箱 x 2&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>使用经验：&lt;/p>
&lt;ol>
&lt;li>BIOS 中的Boot模式一定要设置为Legacy模式&lt;/li>
&lt;li>忽略主板集成网卡，除非你非常擅长将驱动注入ESXi 的iso文件，安装前兆或者万兆网卡&lt;/li>
&lt;li>Nutanix CE安装的时候需要网卡驱动正常，ESXi 虚拟化必须能从本地web服务器下载iso安装文件&lt;/li>
&lt;li>AHV虚拟化安装很正常，连nvme接口的M.2磁盘都可以正常使用&lt;/li>
&lt;li>ESXi虚拟化安装的结果是失败的，但是手工可以拯救CVM，步骤可以忍受。&lt;/li>
&lt;/ol>
&lt;h3 id="超微豪华高仿nutanix">超微豪华高仿Nutanix
&lt;/h3>&lt;p>新购了一块超微主板，做下对比测试，缓解一下华南主板坑多的低落心情。&lt;/p>
&lt;ul>
&lt;li>单路：SuperMicro X10SRL-F&lt;/li>
&lt;li>CPU：E5-2690 v3 @2.60 GHz，12 core&lt;/li>
&lt;li>SATA3: x 10
&lt;ul>
&lt;li>SSD 1/2&lt;/li>
&lt;li>HDD x2&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>主板集成双千兆网卡 （ESXi 6/7 兼容）&lt;/li>
&lt;/ul>
&lt;p>用这块主板 + 以上华南金牌的全套磁盘+CPU+内存+万兆网卡，安装Nutanix CE，ESXi 6/7都可以顺利安装，连CVM都能够自动创建成功，不需要手工拯救失败的CVM，这个平台安装部署Nutanix CE 应该是毫无压力感。&lt;/p>
&lt;p>超微主板是Nutanix原厂超融合硬件平台的供应商，这任选了一块测试版的兼容性就确实没话说。不用再测，不用在多了，关键是把上面的国产廉价平台能用起来。&lt;/p>
&lt;h3 id="方案汇总">方案汇总
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>类型&lt;/th>
&lt;th>主板&lt;/th>
&lt;th>内存&lt;/th>
&lt;th>SSD&lt;/th>
&lt;th>HDD&lt;/th>
&lt;th>网络&lt;/th>
&lt;th>节点&lt;/th>
&lt;th>价格&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>最小可平台&lt;/td>
&lt;td>Intel NUC&lt;/td>
&lt;td>32GB&lt;/td>
&lt;td>500GB x 2&lt;/td>
&lt;td>USB/hypervisor&lt;/td>
&lt;td>1G1/2&lt;/td>
&lt;td>1&lt;/td>
&lt;td>7+千左右&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>工作站平台&lt;/td>
&lt;td>Lenovo P710&lt;/td>
&lt;td>128GB&lt;/td>
&lt;td>1/2/3+&lt;/td>
&lt;td>1/2/3/4/5+&lt;/td>
&lt;td>1Gx2/10Gx2&lt;/td>
&lt;td>1&lt;/td>
&lt;td>8+千左右&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>国产套版&lt;/td>
&lt;td>华南x99-AD4&lt;/td>
&lt;td>64GB&lt;/td>
&lt;td>2&lt;/td>
&lt;td>1/2/3/4&lt;/td>
&lt;td>1Gx2+10Gx2&lt;/td>
&lt;td>1/3/4&lt;/td>
&lt;td>7+千左右/2套&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>超微平台&lt;/td>
&lt;td>SuperMicro X10SRL-F&lt;/td>
&lt;td>/&lt;/td>
&lt;td>/&lt;/td>
&lt;td>/&lt;/td>
&lt;td>/&lt;/td>
&lt;td>1/3/4&lt;/td>
&lt;td>随意搭配，参考市价&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>旧服务器&lt;/td>
&lt;td>Dell/Lenvov/HP/浪潮&lt;/td>
&lt;td>/&lt;/td>
&lt;td>2+直通&lt;/td>
&lt;td>2+直通&lt;/td>
&lt;td>1Gx2+10Gx2&lt;/td>
&lt;td>1/3/4&lt;/td>
&lt;td>参考市价&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="其他组件的选择">其他组件的选择
&lt;/h3>&lt;p>下面是对于自选平台的DYI的建议：&lt;/p>
&lt;ul>
&lt;li>机箱：根据主板的选择，开放式主板方便使用水冷系统，热量容易散发，可以借助环境的空气散热，选择封闭机箱则需要注意CPU散热器的选择，确保CPU工作温度正常。&lt;/li>
&lt;li>电源：CPU和显卡电耗需要提前计算，确保电源供电攻略足够。&lt;/li>
&lt;li>显卡：主板尽量带集成显卡，保持系统最简化可用，后续如果需要GPU了，可以在加显卡，确保主板有两个PCIx16的插槽。&lt;/li>
&lt;li>网卡：尽量选择ESXi7可以识别免驱动的，7这个版本兼容的网卡类型比6少很多，安装过程中需要IP地址，免得给自己找麻烦，我的一块千兆网卡不能被7正常驱动，因此ESXi的版本无奈降到6.7u3。&lt;/li>
&lt;li>PCI插槽：建议16x至少2个，用于显卡和万兆网卡，其它速率的若干，用于兼容其它可能的网卡或者设备。&lt;/li>
&lt;/ul>
&lt;h2 id="集群搭建流程">集群搭建流程
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-02-21-WechatIMG1773.jpeg"
loading="lazy"
alt="test machine"
>&lt;/p>
&lt;h3 id="准备工作">准备工作
&lt;/h3>&lt;p>注册Nutanix社区帐号，&lt;a class="link" href="https://next.nutanix.com/%ef%bc%8c%e5%bf%85%e9%a1%bb%e7%94%a8%e5%85%ac%e5%8f%b8%e9%82%ae%e7%ae%b1%e6%b3%a8%e5%86%8c%ef%bc%8c%e6%89%8d%e8%83%bd%e4%b8%8b%e8%bd%bd%e6%9c%80%e6%96%b0%e7%9a%84Nutanix" target="_blank" rel="noopener"
>https://next.nutanix.com/，必须用公司邮箱注册，才能下载最新的Nutanix&lt;/a> CE安装镜像，和其它相关组件。在首次登陆Nutanix CE群集的时候，也需要输入这个帐号和密码验证。&lt;/p>
&lt;p>准备安装镜像：&lt;/p>
&lt;ol>
&lt;li>Windows 10 + Ruft&lt;/li>
&lt;li>下载 Nutanix-2020-9016.tar&lt;/li>
&lt;li>Fedora 35 Live CD&lt;/li>
&lt;li>16 GB U 盘 x2&lt;/li>
&lt;/ol>
&lt;p>准备网络环境&lt;/p>
&lt;ol>
&lt;li>千兆 + 万兆 （DAC 铜缆）&lt;/li>
&lt;li>DHCP + DNS + Internet 网络&lt;/li>
&lt;li>Web 服务器 + esxi702a.iso 「不安装 vsphere 虚拟化的不需要 web 服务器」&lt;/li>
&lt;/ol>
&lt;h3 id="安装流程">安装流程
&lt;/h3>&lt;ol>
&lt;li>Fedora Live CD 启动，磁盘工具删除分区&lt;/li>
&lt;li>插好网线&lt;/li>
&lt;li>Nutanix 安装盘启动，观察网卡 IP 地址获取&lt;/li>
&lt;li>设置 Hypervisor 类型、磁盘布局、集群信息等，建议不要勾选创建点节点集群的选项，后期手工创建更可控。&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-02-21-WechatIMG1774.jpeg"
loading="lazy"
alt="setup"
>
5. 同意软件许可
6. 等待 Hypervisor （ahv一般较快，或者vsphere）成功安装&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-02-21-WechatIMG1775.jpeg"
loading="lazy"
alt="hypervisor 安装过程中"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-02-21-WechatIMG1776.jpeg"
loading="lazy"
alt="hypervisor 安装完毕"
>&lt;/p>
&lt;ol start="5">
&lt;li>安装后重启服务器，首次 host 启动，观察 cvm 启动过程和结果，等待 CVM 就绪，确认 CVM 上硬盘的挂载情况&lt;/li>
&lt;li>登录后确保集群处于未配置状态&lt;/li>
&lt;li>重复以上步骤，安装其他 2 ～ 3 个节点 【CE 最多支持4个节点】&lt;/li>
&lt;li>检查和确认集群的状态，每个节点都输出，集群未配置，准备工作就绪。&lt;/li>
&lt;li>在其中一个 cvm 上，运行创建 Nutanix 集群的命令， cluster create&lt;/li>
&lt;li>首次登陆集群，完成初始化配置&lt;/li>
&lt;li>配置并确认网络配置，在存储迟管理的地方，创建过载到所有vsphere 主机的共享 NFS 统一存储空间。存储资源就绪。&lt;/li>
&lt;li>安装部署 vcenter，在 Prism 中注册 vcenter&lt;/li>
&lt;li>安装虚拟机模版&lt;/li>
&lt;li>创建虚拟机测试&lt;/li>
&lt;li>运行基本的性能验收测试&lt;/li>
&lt;li>正式投产&lt;/li>
&lt;li>可选：安装 PC、Fileserver、CALM、K8s&lt;/li>
&lt;/ol>
&lt;h3 id="问题解决">问题解决
&lt;/h3>&lt;ul>
&lt;li>【Hypervisor】安装过程中 screen is terminating&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-02-21-WechatIMG1777.jpeg"
loading="lazy"
alt="terminal screen"
>&lt;/p>
&lt;ul>
&lt;li>【vSphere虚拟化】虚拟化安装成功，但是重启后 cvm 创建失败&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-02-21-WechatIMG1778.jpeg"
loading="lazy"
alt="failed-install"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-02-21-2021-11-27_22-00-44.png"
loading="lazy"
alt="CVM failed"
>&lt;/p>
&lt;ul>
&lt;li>【vSphere虚拟化】cvm 创建成功且运行正常，但是不能正常挂载 HDD&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-02-21-2022-02-21_19-17-50.png"
loading="lazy"
alt="CVM lost one hdd"
>
&lt;img src="https://martinliu.cn/img/cos/2022-02-21-2022-02-21_19-16-35.png"
loading="lazy"
alt="CVM lost one HDD"
>&lt;/p>
&lt;h3 id="esxi-安装后-cvm-创建失败hdd挂载问题">ESXi 安装后 CVM 创建失败/HDD挂载问题
&lt;/h3>&lt;p>由于安装程序无法正常初始化所有磁盘，直通的HDD没有正常加载，初始化脚本有小bug导致。手工挂在直通HDD，修复有bug的python代码，重新初始化创建 cvm，确保 CVM 虚拟机最后能正常运行。&lt;/p>
&lt;p>处理方法：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>网页访问 ESXi 的 ip 地址 ，使用默认的用户名【root】和密码【nutanix/4u】登录，查看确认如下：&lt;/p>
&lt;ol>
&lt;li>存储-设备下面是否所有磁盘都可见&lt;/li>
&lt;li>网络：所有uplink，网卡，两个虚拟交换机，五个port group&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>SSH 登陆 ESXi host ，查看错误日志的内容：&lt;code>/bootbank/Nutanix/firstboot/esx_first_boot_launcher.log&lt;/code>；查看是否是如下的常见错误：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">FATAL Fatal exception encountered:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Traceback &lt;span class="o">(&lt;/span>most recent call last&lt;span class="o">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> File &lt;span class="s2">&amp;#34;/bootbank/Nutanix/firstboot/esx_first_boot.py&amp;#34;&lt;/span>, line 2516, in &amp;lt;module&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> main&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> File &lt;span class="s2">&amp;#34;/bootbank/Nutanix/firstboot/esx_first_boot.py&amp;#34;&lt;/span>, line 2361, in main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> create_svm_vmx_and_attach_rdm_disks_ce&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> File &lt;span class="s2">&amp;#34;/bootbank/Nutanix/firstboot/esx_first_boot.py&amp;#34;&lt;/span>, line 1478, in create_svm_vmx_and_attach_rdm_disks_ce
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">dev_paths&lt;/span> &lt;span class="o">=&lt;/span> get_disk_locations_ce&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> File &lt;span class="s2">&amp;#34;/bootbank/Nutanix/firstboot/esx_first_boot.py&amp;#34;&lt;/span>, line 1019, in get_disk_locations_ce
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> device_identifiers.remove&lt;span class="o">(&lt;/span>disk&lt;span class="o">[&lt;/span>:-3&lt;span class="o">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ValueError: list.remove&lt;span class="o">(&lt;/span>x&lt;span class="o">)&lt;/span>: x not in list
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>使用这篇文章&lt;a class="link" href="https://next.nutanix.com/discussion-forum-14/esxi-failed-install-on-hpe-dl380-gen9-ce-2020-09-16-38898" target="_blank" rel="noopener"
>https://next.nutanix.com/discussion-forum-14/esxi-failed-install-on-hpe-dl380-gen9-ce-2020-09-16-38898&lt;/a>中的解决方案，查看这个论坛帖子需要注册论坛的账号。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>使用上文的方案，运行修改后的 esx_first_boot.py 程序。等待程序执行完毕，在ESXi web client中观察CVM的创建过程。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>CVM 创建成功运行起来之后，你会发现它可能只挂载了SSD，下面需要手工加载加载系统中的HDD。&lt;/p>
&lt;ol>
&lt;li>ssh 登陆 ESXi host&lt;/li>
&lt;li>用命令 &lt;code>ls /vmfs/devices/disks/&lt;/code> 查看系统上的所有磁盘设备，记录未挂载上的HDD的设备路径，例如：&lt;code>/vmfs/devices/disks/t10.ATA_____WDC_WD40EFRX2D68N32N0_________________________WD2DWCC7K0ZN6E93&lt;/code>&lt;/li>
&lt;li>进入 CVM 虚拟机的配置文件目录 【如：&lt;code>/vmfs/volumes/NTNX-local-ds-4abcf92c-A/&lt;/code>】，创建所有HDD的直通磁盘，参考命令：&lt;code>vmkfstools -z /vmfs/devices/disks/t10.ATA_____WDC_WD40EFRX2D68N32N0_________________________WD&lt;/code>
&lt;code>2DWCC7K0ZN6E93 ./wd4t-1.vmdk&lt;/code>&lt;/li>
&lt;li>在ESXi web client中，关机（PowerOff） CVM，修改配置&lt;/li>
&lt;li>将上一步创建的直通HDD添加进来&lt;/li>
&lt;li>修改虚拟机选项的操作系统，改为CentOS7&lt;/li>
&lt;li>查看CVM虚拟机所有磁盘，确保所有SSD和HDD都已经加载，先不要修改其它任何配置，开机，观察虚拟机是否可以正常启动。&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>ssh登陆CVM虚拟机的操作系统，使用默认用户名【nutanix】和密码【nutanix/4u】。用ping其它集群节点的（host和cvm）ip地址，确保网关和DNS服务器都可达。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>CVM 正常运行后，才可以作为空白节点加入群集，或者用于创建新群集。&lt;/p>
&lt;h2 id="经验教训">经验教训
&lt;/h2>&lt;ol>
&lt;li>在 Nutanix 官方用户论坛的CE板块搜索问题或提问，你不是孤独的。&lt;/li>
&lt;li>散热器买专用的，通用的套具安装费劲，适配的并会很好&lt;/li>
&lt;li>磁盘至少使用 Fedora live cd 的磁盘工具查看状态，避免坏盘。&lt;/li>
&lt;li>cvm 创建失败应该是可以修复的&lt;/li>
&lt;li>安装过程需要联网&lt;/li>
&lt;li>集成显卡更好，&lt;/li>
&lt;li>相同的错误复发时要记得赶紧收工，明天再搞&lt;/li>
&lt;/ol>
&lt;h2 id="其他可用资源">其他可用资源
&lt;/h2>&lt;p>HCI超融合技术对于了解它的人来说很火热，但是还有很多不太了解HCI的人；HCI的用户对它也有不同的使用场景和期望。请大家参与这个《中国超融合状态调查》，我们每月为参与本调查的朋友进行抽奖，抽奖结果在下次直播的时候公布。扫码参与调查。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-dc.png"
loading="lazy"
alt="CVM HDD"
>&lt;/p>
&lt;p>我们为希望学习HCI技术的朋友们创建了一个qq群，希望可以给大家带来一定帮助。扫码加入我们的QQ群。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-qq.png"
loading="lazy"
alt="CVM HDD"
>&lt;/p>
&lt;h2 id="下期预告">下期预告
&lt;/h2>&lt;p>HCI系统的搭建还有很多问题值得一起探讨和学习，HCI超融合系统软件还有很多功能可以学习了解。我们为DevOps社区的朋友们新开辟了这个HCI板块，希望以后会每个月为大家输出一期新的内容。下期直播的简介如下：&lt;/p>
&lt;ul>
&lt;li>日期：2022 年 3 月 22 日， 下午 1点开始&lt;/li>
&lt;li>内容：Nutanix CE 的多集群管理&lt;/li>
&lt;li>主持人：刘征，吴孔辉&lt;/li>
&lt;li>直播平台：B站搜/关注：中国DevOps社区&lt;/li>
&lt;li>直播抽奖：未知神秘礼物 🎁&lt;/li>
&lt;li>报名：互动吧搜/关注：中国DevOps社区&lt;/li>
&lt;/ul></description></item><item><title>在本地搭建容器化的 Drupal 开发环境</title><link>https://martinliu.cn/blog/setup-drupal-dev-env-macos/</link><pubDate>Sat, 05 Feb 2022 11:11:55 +0800</pubDate><guid>https://martinliu.cn/blog/setup-drupal-dev-env-macos/</guid><description>&lt;img src="https://martinliu.cn/img/989197bbd274de342caf84c3642d8c6bc7b980ea-1920x700.png" alt="Featured image of post 在本地搭建容器化的 Drupal 开发环境" />&lt;p>过年前给自己挖了一个 Drupal 的坑，经过一些时间的研究之后，感觉这个系统和 Remedy 非常神似。说到底它们其实都是表单系统。每个表单表达一种分类的信息而已。Drupal 注重的是表单上的信息点的记录、管理和展示，Remedy 注重的则是每种表单（工作类型）上“工单流程状态”字段变化的记录和管理。&lt;/p>
&lt;p>&lt;a class="link" href="https://DevOpsChina.org" target="_blank" rel="noopener"
>DevOps China&lt;/a> 网站的选型之旅，最初使用的是 hugo，但是由于内容更新人员们对 github 系统掌握程度参差不齐，导致对于参与者不友好的问题，这为所有社区内容创建的朋友们设置了一个不必要的门槛。最初设计的是：以官网的内容为最源头参考点，然后同步到其它平台，包括：微信和互动吧等社区对外到入口。最后，微信公众号后台文案编辑的易用性超越了 GitHub 上 Hugo 站点的更新。社区网站维护志愿者也很难投入足够的精力，手工的从微信上同步回社区官网。就这样社区官网的及时更新问题居然持续了两年。&lt;/p>
&lt;p>2022年是解决这个问题的时候了。在对 Drupal 经过一定的研究之后，希望这次选型的 Drupal 能不负众望，完美的实现这个艰巨的使命。&lt;a class="link" href="https://stackoverflow.blog/2020/06/23/is-it-time-to-give-drupal-another-look/" target="_blank" rel="noopener"
>【 why drupal ？ 参考文章】&lt;/a>&lt;/p>
&lt;h2 id="drupal-是个内容管理系统">Drupal 是个内容管理系统
&lt;/h2>&lt;p>在 macOS 上搭建 PHP + MySQL 的开发环境的工具有很多。我选择使用的是已经绝版的 Acquia Dev Desktop 2 ，它包括了：php 7.3.15 的 php 语言运行环境， MySQL 5.7.29 数据库， Apache/2.4.29 的网页运行服务器， phpMyAdmin 4.9.0.1 数据库管理工具。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-02-05-2022-02-05_11-08-30.png"
loading="lazy"
alt="Acquia Dev Desktop 2"
>&lt;/p>
&lt;p>这种集成的 PHP 运行/开发/管理环境，还有很多其它选择，这里不展开。我的目标是：保持最简化和易用，与其它社区伙伴的协作，紧跟 Drupal 版本发布和补丁更新，用容器化实现云上的按需扩展。&lt;/p>
&lt;p>首先，我使用 Acquia Dev Desktop 2 创建了一个本地的测试站点，用于学习 Drupal 的使用、定制和开发。它不仅是一个友好的 GUI 工具，其实还附带了 php 开发环境的命令行工具：composer 和 drush 。 使用这两个命令行工具可以完成 Drupal 系统的一键式搭建。在开发一个真实的内容管理系统网站以前，最基础的铺垫工作可能差不多了。&lt;/p>
&lt;h2 id="一键安装-drupal-系统">一键安装 Drupal 系统
&lt;/h2>&lt;p>首先，打开 Acquia Dev Desktop 2 ，在界面上点击进入命令行按钮（more -&amp;gt; Open Console）。macOS 系统默认的 termenal 就会被打开，它会在默认环境中增加如下环境变量参数&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">Last login: Sat Feb &lt;span class="m">5&lt;/span> 10:25:58 on ttys005
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">PHP_ID&lt;/span>&lt;span class="o">=&lt;/span>php7_3&lt;span class="p">;&lt;/span> &lt;span class="nb">export&lt;/span> &lt;span class="nv">PATH&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;/Applications/DevDesktop/php7_3_x64/bin:/Applications/DevDesktop/mysql/bin:/Applications/DevDesktop/tools:&lt;/span>&lt;span class="nv">$PATH&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nb">cd&lt;/span> &lt;span class="s2">&amp;#34;/Users/martin/learning-drupal&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这样就可以在你的目标目录中，执行下面的一键安装脚本了：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 下载Drupal特定版本的代码库&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">composer create-project drupal/recommended-project:9.3.5 drupal-dev --no-interaction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> drupal-dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 配置以下可以让我们静默安装 drush 的参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">composer config --no-plugins allow-plugins.composer/installers &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">composer config --no-plugins allow-plugins.drupal/core-composer-scaffold &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">composer config --no-plugins allow-plugins.drupal/core-project-message &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装 Drupal 站点维护工具 drush&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">composer require drush/drush --no-interaction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -s vendor/drush/drush/drush ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./drush version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">composer require drush/config-extra --no-interaction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建目标 MySQL 数据库和用户名/密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysqladmin -u root drop local_devopschina -f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql -u root -e &lt;span class="s1">&amp;#39;create database local_devopschina&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql -u root -e &lt;span class="s2">&amp;#34;grant all privileges on local_devopschina.* to ddoc@localhost identified by &amp;#39;ddoc123&amp;#39;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 上面的一切都是为了这个命令可以静默安装，它替代了很多 php 开发的系统在网页上用安装程序进行的初始化工作，下面的数据库 root 密码为空&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./drush si standard --locale&lt;span class="o">=&lt;/span>zh-hans --db-url&lt;span class="o">=&lt;/span>mysql://ddoc:ddoc123@127.0.0.1:33067/local_devopschina --db-su&lt;span class="o">=&lt;/span>root --site-name&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;DevOps China&amp;#34;&lt;/span> --account-name&lt;span class="o">=&lt;/span>admin --account-pass&lt;span class="o">=&lt;/span>admin -y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安装和启用 Drupal 系统必要的模块和皮肤 【ToDo】&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 生产环境数据迁移，数据库备份的导入，相关文件下载 【ToDo】&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 启动 Drupal 系统&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./drush runserver localhost:8090
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上是一个写死了的 shell 脚本，还可以对其中的关键参数进行变量替换，使之最终成为一个可以传入参数的可用脚本。&lt;/p>
&lt;h2 id="进入-drupal-开发流程">进入 Drupal 开发流程
&lt;/h2>&lt;p>下图展示了 Drupal 网站开发的工作流程。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-02-05-Drupal-Site-Building-Workflow.png"
loading="lazy"
alt="Drupal Site Building workflow"
>&lt;/p>
&lt;p>用下面的表格梳理一下：&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>序号&lt;/th>
&lt;th>工作内容&lt;/th>
&lt;th>概述&lt;/th>
&lt;th>所需要技能&lt;/th>
&lt;th>备注&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>1.0&lt;/td>
&lt;td>Content Type&lt;/td>
&lt;td>既是任何一条内容对象的完整定义，也是任何一个可管理实体。系统默认自带了‘文章’和‘基本页面’两个内容类型，隐含的具备了简单的 ‘用户’ 管理系统。在此基础上还需扩展出‘社区合作伙伴’、‘社区活动’等实地。&lt;/td>
&lt;td>数据库ER设计、数据结构&lt;/td>
&lt;td>并不需要在 MySQL 中建表，都是在 Drupal 界面完成&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2.0&lt;/td>
&lt;td>Fields&lt;/td>
&lt;td>是组成任何内容和实体数据结构的信息点，包含PHP编程语言的数据类型和Drupal 社区里的各种模块，例如‘电话号码’这样的数据结构的引用就是先启用对应的模块&lt;/td>
&lt;td>php开发&lt;/td>
&lt;td>Drupal 社区已有模块不满足才做开发&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2.1&lt;/td>
&lt;td>Taxonomy&lt;/td>
&lt;td>就像是一个二位数组，在每一个分类里有一堆确切的词汇表。例如社区网站的文章、活动和论坛里的帖子都可以引用“话题”这样一个字段，用于单选或者多选，“话题”这个字段里包含了很多DevOps术语“ci”、“敏捷”、“SRE”等。&lt;/td>
&lt;td>领域知识、数据机构&lt;/td>
&lt;td>随着网站内容建设的过程而演进&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2.2&lt;/td>
&lt;td>Media&lt;/td>
&lt;td>文档、音频、图片和视频的统一管理，这样方便任意媒体文件的使用；Drupal 9 自带的 Media Libary 模块能够满足需求&lt;/td>
&lt;td>数字媒体管理、CDN加速&lt;/td>
&lt;td>所有用户生成媒体都在这个范畴，会严重影响网站速度，依赖与网站 CDN 加速的实施&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2.3&lt;/td>
&lt;td>Modules&lt;/td>
&lt;td>Drupal 模块非常丰富，从电话号码这样的数据结构，到文本地址到百度地图的转化，到整个知识库结构的定义；社区参与者积分和排名这样的功能将会使用自开发的模块实现&lt;/td>
&lt;td>php开发、数据库&lt;/td>
&lt;td>需要懂 php 开发语言，可独立开发&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3.0&lt;/td>
&lt;td>Path&lt;/td>
&lt;td>每一个内容实体在 Drupal 中被称之为 node，它们都有默认的访问路径，例如：/node/12/；需要整体规划网站的访问路径，不但让网站变得更加有条理，而且还会提高人和搜索引擎的友好程度，Drupal 的相关模块可以实现&lt;/td>
&lt;td>内容系统梳理&lt;/td>
&lt;td>尽量保持简单、清晰和持久&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4.0&lt;/td>
&lt;td>Permessions&lt;/td>
&lt;td>用户权限需要提前设计，Drupal 除了具有内置的权限机制外，它对任何一个功能模块（内容分类）都可以实施给予角色的矩阵式权限设置，需要提前设计好用户角色类型，权限体系&lt;/td>
&lt;td>权限设计、信息安全&lt;/td>
&lt;td>这是实施文章内容上传、论坛和社区活动管理的基础。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4.1&lt;/td>
&lt;td>Workflows&lt;/td>
&lt;td>工作流是 Drupal 系统中默认的功能模块，经过定制以后可以实现社区贡献文章的审核功能。例如开放所有注册用户的投稿权限，投稿文章必须经过审核人员确认后才能发不出来。还可以用于知识库或者编辑的多重审核功能&lt;/td>
&lt;td>流程定制&lt;/td>
&lt;td>需要掌握 Drupal 相关模块的使用，确保流程简单易用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>5.0&lt;/td>
&lt;td>Layout&lt;/td>
&lt;td>网页布局结构设计，manage display of nodes 这是基础工作 -&amp;gt; blocks -&amp;gt; layout builder -&amp;gt; views -&amp;gt; image styles ，不同的 theme 自带一套 block 的布局&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>5.1&lt;/td>
&lt;td>Blocks&lt;/td>
&lt;td>实施页面中的每个模块，模块是一个实体可以容纳视频、文字、图片和其他更多，搜索栏，菜单等；他不是内容，是一个 placeholder&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>5.2&lt;/td>
&lt;td>Layout Builder&lt;/td>
&lt;td>一个核心模块，拖拽式可视化页面设计实施工具，可以为不同的内容类型、实体和其它创建定制的布局。&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>5.3&lt;/td>
&lt;td>Views&lt;/td>
&lt;td>创建数据库查询，过滤和筛选内容，静态的操作或者根据上下文的 。Display【page、block】，format，lields,filter,sort,&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>6.0&lt;/td>
&lt;td>Add Content&lt;/td>
&lt;td>在以上工作基本完成之后，就可以进入网站内容的填充阶段&lt;/td>
&lt;td>SQL查询&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>6.1&lt;/td>
&lt;td>Menus&lt;/td>
&lt;td>菜单包括网站的主导航菜单，页脚导航和各个页面上可能使用到的分类选项&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>6.2&lt;/td>
&lt;td>Site Management&lt;/td>
&lt;td>开发、测试和生产环境之间的迁移和更新流程&lt;/td>
&lt;td>CI、CD、Cloud、DNS、CDN&lt;/td>
&lt;td>用 GitHub 、Docker 和 Azure 等技术实施必要的工作流程&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>7.0&lt;/td>
&lt;td>Theme&lt;/td>
&lt;td>网站展示风格的开发贯穿于以上所有工作内容的过程中。需要基于某种Drupal网站皮肤作为底板，开发自己的定制皮肤，在需要改进的时候随时调整和更新&lt;/td>
&lt;td>前端开发、CSS&lt;/td>
&lt;td>图片等美工设计需要交付给社区的设计同学&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>为了多人、开放式、实现社区网站开发和内容建设的工作，我们还需要一个项目管理工具。这里可以选用 GitHub ：&lt;a class="link" href="https://github.com/orgs/DevopsChina/projects/1/" target="_blank" rel="noopener"
>https://github.com/orgs/DevopsChina/projects/1/&lt;/a> 用它可以实现以下功能。&lt;/p>
&lt;ul>
&lt;li>任务记录、跟踪和分配&lt;/li>
&lt;li>统一管理多个代码仓库的任务&lt;/li>
&lt;li>任务可以和代码库工作相关，也可以无关&lt;/li>
&lt;li>通过内置的工作流，可以实现代码库 issue &amp;amp; pr 任务的自动关联，状态同步&lt;/li>
&lt;li>可以创建自定义字段的视图，用于不同目的的跟踪，支持任务清单，ToDoList 等视图。&lt;/li>
&lt;/ul>
&lt;p>下一步邀请社区网站工作组召开项目启动会。&lt;/p>
&lt;h2 id="版本化开发环境">版本化开发环境
&lt;/h2>&lt;p>初始化上面所创建的项目文件夹。将其推送到 &lt;a class="link" href="https://github.com/DevopsChina/drupal-dev.git" target="_blank" rel="noopener"
>https://github.com/DevopsChina/drupal-dev.git&lt;/a>&lt;/p>
&lt;p>先参考 Drupal 代码库 web 目录下的样例文件，在项目目录中创建 .gitignore 文件。应该在这两个文件中排出以下文件，处于演示目的，本项目并没有将其排除在外。&lt;/p>
&lt;ul>
&lt;li>.env&lt;/li>
&lt;li>sites/&lt;em>/settings&lt;/em>.php&lt;/li>
&lt;li>sites/&lt;em>/services&lt;/em>.yml&lt;/li>
&lt;/ul>
&lt;p>执行下面的代码推送动作。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">git init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git add .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git commit -m &lt;span class="s2">&amp;#34;first commit&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git branch -M main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git remote add origin https://github.com/DevopsChina/drupal-dev.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git push -u origin main
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在完成了代码库初始化工作后，会设置一下 main 主干保护策略。防止直接对 main 的变更。&lt;/p>
&lt;h2 id="容器化-drupal-系统">容器化 Drupal 系统
&lt;/h2>&lt;p>容器化当前的项目需要经过这些操作步骤：&lt;/p>
&lt;ol>
&lt;li>确认当前 Drupal 系统中的配置和内容，这个状态会打包到容器环境中。用 sqldump 导出数据库。&lt;/li>
&lt;li>参数化 &lt;code>web/sites/settings.php&lt;/code> 文件，将变量和密码变成参数。&lt;/li>
&lt;li>创建 Drupal 主应用镜像的 &lt;code>Dockerfile&lt;/code> 。&lt;/li>
&lt;li>创建包含数据库服务和开发工具服务的 &lt;code>docker-compose.yml&lt;/code> 服务定义文件。&lt;/li>
&lt;li>在本机测试和确认容器服务中 Drupal 网站的可用性和内容。&lt;/li>
&lt;/ol>
&lt;h3 id="1---确认当前系统状态">1 - 确认当前系统状态
&lt;/h3>&lt;p>在经过初始化的配置后，几乎所有系统级别配置信息都保存在了 MySQL 数据库中，用 sqldump 导出 MySQL 数据库，dump 文件会用于 MySQL 容器服务的初始化文件。字段定义、文章编辑、初始化内容的填充也会产生一些数据文件（图片、文件、视频、音频），这些文件就位于 &lt;code>web/sites/default/files/&lt;/code> 目录中。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">mkdir sql
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysqldump -u root local_devopschina &amp;gt; sql/dump.sql
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在项目文件夹中，执行以上命令，就可以得到的到一个大约十几兆的 MySQL 数据库备份文件。&lt;/p>
&lt;h3 id="2---参数化-drupal-主配置文件">2 - 参数化 Drupal 主配置文件
&lt;/h3>&lt;p>Drupal 的数据库链接字符串和账号信息都位于 &lt;code>web/sites/settings.php&lt;/code> 文件中。为了确保 Drupal 镜像启动后可以链接到正确的 MySQL 数据库服务。需要改此文件。&lt;/p>
&lt;p>原始配置参数：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$databases&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;database&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;local_devopschina&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;ddoc&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;ddoc123&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;prefix&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;host&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;127.0.0.1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;port&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;33067&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;namespace&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;Drupal\\Core\\Database\\Driver\\mysql&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;driver&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;mysql&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>备份原始配置文件。由于修改以后在本机用 drush 运行的本地测试 Drupal 应用就中断了。后续可以优化一下：保持原始配置文件不变，参数化一个配置文件的副本，在 Drupal 打包过程中加一个参数化配置文件的覆盖替换动作。&lt;/p>
&lt;p>修改为如下内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$databases&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">array&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;database&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nv">$_ENV&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DBASE&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nv">$_ENV&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;USER&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nv">$_ENV&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;PASS&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;prefix&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;host&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nv">$_ENV&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;HOST&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;port&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nv">$_ENV&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DPORT&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;namespace&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;Drupal\\Core\\Database\\Driver\\mysql&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;driver&amp;#39;&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;mysql&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上参数化非必要的最佳操作，本文目标在与记录，后续会优化这个步骤。&lt;/p>
&lt;h3 id="3---创建-drupal-主应用镜像">3 - 创建 Drupal 主应用镜像
&lt;/h3>&lt;p>基于 Drupal 官方的镜像文件创建适合自己项目的 &lt;code>Dockerfile&lt;/code>。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-dockerfile" data-lang="dockerfile">&lt;span class="line">&lt;span class="cl">&lt;span class="k">FROM&lt;/span>&lt;span class="s"> drupal:9-php7.4-apache&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> &lt;span class="nb">set&lt;/span> -eux&lt;span class="p">;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt-get update&lt;span class="p">;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt-get install -y --no-install-recommends git&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后运行 docker build 命令，确认本地可以成功构建这个自定义镜像。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">docker build -t devopschina/drupal-dev .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker image
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>本测试镜像创建成功后，没有镜像上传的动作，镜像上传到特定的镜像仓库后，就可以实现在云容器服务中的部署。这里省略此 push 步骤。&lt;/p>
&lt;h3 id="4---创建服务定义文件">4 - 创建服务定义文件
&lt;/h3>&lt;p>为了简化本地测试，这里使用 docker-compose 工具。创建包含数据库服务和开发工具服务的 &lt;code>docker-compose.yml&lt;/code> 服务定义文件。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;3.1&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 使用 mysql 作为后端数据库&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">db&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mysql:5.7&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">devopschina_db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">always&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 用本地当前路径 sql 目录中的 sql dump文件初始化 MySQL 数据库&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">./sql:/docker-entrypoint-initdb.d/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 用这些环境变量初始化 mysql 数据库，创建目标数据库，创建用户和密码，为 root 用户初始化随机密码&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MYSQL_DATABASE&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;${DB}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MYSQL_USER&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;${DBU}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MYSQL_PASSWORD&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;${DBP}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MYSQL_RANDOM_ROOT_PASSWORD&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># PHPMyAdmin 数据库管理工具，只用于开发或者测试环境&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">phpmyadmin&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">phpmyadmin/phpmyadmin&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">devopschina_myphpadmin&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">always&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">PMA_HOST&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;${DBH}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">PMA_USER&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;${DBU}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">PMA_PASSWORD&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;${DBP}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">PMA_ARBITRARY&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">9999&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 使用 drupal 官方镜像 v9 ，指定 php 版本为 7.4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">drupal&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c">#image: drupal:9-php7.4-apache 这里以后需要优化为私有镜像名称，而不需要在服务启动的时候做任何构建&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">build&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">devopschina_drupal&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">always&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">9998&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">working_dir&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/opt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># 将当前项目目录加载到容器中，这里产生了一个和本机的依赖，后续优化：通过 Dockerfile 的复制当前开发目录中的成功到容器中&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># The &amp;#39;z&amp;#39; option tells Docker that the volume content will be shared between containers. Docker will label the content with a shared content label. Shared volumes labels allow all containers to read/write content. The &amp;#39;Z&amp;#39; option tells Docker to label the content with a private unshared label.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">.:/opt:z&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">HOST&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;${DBH}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">DBASE&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;${DB}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">USER&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;${DBU}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">PASS&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;${DBP}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># composer update 操作确保容器中的 Drupal 服务运行与当前的最新状态，这个操作也应该后续移植到Dockerfile 文件中&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bash -c &amp;#34;composer update &amp;amp;&amp;amp; rm /var/www/html &amp;amp;&amp;amp; ln -s /opt/web /var/www/html &amp;amp;&amp;amp; /usr/local/bin/apache2-foreground&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>相关测试命令：&lt;/p>
&lt;ul>
&lt;li>&lt;code>docker-compose config&lt;/code> 测试所有参数是否被完整且正确的填充，有错误的话，需要修改 .env 文件。&lt;/li>
&lt;li>&lt;code>docker-compose build&lt;/code> 构建必要的镜像。&lt;/li>
&lt;/ul>
&lt;h3 id="5---本地集成测试">5 - 本地集成测试
&lt;/h3>&lt;p>在本机测试和确认容器服务中 Drupal 网站的可用性和内容。&lt;/p>
&lt;p>在项目目录中，执行 &lt;code>docker-compose up&lt;/code> 命令观察整个启动过程，待启动停止后，在浏览器中访问：&lt;a class="link" href="http://localhost:9998" target="_blank" rel="noopener"
>http://localhost:9998&lt;/a> ，应该能够看到如下的网页。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-02-05-2022-02-05_23-04-12.png"
loading="lazy"
alt="Test Env home page"
>&lt;/p>
&lt;h2 id="在云平台部署社区官网">在云平台部署社区官网
&lt;/h2>&lt;p>下面是关于后续工作的一些规划：&lt;/p>
&lt;ul>
&lt;li>组件新的网站开发团队，召开项目启动会&lt;/li>
&lt;li>优化以上代码库&lt;/li>
&lt;li>用一台云主机搭建一个公共的测试环境&lt;/li>
&lt;li>确认和实施相关基础设施：镜像仓库、用于Drupal迁移的对象存储桶、优化容器化过程、启用一个用于开发评审的容器测试环境、确定生产环境的运行状态【LAMP单机 vs. 容器环境+其它云服务】&lt;/li>
&lt;/ul></description></item><item><title>HCI | 超融合平台线上训练营第一期</title><link>https://martinliu.cn/blog/hci-01-nutanix-ce-ahv-setup/</link><pubDate>Mon, 03 Jan 2022 18:19:20 +0800</pubDate><guid>https://martinliu.cn/blog/hci-01-nutanix-ce-ahv-setup/</guid><description>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-th1.jpg" alt="Featured image of post HCI | 超融合平台线上训练营第一期" />&lt;p>本期分享的内容是超融合的基础知识，Nutanix CE社区版AHV/KVM单节点集群的搭建。&lt;/p>
&lt;p>在本期线上直播中，我们给大家科普了超融合的基础概念，介绍了Nutanix CE社区版【AHV/Kvm虚拟化】的单机安装和基础配置。本文为大家回顾一下其中的技术要点。&lt;/p>
&lt;p>观看本次直播并且中奖的朋友们是：我是ZCQQQ、盔甲小子、繁硕星辰、壮星豆、flyinghourse110、YS8297和阿尔萨狮123，请联系微信 Jane-happylife 索取你的奖品。本次奖品是Nutanix提供的空气加湿器或者运动背包。备注 12月超融合直播活动 领取礼品。两种礼品（根据库存来决定随机寄出）。&lt;/p>
&lt;p>本期的视频回放链接在这里：&lt;a class="link" href="https://www.bilibili.com/video/BV1YY411a7w2/" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV1YY411a7w2/&lt;/a>&lt;/p>
&lt;h2 id="认识-hci-超融合">认识 HCI 超融合
&lt;/h2>&lt;p>来自网络的定义：超融合基础架构（Hyper Converged Infrastructure，或简称“HCI”）是指在同一套单元设备中不仅仅具备计算、 网络 、存储和服务器虚拟化等资源和技术，而且还包括备份软件、 快照技术 、重复数据删除、在线数据压缩等元素，而多套单元设备可以通过网络聚合起来，实现模块化的无缝横向扩展（scale-out），形成统一的资源池。&lt;/p>
&lt;p>从我个人角度看，我的对基于OpenStack的私有云持有消极的态度。虽然，OpenStack 给企业数据中心基础设施的建设路线带来了不小的影响；但是，它还是无法解决传统数据中心里经典的三层架构基础设施的三大根本痛点。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-%E5%B9%BB%E7%81%AF%E7%89%872.JPG"
loading="lazy"
>&lt;/p>
&lt;p>三层架构即由x86服务器层、网络层（以太网/SAN）和存储层所搭建的规模不大数量巨多的虚拟化/物理机集群资源池。由于虚拟化技术的成熟和普及，这些虚拟化集群资源池为业务应用提供了所需要的计算、存储和网络资源。在最近十几年的企业数据中心中处于主力架构，但是它有其核心的三大问题：&lt;/p>
&lt;ol>
&lt;li>性能瓶颈问题比较突出：当突发大量来自于网路的业务请求时，且处理它们需要大量的读写存储操作时，后台存储系统乃至SAN网络都将发生性能耗尽的瓶颈，存储延时剧增，等待时长暴增，还可能伴随大量读写操作失败。&lt;/li>
&lt;li>容量无法线性扩展：三层资源中的任何一层的资源容量耗尽后，都需要多个专业运维团队进行大量手工操作，才能进行物理量容量的扩容，扩容过程中很难实现业务服务的持续性，数据量大的时候甚至不得不面临很长的业务停机时间窗口。&lt;/li>
&lt;li>复杂性令运维和开发胆寒：虽然在虚拟化系统中，虚拟化技术可以提供资源层的HA/FT等功能，但是当业务出现宕机故障时，从应用到下层的硬件，从上到下排查的时候，所有相关团队都不得不全员上线救火，业务服务故障很难在这个复杂性极其高的系统中快速定位。服务质量水平命悬一线，而且SLA很难挽救。&lt;/li>
&lt;/ol>
&lt;p>超融合的理想是全面消除以上三个问题。超融合系统其实为三层架构做了减法，它对传统磁盘阵列的存储设备产生了颠覆性的冲击，它利用优化的网络分布式存储服务消除了传统架构中的存储层。它还利用自动化部署工具，极大的降低了虚拟化集群的搭建、升级和维护过程。HCI超融合系统的本身及其精简，非常好扩容和维护，而且可以实现容量和性能的同步线性按需增长。从云计算的五个基础特征来考察HCI技术栈，我个人觉得它比OpenStack更像是云计算。&lt;/p>
&lt;p>学习超融合技术栈也有很多种学习路径，动手搭建超融合系统无疑时最佳的方式。本期超融合视频中，我们选择的是免费版的Nutanix CE社区版。下面划出本期直播中的重要知识点。希望大家可以在自己的环境中开始超融合刷机之旅，当超融合成为你的一个日常工具的以后，你可能才会对HCI有更深的理解。&lt;/p>
&lt;h2 id="硬件选择">硬件选择
&lt;/h2>&lt;p>HCI系统是虚拟化、x86计算机、万兆以太网和超融合软件完美的组合。在你的工作环境中就存在着大量可用的机器，经过一定的挑选和准备之后，你就应该可以操练超融合技术了。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-%E5%B9%BB%E7%81%AF%E7%89%873.JPG"
loading="lazy"
>&lt;/p>
&lt;p>任何可以运行服务器虚拟化【esxi/kvm】软件的x86计算机都可以，最近10年以内采购的机器应该都可以适用。为了让其发挥应有的价值和意义，下面是一些建议选项：&lt;/p>
&lt;ul>
&lt;li>最低配置：cpu 桌面机 i5/i7级别起步，4个物理核，或更高配置；服务器推荐E3/E5的多核处理器起步，或者更优CPU；内存32 GB，或更多。&lt;/li>
&lt;li>建议配置：cpu尽量选择双路E5级别，或更新的CPU；单机内存建议128GB，或更多，或者按需增加。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-%E5%B9%BB%E7%81%AF%E7%89%874.JPG"
loading="lazy"
>&lt;/p>
&lt;p>磁盘选择是超融合系统的重点之一，通常包括SSD和机械磁盘，它是组成分布式存储服务的基础。对于使用RAID卡的服务器，RAID卡上需要删除所有盘的任何RAID配置，确保所有磁盘都直通给主板，SATA接口的主板，请直接按照先后顺序，先连接SSD磁盘，后连结机械盘。&lt;/p>
&lt;ul>
&lt;li>最低配置：单机配置1块64GB SSD用于运行虚拟化软件（U盘-8/16GB也可以，但不建议），250GB SSD 一块或两块，用于安装和运行超融合软件，这是HCI的核心，它往往是以一个虚拟机的形式存在的，该虚拟机会完全运行在SSD上，SSD上的剩余空间计算在分布式存储池的全局空间中，SSD对虚拟机起到了重要的加速功能。机械磁盘一块或者多块，用于提供廉价大量的存储空间，机械磁盘的存储容量和SSD一起计入存储池的空间中。对于纯软件测试目的机械硬盘可以不要。SSD是必须的。机械盘是可选的。推荐混合使用，从而实现性能和空间的鱼和熊掌兼得。&lt;/li>
&lt;li>建议配置：单机配置1块64GB SSD用于运行虚拟化软件，两块1TB的SSD用于运行超融合软件，且为全局存储池提供足够的高速性能SSD存储空间。两块2TB机械硬盘起步，机械盘后续还可以按需添加。集群中所有计算机上的所有SSD和机械磁盘共同组成了统一的混合型存储层。每个虚拟机都可以访问到所有磁盘中的性能和空间。Nutanix CE版文档声称支持总共四块磁盘，但是社区中也有朋友分享6+块盘的正常工作案例。&lt;/li>
&lt;/ul>
&lt;p>网络的选择有以下注意事项：&lt;/p>
&lt;ul>
&lt;li>最低配置：单节点配置至少一个千兆网口，对于单机的超融合系统而言，Nutanix也可以利用到基本上大部分优势功能，包括：运行虚拟机、为虚拟机提供混合盘组成的存储空间、单节点上双副本的数据可靠性等等，我曾长期运行在这个配置上。&lt;/li>
&lt;li>建议配置：一块双口万兆网卡，一个万兆网口用于集群内的存储网络流量，另外一个用于虚拟机中应用的相互网络访问，用VLAN隔离两个网段的流量。测试的目的下，可以混合在一个具备Internet访问条件的网段中。&lt;/li>
&lt;li>建议优化配置：两块双口万兆网卡，一块双口千兆网卡，用于对网络流量、高可用性和性能的进一步优化，这里先不做展开。&lt;/li>
&lt;/ul>
&lt;p>网络交换机的选择，Nutanix CE免费版支持1、3、4节点的搭建模式。单节点没有特殊要求，多节点情况下，现场需要具备至少一台万兆以太网交换机和一台千兆以太网交换机。并且做相应的VLAN准备。&lt;/p>
&lt;h2 id="准备工作">准备工作
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-%E5%B9%BB%E7%81%AF%E7%89%875.JPG"
loading="lazy"
>&lt;/p>
&lt;p>必须在 &lt;a class="link" href="https://next.nutanix.com" target="_blank" rel="noopener"
>https://next.nutanix.com&lt;/a> 注册社区账号，记录登录邮箱和密码备用。访问 &lt;a class="link" href="https://next.nutanix.com/discussion-forum-14/download-community-edition-38417" target="_blank" rel="noopener"
>Download Community Edition | Nutanix Community&lt;/a> 这个帖子，下载 Installer ISO &lt;a class="link" href="https://download.nutanix.com/ce/2020.09.16/ce-2020.09.16.iso" target="_blank" rel="noopener"
>https://download.nutanix.com/ce/2020.09.16/ce-2020.09.16.iso&lt;/a> 。将这个ISO文件刻录在启动U盘中。安装前确保网线已经连结正常，且能访问Internet。&lt;/p>
&lt;p>Nutanix CE安装文件也可以在这个网盘中下载：链接：&lt;a class="link" href="https://pan.baidu.com/s/1DdvvfcPhcpR1jkfrXhCraA" target="_blank" rel="noopener"
>https://pan.baidu.com/s/1DdvvfcPhcpR1jkfrXhCraA&lt;/a> 提取码：4dgc&lt;/p>
&lt;h2 id="安装过程">安装过程
&lt;/h2>&lt;p>Nutanix CE版的安装可能会持续1小时左右，过程中包含比较多的自动化操作流程，基本需要用户少量的输入操作，其他更多的是等待时间。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-%E5%B9%BB%E7%81%AF%E7%89%876.JPG"
loading="lazy"
>&lt;/p>
&lt;p>下面是必须要关注的注意事项，相当于checklist：&lt;/p>
&lt;ol>
&lt;li>在主板BIOS的启动模式选项中，设置为legacy模式，其他模式不支持。&lt;/li>
&lt;li>在BIOS中确认能看到所有磁盘。&lt;/li>
&lt;li>插入一个桌面版 Linux Live CD U盘（如fedora 35），或者Win PE启动U盘，先设置从这个U盘启动。&lt;/li>
&lt;li>用Linux Live CD中的图形化磁盘分区工具，检查所有磁盘的空间，SMART信息，如果磁盘已经可见的老化或者错误，就替换掉在进行后续的装机。删除掉所有磁盘中的分区。重启。&lt;/li>
&lt;li>插入Nutanix CE社区版安装U盘。开始正式的刷机流程。&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-disk.png"
loading="lazy"
>&lt;/p>
&lt;p>选项介绍：&lt;/p>
&lt;ul>
&lt;li>选中 AHV - 即Nutnaix版本的KVM的虚拟化软件。&lt;/li>
&lt;li>按顺序选中：服务器虚拟化 Hpyervisor 的SSD盘，CVM的SSD盘，和做数据空间用的机械磁盘。&lt;/li>
&lt;li>Host ip ： 物理机运行虚拟化所在网段IP&lt;/li>
&lt;li>CVM ip：超融合软件运行的网段IP，必须通Internet。&lt;/li>
&lt;li>不要选则创建单节点集群选项。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-license.png"
loading="lazy"
>&lt;/p>
&lt;p>阅读完用户许可证全文后，选中接受，并且点击开始。Nutanix CE是一个裁剪版本有限制的软件，本文建议用于开发测试环境。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-hypervisor.png"
loading="lazy"
>&lt;/p>
&lt;p>开始了物理机的虚拟化的安装，然后自动开始CVM的安装，CVM是一个虚拟机软件，会被自动启动和部分初始化。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-end.png"
loading="lazy"
>&lt;/p>
&lt;p>最后，安装成功的话，拔出U盘，重启服务器。如果是多节点安装，每个节点都需重复这个过程，注意提前规划好Host Ip和CVM Ip的网段。&lt;/p>
&lt;h2 id="初始化配置">初始化配置
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-%E5%B9%BB%E7%81%AF%E7%89%8711.JPG"
loading="lazy"
>&lt;/p>
&lt;p>在安装完第一次重启的过程中，我们需要一些等待时间，逐步确认超融合系统的充分就绪，一下每个步骤必须顺序进行，不可跳跃进行：&lt;/p>
&lt;ol>
&lt;li>ssh 登录 host 的ip 地址，root 的默认密码是 nutanix/4u ；登录后，使用hostname 命令查看并记录主机名，运行 virsh list 命令观察 cvm虚拟机的运行状态。&lt;/li>
&lt;li>ssh 登录 cvm 的 ip 地址，默认用户名 nutanix ， 密码 是 nutanix/4u ；登陆后，使用 hostname 命令确认是否变为了 host的主机名+ -cvm 这样的名字，如果看到的是一个 cvm 的ip 地址，什么也不要做。等cvm第一次重启后，在此登录确认主机名。&lt;/li>
&lt;li>在cvm 中执行 ping qq.com 命令，确保和internet的互联。&lt;/li>
&lt;li>在cvm 中执行 genesis status 命令，如果过输出是持续报错信息，就等待错信息的停止，最后正常的输出应该是若干行服务的名称和端口号。&lt;/li>
&lt;li>执行 cluster status 命令，如果过输出是持续报错信息，就等待错信息的停止，知道最后一行显示本系统中还没有被配置，需要创建集群。&lt;/li>
&lt;li>执行超融合集群的创建命令， cluster -s 192.168.1.20 create ； 这里是创建单节点集群，ip地址就是当前cvm的ip地址。等待这条命令初始化集群完毕后，可以看到Nutanix超融合系统的所有服务状态清单。&lt;/li>
&lt;/ol>
&lt;p>多节点（3/4）节点 AHV 集群的搭建说明:&lt;/p>
&lt;ol>
&lt;li>重复以上的安装过程三次或者四次&lt;/li>
&lt;li>确保每个计算机上的cvm都处于 cluster status 输出信息正确一致的状态&lt;/li>
&lt;li>在每个 cvm上ping 其它邻居cvm的ip，确保网络畅通。&lt;/li>
&lt;li>在其中一个cvm的命令行执行多节点集群创建命令： cluster -s 192.168.1.20,192.168.1.22,192.168.1.24 create 。该命令的正确结果是，每个cvm上的集群服务状态信息。&lt;/li>
&lt;/ol>
&lt;p>最后，在cvm上使用 cluster status 命令，确认所有节点的所有服务都正常运行了以后，继续登录超融合系统的网页图像界面。&lt;/p>
&lt;h2 id="集群使用基础">集群使用基础
&lt;/h2>&lt;p>顺序只需一下基础的配置和功能操作。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-%E5%B9%BB%E7%81%AF%E7%89%8713.JPG"
loading="lazy"
>&lt;/p>
&lt;ol>
&lt;li>在浏览器中访问任一cvm的ip地址，使用默认用户名 admin 密码 nutanix/4u登录，立刻会让你修改 admin 的默认密码，使用并记录这个新密码备用。&lt;/li>
&lt;li>用新密码登录。&lt;/li>
&lt;li>在要求输入Next 账号的地方，输入前面注册好的 Nutanix 论坛的邮箱和密码。&lt;/li>
&lt;li>成功登录后，你可以看到超融合的初始化界面，观察第一个关键信息点，观察左上方的第二个信息块，这里的显示的是存储池的物理和逻辑容量。如果这个数据没有立刻显示出来，那么表明该节点存在的某种问题，但是这不表明它不能用于多节点集群的创建。我有三个计算机时这种情况，单节点初始化失败的计算机在多节点集群的创建中反而没有问题。&lt;/li>
&lt;li>在右上角的配置菜单中，选中镜像访问 image service ，在哪里上传一个准备好的 iso，img 或者 qcow2 文件。等待几分钟后，每个文件应该即处于就绪使用的active 状态。&lt;/li>
&lt;li>在网络配置中创建一个用于虚拟机运行的网络。&lt;/li>
&lt;li>创建空白的虚拟机，挂在iso文件，并且开始虚拟机的安装。&lt;/li>
&lt;li>创建空白虚拟机，创建基于img 或者 qcow2虚拟机模板文件的磁盘，开机后即可使用。&lt;/li>
&lt;/ol>
&lt;h2 id="参考成本">参考成本
&lt;/h2>&lt;p>我个人喜欢在本地运行很多虚拟机的测试环境，属于 self-host 粉。我的虚拟机数量逐渐增加。从一个Intel NUC的单机微型测试机。 到单机联想工作站（双路E5CPU），到现在新增了两个某宝的组装兼容机，最后组成了三节点的Nutanix 超融合集群【vSphere 虚拟化】。个人实现多节点超融合集群的必要性因人而异，这里只是告诉大家，使用Nutanix CE在这些机器上是可行的。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-%E5%B9%BB%E7%81%AF%E7%89%871.JPG"
loading="lazy"
>&lt;/p>
&lt;p>下面是网购订单的统计信息，希望对于想自行攒机的朋友，或者对扩容利旧服务器的朋友有些帮助。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-2021-12-29_12-32-49.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="下期预告">下期预告
&lt;/h2>&lt;p>HCI系统的搭建还有很多问题值得一起探讨和学习，HCI超融合系统软件还有很多功能可以学习了解。我们为DevOps社区的朋友们新开辟了这个HCI板块，希望以后会每个月为大家输出一期新的内容。下期直播的简介如下：&lt;/p>
&lt;ol>
&lt;li>日期：2022年1月26日中午1点&lt;/li>
&lt;li>内容1：Nutanix CE版AHV安装答疑解惑&lt;/li>
&lt;li>内容2：VMware vSphere 集群的搭建&lt;/li>
&lt;li>主持人：刘征，吴孔辉&lt;/li>
&lt;li>直播平台：B站搜/关注：中国DevOps社区&lt;/li>
&lt;li>直播抽奖：未知&lt;/li>
&lt;li>报名：互动吧搜/关注：中国DevOps社区&lt;/li>
&lt;/ol>
&lt;h2 id="其他">其他
&lt;/h2>&lt;p>HCI超融合技术对于了解它的人来说很火热，但是还有很多不太了解HCI的人；HCI的用户对它也有不同的使用场景和期望。请大家参与这个《中国超融合状态调查》，我们每月为参与本调查的朋友进行抽奖，抽奖结果在下次直播的时候公布。扫码参与调查。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-dc.png"
loading="lazy"
>&lt;/p>
&lt;p>我们为希望学习HCI技术的朋友们创建了一个qq群，希望可以给大家带来一定帮助。扫码加入我们的QQ群。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2022-01-04-qq.png"
loading="lazy"
>&lt;/p></description></item><item><title>删除Cisco交换机中的所有VLAN数据</title><link>https://martinliu.cn/blog/delete-all-vlan-from-cisco-switch/</link><pubDate>Tue, 09 Nov 2021 12:58:16 +0800</pubDate><guid>https://martinliu.cn/blog/delete-all-vlan-from-cisco-switch/</guid><description>&lt;img src="https://martinliu.cn/img/cos/2021-11-09-bigstock-network-hub-and-patch-cables-12234593-1.jpeg" alt="Featured image of post 删除Cisco交换机中的所有VLAN数据" />&lt;p>最近在闲鱼上收了几台网络设备，其中有一台Cisco 3560X作为lab的核心交换机，其它一些都是用于练习网络运维。本文从清除老旧设备上的vlan开始，将会记录我在这些网络设备上的所有重要配置操作。&lt;/p>
&lt;h2 id="网络设备的初始化">网络设备的初始化
&lt;/h2>&lt;h3 id="cisco-交换机">Cisco 交换机
&lt;/h3>&lt;p>Cisco 3560 的初始化是非常容易和方便的，这是一台非常新的设备，拆机后，机箱内部都没有什么积累明显的灰尘。第一次开机的时候通过mini USB口的连线连接，登陆console后发现需要密码才能进入enable模式，然后不得不重置这个设备的所有配置。&lt;/p>
&lt;ul>
&lt;li>在交换机开机的情况下，先用mini USB连接好电脑和交换机。&lt;/li>
&lt;li>拔掉交换机的电源线&lt;/li>
&lt;li>按住交换机前面板，左上角的mode按钮不放&lt;/li>
&lt;li>插上交换机电源线&lt;/li>
&lt;li>保持mode按钮10+秒以上&lt;/li>
&lt;li>看着交换机正常启动，并且进入了快速配置模式&lt;/li>
&lt;li>选择进入快速配置模式，或者选择no，进入正常无向导的手工配置模式&lt;/li>
&lt;/ul>
&lt;p>到此处为止，你就进入了一个无密码，几乎无配置的状态。虽然现在这是一台几乎空白配置的交换机。但是交换机的文件系统里还是有一个名为vlan.dat的数据文件。这个文件是之前这个交换机的管理员留下的。有了他的存在当你当你执行 ‘ show vlan brief ’ 命令的时候，这个数据文件中的vlan数据有近百行，滚动了半天，非常烦人。因此需要想办法将其删除。&lt;/p>
&lt;h4 id="清除vlan数据文件">清除VLAN数据文件
&lt;/h4>&lt;p>参考文章：&lt;a class="link" href="https://www.networkstraining.com/deleting-the-vlan-database-from-a-cisco-switch/" target="_blank" rel="noopener"
>https://www.networkstraining.com/deleting-the-vlan-database-from-a-cisco-switch/&lt;/a>&lt;/p>
&lt;p>首先查看flash上有哪些文件，使用命令 &lt;code>show flash&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sw-bj-01#show flash:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Directory of flash:/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 10 -rwx 4371 Jan 2 2006 23:55:34 +00:00 config.text
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 -rwx 26945536 Aug 31 2018 10:01:56 +00:00 c3560e-universalk9-mz.152-4.E6.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 -rwx 26844160 Feb 28 2019 05:02:21 +00:00 c3560e-universalk9-mz.152-4.E7.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 -rwx 0 Mar 27 2019 18:36:06 +00:00 merge_config.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 5 -rwx 6168 Jan 2 2006 23:55:34 +00:00 multiple-fs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6 -rwx 2915 Jan 2 2006 00:02:10 +00:00 config.old
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 8 -rwx 27468 Mar 27 2019 18:36:05 +00:00 candidate_config.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 9 -rwx 736 Jan 2 2006 00:08:27 +00:00 vlan.dat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 11 -rwx 3835 Jan 2 2006 23:55:34 +00:00 private-config.text
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">57671680 bytes total (3395584 bytes free)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面的命令结果中的倒数第二行就是用来保存vlan信息的文件。然后我们使用 &lt;code>delete vlan.dat&lt;/code> 命令将其删除即可。然后使用 &lt;code>copy running-config startup-config&lt;/code> 保存当前的战果。还可以使用 reload 重启一下交换机，再次登陆交换机之后使用 show vlan brief 命令校验当前的交换机上只有默认的6个vlan存在。&lt;/p>
&lt;h4 id="启用-ssh-和-web-登陆">启用 ssh 和 web 登陆
&lt;/h4>&lt;p>每次都适用console线连接并配置交换机？这样还是有点麻烦的，我们需要启用交换机的管理ip和ssh登陆这样以后就可以从网络配置了。以后就可以用Ansible之类的DevOps工具玩NetOps了。配置过程的主要命令如下：&lt;/p>
&lt;ol>
&lt;li>配置管理ip， 参考命令如下：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># ip default-gateway 192.168.101.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># interface vlan 101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-if)# ip address 192.168.101.2 255.255.255.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="2">
&lt;li>主机名， 参考命令如下：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># config t
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config)# hostname myswitch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config)# ip domain-name thegeekstuff.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="3">
&lt;li>创建 RSA 密钥，用于启用ssh登陆，参考命令如下&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">myswitch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1"># crypto key generate rsa&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">The&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">keys&lt;/span> &lt;span class="n">will&lt;/span> &lt;span class="n">be&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">myswitch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">thegeekstuff&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Choose&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">size&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="n">modulus&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="nb">range&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="mi">360&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="mi">2048&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">your&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">General&lt;/span> &lt;span class="n">Purpose&lt;/span> &lt;span class="n">Keys&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Choosing&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="n">modulus&lt;/span> &lt;span class="n">greater&lt;/span> &lt;span class="n">than&lt;/span> &lt;span class="mi">512&lt;/span> &lt;span class="n">may&lt;/span> &lt;span class="n">take&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="n">few&lt;/span> &lt;span class="n">minutes&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">How&lt;/span> &lt;span class="n">many&lt;/span> &lt;span class="n">bits&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">modulus&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">512&lt;/span>&lt;span class="p">]:&lt;/span> &lt;span class="mi">1024&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%&lt;/span> &lt;span class="n">Generating&lt;/span> &lt;span class="mi">1024&lt;/span> &lt;span class="n">bit&lt;/span> &lt;span class="n">RSA&lt;/span> &lt;span class="n">keys&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">keys&lt;/span> &lt;span class="n">will&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">non&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exportable&lt;/span>&lt;span class="o">...&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">OK&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="4">
&lt;li>配置一些 Line VTY 和 console 的参数&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># line vty 0 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-line)# transport input ssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-line)# login local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-line)# password mypassword
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-line)# exit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># line console 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-line)# logging synchronous
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(config-line)# login local
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="5">
&lt;li>设置用户名和密码&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">myswitch# config t
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter configuration commands, one per line. End with CNTL/Z.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">myswitch(config)# username myusername password mypassword
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果你还没有配置enable的密码可以参考下面的命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">myswitch# enable secret myenablepassword
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">myswitch# service password-encryption
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="6">
&lt;li>校验 ssh 访问&lt;/li>
&lt;/ol>
&lt;p>使用命令如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">myswitch# sh ip ssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SSH Enabled - version 1.99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Authentication timeout: 120 secs; Authentication retries: 3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>现在你可以用网络上的电脑测试ssh登陆这个交换机的ip了。&lt;/p>
&lt;h3 id="cisco-路由器">Cisco 路由器
&lt;/h3>&lt;p>待完成&lt;/p>
&lt;h3 id="cisco-防火墙">Cisco 防火墙
&lt;/h3>&lt;p>待完成&lt;/p>
&lt;p>&amp;mdash;- 未完待续 &amp;mdash;-&lt;/p></description></item><item><title>2021 年 Stackoverflow 开发者状态调查报告-中文版</title><link>https://martinliu.cn/blog/stackoverflow-survey-2021-cn/</link><pubDate>Fri, 13 Aug 2021 18:29:57 +0800</pubDate><guid>https://martinliu.cn/blog/stackoverflow-survey-2021-cn/</guid><description>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-134055.jpg" alt="Featured image of post 2021 年 Stackoverflow 开发者状态调查报告-中文版" />&lt;p>从开发者画像、技术流行趋势、工作就业和薪酬状态和社区等方面完整的描述了当今开发者的众生相。虽然调查人数有限，只有中国开发者人数的十分之一，但是也基本上反应了欧美发达国家的开发者现状。&lt;/p>
&lt;h2 id="概述">概述
&lt;/h2>&lt;p>我们在年度调查中提出的问题将帮助我们改善Stack Overflow社区和为他们服务的平台。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-134055.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.29.09 PM"
>&lt;/p>
&lt;p>例如，今年，我们观察到开发人员教育自己的方式发生了重大演变。对于年龄在18岁以下的不断增长的编码者来说，像视频和博客这样的在线资源比书本和学校加起来还要受欢迎，这一统计数字在我们其他年龄组中并不成立。总的来说，这个行业充满了新加入者，超过50%的人表示他们从事编码工作不到十年，超过35%的人从事这个行业不到五年。&lt;/p>
&lt;h3 id="快速预览">快速预览
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-134349.jpg"
loading="lazy"
alt="WechatIMG1606"
>&lt;/p>
&lt;p>1） 毫不奇怪，几乎60%的受访者是从网上资源学习如何编码的。年轻的受访者倾向于从在线课程、论坛和其他在线资源中学习。另一方面，年长的受访者则从学校和书本等更传统的媒介中学习。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-134246.jpg"
loading="lazy"
alt="WechatIMG1607"
>&lt;/p>
&lt;p>2）AWS保持其作为最广泛使用的云平台的领先地位，但谷歌云和微软Azure比去年有了很大的进步。值得注意的是，今年是我们将云平台从一般平台问题中分离出来的第一年。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-134316.jpg"
loading="lazy"
alt="WechatIMG1608"
>&lt;/p>
&lt;p>3）今年，React.js超过了jQuery，成为最常使用的Web框架。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-134315.jpg"
loading="lazy"
alt="WechatIMG1609"
>&lt;/p>
&lt;p>4）新来的Svelte占据了最受喜爱的框架的首位。React是最受欢迎的，有四分之一的开发者想要使用。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-134314.jpg"
loading="lazy"
alt="WechatIMG1610"
>&lt;/p>
&lt;p>5）Perl从去年的最高薪语言变成了今年的第五高薪。Clojure开发者的工资中位数最高，比第二名的F#多出1.4万。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-134317.jpg"
loading="lazy"
alt="WechatIMG1611"
>&lt;/p>
&lt;p>6）81%的专业开发人员是全职雇员，比2020年的83%有所下降。表示自己是独立承包商、自由职业者或自营职业者的专业开发人员比例从2020年的9.5%增加到2021年的11.2%&amp;ndash;表明潜在的工作不安全或转向更灵活的工作安排。&lt;/p>
&lt;p>我们面临的挑战和机遇是继续扩大和提高我们帮助所有开发人员的能力，并使他们在我们的社区感到受欢迎。&lt;/p>
&lt;p>继续阅读，了解更多关于塑造当今软件技艺和实践的态度、工具和环境的重大洞见。&lt;/p>
&lt;h2 id="开发者画像">开发者画像
&lt;/h2>&lt;p>我们对全球开发者社区的认知。&lt;/p>
&lt;h3 id="主要地区">主要地区
&lt;/h3>&lt;p>Stack Overflow 是服务于国际的社区，我们的调查收到了来自地球上几乎所有国家的回复。&lt;/p>
&lt;h4 id="地域">地域
&lt;/h4>&lt;p>美国和印度继续提供最高数量的调查回应，其次是德国和UKI（英国和爱尔兰）。前十名的国家几乎占了所有答复者的60%。要查看前十名的国家，请参考方法论部分。当我们放大到美国（我们回应最多的国家）时，我们看到，拥有成熟的科技中心的州拥有最多的回应者。加州、纽约、华盛顿和德克萨斯。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135238.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.52.15 PM"
>&lt;/p>
&lt;h3 id="经验">经验
&lt;/h3>&lt;p>高级管理人员和经理往往有最多年的编码经验，而从事数据科学和机器学习的人往往有最少的编码经验，平均来说甚至比学术研究人员还少。&lt;/p>
&lt;h4 id="何时写下第一行代码">何时写下第一行代码？
&lt;/h4>&lt;p>编码者从年轻时就开始了：有超过50%的受访者在11至17岁之间编写了他们人生的第一行代码。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135333.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 8.55.47 PM"
>&lt;/p>
&lt;h4 id="如何学习编码">如何学习编码？
&lt;/h4>&lt;p>毫不奇怪，几乎60%的受访者都是通过网上的资源，来学习如何编码的。年轻的受访者倾向于从在线课程、论坛和其他在线资源中学习。另一方面，年长的受访者则从学校和书本等更传统的媒介中学习。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135357.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 8.56.00 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135515.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 8.56.26 PM"
>&lt;/p>
&lt;h4 id="编码年限">编码年限？
&lt;/h4>&lt;p>50%的受访者从事编码工作的时间在十年以内。来自英国的受访者，平均而言，在我们前十个国家中，拥有的编码经验年数最多。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135540.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 8.56.48 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135555.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 8.56.58 PM"
>&lt;/p>
&lt;h4 id="专业编码年限">专业编码年限？
&lt;/h4>&lt;p>大多数受访者以专业开发人员的身份工作的年限为十年或更短，这意味着他们从未在没有Stack Overflow的世界里工作过【译者注：这句话说的 有点感觉StackOverflow的人自我感觉非常好：），难道说非专业人士们离开了 stack overflow 就不会搬砖了么，哈哈：） 】。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135629.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 8.57.11 PM"
>&lt;/p>
&lt;h4 id="按不同开发者类型划分的专业编码经验年数">按不同开发者类型划分的专业编码经验年数？
&lt;/h4>&lt;p>担任更高级职务的开发人员拥有最多年的专业编码经验。同时，数据科学家和机器学习专家的经验最少，比学术研究人员的年限少。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135723.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 8.57.39 PM"
>&lt;/p>
&lt;h3 id="开发者角色">开发者角色
&lt;/h3>&lt;p>担任全栈开发人员角色的人是最普遍的。有趣的是，设计师的角色自去年以来有所下降，与系统管理员的位置互换。&lt;/p>
&lt;h4 id="开发者类型">开发者类型?
&lt;/h4>&lt;p>全栈、后端、前端和桌面开发人员仍然占所有受访者的大多数。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135815.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 8.58.24 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135829.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 8.58.38 PM"
>&lt;/p>
&lt;h3 id="教育程度">教育程度
&lt;/h3>&lt;p>开发人员是一个受过高等教育的群体，超过65%的人拥有学士学位或更高学历。但是，传统的大学教育并不代表一切，大约四分之一的受访者拥有低于学士学位的学历。&lt;/p>
&lt;h4 id="受教育程度">受教育程度?
&lt;/h4>&lt;p>70%的受访者和80%的专业开发人员完成了某种形式的高等教育，学士学位是最常见的。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135853.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 8.59.05 PM"
>&lt;/p>
&lt;h3 id="人员统计">人员统计
&lt;/h3>&lt;p>大约有三分之一的受访者回答了我们关于心理健康的问题。这是在2020年提供反馈的比例的两倍，这可能反映了人们对心理健康的重要性和正在进行的大流行病的影响的认识在不断提高。&lt;/p>
&lt;h4 id="年龄">年龄？
&lt;/h4>&lt;p>48%的专业开发者是25-34岁。65岁或以上的受访者中，几乎有一半不认为自己是专业开发者。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135939.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 8.59.43 PM"
>&lt;/p>
&lt;h4 id="性别">性别？
&lt;/h4>&lt;p>91%的受访者和92%的专业开发人员认为自己是男性。美国的性别少数群体（女性、非二进制、变性人或性别不符者）的比例最高。我们有相当多的工作要做，以确保我们的平台具有包容性，并确保我们的调查能代表各地的开发者。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-135954.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 8.59.58 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140007.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.00.22 PM"
>&lt;/p>
&lt;h4 id="变性人">变性人？
&lt;/h4>&lt;p>只有1%的受访者认为自己是变性人，其中一半是专业开发人员。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140028.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.00.38 PM"
>&lt;/p>
&lt;h4 id="性取向">性取向？
&lt;/h4>&lt;p>11.5%的受访者认为自己是直男/异性恋以外的人，6.5%的人倾向于不认同任何取向。要确保开发商社区更具包容性，仍有许多工作要做。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140044.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.00.51 PM"
>&lt;/p>
&lt;h4 id="种族和族裔">种族和族裔？
&lt;/h4>&lt;p>我们继续看到有证据表明，有色人种在专业开发人员中的代表性不足。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140055.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.01.28 PM"
>&lt;/p>
&lt;h4 id="残疾状况">残疾状况？
&lt;/h4>&lt;p>2,960名受访者有身体上的差异，这些受访者大多数是盲人或有视力障碍。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140114.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.01.45 PM"
>&lt;/p>
&lt;h4 id="心理健康">心理健康？
&lt;/h4>&lt;p>超过16,000名受访者回答了我们关于心理健康的问题，其中近10%的受访者表示他们有焦虑症。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140123.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.02.11 PM"
>&lt;/p>
&lt;h2 id="技术">技术
&lt;/h2>&lt;p>每年，我们都会探索开发人员目前正在使用的工具和技术。而且，像往常一样，我们问他们什么技术是最喜欢的、最害怕的和最想要的，包括几个类别。&lt;/p>
&lt;p>今年，我们还引入了一个新的部分，即 &amp;ldquo;使用过的与想要使用的&amp;rdquo;，它向我们准确地展示了开发者在过去一年中使用了什么，以及他们希望在下一年中使用什么。如果你需要复习一下我们是如何构建 &amp;ldquo;喜爱&amp;rdquo;、&amp;ldquo;害怕 &amp;ldquo;和 &amp;ldquo;想要 &amp;ldquo;的，或者你想读一下 &amp;ldquo;用过 &amp;ldquo;与 &amp;ldquo;想要用 &amp;ldquo;背后的直觉，请查看我们&lt;a class="link" href="https://meta.stackoverflow.com/questions/410519/what-is-worked-with-vs-want-to-work-with-in-the-developer-survey-results" target="_blank" rel="noopener"
>这篇元文章&lt;/a>。&lt;/p>
&lt;h3 id="最流行的技术">最流行的技术
&lt;/h3>&lt;p>Python超过了SQL，成为我们第三大最受欢迎的技术，而Node.JS则升至第六大最受欢迎的技术。&lt;/p>
&lt;h4 id="编程脚本和标记语言">编程、脚本和标记语言？
&lt;/h4>&lt;p>JavaScript连续九年完成了作为最常用的编程语言的任务。对于大多数开发者来说，编程就是网络编程。Python与SQL交换了位置，成为第三种最受欢迎的语言。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140323.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.04.15 PM"
>&lt;/p>
&lt;h4 id="数据库">数据库
&lt;/h4>&lt;p>所有受访者和专业开发者之间最常用的数据库是一致的。我们观察到的唯一区别是，专业开发者使用Microsoft SQL Server的可能性略高于MongoDB。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年中，你在哪些数据库环境中做了大量的开发工作，你想在下一年中在哪些环境中工作？&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->(如果你既在数据库中工作，又想继续这样做，请在该行的两个框中都打勾)。&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140356.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.04.34 PM"
>&lt;/p>
&lt;h4 id="云平台">云平台
&lt;/h4>&lt;p>AWS保持其作为最广泛使用的云平台的领先地位，但谷歌云和微软Azure比去年有了很大的进步。值得注意的是，今年是我们将云平台从一般平台问题中分离出来的第一年。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年里，你在哪些云平台上做了大量的开发工作，以及在未来一年里你想在哪些云平台上工作？&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>(如果你既在该平台上工作过，又想继续这样做，请在该行的两个方框内打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140415.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.04.48 PM"
>&lt;/p>
&lt;h4 id="web-框架">Web 框架
&lt;/h4>&lt;p>今年，React.js超过了jQuery，成为最常用的网络框架。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年中，你在哪些网络框架和库中做了大量的开发工作，以及你想在下一年中从事哪些工作？&lt;!-- raw HTML omitted -->
(如果你既使用过该框架，又想继续使用，请在该行的两个方框内打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140446.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.05.01 PM"
>&lt;/p>
&lt;h4 id="其他框架和库">其他框架和库
&lt;/h4>&lt;p>在其他技术中，.NET框架得到了最多的喜爱，尽管有几个用于Python的数据科学库表现强劲。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年中，你在哪些其他框架和库中做了大量的开发工作，以及你想在下一年中从事哪些工作？&lt;!-- raw HTML omitted -->
(如果你既在框架中工作过，又想继续这样做，请在该行的两个框中都打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140511.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.05.19 PM"
>&lt;/p>
&lt;h4 id="其他工具">其他工具
&lt;/h4>&lt;p>超过90%的受访者使用Git，这表明它是作为一个开发者的基本工具。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年中，你在哪些工具中做了大量的开发工作，以及在未来一年中你想在哪些工具中工作？&lt;!-- raw HTML omitted -->
(如果你既使用了该技术，又想继续使用，请在该行的两个框中都打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140528.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.05.44 PM"
>&lt;/p>
&lt;h4 id="集成开发环境">集成开发环境
&lt;/h4>&lt;p>作为所有开发者的首选IDE，Visual Studio Code具有显著的领先优势。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年中，你经常使用哪些开发环境，以及你希望在未来一年中使用哪些开发环境？&lt;!-- raw HTML omitted -->
请勾选所有适用的。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140540.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.06.02 PM"
>&lt;/p>
&lt;h4 id="操作系统">操作系统
&lt;/h4>&lt;p>Windows仍然是最受欢迎的操作系统，尽管在专业开发者中略显逊色。今年也是我们第一次将WSL作为一个选项。&lt;/p>
&lt;p>你工作的主要操作系统是什么？&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140553.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.06.15 PM"
>&lt;/p>
&lt;h3 id="最爱最敬畏最想用的">最爱、最敬畏、最想用的
&lt;/h3>&lt;p>Rust是最受喜爱的语言。Python和Typescript是开发者最想使用的语言，如果他们还没有这样做的话。&lt;/p>
&lt;h4 id="编程脚本和标记语言-1">编程、脚本和标记语言
&lt;/h4>&lt;p>在第六年中，Rust是最受喜爱的语言，而Python则是其第五年（去年的报告显示）最想要的语言。&lt;/p>
&lt;p>在过去一年中，你用哪些编程、脚本和标记语言做了大量的开发工作，以及你想在未来一年中用哪些语言工作？&lt;/p>
&lt;p>(如果你既用该语言工作，又想继续这样做，请在该行的两个方框内打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140732.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.07.15 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140804.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.07.43 PM"
>&lt;/p>
&lt;h4 id="数据库-1">数据库
&lt;/h4>&lt;p>Redis成为最受喜爱的数据库已经是第五年了。PostgreSQL以不到1%的比例勉强超过MongoDB成为最受欢迎的数据库。而IBM DB2则连续第二年成为最令人畏惧的数据库。&lt;/p>
&lt;p>在过去的一年中，你在哪些数据库环境中做了大量的开发工作，以及在未来一年中你想在哪些数据库中工作？
(如果你既在数据库中工作过，又想继续这样做，请在该行的两个框中都打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140821.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.08.09 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140834.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.08.19 PM"
>&lt;/p>
&lt;h4 id="云平台-1">云平台
&lt;/h4>&lt;p>AWS不仅是最受欢迎的云平台，也是最受欢迎的云平台，处于领先地位。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年中，你在哪些云平台上做了大量的开发工作，以及你想在未来一年中在哪些云平台上工作？&lt;!-- raw HTML omitted -->
(如果你既在该平台工作过，又想继续工作，请在该行的两个方框内打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140847.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.08.43 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140903.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.08.53 PM"
>&lt;/p>
&lt;h4 id="web框架">Web框架
&lt;/h4>&lt;p>新来的Svelte占据了最受喜爱的框架的首位。React是最受欢迎的，有四分之一的开发者想要。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年里，你在哪些网络框架和库中做了大量的开发工作，以及你想在未来的一年里从事哪些工作？&lt;!-- raw HTML omitted -->
(如果你既使用了该框架，又想继续使用，请在该行的两个框中都打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-140950.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.13.37 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141002.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.13.52 PM"
>&lt;/p>
&lt;h4 id="其他框架和库-1">其他框架和库
&lt;/h4>&lt;p>虽然Tensorflow是最受欢迎的库，但Pytorch是一个更受欢迎的库。Stack Overflow作为.NET Core的用户，我们很高兴看到它排在首位。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年里，你还在哪些框架和库中做了大量的开发工作，以及你想在未来一年里在哪些框架和库中工作？&lt;!-- raw HTML omitted -->
(如果你既使用了该框架，又想继续使用，请在该行的两个框中都打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141223.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.14.06 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141410.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 10.14.00 PM"
>&lt;/p>
&lt;h4 id="其他工具-1">其他工具
&lt;/h4>&lt;p>早些时候，我们看到有93%的受访者使用Git。现在我们看到，其中85%的受访者希望继续使用Git工作。Git、Docker和Kubernetes都是最受喜爱和最想要的工具。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年里，你在哪些工具中做了大量的开发工作，在未来一年里你想在哪些工具中工作？&lt;!-- raw HTML omitted -->
(如果你既从事过该技术，又想继续从事该技术，请在该行的两个方框内打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141234.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.15.16 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141326.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.15.31 PM"
>&lt;/p>
&lt;h4 id="协作工具">协作工具
&lt;/h4>&lt;p>虽然Neovim是最受喜爱的编辑器，但它是第10个最受欢迎的编辑器。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年中，你经常使用哪些开发环境，你希望在未来一年中使用哪些环境？&lt;!-- raw HTML omitted -->
请勾选所有适用的。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141458.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.15.44 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141508.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.15.55 PM"
>&lt;/p>
&lt;h3 id="用过-vs-想用">用过 vs. 想用
&lt;/h3>&lt;h4 id="编程脚本和标记语言-2">编程、脚本和标记语言
&lt;/h4>&lt;p>这里有很多东西需要解读，但以下是我们发现的一些最值得注意的趋势。有超过1万名Javascript开发者希望开始或继续使用Go或Rust开发。大多数想要使用Dart的开发者目前都在使用JavaScript。我们还看到，想用PHP工作的开发人员只有SQL开发人员。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去一年中，你用哪些编程、脚本和标记语言做了大量的开发工作，以及你想在未来一年中用哪些语言工作？&lt;!-- raw HTML omitted -->
(如果你既用该语言工作，又想继续这样做，请在该行的两个方框内打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141540.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.16.31 PM"
>&lt;/p>
&lt;h4 id="数据库-2">数据库
&lt;/h4>&lt;p>12,590名MySQL开发人员希望与PostgreSQL一起工作，而6,429名PostgreSQL开发人员希望与MySQL一起工作。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年中，你在哪些数据库环境中做了大量的开发工作，以及你在未来一年中想在哪些数据库环境中工作？&lt;!-- raw HTML omitted -->
(如果你既在数据库中工作，又想继续这样做，请在该行的两个框中都打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141558.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.16.44 PM"
>&lt;/p>
&lt;h4 id="云平台-2">云平台
&lt;/h4>&lt;p>虽然AWS是最受喜爱的平台，但我们看到明年有大量的AWS开发者希望在谷歌云中开发。8,586名AWS开发者希望与谷歌云合作，而只有7,668名谷歌云开发者希望在AWS工作。目前使用Heroku或Digital Ocean的开发者更愿意开始使用或继续使用AWS，然后是谷歌云，最后是Azure。目前使用Azure的开发者中，很少有人想转到Heroku。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年里，你在哪些云平台上做了大量的开发工作，你想在未来一年里在哪些云平台上工作？&lt;!-- raw HTML omitted -->
(如果你既在该平台上工作过，又想继续工作，请在该行的两个方框内打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141620.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.16.58 PM"
>&lt;/p>
&lt;h4 id="web框架-1">Web框架
&lt;/h4>&lt;p>Django、Flask和Spring的开发者都满足于继续在各自的框架中工作。很少有开发者愿意在ASP.NET中工作。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年中，你在哪些网络框架和库中做了大量的开发工作，在未来的一年中你想在哪些框架中工作？&lt;!-- raw HTML omitted -->
(如果你既在框架中工作过，又想继续这样做，请在该行的两个框中都打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-143313.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 10.33.01 PM"
>&lt;/p>
&lt;h4 id="其他框架和库-2">其他框架和库
&lt;/h4>&lt;p>想在Hadoop工作的开发者目前正在使用Pandas或Numpy。有和3328名Tensorflow开发者希望继续使用PyTorch，但只有2328名Pytorch开发者希望转到Tensorflow。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年中，你还在哪些框架和库中做了大量的开发工作，以及在未来一年中你想在哪些框架中工作？&lt;!-- raw HTML omitted -->
(如果你既在框架中工作，又想继续这样做，请在该行的两个框中打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141712.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.17.41 PM"
>&lt;/p>
&lt;h4 id="其他工具-2">其他工具
&lt;/h4>&lt;p>&lt;!-- raw HTML omitted -->在过去的一年中，你在哪些工具上做了大量的开发工作，以及你想在下一年中从事哪些工作？&lt;!-- raw HTML omitted -->
(如果你既从事了技术工作，又想继续从事技术工作，请在该行的两个方框内打勾)。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141729.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.17.55 PM"
>&lt;/p>
&lt;h4 id="协作工具-1">协作工具
&lt;/h4>&lt;p>我们看到IPython/Jupyter用户希望在VS Code中工作。这可能是由于VS Code在他们的IDE中加入了Notebook API。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->在过去的一年中，你经常使用哪些开发环境，你希望在下一年中使用哪些环境？&lt;!-- raw HTML omitted -->
请勾选所有适用的。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141749.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.18.14 PM"
>&lt;/p>
&lt;h3 id="学习与问题解决">学习与问题解决
&lt;/h3>&lt;p>在遇到困难时你会怎么做？受访者在遇到困难时最常使用谷歌或访问Stack Overflow。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->当你遇到问题时，你会怎么做？&lt;!-- raw HTML omitted -->
选择所有适用的。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-141808.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.18.47 PM"
>&lt;/p>
&lt;h3 id="薪酬最高的技术">薪酬最高的技术
&lt;/h3>&lt;p>Perl从去年的高薪语言变为今年的第五高薪。Clojure开发者的工资中位数最高，比第二名的F#多出1.4万。&lt;/p>
&lt;p>你目前的总薪酬是多少（年工资、奖金和福利，在税收和扣除前）？
请在下面的方框中输入一个整数，不要有任何标点符号。如果你是按小时计酬的，请估计一下相当于周薪、月薪或年薪。如果您不愿意回答，请在方框内留空。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142042.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.20.02 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142039.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.20.24 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142046.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.20.44 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142043.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.20.58 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142044.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.21.09 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142041.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.21.24 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142058.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.21.36 PM"
>&lt;/p>
&lt;h2 id="工作">工作
&lt;/h2>&lt;h3 id="工作现状">工作现状
&lt;/h3>&lt;p>我们看到更多的受访者从事兼职或在学校工作，而表示全职工作的受访者则减少。这可能反映了非典疫情的影响，所有行业的工人都在后退，并重新评估他们与全职和在职的关系。&lt;/p>
&lt;h4 id="就业状况">就业状况
&lt;/h4>&lt;p>81%的专业开发人员是全职雇员，比2020年的83%有所下降。表示自己是独立承包商、自由职业者或自营职业者的专业开发人员比例从2020年的9.5%增加到2021年的11.2%&amp;ndash;表明潜在的工作不安全或转向了更灵活的就业方式。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->以下哪项最能描述你目前的就业状况？&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142134.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.22.05 PM"
>&lt;/p>
&lt;h4 id="按地域划分的就业状况">按地域划分的就业状况
&lt;/h4>&lt;p>与去年相比，来自印度的全职就业者的百分比下降了15个百分点。相比之下，学生的数量增加了9个百分点。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->以下哪项最能说明您目前的就业状况？&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142206.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.22.27 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142203.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.22.38 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142204.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.22.51 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142205.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.23.04 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142208.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.23.14 PM"
>&lt;/p>
&lt;h3 id="公司情况">公司情况
&lt;/h3>&lt;h4 id="公司规模">公司规模
&lt;/h4>&lt;p>与去年相比，今年我们看到从事自由职业的受访者有所增加。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->你目前工作的公司或组织大约雇用了多少人？&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142223.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.23.28 PM"
>&lt;/p>
&lt;h3 id="薪资">薪资
&lt;/h3>&lt;h4 id="按开发者类型划分的薪资">按开发者类型划分的薪资
&lt;/h4>&lt;p>从整体上看，工程经理、SRE、DevOps专家和数据工程师往往获得最高的薪水。当专注于美国时，我们看到在工资分布的底部有一些差异。在美国，与全球开发者人口相比，移动开发者和教育工作者的工资相对于其他职业来说往往更高。&lt;/p>
&lt;p>你目前的总报酬（年工资、奖金和福利，在税收和扣除前）是多少？
请在下面的方框中输入一个整数，不要有任何标点符号。如果你是按小时计酬的，请估计一个相等的周薪、月薪或年薪。如果您不愿意回答，请在方框内留空。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142256.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.23.41 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142257.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.23.53 PM"
>&lt;/p>
&lt;h4 id="按开发者类型划分的薪资和体验">按开发者类型划分的薪资和体验
&lt;/h4>&lt;p>尽管工程经理、SRE、DevOps专家的薪酬最高，但我们看到他们平均也有超过10年的专业经验。数据科学家或机器学习专家的薪酬排在第8位，但平均来说，他们的经验最少。设计师的工资最低，尽管他们平均有超过十年的经验。&lt;/p>
&lt;p>您目前的总薪酬（年工资、奖金和福利，在税前和扣除前）是多少？
请在下面的方框中输入一个整数，不要有任何标点符号。如果你是按小时计酬的，请估计一个相等的周薪、月薪或年薪。如果您不愿意回答，请在方框内留空。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142319.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.24.11 PM"
>&lt;/p>
&lt;h4 id="按语言划分的薪资和体验">按语言划分的薪资和体验
&lt;/h4>&lt;p>与具有相同经验的其他语言相比，PHP开发人员的工资低得不成比例。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->你目前的总报酬是多少（年工资、奖金和福利，在税前和扣减前）？&lt;!-- raw HTML omitted -->
请在下面的方框中输入一个整数，不要有任何标点符号。如果你是按小时计酬的，请估计一个相等的周薪、月薪或年薪。如果您不愿意回答，请在方框内留空。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142357.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.24.25 PM"
>&lt;/p>
&lt;h2 id="社区">社区
&lt;/h2>&lt;p>社区是我们所有工作的核心。&lt;/p>
&lt;h3 id="stack-overflow网站的使用">Stack Overflow网站的使用
&lt;/h3>&lt;h4 id="访问过stack-exchange网站">访问过Stack Exchange网站
&lt;/h4>&lt;p>不到1%的受访者从未访问过Stack Overflow或Stack Exchange网络。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->您曾访问过以下哪些Stack Overflow网站？&lt;!-- raw HTML omitted -->
选择所有适用的。&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142555.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.24.51 PM"
>&lt;/p>
&lt;h4 id="访问stack-overflow">访问Stack Overflow
&lt;/h4>&lt;p>我们知道，开发人员经常访问Stack Overflow，今年早些时候，我们确认他们复制代码的次数也很多。从今年的调查中，我们还知道80%的受访者每周都会访问Stack Overflow，其中55%的人每天都访问。&lt;/p>
&lt;p>你认为你访问Stack Overflow的频率如何？&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142619.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.25.27 PM"
>&lt;/p>
&lt;h4 id="有多少参与者拥有stack-overflow账户">有多少参与者拥有Stack Overflow账户？
&lt;/h4>&lt;p>10位受访者中，有8位拥有Stack Overflow账户。
你有Stack Overflow账户吗？&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142940.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 10.29.33 PM"
>&lt;/p>
&lt;h4 id="开发者多长时间参与一次stack-overflow">开发者多长时间参与一次Stack Overflow？
&lt;/h4>&lt;p>在拥有Stack Overflow账户的人中，46%的人每月参与该网站的次数少于一次或每月。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->您认为您在Stack Overflow上参与问答的频率如何？&lt;!-- raw HTML omitted -->
我们所说的参与是指提出、回答、投票或评论问题。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-142837.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.26.17 PM"
>&lt;/p>
&lt;h4 id="开发者认为自己是stack-overflow社区的一员吗">开发者认为自己是Stack Overflow社区的一员吗？
&lt;/h4>&lt;p>只有44%的受访者认为自己 &amp;ldquo;有点 &amp;ldquo;或 &amp;ldquo;肯定 &amp;ldquo;是Stack Overflow社区的成员。在这些受访者中，我们看到性别少数群体认为自己是Stack Overflow社区成员的可能性较小。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->你认为自己是Stack Overflow社区的成员吗？&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-143014.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.26.29 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-143013.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.26.37 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-143012.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.26.49 PM"
>&lt;/p>
&lt;h3 id="现在的stack-overflow社区">现在的Stack Overflow社区
&lt;/h3>&lt;h4 id="其他在线开发者社区的成员">其他在线开发者社区的成员
&lt;/h4>&lt;p>大多数受访者不属于任何其他在线开发社区。
你是其他在线开发者社区的成员吗？&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-143040.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.27.01 PM"
>&lt;/p>
&lt;h4 id="其他公共或私有社区">其他公共或私有社区
&lt;/h4>&lt;p>近2.5万名受访者属于其他在线开发者社区。其中85%是对公众开放的，任何人都可以加入。这些其他社区大多属于Reddit、Github或Discord。&lt;/p>
&lt;p>请说出你所属的其他5个在线开发者社区，并说明它们是公开的（任何人都可以加入）还是私人的（需要邀请）。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-143057.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.27.13 PM"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-143056.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.27.23 PM"
>&lt;/p>
&lt;h2 id="方法论">方法论
&lt;/h2>&lt;h3 id="概况">概况
&lt;/h3>&lt;p>本报告是基于对全球181个国家的83,439名软件开发人员的调查。这是我们根据在完整的、已完成的调查中所花费的时间而认为 &amp;ldquo;合格 &amp;ldquo;的答复数量；另外提交了约172份答复，但没有包括在分析中，因为答复者在调查中花费的时间不到3分钟。&lt;/p>
&lt;p>该调查从2021年5月25日到2021年6月15日进行。&lt;/p>
&lt;p>合格答卷者在调查上花费的时间中位数为10.21分钟。&lt;/p>
&lt;p>应答者主要是通过Stack Overflow拥有的渠道招募的。受访者的主要来源是现场消息、博客帖子、电子邮件列表、横幅广告和社交媒体帖子。由于应答者是通过这种方式招募的，Stack Overflow上的高参与度用户更有可能注意到在征集活动期间进行调查的提示。&lt;/p>
&lt;p>作为一项激励措施，完成调查的受访者如果完成了调查，可以选择获得一个 &amp;ldquo;年度调查 &amp;ldquo;的徽章。&lt;/p>
&lt;p>由于美国的运输/出口制裁，在克里米亚、古巴、伊朗、朝鲜和叙利亚的潜在受访者很遗憾地无法获得我们的调查，因为我们的第三方调查软件封锁了流量。虽然一些受访者使用VPN来绕过封锁，但在解释调查结果时，应牢记这一限制。&lt;/p>
&lt;p>许多问题只根据受访者以前的回答来显示。例如，关于工作和工作的问题只显示给那些说他们在工作的人。&lt;/p>
&lt;p>我们询问了受访者的工资情况。首先，我们问每个受访者通常使用什么货币。然后我们问受访者他们的工资是什么货币，以及该工资是每周、每月还是每年。&lt;/p>
&lt;p>像调查中的大多数问题一样，工资问题是可选的。有46,844名受访者向我们提供了工资数据。&lt;/p>
&lt;p>我们使用2021年6月16日的汇率将用户货币的薪金转换为美元，并假设为12个工作月和50个工作周，转换为年薪。&lt;/p>
&lt;p>美国国内和国外最顶尖的大约2%的工资被修剪掉，用门槛值代替。美国国内和国外的门槛值是不同的。&lt;/p>
&lt;p>为了确定今年的调查应包括哪些技术，我们查看了Stack Overflow上最受欢迎和增长最快的标签（就发布的问题而言）。我们将这些技术与去年包括的技术进行了比较，并查看了有多少人选择了每个选项。我们把所有这些综合起来，策划了一个要包括的技术集合。&lt;/p>
&lt;p>这些问题被组织成几个问题块，它们的顺序是随机的。此外，大多数问题的答案也是随机排列的。&lt;/p>
&lt;h3 id="反馈意见">反馈意见
&lt;/h3>&lt;h4 id="你对今年的调查长度有什么看法">你对今年的调查长度有什么看法？
&lt;/h4>&lt;p>大多数受访者认为今年的调查长度是合适的。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-143122.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.27.51 PM"
>&lt;/p>
&lt;h4 id="完成这项调查有多容易或多难">完成这项调查有多容易或多难？
&lt;/h4>&lt;p>不到百分之一的受访者认为今年的调查很困难。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-143131.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.28.00 PM"
>&lt;/p>
&lt;h3 id="参与者">参与者
&lt;/h3>&lt;h4 id="谁参与了这次调查">谁参与了这次调查
&lt;/h4>&lt;p>与往年类似，绝大部分受访者的职业是开发人员。&lt;/p>
&lt;p>以下哪个选项最能描述今天的你？这里的 &amp;ldquo;开发者 &amp;ldquo;是指 &amp;ldquo;写代码的人&amp;rdquo;。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-143147.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.28.14 PM"
>&lt;/p>
&lt;h4 id="你住在哪里">你住在哪里？
&lt;/h4>&lt;p>以下国家是我们收到答复的前10个国家。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-08-13-143157.jpg"
loading="lazy"
alt="Screen Shot 2021-08-13 at 9.28.26 PM"
>&lt;/p></description></item><item><title>《独角兽项目》读后感及中国 DevOps 社区之观察</title><link>https://martinliu.cn/blog/the-unicorn-project-review-devops-in-china/</link><pubDate>Wed, 23 Jun 2021 08:14:40 +0800</pubDate><guid>https://martinliu.cn/blog/the-unicorn-project-review-devops-in-china/</guid><description>&lt;img src="https://martinliu.cn/img/2021/06/guild-1573610501.jpg" alt="Featured image of post 《独角兽项目》读后感及中国 DevOps 社区之观察" />&lt;p>这本以“DevOps”为主题的小说的故事情节很接地气，引人入胜的剧情会让人很难放手，所以我在周末只用了两个长 sprint（迭代）就读完了。&lt;/p>
&lt;p>掩卷后迟迟没有写读后感的原因，主要是没想好在不剧透的情况下，如何向大家介绍这本书。下面先和大家聊聊在 DevOps 社区中耳闻目睹到的那些事。&lt;/p>
&lt;p>谈到 DevOps 这个话题，我们就不得不纵观当下中国 IT 行业的全景，一边是国家积极倡导的信息化创新和产业数字化转型；一边是国产基础实施类开源软件创业公司的风生水起。随着移动互联网和社交媒体的发展达到了顶峰， 5G 、IoT 、芯片和边缘计算等新技术也迎面而来。对于所有 IT 从业人员，特别是软件开发人员而言；我们可能正处在一个有史以来最利好的时代；同时整个 IT 行业正深陷于严重内卷的残酷现实，也在提醒着我们，这同时也是一个最坏的时代。&lt;/p>
&lt;p>《独角兽项目》的精彩故事情节，使我不禁要停下来，稍微总结一下我在最近 4 年多的时间里，见闻的这些鲜活案例和事实。以下所描述的内容，仅代表我的个人观点，还望各位看官指正和海涵。&lt;/p>
&lt;p>国内 DevOps 水平最高的团队应该在这些一线互联网企业的优秀产品团队；请大家注意我的描述，软件研发的工程工艺水平在这些大厂的不同产品团队间也可以是良莠不一的；研发效能卓越者已经达到了 DORA 2019 状态报告中精英级别的能力组合，即业务需求每日持续发布给用户，软件代码变更分钟级上线投产，上线成功率（失败率）几乎不影响客户体验，以及能分钟级别恢复业务事故等。而它们为什么能这样又快、又好、又安全！由于他们所满足的是中国亿级人口日常的网购、社交和娱乐体验，这些业务能创造巨大的社会和经济价值，每个风口浪尖上的产品也同时承受着巨大市场竞争压力和考验，业务危机使然；而危机感的缺乏的非明星产品团队必然也不需要那么高深的 DevOps 的技艺。这些一线大厂强大的技术品牌输出也事实上几乎统治了现在所有顶级技术大会；在最近刚刚结束的 QCon 北京峰会上，我竟然很难在讲师清单中找到非互联网行业公司的讲师。DeOps 做的好的企业必然是能做到无招胜有招。个别头部互联网企业正在向外输出他们自研的 DevOps 产品和服务平台。&lt;/p>
&lt;p>让我们将视线转移到国内传统行业的诸多“马”公司（相对于市值动辄上亿的独角兽企业），在金融服务、通讯和制造行业中，这几年 DevOps 也有了长足的发展。由于国家的各种信息安全、行业合规的要求颇高，我们以为他们或许应该是最不可能实施 DevOps 的企业。而在我最近参与的一次 DevOps 社区线下 Meetup 上，招行的案例分享确实令我折服。在我的其它大量的社区观察中，那些颇有造诣的企业不仅限于 DevOps 流水线和敏捷业务开发方面的卓越技艺；他们还在组织级别的规模化转型，内部精益教练推广，系统 SRE 建设，甚至混沌工程等方面都各有千秋；从这些角度看，他们的成长速度已经超越了，他们所刷的某些评奖定级。我对所有传统企业在 DevOps 社区的输出尤其赞赏，由于他们之间的相互学习交流和传播，可能对整个 IT 行业更加重要，毕竟实体经济才是中国发展的根本所在。希望他们能将各自的实践经验持续的输出到社区，一起来推动整个行业的变迁。其实《独角兽项目》小说中的场景设定，可能更符合他们的实际情况。传统行业企业往往坐拥得天独厚的资源优势，具有数十年积累的大规模信息科技研发组织和基础设施。 他们更多的出现在全球财富百强清单中是毫无悬念的，但是有时候所拥有的优势和劣势是对等的。如何破局企业组织部门间的制约和博弈，怎样意识到和消除深重的技术债务，怎么能持续优化 IT 服务的价值交付链条？这些都是更加复杂的系统性工程，自我颠覆和业务创新可能是他们的终极挑战和危机。希望大家能借鉴《独角兽项目》小说中的剧情，做到转危为安，实现企业的跃迁。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/2021/06/human-bridge.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>《独角兽项目》一书的任何情节并没有配图，但是上面这幅图中的寓意相信各位看官们都能够秒懂。其实桥和火车是一体的，火车像是企业持续发展的业务。如果我们将这个场景作为 IT 行业软件开发和运维的隐喻，我们可能甚至都不好意思说“我们是高科技从业者”。还有很多企业的开发和运维团队尚处于“刀耕火种”或“手工作坊”的阶段，版本管理混乱、代码分支合并发布困难、重复繁琐的软件测试工作严重依赖人工、在物理隔离的多套环境中不得不纯手工配置和部署应用系统、监控告警的分类定级基本完全依赖经验，这些尚待 DevOps 解决的反模式不胜枚举。&lt;/p>
&lt;p>最后，我觉得虽然《独角兽项目》中的情节是虚构的，但是它们确实是反映出了软件开发过程中众多反模式的一个子集而已；如果在你阅读这本书的过程中，觉得情节离奇而夸张，那么我要恭喜你，可能你要再等一下，才能到这个阶段，或者你已经超越了这些苦难了（我表示否定）；如果你觉得稀松平常的话，那么我认为，你要么已经躺平接受了，要么就是掉进了更大的坑。反模式的后果包括：996/007的加班、职业透支、各种就发生在工位上的悲剧，这些是人类所不可接受的；反模式在《独角兽项目》中将那些斗志犹存，越战越勇，不甘心失败的人团建和聚集在了一起。希望现实工作生活中的大家都可以参考小说中的相关情节，哪里有压迫，哪里就有反抗，就有不可熄灭的追求理想的动力。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/2021/06/5-ideals.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>《独角兽项目》向我们展示了软件开发团队迎难而上，在抗击行业困苦的过程中，需要坚定追求的五大理想。它们就像在社会主义发展的各个阶段中，社会所追求的主旋律都各不相同，但是社会整体上是螺旋上升的一样。这五大理想依次是：&lt;/p>
&lt;ol>
&lt;li>局部和简单性&lt;/li>
&lt;li>专注、流动和快乐&lt;/li>
&lt;li>改进日常工作&lt;/li>
&lt;li>心理安全&lt;/li>
&lt;li>以客户为中心&lt;/li>
&lt;/ol>
&lt;p>注：书中的译文是“五大理念”，在本文中我稍微升华了一下；本书的翻译质量上乘。&lt;/p>
&lt;p>虽然本书是献给 Developer 的一本书，但是在 DevOps 的视角中，测试、运维和安全，以及各种角色都应该是 Developer，大家的工作成果都应该是可以被计算机理解和执行的代码；在人机的交互模型中，切莫让人类变成重复执行任务的工具人（各种人肉某某某），人类应该做更高级的智力劳动。希望此书能给各行各业的开发者们带来一些启发和勇气。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/2021/06/3-books.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>本书的作者Jene Kim 是 DevOps 领域中的大咖，本书是继《凤凰项目》（Phoenix Project）和《DevOps 实践指南》（DevOps Handbook）之后的一本书，也是他的巅峰之作。我是 DevOps Handbook 的译者之一，《凤凰项目》孕育了《DevOps 实践指南》一书，而《独角兽项目》的故事情节不但完美的延续了《凤凰项目》，而且它们向我们用戏剧化的方式，完整的展示了企业从开发到运维的全景，展示从一个技术团队从技术债的谷底背水一战、反败为胜的全过程。如果你对以上三本书都感兴趣的话，建议可以一次性购入，推荐的阅读顺序如下：&lt;/p>
&lt;ol>
&lt;li>《凤凰项目》&lt;/li>
&lt;li>《独角兽项目》&lt;/li>
&lt;li>《DevOps 实践指南》&lt;/li>
&lt;/ol>
&lt;p>这套书可以是团队读书会的必读书目，也是你劝说领导支持你做 DevOps 的铺垫。相信读过以上三本书的领导，可以与 DevOps 团队有更多的共同语言。&lt;/p>
&lt;p>在中国 DevOps 社区中（微信号 DevOpsMeetup），应该说我们汇聚了来自各个公司的 ，属于像是《独角兽项目》中所描述的反抗军的朋友们。社区中的很多朋友也曾经是孤独无助的 DevOps 践行者，通过一己之力很难推动团队瓶颈的解决。大家在DevOps社区的交流互动中能够收获到很多的顿悟时刻，得到大量成功经验的启迪和感召。DevOps 社区的 Meetup 活动正在定期的在各个城市举办，总有一场属于你的社区 Meetup 活动即将发生。&lt;/p>
&lt;p>希望《独角兽项目》是你补习 DevOps 理念的最后一本书，你必须将其付诸于实际行动。DevOps最后要落实并消失在每个开发者日常的工作中，这是一次没有终点的旅程，应该是一局没有结局的游戏。多说无益，让我们在 DevOps 社区里见。&lt;/p></description></item><item><title>Hashicorp 的 Terraform 1.0 正式 GA 了！</title><link>https://martinliu.cn/blog/hashicorp-terraform-1-0-general-availability-cn/</link><pubDate>Tue, 15 Jun 2021 09:15:22 +0800</pubDate><guid>https://martinliu.cn/blog/hashicorp-terraform-1-0-general-availability-cn/</guid><description>&lt;img src="https://martinliu.cn/img/2021/06/0gLZ2oH.png" alt="Featured image of post Hashicorp 的 Terraform 1.0 正式 GA 了！" />&lt;p>Terraform 1.0&amp;ndash;现在GA了&amp;ndash;标志着你的自动化工作流程的互操作性、易于升级和维护方面的一个重要里程碑。&lt;/p>
&lt;p>Terraform 拥有数以亿计的下载量、成千上万的贡献和令人难以置信的社区，是最广泛采用的基础设施即代码工具。达到 1.0 是一个重要的里程碑。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-06-15-terrafor-history.png"
loading="lazy"
alt="Terraform 的历史"
>&lt;/p>
&lt;p>本文来自：&lt;a class="link" href="https://www.hashicorp.com/blog/announcing-hashicorp-terraform-1-0-general-availability" target="_blank" rel="noopener"
>https://www.hashicorp.com/blog/announcing-hashicorp-terraform-1-0-general-availability&lt;/a>&lt;/p>
&lt;p>6 月 8 日，在 HashiConf 欧洲会议上，我们很高兴地宣布HashiCorp Terraform 1.0全面上市，这是您自动化工作流程的互操作性、易于升级和维护的一个重要里程碑。Terraform 1.0&lt;a class="link" href="https://www.terraform.io/downloads.html" target="_blank" rel="noopener"
>立即可供下载&lt;/a>，也可在HashiCorp Terraform Cloud 中使用。HashiCorp Terraform已经被大小公司的个人和团队广泛使用，成为多云配置和自动化的标准。这篇文章介绍了新的内容，以及1.0的命名对Terraform用户的意义。&lt;/p>
&lt;h2 id="更好的-terraform-state-互操作性">更好的 Terraform State 互操作性
&lt;/h2>&lt;p>Terraform 在互操作性方面取得了巨大的进步。Terraform state 现在可以在0.14.x、0.15.x和1.0.x版本之间交叉兼容。远程状态数据源的兼容性现在已经回传，支持0.12.30、0.13.6、0.14.0、0.15.0和1.0.x版本。&lt;/p>
&lt;h2 id="改进升级体验">改进升级体验
&lt;/h2>&lt;p>从 Terraform 0.15 开始，一直到1.x的生命周期，你现在可以升级到新的 Terraform 版本，你的工作流程将继续运行，就像之前那些版本一样。使用Terraform 1.x不需要升级工具、重构或其他改变。&lt;/p>
&lt;h2 id="延长维护期">延长维护期
&lt;/h2>&lt;p>所有Terraform 1.x版本将有至少18个月的维护期。这意味着HashiCorp将继续调查1.0版本的错误和发布功能，至少在这段时间内。这些修复可能会在后续的1.x版本中发布，而不一定是增量的1.0.x版本。&lt;/p>
&lt;h2 id="terraform插件sdk-v1的寿命结束">Terraform插件SDK v1的寿命结束
&lt;/h2>&lt;p>&lt;a class="link" href="https://github.com/hashicorp/terraform-plugin-sdk/" target="_blank" rel="noopener"
>Terraform插件SDK&lt;/a>是一个框架，可以让开发者创建和维护Terraform供应商。HashiCorp将在2021年7月31日结束对插件SDK第一版的支持。Terraform CLI和Terraform Cloud的用户不受此影响，不需要采取任何行动。我们鼓励受到影响的 Terraform Provider 的维护者使用我们的升级指南，转移到Terraform Plugin SDK的第二版本。按照我们的教程，开发您的Provider。其他信息可以在Terraform提供者社区讨论论坛中找到。Terraform插件SDK v1版的生命终结时间表。&lt;/p>
&lt;h2 id="10版本对terraform意味着什么">1.0版本对Terraform意味着什么？
&lt;/h2>&lt;p>1.0版本是一个巨大的成就，对于Terraform来说更是如此。对于许多为该项目做出贡献的人或参与超过100,000,000次下载的人来说，这已经是一个漫长的过程。但在HashiCorp，我们以一致的、透明的方式对待产品版本和1.0的指定，基于四个关键要求，正如2017年4月关于Packer 1.0发布的博文中所记录的那样。&lt;/p>
&lt;p>达到1.0的第一个要求是产品已经被广泛部署，在生产中经过多年的硬化。Terraform自2014年首次发布以来，一直在配置和管理基础设施，并得到了从零售业（星巴克）到证券交易所（TMX集团、德意志交易所集团）到自动驾驶汽车（Cruise）等广泛行业的信任。&lt;/p>
&lt;p>第二个要求是，主要的用例要被理解并得到良好的支持。Mitchell Hashimoto和Armon Dadgar早在2014年创建Terraform时，就已经想到了几个用例。从那时起，超过1500名贡献者开启了超过11000个 PR（GitHub 的贡献方式），这些请求增加了新的功能，并支持新的用例，这是我们从未想象过的。&lt;/p>
&lt;p>第三个要求规定了一个明确的用户体验。Terraform用户从不同的角度来处理他们的工作流程，因此我们专注于创建直观的用户界面；清晰的文档；全面的、自定进度的学习平台；以及互动的、由教师指导的研讨会。&lt;/p>
&lt;p>第四个要求是确保产品的技术架构是成熟和稳定的。&lt;/p>
&lt;p>Terraform 1.0以更大的互操作性、更容易的升级以及重要的维护期来巩固你的自动化工作流程和Terraform功能集的稳定性的形式满足了所有四个要求。&lt;/p></description></item><item><title>2021 年 Gartner AIops 平台市场指南报告</title><link>https://martinliu.cn/blog/gartner-aiops-platform-market-guide-2021/</link><pubDate>Wed, 28 Apr 2021 17:22:22 +0800</pubDate><guid>https://martinliu.cn/blog/gartner-aiops-platform-market-guide-2021/</guid><description>&lt;img src="https://martinliu.cn/img/2021/4/AIOps-an-Industrial-Benchmark-2048x719.jpg" alt="Featured image of post 2021 年 Gartner AIops 平台市场指南报告" />&lt;p>本文是翻译整理的 Gartner 的行业调查报告，原文在：&lt;a class="link" href="https://www.gartner.com/doc/reprints?id=1-25RAD0H3&amp;amp;ct=210407&amp;amp;st=sb" target="_blank" rel="noopener"
>https://www.gartner.com/doc/reprints?id=1-25RAD0H3&amp;ct=210407&amp;st=sb&lt;/a>&lt;/p>
&lt;h2 id="概述">概述
&lt;/h2>&lt;h3 id="主要发现">主要发现
&lt;/h3>&lt;ul>
&lt;li>AIOps平台在企业中的应用正在迅速增长。I&amp;amp;O（基础设施和运维）领导人正在为COVID-19后的环境进行规划，主要参考当前的实际成果，而非理想的目标。&lt;/li>
&lt;li>AIOps平台的产品分为两类：领域无关的和以领域为中心的解决方案。然而，在处理高度多元化数据集的灵活性方面的需求正在逐渐提升，这正在对市场产生重大影响，并使AIOps平台向领域无关的功能性方向转变。&lt;/li>
&lt;li>企业已经开始采用AIOps平台来对比和替换一些类别的传统监控工具。例如，监控 IaaS 和可观察性正在完全在 AIOps 平台内完成，特别是当企业的整个IT服务部署都在云里时。&lt;/li>
&lt;li>企业正在增加将 AIOps 用于IT运维管理（ITOM）的各方面，并使其在DevOps 和 SRE 的实践中的使用应用场景更加成熟。&lt;/li>
&lt;/ul>
&lt;h3 id="建议">建议
&lt;/h3>&lt;p>专注于基础设施、运维和云管理的 I&amp;amp;O 领导人应该。&lt;/p>
&lt;ul>
&lt;li>通过采用渐进式方法，从取代基于规则的事件分析开始，然后再扩展到以领域为中心的工作流程中，如应用程序和网络的诊断，优先考虑实际成果，而不是理想中的目标。&lt;/li>
&lt;li>通过允许根据使用场景来选择的方法，在以领域为中心的AIOps或与领域无关的AIOps之间作出选择。在使用以领域为中心的AIOps功能点时，要将其内置于监控工具中，服务于一次性的特定用例，同时在路线图上规划部署能兼顾多种用例的，领域无关的独立解决方案。&lt;/li>
&lt;li>通过选择一个支持与ITSM工具双向整合的AIOps平台，实现任务自动化、知识管理和变更分析。小心那些只提供基本搜索和显示功能的工具。&lt;/li>
&lt;li>通过AIOps平台所支持的以上这三个方面，实现对整个ITOM的持续洞察：观测、干预和行动（observe, engage and act）。&lt;/li>
&lt;/ul>
&lt;h2 id="市场定义">市场定义
&lt;/h2>&lt;p>本报告于2021年4月19日修订。你正在查看的文件是更正后的版本。欲了解更多信息，请参见gartner.com上的 &lt;a class="link" href="http://www.gartner.com/technology/about/policies/current_corrections.jsp" target="_blank" rel="noopener"
>更正&lt;/a>页面。&lt;/p>
&lt;p>AIOps 平台通过结合数据存储和分析功能，满足I&amp;amp;O领导者对运维支持的需求，根据IT部门为应对数字化转型而产生的数据，向有关团队提供相关的洞见。该能力是数据流水线的一部分，包括数据的摄人和存储，然后是数据整形和分析，然后转向可视化层。分析能力包括统计技术和人工智能技术的混合，但考虑到用户的成熟度，与人工智能层的互动界面对I&amp;amp;O来说是最小化、甚至是不存在的。&lt;/p>
&lt;h2 id="市场描述">市场描述
&lt;/h2>&lt;p>AIOps 平台广泛的强化了一些列 IT 实践，包括 I&amp;amp;O（基础架构/运维）、DevOps、SRE 和服务管理。然而，更集中的成果是在 I&amp;amp;O 领域，包括异常检测、诊断信息、事件关联和根本原因分析（RCA），以改善监控、服务管理和自动化任务。&lt;/p>
&lt;p>AIOps平台的核心功能包括：&lt;/p>
&lt;p>&lt;strong>摄入&lt;/strong>&lt;/p>
&lt;p>AIOps 平台可以从多个领域、信息提供源进行数据摄取、索引和规范化事件或监控数据，包括基础设施、网络、应用程序、云或现有监控工具（用于跨领域分析）（见注2）。该平台必须至少在两个方面，使用机器学习的使能（enable）数据分析，包括。&lt;/p>
&lt;ul>
&lt;li>摄入点的实时分析（流分析）。&lt;/li>
&lt;li>存储数据的历史分析&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>拓扑&lt;/strong>&lt;/p>
&lt;p>AIOps 平台发现并建立IT资产的统一拓扑结构，包括应用程序，和其它相关领域。拓扑结构可以表达物理上的连接性、逻辑上的依赖性或捕捉到IT资产和服务之间其他维度的关系。&lt;/p>
&lt;p>&lt;strong>关联&lt;/strong>&lt;/p>
&lt;p>AIOps 平台对多个监控领域或来源的事件进行关联和压缩（抑制），减少不必要的人工干预。关联功能结合了时间和拓扑结构来分组相关的事件。&lt;/p>
&lt;p>&lt;strong>识别&lt;/strong>&lt;/p>
&lt;p>AIOps 平台处理事件和监控数据，从而检测或预测重要的事件或事故。该平台不断地从操作员的输入和优化的机制中学习和强化重要事件的独特模式。&lt;/p>
&lt;p>&lt;strong>修复&lt;/strong>&lt;/p>
&lt;p>AIOps 平台通过操作员的调校或观察，不断的学习和改进每个重要事件和操作响应之间的关联性。AIOps 平台可能会提供一个建议，自动化响应或触发外部自动化系统。&lt;/p>
&lt;p>AIOps 不仅仅是一个数据存储和检索系统。此外，该平台不限于趋势分析、预测和查询大量数据集的能力。&lt;/p>
&lt;p>AIOps 的目标是通过策划和提高摄入数据的质量，以便 I&amp;amp;O 的领导者能够将多种用例推向相关的合适实践或角色。例如，模式发现可以有助于预测新出现的行为，IT 实体之间的关系，以及（IT工件、用户和代理）的基准行为，从而识别出异常情况，并给业务所有者提供相关背景。分析也促成了自动化的洞察力，简化了根本原因的定位，并使能了运用自动化解决所已发现问题的行动（见图1）。&lt;/p>
&lt;p>图1: AIOps 跨多 IT 运维监控(ITOM)领域使能持续生成洞见 &lt;img src="https://martinliu.cn/img/cos/2021-04-28-Figure_1_AIOps_Platform_Enabling_Continuous_Insights_Across_IT_Operations_Monitoring_ITOM.png"
loading="lazy"
alt="Figure 1: AIOps Platform Enabling Continuous Insights Across IT Operations Monitoring (ITOM)"
>&lt;/p>
&lt;p>图片翻译如下：&lt;/p>
&lt;p>Real-time and historical data : 实时和历史数据&lt;/p>
&lt;p>Events Metrics, Traces, Topology : 事件 指标，追踪，拓扑&lt;/p>
&lt;p>Incidents, dependencies and changes : 事故、依赖和变更&lt;/p>
&lt;p>Observe （monitoring）：观测（监控）&lt;/p>
&lt;ul>
&lt;li>Historical analysis 历史分析&lt;/li>
&lt;li>Anomaly Detection 异常检测&lt;/li>
&lt;li>Performance analysis 性能分析&lt;/li>
&lt;li>Correlation and contextualization 关联和上下文化&lt;/li>
&lt;/ul>
&lt;p>Engage （ITSM）：干预（ITSM）&lt;/p>
&lt;ul>
&lt;li>Task Automation 任务自动化&lt;/li>
&lt;li>Change Risk analysis 变更风险分析&lt;/li>
&lt;li>Performance Analysis 性能分析&lt;/li>
&lt;li>Knowledge Management 知识管理&lt;/li>
&lt;/ul>
&lt;p>Act （automation） ： 行动 （自动化）&lt;/p>
&lt;ul>
&lt;li>Scripts 脚本&lt;/li>
&lt;li>Runbooks 运行手册&lt;/li>
&lt;li>ARA&lt;/li>
&lt;/ul>
&lt;h2 id="市场方向">市场方向
&lt;/h2>&lt;h3 id="市场转向领域无关的-aiops">市场转向领域无关的 AIOps
&lt;/h3>&lt;p>领域无关的平台正在作为一个独立的市场出现，与以领域为中心的AIOps平台不同（见注3）。这是因为在三到五年渐进式的路线图中，可以灵活地摄取日益多样化的数据集。这种路线图上的用例不仅仅关注异常状态识别，还包括行为分析、客户参与和识别潜在机会。未来的市场指南报告将专注于领域无关的 AIOps。&lt;/p>
&lt;p>随着企业在应用 AIOps 方面的成熟，他们需要一个跨越 I&amp;amp;O、DevOps、SRE的统一的领域无关平台，在某些情况下还需要包括安全实践。&lt;/p>
&lt;p>Gartner 看到 I&amp;amp;O 领导人正在与高级管理层讨论相关的KPI（关键绩效指标）和仪表盘。在所有这些情况下，以领域为中心的工具则出现了明显的差异，它更聚焦在异常检测和减少错误告警方面。AIOps 已经成为许多以领域为中心的市场中的一个决定性特性。&lt;/p>
&lt;h3 id="aiops以领域为中心的工具中的必备功能">AIOps：以领域为中心的工具中的必备功能
&lt;/h3>&lt;p>以领域为中心的 AIOps 已经扩展到多个 ITOM 细分市场，包括可观测性和自动化工具市场。它是一些市场的决定性特性。比如说。&lt;/p>
&lt;ul>
&lt;li>AIOps 能力是 APM 工具的决定性特性之一（见[应用性能监控魔力象限]报告）。&lt;/li>
&lt;li>在 ITIM 和 NPMD 市场，分析被认为是一种核心能力，但供应商已经开始提供AIOps能力，以支持各种产出，如提升洞察和诊断力。&lt;/li>
&lt;li>许多ITSM供应商通过投资自开发平台或与 AIOps 平台供应商合作，将AIOps能力纳入其中（见[IT服务管理工具魔力象限]）。AITSM 的概念通过在 ITSM 工具上应用人工智能的上下文、建议、行动和界面，为 I&amp;amp;O 人员带来了有效性、效率和降低错误（见[利用 AITSM的4个领域来发展ITSM工具和实践]）。&lt;/li>
&lt;/ul>
&lt;p>以领域为中心的 AIOps 方法对那些数据种类有限（即只有少数点状解决方案）并优先考虑少数重点用例的组织有效。这类组织对同时查看多个孤岛数据的需求或能力都比较有限。随着组织内用例的增加，他们可能会转向领域无关的工具。&lt;/p>
&lt;p>仅仅关注以领域为中心的方法的供应商将在那些还没有准备好利用领域诊断工具的优势的客户身上获得成功。然而，随着越来越多的企业希望转向领域无关的选项，只关注以领域为中心的技术的供应商将发现自己被排除在市场的讨论之外。&lt;/p>
&lt;h3 id="持续的关注和增长">持续的关注和增长
&lt;/h3>&lt;p>AIOps 继续的增长和对整个 ITOM 市场的影响，估计2020年的市场规模在9亿至15亿美元之间，2020年至2025年的复合年增长率约为15%（见[市场机会图：全球IT运维管理]）。采用和方向正受到两个独立但最终相关的领域的严重影响。&lt;/p>
&lt;ul>
&lt;li>数字化业务转型&lt;/li>
&lt;li>从被动应对问题过渡到主动解决问题&lt;/li>
&lt;/ul>
&lt;p>数字化业务转型正在推动着 AIOps 市场的发展，因为更多的业务运维被数字化，分析不断增长的数据量变得更加关键和困难。随着数据量达到或超过每分钟千兆字节，跨越十几个不同的领域，人类已经不可能手动分析数据了。&lt;/p>
&lt;p>随着企业继续进行数字化转型，他们不再奢望在问题发生后才作出响应。相反，他们必须变得积极主动，在影响到用户的体验之前就解决掉潜在的问题。&lt;/p>
&lt;p>AIOps 市场继续朝着更广泛和更好的解决方案发展，在这两个目标下，依然同时仍然保持着以领域为中心的方法和领域无关的方法之间的区分（见注3）。未来的状态是一个统一的 AIOps 平台试图取代问题日益增多的领域为中心的工具。Gartner 预计会看到越来越多的专业层，获奖在嵌入设备中包含分析和训练有素的模型。最终，分析技术将被嵌入到构成以领域为中心的AIOps的不同监控技术中，以至于以领域为中心的AIOps被包含在多种监控市场的定义中。&lt;/p>
&lt;p>此外，一些供应商正在尝试将领域无关和以领域为中心的方式混合起来，在其孤立的工具之上提供领域诊断的AIOps功能。在日益动态的IT架构中，由于必须更新相关规则的速度，基于规则的事件关联已经让位于基于人工智能的关联（见[使用AIOps的数据驱动方法来提高IT运维监控工具的洞察力]）。&lt;/p>
&lt;h3 id="低准入门槛">低准入门槛
&lt;/h3>&lt;p>开源技术的商品化降低了该领域许多供应商的准入门槛，为数据采集、存储和可视化工具提供了许多选择。这些与领域无关的采集、存储和展示技术相对容易部署和整合，引发了许多以领域为中心的供应商，包括系统集成商和管理服务提供商的产品开发或改进。用于跨指标、追踪和日志领域的诊断数据采集的开源工具，包括 Prometheus、Elastic Beats、Jaeger 和 Fluentd。对于数据可视化，Gartner 遇到了许多利用 Grafana 实现的方案，无论数据存储在哪里。&lt;/p>
&lt;p>尽管 AIOps 尚未成熟，但只要使用案例合适，AIOps 就会被认为是企业内部的一个有价值的工具，并能长期保持持有的状态（见图2）。&lt;/p>
&lt;p>图 2: 组织计划持续使用 CMP 和 AIOps&lt;img src="https://martinliu.cn/img/cos/2021-04-28-Figure_2_Organizations_Plans_to_Continue_Using_CMP_and_AIOps.png"
loading="lazy"
alt="Of the DevOps initiatives organizations began using in response to COVID-19, CMP and AIOps are the ones organizations most intend to continue using."
>&lt;/p>
&lt;h2 id="市场分析">市场分析
&lt;/h2>&lt;p>尽管 AIOp s技术已经存在多年，但成功的部署还需要时间和努力，包括终端用户的结构化路线图。实施通常会遇到一些问题，包括数据摄取、提供上下文相关的分析和较长的价值实现时间。许多 AIOps 平台工具部署的价值实现时间是以月或年计算的，这导致了对该细分市场的不满和幻灭。然而，企业应该毫不怀疑。&lt;/p>
&lt;blockquote>
&lt;p>IT运维的未来不可能不包括 AIOps。这是由于数据量和变化速度的快速增长（以应用交付速度和事件驱动的商业模式为例），不能依靠人类从数据中挖掘出洞见。&lt;/p>&lt;/blockquote>
&lt;p>人类根本不可能对其IT系统每秒产生的成千上万的事件进行理解。&lt;/p>
&lt;p>为了更清楚地了解市场是如何发展的，以及供应商彼此之间的定位，请考虑以下属性。&lt;/p>
&lt;ul>
&lt;li>数据摄取和处理&lt;/li>
&lt;li>机器学习（ML）分析&lt;/li>
&lt;li>补救措施&lt;/li>
&lt;/ul>
&lt;h3 id="数据摄入和处理">数据摄入和处理
&lt;/h3>&lt;p>AIOps 平台必须能够摄取静态（历史）数据和动态（实时、流）数据。这些平台可以摄取、索引和存储日志、事件数据、指标、追踪以及图表和文档数据（见注释2）。&lt;/p>
&lt;p>这些用于IT运维的工具必须直接在摄取点上做实时数据分析，而不需要在分析前将数据保存到数据库。它们还必须提供跨越多个实时和历史数据流的关联分析。&lt;/p>
&lt;h3 id="机器学习分析">机器学习分析
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>AIOps 平台使用以下类型的分析方法。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>统计学、概率分析&lt;/strong> 单变量和多变量分析的结合，包括使用相关、聚类、分类和跨IT实体捕获的指标进行推断。&lt;/li>
&lt;li>&lt;strong>自动模式发现和预测&lt;/strong> 发现隐含描述历史和/或流数据中的相关性的模式、集群或群体。然后，这些模式可用于预测具有不同程度概率的事件。&lt;/li>
&lt;li>&lt;strong>异常检测&lt;/strong> 使用前述组件发现的模式来确定正常行为，然后辨别与正常行为的偏差，包括单变量和多变量。超越了单纯的异常值检测，它们必须与业务影响和其他并发流程（如发布管理）相关联，才能充分发挥作用，而不是产生出更多的告警噪音（见[使用AI技术增强DevOps的决策能力]）。&lt;/li>
&lt;li>&lt;strong>可能原因判定&lt;/strong> 对通过自动模式发现和摄取图数据建立的关联网络进行修剪，以确定连接因果关系的因果关系链。&lt;/li>
&lt;li>&lt;strong>拓扑分析&lt;/strong> AIOps平台可以使用应用程序、网络、基础设施或其他拓扑结构来提供上下文分析。从拓扑结构内的数据中得出的模式将建立相关性，并说明隐藏的依赖关系。将拓扑结构作为因果关系判断的一部分，可以大大增加其准确性和有效性。&lt;/li>
&lt;li>&lt;strong>规范性建议&lt;/strong> 建议解决一个问题的方案。这些建议可能是基于对重复出现的问题的历史解决方案（部落知识）的数据库，或通过众包确定。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="补救措施">补救措施
&lt;/h3>&lt;p>随着技术的成熟，用户将能够利用该平台的建议，实现行动阶段（见注4）。这方面的步骤如图3所示。&lt;/p>
&lt;p>图3: AI 辅助自动化的未来 —问题的分类和补救&lt;img src="https://martinliu.cn/img/cos/2021-04-28-Figure_3_The_Future_of_AI-Assisted_Automation__Triage_and_Remediation_of_Problems.png"
loading="lazy"
alt="Graphic illustrates the problem-remediation process with AI-assisted automation."
>&lt;/p>
&lt;p>图片翻译：&lt;/p>
&lt;p>1 开始于已知的&lt;/p>
&lt;ul>
&lt;li>在一个部落知识库中记录成功的解决方案&lt;/li>
&lt;li>将问题进行分类&lt;/li>
&lt;/ul>
&lt;p>2 当前和历史的对照&lt;/p>
&lt;ul>
&lt;li>在数据库将一类问题与一组已知解决方案进行匹配&lt;/li>
&lt;li>众包&lt;/li>
&lt;/ul>
&lt;p>3 建议&lt;/p>
&lt;ul>
&lt;li>建议一组可能的解决方案&lt;/li>
&lt;/ul>
&lt;p>4 执行和评估&lt;/p>
&lt;ul>
&lt;li>运行解决方案（提供）（ARA/运行手册）&lt;/li>
&lt;li>跟踪解决方案效果&lt;/li>
&lt;li>对效果投票&lt;/li>
&lt;/ul>
&lt;p>一个被称为 &amp;ldquo;自我驱动的ITOM &amp;ldquo;的自动化、闭环的流程是非常令人向往的，但这仍然是一种愿望。在商业工具中，除了那些简单的自动 &amp;ldquo;弹出服务器 &amp;ldquo;或 “创建工单 &amp;ldquo;类型的脚本外，很少看到规范性的解决方案。有可能从规范性工具中获得自动行动的候选者是那些低风险的。这些是那些如果失败或导致意外的副作用，造成的损失相对较小。根据环境的不同，手工的预定操作，如补丁更新，以及执行工作负载优化的行动，如启动一个额外的虚拟机（VM）或容器，可能是成功的。&lt;/p>
&lt;h4 id="价值实现时间">价值实现时间
&lt;/h4>&lt;p>Gartner 客户的一个共同抱怨是，部署、配置和从AIOps解决方案中获取价值所需的时间可能长达六个月，在极端情况下，可能长达两年。AIOps是一项新兴技术，这意味着该领域的最佳实践仍在不断发展。但是，当潜在的回报在时间跨度上如此遥远时，企业不愿意投资于一个产品。&lt;/p>
&lt;p>为了应对这种情况，供应商正在采取举措，加快部署速度。这些措施包括。&lt;/p>
&lt;ul>
&lt;li>转向基于SaaS的部署&lt;/li>
&lt;li>改进通用接口的开箱即用的集成方式&lt;/li>
&lt;li>基于现场测试的最佳实践，在系统中建立可重复的工作流&lt;/li>
&lt;li>减少系统产生的误报数量&lt;/li>
&lt;/ul>
&lt;p>在为AIOps的投资回报建立商业案例时，I&amp;amp;O 领导人必须与供应商讨论其实施的预期价值时间。在许多情况下，预计会有一个有限的概念验证，以证明集成在现实环境中如何运作。&lt;/p>
&lt;h4 id="devops-中的-aiops">DevOps 中的 AIOps
&lt;/h4>&lt;p>作为IT运维工具与DevOps流水线整合的 &amp;ldquo;左移 &amp;ldquo;大趋势的一部分，早期采用者正在开发流水线的早期尝试AIOps。结合越来越多的自动化使用，开发人员正在使用人工智能来更快、更安全地交付软件，在生产中更容易管理。图4显示了AIOps 存在于 DevOps 流水线中的例子。
图4：在应用程序的生命周期中，在一系列的使用案例中应用AIOps平台&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-04-28-Figure_4_Applying_AIOps_Platforms_Across_a_Spectrum_of_Use_Cases_Over_the_Life_Cycle_of_an_Application.png"
loading="lazy"
alt="Graphic illustrates how to apply AIOps throughout an application’s nonexistent, from development through IT service management."
>&lt;/p>
&lt;p>图片翻译：&lt;/p>
&lt;ol>
&lt;li>识别代码中的风险&lt;/li>
&lt;li>日志文件分析&lt;/li>
&lt;li>时间关联、异常分析，RCA&lt;/li>
&lt;li>数字化代理（智能客服）/自动化，变更&lt;/li>
&lt;/ol>
&lt;p>NLP 在 ITSM 工具中被大量采用，但一些APM供应商已经开始将NLP作为其AIOps能力的一部分。一个主要目标是为DevOps团队实现更灵活的ChatOps，并为APM数据和自动化提供更好的接口。&lt;/p>
&lt;h2 id="代表性厂商">代表性厂商
&lt;/h2>&lt;h3 id="市场介绍">市场介绍
&lt;/h3>&lt;p>AIOps平台供应商拥有广泛的功能，并在继续增长。供应商在其数据摄取和开箱即用的用例方面存在差异，只需最小的配置即可使用。在表1中，我们提供了一个有代表性的供应商样本列表，提供领域无关的AIOps平台功能。该表中的一些供应商也提供以领域为中心的产品。&lt;/p>
&lt;p>表2包括以领域为中心的AIOps供应商，在某些情况下，他们专注于一个以上的领域。随着AIOps功能开始成为APM和ITSM等不同领域的决定性特性，Gartner将在本市场指南的未来版本中关注领域无关的AIOps供应商。&lt;/p>
&lt;p>表1: 领域无关的AIOps平台市场的代表厂商&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: center">&lt;strong>厂商&lt;/strong>&lt;/th>
&lt;th style="text-align: center">&lt;strong>产品,服务或者解决方案&lt;/strong> &lt;strong>名称&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.bigpanda.io/" target="_blank" rel="noopener"
>BigPanda&lt;/a>&lt;/td>
&lt;td style="text-align: center">BigPanda&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.bmc.com/" target="_blank" rel="noopener"
>BMC&lt;/a>&lt;/td>
&lt;td style="text-align: center">TrueSight Operations Management, Helix Platform&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.broadcom.com/" target="_blank" rel="noopener"
>Broadcom-CA Technologies&lt;/a>&lt;/td>
&lt;td style="text-align: center">DX Operational Intelligence&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.devo.com/" target="_blank" rel="noopener"
>Devo&lt;/a> (formerly Logtrust)&lt;/td>
&lt;td style="text-align: center">Devo&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://digitate.com/" target="_blank" rel="noopener"
>Digitate&lt;/a>&lt;/td>
&lt;td style="text-align: center">ignio&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.elastic.co/" target="_blank" rel="noopener"
>Elastic&lt;/a>&lt;/td>
&lt;td style="text-align: center">Elasticsearch&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.ibm.com/" target="_blank" rel="noopener"
>IBM&lt;/a>&lt;/td>
&lt;td style="text-align: center">IBM Cloud Pak for Watson AIOps&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.interlinksoftware.com/" target="_blank" rel="noopener"
>Interlink Software&lt;/a>&lt;/td>
&lt;td style="text-align: center">Interlink Software&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://logz.io/" target="_blank" rel="noopener"
>Logz.io&lt;/a>&lt;/td>
&lt;td style="text-align: center">Log Management&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.moogsoft.com/" target="_blank" rel="noopener"
>Moogsoft&lt;/a>&lt;/td>
&lt;td style="text-align: center">Moogsoft&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.pagerduty.com/" target="_blank" rel="noopener"
>PagerDuty&lt;/a>&lt;/td>
&lt;td style="text-align: center">PagerDuty&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="http://servicenow.com/" target="_blank" rel="noopener"
>ServiceNow&lt;/a>&lt;/td>
&lt;td style="text-align: center">IT Operations Management (ITOM)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.splunk.com/" target="_blank" rel="noopener"
>Splunk&lt;/a>&lt;/td>
&lt;td style="text-align: center">Splunk Enterprise, Splunk Cloud&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.stackstate.com/" target="_blank" rel="noopener"
>StackState&lt;/a>&lt;/td>
&lt;td style="text-align: center">StackState&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.sumologic.com/" target="_blank" rel="noopener"
>Sumo Logic&lt;/a>&lt;/td>
&lt;td style="text-align: center">Sumo Logic&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;/td>
&lt;td style="text-align: center">&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Source: Gartner (April 2021)&lt;/p>
&lt;p>表2: 以领域为中心的AIOps平台市场的代表厂商&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: center">&lt;strong>厂商&lt;/strong>&lt;/th>
&lt;th style="text-align: center">&lt;strong>产品,服务或者解决方案&lt;/strong> &lt;strong>名称&lt;/strong>&lt;/th>
&lt;th style="text-align: center">&lt;strong>供应商擅长的领域&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://aisera.com/" target="_blank" rel="noopener"
>Aisera&lt;/a>&lt;/td>
&lt;td style="text-align: center">Aisera&lt;/td>
&lt;td style="text-align: center">ITSM&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.cisco.com/" target="_blank" rel="noopener"
>Cisco&lt;/a>&lt;/td>
&lt;td style="text-align: center">AppDynamics&lt;/td>
&lt;td style="text-align: center">APM&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="http://datadoghq.com/" target="_blank" rel="noopener"
>Datadog&lt;/a>&lt;/td>
&lt;td style="text-align: center">Datadog APM&lt;/td>
&lt;td style="text-align: center">APM&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://digital.ai/" target="_blank" rel="noopener"
>Digital.ai&lt;/a>&lt;/td>
&lt;td style="text-align: center">Numerify&lt;/td>
&lt;td style="text-align: center">ITSM&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.dynatrace.com/" target="_blank" rel="noopener"
>Dynatrace&lt;/a>&lt;/td>
&lt;td style="text-align: center">Dynatrace&lt;/td>
&lt;td style="text-align: center">APM, ITIM&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.espressive.com/" target="_blank" rel="noopener"
>Espressive&lt;/a>&lt;/td>
&lt;td style="text-align: center">Barista Case Management&lt;/td>
&lt;td style="text-align: center">ITSM&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.extrahop.com/" target="_blank" rel="noopener"
>ExtraHop&lt;/a>&lt;/td>
&lt;td style="text-align: center">ExtraHop Reveal(x) for IT Operations&lt;/td>
&lt;td style="text-align: center">NPMD&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://harness.io/" target="_blank" rel="noopener"
>Harness&lt;/a>&lt;/td>
&lt;td style="text-align: center">Continuous Integration, Continuous Delivery, Continuous Efficiency Platforms&lt;/td>
&lt;td style="text-align: center">DevOps&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://amelia.com/about/" target="_blank" rel="noopener"
>IPsoft (Amelia)&lt;/a>&lt;/td>
&lt;td style="text-align: center">DigitalWorkforce.ai Platform&lt;/td>
&lt;td style="text-align: center">ITSM&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.kentik.com/" target="_blank" rel="noopener"
>Kentik&lt;/a>&lt;/td>
&lt;td style="text-align: center">Kentik&lt;/td>
&lt;td style="text-align: center">NPMD&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.overops.com/" target="_blank" rel="noopener"
>OverOps&lt;/a>&lt;/td>
&lt;td style="text-align: center">OverOps&lt;/td>
&lt;td style="text-align: center">Dev&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.pico.net/" target="_blank" rel="noopener"
>Pico&lt;/a>&lt;/td>
&lt;td style="text-align: center">Corvil&lt;/td>
&lt;td style="text-align: center">NPMD&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://newrelic.com/" target="_blank" rel="noopener"
>New Relic&lt;/a>&lt;/td>
&lt;td style="text-align: center">New Relic One Platform&lt;/td>
&lt;td style="text-align: center">APM, ITIM&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.opsramp.com/" target="_blank" rel="noopener"
>OpsRamp&lt;/a>&lt;/td>
&lt;td style="text-align: center">OpsRamp&lt;/td>
&lt;td style="text-align: center">ITIM&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://sciencelogic.com/" target="_blank" rel="noopener"
>ScienceLogic&lt;/a>&lt;/td>
&lt;td style="text-align: center">SL1 Platform&lt;/td>
&lt;td style="text-align: center">ITIM&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.virtana.com/" target="_blank" rel="noopener"
>Virtana&lt;/a>&lt;/td>
&lt;td style="text-align: center">Virtana Platform&lt;/td>
&lt;td style="text-align: center">ITIM&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;a class="link" href="https://www.gartner.com/doc/zenoss.com" target="_blank" rel="noopener"
>Zenoss&lt;/a>&lt;/td>
&lt;td style="text-align: center">Zenoss&lt;/td>
&lt;td style="text-align: center">ITIM&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">&lt;/td>
&lt;td style="text-align: center">&lt;/td>
&lt;td style="text-align: center">&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Source: Gartner (April 2021)&lt;/p>
&lt;p>*本市场指南中所列的供应商并不意味着是一份详尽的清单。本节旨在提供对市场及其产品的更多了解。&lt;/p>
&lt;h2 id="市场建议">市场建议
&lt;/h2>&lt;h3 id="使用一个自上而下的-aiops-框架">使用一个自上而下的 AIOps 框架
&lt;/h3>&lt;p>AIOps的使用案例跨越了从IT操作员到业务线所有者甚至CEO的各个层次。&lt;/p>
&lt;p>在实践中，这些平台只具备开箱即用的异常检测和事件关联能力。这意味着对IT操作员来说，开箱即用的相关性相当高，而终端用户必须创造与人员相关的结果，如 I&amp;amp;O 领导、系统管理员、架构师和LOB所有者。&lt;/p>
&lt;p>该平台的分析能力利用算法和模型来支持基于数据集的结果，这些数据集可能质量差、不完整且缺乏统一性。结果并不总是通用或相似的；因此，算法的价值是有限的。由于IT的复杂性和不断变化的性质，即使是AIOps平台所利用的模型，如果没有持续的反馈机制，也会失去相关性。&lt;/p>
&lt;p>**例如，在监控策略中，确定AIOps如何将数据转化为与目标人物的相关性，以及如何帮助解决各自人物的目的（见注5）。随后，从IT运维中的可视化现状开始，描绘出通往目标的以下步骤（见[采用AIOps的解决方案路径]）。&lt;/p>
&lt;ul>
&lt;li>以最终目标为起点的目标路线图&lt;/li>
&lt;li>通向目标的中间步骤&lt;/li>
&lt;li>IT运维的现有状态（噪音事件、基于静态阈值的告警或利用动态阈值）&lt;/li>
&lt;/ul>
&lt;p>选择最适合为路线图上的第一步提供开箱即用功能的AIOps供应商，并提供符合组织路线图的平台（例如，帮助组织以最小的努力从事件关联推进到动态阈值到行为分析）。随着用例的成熟，请注意这些平台的可移植性挑战（见注6）。&lt;/p>
&lt;h3 id="基于洞见的自动化">基于洞见的自动化
&lt;/h3>&lt;p>一些企业有一个目标，导致对已发现的异常情况进行自动化补救。任何自动化举措都是基于一定程度的标准化。这是大规模部署自动化行动的一个主要抑制因素。成熟度高的IT组织更喜欢自动化的洞察力，而不是自动化的行动，这是一个切实的目标。I&amp;amp;O领导应该优先考虑那些能减少IT操作人员视觉负担的工具。例如，AIOps平台应该强调出需要人类关注的领域，而不是对多个图表进行可视化分析。&lt;/p>
&lt;p>COVID-19疫情要求企业从根本上改变排查方式和采用AIOps用例的方式，因为向居家工作的转变暴露了现有做法的缺点。例如，在运维中心，有人会提出一个 &amp;ldquo;问题&amp;rdquo;，不同的小组会大声喊出他们对 &amp;ldquo;答案 &amp;ldquo;的看法。高管们看到了一个机会，在起草一个能够长期保持的战略时，重新审视综合运维工具、流程和人员的基本方面（见注5的图5）。&lt;/p>
&lt;p>在2019年，Gartner的客户有一个理想的目标，即设计与LOB所有者相关的仪表盘。这个过程中，一些企业花了10个月到两年的时间。两个主要因素是透明度和用于使业务领导人推动决策的上下文信息，与旨在让业务领导人了解情况的报告相比。疫情大流行开始后，大多数企业关注基本面和减少风险，把自己限制在现有的开箱即用的用例上，如事件关联性。在COVID-19大流行之前，Gartner看到企业提出了理想的目标，而这些目标在今天的AIOps工具中可能还没有开箱即用。&lt;/p>
&lt;h3 id="与不同角色的关联性">与不同角色的关联性
&lt;/h3>&lt;p>AIOps平台被不同的团队采用，如DevOps、SRE、IT运维、网络安全（见[安全信息和事件管理魔力象限]），以及业务领导人。所需的用例和原始数据根据采用该平台的团队及其成熟度而不同。&lt;/p>
&lt;p>DevOps团队主要专注于日志摄取和分析。随着DevOps实践的成熟，用例从对生产前的关注扩大到包括用户参与、质量和业务相关性等生产指标。这就产生了对新的KPI的需求，在多个版本之间进行比较，并关注产品和平台。考虑到这种情况，选择能够摄取埋点的数据（追踪、指标和日志）的平台，并减轻为DevOps提供平台和产品视图的工作。&lt;/p>
&lt;p>IT运维团队通常需要指标和日志摄取的组合，然后是分析。这个过程从事件关联开始，随着团队的成熟，扩大到基于指标和日志分析的行为分析。这里的主要目标是异常检测和诊断信息，然后是根本原因分析。其他用例包括通过使用脚本的自动行动，其中AIOps识别与自动行动相关的触发器。选择那些能够灵活地摄取事件、日志和指标的平台，并为I&amp;amp;O的至少一个优先用例提供开箱即用的功能。&lt;/p>
&lt;p>企业领导更关注用户参与度，而应用性能只是影响整体参与度的一个参数。在一些全球性的组织中，业务领导已经不再区分员工和客户，所以这里的 &amp;ldquo;用户 &amp;ldquo;既指员工也指客户。这个旅程通常从基于IT的用户影响的相关性开始，但扩大到包括技术、人员和现有流程的效率和生产力等定性的关键绩效指标。在成熟的组织中，更好的参与而不是减员是这种关键绩效指标背后的驱动力。对于这样的场景，选择专注于聚类和人口统计学的平台，并在不同的数据集上提供因果洞察力，包括情感和满意度。&lt;/p>
&lt;p>SRE实践通常有与IT运维和DevOps用例重叠的目标。通常，这些都是跨越两个实践的成熟用例。例如，事件关联和日志摄取不是SRE团队的主要目标。他们的重点领域包括IT架构评估。对于SRE用例，选择为IT架构提供实时拓扑和依赖性洞见的平台作为主要用例之一。&lt;/p>
&lt;h2 id="首字母缩写词和词汇表术语">首字母缩写词和词汇表术语
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>APM&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Application performance monitoring&lt;/strong> 应用性能监控&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>BAM&lt;/td>
&lt;td>Business activity monitoring 业务活动监控&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>DA&lt;/td>
&lt;td>Domain-agnostic 领域无关&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>DC&lt;/td>
&lt;td>Domain-centric 领域为中心&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ITIM&lt;/td>
&lt;td>IT infrastructure monitoring IT 基础架构监控&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ITOM&lt;/td>
&lt;td>IT operations management IT 运维管理&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ITSM&lt;/td>
&lt;td>IT service monitoring IT 服务监控&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>NLP&lt;/td>
&lt;td>Natural language processing 自然语言处理&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>NPMD&lt;/td>
&lt;td>Network performance monitoring and diagnostics 网络性能监控和诊断&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>SIEM&lt;/td>
&lt;td>Security information and event management 安全信息和事件管理&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="证据">证据
&lt;/h2>&lt;p>&lt;strong>1&lt;/strong> &lt;strong>Gartner的2020年通过自动化、持续质量和DevOps实现业务敏捷性研究&lt;/strong>于2020年6月至8月在北美和西欧已部署或正在使用DevOps的服务提供商、云供应商和终端用户组织工作的205名受访者中进行了在线调查。符合条件的组织的年收入至少为5亿美元，并要求主要在银行和金融服务、政府、保险、医疗机构和零售业中运维。受访者必须在其组织的IT职能部门工作，其职称低于C-suite级别，并且与组织中的最高主管相差两层或更多。受访者的角色必须主要集中在应用开发、基础设施和运维，或商业智能和信息管理。在这些重点领域，他们还被要求执行相关的角色/活动。这项研究是由关注数字商业趋势的Gartner分析师和Gartner的研究数据和分析团队合作开发的。&lt;/p>
&lt;p>这项研究的结果并不代表全球调查结果或整个市场，而是反映受访者和受访公司的情绪。&lt;/p>
&lt;p>在过去的12个月里，AIOps构成了Gartner客户关于IT性能分析的所有咨询中的40%的谈话内容。这些咨询的主题包括。&lt;/p>
&lt;ul>
&lt;li>技术和市场意识&lt;/li>
&lt;li>平台选择&lt;/li>
&lt;li>构建与购买决策&lt;/li>
&lt;li>现有AIOps部署的优化&lt;/li>
&lt;li>新部署情况下的部署策略&lt;/li>
&lt;li>在DevOps、I&amp;amp;O、安全和SRE团队之间共享一个共同平台的利与弊&lt;/li>
&lt;li>IT内部和外部的多种AIOps使用案例，以帮助可视化、决策和诊断。&lt;/li>
&lt;/ul>
&lt;p>在大流行病中，大多数用例都与事件关联有关。&lt;/p>
&lt;h2 id="注1-代表性供应商选择">注1: 代表性供应商选择
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>本研究中列出的供应商是根据具有以下一个或两个特征而挑选出来的样本。&lt;/p>
&lt;ul>
&lt;li>领域无关的解决方案，能够从多个来源摄取数据，包括历史和实时流。&lt;/li>
&lt;li>以领域为中心的解决方案，能够从特定领域或特定框架或实践的数据中摄取数据（例如，网络、应用、IT基础设施、DevOps或ITSM领域）。&lt;/li>
&lt;li>不同的产品，包括专有的、开源的、免费的和商业化的版本，包括跨越企业内部和基于SaaS的部署方案。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="注2--aiops-平台的数据源">注2: AIOps 平台的数据源
&lt;/h2>&lt;p>AIOps 的数据源包括:&lt;/p>
&lt;ul>
&lt;li>API&lt;/li>
&lt;li>Application logs 应用日志&lt;/li>
&lt;li>CRM 数据&lt;/li>
&lt;li>客户数据&lt;/li>
&lt;li>事件&lt;/li>
&lt;li>图&lt;/li>
&lt;li>ITSM&lt;/li>
&lt;li>元数据&lt;/li>
&lt;li>指标&lt;/li>
&lt;li>社交媒体&lt;/li>
&lt;li>追踪&lt;/li>
&lt;li>布线&lt;/li>
&lt;/ul>
&lt;p>不幸的是，无论一个给定的数据集有多大，更新有多频繁，限制在一个单一的数据源往往会限制对系统行为的洞察力。现代IT系统&amp;ndash;具有模块化和动态性&amp;ndash;需要一个多视角的方法来理解它们在被观察时正在发生什么。&lt;/p>
&lt;h2 id="注-3-领域无关和领域中心的aiops">注 3: 领域无关和领域中心的AIOps
&lt;/h2>&lt;p>**领域无关的AIOps -**供应商以通用的AIOps平台进入市场。这些产品往往主要依靠监控工具来执行数据采集，并迎合最广泛的使用情况。&lt;/p>
&lt;p>**领域中心的AIOps -**供应商拥有核心组件，但是一组有限的使用场景。以他们基本上做着与以前相同的事情，但现在他们用数学（算法）代替了规则、启发式方法和指纹。这些供应商专注于一个领域（例如，网络、端点系统或APM）。然而，以领域为中心的解决方案供应商已经做出了一些努力，将这些类别混合起来，发展到从他们自己的埋点工具以外的来源摄取数据，并将这些数据纳入他们的分析。&lt;/p>
&lt;h2 id="注4-基于规范性建议的自动化行动所面临的挑战">注4: 基于规范性建议的自动化行动所面临的挑战
&lt;/h2>&lt;p>自动化执行行动分为多个类别。&lt;/p>
&lt;ul>
&lt;li>可以提前计划的预定性质的任务（例如，补丁管理或新构建的部署）。&lt;/li>
&lt;li>不能提前计划好的任务，但有已知的触发器，可能会或不可能经常出现。在这种情况下，程序是有据可查的（例如，虚拟化环境中的工作负载优化）。&lt;/li>
&lt;li>具有不可预测的触发器的任务，其行动是众所周知的，但没有很好的文件记录（例如，已知的异常情况）。&lt;/li>
&lt;/ul>
&lt;p>I&amp;amp;O领导通常不希望将行动完全交给机器，并要求在触发自动化之前至少有一个验证步骤。这种缺乏信任是阻碍自动化行动普遍使用的主要障碍之一。&lt;/p>
&lt;p>在这三种自动化行动中，我们看到对第三类行动的兴趣最大；然而，处理这类行动的技术困难是具有挑战性的，因此，到目前为止，它的采用是最小的。&lt;/p>
&lt;h2 id="注5-aiops-作为-it-监控策略的一部分">注5: AIOps 作为 IT 监控策略的一部分
&lt;/h2>&lt;p>Figure 5: AIOps as Part of an IT Monitoring Strategy&lt;img src="https://martinliu.cn/img/cos/2021-04-28-Figure_5_AIOps_as_Part_of_an_IT_Monitoring_Strategy.png"
loading="lazy"
alt="Where AIOps Contributes to a Sample IT Monitoring Strategy"
>&lt;/p>
&lt;h2 id="注-6-可移植性">注 6: 可移植性
&lt;/h2>&lt;p>随着企业采用AIOps的功能模型和质量成果的成熟，供应商转换变得困难。切换到不同的供应商来复制现有的高质量仪表盘将需要时间，这就消除了通过直接成本节约获得的任何价值。Gartner观察到，在部署比较成熟的企业中，正是因为这个原因，才不愿意在续约时更换供应商。&lt;/p>
&lt;p>需要可行的选择来挑战现有的供应商，这就产生了关于跨供应商的算法的可移植性问题。这种需求来自于一些成熟的企业，在这些企业中，AIOps的采用已经很成熟。市场仍处于高速增长阶段，我们至少要在几年后才能看到企业对可移植性的压力增加，以及供应商作为差异化的回应。&lt;/p>
&lt;p>一些供应商正在提出转移学习，这仍然处于初级阶段。在其较简单的形式中，终端用户可以选择通过使用历史数据训练一个选定的模型。该算法的结果与实时结果进行比较。一旦结果显示出相当的准确性和可接受的误差范围，终端用户就可以使用相同的算法来分析实时数据。这种能力在生产前和生产环境之间或在边缘和数据中心环境之间效果最好。更复杂的用例的演变将需要供应商和最终用户方面的成熟和高级技能。&lt;/p></description></item><item><title>对不起Scrum，你的游戏可能已经结束了!</title><link>https://martinliu.cn/blog/sorry-scrum-the-game-might-be-over-for-you-cn/</link><pubDate>Sat, 10 Apr 2021 22:21:29 +0800</pubDate><guid>https://martinliu.cn/blog/sorry-scrum-the-game-might-be-over-for-you-cn/</guid><description>&lt;img src="https://martinliu.cn/img/cos/2021-04-10-0_IFV2UEaD1Vj4S_to.jpg" alt="Featured image of post 对不起Scrum，你的游戏可能已经结束了!" />&lt;p>我们不可能忽视 Scrum 的知名度。多年来，Scrum 是全球大多数公司在敏捷框架中的首选；只有少数公司会挑战它。但最近，发生了一些变化，组织正在失去对Scrum的信任。在未能获得有意义的结果之后，在许多地方，人们正在用 SAFe、Kanban 或其他框架取代 Scrum。&lt;/p>
&lt;p>除了这些不满 Scrum 的组织，有些经验丰富的专业人士也不愿意与Scrum共舞。很多人甚至觉得被称为产品经理（Product Owner）或 Scrum Master 都很尴尬。市场正在向新的方向转变，Scrum还会有空间吗？&lt;/p>
&lt;blockquote>
&lt;p>公司想做敏捷，但他们难以放弃旧的指令和管控风格。&lt;/p>&lt;/blockquote>
&lt;p>让我来阐述一下，为什么我认为 Scrum 的游戏可能已经结束了。
&lt;em>请注意 这篇文章的内容是基于我过去十年的经验和观察。这也是为什么我邀请你也分享你的观点。&lt;/em>&lt;/p>
&lt;h2 id="作者">作者
&lt;/h2>&lt;p>本文出处：&lt;a class="link" href="https://medium.com/serious-scrum/sorry-scrum-the-game-might-be-over-for-you-915227f3a0d" target="_blank" rel="noopener"
>https://medium.com/serious-scrum/sorry-scrum-the-game-might-be-over-for-you-915227f3a0d&lt;/a>&lt;/p>
&lt;p>作者：&lt;a class="link" href="https://medium.com/@davidavpereira?source=post_sidebar--------------------------post_sidebar-----------" target="_blank" rel="noopener"
>David Pereira&lt;/a> Head of Product Management @virtualidentity Course: How to be a strong Product Owner: &lt;a class="link" href="http://bit.ly/30ylNEH" target="_blank" rel="noopener"
>http://bit.ly/30ylNEH&lt;/a>&lt;/p>
&lt;h2 id="scrum不是一个流程">Scrum不是一个流程
&lt;/h2>&lt;p>第一个软件是在1948年才出现的，那时候软件开发还是个新鲜事物。我猜汤姆-基尔本无法想象软件开发会给世界带来多么快的进步。&lt;/p>
&lt;blockquote>
&lt;p>计算机科学家汤姆-基尔本负责编写了世界上第一个软件，该软件于1948年6月21日上午11时在英国曼彻斯特大学运行。&lt;em>—&lt;/em>&lt;/p>
&lt;p>&lt;a class="link" href="https://medium.com/u/ec2848c0389?source=post_page-----915227f3a0d--------------------------------" target="_blank" rel="noopener"
>Micah Yost&lt;/a>&lt;em>,&lt;/em> &lt;a class="link" href="https://medium.com/@micahyost/a-brief-history-of-software-development-f67a6e6ddae0" target="_blank" rel="noopener"
>A Brief History of Software Development&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>在新千禧年之前，公司缺乏符合客户期望的技术。大多数公司专注于围绕软件开发改进流程。尽管所有的努力都是为了实施像 &lt;a class="link" href="https://en.wikipedia.org/wiki/Rational_Unified_Process" target="_blank" rel="noopener"
>Rational Unified Process&lt;/a>统一流程这样的重磅流程，但质量还是有问题，客户也还是不满意。构建无用的软件让许多人感到沮丧；软件行业需要一场革命。&lt;/p>
&lt;p>虽然像 &lt;a class="link" href="https://warren2lynch.medium.com/the-brief-of-history-of-scrum-15efb73b4701" target="_blank" rel="noopener"
>Scrum&lt;/a> 和 &lt;a class="link" href="https://en.wikipedia.org/wiki/Extreme_programming" target="_blank" rel="noopener"
>e&lt;strong>X&lt;/strong>treme &lt;strong>P&lt;/strong>rogramming&lt;/a> 这样的敏捷框架已经存在许久，但在2001年《敏捷宣言》-（&lt;a class="link" href="https://agilemanifesto.org/" target="_blank" rel="noopener"
>Agile Manifesto&lt;/a>）出台后，才大大改变了全球软件的开发方式。在那之后，Scrum框架成为最受欢迎的替代品。&lt;/p>
&lt;p>从千禧年的初期情况来看，Scrum 能解决软件开发的所有问题吗？我们必须去了解问题的根本原因，但很多公司忽略了这一步，反而求助于寻找新的流程。仅仅依靠替换人们工作方式的流程是不够的。这就是大多数组织未能从Scrum 中获益的原因。&lt;/p>
&lt;blockquote>
&lt;p>根本原因不是流程，而是缺乏敏捷的思维方式。&lt;/p>&lt;/blockquote>
&lt;p>我们以足球为例，在瓜迪奥拉(Pep Guardiola)的领导下，巴塞罗那在4年内赢得了14个冠军。从2008年到2012年，巴塞罗那绝对是世界上最强的足球队。很多人将成功归功于瓜迪奥拉执教球队的方式。其中一个显著的方面是主导比赛；巴塞罗那经常拥有70%以上的控球率。这是否意味着将 &lt;a class="link" href="https://en.wikipedia.org/wiki/Tiki-taka" target="_blank" rel="noopener"
>&amp;ldquo;Tiki Taka &amp;ldquo;&lt;/a> 运用到另外一支球队后，他们就能达到类似的效果呢？&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-04-10-1_0UHTWnUk-eJ16jd7vGqPXw.png"
loading="lazy"
>&lt;/p>
&lt;p>瓜迪奥拉从2013年到2016年执教拜仁慕尼黑，他应用了和巴塞罗那一样的风格。然而，所取得的成功与巴萨不相上下；在拜仁慕尼黑，他获得了5个国家冠军，却没有获得欧冠冠军。要想实现伟大的成就，仅仅靠一个‘流程’是不够的，还需要其它更多的东西。&lt;/p>
&lt;p>把Scrum当做流程的公司都失败了。如果还没有更重大的改变，任何敏捷框架都无法带领团队走向成功。除非公司解决了他们的组织型障碍（dysfunctions），否则环境不会让团队发挥的更出色。&lt;/p>
&lt;p>我观察过很多虚弱无力的 Scrum 团队，因为环境的组织型障碍。最常见的组织障碍是。&lt;/p>
&lt;ul>
&lt;li>缺乏信任&lt;/li>
&lt;li>缺少方向&lt;/li>
&lt;li>根据职位确定优先次序&lt;/li>
&lt;li>微观管理（micromanagement）&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>对于这些有组织型障碍的公司来说，Scrum应用失效是不可避免的。最后，Scrum还要背这个锅。&lt;/p>&lt;/blockquote>
&lt;p>Scrum 框架并不适合畏惧改变的组织。不改变其文化，就不可能用 Scrum 取得成功。许多人对 Scrum 的角色、事件和工件了如指掌，但很少有人知道背后的价值观。如果不活用 Scrum 背后的价值观，就不可能实现 Scrum 的承诺。&lt;/p>
&lt;h2 id="为什么scrum即将崩塌">为什么Scrum即将崩塌？
&lt;/h2>&lt;p>Scrum 自称简单易行，其实很难掌握。几乎我认识的每个人都同意这句话，然而，我要质疑 Scrum 有多简单。框架的一个关键部分经常被忽略，试着问一些团队的价值观是什么？你会惊讶的发现，几乎没有人知道。不过，价值观仍然是 Scrum 的一个关键部分。&lt;/p>
&lt;blockquote>
&lt;p>Scrum 的成功使用取决于人们是否能更熟练地运用这五种价值观。
&lt;strong>承诺、专注、开放、尊重和勇气。&lt;/strong>&lt;/p>
&lt;p>&lt;em>—&lt;/em> &lt;a class="link" href="https://www.scrumguides.org/scrum-guide.html" target="_blank" rel="noopener"
>The Scrum Guide&lt;/a>&lt;em>, November 2020&lt;/em>&lt;/p>&lt;/blockquote>
&lt;p>当组织把 Scrum 当作一个流程来实施时，挫折是不可避免的。从设计上看，Scrum 是不完整的，没有一个团队能够在不适应其场景的情况下取得成功。例如，产品管理并不是 Scrum 的一部分，然而，它却是交付有意义产品的关键学科。&lt;/p>
&lt;p>要想利用 Scrum 获得成功，组织必须经历一场大规模的转型。不幸的是，大多数高管都不愿意去准备一个能让团队茁壮成长的环境。我在企业中遇到过以下几种范式。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>赋权 vs. 微观管理&lt;/p>
&lt;/li>
&lt;li>
&lt;p>成果 vs. 产出&lt;/p>
&lt;/li>
&lt;li>
&lt;p>协调/对齐 vs. 共识&lt;/p>
&lt;/li>
&lt;li>
&lt;p>承担风险 vs. 遵循计划&lt;/p>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>&amp;ldquo;高层管理者们认为，拥有真正自我管理的团队风险太大。这就是为什么 Scrum 会遇到玻璃天花板的原因。&amp;rdquo;
&lt;em>—&lt;/em> &lt;a class="link" href="https://medium.com/u/a55fee07a2c4?source=post_page-----915227f3a0d--------------------------------" target="_blank" rel="noopener"
>&lt;em>Willem-Jan Ageling&lt;/em>&lt;/a>&lt;em>,&lt;/em> &lt;a class="link" href="https://medium.com/serious-scrum/scrum-has-hit-the-glass-ceiling-3610bb978b1d" target="_blank" rel="noopener"
>&lt;em>Scrum Has Hit the Glass Ceiling&lt;/em>&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>高层管理人员们往往无法充分给个人授权，因为他们想继续自己的控制。所以他们才会走捷径。首先，改变执行力。然后，如果 Scrum 证明了它的价值，那再来改变文化。好吧，这样做是行不通的，结果是大家都很沮丧。当Scrum 变成了一个过场（译者注：此处突出一下形同虚设的空架子流程的含义，请酌情理解），角色就会变异成毫无意义的东西。让我来分享一下我的一些心得。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-04-10-0-vZwKs-yTiUrjsf1F.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>Photo by &lt;a class="link" href="https://unsplash.com/@miteneva?utm_source=medium&amp;amp;utm_medium=referral" target="_blank" rel="noopener"
>Maria Teneva&lt;/a> on &lt;a class="link" href="https://unsplash.com/?utm_source=medium&amp;amp;utm_medium=referral" target="_blank" rel="noopener"
>Unsplash&lt;/a>&lt;/p>
&lt;h2 id="产品负责人经理product-owner">产品负责人/经理（Product owner）
&lt;/h2>&lt;p>如果不能对优先级负责，产品负责人就会像服务员一样。他们接受订单，建议配菜，然后把订单交给厨房。做一个接单员是令人沮丧的，你唯一的义务是管理利益相关者的期望，并用做和开发人员沟通的桥梁。&lt;/p>
&lt;p>不幸的是，与产品负责人角色的变异更多的是规则而不是例外。这就是为什么我在想，是否有人可以成为 Scrum产品负责人。当我回顾我的职业生涯时，也许我曾经就差点变成这样的人，但从来没有像 Scrum 指南所推荐的那样，被完全的授权过。我的问题是：Scrum产品负责人在现实的企业中存在吗？&lt;/p>
&lt;blockquote>
&lt;p>你能举出多少家公司的产品负责人真正的完全拥有产品决策的最终决定权？如果他们没有最终决定权，这些人还是产品负责人吗？然而，有成千上万的人声称自己是产品所有者，却不拥有任何产品。&lt;em>—&lt;/em>&lt;/p>
&lt;p>&lt;a class="link" href="https://medium.com/u/b40569a4ce51?source=post_page-----915227f3a0d--------------------------------" target="_blank" rel="noopener"
>Maarten Dalmijn&lt;/a> &lt;em>,&lt;/em> &lt;a class="link" href="https://medium.com/serious-scrum/will-the-real-product-owner-please-stand-up-951917cf7b18" target="_blank" rel="noopener"
>Will the real Product Owner please stand up?&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>在反模式之上，我注意到很多有产品思维的人对产品负责人这个角色失去了兴趣。他们觉得很难把它和产品经理联系起来。虽然公司经常雇佣产品负责人，但由于 Marty Cagan 所推崇的看法，很多专业人士都不好意思这样称呼，他声称产品负责人不是一份工作，而是一个角色，而且这份工作比 Scrum 所建议的要多得多。&lt;/p>
&lt;h2 id="开发人员">开发人员
&lt;/h2>&lt;p>开发者是决定实际如何开展工作的人，他们负责实现，使用哪种技术栈，等等。这是一个美丽的幻觉（理论）。但在实践中，我从未见过这种情况。常见的是有一个首席技术官（CTO），一个技术负责人，或者其他头衔的什么人，他们不仅要来做决策，还要管理开发者。&lt;/p>
&lt;p>Scrum 所宣称的开发者有自主权，但他们得到了吗？我认为自主的情况很少见。说起来也很悲哀，但大多数开发者所收到的命令都是要遵守的；只是很少有开发者被授权在没有截止日期的情况下解决问题。&lt;/p>
&lt;blockquote>
&lt;p>Scrum 开发者在幻想世界中可能会和 Scrum产品所有者工作在一起，但在现实中却不是。我们最常见的是开发者被封印在了特性工厂里。&lt;/p>&lt;/blockquote>
&lt;h2 id="scrum-master">Scrum Master
&lt;/h2>&lt;p>Scrum Master 是 Scrum 中最遭受鄙视的角色。没有 Scrum Master 的 Scrum 团队是很常见的，因为公司不愿意雇佣专人来做这个工作。不过，即便有些公司雇佣了 Scrum Master ，但还是会经常让他们虚弱无力。&lt;/p>
&lt;blockquote>
&lt;p>Scrum Master 的失效无法避免，因为他们也不能催生出任何必需的改变，能让 Scrum 蓬勃发展起来。&lt;/p>&lt;/blockquote>
&lt;p>Scrum Master 和其他角色也没有什么不同。要找到一个人，他能够完全像Scrum指南中所建议的那样，成为真正的 Scrum Master 是不太可能的。Scrum Master 通常无力促进组织中所需要的变化。&lt;/p>
&lt;h2 id="scrum-还会活下去吗">Scrum 还会活下去吗？
&lt;/h2>&lt;p>许多有经验的专业人士已经厌倦了 Scrum，他们对它失去了信心。他们想要一些其他的东西，这些专业人士正在寻找机会尝试其它的框架。&lt;/p>
&lt;p>高管们对变革的恐惧阻碍了 Scrum 团队的发展。一连串错误的决定和错误的观念可能会导致 Scrum 走向灭亡。高层管理者不能将其先天不足的指令和管控风格留在过去。&lt;/p>
&lt;blockquote>
&lt;p>一个可悲的结果可能就会发生，SAFe，这个瀑布模型的卧槽马，它已经准备好要上位了。&lt;/p>&lt;/blockquote>
&lt;p>我很害怕 SAFe，因为它是一个沉重的流程，它看起来一点也不像是一个敏捷的方法。这台沉重的机器怎么能让人背得滚瓜烂熟呢？我真不知道他们凭什么敢说这也是敏捷。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-04-10-0_Zm_LEQK00gf_arR-.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.scaledagileframework.com/" target="_blank" rel="noopener"
>SAFe 5.0&lt;/a>&lt;/p>
&lt;h2 id="scrum可能需要重启才能活下来">Scrum可能需要重启才能活下来
&lt;/h2>&lt;p>Scrum 角色的魅力已经大不如前。很多公司对 Scrum 的错误认知，导致专业人士抵触与之合作。在 Scrum 成为一个流程的场景下，人们也不想成为 Scrum Master 或产品所有者。&lt;/p>
&lt;p>&lt;strong>我相信 Scrum 需要重新开始才能保持存在的意义。&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>我们所处的时代与20年前不同。在2001年，Scrum 是一个新生的孩子。世界已经改变了。现在 Scrum 是一种商品。为了让 Scrum 还维持在前线，创造者们需要有勇气去接受框架的核心，并解决那些阻碍。其中一些（可能的）阻碍可能是人家的血牛。想想（Scrum Master 和 Product Owner）认证产业。&lt;/p>
&lt;p>&lt;em>—&lt;/em> &lt;a class="link" href="https://medium.com/u/a55fee07a2c4?source=post_page-----915227f3a0d--------------------------------" target="_blank" rel="noopener"
>Willem-Jan Ageling&lt;/a>&lt;em>,&lt;/em> &lt;a class="link" href="https://medium.com/serious-scrum/will-scrum-fall-victim-to-its-own-success-7cc488dea09b" target="_blank" rel="noopener"
>Will Scrum Fall Victim to Its Own Success?&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>不管发生了什么，那些勇于改变自己内核的公司还是能在 Scrum 中脱颖而出。这从来都不是为了定义一个流程，而是为了拥有一种专注于更快地交付价值的文化。希望尚在，一些大胆的公司能拥抱变化，他们所表现出的迹象是。&lt;/p>
&lt;ul>
&lt;li>首席产品官（Chief Product Officer）成了高管团队的成员。&lt;/li>
&lt;li>高层管理人员专注于给出方向而不是指令。&lt;/li>
&lt;li>Scrum团队被授权去试验各种用来达成关键成果的方案。&lt;/li>
&lt;li>产品探索（Product Discovery）的建立。高管们知道，投入适当的时间去发现那些值得解决的问题是必不可少的工作。&lt;/li>
&lt;/ul></description></item><item><title>10 分钟读懂 DevOps 工具链</title><link>https://martinliu.cn/blog/10-minute-read-to-understanding-devops-tools/</link><pubDate>Fri, 02 Apr 2021 22:34:09 +0800</pubDate><guid>https://martinliu.cn/blog/10-minute-read-to-understanding-devops-tools/</guid><description>&lt;img src="https://martinliu.cn/img/cos/2021-04-03-eggs-3216877_1920.jpeg" alt="Featured image of post 10 分钟读懂 DevOps 工具链" />&lt;p>【译文】上周，我和我的几位非常资深的同事都在评论说，有很多新的DevOps工具正在出现，而且每天都越来越难跟踪它们，以及它们在DevOps 领域的定位。我问了他们几个工具，Ansible、Terraform、Salt、Chef、Bamboo、CloudFormation这些工具的定位在哪里？我为什么要用这个而不是那个？它们甚至是同一种东西吗？我是不是漏掉了一个主要角色？我得到了什么，一些白眼和问题。所以，我想我会做一些研究，阅读，并试图让我们所有人理解它，以便我们可以将那些产品都分类到我们都熟悉的类别或用途。&lt;/p>
&lt;p>原文：&lt;a class="link" href="https://levelup.gitconnected.com/the-10-minute-read-to-understanding-devops-tools-bc4ac807a25d" target="_blank" rel="noopener"
>https://levelup.gitconnected.com/the-10-minute-read-to-understanding-devops-tools-bc4ac807a25d&lt;/a>&lt;/p>
&lt;p>在我们开始谈论DevOps工具和类别之前，让我们退一步讨论几个基本的（但往往是超载的）术语以及它们的含义。&lt;/p>
&lt;p>&lt;strong>计算机/服务器&lt;/strong> - &lt;strong>Computer/Server&lt;/strong>： 具有中央处理器（CPU）、内存（RAM）、本地存储（磁盘）并运行操作系统的物理设备。&lt;/p>
&lt;p>&lt;strong>虚拟机&lt;/strong> - &lt;strong>Virtual Machine&lt;/strong>：在主机上运行的计算机系统的模拟器（虚拟机管理程序）；vm 通常可以在CPU、内存和磁盘使用方面与其他操作系统隔离。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-04-02-0-cuHFPvnmr141Dfcc.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;strong>容器&lt;/strong>&amp;ndash;&lt;strong>Containers&lt;/strong>：打包一个软件及其所有依赖，使其能够在任何基础设施上统一、一致地运行。Docker容器是最流行的。它们允许你打包一堆东西（你的软件、配置和其他软件），以便于部署和传输。你可以把容器看作是虚拟化的下一代进化（继虚拟机之后）。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-04-02-0-hWRNCynYRFw2KCxn.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;strong>网络设备&lt;/strong> - &lt;strong>Network Device&lt;/strong>：在设备之间路由网络流量的硬件。例如路由器、负载平衡器和防火墙。&lt;/p>
&lt;p>&lt;strong>软件&lt;/strong> - &lt;strong>Software&lt;/strong>：编码并在操作系统上运行的代码。&lt;/p>
&lt;p>&lt;strong>DevOps&lt;/strong> - 传统上有 &amp;ldquo;开发&amp;rdquo;（你来构建它），还有 &amp;ldquo;运维&amp;rdquo;（我们将运行它），他们两者之间的一切都受制于作坊式的工作方式。从2010年左右开始，到2018年左右DevOps 已经发展为几乎无处不在的现象，DevOps的理念是：&amp;ldquo;一套实践，目的是在保证高质量的前提下，缩短从提交系统变更到变更投入正常生产环境之间的时间&amp;rdquo;。&lt;/p>
&lt;p>当你在考虑构建和运行一个非同寻常的系统时，其实还有很多不得不做的事情。以下是需要考虑到的传统的事项清单。&lt;/p>
&lt;ol>
&lt;li>获取计算机/服务器硬件 （Obtaining the computer/server hardware）&lt;/li>
&lt;li>配置计算机/服务器硬件（操作系统、网络布线等）（Configuring the computer/server hardware (operating systems, network wiring, etc.)）&lt;/li>
&lt;li>监控计算机/服务器硬件（Monitoring the computer/server hardware）&lt;/li>
&lt;li>获取网络设备（负载均衡器、防火墙、路由器等）（Obtaining the network devices (load balancers, firewalls, routers, etc.)）&lt;/li>
&lt;li>配置网络设备（Configuring the network devices）&lt;/li>
&lt;li>监控网络设备（Monitoring the network devices）&lt;/li>
&lt;li>编写软件（Constructing the software）&lt;/li>
&lt;li>构建软件（Building the software）&lt;/li>
&lt;li>测试软件（Testing the software）&lt;/li>
&lt;li>软件打包（Packaging the software）&lt;/li>
&lt;li>部署/发布软件（Deploying/releasing the software）&lt;/li>
&lt;li>监测软件（Monitoring the software）&lt;/li>
&lt;/ol>
&lt;p>在DevOps之前，我们曾经有四个不同的团队在做这项工作。&lt;/p>
&lt;ul>
&lt;li>Developer 开发人员 — 他们会做 #7, #8 ，有时候包括 #10&lt;/li>
&lt;li>QA 测试人员— 他们会做 #9 ，有时候包括 #11&lt;/li>
&lt;li>System Administrator 系统管理员 — 他们会做 #1, #2, #3, #12&lt;/li>
&lt;li>Network Administrator 网络管理员 — 他们会做 #4, #5, #6&lt;/li>
&lt;/ul>
&lt;p>对于硬件、网络设备和软件的配置，每个团队很可能会使用自己的一套脚本和工具，而且在很多情况下，会通过手工操作来实现 &amp;ldquo;软件发布&amp;rdquo;。&lt;/p>
&lt;p>随着DevOps的出现，对我来说，关键的想法是打破这些部门墙，让每个人都成为 &amp;ldquo;一个 &amp;quot; 团队的一部分，为所有事物的配置、部署和管理方式带来一致性。&lt;/p>
&lt;p>&lt;strong>云&lt;/strong>&amp;ndash;&lt;strong>Cloud&lt;/strong>：定义信息技术史上最流行的名词是很难的，但我喜欢那件T恤，上面写着 &amp;ldquo;没有云，只是别人的电脑&amp;rdquo;。最初，当云服务开始的时候，它们真的只是别人的电脑（或者运行在电脑上的虚拟机），或者存储。随着时间的推移，它们已经演变成到了现在的状态，包含很多很多的增值服务。硬件大部分已经被抽象掉了，现在大多数云服务中，你不能购买它们的硬件设备，但你可以购买这些硬件设备所提供的各种云服务。&lt;/p>
&lt;p>&lt;strong>基础架构即代码&lt;/strong>(&lt;strong>IAC&lt;/strong>)&amp;ndash;：一种新的能力或概念，它允许我们通过定义或配置文件来完整的定义数据中心中所有项目的设置，包括虚拟机、容器和网络设备。这个概念是我可以创建一些配置和一些脚本，然后使用我们即将讨论的一个工具来运行它们，它们会自动为我们按需配制出数据中心的所有服务。CI/CD是IAC的前身，多年来我们一直致力于自动化我们的构建/测试/集成/部署周期，在我们的云基础设施上做这个工作是一个自然的延伸。这带来了成本的降低，更快的上市时间，以及更小的风险（人为错误）。&lt;/p>
&lt;p>随着IAC的出现，许多传统的开发工具现在可以用于管理基础设施。像软件仓库、构建工具、CI/CD、代码分析器和测试工具等类别的工具（如下所列），传统上是由软件开发人员使用的，现在可以被DevOps工程师用来构建和维护基础设施。&lt;/p>
&lt;blockquote>
&lt;p>AGAIN: &amp;ldquo;随着DevOps的出现，对我来说，关键的理念是&amp;hellip;&amp;hellip;让每个人都成为&amp;rsquo;一个&amp;rsquo;团队的一部分，为所有事物的配置、部署和管理方式带来一致性。&amp;rdquo;&lt;/p>&lt;/blockquote>
&lt;p>因此，现在我们已经定义了以上基础术语/概念，让我回到试图对DevOps工具进行分类的任务，以使我们更容易确定什么工具是用于什么目的的。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>软件仓库&lt;/strong> &amp;ndash; 管理软件版本的工具&amp;ndash;目前使用最广泛的是Git。&lt;/li>
&lt;li>&lt;strong>构建工具&lt;/strong>&amp;ndash;有些软件在打包或使用前需要编译，传统的构建工具包括Make、Ant、Maven和MSBuild。&lt;/li>
&lt;li>&lt;strong>持续集成工具&lt;/strong>&amp;ndash;在配置好以后，每次将代码提交到存储库中时，它都会对软件进行构建、部署和测试。这通常可以提高软件质量和上市时间。这个市场上最流行的工具是 Jenkins、Travis、TeamCity和Bamboo。&lt;/li>
&lt;li>&lt;strong>代码分析/审查工具&lt;/strong>&amp;ndash;这些工具可以查找代码中的错误，检查代码格式和质量，以及测试覆盖率。这些工具因编程语言而异。SonarQube是这个领域的一个流行工具，还有其他各种 &amp;ldquo;轻量的 &amp;ldquo;工具。&lt;/li>
&lt;li>&lt;strong>配置管理&lt;/strong>&amp;ndash;配置管理工具和数据库通常存储所有关于你的硬件和软件项目的信息，以及提供一个脚本和/或模板系统，用于自动化常见任务。在这个领域似乎有很多玩家。传统的玩家是Chef、Puppet和Salt Stack。&lt;/li>
&lt;li>&lt;strong>部署工具&lt;/strong>&amp;ndash;这些工具有助于软件的部署。许多CI工具也是CD（持续部署）工具，它们协助软件的部署。传统上在Ruby语言中，Capistrano工具被广泛使用；在Java语言中，Maven被很多人使用。所有的编排工具也都支持某种形式的部署。&lt;/li>
&lt;li>&lt;strong>编排工具&lt;/strong>&amp;ndash;这些工具配置、调度和管理计算机系统和软件。它们通常将 &amp;ldquo;自动化 &amp;ldquo;和 &amp;ldquo;工作流 &amp;ldquo;作为其服务的一部分。Kubernetes是一个非常流行的编排工具，它专注于容器。Terraform是一个非常流行的编排工具，它的关注点更广，包括云编排。另外，每个云提供商都有自己的一套工具（CloudFormation、GCP Deployment Manager, 和ARM）。&lt;/li>
&lt;li>&lt;strong>监控工具&lt;/strong> - 这些工具允许监控硬件和软件。通常，它们包括监控代理程序，用于监视进程和日志文件，以确保系统的健康。Nagios是一种流行的监控工具。&lt;/li>
&lt;li>&lt;strong>测试工具&lt;/strong> - 测试工具用于管理测试，以及测试自动化，包括性能和负载测试等。&lt;/li>
&lt;/ul>
&lt;p>当然，和其他任何一套产品一样，类别也不一定完全清晰。许多工具都是跨类别的，并提供两个或多个类别的功能。下面是我试图展示大多数非常流行的工具，并可视化它们在这些类别中的位置。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-04-02-1-wTp-r9QJvF-DXGZDZUHmbA.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>正如你所看到的，有几个玩家，如Ansible、Terraform和云工具(AWS、GCP和Azure)，正试图通过他们的产品覆盖部署、配置管理和编排类别。老牌工具集Puppet、Chef和Salt Stack专注于配置管理和自动化，但已经扩展到编排和部署的。还有像GitLab和Azure DevOps这样的工具，几乎试图跨越DevOps的所有类别。&lt;/p>
&lt;p>我希望这个概述能帮助你了解DevOps的基础知识，可用工具的类别，以及目前市场上的各种产品如何在这些类别中的一个或多个类别中提供帮助。在Solution Street，多年来我们已经使用了许多这样的工具，对我们来说，没有一个单一的 &amp;ldquo;一招鲜 &amp;ldquo;的工具能胜任所有情况下使用。使用什么是基于所使用的技术，在哪里托管（以及未来可能在哪里托管），以及团队的人才和构成。&lt;/p>
&lt;blockquote>
&lt;p>教练观点：敏捷教练不能回避DevOps 工具链的话题，中低层管理人员更应该在宏观上深刻理解 SLDC 所有环节的技术概要和工具需求，需要具备基础的概念知识，具备和工程师讨论所必备的语言。工程师们更要有工具链整体优化的意识，而不仅仅是精通某个环节，或局限在与自己的上下游工具上，工作在这个系统中的所有人需要有全局协作和优化的意识，优化价值流的流量、流速，关注价值的产生。警惕&amp;mdash;-整个工具链的自动化程度越高，不一定工作效率越高，加班越少，公司盈利越多。它们其实是相互作用的。&lt;/p>&lt;/blockquote></description></item><item><title> DevOps 的未来：2021 年的 15 个趋势</title><link>https://martinliu.cn/blog/future-devops-15-trends-2021/</link><pubDate>Sun, 21 Mar 2021 00:05:58 +0800</pubDate><guid>https://martinliu.cn/blog/future-devops-15-trends-2021/</guid><description>&lt;img src="https://martinliu.cn/img/2021/03/The-Future-Is-Bright.jpg" alt="Featured image of post DevOps 的未来：2021 年的 15 个趋势" />&lt;p>本文的原文地址：[https://thechief.io/c/editorial/future-DevOps -15-trends-2021/](&lt;a class="link" href="https://thechief.io/c/editorial/future-DevOps" target="_blank" rel="noopener"
>https://thechief.io/c/editorial/future-DevOps&lt;/a> -15-trends-2021/ ) 本文是一篇译文，旨在学习，并分享给社区。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-03-20-Screen%20Shot%202021-03-21%20at%201.26.38%20AM.jpg"
loading="lazy"
>&lt;/p>
&lt;p>DevOps 和整个IT运维是一个不断发展的领域，本文的趋势就是证明。总是需要跟上趋势并利用其优势。&lt;/p>
&lt;p>DevOps 正在与机器学习和人工智能等各种技术创新不断发展和融合，这些创新将在2021年占据更多的领域。&lt;/p>
&lt;p>学习这些趋势，并在你的 DevOps 实践中实施它们，将使你在这个革命性的领域中保持活力。&lt;/p>
&lt;p>在过去十年的引入中，DevOps 已经成长为许多IT公司不可或缺的一部分。&lt;/p>
&lt;p>专家预测，到2025年，DevOps 市场规模将达到128.5亿美元。在软件工程中实施 DevOps 所带来的效率和众多优势，是其被大量采用的关键驱动力。&lt;/p>
&lt;p>年复一年，软件开发领域总有一些新的实践出现，有些则被抛弃。&lt;/p>
&lt;p>在本文中，我们将探讨 DevOps 的上升趋势和实践，以及对2021年该行业的期望。&lt;/p>
&lt;h1 id="1-devsecops-将成为新的-devops">1-DevSecOps 将成为新的 DevOps
&lt;/h1>&lt;p>随着企业拥抱无服务器、Docker、Kubernetes和其他现代云技术，安全将一如既往地成为高度优先级，成为 DevOps 的默认部分。&lt;/p>
&lt;p>与 DevOps &amp;ndash;开发团队和IT团队的融合类似，DevSecOps 将是将安全融入开发和IT运维团队。&lt;/p>
&lt;p>技术研究公司国际数据公司(IDC)预测，到2024年，DevSecOps 将推动亚太地区至少50%的新应用，这让 DevSecOps 从2021年开始有了成长的乐土。&lt;/p>
&lt;h1 id="2-aiops-的实施率将上升">2-AIOps 的实施率将上升
&lt;/h1>&lt;p>自2017年以来，采用人工智能和机器学习来增强、自动化和管理IT运维，是 DevOps 过程中的革命性改变。&lt;/p>
&lt;p>Gartner 的研究指出，到2023年，40%的DevOps 团队将利用人工智能进行IT运维（AIOps）来增强应用和基础设施监控工具。&lt;/p>
&lt;p>随着超过30%的IT组织已经利用机器学习和人工智能，越来越多的组织将采用 AIOps 来提高关键 DevOps 任务的效率和自动化程度，为IT操作人员腾出时间用于更有价值的业务活动。&lt;/p>
&lt;h1 id="3-基础架构自动化ia将更占主导地位">3-基础架构自动化（IA）将更占主导地位
&lt;/h1>&lt;p>基础设施管理工具将帮助 DevOps 团队将自动化引入交付、配置和IT基础设施管理。&lt;/p>
&lt;p>IA 应用可以无缝地自动化IT基础设施的交付、配置和管理，帮助 IT 团队提高工作效率和可靠性。&lt;/p>
&lt;p>2021年，企业将开始用企业级的 IA 工具取代自定义设置，实现部署和配置的自动化。&lt;/p>
&lt;h1 id="4-混沌工程将成为常规的测试技术">4-混沌工程将成为常规的测试技术
&lt;/h1>&lt;p>混沌工程&amp;ndash;在生产中对软件进行实验，以建立对系统抵御突发事故能力的信心的学科，在 DevOps 中会变得更加重要。&lt;/p>
&lt;p>软件被要求具有高效和冗余性，混沌工程提供了这方面的测试以及更多。&lt;/p>
&lt;p>Gartner 提出，到2023年，40%的组织将实施混沌工程作为 DevOps 的一部分，这将减少高达 20% 的意外停机时间。&lt;/p>
&lt;h1 id="5-在-devops-流程中实现更多自动化">5-在 DevOps 流程中实现更多自动化
&lt;/h1>&lt;p>实际上，每个IT组织都在以某种方式使用自动化。Business wire 的一份报告显示，美国61%的组织广泛使用自动化。&lt;/p>
&lt;p>企业正在意识到自动化的力量和好处，并将其引入到 DevOps 的每一个层面，从开发，到部署和管理阶段。&lt;/p>
&lt;p>在2021年，DevOps 将获得并使用更多先进的自动化工具来评估容易出错的人工执行任务，并更好地在 DevOps 发展中加速开发和部署。&lt;/p>
&lt;p>事实的更广泛的大流行，很多公司正在并将继续进行大量的自动化工作，这是前所未有的。&lt;/p>
&lt;h1 id="6-从设计到部署公司将采用混合云">6-从设计到部署，公司将采用混合云
&lt;/h1>&lt;p>随着2020年整个行业经历的转变，远程工作成为新的常态，企业将全面拥抱混合运维。随着企业对其技术堆栈进行的现代化改造，从而利用云的优势，混合云将成为部署的新常态，以及一般的业务。&lt;/p>
&lt;p>企业将开始同时使用内部私有云部署和公有云来进行IT运维。&lt;/p>
&lt;h1 id="7-利用-agileops-实现更敏捷的软件交付">7-利用 AgileOps 实现更敏捷的软件交付
&lt;/h1>&lt;p>AgileOps 结合了成熟的敏捷和 DevOps 技术，为I&amp;amp;O团队提高敏捷性、管理软件开发和快速响应需求。&lt;/p>
&lt;p>快速实时响应用户需求的需求不断增加，将推动 AgileOps 在IT运维中的进一步发展。&lt;/p>
&lt;h1 id="8-基础设施即代码iac将蓬勃发展">8-基础设施即代码（IaC）将蓬勃发展
&lt;/h1>&lt;p>IaC 提供了一种通过配置文件来管理IT基础设施的手段，包括服务器、网络、存储设备（内部和云端）。&lt;/p>
&lt;p>通过 IaC，软件工程师可以通过运行一个脚本，来构建一套完整的基础设施，提供部署相同配置的一致性、可靠性，并提高软件开发环境的效率。&lt;/p>
&lt;p>基础设施即代码(IaC)的快速恢复、减少停机时间等优势，将推动更多公司在运维中采用它。&lt;/p>
&lt;h1 id="9-dataops的趋势是真实的并将更加成熟">9-DataOps的趋势是真实的，并将更加成熟
&lt;/h1>&lt;p>DataOps 将通过使用机器学习模型来预测事故或中断，从而彻底改变 DevOps。DataOps 使用预测分析，拥有彻底改变 DevOps 的潜力。&lt;/p>
&lt;p>Itamar Ben Hemo 是 Rivery 的CEO和联合创始人，他写道。&lt;/p>
&lt;blockquote>
&lt;p>就像DevOps将软件开发系统化了一样，DataOps旨在加速数据的收集、处理和分析。正如CIO所指出的，&amp;ldquo;IDC在&amp;rsquo;数据到见解&amp;rsquo;的管道中定义了四个核心阶段。识别数据、收集数据、转换数据和分析数据。这些阶段也共同构成了这门新兴学科 DataOps 的核心要素。&amp;rdquo;&lt;/p>&lt;/blockquote>
&lt;p>根据Nexla进行的一项调查，73%的公司计划投资DataOps来管理数据团队，关于他们如何使用数据，他们的团队结构和数据挑战发现，73%的公司正在投资DataOps。&lt;/p>
&lt;h1 id="10-无服务器架构将被广泛采用">10-无服务器架构将被广泛采用
&lt;/h1>&lt;p>无服务器(Serverless)计算为应用和软件部署提供了可扩展性，而无需物理硬件成本。&lt;/p>
&lt;p>由于企业正在寻求减少和最大限度地利用开支，以缓解新冠疫情的影响，更多的公司将迁移到无服务器架构，消除管理基础设施的责任，允许他们 &amp;ldquo;为你使用的东西付费&amp;rdquo;。&lt;/p>
&lt;p>将会有一个强有力无服务器的诉求，即我们将把代码推送到云端，其余的操作将由云提供商完成。&lt;/p>
&lt;h1 id="11-devops-将更深的实施-kubernetes">11-DevOps 将更深的实施 Kubernetes
&lt;/h1>&lt;p>越来越多的公司将开始看到Kubernetes提供的灵活性、可扩展性、自动化、高可用性和可移植性等优势，将带来直接的经济和运维效益，从而开始更深入的应用它。&lt;/p>
&lt;h1 id="12-边缘计算将被重视">12-边缘计算将被重视
&lt;/h1>&lt;p>组织正在需要处理收集数据的地方依靠边缘计算，以获得更好的延迟、成本优化和分析。&lt;/p>
&lt;p>随着IT操作人员进一步研究过滤监控数据，边缘计算将为DevOps提供这方面的优势，从而在2021年得到更多的应用。&lt;/p>
&lt;h1 id="13-迁移到微服务变得很重要">13-迁移到微服务变得很重要
&lt;/h1>&lt;p>通过实施微服务，企业将能够控制应用程序并自动管理软件版本，而且风险更低。&lt;/p>
&lt;p>商业企业在2021年及以后继续加速向云计算转移。他们越来越多地以灵活性为代价，尝试微服务带来的新技术栈。&lt;/p>
&lt;h1 id="14-noops将来到运维场景再次">14-NoOps将来到运维场景（再次）
&lt;/h1>&lt;p>NoOps 的思想是去除DevOps中所有的平台管理部分，减少开发者和基础设施之间的摩擦。&lt;/p>
&lt;p>随着 DevOps 中各种自动化和 AI 的兴起，NoOps 将在2021年登场，之后开始经历颠覆性的增长。&lt;/p>
&lt;h1 id="15-gitops将研究院">15-GitOps将研究院
&lt;/h1>&lt;p>GitOps 是一种集部署、监控、管理于一体的构建云应用的运维模式。GitOps 允许 DevOps 使用开发者工具来驱动运维，在DevOps中建立了一个 &amp;ldquo;你构建，你负责&amp;rdquo; 的流程。&lt;/p>
&lt;p>如果你想了解更多关于 GitOps的信息，请查看我们的播客集&lt;a class="link" href="https://anchor.fm/thedevopsfauncast/episodes/GitOps-This-is-What-You-Need-to-Know-12-epga8p?ref=thechiefio?ref=thechiefio" target="_blank" rel="noopener"
>GitOps: This is What You Need to Know.&lt;/a>&lt;/p></description></item><item><title>DevOps 教练周刊 7</title><link>https://martinliu.cn/blog/devopscoach-weekly-7/</link><pubDate>Tue, 16 Mar 2021 19:23:15 +0800</pubDate><guid>https://martinliu.cn/blog/devopscoach-weekly-7/</guid><description>&lt;img src="https://martinliu.cn/images/weeklyupdate.jpg" alt="Featured image of post DevOps 教练周刊 7" />&lt;p>全球 DevOps + SRE 精选资讯&lt;/p>
&lt;p>本期有 6 个公司的服务出现了宕机事故，一如既往的为你精选了十几篇值得学习的内容。&lt;/p>
&lt;blockquote>
&lt;p>[EN] May your queries flow and your pagers stay silent.
&amp;ndash;Dave, Betsy, Niall, Stephen, and Ken&lt;/p>&lt;/blockquote>
&lt;p>【译】：愿你的咨询队列和传呼机都保持静默。&lt;/p>
&lt;h2 id="宕机">宕机
&lt;/h2>&lt;h2 id="fastly-3-月事故一览">Fastly 3 月事故一览
&lt;/h2>&lt;p>Fastly是一家 CDN 服务提供商，每个月的事故披露条数大约是 20 到 30 条。本月（三月）已经可以在 &lt;a class="link" href="https://status.fastly.com/history" target="_blank" rel="noopener"
>https://status.fastly.com/history&lt;/a> 看到 23 条事故披露通告。主要内容有三种：事故时间线记录，事故回顾和计划内活动（扩容等）。&lt;/p>
&lt;p>回顾三月份的事故历史，事故类型组要是：&lt;/p>
&lt;ul>
&lt;li>区域性和全球性的性能事故。&lt;/li>
&lt;li>网络路由和 DNS 故障&lt;/li>
&lt;li>数据中心计划内的维护、扩容和新上线（新加坡）。&lt;/li>
&lt;/ul>
&lt;p>目前一共有 8 个事故回顾。浏览一下大致内容主要是对过去发生过的事故的确认。每一条事故回顾中精确的描述了事故影响起始时间点和影响范围。&lt;/p>
&lt;blockquote>
&lt;p>教练观点：看起来他们三月份的日子过的不咋样，不知道这个月的错误预算是否快烧完了。&lt;/p>&lt;/blockquote>
&lt;h2 id="ovh-cloud-数据中心发生火灾">OVH Cloud 数据中心发生火灾
&lt;/h2>&lt;p>这是一家服务器托管/云服务器提供商，数据中心主要在欧洲中西部和美国东岸。&lt;/p>
&lt;p>3 月 10 日这次发生火灾的是位于法国Strasbourg的一个数据中心，该数据中心园区里有 4 栋大楼。从新闻图片上看到有一栋大楼几乎彻底烧毁。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-03-21-151636.png"
loading="lazy"
alt="2021-03-21_23-05-14"
>&lt;/p>
&lt;p>该公司的创始人/CEO 第一时间在 Twitter 上发布和更新着火灾的状态。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-03-21-151729.png"
loading="lazy"
alt="2021-03-21_23-06-03"
>&lt;/p>
&lt;p>从这可以看到，数据中心园区中的 SBG2 大楼发生火灾，因此直接关闭里其它的大楼。他每天在 Twitter 上更新一次，在公司官网上 &lt;a class="link" href="https://www.ovh.com/world/news/press/cpl1787.fire-our-strasbourg-site?124" target="_blank" rel="noopener"
>https://www.ovh.com/world/news/press/cpl1787.fire-our-strasbourg-site?124&lt;/a> 也可以看到每天一次的更新。&lt;/p>
&lt;p>至今火灾的原因还没有说明，从每日的更新里还可以看到，火灾的影响目前没有完全消除，其它数据中心的电池还有冒烟的情况出现。&lt;/p>
&lt;p>火灾恢复的过程包括：&lt;/p>
&lt;ul>
&lt;li>对每个大楼的可用状态更新，SBG-3 大楼已经恢复到了 40%可用的状态，团队工作在重启服务器的过程中。&lt;/li>
&lt;li>其它三个大楼在逐一恢复抢修中，主要包括这些工作：重启电源供应，重启网络服务，重启服务器。&lt;/li>
&lt;/ul>
&lt;p>可以看到他们的救灾工作的三个优先级：&lt;/p>
&lt;ol>
&lt;li>恢复各个大楼的服务。&lt;/li>
&lt;li>在其他数据中心为客户制备新的服务器（承诺了1.5 万台新服务器）&lt;/li>
&lt;li>与所有受到影响的客户一起实施 DRP 计划。（灾难恢复计划）&lt;/li>
&lt;/ol>
&lt;p>以上三项救灾工作的数据都是日更在以上的网页中。&lt;/p>
&lt;blockquote>
&lt;p>教练观点：这个数据中心可谓是非常罕见的大规模灾难，救灾速度和进展还是比较缓慢的，但愿受影响的公司都有自己的扩域高可用容灾方案，希望 DRP 计划执行的顺利有效。&lt;/p>&lt;/blockquote>
&lt;h2 id="俄罗斯发生大规模域名解析故障">俄罗斯发生大规模域名解析故障
&lt;/h2>&lt;p>在 3 月10日，由于俄罗斯的网监局（&lt;a class="link" href="https://twitter.com/roscomnadzor" target="_blank" rel="noopener"
>roscomnadzor&lt;/a> 联邦通信、信息技术和大众媒体监督局）对Twitter 的短域名服务 t[.]co 不当屏蔽，导致了全境所有包含了 t.co 的子域名都无法访问，包括例如：Microsoft[.]com 和 Reddit[.]com 的域名，还有很多其它躺枪的域名。&lt;/p>
&lt;p>参考Twitter 上的信息如下：&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-03-21-153938.png"
loading="lazy"
alt="2021-03-21_23-38-50"
>&lt;/p>
&lt;blockquote>
&lt;p>教练观点：感觉这个错误犯的有点低级了。&lt;/p>&lt;/blockquote>
&lt;h2 id="dyn-dns-服务器故障">Dyn DNS 服务器故障
&lt;/h2>&lt;p>这是 Oracle 云的提供的 DNS 服务，本次故障导致大部分客户的 DNS 服务解析失败或者降级，影响范围是所有相关客户。&lt;/p>
&lt;p>调查得到的主要根因：Oracle Public DNS 基础设施实施配置变更是发生了问题。&lt;/p>
&lt;h2 id="chef-服务发生大量-5xx-错误">Chef 服务发生大量 5xx 错误
&lt;/h2>&lt;p>Chef 的服务不经常发生故障，这次 api.chef.io 服务发生了大量 5xx 错误增多的事故，错误的对象是索引集群。目前故障已经排除，服务恢复了正常。&lt;/p>
&lt;h2 id="github-3-月事故">GitHub 3 月事故
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.githubstatus.com/history" target="_blank" rel="noopener"
>https://www.githubstatus.com/history&lt;/a> 在这个页面上可以看到本月已经发生了 7 次事故。在 3 个严重事故中，有 2 个的事故影响时间接近 2 小时。3-15 日的事故影响了 GitHub Actions 服务。12 日的事故中影响到了绝大多数服务的可用性，但是恢复的还比较快。&lt;/p>
&lt;blockquote>
&lt;p>教练观点：我本月体验到了一次 GitHub Actions 构建报错挂住僵死的问题，后来继续提交，GitHub Actions 的 pipeline 又恢复正常工作了。持续时间不太长。&lt;/p>&lt;/blockquote>
&lt;h1 id="新闻">新闻
&lt;/h1>&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://puppet.com/blog/take-the-2021-state-of-devops-survey-be-part-of-our-10-year-history/" target="_blank" rel="noopener"
>Take the 2021 State of DevOps Survey, be part of our 10-year history&lt;/a> 这是我跟踪最长时间的 DevOps 状态调查报告，以前是和 DORA 合作的，在 DORA 被 Google Cloud 收编了以后，Puppet 有开始找的其它大拿继续这个调查。对于计划做行业调查的朋友，还是可以学习一下，这套问卷的设问。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://kubernetes.us10.list-manage.com/track/click?u=3885586f8f1175194017967d6&amp;amp;id=5a32cff75d&amp;amp;e=7098f23071" target="_blank" rel="noopener"
>CD Foundation Announces Industry Initiative to Standardize Events from CI/CD Systems&lt;/a> 持续交付基金会发生了，宣布行业级 CI/CD 系统的标准化事件的号召。他们搞了一个 &lt;a class="link" href="https://github.com/cdfoundation/sig-events" target="_blank" rel="noopener"
>Events SIG&lt;/a> 厂商中立的兴趣讨论小组，这个计划对以后所有 CI/CD 流水线系统间的互操作性比较重要。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="软件发布">软件发布
&lt;/h2>&lt;ul>
&lt;li>Java 16 发布&lt;/li>
&lt;li>AWS EC2 发布了新的 X2gd 实例，这是一块 ARM-based Graviton2-powered 高内存实例。可达 1TB 内存和 3.8TB 的SSD 存储。&lt;/li>
&lt;li>Git 2.31 发布&lt;/li>
&lt;li>Ghost 4.0 开源 CMS 系统&lt;/li>
&lt;li>Audacity 3.0.0 开源音频编辑软件&lt;/li>
&lt;li>SQLite 3.35 发布&lt;/li>
&lt;/ul>
&lt;h1 id="文章">文章
&lt;/h1>&lt;p>本周推荐如下经常文章。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.transposit.com/blog/fighter-pilots-and-incident-management/" target="_blank" rel="noopener"
>战斗机飞行员和事故管理有什么共同点？&lt;/a>
我觉得战斗机飞行员对每一次任务，无论成功与否，都会有一个回顾，这真的很新鲜。总有一些东西需要学习。杰西卡-阿贝尔森&amp;ndash;Transposit&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://blog.heroku.com/incident-response-at-heroku-2020" target="_blank" rel="noopener"
>Heroku的事故响应&lt;/a>
Heroku应用事故管理系统，指定一名事故指挥官，负责保持事故的正常进行，并监督外部和内部的沟通。Guillaume Winter - Heroku&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://blog.khanacademy.org/how-khan-academy-successfully-handled-2-5x-traffic-in-a-week/" target="_blank" rel="noopener"
>可汗学院如何在一周内成功处理2.5倍的流量？&lt;/a>
这个故事正在变得很常见：当大范围居家办公开始时，可汗学员的流量突然暴增。他们的策略包括使用云和CDN。Marta Kosarchyn - 可汗学院&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://engineering.squarespace.com/blog/2017/under-the-hood-ensuring-site-reliability" target="_blank" rel="noopener"
>根基：确保站点可靠性&lt;/a>
下面是对Squarespace如何做SRE的精彩总结。Franklin Angulo - Squarespace&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://increment.com/reliability/reliability-at-scale/" target="_blank" rel="noopener"
>[增量：可靠性] 大规模的可靠性。&lt;/a>
Deliveroo、DigitalOcean、Fastly和Headspace的领导们分享了他们的组织是如何看待可靠性和弹性的，以及他们对开始可靠性之旅的工程机构的建议。每位领导都回答了一系列关于他们的组织如何处理可靠性的问题，给出了一个有趣的比较和对比的概述。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://increment.com/reliability/resilience-as-adaptability-freshworks/" target="_blank" rel="noopener"
>「增量：可靠性案例分析」弹性作为Freshworks的适应性&lt;/a>
利用在一场毁灭性的飓风之后制定的灾难计划，Freshworks在这场大流行中幸存下来，并在大流行前的最后期限前交付了一个重要的新产品。伊普西塔-阿加瓦尔&amp;ndash;增量公司&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://launchdarkly.com/blog/what-is-a-canary-deployment/" target="_blank" rel="noopener"
>什么是金丝雀部署？&lt;/a>
本篇解释了什么是金丝雀部署，它如何帮助您，以及金丝雀部署与蓝/绿部署的区别。LaunchDarkly&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.blameless.com/blog/how-to-build-an-sre-team-with-a-growth-mindset" target="_blank" rel="noopener"
>如何以成长的心态打造SRE团队？&lt;/a>
这篇文章解释了成长型思维方式的含义，并展示了它如何应用于SRE。艾米丽-阿诺特&amp;ndash;Blameless&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>在 Github 上搭建基于 Hugo 的免费个人博客</title><link>https://martinliu.cn/blog/github-hugo-blog/</link><pubDate>Sat, 06 Feb 2021 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/github-hugo-blog/</guid><description>&lt;img src="https://martinliu.cn/img/2019/03/pic03.jpg" alt="Featured image of post 在 Github 上搭建基于 Hugo 的免费个人博客" />&lt;p>最近更新了新的博客样式，再次搬迁回到了 GitHub 平台，并使用了 Github Action 的自动化 CI/CD 发布功能。这个是一个任何人都可以拥有的方案，现在用最简洁的语言分享给大家。&lt;/p>
&lt;p>选择将博客搭建在 Github 上的原因包括：&lt;/p>
&lt;ul>
&lt;li>Github Pages 是一个免费使用的功能，在不强求网站访问速度，考虑持久性的情况下，Github Pages 不失为一根优秀的羊毛。&lt;/li>
&lt;li>用 master 分支管理 hugo 站点的所有代码和文件（markdown、网站模板和图片），用 gh-pages 分支存放 Hugo 编译后的网站发布文件&lt;/li>
&lt;li>Github Actions 功能实现了自动化的编译和部署功能，使用它所提供的工作流将 master 分支中的更新编译后发布到 gh-pages 分支中&lt;/li>
&lt;/ul>
&lt;p>而 Hugo 是一款比较流行的静态网站管理软件，可以在各种操作系统轻松的安装本地的博客环境，在本地的操作系统上实现博客的预览和测试。Hugo 的社区提供了大量的免费网站模板，不同类型的模板可以满足各种网站需求。&lt;/p>
&lt;h2 id="选择-hugo-博客主题">选择 Hugo 博客主题
&lt;/h2>&lt;p>在 &lt;a class="link" href="https://themes.gohugo.io/" target="_blank" rel="noopener"
>https://themes.gohugo.io/&lt;/a> 可以搜索到大量的免费网站模板。我这次选择了名为 “HUGO FUTURE IMPERFECT SLIM” 的模板。&lt;/p>
&lt;p>这是一个功能非常丰富的模板：&lt;/p>
&lt;ul>
&lt;li>界面简洁，兼具丰富的格式，博客文章有头图&lt;/li>
&lt;li>带有侧栏&lt;/li>
&lt;li>带有 ‘about’ ‘categories’ ‘contact’ 等独立页面格式，无头图&lt;/li>
&lt;li>具有多语言支持和菜单选择&lt;/li>
&lt;li>带有搜索页面&lt;/li>
&lt;li>带有讨论功能&lt;/li>
&lt;/ul>
&lt;p>对我而言这些都是很快就都可以用到的功能。&lt;/p>
&lt;p>Hugo 博客本地安装和配置新手指南，参考这两篇文章。&lt;/p>
&lt;ol>
&lt;li>&lt;a class="link" href="https://zhuanlan.zhihu.com/p/102131163" target="_blank" rel="noopener"
>零基础使用 Hugo 和 GitHub 搭建个人博客&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://sb.sb/blog/migrate-to-hugo/" target="_blank" rel="noopener"
>使用 Hugo 生成静态博客教程&lt;/a>&lt;/li>
&lt;/ol>
&lt;h2 id="github-pages-新手指南">GitHub Pages 新手指南
&lt;/h2>&lt;p>在 &lt;a class="link" href="https://pages.github.com/" target="_blank" rel="noopener"
>https://pages.github.com/&lt;/a> 提供了视频和文字版本的新手指南教程。为了方便新手理解，下面就使用‘user or organization site’这个最常用的选项做简要说明：&lt;/p>
&lt;ol>
&lt;li>创建与自己的 &lt;strong>Github 用户/组织&lt;/strong> 同名前缀的公开代码仓库，例如：zhangsan/zhangsan.github.io&lt;/li>
&lt;li>选择在命令行里（前提是安装配置好了 Git，否则使用图形化界面 GitHub Desktop 工具）&lt;/li>
&lt;li>克隆第一步创建的那个代码库到本地电脑的目录中。&lt;/li>
&lt;li>创建只包含 ‘Hello World’ 为内容的主页测试文件。&lt;/li>
&lt;li>推送本地的更新到 Github 服务器端&lt;/li>
&lt;li>在本地的浏览器中查看测试网页 &lt;a class="link" href="http://zhagnsan.github.io/" target="_blank" rel="noopener"
>http://zhagnsan.github.io/&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>GitHub Pages 的新手指南已经包含在了上一节推荐的两篇文章中。&lt;/p>
&lt;h2 id="使用-github-actions-自动化发布博客更新">使用 Github Actions 自动化发布博客更新
&lt;/h2>&lt;p>本地的测试环境是非常重要的，可以帮我们快速的掌握 Hugo 的基本使用方式，测试和选择网站模板。在模板确定了以后，就进入了日常的内容更新过程中，平常内容更新的工作都是在 master 分支中进行。并不会在本地操作 gh-pages 分支，这个分支里只会存放的是 Hugo 编译之后结果内容，即 public 目录中的内容。&lt;/p>
&lt;p>你可以在代码库的 Actions 标签页面中，创建一个默认的演示工作流文件，在本地做一个测试更新，用 push 动作测试触发和执行它。从无到有的创建新工作流文件的过程在这里不讲解。&lt;/p>
&lt;p>在本使用 Github Actions 的功能的主要目的如下：&lt;/p>
&lt;ol>
&lt;li>通过 master 分支的 push 事件，触发自动化工作流，即 CI/CD 工作流，这里是持续部署的过程。&lt;/li>
&lt;li>将 master 分支的内容签出，使用新配置的 Hugo 软件构建全站的所有内容&lt;/li>
&lt;li>将构建后的结果发布更新到 gh-pages 分支中。&lt;/li>
&lt;/ol>
&lt;p>下面是我所使用的工作流代码和注释。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 将 Hubo 博客构建后部署到 Github Pages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name: Deploy github-pages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 在 master 主干分支的任何 push 事件都会触发本 DevOps 工作流水线
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">on:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> push:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> branches: [ master ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 以下是本串行执行工作流的所有组成部分
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">jobs:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 这里只定义了一个名为 &amp;#34;deploy&amp;#34; 的多步骤作业
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> build-deploy-hugo-blog:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 将后续的所有工作步骤都运行在最新版的 ubuntu 操作系统上
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> runs-on: ubuntu-latest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 本构建和部署作业的所有步骤定义如下
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> steps:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Step 1 - Checks-out 你的代码库到 $GITHUB_WORKSPACE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: Checkout blog code repo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uses: actions/checkout@v2 # 这是 Github 官方提供的一个动作模块
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> submodules: true # 同步更新所使用的 Hugo 模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fetch-depth: 0 # 更新到该模板最新的版本
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Step 2 - 配置最新版本的 Hugo 环境
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: Setup Hugo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uses: peaceiris/actions-hugo@v2 # 这是 Github Actions 市场中的一个动作模块
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hugo-version: &amp;#39;latest&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Step 3 - 清理代码库中 public 目录中的内容
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: Clean public directory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> run: rm -rf public # 彻底删除这个目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Step 4 - 用最新版本的 Hugo 构建个人博客站点
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: Build blog site
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> run: hugo --minify
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Step 5 - 创建用于私有域名所需要的 CNAME 文件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: Create CNAME file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> run: echo &amp;#39;martinliu.cn&amp;#39; &amp;gt; public/CNAME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Step 6 - 将构建好的博客站点推送发布到 gh-pages 分支
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: Deploy blog to Github-pages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> uses: peaceiris/actions-gh-pages@v3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> github_token: ${{ secrets.DEPLOY_KEY }}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> publish_dir: ./public
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="后续事项">后续事项
&lt;/h2>&lt;ol>
&lt;li>解决旧文章头图空白的问题&lt;/li>
&lt;li>增加文章评论功能&lt;/li>
&lt;li>增加 CDN 功能&lt;/li>
&lt;/ol></description></item><item><title>DevOps 教练周刊 6</title><link>https://martinliu.cn/blog/devopscoach-weekly-6/</link><pubDate>Mon, 31 Aug 2020 00:11:01 +0800</pubDate><guid>https://martinliu.cn/blog/devopscoach-weekly-6/</guid><description>&lt;img src="https://martinliu.cn/images/weeklyupdate.jpg" alt="Featured image of post DevOps 教练周刊 6" />&lt;p>全球 DevOps + SRE 精选资讯&lt;/p>
&lt;h2 id="宕机">宕机
&lt;/h2>&lt;ul>
&lt;li>上一周新发的宕机事故。&lt;/li>
&lt;li>近期全球重大宕机事故的分析总结、事后回顾。&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>May your queries flow and your pagers stay silent.
&amp;ndash;Dave, Betsy, Niall, Stephen, and Ken&lt;/p>&lt;/blockquote>
&lt;h3 id="上周新发事故">上周新发事故
&lt;/h3>&lt;ul>
&lt;li>Zoom 无法开始和加入会议， 官方报道 &lt;a class="link" href="https://status.zoom.us/incidents/1z2lrf4nrv8p" target="_blank" rel="noopener"
>https://status.zoom.us/incidents/1z2lrf4nrv8p&lt;/a>&lt;/li>
&lt;li>Slack 多个功能模块服务降级，甚至无法使用，官方：&lt;a class="link" href="https://status.slack.com//2020-08/960bbb3c9d49a3cc" target="_blank" rel="noopener"
>https://status.slack.com//2020-08/960bbb3c9d49a3cc&lt;/a>&lt;/li>
&lt;li>Let&amp;rsquo;s Encrypt 数据中心硬件方式故障导致 API 报错，官方：&lt;a class="link" href="https://status.io/pages/incident/55957a99e800baa4470002da/5f45330250878c04bf3fb6eb" target="_blank" rel="noopener"
>https://status.io/pages/incident/55957a99e800baa4470002da/5f45330250878c04bf3fb6eb&lt;/a>&lt;/li>
&lt;li>NZX 新西兰证券交易所遭受重大DDoS攻击导致NZX停电，交易停止。媒体：&lt;a class="link" href="https://www.stuff.co.nz/business/122562006/major-ddos-attack-causes-nzx-power-outage-trading-halt" target="_blank" rel="noopener"
>https://www.stuff.co.nz/business/122562006/major-ddos-attack-causes-nzx-power-outage-trading-halt&lt;/a>&lt;/li>
&lt;li>eBay宕机。服务器状态最新，DNS故障和服务不可用的错误错误，媒体：&lt;a class="link" href="https://www.express.co.uk/life-style/science-technology/1329281/eBay-down-server-status-DNS-failure-service-unavailable-error" target="_blank" rel="noopener"
>https://www.express.co.uk/life-style/science-technology/1329281/eBay-down-server-status-DNS-failure-service-unavailable-error&lt;/a>&lt;/li>
&lt;li>Heroku 发生大量的 H100 报错，官方：&lt;a class="link" href="https://status.heroku.com/incidents/2101" target="_blank" rel="noopener"
>https://status.heroku.com/incidents/2101&lt;/a>&lt;/li>
&lt;li>Fastly CDN 服务商的服务发生多区域性能故障，官方：&lt;a class="link" href="https://status.fastly.com/incidents/p1lwmmv2j2gq" target="_blank" rel="noopener"
>https://status.fastly.com/incidents/p1lwmmv2j2gq&lt;/a>&lt;/li>
&lt;li>Cloudflare 上周发生的这个问题，我的个人 blog 也遇到了，Google 的搜索索引服务记录了那些 500 错误，我也感到非常诧异；第三方传输供应商问题导致HTTP 5xx错误增加； 官方：&lt;a class="link" href="https://www.cloudflarestatus.com/incidents/hptvkprkvp23" target="_blank" rel="noopener"
>https://www.cloudflarestatus.com/incidents/hptvkprkvp23&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="鳄鱼杯2020年第二季度最大宕机颁">鳄鱼杯：2020年第二季度最大宕机颁
&lt;/h3>&lt;p>来源：&lt;a class="link" href="https://statusgator.com/blog/2020/08/21/5-biggest-outages-of-q2-2020/" target="_blank" rel="noopener"
>https://statusgator.com/blog/2020/08/21/5-biggest-outages-of-q2-2020/&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/crocodile-cup-3-1.jpg"
loading="lazy"
>&lt;/p>
&lt;p>任何可能发生的坏事都会发生。这句古老的谚语100%适用于技术行业，在这个行业中，崩溃和中断远比销售和营销团队希望我们想象的要常见得多。然而，与基础设施打交道的DevOps工程师知道，要确保所有东西都能一直按预期工作是多么困难&amp;ndash;并配置监控，实际跟踪系统的健康状况，帮助防止崩溃和停机。&lt;/p>
&lt;p>在StatusGator，我们监控800多个基于云的服务的状态页面，并向用户提供即时通知。我们拥有堆积如山的宕机和中断数据，并能看到全貌，因此我们决定每季度制定一份最高宕机时间列表。我们希望我们的发现能够激励DevOps工程师去看看其他人是如何处理服务中断的，以便他们能够提高自己的可靠性。&lt;/p>
&lt;p>请继续阅读，了解2020年第二季度的五大故障，以及Slack、Zoom、GitHub、IBM Cloud和T-Mobile在这些危机中如何行动。我们还对这些故障的结果进行了评级，并很乐意听到您对我们评级的看法。&lt;/p>
&lt;h4 id="第一名-slack-全球范围的服务中断-may-12-2020">第一名 Slack 全球范围的服务中断, May 12, 2020
&lt;/h4>&lt;p>Slack是全球数千家公司的主要沟通方式，因此其稳定的正常运行时间是最重要的问题。因此，当用户在美国东部时间晚上7:30左右停止发送和接收Slack消息时，情况迅速升级为一个全面的问题。与之前的故障期间不同，这影响到了整个Slack生态系统：没有人能够登录Slack，也没有人能够收到任何通知。&amp;ldquo;Slack宕机了吗？&amp;quot;，用户们自问自答，答案是毋庸置疑的 &amp;ldquo;是！&amp;rdquo;&lt;/p>
&lt;p>美国东部时间晚上10:26，Slack报告全面恢复了服务，并再次为造成的不便道歉。更重要的是，他们在Medium上发表了一份详细的事后报告，解释了问题背后的原因，他们为克服这个问题所采取的行动，得出的结论，以及他们正在采取的措施，以消除类似情况再次发生的机会。&lt;/p>
&lt;p>欢迎阅读这篇事后总结，它的技术性很强，但即使是普通人也很容易理解。Slack在这里展示了他们对用户群成员&amp;ndash;包括开发者和大众用户群&amp;ndash;的关心，这篇文章所投射出的信心令人钦佩。&lt;/p>
&lt;p>这里需要注意的是，虽然问题本身是在美国东部时间上午8:30开始的，但直到美国东部时间晚上7:30左右，多名用户报告了Slack的问题，这个问题才完全被人察觉。在Slack团队意识到这一情况之前，他们在应用内部（当时大部分已经宕机）、Twitter上、Downdetector上、Slack网站（很快就宕机了）以及其他许多渠道进行了报告。&lt;/p>
&lt;h4 id="第二名-zoom-宕机-may-17-2020">第二名 Zoom 宕机, May 17, 2020
&lt;/h4>&lt;p>自冠状病毒大流行以来，随着越来越多的人远程工作和学习，Zoom的使用率急剧上升。Zoom状态页面的订阅量也是如此，自4月份以来，StatusGator中的订阅量急剧上升。&lt;/p>
&lt;p>除了企业被迫开始远程办公外，许多教会和其他公共组织也开始使用Zoom来举行周日弥撒、会议以及举办公共活动。因此，虽然周日不是工作日，但英国的许多付费账户很快就发现他们无法主持或加入Zoom会议（免费账户似乎没有受到影响）。这个问题通过多种渠道被报告，包括Twitter和监控Zoom状态的StatusGator。&lt;/p>
&lt;p>Zoom发言人回应称，承认意识到了这一情况，并提到这只影响了一个子集的用户。然而，我们都知道子集可能是1%或99%，Zoom没有提供任何关于受影响用户量的说明。提供更透明的受影响用户的比例是一个高质量状态页面的标志，这是Zoom应该改进的地方。&lt;/p>
&lt;h4 id="第三名-github-又无法访问了-june-29-2020">第三名 GitHub 又无法访问了. June 29, 2020
&lt;/h4>&lt;p>自从GitHub被微软以75亿美元收购后，GitHub似乎又下降了很多。原因尚未披露，我们只能猜测原因。也许是与GitHub基础设施与微软系统的整合有关。也许是因为GitHub的发展速度更快，增加了更多的功能。无论如何，从收购到现在已经快两年了，用户发现GitHub的持续宕机时间越来越长。我们对GitHub状态页面的独立分析证实，在过去的两年里，宕机变得更加频繁。&lt;/p>
&lt;p>微软正在努力将GitHub变成一个比以前更好的开发者场所。这家雷德蒙德巨头在今年早些时候让所有的付费计划变得更加实惠，并免费提供一些关键功能，将更多的工具放在IT专业人士的手中。微软、苹果、AWS、谷歌、Facebook和其他数千家公司使用GitHub来存储和运行他们的代码仓库，因此它的正常运行时间是最重要的。&lt;/p>
&lt;p>然而，GitHub在2020年6月29日出现了两个小时的故障。整个网站及其服务都无法访问，因此许多开发人员甚至无法推送代码或部署他们的应用程序，因为GitHub集成的数量没有响应。自然，这引起了很大的反响，并导致GitHub除了状态页面外，还推出了每月的可用性报告，对每次中断的原因和结果进行了详细的解释。&lt;/p>
&lt;h4 id="第四名-ibm-cloud-挂了服务状态页面有更新-june-10-2020">第四名 IBM Cloud 挂了，服务状态页面有更新, June 10, 2020
&lt;/h4>&lt;p>任何基于云的服务都会犯的最大错误之一就是将其状态页面托管在自己的基础设施上。看来IBM云就是这么做的，所以当它的整个基础设施在6月份有几个小时无法访问的时候，它的状态页面也随之而来。我们本可以期待IBM在今年3月的达拉斯宕机事件后得出一些结论，但是，显然，他们并没有理会，或者说没有做出足够的努力。&lt;/p>
&lt;p>于是，在2020年6月10日，IBM云基础设施在全球范围内宕机。这次宕机使得Watson AI、IBM Cloud Foundry、Kubernetes Service、云对象存储、身份访问和管理、VPS的VPN、App Connect等功能完全无法访问。幸运的是，IBM Cloud状态页面只在中断初期无法使用，后来才断断续续地可用。这也是为什么StatusGator还能向订阅了IBM Cloud状态页面的用户发送提醒的原因。&lt;/p>
&lt;p>该公司完全没有告知中断的原因，以及为缓解影响所采取的措施。后来从一个独立的监控服务机构了解到，一个第三方网络提供商广泛使用了流量路线，导致IBM云配置带宽严重受限。IBM专家对系统进行了重新配置，并恢复了运行，但随后并没有官方的解释或公告&amp;ndash;这让用户非常失望。&lt;/p>
&lt;p>这不是IBM第一次在公共关系上失败，我们认为，也不会是最后一次。这可能是他们尽管提供了多样化的有竞争力的云服务，却远远落后于AWS、谷歌云平台、微软Azure和其他云服务商的原因之一。&lt;/p>
&lt;p>但IBM能做什么呢？自然是有一个独立的状态页面! 下面只是他们可以使用的一些变种。&lt;/p>
&lt;h4 id="第五名-t-mobile冲洗其网络下水道2020年6月15日">第五名 T-Mobile冲洗其网络下水道，2020年6月15日
&lt;/h4>&lt;p>作为美国、欧盟和英国最大的移动网络运营商之一，T-Mobile最近发现自己正处于一场完美的风暴之中，它在美国各地连续13个小时无法提供语音和短信服务。外界观察家马修-普林斯（Matthew Prince，CEO@Cloudflare）认为，&amp;ldquo;T-Mobile对他们的网络进行了一些改变，但这些改变出了问题，导致他们的用户出现了一连串的故障&amp;rdquo;。他还表示，&amp;ldquo;这场灾难几乎可以肯定完全是T-Mobile团队自己造成的&amp;rdquo;。&lt;/p>
&lt;p>相反，T-Mobile技术总裁Neville Ray在推特上表示，虽然这确实是一个 &amp;ldquo;影响全国用户语音和文字服务的重大问题&amp;rdquo;，但它源于第三方供应商的系统故障，T-Mobile的工程师正在努力修复。随后，他在博客中详细阐述了这一话题，并对故障原因进行了解释。&lt;/p>
&lt;p>引用雷先生的话说：&amp;ldquo;据悉，触发事件是东南部的第三方供应商的租用光纤电路故障。这是每一个移动网络都会发生的事情，所以我们与我们的供应商合作，建立冗余和弹性，以确保这种类型的电路故障不会影响客户。这种冗余让我们失败了，导致了过载的情况，然后又因为其他因素而变得更加复杂&amp;rsquo;。这导致IP池过载，美国所有地区都发生了崩溃。&lt;/p>
&lt;p>由于无法接触到大多数服务，T-Mobile的客户开始报告Facebook、Instagram和其他平台无法使用，而实际上离线的是他们的移动运营商网络。Business Insider报道称，虽然T-mobile客户将故障归咎于AT&amp;amp;T和Verizon，但这两家运营商都是在正常的负载水平下运营的。不过，前述Neville Ray的帖子表示，T-Mobile正在采取一切必要措施，通过为所有核心系统建立双重弹性和冗余措施，确保未来不可能发生此类事件。&lt;/p>
&lt;p>可以看到，公司无法明确表达自己的立场，从一开始就不愿意承担失败的责任，以及在故障发生后缺乏透明度，都没能让T-mobile毫无污点地走出困境。这甚至导致了他们面临大规模DDoS攻击却未能击退的传闻。&lt;/p>
&lt;h3 id="statusgator为第二季参赛者颁奖">StatusGator为第二季参赛者颁奖
&lt;/h3>&lt;p>让我们根据这些宕机事件的发现、相关公司的沟通以及每个事件的结果来评定。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/gator-q2.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/Group-20-2048x1474.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="新闻">新闻
&lt;/h2>&lt;h2 id="软件发布">软件发布
&lt;/h2>&lt;ul>
&lt;li>Kubernetes 1.19 发布了， 它由34项增强功能组成。10个增强版转为稳定版，15个增强版在测试版，9个增强版在alpha版。&lt;/li>
&lt;li>AWS 发布新的 EBS 卷类型 (io2) 提高 100x 持久性，和 10x 倍的 IOPS/GiB&lt;/li>
&lt;li>Tekton Hub 预览版上线，随着该项目对底层流水线和构建的定义的日臻成熟，开放出一个相关的自由市场也是必然的，开源生态催生出来的上下游技术提供和消费的模式正在普及中，无周边生态的很难获利和发展，&lt;a class="link" href="https://hub-preview.tekton.dev/" target="_blank" rel="noopener"
>https://hub-preview.tekton.dev/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="devops-大会峰会">DevOps 大会/峰会
&lt;/h3>&lt;h4 id="中国-devops-社区流水线大赛--pipeline-craft-championship">中国 DevOps 社区流水线大赛 &amp;ndash; Pipeline Craft Championship
&lt;/h4>&lt;ul>
&lt;li>8 月 18 日开始为期两个月，免费活动&lt;/li>
&lt;li>报名：&lt;a class="link" href="https://wj.qq.com/s2/6852880/c181" target="_blank" rel="noopener"
>https://wj.qq.com/s2/6852880/c181&lt;/a>&lt;/li>
&lt;li>活动官网：&lt;a class="link" href="https://Pipeline.devopsmeetup.com" target="_blank" rel="noopener"
>https://Pipeline.devopsmeetup.com&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="snykcon">SnykCon
&lt;/h4>&lt;ul>
&lt;li>将在10月21日/22日举行一个关于所有应用安全和 DevOps 的在线活动。免费注册，CFP现在开放。&lt;/li>
&lt;li>&lt;a class="link" href="https://snyk.io/snykcon/" target="_blank" rel="noopener"
>https://snyk.io/snykcon/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>推荐和分享你感兴趣的大会和峰会给我和其它人吧？发邮件到：&lt;a class="link" href="mailto:martin@devopscoach.org" >martin@devopscoach.org&lt;/a>&lt;/p>
&lt;h2 id="文章">文章
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/WhyAvoidAutomation.gif"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>这是一篇很好的文章，讲述了在整个组织中获得变革的支持时，自动化这个词所带来的问题，以及为什么观念很重要。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://blogs.starcio.com/2020/08/avoid-calling-it-automation.html" target="_blank" rel="noopener"
>https://blogs.starcio.com/2020/08/avoid-calling-it-automation.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>什么是Kubernetes Operators，为什么它对SRE很重要？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在Kubernetes Operators: 自动化容器编排平台》中，作者Jason Dobies和Joshua Wood将Operators描述为 &amp;ldquo;其应用的自动化站点可靠性工程师&amp;rdquo;。鉴于SRE的多方面经验和多样化的工作量，这是一个大胆的说法。那么，Operators到底能做什么呢？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.blameless.com/blog/what-is-a-kubernetes-operators-and-how-to-automate-sre" target="_blank" rel="noopener"
>https://www.blameless.com/blog/what-is-a-kubernetes-operators-and-how-to-automate-sre&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>探讨遗留IT系统的隐秘世界。探讨了一些值得注意的事件，以及我们需要更多地了解如何建立可长期运行的系统。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://spectrum.ieee.org/computing/it/inside-hidden-world-legacy-it-systems" target="_blank" rel="noopener"
>https://spectrum.ieee.org/computing/it/inside-hidden-world-legacy-it-systems&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>一篇文章，讲述了随着组织的发展，增加一个总括性的平台团队的风险，以及为什么向平台组件和重用发展可以更具扩展性。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://kislayverma.com/organizations/a-case-against-platform-teams/" target="_blank" rel="noopener"
>https://kislayverma.com/organizations/a-case-against-platform-teams/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>NoOps Go on Cloud Run&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://medium.com/@peter.malina/noops-go-on-cloud-run-689d92215c5c" target="_blank" rel="noopener"
>https://medium.com/@peter.malina/noops-go-on-cloud-run-689d92215c5c&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="工具">工具
&lt;/h2>&lt;ul>
&lt;li>werf/werf : GitOps 交付工具&lt;/li>
&lt;li>ovh/cds : 企业级持续交付和 DevOps 自动化开源平台，&lt;/li>
&lt;li>markphelps/flipt 一个现代的功能开关方案&lt;/li>
&lt;li>fluxcd/toolkit ： 用 GitOps 的方式组装 CD 流水线的体验版工具包。&lt;/li>
&lt;li>&lt;/li>
&lt;/ul>
&lt;h2 id="学习资源">学习资源
&lt;/h2>&lt;p>本周推荐如下 B 站学习资源。&lt;/p>
&lt;p>Jenkins+Ansible+Gitlab自动化部署（CI/CD）&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.bilibili.com/video/BV1Dp411Z7Lf" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV1Dp411Z7Lf&lt;/a>&lt;/li>
&lt;li>持续集成在工作中的应用。&lt;/li>
&lt;/ul>
&lt;p>通俗易懂ElasticSearch 项目实践课程&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.bilibili.com/video/BV1wA411n7LY" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV1wA411n7LY&lt;/a>&lt;/li>
&lt;li>搜房网实例项目讲解&lt;/li>
&lt;/ul>
&lt;p>【Python趣味教学】99%相似度！手把手教你用Python制作超级玛丽游戏&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.bilibili.com/video/BV1G54y197C2" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV1G54y197C2&lt;/a>&lt;/li>
&lt;li>前26集都在这了，爱编程的小伙伴们，一起来重现童年经典吧！&lt;/li>
&lt;/ul>
&lt;p>Kubernetes教程 k8s企业级DevOps实践&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.bilibili.com/video/BV1c64y1F7wP" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV1c64y1F7wP&lt;/a>&lt;/li>
&lt;li>k8s是一个开源的，用于管理云平台中多个主机上的容器化的应用，Kubernetes的目标是让部署容器化的应用简单并且高效（powerful）,Kubernetes提供了应用部署，规划，更新，维护的一种机制。&lt;/li>
&lt;/ul></description></item><item><title>Elasticsearch 3 节点集群搭建 (7.9.0)</title><link>https://martinliu.cn/blog/elasticsearch-3-nodes-cluster-setup/</link><pubDate>Thu, 27 Aug 2020 13:54:46 +0800</pubDate><guid>https://martinliu.cn/blog/elasticsearch-3-nodes-cluster-setup/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-6.jpg" alt="Featured image of post Elasticsearch 3 节点集群搭建 (7.9.0)" />&lt;p>最近发布的 Elastic Stack 7.9 ，带来了很多新的特性。Elastic Agent 统一集成数据采集代理是一大亮点。另外还看增加了企业搜索、端点安全防护等组件。Ingest Manager 统一 Beat 配置管理功能让我们向 SaaS 风格的监控工具又迈进了一步。由代理端自行注册到后端，在后端统一纳管所有被管理服务器，将是一种以后非常通用的模式。这样做的好处是：将数据采集端点的配置工作量和复杂度降低到最低。Beats 的各种相关独立模块也在平行的发布，这种双轨模式也可以让用户更弹性的做出选择，能最大程度的保持旧版本部署环境管理模式的延续性。 Ingest manager 的前提条件是：后台 ES 需要启用 api key 安全，启用 ES 客户端的 HTTPS 访问。我们也可以看到这两个功能选项也有其非常广泛的应用需求。本文将用最简单的文字，向你描述一套 3 节点的 ES 集群的搭建方式，这套系统的核心特性如下：&lt;/p>
&lt;ul>
&lt;li>启用用户名和密码认证&lt;/li>
&lt;li>启用集群内 es 节点间 transport.ssl 通讯加密&lt;/li>
&lt;li>启用 es 的 http 客户端 http.ssl 加密通讯&lt;/li>
&lt;li>安装脚本中包括创建数字证书的必要命令（没猜错的话，大部分人可能会在这一步花费大量时间）&lt;/li>
&lt;/ul>
&lt;h2 id="演示环境介绍">演示环境介绍
&lt;/h2>&lt;p>我使用的是本地的测试环境，环境配置如下：&lt;/p>
&lt;ul>
&lt;li>Mac OS&lt;/li>
&lt;li>vagrant&lt;/li>
&lt;li>virtualBox - CentOS 8&lt;/li>
&lt;li>Elastic Stack 7.9.0&lt;/li>
&lt;li>ip 和主机名分配见 Vagrantfile 文件&lt;/li>
&lt;li>Vagrant 的 vagrant-hostsupdater 插件实现了 Mac OS 主机和所有虚拟机的 host 文件 DNS 解析的同步，保证所有相关虚拟机都可以解析其它虚拟机的 FQDN，尽量模拟生产环境。&lt;/li>
&lt;/ul>
&lt;p>本文所使用的所有配置文件和安装脚本见：&lt;a class="link" href="https://github.com/DevOps-Coach/elasticstack.git" target="_blank" rel="noopener"
>https://github.com/DevOps-Coach/elasticstack.git&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="n">elasticstack&lt;/span> &lt;span class="n">git&lt;/span>&lt;span class="p">:(&lt;/span>&lt;span class="n">master&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="err">✗&lt;/span> &lt;span class="n">vagrant&lt;/span> &lt;span class="n">up&lt;/span> &lt;span class="n">es1&lt;/span> &lt;span class="n">es2&lt;/span> &lt;span class="n">es3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Bringing&lt;/span> &lt;span class="n">machine&lt;/span> &lt;span class="s1">&amp;#39;es1&amp;#39;&lt;/span> &lt;span class="n">up&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="s1">&amp;#39;virtualbox&amp;#39;&lt;/span> &lt;span class="n">provider&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Bringing&lt;/span> &lt;span class="n">machine&lt;/span> &lt;span class="s1">&amp;#39;es2&amp;#39;&lt;/span> &lt;span class="n">up&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="s1">&amp;#39;virtualbox&amp;#39;&lt;/span> &lt;span class="n">provider&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Bringing&lt;/span> &lt;span class="n">machine&lt;/span> &lt;span class="s1">&amp;#39;es3&amp;#39;&lt;/span> &lt;span class="n">up&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="s1">&amp;#39;virtualbox&amp;#39;&lt;/span> &lt;span class="n">provider&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">es1&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Importing&lt;/span> &lt;span class="n">base&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="s1">&amp;#39;bento/centos-8&amp;#39;&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">es1&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Matching&lt;/span> &lt;span class="n">MAC&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">NAT&lt;/span> &lt;span class="n">networking&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">es1&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Checking&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="s1">&amp;#39;bento/centos-8&amp;#39;&lt;/span> &lt;span class="n">version&lt;/span> &lt;span class="s1">&amp;#39;202002.04.0&amp;#39;&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">up&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">date&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">省略中间大量输出。。。。。。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="err">●&lt;/span> &lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">Elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Loaded&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">loaded&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">systemd&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">enabled&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">vendor&lt;/span> &lt;span class="n">preset&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">disabled&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Active&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">active&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">running&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">since&lt;/span> &lt;span class="n">Thu&lt;/span> &lt;span class="mi">2020&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">08&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">27&lt;/span> &lt;span class="mi">05&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">55&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">21&lt;/span> &lt;span class="n">UTC&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="mi">223&lt;/span>&lt;span class="n">ms&lt;/span> &lt;span class="n">ago&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Docs&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">www&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">elastic&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">co&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Main&lt;/span> &lt;span class="n">PID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4205&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">java&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Tasks&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">41&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">limit&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">11499&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Memory&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.2&lt;/span>&lt;span class="n">G&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">CGroup&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">slice&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="err">├─&lt;/span>&lt;span class="mi">4205&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">jdk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">java&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Xshare&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">auto&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">networkaddress&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">60&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">networkaddress&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">negative&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">AlwaysPreTouch&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Xss1m&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Djava&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">awt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">headless&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dfile&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">UTF&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Djna&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nosys&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">OmitStackTraceInFastThrow&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">ShowCodeDetailsInExceptionMessages&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dio&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">netty&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">noUnsafe&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dio&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">netty&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">noKeySetOptimization&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dio&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">netty&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recycler&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">maxCapacityPerThread&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dio&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">netty&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">allocator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">numDirectArenas&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dlog4j&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shutdownHookEnabled&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">false&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dlog4j2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">disable&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">jmx&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Djava&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">locale&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">providers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">SPI&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">COMPAT&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Xms1g&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Xmx1g&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">UseG1GC&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">G1ReservePercent&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">25&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">InitiatingHeapOccupancyPercent&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Djava&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tmpdir&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">tmp&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">14730718416313121303&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">HeapDumpOnOutOfMemoryError&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">HeapDumpPath&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">ErrorFile&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">hs_err_pid&lt;/span>&lt;span class="o">%&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Xlog&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">gc&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">gc&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">trace&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">safepoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">gc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">utctime&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">pid&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">tags&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">filecount&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">filesize&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">MaxDirectMemorySize&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">536870912&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conf&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">distribution&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">flavor&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">default&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">distribution&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">rpm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bundled_jdk&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">cp&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/*&lt;/span> &lt;span class="n">org&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bootstrap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Elasticsearch&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">quiet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="err">└─&lt;/span>&lt;span class="mi">4360&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pack&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ml&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">platform&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">x86_64&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">controller&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Aug&lt;/span> &lt;span class="mi">27&lt;/span> &lt;span class="mi">05&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span> &lt;span class="n">es3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zenlab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span> &lt;span class="n">systemd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]:&lt;/span> &lt;span class="n">Starting&lt;/span> &lt;span class="n">Elasticsearch&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Aug&lt;/span> &lt;span class="mi">27&lt;/span> &lt;span class="mi">05&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">55&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">21&lt;/span> &lt;span class="n">es3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zenlab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span> &lt;span class="n">systemd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]:&lt;/span> &lt;span class="n">Started&lt;/span> &lt;span class="n">Elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Provisioning&lt;/span> &lt;span class="n">script&lt;/span> &lt;span class="n">works&lt;/span> &lt;span class="n">good&lt;/span>&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Please&lt;/span> &lt;span class="n">access&lt;/span> &lt;span class="n">Elasticsearch&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.13&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9200&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后的系统登录验证命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="n">elasticstack&lt;/span> &lt;span class="n">git&lt;/span>&lt;span class="p">:(&lt;/span>&lt;span class="n">master&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="err">✗&lt;/span> &lt;span class="n">curl&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">cacert&lt;/span> &lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ca&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ca&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">u&lt;/span> &lt;span class="n">elastic&lt;/span> &lt;span class="s1">&amp;#39;https://es1.zenlab.local:9200/_cat/nodes?v&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Enter&lt;/span> &lt;span class="n">host&lt;/span> &lt;span class="n">password&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">user&lt;/span> &lt;span class="s1">&amp;#39;elastic&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">heap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">percent&lt;/span> &lt;span class="n">ram&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">percent&lt;/span> &lt;span class="n">cpu&lt;/span> &lt;span class="n">load_1m&lt;/span> &lt;span class="n">load_5m&lt;/span> &lt;span class="n">load_15m&lt;/span> &lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">master&lt;/span> &lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.13&lt;/span> &lt;span class="mi">26&lt;/span> &lt;span class="mi">95&lt;/span> &lt;span class="mi">8&lt;/span> &lt;span class="mf">0.03&lt;/span> &lt;span class="mf">0.31&lt;/span> &lt;span class="mf">0.18&lt;/span> &lt;span class="n">dilmrt&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">es3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.12&lt;/span> &lt;span class="mi">33&lt;/span> &lt;span class="mi">95&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mf">0.01&lt;/span> &lt;span class="mf">0.14&lt;/span> &lt;span class="mf">0.09&lt;/span> &lt;span class="n">dilmrt&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">es2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.11&lt;/span> &lt;span class="mi">36&lt;/span> &lt;span class="mi">93&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="mf">0.06&lt;/span> &lt;span class="mf">0.16&lt;/span> &lt;span class="mf">0.12&lt;/span> &lt;span class="n">dilmrt&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">es1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上命令需要输入 elastic 用户的密码，es1 节点初始化了所有 Elasticsearch 内置用户的密码，需要复制 console 中的那一段密码信息备用。&lt;/p>
&lt;p>创建以上所有数字证书和秘钥文件的种子文件是 certs/instance.yml ：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># instance.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">instances:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.11&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es1.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#34;es2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.12&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es2.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es3&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.13&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es3.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es4&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.14&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es4.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#34;es5&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.15&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es5.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es6&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.16&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es6.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es7&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.17&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es1.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#34;es8&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.18&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es2.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es9&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.19&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es3.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;lk&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.20&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;lk.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里一次性生产了所有我这个本地测试环境里可能用到的数字证书文件。&lt;/p>
&lt;h2 id="elasticsearch-安装脚本">Elasticsearch 安装脚本
&lt;/h2>&lt;p>下面是第一个 Elasticsearch 节点的安装脚本和注释，pre-install-es1.sh ：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="c1"># author: Martin Liu&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># url:martinliu.cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#指定安装的版本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">elastic_version&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;7.9.0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#开始安装流程&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Provisioning a Elasticsearch &amp;#34;&lt;/span>&lt;span class="nv">$elastic_version&lt;/span>&lt;span class="s2">&amp;#34; Server...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo date &amp;gt; /etc/vagrant_provisioned_at
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#配置 ES 需要的操作系统参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo swapoff -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sysctl -w vm.max_map_count&lt;span class="o">=&lt;/span>&lt;span class="m">262144&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sysctl -p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &lt;span class="s2">&amp;#34;echo &amp;#39;elasticsearch - nofile 65535&amp;#39; &amp;gt;&amp;gt; /etc/security/limits.conf&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设置个性化 SSH 登录提示信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &lt;span class="s2">&amp;#34;echo &amp;#39;**** -- -- -- -- -- -- -- -- ****&amp;#39; &amp;gt; /etc/motd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &lt;span class="s2">&amp;#34;echo &amp;#39;**** Welcome to Elastic Stack Labs&amp;#39; &amp;gt;&amp;gt; /etc/motd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &lt;span class="s2">&amp;#34;echo &amp;#39;**** -- -- -- -- -- -- -- -- ****&amp;#39; &amp;gt;&amp;gt; /etc/motd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &lt;span class="s2">&amp;#34;echo &amp;#39;*&amp;#39; &amp;gt;&amp;gt; /etc/motd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#安装 ES 软件包&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rpm -ivh /vagrant/rpm/elasticsearch-&lt;span class="nv">$elastic_version&lt;/span>-x86_64.rpm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#创建 ES 集群内部通信加密数字证书，提前清理旧的证书文件和目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -f /vagrant/certs/certs.zip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -rf /vagrant/certs/es*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -rf /vagrant/certs/ca
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -rf /vagrant/certs/lk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo /usr/share/elasticsearch/bin/elasticsearch-certutil cert -in /vagrant/certs/instance.yml -pem -out /vagrant/certs/certs.zip -s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#解压缩所有证书备用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo /usr/bin/unzip /vagrant/certs/certs.zip -d /vagrant/certs/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#部署节点需要的秘钥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/certs/ca/ca.crt /etc/elasticsearch/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/certs/es1/* /etc/elasticsearch/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#更新 ES 默认的配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/es1.yml /etc/elasticsearch/elasticsearch.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#配置和启动 ES 系统服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status elasticsearch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#初始化 ES 服务器内建用户的密码，这些密码需要在控制台上复制保存备用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo /usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto -b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#成功顺利的完成了安装&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> Provisioning script works good!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> Please access Elasticsearch https://192.168.50.11:9200
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>说明：你也可以参考以上脚本手工执行，如果是非 Vagrant 环境，请注意替换各个命令中相关文件的路径。第二个和第三个节点的安装脚本稍有不同，详情见代码库。&lt;/p>
&lt;h2 id="elasticsearch-配置文件">Elasticsearch 配置文件
&lt;/h2>&lt;p>下面是第一个 Elasticsearch 节点的参考配置文件， es1.yml ：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ---------------------------------- Cluster -----------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设定集群名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cluster&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">elk4devops&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------------ Node ------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设定节点名称，此处使用的是 hostname&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">es1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ----------------------------------- Paths ------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设定 es 服务器数据目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设定 es 服务器日志目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">logs&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ---------------------------------- Network -----------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设定此节点加入网络的名称，这里使用的是 FQDN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">network&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">es1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zenlab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --------------------------------- Discovery ----------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设定初始的 master 节点为 es1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cluster&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">initial_master_nodes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;es1&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">discovery&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seed_hosts&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;es1.zenlab.local&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------- TLS and Cert ---------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#启用用户名和密码认证&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#启用 ES 集群内加密传输&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">certificate_authorities&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ca&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">certificate&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#启用 ES 集群客户端访问加密&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">certificate_authorities&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ca&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">certificate&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For Elastic Agent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">authc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">api_key&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#启用监控数据收集&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">collection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------- App Search ---------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#提前为 App Search 做好准备&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">action&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">auto_create_index&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;.app-search-*-logs-*,-.app-search-*,+*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>说明：第二个和第三个节点的配置文件稍有不同，详情见代码库。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>在三节点集群的搭建过程中，最好建议启用各种安全和加密选项，用配置安装脚本最小化工作量；这样一步到位的安全性，可以为后续增加其他 Elastic Stack 的产品组件打下良好的基础，ES 集群的配置尽量完善，尽量覆盖后期的其他各种潜在需求，减少未来配置变更的工作量，让后续的测试越来越轻松。&lt;/p></description></item><item><title>DevOps Coach 周刊 5</title><link>https://martinliu.cn/blog/devopscoach-weekly-5/</link><pubDate>Tue, 25 Aug 2020 15:20:51 +0800</pubDate><guid>https://martinliu.cn/blog/devopscoach-weekly-5/</guid><description>&lt;img src="https://martinliu.cn/images/weeklyupdate.jpg" alt="Featured image of post DevOps Coach 周刊 5" />&lt;h2 id="宕机">宕机
&lt;/h2>&lt;ul>
&lt;li>上一周新发的宕机事故。&lt;/li>
&lt;li>近期全球重大宕机事故的分析总结、事后回顾。&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>May your queries flow and your pagers stay silent.
&amp;ndash;Dave, Betsy, Niall, Stephen, and Ken&lt;/p>&lt;/blockquote>
&lt;h3 id="equinix-重大电力故障让数据中心客户大发雷霆">Equinix 重大电力故障让数据中心客户大发雷霆
&lt;/h3>&lt;ul>
&lt;li>关于 Equinix ：Equinix 是全球领先的数据运营商，目前在美洲、亚太、欧洲及中东 14 个国家（地区）的 31 个市场运营着 94 个国际业务交换。&lt;/li>
&lt;li>消息来源 CBR &lt;a class="link" href="https://www.cbronline.com/news/equinix-outage" target="_blank" rel="noopener"
>https://www.cbronline.com/news/equinix-outage&lt;/a>&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>教练点评：数据中心 UPS 的单点故障并不稀奇，但是这次 Equinix 的事故堪称史诗级事故。&lt;/p>&lt;/blockquote>
&lt;p>&amp;ldquo;经历如此严重的停电，显然是不可接受的&amp;rdquo;&lt;/p>
&lt;p>北京时间 8 月 19 日 8 点 10 分更新：最后的电路似乎已经在 8 月 18 日晚间约 22 点 20 分恢复；在停电开始后约 18 小时。&lt;/p>
&lt;p>数据中心巨头 Equinix 表示，在其位于伦敦码头区的 IBX LD8 数据中心遭遇长时间停电后，它已经为所有客户恢复了机架&amp;ndash;该问题使数百名客户（包括几家 ISP）的服务从北京时间凌晨 4:30 开始离线；使许多人对缓慢的电力恢复深感沮丧。&lt;/p>
&lt;p>&amp;ldquo;Equinix 工程师已将问题的根本原因诊断为 UPS（不间断电源）系统故障，我们正在与客户合作，以尽量减少影响。该公司在北京时间 8 月 18 日 12:04 的首次公开声明中表示：&amp;ldquo;我们对由此造成的任何不便感到遗憾。(ISP Giganet 负责人 Matthew Skipsey 早些时候将 Equinix 缺乏沟通描述为 &amp;ldquo;糟糕透顶&amp;rdquo;)。&lt;/p>
&lt;p>多名客户指出，该问题是 Galaxy UPS 系统(由施耐德销售)中的输出静态开关出现故障。该开关将关键负载连接到 UPS 的条件电源或旁路电源的原始电源。停电时间的长短表明，LD8 的 A+B 交流电源是来自同一个 UPS。期望其直流供应商确保弹性和依赖单一数据中心的 ISP 正在吸取惨痛教训。&lt;/p>
&lt;p>伦敦互联网交易所 LINX 同时表示，约有 150 名 LINX 会员直接受到此次事件的影响。(到 13:42，LINX 的所有设备都恢复了。该组织有 900 多个 ASN 从 80 多个不同的国家连接）。)&lt;/p>
&lt;p>受影响的一个客户是 ISP Giganet。它告诉客户。&amp;ldquo;我们仍在等待我们的网络架恢复供电 继 Equinix 和他们的承包商在早期故障后将电源迁移到新的基础设施上之后。&lt;/p>
&lt;p>&amp;ldquo;可悲的是，仍然没有估计的修复时间，这是最令人沮丧的。他们已向我们保证，他们将在可能的情况下提供这一信息。Equinix 不断被追问最新情况。正如您所了解的那样，这是一个 P1 问题，影响着许多 100 多家其他运营商/ISP&amp;ndash;所以它被赋予了最大的优先级。&amp;rdquo;&lt;/p>
&lt;p>据了解，英国电信也是受影响的公司之一。数据中心的访问控制系统已经被中断，一个客户，马修-斯基普西说，&amp;ldquo;所以一切[是]通过双向无线电手动运行，然后通过其他地方打电话。疯狂的时代。这是一个 MBORC 的地狱。&amp;rdquo;&lt;/p>
&lt;p>Equinix 表示，它允许客户 &amp;ldquo;更灵活地访问 LD8&amp;rdquo;，因为它争分夺秒地解决这个问题，&amp;ldquo;在我们的 COVID-19 限制内工作&amp;rdquo;。&lt;/p>
&lt;p>Giganet 补充道：&amp;ldquo;我们已经在凌晨 4.23 时左右失去了我们 2 个 Equinix LD8 机架中的 1 个机架的两个 A+B 馈线。此前，根据 Equinix 的报告，UPS 出现故障，然后触发了数据中心的火警。我们失去电源的机架上安装着我们的核心 Juniper MX 路由器和 Cisco LNS。瞻博网络 MX 路由器是我们的核心设备，LD8 中的一切功能都需要它，包括终止一些专线连接以及为我们的 vDC 平台提供连接。我们所有的设备电源都是由数据中心提供的&amp;rsquo;多样化&amp;rsquo;A+B 电源双馈&amp;ndash;但是经过这次事件，我们怀疑是缺乏弹性，在事件解决后一定会提出来，因为经历如此严重的断电显然是不可接受的。&amp;rdquo;&lt;/p>
&lt;h3 id="google-公司的云平台和-g-stuit-系列事故">Google 公司的云平台和 G Stuit 系列事故
&lt;/h3>&lt;ul>
&lt;li>来源官方 &lt;a class="link" href="https://status.cloud.google.com/incident/zall/20008#20008005" target="_blank" rel="noopener"
>https://status.cloud.google.com/incident/zall/20008#20008005&lt;/a>&lt;/li>
&lt;li>Google Cloud Infrastructure Components Incident #20008&lt;/li>
&lt;li>GCP 多个产品发生故障：App Engine, Cloud Storage 和 Cloud Logging&lt;/li>
&lt;li>G Suit 多个模块和功能：Gmail, Drive, Docs/Editor, Chat, Meet, Keep, Voice, Jamboard, Admin Console&lt;/li>
&lt;li>事故时间：August 19, 2020, from 20:55 to 03:30&lt;/li>
&lt;li>诊断：AppEngine 的部署会报错，访问 GCS 桶时的高延迟，以及 Cloud Logging 中的日志条目丢失。G Suit 多种产品报错和无法使用。&lt;/li>
&lt;li>详细的事故总结报告&lt;a class="link" href="https://static.googleusercontent.com/media/www.google.com/zh-CN//appsstatus/ir/bd9m3vkqwpvkk4j.pdf" target="_blank" rel="noopener"
>https://static.googleusercontent.com/media/www.google.com/zh-CN//appsstatus/ir/bd9m3vkqwpvkk4j.pdf&lt;/a>&lt;/li>
&lt;li>根本原因
&lt;ul>
&lt;li>许多 Google 服务使用一个通用的、内部的、分布式的系统来存储不可变的、非结构化的数据，也就是二进制大对象，或者说 blob。这个 blob 存储系统包含一个与 Google 内部客户端服务对接的前端，一个处理元数据操作的中层，以及一个用于存储数据的后端。blobs 本身。当客户端向前端提出请求时，元数据操作被转发到元数据服务，元数据服务与存储服务进行通信。&lt;/li>
&lt;li>来自另一个 Google 服务的流量增加开始使元数据服务超载，导致任务变得不健康，请求的延迟增加。这种延迟促使这些操作的过度重试，导致资源耗尽。自动化系统试图启动新的元数据任务。然而，其中许多任务立即被其收到的流量所淹没，而这些任务也被淹没。由于资源枯竭，分配到的资源不足。这一问题因以下原因而更加严重： 策略用于取消和重试失败的请求，这对流量造成了倍增效应。&lt;/li>
&lt;li>与其他产品相比，谷歌云存储受到的影响较小。虽然谷歌云存储是建立在 同一个 blob 存储系统，GCS 的元数据层大多与受影响的元数据层隔离。谷歌内部元数据服务。对于 &amp;ldquo;美国&amp;rdquo;，GCS 元数据隔离的迁移正在进行中。多区域，而所有其他迁移工作已经完成。因此，对全球通信系统客户的影响是 减少，这种影响仅限于 &amp;ldquo;美国 &amp;ldquo;多区域。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>教练点评：从事发时刻到 Google 工程师收到告警的时刻（20：58）之间只有短短的 3 分钟，在一个小时内受影响的各个 GCP 服务就开始了并行的调查和补救措施。在 23：00 定位到 blob 存储是根因故障，并实施配置变更，消除了大多数的内部错误。这正是 SRE 中所讨论的重大事故应急流程的有效执行，能快速有效的恢复服务。可以看出 Google 团队在事故响应方面的训练有素。&lt;/p>&lt;/blockquote>
&lt;h3 id="spotify">Spotify
&lt;/h3>&lt;ul>
&lt;li>来源官方 Twitter 账号： &lt;a class="link" href="https://twitter.com/SpotifyStatus/status/1296064517504409600" target="_blank" rel="noopener"
>https://twitter.com/SpotifyStatus/status/1296064517504409600&lt;/a>&lt;/li>
&lt;li>这好像是由于 TLS 证书过期导致的。&lt;/li>
&lt;li>其它媒体报道： &lt;a class="link" href="https://www.teiss.co.uk/spotify-outage-expired-tls-cert/" target="_blank" rel="noopener"
>https://www.teiss.co.uk/spotify-outage-expired-tls-cert/&lt;/a>&lt;/li>
&lt;li>据报道，周三发生了影响音乐流媒体服务 Spotify 的长达一小时的大规模中断，原因是该公司未能在 TLS 证书到期前更新。&lt;/li>
&lt;li>不过，Cloudflare 的网络工程师 Louis Poinsignon 提供了 Spotify 系统内部到底发生了什么事情的线索。据他介绍，该公司显然没有及时更新 TLS 证书，证书过期导致中断。在 TLS 证书更新后，Spotify 的服务很快就恢复了在线。&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>教练点评：Spotify 的特有的团队工作开发模式一直是一种学习的榜样，很难想象他们的服务会在这样简单的问题上翻船。&lt;/p>&lt;/blockquote>
&lt;h2 id="新闻">新闻
&lt;/h2>&lt;h3 id="devops-大会峰会">DevOps 大会/峰会
&lt;/h3>&lt;p>中国 DevOps 社区流水线大赛 &amp;ndash; Pipeline Craft Championship&lt;/p>
&lt;ul>
&lt;li>8 月 18 日开始为期两个月，免费活动&lt;/li>
&lt;li>报名：&lt;a class="link" href="https://wj.qq.com/s2/6852880/c181" target="_blank" rel="noopener"
>https://wj.qq.com/s2/6852880/c181&lt;/a>&lt;/li>
&lt;li>活动官网：&lt;a class="link" href="https://Pipeline.devopsmeetup.com" target="_blank" rel="noopener"
>https://Pipeline.devopsmeetup.com&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>GitLab 的大会 &amp;ndash; Commit: You belong here&lt;/p>
&lt;ul>
&lt;li>8 月 26 日&lt;/li>
&lt;li>线上免费峰会&lt;/li>
&lt;li>&lt;a class="link" href="https://about.gitlab.com/events/commit/" target="_blank" rel="noopener"
>https://about.gitlab.com/events/commit/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>推荐你感兴趣的大会和峰会，发邮件到：&lt;a class="link" href="mailto:martin@devopscoach.org" >martin@devopscoach.org&lt;/a>&lt;/p>
&lt;h3 id="grafana-labs-喜提-b-轮-5000-万美元融资">Grafana Labs 喜提 B 轮 5000 万美元融资
&lt;/h3>&lt;ul>
&lt;li>来源官方：&lt;a class="link" href="https://grafana.com/about/press/2020-08-17-series-b-announcement/" target="_blank" rel="noopener"
>https://grafana.com/about/press/2020-08-17-series-b-announcement/&lt;/a>&lt;/li>
&lt;li>8 月 27 日宣布&lt;/li>
&lt;li>Grafana Labs 还宣布了 Grafana 加速器计划（GAP），以培养在更广泛的 Grafana 生态系统中进行创新的早期公司和副业项目。GAP 将提供免费的 Grafana Cloud 和 Grafana Enterprise 订阅、现金补助、股权融资以及进入 Grafana Labs 核心开发者的内部通道。&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>教练点评：这个 CNCF 的热门项目终于迈向了商业化的第一步，随着企业订阅模式的形成，且看后续的创新开发和社区经营是否也能一浪高过一浪。&lt;/p>&lt;/blockquote>
&lt;h2 id="文章">文章
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>《 Ops 工作的未来 》&lt;/p>
&lt;/li>
&lt;li>
&lt;p>一篇关于运维角色变化的好文章。对于那些想知道现代运维是什么样子的人来说，有一些很好的提示，包括供应商管理、外包基础设施和理解社会技术系统的重要性。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://acloudguru.com/blog/engineering/the-future-of-ops-jobs" target="_blank" rel="noopener"
>https://acloudguru.com/blog/engineering/the-future-of-ops-jobs&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>《 NAT 是如何工作的 》&lt;/p>
&lt;/li>
&lt;li>
&lt;p>对于任何想要更好地了解这个网络领域的人来说，这是一本很好的 NAT 网络介绍。好的图和例子，还有很多细节。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://tailscale.com/blog/how-nat-traversal-works/" target="_blank" rel="noopener"
>https://tailscale.com/blog/how-nat-traversal-works/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>《 如何打造给董事会看的软件开发 KPI 报表 》&lt;/p>
&lt;/li>
&lt;li>
&lt;p>度量标准有很多不同的用途，包括向组织高层报告。这篇文章探讨了用于董事会对话的工程 KPI。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://codeclimate.com/blog/engineering-kpis-board-deck/" target="_blank" rel="noopener"
>https://codeclimate.com/blog/engineering-kpis-board-deck/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>《 马丁富乐老师：单链接通道 》&lt;/p>
&lt;/li>
&lt;li>
&lt;p>有没有想过确保服务之间的消息保持有序，并为任何丢失的消息建立重试机制？这篇文章描述了一个具体的模式，但也是一组关于分布式计算模式的文章的一部分，值得探讨。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://martinfowler.com/articles/patterns-of-distributed-systems/single-socket-channel.html" target="_blank" rel="noopener"
>https://martinfowler.com/articles/patterns-of-distributed-systems/single-socket-channel.html&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>《 提升事故回顾质量的套路 》&lt;/p>
&lt;/li>
&lt;li>
&lt;p>事故回顾越来越常见，但往往很难做好。这段视频和详细的文字记录有各种改进流程的技巧。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.blameless.com/blog/improving-postmortems-paul-osman" target="_blank" rel="noopener"
>https://www.blameless.com/blog/improving-postmortems-paul-osman&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>《 应用日志开发的最佳实践 》&lt;/p>
&lt;/li>
&lt;li>
&lt;p>即使你不是用 Java 编写应用程序，掌握一些关于日志工作的知识通常也是有用的，因为你可能最终会至少运行一些 Java 应用程序。这些帖子提供了一个坚实的基础。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://sematext.com/blog/java-logging/" target="_blank" rel="noopener"
>https://sematext.com/blog/java-logging/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://sematext.com/blog/java-logging-best-practices/" target="_blank" rel="noopener"
>https://sematext.com/blog/java-logging-best-practices/&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="工具">工具
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>标签对于大规模管理 AWS 资源至关重要。Awstaghelper 提供了一个命令行工具，可以轻松地在广泛的 AWS 资源中向 CSV 文件或从 CSV 文件中添加和管理标签。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/mpostument/awstaghelper" target="_blank" rel="noopener"
>https://github.com/mpostument/awstaghelper&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>GitOps 工具包是一套可组合的 API 和专门的工具，可用于在 Kubernetes 之上构建一个持续交付平台。它们应该可以为 Flux 的 v2 提供基础，但也可以用来构建其他有趣的高级工具，采用同样的控制循环方法。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://toolkit.fluxcd.io/" target="_blank" rel="noopener"
>https://toolkit.fluxcd.io/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Kip 是一个虚拟 Kubelet 提供商，它允许 Kubernetes 集群透明地将 pods 发射到自己的云实例上。如果你需要额外的工作负载隔离，这很方便。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/elotl/kip" target="_blank" rel="noopener"
>https://github.com/elotl/kip&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="学习资源">学习资源
&lt;/h2>&lt;p>这里推荐一些值得关注和学习的免费视频学习资料。&lt;/p>
&lt;blockquote>
&lt;p>教练点评：B 站里的相关视频是不可忽视的学习资源。善加利用，就可以加速获取知识的进度。&lt;/p>&lt;/blockquote>
&lt;p>波波老师的系列课程&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://space.bilibili.com/518029478/video" target="_blank" rel="noopener"
>https://space.bilibili.com/518029478/video&lt;/a>&lt;/li>
&lt;li>包括 k8s 和微服务等 DevOps 技术&lt;/li>
&lt;/ul>
&lt;p>【SpringBoot 项目实战】 2020 最新在线教育 spring boot 分布式项目实战&lt;/p>
&lt;ul>
&lt;li>系统后端接口部分，使用目前流行的 SpringBoot+SpringCloud 进行微服务架构，使用 Feign、Gateway、Hystrix，以及阿里巴巴的 Nacos 等组件搭建了项目的基础环境。项目中还使用 MyBatisPlus 进行持久层的操作，使用了 OAuth2+JWT 实现了分布式的访问，项目中整合了 SpringSecurity 进行了权限控制。除此之外，项目中使用了阿里巴巴的 EasyExcel 实现对 Excel 的读写操作，使用了 Redis 进行首页数据的缓存，使用 Git 进行代码的版本控制&lt;/li>
&lt;li>&lt;a class="link" href="https://www.bilibili.com/video/BV1y7411y7am" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV1y7411y7am&lt;/a>&lt;/li>
&lt;li>播放量： 10w+&lt;/li>
&lt;/ul>
&lt;p>2019 谷粒商城微服务 SpringBoot,Dubbo,MySql 高级,Redis 秒杀,ElasticSearch,ActiveMQ,SSO 单点登&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.bilibili.com/video/BV1B4411V7cA" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV1B4411V7cA&lt;/a>&lt;/li>
&lt;li>2019 谷粒商城微服务 SpringBoot, zookeep 注册中心, Dubbo, MySql 高级, ElasticSearch, ActiveMQ, 通用 mapper, 解决秒杀, SSO 单点登录, OAuth2 协议三方登录, 第三方支付接口对接, Redis lua 脚本, Redis 秒杀, Redis 分布式锁, 集群搭建, 分布式, sku,spu 表结构介绍, 等等技术结合使用~~~~~~~~~~~&lt;/li>
&lt;li>播放量： 10w+&lt;/li>
&lt;/ul>
&lt;p>Git+GitHub 教程&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.bilibili.com/video/BV1pW411A7a5" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV1pW411A7a5&lt;/a>&lt;/li>
&lt;li>Git 是先进的分布式版本控制系统，而 Github 是常用的 Git 代码托管中心。
本套教程内容丰富、详实，囊括：Git 安装过程、本地库基本操作、远程基本操作、基于分支的 Gitflow 工作流、跨团队协作的 Forking 工作流、Eclipse 中的 Git 版本控制以及 Git 对 Eclipse 特定文件忽略的配置方法。还通过展示 Git 内部版本管理机制，让你了解 到 Git 高效操作的底层逻辑。教程的最后完整演示了 Gitlab 服务器的搭建过程。&lt;/li>
&lt;li>播放量： 21w+&lt;/li>
&lt;/ul>
&lt;p>GitLab 与 GitFlow 的简单使用&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.bilibili.com/video/BV1Wb411e7ec" target="_blank" rel="noopener"
>https://www.bilibili.com/video/BV1Wb411e7ec&lt;/a>&lt;/li>
&lt;li>播放量： 1w+&lt;/li>
&lt;/ul></description></item><item><title>DevOps Coach 周刊 4</title><link>https://martinliu.cn/blog/devopscoach-weekly-4/</link><pubDate>Mon, 17 Aug 2020 18:43:26 +0800</pubDate><guid>https://martinliu.cn/blog/devopscoach-weekly-4/</guid><description>&lt;img src="https://martinliu.cn/images/weeklyupdate.jpg" alt="Featured image of post DevOps Coach 周刊 4" />&lt;h2 id="宕机">宕机
&lt;/h2>&lt;ul>
&lt;li>上一周新发的宕机事故。&lt;/li>
&lt;li>近期全球重大宕机事故的分析总结、事后回顾。&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>May your queries flow and your pagers stay silent.
&amp;ndash;Dave, Betsy, Niall, Stephen, and Kent&lt;/p>&lt;/blockquote>
&lt;h2 id="新闻">新闻
&lt;/h2>&lt;h3 id="项目发布速递">项目发布速递
&lt;/h3>&lt;ul>
&lt;li>Azure Functions 的 PowerShell 7 支持现在是 GA，如果在 PowerShell 中编写无服务器函数对你有吸引力。&lt;/li>
&lt;li>Go 1.15 - 流行的编程语言。&lt;/li>
&lt;li>AWS Glue 2.0 - AWS 上的 ETL 作业服务。&lt;/li>
&lt;li>Node 14.8.0 - 服务器端 JavaScript 运行时。&lt;/li>
&lt;/ul>
&lt;h3 id="devops-大会峰会">DevOps 大会/峰会
&lt;/h3>&lt;p>中国 DevOps 社区流水线大赛 &amp;ndash; Pipeline Craft Championship&lt;/p>
&lt;ul>
&lt;li>8 月 18 日开始为期两个月，免费活动&lt;/li>
&lt;li>报名：&lt;a class="link" href="https://wj.qq.com/s2/6852880/c181" target="_blank" rel="noopener"
>https://wj.qq.com/s2/6852880/c181&lt;/a>&lt;/li>
&lt;li>活动官网：&lt;a class="link" href="https://Pipeline.devopsmeetup.com" target="_blank" rel="noopener"
>https://Pipeline.devopsmeetup.com&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>提交大议信息发邮件到：&lt;a class="link" href="mailto:martin@devopscoach.org" >martin@devopscoach.org&lt;/a>&lt;/p>
&lt;h2 id="文章">文章
&lt;/h2>&lt;p>编写 Kubernetes Operators 的 7 个最佳实践。SRE 的观点&lt;/p>
&lt;ul>
&lt;li>Manuel Dewald，红帽公司&lt;/li>
&lt;li>&lt;a class="link" href="https://www.openshift.com/blog/7-best-practices-for-writing-kubernetes-operators-an-sre-perspective" target="_blank" rel="noopener"
>https://www.openshift.com/blog/7-best-practices-for-writing-kubernetes-operators-an-sre-perspective&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>DevNation 技术讲座：每个用户都应该知道的 10 个很棒的 Kubernetes 工具&lt;/p>
&lt;ul>
&lt;li>Alex Soto 和 Burr Sutter，红帽公司。&lt;/li>
&lt;li>&lt;a class="link" href="https://www.twitch.tv/videos/709079582?t=00h01m01s" target="_blank" rel="noopener"
>https://www.twitch.tv/videos/709079582?t=00h01m01s&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>变化的世界, 变化的 Mozilla (但裁员 250 名员工) 非常悲伤的消息从 Mozilla, 火狐的创造者, 本周，他们已- 经裁掉了一个明显的数量的员工，他们的商业需求驱动.&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://blog.mozilla.org/blog/2020/08/11/changing-world-changing-mozilla/" target="_blank" rel="noopener"
>https://blog.mozilla.org/blog/2020/08/11/changing-world-changing-mozilla/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>用 Prometheus 和 Grafana 进行系统监控。&lt;/p>
&lt;ul>
&lt;li>监控超级饲料。分布式系统的历史和挑战。&lt;/li>
&lt;li>&lt;a class="link" href="https://flightaware.engineering/systems-monitoring-with-prometheus-grafana/" target="_blank" rel="noopener"
>https://flightaware.engineering/systems-monitoring-with-prometheus-grafana/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>在 Git 中想做的事情以及如何做这些事情？&lt;/p>
&lt;ul>
&lt;li>一些一般的 GIT 技巧&lt;/li>
&lt;li>&lt;a class="link" href="https://stu2b50.dev/posts/things-you-wante9665" target="_blank" rel="noopener"
>https://stu2b50.dev/posts/things-you-wante9665&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>公布 Kubernetes 的 Pulumi 开源新项目&lt;/p>
&lt;ul>
&lt;li>宣布新功能，推进 Pulumi 的 Kubernetes 支持部署自动化、云原生生态系统集成和 Pulumi 的简单采用。&lt;/li>
&lt;li>&lt;a class="link" href="https://www.pulumi.com/blog/new-kubernetes-superpowers/" target="_blank" rel="noopener"
>https://www.pulumi.com/blog/new-kubernetes-superpowers/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Mirantis 收购了 Kubernetes 的 IDE&amp;ndash;Lens - TechCrunch&lt;/p>
&lt;ul>
&lt;li>最近收购了 Docker 企业业务的公司 Mirantis 今天宣布收购了 Lens。&lt;/li>
&lt;li>&lt;a class="link" href="https://techcrunch.com/2020/08/13/mirantis-acquires-lens-an-ide-for-kubernetes/" target="_blank" rel="noopener"
>https://techcrunch.com/2020/08/13/mirantis-acquires-lens-an-ide-for-kubernetes/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>MySQL 性能调优&lt;/p>
&lt;ul>
&lt;li>技巧、脚本和工具&lt;/li>
&lt;li>&lt;a class="link" href="https://haydenjames.io/mysql-performance-tuning-tips-scripts-tools/" target="_blank" rel="noopener"
>https://haydenjames.io/mysql-performance-tuning-tips-scripts-tools/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&amp;ldquo;第一天 &amp;ldquo;云原生组织&lt;/p>
&lt;ul>
&lt;li>在这里，我提出了一个云原生架构，以促进任何组织内的创新和实验的动态文化。&lt;/li>
&lt;li>&lt;a class="link" href="https://medium.com/lambda-lego/day-one-cloud-native-organisations-250b4e181a8d" target="_blank" rel="noopener"
>https://medium.com/lambda-lego/day-one-cloud-native-organisations-250b4e181a8d&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>从单体架构到微服务。架构和数据管理&lt;/p>
&lt;ul>
&lt;li>在本文中，我们分析了从单体架构到微服务架构的转变，深入探讨了微服务通信类型，并以一个零售应用为例，研究了服务之间通信的最佳实践。&lt;/li>
&lt;li>&lt;a class="link" href="https://epsagon.com/development/monolithic-to-microservices-architecture-data-management/" target="_blank" rel="noopener"
>https://epsagon.com/development/monolithic-to-microservices-architecture-data-management/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="工具">工具
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/mingrammer/diagrams" target="_blank" rel="noopener"
>https://github.com/mingrammer/diagrams&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>云系统架构原型设计的 &amp;ldquo;图表即代码&amp;rdquo;（Diagram as Code）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/linkedin/shiv" target="_blank" rel="noopener"
>https://github.com/linkedin/shiv&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>shiv 是一个命令行实用程序，用于构建完全自包含的 Python zipapps，就像 PEP 441 中概述的那样，但包含了所有的依赖关系。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/hazelcast/hazelcast-jet" target="_blank" rel="noopener"
>https://github.com/hazelcast/hazelcast-jet&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>开源的分布式流和批处理技术&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/abe-winter/automigrate" target="_blank" rel="noopener"
>https://github.com/abe-winter/automigrate&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>使用 git 版本的 SQL 模式+自动迁移它们。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/soraxas/shsh" target="_blank" rel="noopener"
>https://github.com/soraxas/shsh&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>一个多线程管理器，用于管理 shell 脚本、函数、独立的二进制文件、tab-completions 等。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/dutchcoders/cloudman" target="_blank" rel="noopener"
>https://github.com/dutchcoders/cloudman&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>管理 ec2 实例的文本用户界面。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/diego3g/rocketredis" target="_blank" rel="noopener"
>https://github.com/diego3g/rocketredis&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>一个漂亮的 Redis GUI&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>DevOps Coach 周刊 3</title><link>https://martinliu.cn/blog/devopscoach-weekly-3/</link><pubDate>Tue, 11 Aug 2020 15:03:54 +0800</pubDate><guid>https://martinliu.cn/blog/devopscoach-weekly-3/</guid><description>&lt;img src="https://martinliu.cn/images/weeklyupdate.jpg" alt="Featured image of post DevOps Coach 周刊 3" />&lt;h2 id="宕机">宕机
&lt;/h2>&lt;ul>
&lt;li>上一周新发的宕机事故。&lt;/li>
&lt;li>近期全球重大宕机事故的分析总结、事后回顾。&lt;/li>
&lt;/ul>
&lt;h3 id="上周新发宕机事故">上周新发宕机事故
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>Discord&lt;/strong> 这个值得注意的是，它涉及到谷歌云平台中所谓的 &amp;ldquo;吵闹邻居 &amp;ldquo;情况。&lt;a class="link" href="https://discord.statuspage.io/incidents/bnv0wbddzz2x" target="_blank" rel="noopener"
>https://discord.statuspage.io/incidents/bnv0wbddzz2x&lt;/a>&lt;/li>
&lt;li>&lt;strong>Slack&lt;/strong> 更新缓存基础架构的坑。从2020年7月23日晚上9:00 PDT到2020年8月1日下午5:17 PDT，客户在使用各种API端点时可能会出现滞后或故障。我们于7月29日开始调查这一问题，并将这些问题追溯到最近对我们的缓存基础设施进行的一项变更，旨在增加该基础设施的容量。一个不可预见的副作用导致一小部分API请求需要更长的时间来处理并最终超时。我们在8月1日恢复了这一更改，所有受影响的客户的问题都得到了解决。8月6日, 6:49 AM GMT+8 &lt;a class="link" href="https://status.slack.com//2020-07/7d32ad54b0703c47" target="_blank" rel="noopener"
>https://status.slack.com//2020-07/7d32ad54b0703c47&lt;/a>&lt;/li>
&lt;li>&lt;strong>佳能&lt;/strong> 遭遇勒索软件攻击，Maze宣称对此事负责 来源： &lt;a class="link" href="https://www.zdnet.com/article/canon-suffers-ransomware-attack-maze-claims-responsibility/" target="_blank" rel="noopener"
>https://www.zdnet.com/article/canon-suffers-ransomware-attack-maze-claims-responsibility/&lt;/a>&lt;/li>
&lt;li>&lt;strong>Steam&lt;/strong> 服务器目前已经瘫痪 &lt;a class="link" href="https://gamerant.com/steam-servers-down-8-05/" target="_blank" rel="noopener"
>https://gamerant.com/steam-servers-down-8-05/&lt;/a>&lt;/li>
&lt;li>&lt;strong>Fastly&lt;/strong> 著名 CDN 服务器最近又出性能事故了， 影响范围，Edge Cloud Services (Fastly API, 快速配置应用, TLS 制备) &lt;a class="link" href="https://status.fastly.com/incidents/d6ljy97shb0p" target="_blank" rel="noopener"
>https://status.fastly.com/incidents/d6ljy97shb0p&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="关于-quayio-宕机事故回顾">关于 Quay.io 宕机事故回顾
&lt;/h3>&lt;ul>
&lt;li>来源官网： &lt;a class="link" href="https://www.openshift.com/blog/about-the-quay.io-outage-post-mortem" target="_blank" rel="noopener"
>https://www.openshift.com/blog/about-the-quay.io-outage-post-mortem&lt;/a>&lt;/li>
&lt;li>时间线：5 月 19 日第一次宕机，28 日第二次宕机，这些事故影响了大多数 quay.io 服务的用户。&lt;/li>
&lt;li>Red Hat SRE 团队对本次事件的经验总结：
&lt;ul>
&lt;li>&lt;strong>关于谁和什么人在使用你的服务，你永远都不可能有足够的参考数据。&lt;/strong> 由于Quay &amp;ldquo;一直是正常工作&amp;rdquo;，我们从来不需要花太多时间分析我们的流量模式，处理负载的行为。这创造了一种虚假的安全感，即服务将无限期地扩展。&lt;/li>
&lt;li>&lt;strong>当服务出现故障时，恢复是你的首要任务。&lt;/strong> 由于Quay在第一次中断期间不断出现数据库死锁的情况，我们的标准流程并没有明确的实现服务恢复的预期目标。这就导致我们花了更多的时间进行分析和收集数据，希望找到根本原因，而不是把所有的精力都放在让客户恢复运行上。&lt;/li>
&lt;li>&lt;strong>要了解你的每一个服务功能的影响。&lt;/strong> App Registry很少被我们的客户使用，所以它不是我们团队的主要优先事项。当你的产品中有很少使用的功能时，bug就不会被提交，开发人员也不会再看代码。我们很容易认为这不会给团队带来任何负担&amp;ndash;直到它突然成为重大事件的一部分。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="关于-heroku-事故-2090-的后续分析">关于 Heroku 事故 #2090 的后续分析
&lt;/h2>&lt;ul>
&lt;li>概述：此次事件涉及Heroku的基础设施提供商（大概是AWS）的DNS故障。这次事故的坑是 DNS。&lt;/li>
&lt;li>来源官网：&lt;a class="link" href="https://status.heroku.com/incidents/2090" target="_blank" rel="noopener"
>https://status.heroku.com/incidents/2090&lt;/a>&lt;/li>
&lt;li>重要看点：为了给DNS查询提供内部IP地址，我们的服务提供商运行自己的内部DNS服务。这些DNS服务是确保在同一地区运行的基础设施之间建立最快连接的根本。当这些 DNS 服务不可用时，服务之间无法建立新的内部连接。与应用程序或数据服务的外部连接不会受到影响。在此次事件中，我们在一个地区的基础设施子集上经历了这些DNS服务的间歇性故障，包括我们运维的Heroku大部分内部服务的地方。&lt;/li>
&lt;li>经验总结：我们正在审查我们如何应对服务提供商的DNS故障或降级，以确保我们能够尽快发现并解决任何未来的问题。&lt;/li>
&lt;/ul>
&lt;h2 id="linkedin-最近的-hadoop-事故总结理论-vs-实战">LinkedIn 最近的 Hadoop 事故总结：理论 vs. 实战
&lt;/h2>&lt;ul>
&lt;li>概述：LinkedIn的这起事件影响了多个内部客户，他们对耐用性和延迟的要求各不相同，使得恢复变得复杂。&lt;/li>
&lt;li>来源官网：&lt;a class="link" href="https://engineering.linkedin.com/blog/2020/learnings-from-a-recent-hadoop-incident" target="_blank" rel="noopener"
>https://engineering.linkedin.com/blog/2020/learnings-from-a-recent-hadoop-incident&lt;/a>&lt;/li>
&lt;li>学习制度化：一场大型事件结束后，总会有一些心得体会。以下是我们正在跟进的几条。
&lt;ul>
&lt;li>为Hadoop基础设施建立一个强大和更全面的主机生命周期管理。&lt;/li>
&lt;li>建立更好地理解我们在负载下各数据中心的网络行为，并确保按需修改网络路由的自动化方式。&lt;/li>
&lt;li>目前，我们正在Azure上构建下一代基础设施，包括Hadoop协议栈。就中期而言，我们将有一个额外的集群，该集群建立在一个完全不同的技术栈上，这应该会进一步帮助我们实现冗余。&lt;/li>
&lt;li>调查其他架构的可行性，作为我们Azure迁移的一部分。例如，我们可以将数据摄取一次，然后将相同的数据复制到 D/R Cluster中，并通过数据布局和查询规划优化来吃掉延迟成本。我们正在采用Apache Iceberg作为我们的表格式。有了Iceberg，我们应该可以更好地对受影响的文件进行针对性的恢复。在我们当前架构的临时，我们已经建立了几个工具，让我们能够辅助恢复（例如，恢复除损坏数据以外的所有数据，更容易从另一个集群恢复大文件等），并围绕它建立了运行本，以便于访问。&lt;/li>
&lt;li>努力审计我们的流程，以确保它们有定义良好的灾难恢复协议。&lt;/li>
&lt;li>增加我们的灾难演练的频率，此外，还要审查灾难演练中流程的表现与他们所述的恢复策略的评分卡。&lt;/li>
&lt;li>继续研究我们的工具，围绕着理解世系，因为事实证明它在识别流和数据的依赖性方面非常有用。这也将提供理解生态系统端到端的连接图的能力&amp;ndash;这在灾难恢复等大型协调事件中是非常宝贵的。&lt;/li>
&lt;li>一些流量所有者在他们的应用工作流本身中增强了弹性。例如，对延迟敏感的应用，产生关键业务小时和每日指标的应用，正在应用逻辑本身中进行明确的数据呆滞性与弹性的权衡。&lt;/li>
&lt;li>专注于提高我们预测数据恢复的数据可用性SLA的能力，以便在这种性质的事件再次发生时有能力快速发布。我们的内部数据消费者可以使用这些SLA，并在恢复协议的决策选择方面做出明智的决定。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="github可用性报告--2020年7月">GitHub可用性报告 &amp;ndash; 2020年7月
&lt;/h3>&lt;ul>
&lt;li>概述：相信很多人都经历了 GitHub 7 月13 日的事故。该事故持续了4 小时 25 分钟。以下报告包括对涉及Kubernetes pods和DNS服务受损的事件的描述。&lt;/li>
&lt;li>来源官网：&lt;a class="link" href="https://github.blog/2020-08-05-github-availability-report-july-2020/" target="_blank" rel="noopener"
>https://github.blog/2020-08-05-github-availability-report-july-2020/&lt;/a>&lt;/li>
&lt;li>要点回顾：
&lt;ul>
&lt;li>事件的起因是我们的生产型 Kubernetes Pods 开始被标记为不可用。这在我们的集群中层出不穷，导致容量减少，最终导致我们的服务瘫痪。对Pods的调查显示，Pod中的一个容器超过了其定义的内存限制并被终止。尽管该容器不需要处理生产流量，但Kubernetes的性质要求所有容器都是健康的，Pod才能被标记为可用。&lt;/li>
&lt;li>一般情况下，当一个Pod运行到这种故障模式时，集群会在一分钟左右恢复。在这种情况下，Pod中的容器被配置为ImagePullPolicy为Always，它指示Kubernetes每次都要获取新的容器镜像。然而，由于之前完成了一次例行的DNS维护操作，我们的集群无法成功到达我们的注册表，导致Pods无法启动。当为了缓解而触发了重新部署时，这个问题的影响就增加了，我们看到这个故障开始在我们的生产集群中传播。直到我们使用缓存的DNS记录重新启动进程，我们才得以成功获取容器镜像，重新部署，并恢复我们的服务。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>后续事项：展望未来，我们已经确定了本季度要解决的一些领域。
&lt;ul>
&lt;li>加强监控，确保Pod重启不会再基于这种相同的模式而失败&lt;/li>
&lt;li>尽量减少我们对镜像仓库的依赖。&lt;/li>
&lt;li>在DNS变更期间扩大验证范围&lt;/li>
&lt;li>重新评估所有现有的Kubernetes部署策略&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="新闻">新闻
&lt;/h2>&lt;h3 id="项目发布速递">项目发布速递
&lt;/h3>&lt;ul>
&lt;li>Nano 5.0 — The popular simple Unix text editor.&lt;/li>
&lt;li>Julia 1.5 — High performance, dynamically typed language.&lt;/li>
&lt;li>Mastodon 3.2 — Federated social app.&lt;/li>
&lt;li>Django 3.1 — Python-based Web application framework.&lt;/li>
&lt;li>Alacritty 0.5 — Simplicity-focused terminal emulator.&lt;/li>
&lt;li>Terraform 0.13 General Availability&lt;/li>
&lt;/ul>
&lt;h3 id="devops-大会峰会">DevOps 大会/峰会
&lt;/h3>&lt;p>KubeCon + CloudNativeCon 欧洲 2020&lt;/p>
&lt;ul>
&lt;li>8 月 17 – 20， 免费&lt;/li>
&lt;li>报名： &lt;a class="link" href="https://events.linuxfoundation.org/kubecon-cloudnativecon-europe/" target="_blank" rel="noopener"
>https://events.linuxfoundation.org/kubecon-cloudnativecon-europe/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Commit 峰会&lt;/p>
&lt;ul>
&lt;li>8 月 26 ~ 27， GitLab 免费&lt;/li>
&lt;li>报名：&lt;a class="link" href="https://about.gitlab.com/events/commit/" target="_blank" rel="noopener"
>https://about.gitlab.com/events/commit/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>DevOps Fusion&lt;/p>
&lt;ul>
&lt;li>8 月 26 日， 免费&lt;/li>
&lt;li>报名：&lt;a class="link" href="https://swisstestingday.ch/en/" target="_blank" rel="noopener"
>https://swisstestingday.ch/en/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>DevOpsCon 伦敦 2020&lt;/p>
&lt;ul>
&lt;li>8 月 31 日 ~ 9 月 3 日，收费&lt;/li>
&lt;li>报名： &lt;a class="link" href="https://devopscon.io/" target="_blank" rel="noopener"
>https://devopscon.io/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>提交大议信息发邮件到：&lt;a class="link" href="mailto:martin@devopscoach.org" >martin@devopscoach.org&lt;/a>&lt;/p>
&lt;h2 id="文章">文章
&lt;/h2>&lt;p>麦肯锡：《十种 &amp;ldquo;反模式&amp;rdquo;，让技术转型脱轨。》&lt;/p>
&lt;ul>
&lt;li>大型组织转型项目的反模式清单。在选择技术、技术管理、路线图等方面都有很好的建议。&lt;/li>
&lt;li>&lt;a class="link" href="https://www.mckinsey.com/business-functions/mckinsey-digital/our-insights/ten-antipatterns-that-are-derailing-technology-transformations" target="_blank" rel="noopener"
>https://www.mckinsey.com/business-functions/mckinsey-digital/our-insights/ten-antipatterns-that-are-derailing-technology-transformations&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>AWS：《为运维可视化构建仪表板》&lt;/p>
&lt;ul>
&lt;li>一篇关于仪表盘设计的好文章，有很多道理、提示、技巧和例子。&lt;/li>
&lt;li>&lt;a class="link" href="https://aws.amazon.com/builders-library/building-dashboards-for-operational-visibility/" target="_blank" rel="noopener"
>https://aws.amazon.com/builders-library/building-dashboards-for-operational-visibility/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>LearnK8s：《验证Kubernetes YAML的最佳实践和策略》&lt;/p>
&lt;ul>
&lt;li>看看对验证和测试Kubernetes配置文件有用的几个工具。有用的对比表和每个不同工具的例子。&lt;/li>
&lt;li>&lt;a class="link" href="https://learnk8s.io/validating-kubernetes-yaml" target="_blank" rel="noopener"
>https://learnk8s.io/validating-kubernetes-yaml&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>推荐 Arrested DevOps 这个网站，它是帮助你实现理解、开发良好实践、运营你的团队和组织的播客，以获得最大的DevOps妙用。&lt;/p>
&lt;ul>
&lt;li>关于Service Mesh和SMI规范的所有事情的讨论。&lt;/li>
&lt;li>&lt;a class="link" href="https://www.arresteddevops.com/service-mesh/" target="_blank" rel="noopener"
>https://www.arresteddevops.com/service-mesh/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Dev.to：《使用Conftest、Regula和OPA保护你的Terraform管道安全》&lt;/p>
&lt;ul>
&lt;li>关于使用Conftest和Regula帮助编写安全的Terraform代码和测试作为CI流程的一部分的帖子。&lt;/li>
&lt;li>&lt;a class="link" href="https://dev.to/prince_of_pasta/securing-your-terraform-pipelines-with-conftest-regula-and-opa-4hkh" target="_blank" rel="noopener"
>https://dev.to/prince_of_pasta/securing-your-terraform-pipelines-with-conftest-regula-and-opa-4hkh&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>无罪网：《事件回顾从小白到大师》&lt;/p>
&lt;ul>
&lt;li>Under Armour（！）的首席SRE对他们如何进行SRE有很多有趣的事情可以分享。我喜欢他们对事件回顾的方法，即从1:1采访相关人员开始。保罗-奥斯曼&amp;ndash;Under Armour（无罪峰会）。&lt;/li>
&lt;li>&lt;a class="link" href="https://www.blameless.com/blog/improving-postmortems-paul-osman" target="_blank" rel="noopener"
>https://www.blameless.com/blog/improving-postmortems-paul-osman&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>medium.com 《主要的DevOps挑战以及如何应对这些挑战？》&lt;/p>
&lt;ul>
&lt;li>DevOps通过提供高效的解决方案，帮助加快交付速度，鼓励团队之间的协作，并促进敏捷环境，推动组织走向更美好的未来。&lt;/li>
&lt;li>&lt;a class="link" href="https://medium.com/faun/major-devops-challenges-and-how-to-address-them-3b4d7b6ee50b" target="_blank" rel="noopener"
>https://medium.com/faun/major-devops-challenges-and-how-to-address-them-3b4d7b6ee50b&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="工具">工具
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>Open Service Mesh是一个新的轻量级、可扩展的、用于动态微服务环境的服务网状结构。它提供了开箱即用的可观察性功能，并使用SMI进行配置。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://openservicemesh.io/" target="_blank" rel="noopener"
>https://openservicemesh.io/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/openservicemesh/osm" target="_blank" rel="noopener"
>https://github.com/openservicemesh/osm&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Sysbox是一个新的容器运行时，它可以让你更容易地在容器中运行低级软件，比如Systemd、Docker和Kubernetes。由于可插拔的运行时功能，你也可以用Docker运行它。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/nestybox/sysbox" target="_blank" rel="noopener"
>https://github.com/nestybox/sysbox&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>我们开始看到应用框架和开发者工具为在Kubernetes等平台上运行提供高级抽象。Tye是一个有趣的.NET工具，它可以简化在云原生平台上运行.NET应用程序。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/dotnet/tye" target="_blank" rel="noopener"
>https://github.com/dotnet/tye&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Turandot允许在Kubernetes中使用TOSCA。TOSCA提供了一种高级服务描述，旨在实现底层基础设施之间的可移植性和互操作性。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://turandot.puccini.cloud/" target="_blank" rel="noopener"
>https://turandot.puccini.cloud/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Copper是一个Kubernetes的配置文件验证器。它支持使用内置的Javascript DSL编写定制测试。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://github.com/cloud66-oss/copper" target="_blank" rel="noopener"
>https://github.com/cloud66-oss/copper&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>腾讯云下部署 Elastic Stack 各种 Beat 的最佳实践</title><link>https://martinliu.cn/blog/beats-implement-on-qcloud/</link><pubDate>Fri, 07 Aug 2020 17:14:20 +0800</pubDate><guid>https://martinliu.cn/blog/beats-implement-on-qcloud/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-6.jpg" alt="Featured image of post 腾讯云下部署 Elastic Stack 各种 Beat 的最佳实践" />&lt;h2 id="概述">概述
&lt;/h2>&lt;p>使用 Elastic Stack 的各种 Beats 模块可以彻底的终结在服务器上手工捞日志查指标的扭曲实践。利用腾讯云提供的 Elasticsearch 服务，可以轻松搞定大规模云环境的运维。本文一次性的帮你梳理清楚了，必备的基础操作，确保你能用 Elastic Stack 安全、稳定和扩展的持续监控你的生产环境。&lt;/p>
&lt;h2 id="创建-es-集群">创建 ES 集群
&lt;/h2>&lt;p>登录腾讯云服务控制台，查询并进入 Elasticsearc 服务，点击新建按钮，创建 Elasticsearch 集群。如下图所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/qcloud-es.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>集群配置说明：&lt;/p>
&lt;ul>
&lt;li>北京区&lt;/li>
&lt;li>7.5.1 - 白金版&lt;/li>
&lt;li>单可用区&lt;/li>
&lt;li>冷热模式&lt;/li>
&lt;/ul>
&lt;p>本实例其它参数保持默认，可以根据实际业务需求修改这些参数。&lt;/p>
&lt;p>点击下一步后，设置 Elasticsearch 集群的超级用户名和密码。&lt;/p>
&lt;p>在几分钟之后这个集群就成功创建了。查看下面这些基础的配置。&lt;/p>
&lt;ul>
&lt;li>启用 Kibana 内网地址： &lt;a class="link" href="http://es-ot7wei87.internal.kibana.tencentelasticsearch.com:5601" target="_blank" rel="noopener"
>http://es-ot7wei87.internal.kibana.tencentelasticsearch.com:5601&lt;/a> 用于 Bests 的 Setup 命令&lt;/li>
&lt;li>启用 Kibana 公网地址： &lt;a class="link" href="https://es-ot7wei87.kibana.tencentelasticsearch.com:5601" target="_blank" rel="noopener"
>https://es-ot7wei87.kibana.tencentelasticsearch.com:5601&lt;/a> 用户Elastic Stack 的初始化配置，如创建角色和调整索引生命周期策略等。&lt;/li>
&lt;/ul>
&lt;p>这样我们就有了一个安全、可扩展和性能足够的 ES 后台服务。&lt;/p>
&lt;h2 id="创建-beats-写入角色和用户">创建 Beats 写入角色和用户
&lt;/h2>&lt;p>登录 Kibana ，点击角色和用户管理，创建用于 Beast 配置文件的‘只写’权限用户。&lt;/p>
&lt;ul>
&lt;li>创建 beats-writer 角色&lt;/li>
&lt;li>创建 beats-writer 用户，该用户只赋予beats-writer角色，自定义一个安全的复杂密码。&lt;/li>
&lt;/ul>
&lt;p>Beats-write 角色设置如下图所示：&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/beats-writer.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>这个用户会用到后面的所有 Beats 配置文件中，用最小化权限用户极大的降低了数据泄露的风险。&lt;/p>
&lt;h2 id="beats-初始化配置">Beats 初始化配置
&lt;/h2>&lt;p>登录准备好的一个 Linux 服务器，在这台机器上做 Beats 相关的初始化工作；也就是要执行一些列的 setup 命令；这些命令的作用是：&lt;/p>
&lt;ul>
&lt;li>在 ES 后台加载索引模板，以及索引的 ILM 策略。&lt;/li>
&lt;li>加载 Kibana 相关的对象和可视化仪表板。&lt;/li>
&lt;/ul>
&lt;p>注意这是一次性的工作，在一个虚拟机上，只需要成功执行一次。&lt;/p>
&lt;p>SSH 登录到准备的 Linux 服务器上，首先需要安装相关 beats 的 rpm 安装包，安装命令在这里忽略，否则无法执行这些命令。 安装好 filebeat 和 metricbeat 的rpm 包后， 执行下面参考命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">filebeat setup -e &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.logstash.enabled&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.hosts&lt;span class="o">=[&lt;/span>&lt;span class="s1">&amp;#39;192.168.0.43:9200&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.username&lt;span class="o">=&lt;/span>elastic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.password&lt;span class="o">=&lt;/span>YourPassWord &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E setup.kibana.host&lt;span class="o">=&lt;/span>es-ot7wei87.internal.kibana.tencentelasticsearch.com:5601
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metricbeat setup -e &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.hosts&lt;span class="o">=[&lt;/span>&lt;span class="s1">&amp;#39;192.168.0.43:9200&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.username&lt;span class="o">=&lt;/span>elastic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.password&lt;span class="o">=&lt;/span>YourPassWord &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E setup.kibana.host&lt;span class="o">=&lt;/span>es-ot7wei87.internal.kibana.tencentelasticsearch.com:5601
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>运行以上命令的时候 Beats 处于默认安装的状态，这些命令行参数是必要的查收，有了这些参数 beats 会忽略默认的配置文件。&lt;/p>
&lt;p>以上命令根据需求，如果需要使用到其它的 Beats，请使用相关的 setup 命令。其中的 es 和 kibana 相关信息需求参考上一步创建的 es 集群信息。&lt;/p>
&lt;p>以上所有命令成功之后，登录 Kibana 界面，点击 Dashboard 菜单，这里应该已经加载了很多仪表板。目前为止 Elastic Stack 后台就初始化成功了。&lt;/p>
&lt;h2 id="在节点上正式部署-beats">在节点上正式部署 Beats
&lt;/h2>&lt;p>参考和修改安装脚本，一键式安装和配置 Beats&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git clone https://github.com/martinliu/elastic-stack-lab.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd tencent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sh add-agent.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>成功执行完以上脚本后，相关的 beats 服务应是正常运行的状态。执行完这个命令之后，在 Linux 服务器上使用检查服务是否正常运行 &lt;code>sudo systemctl status filebeat&lt;/code> ；使用这个命令应该可以看到filebeat 服务都是正常运行的。&lt;/p>
&lt;p>这个脚本所使用的配置文件中的要点：&lt;/p>
&lt;ul>
&lt;li>删除了所有和数据摄入无关的配置（例如 es 和 kibana 的配置和初始化等）&lt;/li>
&lt;li>加入了最小化的必要的最佳实践参数集合&lt;/li>
&lt;li>建议根据需求增加 beats 相关的模块&lt;/li>
&lt;li>根据需求加入必要的 Beat 配置参数&lt;/li>
&lt;/ul>
&lt;p>实例配置文件如。&lt;/p>
&lt;p>filebeat.yml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#=========================== Filebeat inputs =============================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">filebeat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">inputs&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">paths&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#============================= Filebeat modules ===============================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">filebeat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">period&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">60&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-------------------------- Elasticsearch output ------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hosts&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;${INT_ES_SRV}&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">BEATS_WRITER_PW&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">BEATS_WRITER_USERNAME&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#================================ Processors =====================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">processors&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_host_metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">netinfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cache&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_cloud_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_docker_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_kubernetes_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_fields&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">target&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fields&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;Joint Lab&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;es-qq&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#==================== Best Practice Configuration ==========================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">setup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ilm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">check_exists&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">level&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">error&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">queue&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">spool&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">monitoring&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>metricbeat.yml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># =========================== Modules configuration ============================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">metricbeat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">period&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-------------------------- Elasticsearch output ------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hosts&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;${INT_ES_SRV}&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">BEATS_WRITER_PW&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">BEATS_WRITER_USERNAME&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#================================ Processors =====================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">processors&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_host_metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">netinfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cache&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_cloud_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_docker_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_kubernetes_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_fields&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">target&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fields&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;Joint Lab&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;es-qq&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#==================== Best Practice Configuration ==========================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">setup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ilm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">check_exists&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">level&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">error&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">queue&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">spool&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">monitoring&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上配置文件使用了这些通用最佳实践配置参数。&lt;/p>
&lt;ul>
&lt;li>使用 ECS 扩展字段，丰富上下文含义&lt;/li>
&lt;li>启用 beats 端点监控&lt;/li>
&lt;li>用 keystore 隐藏所有敏感信息&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#禁用索引 ilm 策略检查，避免无用动作
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setup.ilm.check_exists: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#把Beats自身的日志记录调到最低级别降低
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">logging.level: error
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#开启本地默认的端点缓存行为
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">queue.spool: ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#启用端点的监控
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">monitoring:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enabled: true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="排错方法">排错方法
&lt;/h2>&lt;h3 id="filebeat-setup-不成功">filebeat setup 不成功
&lt;/h3>&lt;p>在任何 beats 首次做 setup 命令的时候，它可能是会在分钟级别成功结束。如果发生失败或者卡顿的情况，可以等一下，等更长时间看看。不成功的话，需要反复执行，排查 es 和 kibana 服务是否能正常工作。知道陈功了，才能进行下一步的安装工作。&lt;/p>
&lt;h3 id="配置文件错误导致的服务不能启动">配置文件错误导致的服务不能启动
&lt;/h3>&lt;p>由于上面的定制化配置文件也可能出现错误，特别是在首次部署这个配置文件的时候，可以先把日志级别 error 哪一行注释掉，把启动服务那两行也注释掉。&lt;/p>
&lt;p>然后在命令行执行 &lt;code>filebeat -e&lt;/code> 查看整个 feilebeat 的启动过程，这个命令会读取定制化的配置文件，然后开始连接后台 es 服务，然后进入正常数据传送的状态。这个过程中如果有任何配置错误，也可以直观的看到相关信息，直到调整到正常的状态。&lt;/p>
&lt;p>以上过程的调整好了以后，一定要通过 git 版本管理起来，然后可以放心的在其它节点上执行 beast 的一键式部署工作。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>以上是在 Beats 部署相关基础最佳实践，也就是说在生产环境中 ES 后台和 beats 的搭配，以及本文所涉及的内容都是基线配置。建议根据自己的需求做更多的调优，这里使用 shell 脚本的方式部署 beats 和相关的配置，shell 脚本适合用于演示原理，建议替换成你所熟悉的自动化运维工具，例如 ansible 等工具。从而保证更大规模的自动化部署和维护。&lt;/p>
&lt;p>本相关的配置文件和脚本位于：&lt;a class="link" href="https://github.com/martinliu/elastic-stack-lab.git" target="_blank" rel="noopener"
>https://github.com/martinliu/elastic-stack-lab.git&lt;/a>&lt;/p></description></item><item><title>DevOps Coach 周刊 2</title><link>https://martinliu.cn/blog/devopscoach-weekly-2/</link><pubDate>Mon, 03 Aug 2020 22:26:23 +0800</pubDate><guid>https://martinliu.cn/blog/devopscoach-weekly-2/</guid><description>&lt;img src="https://martinliu.cn/images/weeklyupdate.jpg" alt="Featured image of post DevOps Coach 周刊 2" />&lt;h2 id="宕机">宕机
&lt;/h2>&lt;p>上周全球重大宕机事故清单。&lt;/p>
&lt;h3 id="facebook">Facebook
&lt;/h3>&lt;ul>
&lt;li>具英媒体报道：7月 28 日 12：20pm， Facebook, Instagram 和 WhatsApp 这三款用户的一半以上的用户，无法加载出页面，无法正常使用服务。 Facebook 官方还没有关于这次事故的回应。实际上整个欧洲大陆，特别是葡萄牙和西班牙的故障更要严重一些。原因不明。&lt;/li>
&lt;li>影响范围：London, Birmingham 和 Manchester.&lt;/li>
&lt;li>来源： &lt;a class="link" href="https://metro.co.uk/2020/07/28/facebook-instagram-whatsapp-13048914/" target="_blank" rel="noopener"
>https://metro.co.uk/2020/07/28/facebook-instagram-whatsapp-13048914/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="fastly---知名-cdn-服务商">fastly - 知名 CDN 服务商
&lt;/h3>&lt;ul>
&lt;li>官方声明：Fastly的网络具有内置冗余和自动故障转移路由，以确保最佳性能和正常运行时间。但当网络问题出现时，我们认为我们的客户应该得到清晰、透明的沟通，这样他们才能保持对我们的服务和团队的信任。当我们重新分配流量、升级硬件或在极少数情况下我们的网络不提供流量时，我们会在这里发布通知。如果您遇到问题而没有看到张贴的通知，请发送电子邮件至 &lt;a class="link" href="mailto:support@fastly.com" >support@fastly.com&lt;/a> 寻求帮助。&lt;/li>
&lt;li>影响范围：North America (Ashburn (BWI), Ashburn (DCA), Ashburn (IAD), Ashburn (WDC), Atlanta (FTY), Atlanta (PDK), Dallas (DAL), Dallas (DFW), Jacksonville (JAX)).&lt;/li>
&lt;li>来源：&lt;a class="link" href="https://status.fastly.com/history" target="_blank" rel="noopener"
>https://status.fastly.com/history&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="heroku">Heroku
&lt;/h3>&lt;ul>
&lt;li>官方声明：JUL 28, 2020 09:15 UTC Heroku 平台的很大的部分都遭受到可用性故障。然后开始和他们的服务提供商一起解决问题。一个多小时后平台恢复了正常。&lt;/li>
&lt;li>来源：&lt;a class="link" href="https://status.heroku.com/incidents/2090" target="_blank" rel="noopener"
>https://status.heroku.com/incidents/2090&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="新闻">新闻
&lt;/h2>&lt;p>DevOps实践的采用与组织拥抱数字化转型齐头并进。这两个短语都有被过度使用的风险，但这些帖子讨论了一些有用的心理模型，以帮助聚焦对话。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://aws.amazon.com/blogs/enterprise-strategy/mental-models-for-digital-transformation/" target="_blank" rel="noopener"
>https://aws.amazon.com/blogs/enterprise-strategy/mental-models-for-digital-transformation/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://aws.amazon.com/blogs/enterprise-strategy/mental-models-to-clarify-the-goals-for-of-digital-transformation-part-2/" target="_blank" rel="noopener"
>https://aws.amazon.com/blogs/enterprise-strategy/mental-models-to-clarify-the-goals-for-of-digital-transformation-part-2/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>开发者平台的哪些属性会导致采用？下面的文章是专门关于大规模边缘平台的，但对于任何为开发者构建各种平台的人来说，包括在内部平台团队中这样做的人来说，都是很好的阅读。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://blog.cloudflare.com/cloudflare-workers-serverless-week/" target="_blank" rel="noopener"
>https://blog.cloudflare.com/cloudflare-workers-serverless-week/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>当第一次接受DevOps实践和云服务时，在大型组织中通常会建立一个卓越中心。在采取这种方法时，需要避免一些陷阱，下面的文章将讨论这些陷阱。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.contino.io/insights/cloud-centre-of-excellence-2020" target="_blank" rel="noopener"
>https://www.contino.io/insights/cloud-centre-of-excellence-2020&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>最近的DevSecCon在线会议的视频都可以看到，其中涵盖了一系列有趣的主题，包括基础设施作为代码安全、持续审计合规、供应链攻击等。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.mydevsecops.io/post/devseccon24" target="_blank" rel="noopener"
>https://www.mydevsecops.io/post/devseccon24&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>关于无服务器架构和单体应用之间的权衡，主要集中在较小规模的应用上，是一个不错的讨论。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://dev.to/iamcherta/my-monolith-doesn-t-fit-in-your-serverless-311o" target="_blank" rel="noopener"
>https://dev.to/iamcherta/my-monolith-doesn-t-fit-in-your-serverless-311o&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>一篇关于linux内核新特性的深度技术文章，这些特性应该会让非特权容器更受欢迎。对seccomp的细节也做了很好的介绍。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://people.kernel.org/brauner/the-seccomp-notifier-new-frontiers-in-unprivileged-container-development" target="_blank" rel="noopener"
>https://people.kernel.org/brauner/the-seccomp-notifier-new-frontiers-in-unprivileged-container-development&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>基于角色的访问控制在保护Kubernetes的安全方面发挥着重要作用。这个方便的网站将文章、工具和官方文档收集在一起。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://rbac.dev/" target="_blank" rel="noopener"
>https://rbac.dev/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>对于任何使用Serverless技术的人来说，这是一项有趣的调查，来自该领域的众多公司。我期待着结果公布时的到来。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://codingsans.typeform.com/to/mPinnC" target="_blank" rel="noopener"
>https://codingsans.typeform.com/to/mPinnC&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="文章">文章
&lt;/h2>&lt;p>LaunchDarkly从基于 Polling 的架构开始，最终迁移到向客户推送变化量（Streaming）。Dawn Parzych&amp;ndash;LaunchDarkly。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://launchdarkly.com/blog/launchdarklys-evolution-from-polling-to-streaming/" target="_blank" rel="noopener"
>https://launchdarkly.com/blog/launchdarklys-evolution-from-polling-to-streaming/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>一个更简单的分布式跟踪的替代方案，用于故障排除。
简要概述了分布式追踪的一些问题，以及涉及人工智能的另一种方式的建议。 Larry Lancaster - Zebrium&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.zebrium.com/blog/virtual-tracing-a-simpler-alternative-to-distributed-tracing-for-troubleshooting" target="_blank" rel="noopener"
>https://www.zebrium.com/blog/virtual-tracing-a-simpler-alternative-to-distributed-tracing-for-troubleshooting&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>谷歌云 对 Classroom 的故障总结报告 2020-07-07
这是Google在7月7日对其Google Classroom 事件的事后报告。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://static.googleusercontent.com/media/www.google.com/en//appsstatus/ir/u5sinmib27yly4i.pdf" target="_blank" rel="noopener"
>https://static.googleusercontent.com/media/www.google.com/en//appsstatus/ir/u5sinmib27yly4i.pdf&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>面向领域的微服务架构介绍
长期以来，Uber一直是微服务的倡导者。现在，凭借几年的经验，他们分享了他们所学到的经验，以及如何处理一些陷阱。Adam Gluck - Uber&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://eng.uber.com/microservice-architecture/" target="_blank" rel="noopener"
>https://eng.uber.com/microservice-architecture/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>通过远程事件响应使PagerDuty始终保持开启状态。
本文开篇就从PagerDuty的角度对Cloudflare中断的情况进行了有趣的描述。Dave Bresci - PagerDuty&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.pagerduty.com/blog/remote-incident-response/" target="_blank" rel="noopener"
>https://www.pagerduty.com/blog/remote-incident-response/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>安全是设计出来的？
这篇文章反映了两种不同的安全理念。&lt;/p>
&lt;ul>
&lt;li>工程设计应确保系统的安全。&lt;/li>
&lt;li>单纯的设计不能保证系统的安全
Lorin Hochstein&lt;/li>
&lt;li>&lt;a class="link" href="https://surfingcomplexity.blog/2020/07/28/safe-by-design/" target="_blank" rel="noopener"
>https://surfingcomplexity.blog/2020/07/28/safe-by-design/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>我们能做的就是发现问题
你不能用可用性指标来告知你的系统是否足够可靠，因为它们只能在你出现问题时告诉你。
Lorin Hochstein&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://surfingcomplexity.blog/2020/07/28/all-we-can-do-is-find-problems/" target="_blank" rel="noopener"
>https://surfingcomplexity.blog/2020/07/28/all-we-can-do-is-find-problems/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="工具推荐">工具推荐
&lt;/h2>&lt;p>管理 K8s 命令行工具的工具，所有命令行工具一站式搞定，一键式安装很多 k8s 集群基础。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/alexellis/arkade/" target="_blank" rel="noopener"
>https://github.com/alexellis/arkade/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>一个在文件系统之上的文件系统。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/carlosgaldino/gotenksfs" target="_blank" rel="noopener"
>https://github.com/carlosgaldino/gotenksfs&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>一个 Cloud-Native API Gateway&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/apache/apisix" target="_blank" rel="noopener"
>https://github.com/apache/apisix&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>一个简单而全面的容器漏洞扫描器，适用于CI。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/aquasecurity/trivy" target="_blank" rel="noopener"
>https://github.com/aquasecurity/trivy&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>APM 分布式追踪为何这么难？</title><link>https://martinliu.cn/blog/apm-why-it-so-hard/</link><pubDate>Sun, 02 Aug 2020 20:48:30 +0800</pubDate><guid>https://martinliu.cn/blog/apm-why-it-so-hard/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-3.jpg" alt="Featured image of post APM 分布式追踪为何这么难？" />&lt;p>用跟踪的方式调试计算机程序的调用堆栈的实践其实由来已久，这种方法可能仅次于用 print 输出各种信息。在云原生的时代里，我们还会遭遇工具过剩的情况，工具之间的相生相克加剧了实施分布式追踪的难度。&lt;/p>
&lt;p>总的来说有三个基础难点：&lt;/p>
&lt;ol>
&lt;li>生成追踪数据难。对已有应用系统的代码库进行埋点处理的挑战巨大，你的应用程序系统的模式可能也不符合埋点的模式需求。&lt;/li>
&lt;li>采集存储追踪数据难。捕获和管理大量追踪数据包，即照顾到查询和使用的需求，又要设定成本合理的数据存储策略，处理数据收集能力的扩缩容。&lt;/li>
&lt;li>从数据中获益难。如何理解和使用数据产生可执行行动，如何用它优化微服务的遥测，怎么将它的利益扩展到各个相关团队。&lt;/li>
&lt;/ol>
&lt;p>分布式追踪系统的实施结果是落地一条能深度洞察目标系统的工具。让人们能轻松的理解局部和整体的状态，特别是在请求堆栈中的任何局部服务出现故障时，可以最快速的定位故障根源。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/screenshot-apm-service-map.png"
loading="lazy"
>&lt;/p>
&lt;p>上图是用追踪数据生成的服务地图。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/blog-k8s-o11y-apm-trace-correlation.jpg"
loading="lazy"
>&lt;/p>
&lt;p>上图是一次用户请求的全部细节，还可以一键式的跳转到相应的日志或者指标。&lt;/p>
&lt;p>以上三个难点覆盖了部署实施分布式追踪系统的核心领域。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>埋点&lt;/strong> OpenTelemetry是目前受到广泛支持的埋点框架，对棕地应用和绿地应用进行埋点处理的挑战是不同的，需要遵循不同的额最佳实践。&lt;/li>
&lt;li>&lt;strong>部署&lt;/strong> 在理解了目标追踪应用系统的运行时状态后，最好使用一种弹性的方式收集和存储追踪数据。满足分析数据量需求的同时平衡存储成本。&lt;/li>
&lt;li>&lt;strong>收益&lt;/strong> 将其与日志和指标工具关联起来，定义和监控重要有意义的监控点，用于优化系统性能基线，并最小化 MTTR。&lt;/li>
&lt;/ul>
&lt;p>在云计算、Kubernetes、容器化大行其道的今天，分布式追踪的实施是不是正处在进退维谷的尴尬境地呢？其实并非如此，特别是监控运维挑战越高的应用，其实越需要需要使用分布式追踪 APM 工具。分布式追踪对云原生的容器化微服务应用尤为适用。APM 对单纯使用日志和指标的场景具有极大的补充和提高作用，而且它是可观测性策略的关键组成部分。&lt;/p>
&lt;p>总的来说分布式追踪工具可以通过追踪的方式展现请求在系统中的流动状态。流行的开源埋点框架使之与应用的编程语言、运行时环境无关，可以适配与所有类型的应用和服务。有些 APM 工具可以支持运行时埋点（或称为运行框架埋点），在不改变代码的情况下采集追踪数据。APM 的实施虽然有一定难度，但是当开始实施埋点处理，收集追踪数据以后，相关的价值和收益也就会慢慢显现出来了。&lt;/p>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://opentelemetry.io/" target="_blank" rel="noopener"
>https://opentelemetry.io/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.elastic.co/cn/apm" target="_blank" rel="noopener"
>https://www.elastic.co/cn/apm&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>应用开发 DBA 技巧集锦</title><link>https://martinliu.cn/blog/sql-tricks-application-dba/</link><pubDate>Fri, 31 Jul 2020 22:23:44 +0800</pubDate><guid>https://martinliu.cn/blog/sql-tricks-application-dba/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-1.jpg" alt="Featured image of post 应用开发 DBA 技巧集锦" />&lt;h2 id="前言">前言
&lt;/h2>&lt;p>DBA 可能是经常被其它团队依赖的一种角色、团队，因此他们也会有着很长的等待队列，也经常是事故救火中的英雄和常客。DevOps 强调用跨角色的学习和培训来解决这种依赖，也就是 DevOps 工作三步法的第三步，学习与持续改进。 本文写给所有的应用开发者，希望大家能多学习一些 DBA 知识，减少对专家 DBA 的依赖，加速你们的业务的交付，消除由于等待而造成的浪费。&lt;/p>
&lt;p>本文转载自：&lt;a class="link" href="https://hakibenita.com/sql-tricks-application-dba" target="_blank" rel="noopener"
>https://hakibenita.com/sql-tricks-application-dba&lt;/a>&lt;/p>
&lt;p>以下是正文原文：&lt;/p>
&lt;p>当我开始我的开发生涯时，我的第一份工作是DBA。那时，在AWS RDS、Azure、Google Cloud和其余云服务之前，有两种类型的DBA。&lt;/p>
&lt;p>&lt;strong>基础设施 DBA&lt;/strong> 负责建立数据库配置存储，并负责备份和复制。设置好数据库后，基础架构DBA会时不时地冒出来做一些 &amp;ldquo;实例调整&amp;rdquo;，比如调整缓存的大小。&lt;/p>
&lt;p>&lt;strong>应用 DBA&lt;/strong> 从基础架构DBA那里得到了一个干净的数据库，并负责模式设计：创建表、索引、约束和调优SQL。应用DBA也是实现ETL流程和数据迁移的人。在使用存储过程的团队中，应用DBA也会维护这些存储过程。&lt;/p>
&lt;p>应用DBA通常是开发团队的一部分。他们会拥有深厚的领域知识，所以通常他们只会在一两个项目上工作。基础架构DBA通常是某个IT团队的一部分，他们会同时在多个项目上工作。&lt;/p>
&lt;p>&lt;strong>我是一名应用DBA&lt;/strong> 我从来没有任何欲望去摆弄备份或调整存储（我相信这很迷人！）。直到今天，我都喜欢说自己是一个懂得开发应用的DBA，而不是一个懂得数据库的开发者。&lt;/p>
&lt;p>在本文中，我将分享我一路走来收集到的一些关于数据库开发的非浅显技巧。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/00-sql-tricks-dba.jpg"
loading="lazy"
>&lt;/p>
&lt;p>Be that guy&amp;hellip;&lt;!-- raw HTML omitted -->Image by &lt;!-- raw HTML omitted -->CommitStrip&lt;!-- raw HTML omitted -->&lt;/p>
&lt;h2 id="只更新需要更新的内容">只更新需要更新的内容
&lt;/h2>&lt;p>UPDATE是一个相对昂贵的操作。为了加快UPDATE命令的速度，最好确保只更新需要更新的内容。&lt;/p>
&lt;p>以这个查询为例，它对电子邮件列进行了标准化处理。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">lower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1010000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1583&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">935&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">01&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">584&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>看起来很无辜吧，查询更新了1010,000个用户的邮箱。但是，真的需要更新所有的行吗？&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">lower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">lower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">299&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">470&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>只需要更新10000行。通过减少受影响的行数，执行时间从1.5秒降到了不到300ms。更新的行数少了，也节省了后期的数据库维护工作。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1264.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>这种类型的大更新在数据迁移脚本中非常常见。所以下次写迁移脚本时，一定要只更新需要更新的内容。&lt;/p>
&lt;h2 id="在批量加载过程中禁用约束和索引">在批量加载过程中禁用约束和索引
&lt;/h2>&lt;p>约束是关系型数据库的重要组成部分：它们能保持数据的一致性和可靠性。不过它们的好处是有代价的，在加载或更新大量行时最明显。&lt;/p>
&lt;p>为了演示，为一个存储设置一个小模式。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IF&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXISTS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CASCADE&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">serial&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">TEXT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">INT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()::&lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">)::&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IF&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXISTS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CASCADE&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">serial&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">TEXT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()::&lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IF&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXISTS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">serial&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">created&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">timestamptz&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">customer_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>模式定义了不同类型的约束，如 &amp;ldquo;非空 &amp;ldquo;和唯一约束。&lt;/p>
&lt;p>要设置一个基线，首先要向销售表添加外键，然后将一些数据加载到表中:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ADD&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CONSTRAINT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_product_fk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FOREIGN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">REFERENCES&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">18&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">413&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ADD&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CONSTRAINT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_customer_fk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FOREIGN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">customer_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">REFERENCES&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">464&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_created_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">created&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">605&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SALE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">created&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">interval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;1 hour&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10000&lt;/span>&lt;span class="p">)::&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="p">)::&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">15410&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">234&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">410&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>定义约束和索引后，将100万行加载到表中，耗时约15.4s。&lt;/p>
&lt;p>接下来，尝试先将数据加载到表中，然后才添加约束和索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SALE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">created&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">interval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;1 hour&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10000&lt;/span>&lt;span class="p">)::&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="p">)::&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2277&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">824&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">02&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">278&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ADD&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CONSTRAINT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_product_fk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FOREIGN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">REFERENCES&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">169&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">193&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ADD&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CONSTRAINT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_customer_fk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FOREIGN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">customer_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">REFERENCES&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">185&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">633&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_created_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">created&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">484&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">244&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将数据加载到没有索引和约束的表中，速度快了很多，2.27s，而之前是15.4s。在数据加载到表中后创建索引和约束花了一点时间，但总体上整个过程快了很多，3.1s，而之前是15.4s。&lt;/p>
&lt;p>遗憾的是，对于索引，PostgreSQL并没有提供一个简单的方法，除了放弃和重新创建索引。在其他数据库中，如Oracle，你可以禁用和启用索引，而不必重新创建索引。&lt;/p>
&lt;h2 id="中间数据中使用-unlogged-的表">中间数据中使用 UNLOGGED 的表
&lt;/h2>&lt;p>当你修改PostgreSQL中的数据时，修改的内容会被写入提前写日志&lt;a class="link" href="https://www.postgresql.org/docs/current/wal-intro.html" target="_blank" rel="noopener"
>（WAL）&lt;/a>。WAL用于维护完整性，在恢复期间快速推进数据库，并维护复制。&lt;/p>
&lt;p>写入WAL是经常需要的，但在某些情况下，你可能愿意放弃它的一些用途来使事情变得更快。一个例子是中间表。&lt;/p>
&lt;p>中间表是一次性的表，它存储了用于实现某些过程的临时数据。例如，ETL过程中一个非常常见的模式是将数据从CSV文件加载到中间表，清理数据，然后加载到目标表。在这种用例中，中间表是一次性的，在备份或复制中没有用处。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1265.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>在灾难发生时不需要恢复的中间表，以及在副本中不需要的中间表，可以设置为 UNLOGGED。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UNLOGGED&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">staging_table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cm">/* table definition */&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>**注意：**在使用UNLOGGED之前，请务必了解其全部含义。&lt;/p>
&lt;h2 id="使用-with-和-returning-实施完成的流程">使用 WITH 和 RETURNING 实施完成的流程
&lt;/h2>&lt;p>假设你有一个用户表，你发现表中有一些重复的内容。&lt;/p>
&lt;p>表的设置：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">SERIAL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">TEXT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">UNIQUE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">SERIAL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">INT&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">CONSTRAINT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders_user_fk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FOREIGN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">REFERENCES&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">USERS&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">VALUES&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;foo@bar.baz&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;me@hakibenita.com&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ME@hakibenita.com&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">VALUES&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>表的内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">order_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">JOIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">order_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">----+-------------------+----------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foo&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bar&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">baz&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foo&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bar&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">baz&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">me&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ME&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ME&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>用户haki benita注册了两次，一次是用邮箱&lt;a class="link" href="mailto:ME@hakibenita.com" >ME@hakibenita.com&lt;/a>，另一次是用&lt;a class="link" href="mailto:me@hakibenita.com" >me@hakibenita.com&lt;/a>。由于我们在将邮件插入表中时没有将其规范化，现在我们必须处理重复的问题。&lt;/p>
&lt;p>为了合并重复的用户，我们要。&lt;/p>
&lt;ol>
&lt;li>通过小写的电子邮件来识别重复的用户。&lt;/li>
&lt;li>更新订单以引用其中一个重复的用户。&lt;/li>
&lt;li>从用户表中删除重复的用户&lt;/li>
&lt;/ol>
&lt;p>整合重复用户的一种方法是使用中间表。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UNLOGGED&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">lower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">normalized_email&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">array_remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ARRAY_AGG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">GROUP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">normalized_email&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">HAVING&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">normalized_email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-------------------+-----------------+--------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">me&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>中间表持有重复用户的映射。对于每一个使用相同的标准化电子邮件地址出现不止一次的用户，我们定义最小ID的用户作为我们将所有重复用户转换为的用户。其他用户被保存在一个数组列中，这些用户的所有引用都将被更新。&lt;/p>
&lt;p>利用中间表，我们更新订单表中重复用户的引用。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANY&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Now&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">that&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">there&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">are&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">no&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">more&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">references&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">we&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">can&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">safely&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">delete&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DELETE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">unnest&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">DELETE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>请注意，我们使用了函数 unnest 来 &amp;ldquo;转置 &amp;ldquo;数组，即把每个数组元素变成一行。&lt;/p>
&lt;p>这就是结果：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">order_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">JOIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">order_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">----+-------------------+----------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foo&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bar&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">baz&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foo&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bar&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">baz&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">me&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">me&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">me&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>很好，用户3(&lt;a class="link" href="mailto:ME@hakibenita.com" >ME@hakibenita.com&lt;/a>)的所有出现都转换为用户2(&lt;a class="link" href="mailto:me@hakibenita.com" >me@hakibenita.com&lt;/a>)。&lt;/p>
&lt;p>我们还可以验证重复的用户是否从用户表中被删除。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">----+-------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foo&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bar&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">baz&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">me&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>现在我们可以摆脱中间表了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个很好，但是非常长，需要清理! 有没有更好的方法？&lt;/p>
&lt;h3 id="使用通用表表达式cte">使用通用表表达式(CTE)
&lt;/h3>&lt;p>使用常见的表表达式，也就是所谓的WITH子句，我们只需要一条SQL语句就可以执行整个过程。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">WITH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">array_remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ARRAY_AGG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">GROUP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">lower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">HAVING&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">update_orders_of_duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANY&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">DELETE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">unnest&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我们不创建中间表，而是创建一个通用的表表达式，并多次重复使用。&lt;/p>
&lt;h3 id="从-cte-返回结果">从 CTE 返回结果
&lt;/h3>&lt;p>在WITH子句中执行DML的一个很好的特性是，你可以使用&lt;a class="link" href="https://www.postgresql.org/docs/current/dml-returning.html" target="_blank" rel="noopener"
>RETURNING关键字&lt;/a>来返回数据。例如，让我们报告更新和删除的行数：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">WITH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">array_remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ARRAY_AGG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">GROUP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">lower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">HAVING&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">update_orders_of_duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANY&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">RETURNING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">delete_duplicate_user&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">DELETE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">unnest&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">RETURNING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">update_orders_of_duplicate_users&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders_updated&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delete_duplicate_user&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_deleted&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个结果是:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">orders_updated&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_deleted&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">----------------+---------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这种方法的主要吸引力在于，整个过程是在一条命令中执行的，所以不需要管理一个事务，也不需要担心在过程失败时清理中间表。&lt;/p>
&lt;p>**注意：**Reddit上的&lt;a class="link" href="https://www.reddit.com/r/programming/comments/hyv0xh/some_sql_tricks_of_an_application_dba/fzhqzw5?utm_source=share&amp;amp;utm_medium=web2x" target="_blank" rel="noopener"
>一位读者&lt;/a>给我指出了在&lt;a class="link" href="https://www.postgresql.org/docs/current/queries-with.html#QUERIES-WITH-MODIFYING" target="_blank" rel="noopener"
>普通表表达式中执行DML的一个可能无法预测的行为&lt;/a>。&lt;/p>
&lt;blockquote>
&lt;p>WITH中的子语句相互之间以及与主查询同时执行。因此，当在WITH中使用数据修改语句时，指定的更新实际发生的顺序是不可预测的。&lt;/p>&lt;/blockquote>
&lt;p>这意味着你不能依赖独立子语句的执行顺序。看来，当子语句之间存在依赖关系时，比如在上面的例子中，你可以依靠依赖的子语句在被使用之前执行。&lt;/p>
&lt;h2 id="避免在选择性低的列上使用索引">避免在选择性低的列上使用索引
&lt;/h2>&lt;p>假设你有一个注册流程，用户用电子邮件地址注册。为了激活帐户，他们必须验证他们的电子邮件。你的表可以是这样的。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">serial&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">boolean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>你的大部分用户都是好公民，他们用有效的邮箱注册，并立即激活账号。让我们用用户数据来填充表格，其中大概有90%的用户被激活。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">md5&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()::&lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">GROUP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-----------+--------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">102567&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">897433&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">VACUUM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">VACUUM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>要查询已激活和未激活的用户，你可能会想在列激活上创建一个索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_activated_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当你试图查询未激活的用户时，数据库正在使用索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1923&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">11282&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">99&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">102567&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">38&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Filter&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_activated_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">1897&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">68&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">102567&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">false&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>数据库估计，过滤后会有102567个，这大概是表的10%。这与我们填充的数据是一致的，所以数据库对数据的感觉很好。&lt;/p>
&lt;p>但是，当你尝试查询激活用户时，你发现数据库决定不使用索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Seq&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">18334&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">897433&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">38&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Filter&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>很多开发人员在数据库没有使用索引的时候，往往会感到困惑。解释为什么索引并不总是最好的选择的一种方法是：&lt;strong>如果你必须读取整个表，你会使用索引吗？&lt;/strong>&lt;/p>
&lt;p>答案可能是否定的，因为你为什么要这样做？从磁盘上读取是很昂贵的，你希望尽可能少地读取。例如，如果一个表是10MB，索引是1MB，要读取整个表，你就必须从磁盘上读取10MB。如果要使用索引来读取表，你就必须从磁盘上读取11MB。这是很浪费的。&lt;/p>
&lt;p>有了这样的理解，我们来看看PostgreSQL对表的收集统计。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n_distinct&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">most_common_vals&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">most_common_freqs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pg_stats&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;users&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;activated&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">------------------+------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">n_distinct&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">most_common_vals&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">most_common_freqs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">89743334&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">10256667&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当PostgreSQL分析该表时，发现激活的列有两个不同的值。most_common_vals列中的值t对应的是most_common_freqs列中的频率0.89743334，值f对应的是频率0.10256667。也就是说，经过分析，数据库估计表中89.74%是激活用户，其余10.26%是未激活用户。&lt;/p>
&lt;p>通过这些统计，PostgreSQL决定，如果希望90%的行满足条件，最好扫描整个表。过了这个阈值，数据库可能会决定使用或不使用索引，这取决于很多因素，没有一个经验法则可以使用。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1266.jpeg"
loading="lazy"
>&lt;/p>
&lt;h2 id="使用部分索引">使用部分索引
&lt;/h2>&lt;p>在上一节中，我们在布尔值列上创建了一个索引，其中90%的值为真（激活用户）。当我们试图查询活跃用户时，数据库没有使用该索引。然而，当我们查询未激活的用户时，数据库却使用了该索引。&lt;/p>
&lt;p>这就引出了下一个问题&amp;hellip;&amp;hellip;如果数据库不打算使用索引来过滤活跃用户，那么我们为什么要首先使用索引呢？&lt;/p>
&lt;p>在回答这个问题之前，我们先来看看激活列上的完整索引有多大重量。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">\&lt;/span>&lt;span class="n">di&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_activated_ix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Schema&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Owner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Size&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------+--------------------+-------+-------+-------+------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_activated_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">haki&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MB&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>索引是21MB。仅供参考，用户表是65MB。这意味着索引的重量约为表的32%。我们也知道~90%的索引可能不会被使用。&lt;/p>
&lt;p>在PostgreSQL中，有一种方法可以只在表的一部分创建索引，&lt;a class="link" href="https://www.postgresql.org/docs/current/indexes-partial.html" target="_blank" rel="noopener"
>使用所谓的部分索引&lt;/a>。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_unactivated_partial_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">not&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用WHERE子句，我们限制了索引所索引的行。首先让我们确认一下它是否有效。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">not&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">using&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_unactivated_partial_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">29&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">3493&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">60&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">102567&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">38&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>令人惊奇的是，数据库很聪明，它明白我们在查询中使用的谓词可以通过部分索引来满足。&lt;/p>
&lt;p>使用部分索引还有一个好处。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">\&lt;/span>&lt;span class="n">di&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_unactivated_partial_ix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">of&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">relations&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Schema&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Owner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Size&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------+------------------------------+-------+-------+-------+---------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_unactivated_partial_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">haki&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2216&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kB&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>部分索引仅重2.2MB。列上的全索引重达21MB。部分索引的大小正好是全索引的10%，这与表中非活跃用户的比例相匹配。&lt;/p>
&lt;h2 id="始终加载排序过的数据">始终加载排序过的数据
&lt;/h2>&lt;p>这是我在代码评审中评论最多的事情之一。它不像其他提示那样直观，它对性能的影响很大。&lt;/p>
&lt;p>比如说你有一个大的销售事实表。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">serial&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">Every&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">night&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">during&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">some&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ETL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">process&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">load&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">data&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">md5&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()::&lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-01-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">interval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;1 day&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">round&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">365&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">VACUUM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">VACUUM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>为了伪造一个加载过程，我们使用了随机数据。我们插入了10万行随机的用户名，销售日期从2020-01-01到未来两年。&lt;/p>
&lt;p>该表主要用于制作汇总销售报表。大多数报表都是通过日期来过滤，得到特定时期的销售情况。为了加快范围扫描，你可以在sold_at上创建一个索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>让我们看看一个查询的执行计划，以获取2020年6月的所有销售。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BETWEEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">108&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">1107&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">69&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4293&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Recheck&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Blocks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">exact&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">927&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">107&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">22&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4293&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Planning&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">191&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Execution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">906&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在执行了几次查询预热缓存后，时间稳定在约6ms。&lt;/p>
&lt;h3 id="bitmap-scan">Bitmap Scan
&lt;/h3>&lt;p>从执行计划来看，我们可以看到数据库使用了位图扫描。位图扫描的工作分为两个阶段。&lt;/p>
&lt;ul>
&lt;li>位图索引扫描。浏览整个索引sale_fact_sold_at_ix 并映射所有包含相关记录的表页。&lt;/li>
&lt;li>位图堆扫描：读取包含相关行的页面。读取包含相关行的页面，并在这些页面中找到满足条件的行。&lt;/li>
&lt;/ul>
&lt;p>页面可以包含多条记录。第一步使用索引来查找页面。第二步检查这些页面里面的行，因此执行计划中的 &amp;ldquo;Recheck Cond &amp;ldquo;操作。&lt;/p>
&lt;p>这时，很多DBA和开发人员都会收工，继续进行下一个查询。BUT，有一个方法可以让这个查询变得更好。&lt;/p>
&lt;h3 id="index-scan">Index Scan
&lt;/h3>&lt;p>为了让事情变得更好，我们会在加载数据的方式上做一个小小的改变。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TRUNCATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">TRUNCATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">md5&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()::&lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-01-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">interval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;1 day&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">round&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">365&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ORDER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">VACUUM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">VACUUM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这次，我们加载的数据是按sold_at排序的。&lt;/p>
&lt;p>让我们看看现在完全相同的查询的执行计划是什么样子的。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BETWEEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">using&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">29&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">184&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">73&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4272&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Planning&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">145&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Execution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">294&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在运行了几次查询后，我们得到了一个稳定在2.3ms的轮回时间。与之前的查询耗时约6ms相比，我们得到了约60%的稳定节省。&lt;/p>
&lt;p>还有一点我们可以马上看到，这次数据库没有使用位图扫描，而是使用了 &amp;ldquo;常规 &amp;ldquo;索引扫描。为什么会这样呢？&lt;/p>
&lt;h3 id="correlation">Correlation
&lt;/h3>&lt;p>当数据库在分析一张表时，它会收集各种统计数据。其中一个统计是&lt;a class="link" href="https://www.postgresql.org/docs/current/view-pg-stats.html" target="_blank" rel="noopener"
>相关性&lt;/a>。&lt;/p>
&lt;blockquote>
&lt;p>物理行排序和逻辑列值排序之间的统计相关性。这个范围从-1到+1。当该值接近-1或+1时，由于减少了对磁盘的随机访问，估计对该列进行索引扫描会比接近零时更便宜。&lt;/p>&lt;/blockquote>
&lt;p>正如官方文档所解释的那样，相关性衡量了特定列值在磁盘上的 &amp;ldquo;排序 &amp;ldquo;程度。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1267.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>当相关性为1，或接近1时，意味着表中的页在磁盘上的存储顺序与表中的行大致相同。这其实是很常见的。例如，自动递增的ID通常会有接近1的相关性。跟踪行创建时间的日期和时间戳列通常也会有接近于1的相关性。&lt;/p>
&lt;p>当相关性为-1时，表的页面相对于列的排序顺序是相反的。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1268.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>当相关性接近0时，意味着列中的值与表的页面存储方式没有相关性或相关性很小。&lt;/p>
&lt;p>回到我们的sale_fact表，当我们将数据加载到表中时，没有先进行排序，这些就是相关性。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pg_stats&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;sale_fact&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-----------+----------+--------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">005344716&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">011389783&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>自动生成的列id的相关性为1，sold_at列的相关性很低：连续的值分散在整个表中。&lt;/p>
&lt;p>当我们将排序数据加载到表中时，这些是数据库计算出的相关性。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-----------+----------+----------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00041992788&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>现在sold_at的相关性为1。&lt;/p>
&lt;p>那么为什么数据库在相关性较低的时候使用位图扫描，而在相关性接近1的时候使用索引扫描呢？&lt;/p>
&lt;ul>
&lt;li>当相关性为1时，数据库估计请求范围内的行很可能在连续的页面中。在这种情况下，索引扫描很可能读取很少的页面。&lt;/li>
&lt;li>当相关性接近0时，数据库估计请求范围内的行很可能分散在整个表中。在这种情况下，使用位图扫描来映射存在行的表页是有意义的，只有这样才能获取行并应用条件。&lt;/li>
&lt;li>&lt;/li>
&lt;/ul>
&lt;p>下次将数据加载到表中时，请考虑如何查询数据，并确保以用于范围扫描的索引能够受益的方式进行排序。&lt;/p>
&lt;h3 id="cluster-command">CLUSTER Command
&lt;/h3>&lt;p>另一种按特定索引对磁盘上的表进行 &amp;ldquo;排序 &amp;ldquo;的方法是使用CLUSTER命令。&lt;/p>
&lt;p>例如：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TRUNCATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">TRUNCATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- Insert rows without sorting
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">md5&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()::&lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-01-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">interval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;1 day&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">round&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">365&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pg_stats&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;sale_fact&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-----------+-----------+----------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">9702674&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">05&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">010033822&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我们按照随机顺序向表中加载数据，结果sold_at的相关性接近于零。&lt;/p>
&lt;p>为了按sold_at对表进行 &amp;ldquo;重新排列&amp;rdquo;，我们使用CLUSTER命令，根据索引sale_fact_sold_at_ix对磁盘上的表进行排序。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CLUSTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">USING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CLUSTER&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pg_stats&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;sale_fact&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-----------+----------+--------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">002239401&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">013389298&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>表格聚类后，我们可以看到sold_at的相关性为1。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1269.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>关于CLUSTER命令需要注意的一些事情。&lt;/p>
&lt;ul>
&lt;li>通过特定列对表进行聚类可能会影响其他列的相关性。例如，请看我们将表按sold_at聚类后，列id的相关性。&lt;/li>
&lt;li>CLUSTER是一个重度、阻塞的操作，所以请确保不要在活表上执行。&lt;/li>
&lt;/ul>
&lt;p>基于这两个原因，最好是将数据分类插入，不要依赖CLUSTER。&lt;/p>
&lt;h2 id="使用-brin-索引高相关性的列">使用 BRIN 索引高相关性的列
&lt;/h2>&lt;p>说到索引，大多数开发人员会想到B-Tree索引。但是，PostgreSQL提供了其他类型的索引，比如&lt;a class="link" href="https://www.postgresql.org/docs/current/brin.html" target="_blank" rel="noopener"
>BRIN&lt;/a>。&lt;/p>
&lt;blockquote>
&lt;p>BRIN是为处理非常大的表而设计的，在这些表中，某些列与它们在表中的物理位置有一些自然的关联。&lt;/p>&lt;/blockquote>
&lt;p>BRIN是Block Range Index的缩写。根据文档，BRIN索引对于相关性高的列效果最好。正如我们在前面的章节中已经看到的，一些字段如自动递增的ID和时间戳与表的物理结构有天然的相关性，因此它们是BRIN索引的良好候选。&lt;/p>
&lt;p>在某些情况下，与类似的B-Tree索引相比，BRIN索引在大小和性能上可以提供更好的 &amp;ldquo;性价比&amp;rdquo;。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1270.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>BRIN索引的工作原理是将值的范围保持在表内相邻的若干页内。假设我们在一列中有这些值，每个值都是单表页。&lt;/p>
&lt;p>&lt;code>1, 2, 3, 4, 5, 6, 7, 8, 9&lt;/code>&lt;/p>
&lt;p>BRIN索引在表中相邻页的范围内工作。如果相邻页数设置为3，索引将把表格分为以下范围：&lt;/p>
&lt;p>&lt;code>[1,2,3], [4,5,6], [7,8,9]&lt;/code>&lt;/p>
&lt;p>对于每个范围，BRIN指数保持最小值和最大值。&lt;/p>
&lt;p>&lt;code>[1–3], [4–6], [7–9]&lt;/code>&lt;/p>
&lt;p>利用上面的索引，尝试搜索数值5。&lt;/p>
&lt;ul>
&lt;li>[1–3] - Definitely not here&lt;/li>
&lt;li>[4–6] - Might be here&lt;/li>
&lt;li>[7–9] - Definitely not here&lt;/li>
&lt;/ul>
&lt;p>利用BRIN索引，我们设法将搜索范围限制在4-6块。&lt;/p>
&lt;p>让我们再举一个例子，这次列中的值会有一个接近于零的相关性，这意味着它们没有被排序。&lt;/p>
&lt;p>&lt;code>[2,9,5], [1,4,7], [3,8,6]&lt;/code>&lt;/p>
&lt;p>将3个相邻的块进行索引，会产生以下范围。&lt;/p>
&lt;p>&lt;code>[2–9], [1–7], [3–8]&lt;/code>&lt;/p>
&lt;p>让我们试着搜索一下数值5。&lt;/p>
&lt;p>[2–9] - 可能在这
[1–7] - 可能在这
[3–8] - 可能在这&lt;/p>
&lt;p>在这种情况下，索引根本没有限制搜索，因此它是没有用的。&lt;/p>
&lt;h3 id="理解-pages_per_range">理解 pages_per_range
&lt;/h3>&lt;p>相邻页面的数量由参数pages_per_range决定。每个范围的页数会影响BRIN索引的大小和精度。&lt;/p>
&lt;p>大的pages_per_range会产生一个小而不准确的索引。
小的pages_per_range会产生更大更准确的索引。
默认的页面_per_range为128页。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1271.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>为了演示，让我们在2个相邻页面的范围上创建一个BRIN索引，并搜索值5。&lt;/p>
&lt;ul>
&lt;li>[1–2] - 肯定不在这&lt;/li>
&lt;li>[3–4] - 肯定不在这&lt;/li>
&lt;li>[5–6] - 可能在这&lt;/li>
&lt;li>[7–8] - 肯定不在这&lt;/li>
&lt;li>[9] - 肯定不在这&lt;/li>
&lt;/ul>
&lt;p>使用每个范围为2页的索引，我们能够将搜索限制在第5和第6块。当范围为3页时，索引将搜索范围限制在4、5和6块。&lt;/p>
&lt;p>两个索引之间的另一个区别是，当范围是3页时，我们只需要保留3个范围。当范围为2时，我们必须保留5个范围，所以索引更大。&lt;/p>
&lt;p>&lt;strong>创建 BRIN 索引&lt;/strong>&lt;/p>
&lt;p>使用之前的sales_fact，让我们在sold_at列上创建一个BRIN索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_bix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">USING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BRIN&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WITH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pages_per_range&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这就创建了一个BRIN索引，默认的页面_per_range = 128。&lt;/p>
&lt;p>让我们尝试查询销售日期的范围。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BETWEEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">13&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">11&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">1135&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">61&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4319&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Recheck&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Rows&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Removed&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Recheck&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">23130&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Blocks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lossy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">256&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_bix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">03&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">12500&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Execution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">877&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>数据库使用我们的BRIN索引得到了一系列的销售日期，但这不是有趣的部分&amp;hellip;&amp;hellip;。&lt;/p>
&lt;p>&lt;strong>优化 pages_per_range&lt;/strong>&lt;/p>
&lt;p>根据执行计划，数据库从使用索引找到的页面中删除了23130条记录。这可能表明我们为索引设置的范围对于这个特定的查询来说太大。让我们尝试创建一个每个范围内页数较少的索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_bix64&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">USING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BRIN&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WITH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pages_per_range&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BETWEEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">13&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">1048&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4319&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Recheck&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Rows&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Removed&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Recheck&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">9434&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Blocks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lossy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_bix64&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">02&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">6667&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Execution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">491&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在每个范围为64页的情况下，数据库从使用索引找到的页面中删除的记录较少，只删除了9,434条，而当范围为128页时，删除了23,130条。这意味着数据库需要做更少的IO，查询速度也稍快，约5.5ms，而不是约8.9ms。&lt;/p>
&lt;p>用不同的pages_per_range值测试索引，产生了以下结果。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">PAGES_PER_RANGE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ROWS_REMOVED_BY_INDEX_RECHECK&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">23&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">130&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">434&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">874&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">446&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">446&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我们可以看到，当我们减少pages_per_range时，索引更加准确，并且从使用索引找到的页面中删除的行数更少。&lt;/p>
&lt;p>注意，我们针对一个非常特殊的查询进行了优化。这对于演示目的来说是可以的，但在实际生活中，最好使用满足大多数查询需求的值。&lt;/p>
&lt;p>&lt;strong>评估指数大小&lt;/strong>&lt;/p>
&lt;p>BRIN索引的另一大卖点是其大小。在前面的章节中，我们在sold_at字段上创建了一个B-Tree索引。该索引的大小是2224kB。page_per_range=128的BRIN索引的大小只有48kb。这比B-Tree索引小了46倍。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Schema&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Owner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Size&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------+-----------------------+-------+-------+-----------+-------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_bix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">haki&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">48&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kB&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">haki&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2224&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kB&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>BRIN索引的大小也会受到pages_per_range的影响。例如，page_per_range=2的BRIN索引重56kb，仅比48kb稍大。&lt;/p>
&lt;h2 id="让索引-不可见">让索引 &amp;ldquo;不可见&amp;rdquo;
&lt;/h2>&lt;p>PostgreSQL有一个很好的功能，叫做事务性DDL。在使用Oracle多年后，我已经习惯了诸如CREATE、DROP和ALTER等结束事务的DDL命令。然而，在PostgreSQL中，你可以在事务中执行DDL命令，而且只有当事务提交时，更改才会生效。&lt;/p>
&lt;p>正如我最近发现的那样，使用事务性DDL，你可以使索引不可见! 当你想看看一个执行计划在没有一些索引的情况下是什么样子的时候，这就很方便了。&lt;/p>
&lt;p>例如，在上一节的sale_fact表中，我们在sold_at上创建了一个索引。获取7月份销售额的执行计划是这样的。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BETWEEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">using&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">182&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">80&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4319&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="n">P&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>为了看看如果索引sale_fact_sold_at_ix不存在，执行计划会是什么，我们可以在一个事务里面放弃索引，然后立即回滚。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BEGIN&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">BEGIN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BETWEEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Seq&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">2435&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4319&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Filter&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ROLLBACK&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ROLLBACK&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我们首先使用BEGIN开始一个事务。然后我们放弃索引并生成一个执行计划。注意，现在执行计划使用了全表扫描，就像索引不存在一样。此时事务仍在进行中，所以还没有丢弃索引。为了在不丢弃索引的情况下完成事务，我们使用ROLLBACK命令回滚事务。&lt;/p>
&lt;p>现在，确保索引仍然存在。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">\&lt;/span>&lt;span class="n">di&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">of&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">relations&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Schema&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Owner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Size&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------+----------------------+-------+-------+-----------+---------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">haki&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2224&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kB&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其他不支持事务性DDL的数据库提供了其他方法来实现同样的目标。例如，Oracle让你将一个索引标记为不可见，这将导致优化器忽略它。&lt;/p>
&lt;p>注意：在事务内部丢弃索引会在事务处于活动状态时锁定表的并发选择、插入、更新和删除。请在测试环境中谨慎使用，并避免在生产数据库中使用。&lt;/p>
&lt;h2 id="不要在圆周时间安排长期运行的流程">不要在圆周时间安排长期运行的流程
&lt;/h2>&lt;p>众所周知，当一只股票的价格达到一个漂亮的整数，如10元、100元、1000元时，就会发生奇怪的事情，这是投资者都知道的事实。&lt;a class="link" href="https://www.investopedia.com/trading/support-and-resistance-basics/#mntl-sc-block_1-0-38" target="_blank" rel="noopener"
>正如下面的文章&lt;/a>所解释的。&lt;/p>
&lt;blockquote>
&lt;p>[&amp;hellip; &amp;hellip;]资产的价格可能会有一个困难的时间 超过一个整数，如50元或100元/股。大多数没有经验的交易者倾向于在价格处于整数时买入或卖出资产，因为他们更有可能觉得一只股票在这种水平上的价值相当高。&lt;/p>&lt;/blockquote>
&lt;p>开发商在这个意义上与投资者并没有什么不同。当他们需要安排一个长期运行的过程时，他们通常会把时间安排在一个整点。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1272.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>这种在圆周时间安排任务的倾向，会在这些时间内造成一些异常的负载。所以，如果你需要安排一些长期运行的进程，如果你在其他时间安排，你有更好的机会找到一个系统在休息。&lt;/p>
&lt;p>另一个好主意是给任务的日程安排应用一个随机的延迟，这样它就不会每次都在同一时间运行。这样，即使另一个任务安排在同一时间运行，也不会有大问题。如果你使用systemd定时器单元来安排任务，你可以使用&lt;a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd.timer.html#RandomizedDelaySec=" target="_blank" rel="noopener"
>RandomizedDelaySec&lt;/a>选项来实现。&lt;/p>
&lt;h2 id="结束语">结束语
&lt;/h2>&lt;p>本文涵盖了我自己经验中的一些琐碎和非琐碎的技巧。其中有些技巧很容易实现，有些则需要更深入地了解数据库的工作原理。数据库是大多数现代系统的支柱，所以花一些时间来了解它们的工作原理对任何开发人员来说都是一项很好的投资!&lt;/p></description></item><item><title>DevOps Coach 周刊 1</title><link>https://martinliu.cn/blog/devopscoach-weekly-1/</link><pubDate>Tue, 28 Jul 2020 10:35:19 +0800</pubDate><guid>https://martinliu.cn/blog/devopscoach-weekly-1/</guid><description>&lt;img src="https://martinliu.cn/images/weeklyupdate.jpg" alt="Featured image of post DevOps Coach 周刊 1" />&lt;h2 id="新闻">新闻
&lt;/h2>&lt;p>又到了一年一度的时间。定期的Puppet Devops状态调查已经开始。今年的重点是变革管理、持续交付和自服务平台之间的关系。
&lt;a class="link" href="https://polls.onresearch.net/xsurvey/20JT028/20JT028T1/Survey.aspx?ckie=true" target="_blank" rel="noopener"
>https://polls.onresearch.net/xsurvey/20JT028/20JT028T1/Survey.aspx?ckie=true&lt;/a>&lt;/p>
&lt;p>文档和设计在构建强大的系统中起着至关重要的作用。这篇文章探讨了为什么设计文档是有用的，以及它们应该包含什么样的内容。
&lt;a class="link" href="https://www.industrialempathy.com/posts/design-docs-at-google/" target="_blank" rel="noopener"
>https://www.industrialempathy.com/posts/design-docs-at-google/&lt;/a>&lt;/p>
&lt;p>一份关于公共Terraform代码安全状况的新报告。对于任何使用Terraform配置服务的人来说，一些有用的数据和一些好的提示。
&lt;a class="link" href="https://bridgecrew.io/blog/state-of-open-source-terraform-security-report-2020/" target="_blank" rel="noopener"
>https://bridgecrew.io/blog/state-of-open-source-terraform-security-report-2020/&lt;/a>&lt;/p>
&lt;p>看看如何使用 Azure Pipelines 自动验证 sysmon 配置。
&lt;a class="link" href="https://medium.com/falconforce/using-azure-pipelines-to-validate-my-sysmon-configuration-48315dba7571" target="_blank" rel="noopener"
>https://medium.com/falconforce/using-azure-pipelines-to-validate-my-sysmon-configuration-48315dba7571&lt;/a>&lt;/p>
&lt;p>这是一个很好的大规模迁移低级组件的故事，在这个案例中是一个应用服务器。金丝雀的推出、上游贡献、性能和其他有趣的话题。
&lt;a class="link" href="https://about.gitlab.com/blog/2020/07/08/migrating-to-puma-on-gitlab/" target="_blank" rel="noopener"
>https://about.gitlab.com/blog/2020/07/08/migrating-to-puma-on-gitlab/&lt;/a>&lt;/p>
&lt;p>拥抱云原生技术和工作方式会带来挑战，本帖记录了其中一些挑战，包括安全、缺乏专业知识、发布周期缓慢等。
&lt;a class="link" href="https://www.cloudops.com/2020/07/top-7-challenges-to-becoming-cloud-native/" target="_blank" rel="noopener"
>https://www.cloudops.com/2020/07/top-7-challenges-to-becoming-cloud-native/&lt;/a>&lt;/p>
&lt;h2 id="文章">文章
&lt;/h2>&lt;p>“How could they be so stupid?” 上周知名Twitter 账号入侵事件出现了更多细节，导致一些人说出了上面这句话。这里有一个看法，如何看待这不是 &amp;ldquo;愚蠢 &amp;ldquo;的问题。Lorin Hochstein
&lt;a class="link" href="https://surfingcomplexity.blog/2020/07/20/how-could-they-be-so-stupid/" target="_blank" rel="noopener"
>https://surfingcomplexity.blog/2020/07/20/how-could-they-be-so-stupid/&lt;/a>&lt;/p>
&lt;p>Data Consistency Checks 你的数据库中的数据应该是一致的&amp;hellip;&amp;hellip;但话说回来，事故不应该发生，对吗？Slack接受在他们的规模下，数据经常会出问题，他们有框架和一套工具来处理它。Paul Hammond and Samantha Stoller — Slack
&lt;a class="link" href="https://slack.engineering/data-consistency-checks-e73261318f96" target="_blank" rel="noopener"
>https://slack.engineering/data-consistency-checks-e73261318f96&lt;/a>&lt;/p>
&lt;p>Obstacles to Learning from Incidents 我从这篇文章中学到了很多东西。我最喜欢的障碍是 &amp;ldquo;通过差异化来拉开距离&amp;rdquo;，比如 &amp;ldquo;我们绝对不会以这种方式应对事件&amp;rdquo;。Thai Wood — Learning from Incidents
&lt;a class="link" href="https://www.learningfromincidents.io/blog/obstacles-to-learning-from-incidents" target="_blank" rel="noopener"
>https://www.learningfromincidents.io/blog/obstacles-to-learning-from-incidents&lt;/a>&lt;/p>
&lt;p>You don’t need SRE. What you need is SRE. […] SRE，也就是谷歌定义的SRE，对于大多数组织来说并不适用。Sanjeev Sharma
&lt;a class="link" href="https://sdarchitect.blog/2020/02/20/you-dont-need-sre-what-you-need-is-sre/" target="_blank" rel="noopener"
>https://sdarchitect.blog/2020/02/20/you-dont-need-sre-what-you-need-is-sre/&lt;/a>&lt;/p>
&lt;p>Questionable Advice: “What’s the critical path?” 专家建议，当你试图弄清楚你的关键路径是什么（以及为什么你想知道它是什么）时，应该问什么问题。Charity Majors
&lt;a class="link" href="https://charity.wtf/2020/07/24/questionable-advice-whats-the-critical-path/" target="_blank" rel="noopener"
>https://charity.wtf/2020/07/24/questionable-advice-whats-the-critical-path/&lt;/a>&lt;/p>
&lt;p>Thinking About Your Humans With J. Paul Reed 这个播客集有点像J.Paul Reed和Tim Heckman在&lt;a class="link" href="https://srefromhome.com/%e7%9a%84%e8%81%94%e5%90%88%e6%bc%94%e8%ae%b2%e7%9a%84%e9%a2%84%e8%a7%88%e3%80%82%e6%88%91%e5%96%9c%e6%ac%a2%e4%bb%96%e4%bb%ac%e6%8a%8a%e8%bf%99%e5%9c%ba%e4%bc%a0%e6%9f%93%e7%97%85%e5%a4%a7%e6%b5%81%e8%a1%8c%e7%a7%b0%e4%b8%ba%e9%95%bf%e8%be%be%e6%95%b0%e6%9c%88%e7%9a%84%e4%ba%8b%e4%bb%b6%ef%bc%8c%e5%b9%b6%e6%8c%87%e5%87%ba%e5%a6%82%e6%9e%9c%e4%bd%a0%e6%80%bb%e6%98%af%e5%9c%a8%e4%ba%8b%e4%bb%b6%e4%b8%ad%ef%bc%8c%e9%82%a3%e4%b9%88%e4%bd%a0%e6%b0%b8%e8%bf%9c%e4%b8%8d%e4%bc%9a%e5%9c%a8%e4%ba%8b%e4%bb%b6%e4%b8%ad%e3%80%82Julie" target="_blank" rel="noopener"
>https://srefromhome.com/的联合演讲的预览。我喜欢他们把这场传染病大流行称为长达数月的事件，并指出如果你总是在事件中，那么你永远不会在事件中。Julie&lt;/a> Gunderson and Mandi Walls — Page it to the Limit
&lt;a class="link" href="https://www.pageittothelimit.com/thinking-about-your-humans/" target="_blank" rel="noopener"
>https://www.pageittothelimit.com/thinking-about-your-humans/&lt;/a>&lt;/p>
&lt;p>Rebuilding messaging: How we bootstrapped our platform 我喜欢一个好的双写故事。以下是LinkedIn如何过渡到新的消息存储机制。 Pradhan Cadabam and Jingxuan (Rex) Zhang — LinkedIn
&lt;a class="link" href="https://engineering.linkedin.com/blog/2020/bootstrapping-our-new-messaging-platform" target="_blank" rel="noopener"
>https://engineering.linkedin.com/blog/2020/bootstrapping-our-new-messaging-platform&lt;/a>&lt;/p>
&lt;p>Using Automation and SLOs to Create Margin in your Systems 在系统中留有余地，使其具有适应能力，并利用SLO(同情地)来推动优先事项的确定。
&lt;a class="link" href="https://thechief.io/c/blameless/using-automation-and-slos-create-margin-your-systems/" target="_blank" rel="noopener"
>https://thechief.io/c/blameless/using-automation-and-slos-create-margin-your-systems/&lt;/a>&lt;/p>
&lt;p>How to Classify Incidents 如何对事件进行分类 什么是事件分类？为什么要对事件进行分类？事件严重性与优先级，以及如何创建事件类别？
&lt;a class="link" href="https://thechief.io/c/blameless/how-classify-incidents/" target="_blank" rel="noopener"
>https://thechief.io/c/blameless/how-classify-incidents/&lt;/a>&lt;/p>
&lt;h2 id="宕机">宕机
&lt;/h2>&lt;p>上周全球重大宕机事故清单。&lt;/p>
&lt;ul>
&lt;li>Garmin 作为佳明手表和 app 的用户，我体验到了这场 24+小时的服务中断
&lt;ul>
&lt;li>&lt;a class="link" href="https://spectrumlocalnews.com/nys/rochester/ap-online/2020/07/24/garmin-fitness-tracking-service-goes-down-frustrating-users" target="_blank" rel="noopener"
>https://spectrumlocalnews.com/nys/rochester/ap-online/2020/07/24/garmin-fitness-tracking-service-goes-down-frustrating-users&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Snapchat 打不开 app，黑屏，无法使用摄像头相关功能
&lt;ul>
&lt;li>&lt;a class="link" href="https://screenrant.com/snapchat-down-app-slow-response-messages-not-sent-issues/" target="_blank" rel="noopener"
>https://screenrant.com/snapchat-down-app-slow-response-messages-not-sent-issues/&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Tweetdeck Twitter 客户的工具服务发生故障。
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.independent.co.uk/life-style/gadgets-and-tech/news/tweetdeck-down-twitter-not-working-loading-a9633636.html" target="_blank" rel="noopener"
>https://www.independent.co.uk/life-style/gadgets-and-tech/news/tweetdeck-down-twitter-not-working-loading-a9633636.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>GGPoker 在 World Series of Poker (WSOP) 世界扑克大赛赛事期间发生一些列问题.
&lt;ul>
&lt;li>&lt;a class="link" href="https://portswigger.net/daily-swig/online-poker-operator-hit-by-ddos-attack-on-opening-day-of-wsop-event" target="_blank" rel="noopener"
>https://portswigger.net/daily-swig/online-poker-operator-hit-by-ddos-attack-on-opening-day-of-wsop-event&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Fastly (control plane) Full disclosure: Fastly is my employer.
&lt;ul>
&lt;li>&lt;a class="link" href="https://status.fastly.com/incidents/7q2psqf255wl" target="_blank" rel="noopener"
>https://status.fastly.com/incidents/7q2psqf255wl&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Squarespace 这一周非常痛苦，在July 21 事故后发生的相关事件：
*July 21 &lt;a class="link" href="https://status.squarespace.com/incidents/hh3p432jcq03" target="_blank" rel="noopener"
>https://status.squarespace.com/incidents/hh3p432jcq03&lt;/a>
&lt;ul>
&lt;li>July 22 (包含事件详细分析) &lt;a class="link" href="https://status.squarespace.com/incidents/3cgg1171wyvz" target="_blank" rel="noopener"
>https://status.squarespace.com/incidents/3cgg1171wyvz&lt;/a>
*July 24 &lt;a class="link" href="https://status.squarespace.com/incidents/x63nssl9kzvm" target="_blank" rel="noopener"
>https://status.squarespace.com/incidents/x63nssl9kzvm&lt;/a>&lt;/li>
&lt;li>July 24 &lt;a class="link" href="https://status.squarespace.com/incidents/v6ql728f1f4d" target="_blank" rel="noopener"
>https://status.squarespace.com/incidents/v6ql728f1f4d&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Google Cloud Platform 几个谷歌云平台组件受到影响，包括 7 层负载均衡器。
&lt;ul>
&lt;li>&lt;a class="link" href="https://status.cloud.google.com/incident/zall/20006" target="_blank" rel="noopener"
>https://status.cloud.google.com/incident/zall/20006&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="工具">工具
&lt;/h2>&lt;p>&lt;a class="link" href="https://github.com/flant/shell-operator" target="_blank" rel="noopener"
>https://github.com/flant/shell-operator&lt;/a>
Shell-operator是一个在Kubernetes集群中运行事件驱动脚本的工具。&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/Fizzadar/pyinfra" target="_blank" rel="noopener"
>https://github.com/Fizzadar/pyinfra&lt;/a>
pyinfra在大规模的基础架构中实现了超快的自动化。它可以用于临时命令执行、服务部署、配置管理等。&lt;/p>
&lt;h1 id="python-配置管理">python #配置管理
&lt;/h1>&lt;p>&lt;a class="link" href="https://github.com/alerta/alerta" target="_blank" rel="noopener"
>https://github.com/alerta/alerta&lt;/a>
Alerta 监测系统&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/GoogleCloudPlatform/terraformer" target="_blank" rel="noopener"
>https://github.com/GoogleCloudPlatform/terraformer&lt;/a>
CLI工具可以从现有的基础设施中生成terraform文件（反向Terraform）。&lt;/p>
&lt;h1 id="基础设施即代码">基础设施即代码
&lt;/h1>&lt;p>&lt;a class="link" href="https://github.com/visenger/awesome-mlops" target="_blank" rel="noopener"
>https://github.com/visenger/awesome-mlops&lt;/a>
MLOps的精选参考资料清单。&lt;/p>
&lt;h1 id="github">github
&lt;/h1>&lt;p>&lt;a class="link" href="https://github.com/cycloidio/inframap" target="_blank" rel="noopener"
>https://github.com/cycloidio/inframap&lt;/a>
读取你的tfstate或HCL，为每个提供者生成一个特定的图表，只显示最重要/相关的资源。&lt;/p>
&lt;h1 id="terraform">terraform
&lt;/h1>&lt;p>&lt;a class="link" href="https://github.com/Hack-with-Github/Awesome-Hacking" target="_blank" rel="noopener"
>https://github.com/Hack-with-Github/Awesome-Hacking&lt;/a>
一个为黑客、Pentesters和安全研究人员提供的各种令人敬畏的列表的集合。&lt;/p>
&lt;h1 id="github-安全">github #安全
&lt;/h1>&lt;p>&lt;a class="link" href="https://github.com/box/kube-iptables-tailer" target="_blank" rel="noopener"
>https://github.com/box/kube-iptables-tailer&lt;/a>
kube-iptables-tailer做的正是你所期望的。它将底层的iptables数据暴露给kubectl，方便发现服务在Kubernetes中互相通信的尝试和失败。&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/Stono/kconmon" target="_blank" rel="noopener"
>https://github.com/Stono/kconmon&lt;/a>
Kconmon是一个Kubernetes连通性监控工具，它可以运行频繁的测试（tcp、udp和dns），并公开Prometheus指标，这些指标富含节点名称，以及位置信息（如区域），使您能够关联可用性区域或节点之间的问题。&lt;/p></description></item><item><title>Skaffold 让 K8s 开发者更加酸爽</title><link>https://martinliu.cn/blog/skaffold-make-local-k8s-dev-easy/</link><pubDate>Wed, 15 Jul 2020 00:09:53 +0800</pubDate><guid>https://martinliu.cn/blog/skaffold-make-local-k8s-dev-easy/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-1.jpg" alt="Featured image of post Skaffold 让 K8s 开发者更加酸爽" />&lt;p>&lt;img src="https://martinliu.cn/images/skaffold.png"
loading="lazy"
>&lt;/p>
&lt;p>今天介绍一个本地 Kubernetes 开发的利器 Skaffold。
这是我偶然间发现的一个工具，询问了一下周围的人，居然还没有人用过。测试之后，确实有一种不吐不快的感觉。&lt;/p>
&lt;h2 id="简介">简介
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/intro.gif"
loading="lazy"
>&lt;/p>
&lt;p>Skaffold Google 开发的一个开源项目。是一个非常轻量的命令行工具，就是一个可执行文件。它的主页上是这样的介绍它的。&lt;/p>
&lt;ul>
&lt;li>轻量：Skaffold只是一个客户端工具。由于集群上不需要任何的相关组件，您的集群没有任何开销或维护负担。&lt;/li>
&lt;li>运行在任何地方：Skaffold是与世界分享你的项目的最简单的方法：&amp;ldquo;git clone&amp;rdquo;，然后 &amp;ldquo;skaffold run&amp;rdquo;。此外，你还可以使用配置文件、本地用户配置、环境变量和标志来轻松地集成不同环境的差异。&lt;/li>
&lt;li>功能丰富：Skaffold拥有许多Kubernetes原生开发的基本功能，包括基于策略的打镜像标签、资源端口转发和日志、文件同步等。&lt;/li>
&lt;li>优化你的开发：Skaffold使内部循环紧密，高度优化，让您在开发的同时得到即时反馈。&lt;/li>
&lt;/ul>
&lt;h2 id="客户评价">客户评价
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/forgerock.png"
loading="lazy"
>&lt;/p>
&lt;p>&amp;ldquo;我们的客户很喜欢[Kubernetes]，但一直给我们反馈说在Kubernetes上开发很麻烦。Skaffold一针见血地解决了这个问题。以前需要几分钟才能部署的docker镜像或配置的更改，现在只需要几秒钟。Skaffold的插件架构使我们能够部署到Helm或Kustomize，并使用各种docker构建插件，如Kaniko。Skaffold用一个精简的工具取代了我们定制的实用程序和脚本集合，并且易于使用。&amp;rdquo;
Warren Strange，ForgeRock的工程总监。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/quora.png"
loading="lazy"
>&lt;/p>
&lt;p>&amp;ldquo;当我们评估我们可以使用Kubernetes的工作流程时，Skaffold脱颖而出，成为我们在开发和部署中都想要的工具。它为我们提供了一个跨应用程序的通用入口点，我们也可以为CI/CD重用。现在，我们所有的Kubernetes应用的CI/CD管道在构建和部署时都使用Skaffold。&amp;rdquo;
Taylor Barrella，Quora的软件工程师&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/tng.png"
loading="lazy"
>&lt;/p>
&lt;p>&amp;ldquo;Skaffold是一个了不起的工具，它为我们简化了开发和交付。Skaffold通过覆盖两个维度，击中了我们的甜蜜点。第一，从本地开发、集成测试到交付的整个开发周期。第二，Skaffold让我们能够在Linux、OSX和Windows上独立开发，不需要特定的平台逻辑。&amp;rdquo;
Martin Höfling，TNG技术咨询有限公司首席顾问&lt;/p>
&lt;h2 id="推荐首次测试流程">推荐首次测试流程
&lt;/h2>&lt;p>前置条件，你的开发用工作电脑上已经安装了它需要调用的 kubectl 和 docker 命令，kubectl 需要有至少一个可用的配置，这个配置可以指向任一一个你有权限部署的 Kubernetes 集群。&lt;/p>
&lt;p>我在 macOS 上，直接运行 &lt;code>‌brew install skaffold&lt;/code> 即可，其它系统参考：&lt;a class="link" href="https://skaffold.dev/docs/install/" target="_blank" rel="noopener"
>https://skaffold.dev/docs/install/&lt;/a>&lt;/p>
&lt;p>克隆 Skaffold 的代码库到本地，获取必要的测试应用代码。&lt;/p>
&lt;p>&lt;code>‌git clone https://github.com/GoogleContainerTools/skaffold&lt;/code>&lt;/p>
&lt;p>进入代码库中的‘hello world’示例应用。&lt;/p>
&lt;p>执行：&lt;code>‌cd skaffold/examples/getting-started&lt;/code>&lt;/p>
&lt;p>执行 &lt;code>‌skaffold dev&lt;/code> ，你会看到 Skaffold 进入了这个项目的构建和运行的状态，执行结果是持续的输出 ”[getting-started] Hello world!“&lt;/p>
&lt;p>现在 Skaffold 就进入了 /getting-started 的监视状态。观察任何代码文件的修改存盘动作，每次代码的变更会触发 Skaffold 流水线的执行，skaffold.yaml 文件中描述了本地流水线中的相关动作：&lt;/p>
&lt;ul>
&lt;li>使用 Dockerfile 从源头构建Docker镜像。&lt;/li>
&lt;li>用Docker镜像的内容的sha256哈希值来打上标签。&lt;/li>
&lt;li>更新 Kubernetes manifest k8s-pod.yaml，以使用上一步构建的镜像。&lt;/li>
&lt;li>使用 kubectl apply -f 部署 Kubernetes manifest。&lt;/li>
&lt;li>从已部署的应用程序取回日志在本地控制台显示。&lt;/li>
&lt;/ul>
&lt;p>现在用代码编辑器打开这个项目唯一的程序文件 main.go ，修改其中的 Hello World 为其它你想到的词，保存后，观察构建的过程。&lt;/p>
&lt;h2 id="推荐微服务测试">推荐微服务测试
&lt;/h2>&lt;p>参考以下视频，测试 Skaffold 代码库中的 microservice 项目。&lt;/p>
&lt;h2 id="skaffold-流水线阶段">Skaffold 流水线阶段
&lt;/h2>&lt;p>Skaffold 主要会用到五个阶段。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/workflow.png"
loading="lazy"
>&lt;/p>
&lt;p>其所有阶段如下：&lt;/p>
&lt;ul>
&lt;li>Init ： generate a starting point for Skaffold configuration&lt;/li>
&lt;li>Build ：build images with different builders&lt;/li>
&lt;li>Tag ： tag images based on different policies&lt;/li>
&lt;li>Test ：test images with structure tests&lt;/li>
&lt;li>Deploy ：deploy with kubectl, kustomize or helm&lt;/li>
&lt;li>File Sync ： sync changed files directly to containers&lt;/li>
&lt;li>Log ： Tailing tail logs from workloads&lt;/li>
&lt;li>Port Forwarding ：forward ports from services and arbitrary resources to localhost&lt;/li>
&lt;li>Cleanup ： cleanup manifests and images&lt;/li>
&lt;/ul>
&lt;p>当你启动Skaffold时，它就会收集你项目中的源代码，并使用你所选择的工具构建工件；工件一旦成功构建，就会根据你的需要进行标记，并推送到你指定的仓库中。在工作流程的最后，Skaffold还帮助你将工件部署到你的Kubernetes集群中，同样使用你喜欢的工具。&lt;/p>
&lt;p>Skaffold允许你跳过各个阶段。例如，如果你在本地使用Minikube运行Kubernetes，Skaffold不会将工件推送到远程仓库。&lt;/p>
&lt;p>每个阶段的详情见：&lt;a class="link" href="https://skaffold.dev/docs/pipeline-stages/" target="_blank" rel="noopener"
>https://skaffold.dev/docs/pipeline-stages/&lt;/a>&lt;/p>
&lt;h2 id="架构设计">架构设计
&lt;/h2>&lt;p>Skaffold 秉承着插件化的设计思想。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/architecture.png"
loading="lazy"
>&lt;/p>
&lt;p>以上架构内置了对下来工具的支持：&lt;/p>
&lt;ul>
&lt;li>Build
&lt;ul>
&lt;li>Dockerfile locally, in-cluster with kaniko or on cloud using Google Cloud Build&lt;/li>
&lt;li>Jib Maven and Jib Gradle locally or on cloud using Google Cloud Build&lt;/li>
&lt;li>Bazel locally&lt;/li>
&lt;li>Cloud Native Buildpacks locally or on cloud using Google Cloud Build&lt;/li>
&lt;li>Custom script locally or in-cluster&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Test
&lt;ul>
&lt;li>container-structure-test&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Tag&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>Git tagger&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>
&lt;p>Sha256 tagger&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Env Template tagger&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DateTime tagger&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Deploy&lt;/p>
&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>Kubernetes Command-Line Interface (kubectl)&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>Helm&lt;/li>
&lt;li>kustomize&lt;/li>
&lt;/ul>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>Skaffold 确实让基于 Kubernetes 的开发者的本地工作环境更加优化和整洁了。希望本文对你的工作有所帮助。&lt;/p></description></item><item><title>Beats 摄入数据的最佳实践</title><link>https://martinliu.cn/blog/build-security-in-elastic-stack/</link><pubDate>Sun, 21 Jun 2020 18:42:56 +0800</pubDate><guid>https://martinliu.cn/blog/build-security-in-elastic-stack/</guid><description>&lt;img src="https://martinliu.cn/images/locked-up.jpg" alt="Featured image of post Beats 摄入数据的最佳实践" />&lt;p>本文概要：配置 ES 3 节点全加密，Kibana 的 SSL 加密配置，Beats 的高可靠性加密传输，用 RBAC 怎样把权限控制到最小，在配置文件中消除明文密码，这些你都做到了么？如何保证安全、能适应和可扩展的配置 Elastic Stack 技术栈，让我们从 Bests 的角度开始讲解。&lt;/p>
&lt;h2 id="前言">前言
&lt;/h2>&lt;p>本文使用的软版本：&lt;/p>
&lt;ul>
&lt;li>Elastic Stack 7.8.0&lt;/li>
&lt;li>macOS 10.15.5&lt;/li>
&lt;li>Vagrant 2.2.9&lt;/li>
&lt;li>VirtualBox 6.0&lt;/li>
&lt;li>CentOS 8.0&lt;/li>
&lt;/ul>
&lt;p>下面的配置和测试过程基于以下 Vagrantfile ，你可以在其它任何同等的环境中测试下面的所有配置。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># -*- mode: ruby -*-
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># vi: set ft=ruby :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Every Vagrant development environment requires a box. You can search for
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># boxes at https://atlas.hashicorp.com/search.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BOX_IMAGE = &amp;#34;bento/centos-8&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ES_COUNT = 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NODE_COUNT = 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vagrant.configure(&amp;#34;2&amp;#34;) do |config|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #设置所有 guest 使用相同的静态 dns 解析 /etc/hosts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config.vm.provision :hosts, :sync_hosts =&amp;gt; true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #用 vagrant 默认密钥对 ssh 登录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config.ssh.insert_key = false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 用于部署 Elasticsearch 服务器的集群
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (1..ES_COUNT).each do |i|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config.vm.define &amp;#34;es#{i}&amp;#34; do |es_config|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> es_config.vm.box = BOX_IMAGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> es_config.vm.hostname = &amp;#34;es#{i}.zenlab.local&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> es_config.vm.network :private_network, ip: &amp;#34;192.168.50.#{i + 10}&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> es_config.vm.provision :hosts, :sync_hosts =&amp;gt; true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> es_config.vm.provider :virtualbox do |vb|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vb.memory = 2048
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vb.cpus = 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> es_config.vm.provision :shell, path: &amp;#39;pre-install-ES.sh&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 用于部署 Kibana、Logstash 、APM Server、Heatbeat 和 Packetbeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config.vm.define &amp;#34;lk&amp;#34; do |lk_config|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lk_config.vm.box = BOX_IMAGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lk_config.vm.hostname = &amp;#34;lk.zenlab.local&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lk_config.vm.network :private_network, ip: &amp;#34;192.168.50.20&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lk_config.vm.network &amp;#39;forwarded_port&amp;#39;, guest: 5601, host: 5601
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lk_config.vm.provision :hosts, :sync_hosts =&amp;gt; true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> lk_config.vm.provider :virtualbox do |vb|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vb.memory = 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vb.cpus = 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #logstash_config.vm.provision :shell, path: &amp;#39;pre-install-ES.sh&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 两个被管理节点，用于部署监控应用和各种 Beats 代理
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (1..NODE_COUNT).each do |i|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config.vm.define &amp;#34;node#{i}&amp;#34; do |node_config|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node_config.vm.box = BOX_IMAGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node_config.vm.hostname = &amp;#34;node#{i}.zenlab.local&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node_config.vm.network :private_network, ip: &amp;#34;192.168.50.#{i + 20}&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node_config.vm.provider :virtualbox do |vb|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vb.memory = 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vb.cpus = 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> node_config.vm.provision :shell, path: &amp;#39;pre-install-beats.sh&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Install avahi on all machines
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> config.vm.provision &amp;#34;shell&amp;#34;, inline: &amp;lt;&amp;lt;-SHELL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sh -c &amp;#34;echo &amp;#39;Welcome to Elastic Stack!&amp;#39;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SHELL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注：下文中所有路径中的 &lt;code>/vagrant/&lt;/code> 目录是本 vagrant 测试环境中，所有虚拟机的共享目录，是所有节点上配置文件的原路径。如果你使用的不是 vagrant 环境，你需要在下面的测试中适当的替换。&lt;/p>
&lt;h2 id="三节点-elasticsearch-服务器集群">三节点 Elasticsearch 服务器集群
&lt;/h2>&lt;p>在每个节点上使用下面的初始化脚本，部署 Elasticsearch 服务器。&lt;/p>
&lt;p>使用&lt;code>vagrant up es1 es2 es3&lt;/code>命令创建并启动 ES 服务器三个节点。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># pre-install-ES.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">elastic_version=&amp;#39;7.8.0&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo &amp;#34;Provisioning a Elasticsearch &amp;#34;$elastic_version&amp;#34; Server...&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo date &amp;gt; /etc/vagrant_provisioned_at
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo swapoff -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sysctl -w vm.max_map_count=262144
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sysctl -p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &amp;#34;echo &amp;#39;elasticsearch - nofile 65535&amp;#39; &amp;gt;&amp;gt; /etc/security/limits.conf&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &amp;#34;echo &amp;#39;**** -- -- -- -- -- -- -- -- ****&amp;#39; &amp;gt; /etc/motd&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &amp;#34;echo &amp;#39;**** Welcome to Elastic Stack Labs&amp;#39; &amp;gt;&amp;gt; /etc/motd&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &amp;#34;echo &amp;#39;**** -- -- -- -- -- -- -- -- ****&amp;#39; &amp;gt;&amp;gt; /etc/motd&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &amp;#34;echo &amp;#39;*&amp;#39; &amp;gt;&amp;gt; /etc/motd&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rpm -ivh /vagrant/rpm/elasticsearch-$elastic_version-x86_64.rpm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面的脚本简单的初始化了几个操作系统参数，然后完成了 rpm 包的安装。非vagrant 环境的需要手工上传 rpm 安装文件，和运行以上的命令。&lt;/p>
&lt;h3 id="配置首个-es-服务器节点">配置首个 ES 服务器节点
&lt;/h3>&lt;p>登录 es1 节点&lt;code>vagrant ssh es1&lt;/code> ；&lt;/p>
&lt;p>创建用于节点间传输所需要的数字证书和秘钥文件，下面是所使用的种子文件。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># instance.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">instances:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.11&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es1.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#34;es2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.12&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es2.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es3&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.13&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es3.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;lk&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.20&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;lk.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>用 &lt;code>elasticsearch-certutil&lt;/code> 创建证书文件包。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo /usr/share/elasticsearch/bin/elasticsearch-certutil cert --ca --pem --in /vagrant/certs/instance.yml --out /vagrant/certs/certs.zip
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将得到的 zip 文件解压缩在适当的目录里备用。&lt;/p>
&lt;p>重要步骤：在 Elasticsearch 的配置文件目录中放置必要的数字证书文件。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo mkdir /etc/elasticsearch/certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/certs/ca/ca.crt /etc/elasticsearch/certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/certs/es1/* /etc/elasticsearch/certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ls /etc/elasticsearch/certs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在 certs 目录中有三个文件：&lt;/p>
&lt;ol>
&lt;li>ca.crt CA 根证书&lt;/li>
&lt;li>es1.crt 服务器证书&lt;/li>
&lt;li>es1.key 私钥文件&lt;/li>
&lt;/ol>
&lt;p>CA 根证书是在所有节点上发起对 ES 服务的 HTTPS 服务所需要的客户端证书。 es1.crt 和 es1.key 这样的必要对需要在所有 ES 节点上部署，用于 ES 节点间的 transport 协议加密传输，每个 ES 节点都是用自己的密钥对文件。&lt;/p>
&lt;p>在 ES1 的主配置文件中打开安全选项和其它必要配置，示例配置文件如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># elasticsearch.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ---------------------------------- Cluster -----------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cluster&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">elk4devops&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------------ Node ------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">es1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ----------------------------------- Paths ------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">logs&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ---------------------------------- Network -----------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">network&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">es1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zenlab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --------------------------------- Discovery ----------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cluster&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">initial_master_nodes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;es1&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">discovery&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seed_hosts&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span> &lt;span class="s2">&amp;#34;es1.zenlab.local&amp;#34;&lt;/span> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------- TLS and Cert ---------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#外部服务加密配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">es1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">certificate&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">es1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">certificate_authorities&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ca&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#集群内通讯加密配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">es1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">certificate&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">es1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">certificate_authorities&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ca&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">collection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------- App Search ---------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">action&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">auto_create_index&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;.app-search-*-logs-*,-.app-search-*,+*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用以上配置文件覆盖Elasticsearch 默认的配置文件，首次启动第一个 ES 节点的服务。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">cp&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yml&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">daemon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="n">elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>用下面的命令查看启动日志，直到 elasticsearch 服务正常启动。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">tail&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elk4devops&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>用下面的命令初始化 Elasticsearch 系统内置账号为随机复杂密码。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo /usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto -u &amp;#34;https://es1.zenlab.local:9200&amp;#34; -b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password for user apm_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD apm_system = irpVThXpbFDrdq2rBQUC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password for user kibana_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD kibana_system = CxGNlkqQMbcp6u6XuCbk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password for user kibana
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD kibana = CxGNlkqQMbcp6u6XuCbk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password for user logstash_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD logstash_system = EOUiCyQQ97IHwUJs8Eum
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password for user beats_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD beats_system = EF8OdPmcpy1bUCgFVQ90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password for user remote_monitoring_user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD remote_monitoring_user = 3ZRBVo5Omu33McoOKgwE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password for user elastic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD elastic = ZSzN2idoU6hFa4f0ulPP
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将上面随机生成的密码保存在安全的地方备用，这些内置的超级用户权限大，一旦遗失了密码，可能会造成重大的数据泄露。&lt;/p>
&lt;p>用上面创建的账户测试第一个 ES 节点是否可以通过 https 正常访问，这里也测试 ca 公钥的可用性。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">curl --cacert /vagrant/certs/ca/ca.crt -u elastic &amp;#39;https://es1.zenlab.local:9200/_cat/nodes?v&amp;#39;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在 es1 服务器的命令行运行以上命令，输入 elastic 的密码。应该可以看到正常的输出。&lt;code>/vagrant/certs/ca/ca.crt&lt;/code> 这个路径替换成你的环境中的相关 ca 证书文件路径。&lt;/p>
&lt;h3 id="配置第二个和第三个-es-服务器节点">配置第二个和第三个 ES 服务器节点
&lt;/h3>&lt;p>剩下的两个节点在加入集群之前都已经通过初始化脚本安装完了 rpm 安装包。剩下的就是逐个节点的部署之前生产的证书文件和修改后的 elasticsearc.yml 主配置文件。在本文档参考的环境中使用如下命令。&lt;/p>
&lt;p>登录 es 2 &lt;code>vagrant ssh es2&lt;/code>&lt;/p>
&lt;p>配置 es2 的证书和秘钥文件，下面的复制原路径需要替换成你所使用的实际路径。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo mkdir /etc/elasticsearch/certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/certs/ca/ca.crt /etc/elasticsearch/certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/certs/es2/* /etc/elasticsearch/certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ls /etc/elasticsearch/certs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>部署 es2 的配置文件，然后启动这个节点的 Elasticsearch 服务。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/elasticsearch2.yml /etc/elasticsearch/elasticsearch.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start elasticsearch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>elasticsearch2.yml&lt;/code> 文件的内容如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># ---------------------------------- Cluster -----------------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">cluster.name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">elk4devops&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># ------------------------------------ Node ------------------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">node.name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">es2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># ----------------------------------- Paths ------------------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">path.data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/var/lib/elasticsearch&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">path.logs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/var/log/elasticsearch&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># ---------------------------------- Network -----------------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">network.host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">es2.zenlab.local&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># --------------------------------- Discovery ----------------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">cluster.initial_master_nodes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;es1&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">discovery.seed_hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;es1.zenlab.local&amp;#34;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># ------------------------------- TLS and Cert ---------------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.http.ssl.enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.http.ssl.key&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">certs/es2.key&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.http.ssl.certificate&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">certs/es2.crt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.http.ssl.certificate_authorities&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">certs/ca.crt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.transport.ssl.enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.transport.ssl.key&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">certs/es2.key&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.transport.ssl.certificate&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">certs/es2.crt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.transport.ssl.certificate_authorities&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">certs/ca.crt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.monitoring.collection.enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># ------------------------------- App Search ---------------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">action.auto_create_index&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;.app-search-*-logs-*,-.app-search-*,+*&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在 es2 的命令用下面的命令查看是否该节点正常加入了集群。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">curl --cacert /vagrant/certs/ca/ca.crt -u elastic &lt;span class="s1">&amp;#39;https://es1.zenlab.local:9200/_cat/nodes?v&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter host password &lt;span class="k">for&lt;/span> user &lt;span class="s1">&amp;#39;elastic&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.50.11 &lt;span class="m">37&lt;/span> &lt;span class="m">94&lt;/span> &lt;span class="m">0&lt;/span> 0.00 0.05 0.06 dilmrt * es1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.50.12 &lt;span class="m">17&lt;/span> &lt;span class="m">96&lt;/span> &lt;span class="m">9&lt;/span> 0.49 0.20 0.07 dilmrt - es2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注意上面 ca.crt 文件的路径，要输入的是 elasstic 用户的密码。 正常情况下两个节点都会出现在结果清单中。&lt;/p>
&lt;p>用相似的命令初始化和启动 es3 节点的服务。es3 的主配置文件样例如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ---------------------------------- Cluster -----------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster.name: elk4devops
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------------ Node ------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node.name: es3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ----------------------------------- Paths ------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">path.data: /var/lib/elasticsearch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">path.logs: /var/log/elasticsearch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ---------------------------------- Network -----------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network.host: es3.zenlab.local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --------------------------------- Discovery ----------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster.initial_master_nodes: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;es1&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">discovery.seed_hosts: &lt;span class="o">[&lt;/span> &lt;span class="s2">&amp;#34;es1.zenlab.local&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------- TLS and Cert ---------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.enabled: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.http.ssl.enabled: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.http.ssl.key: certs/es3.key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.http.ssl.certificate: certs/es3.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.http.ssl.certificate_authorities: certs/ca.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.transport.ssl.enabled: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.transport.ssl.key: certs/es3.key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.transport.ssl.certificate: certs/es3.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.transport.ssl.certificate_authorities: certs/ca.crt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.monitoring.collection.enabled: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------- App Search ---------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">action.auto_create_index: &lt;span class="s2">&amp;#34;.app-search-*-logs-*,-.app-search-*,+*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最终集群的测试状态如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>vagrant@es1 ~&lt;span class="o">]&lt;/span>$ curl --cacert /vagrant/certs/ca/ca.crt -u elastic &lt;span class="s1">&amp;#39;https://es1.zenlab.local:9200/_cat/nodes?v&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter host password &lt;span class="k">for&lt;/span> user &lt;span class="s1">&amp;#39;elastic&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.50.11 &lt;span class="m">20&lt;/span> &lt;span class="m">96&lt;/span> &lt;span class="m">6&lt;/span> 0.18 0.09 0.03 dilmrt * es1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.50.13 &lt;span class="m">50&lt;/span> &lt;span class="m">96&lt;/span> &lt;span class="m">2&lt;/span> 0.02 0.07 0.03 dilmrt - es3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.50.12 &lt;span class="m">25&lt;/span> &lt;span class="m">96&lt;/span> &lt;span class="m">1&lt;/span> 0.00 0.02 0.00 dilmrt - es2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="配置-kibana-服务器">配置 Kibana 服务器
&lt;/h2>&lt;p>服务是必要的的管理界面，是数据搜索、可视化的重要工具。在 Elasticsearch 服务打开了外部 https 加密访问的情况下，Kibana 服务器的安装和配置也需要做如下调整。&lt;/p>
&lt;p>Kibana 的 rpm 安装这里省略。下面直接进入相关的主要配置步骤。&lt;/p>
&lt;p>复制用于链接 ES 集群的证书&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo mkdir /etc/kibana/certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/certs/ca/ca.crt /etc/kibana/certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/certs/lk/* /etc/kibana/certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ls /etc/kibana/certs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改默认的 kibana.yml 配置文件，然后覆盖默认的配置文件后启动 kibana 服务。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/kibna.yml /etc/kibana/kibana.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cat /etc/kibana/kibana.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start kibana
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>监控 kibana 的启动日志，直到它正常启动。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">tail&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">messages&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>启动后，使用浏览器访问 &lt;code>https://lk.zenlab.lcoal:5601&lt;/code> Kibana 服务，使用 elastic 用户的密码登录，确保 Kibana 正常启动。&lt;/p>
&lt;h2 id="配置权限-beats-账号">配置权限 Beats 账号
&lt;/h2>&lt;p>在使用 Beats 采集监控数据的时候，Beats 的配置文件中需要配置一个后台 Elasticsearch 服务访问账号，安全起见需求需要将这个账号配置为只写权限。配置步骤如下。&lt;/p>
&lt;p>在 Kibana 的用户管理中创建名为 &lt;code>beats-writer&lt;/code> 的角色，如下图所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/writer-role.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>以上这个角色拥有 filebeat 和 Metricbeat 两个索引的访问权限，这里是为了评估用户角色管理的工作量，否则可以每个索引单独设置一套必要权限的角色和用户，从而实现更安全的防护。&lt;/p>
&lt;p>然后创建名为 &lt;code>beats-writer&lt;/code> 的用户，设置一个密码，将它赋予 &lt;code>beats-writer&lt;/code> 的角色（上面创建的）。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/beats-writer-user.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>这样它就可以用于所有 Beats 节点的配置了。&lt;/p>
&lt;h2 id="初始化首个-beats-节点">初始化首个 Beats 节点
&lt;/h2>&lt;p>在 vagrant 测试环境中启动第一个用于测试 Beats 的节点。&lt;/p>
&lt;p>&lt;code>vagrant up node1&lt;/code>&lt;/p>
&lt;p>这里使用了初始脚本安装相关的 rpm 安装包。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="c1"># author: Martin Liu&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># url:martinliu.cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">elastic_version&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;7.8.0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Installing a Filebeat &amp;#34;&lt;/span>&lt;span class="nv">$elastic_version&lt;/span>&lt;span class="s2">&amp;#34; agent...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rpm -ivh /vagrant/rpm/filebeat-&lt;span class="nv">$elastic_version&lt;/span>-x86_64.rpm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> filebeat.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rpm -ivh /vagrant/rpm/metricbeat-&lt;span class="nv">$elastic_version&lt;/span>-x86_64.rpm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> metricbeat.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rpm -ivh /vagrant/rpm/auditbeat-&lt;span class="nv">$elastic_version&lt;/span>-x86_64.rpm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> auditbeat.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>登录该节点进行 Beats 的初始化配置。目前 Elasticsearch 集群还是空白的，还没有初始化任何 Beats 相关的索引、可视化和仪表板。这个初始化工作是通过，每种 Beats 的 setup 命令完成的。这个 setup 命令只需要在一个节点上成功执行一次即可，其它节点的配置文件中，连 setup 命令相关的配置都不需要。&lt;/p>
&lt;p>这里使用的 filebeat.yml 参考文件如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#=========================== Filebeat inputs =============================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">filebeat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">inputs&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">paths&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#============================= Filebeat modules ===============================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">filebeat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">period&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#==================== Elasticsearch template setting ==========================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">setup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">template&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">settings&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">index&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">number_of_shards&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">index&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">codec&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">best_compression&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#============================== Kibana =====================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">setup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">kibana&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;https://lk.zenlab.local:5601&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-------------------------- Elasticsearch output ------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hosts&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;es1.zenlab.local:9200&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;elastic&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1l1lqVMMWMbLI6DCH0dQ&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">protocol&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#================================ Processors =====================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">processors&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_host_metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">netinfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cache&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">geo&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">bj&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">location&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">35.5528&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">116.2360&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">continent_name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Asia&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">country_iso_code&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">CN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">region_name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Beijing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">region_iso_code&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">CN&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">BJ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">city_name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Beijing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_cloud_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_docker_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_kubernetes_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>目前的计划是配置 Beats 直接访问 Elasticsearch 后台服务，不通过 Logstash 中转。以后增加这个参考配置。&lt;/p>
&lt;p>在执行 filebeat setup 命令之前，还需要在 Beats 节点上部署上面生成的 ca 公钥文件。参考命令如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo update-ca-trust enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/certs/ca/ca.crt /etc/pki/ca-trust/source/anchors/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo update-ca-trust extract
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里把 ca.crt 公钥文件部署到了 CentOS 操作系统的的可信 CA 发放机构的目录中，其它操作系统中的这个证书路径可能不同，需要做替换，包括以上的证书更新命令也可能需要调整。&lt;/p>
&lt;p>经过以上的配置之后，用之前的 curl 命令测试一下是否这个证书生效了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>vagrant@es1 ~&lt;span class="o">]&lt;/span>$ curl -u elastic &lt;span class="s1">&amp;#39;https://es1.zenlab.local:9200/_cat/nodes?v&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter host password &lt;span class="k">for&lt;/span> user &lt;span class="s1">&amp;#39;elastic&amp;#39;&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.50.11 &lt;span class="m">20&lt;/span> &lt;span class="m">96&lt;/span> &lt;span class="m">6&lt;/span> 0.18 0.09 0.03 dilmrt * es1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.50.13 &lt;span class="m">50&lt;/span> &lt;span class="m">96&lt;/span> &lt;span class="m">2&lt;/span> 0.02 0.07 0.03 dilmrt - es3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.50.12 &lt;span class="m">25&lt;/span> &lt;span class="m">96&lt;/span> &lt;span class="m">1&lt;/span> 0.00 0.02 0.00 dilmrt - es2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这次在参数中故意省略了 ca 证书文件路径，如果 curl 可以正常访问，那么 Beats 程序也可以，而且不需要在 Beats 配置文件中生命公钥的路径，更有利于在以后切换到另外一套 CA 秘钥后，配置文件的更新工作。&lt;/p>
&lt;p>这里省略 Beats 配置文件的展示，参考一下命令做初始化前的准备。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo cp -f /vagrant/filebeat.yml /etc/filebeat/filebeat.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp -f /vagrant/metricbeat.yml /etc/metricbeat/metricbeat.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo filebeat modules enable system
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>为了测试的方便起见，在 filebeat.yml 和 metricbeat.yml 文件中使用了超级用户 elastic ，如果这个动作伴随着 Elastic Stack 的版本升级需要经常发生，此处需要配置一个 Beats setup 用的专用角色和账户，从而避免多次使用超级用户。&lt;/p>
&lt;p>下面运行 setup 命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">filebeat setup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metricbeat setup
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这两个命令正常运行后，在 Kibana 里会增加增加相关的索引、pipeline、可视化和仪表板等对象。&lt;/p>
&lt;p>使用下面的命令测试 filebeat 和 metricbeat 是否能正常的采集数据并传输到后台。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">filebeat -e
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metricbeat -e
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果报错的话，将 level 在配置文件中设置为 debug，方便调试。调试成功之后，应该在 Kibana 的界面中，可以看到 node1 节点，点击后能看到实时更新过来的日志和监控指标。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/metric-node1.jpeg"
loading="lazy"
>&lt;/p>
&lt;h2 id="在新的节点上部署-beats">在新的节点上部署 Beats
&lt;/h2>&lt;p>在新的需要部署 Beats 的节点上，可以使用下面的脚本配置和部署。&lt;/p>
&lt;p>add-agent.sh&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="c1"># author: Martin Liu&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># url:martinliu.cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">elastic_version&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;7.8.0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">b_user&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;beats-writer&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">b_pwd&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;DevOps1234&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;############## Installing a Beats &amp;#34;&lt;/span>&lt;span class="nv">$elastic_version&lt;/span>&lt;span class="s2">&amp;#34; agent...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rpm -ivh /vagrant/rpm/filebeat-&lt;span class="nv">$elastic_version&lt;/span>-x86_64.rpm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> filebeat.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo filebeat modules &lt;span class="nb">enable&lt;/span> system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rpm -ivh /vagrant/rpm/metricbeat-&lt;span class="nv">$elastic_version&lt;/span>-x86_64.rpm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> metricbeat.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;################### Setup Public CA...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo update-ca-trust &lt;span class="nb">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/certs/ca/ca.crt /etc/pki/ca-trust/source/anchors/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo update-ca-trust extract
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;################### Update Beats configuration files ...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp -f /vagrant/filebeat-v1.yml /etc/filebeat/filebeat.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp -f /vagrant/metricbeat-v1.yml /etc/metricbeat/metricbeat.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;################### Setup Keystor for Beats ...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$b_user&lt;/span> &lt;span class="p">|&lt;/span> sudo filebeat keystore add BEATS_WRITER_USERNAME --stdin --force
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$b_pwd&lt;/span> &lt;span class="p">|&lt;/span> sudo filebeat keystore add BEATS_WRITER_PW --stdin --force
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$b_user&lt;/span> &lt;span class="p">|&lt;/span> sudo metricbeat keystore add BEATS_WRITER_USERNAME --stdin --force
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="nv">$b_pwd&lt;/span> &lt;span class="p">|&lt;/span> sudo metricbeat keystore add BEATS_WRITER_PW --stdin --force
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;################### Start Beats services ...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start metricbeat.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start filebeat.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>简单说明以上脚本的功能：&lt;/p>
&lt;ul>
&lt;li>用 rpm 安装包安装所需要的 Beats，filebeat 开启 system 模块。&lt;/li>
&lt;li>在目标操作系统里部署必须的 ca 证书到默认路径中，并启用。从而省略在所有 beats 文件中生命公钥文件的路径。&lt;/li>
&lt;li>覆盖更新默认的 Beats 配置文件。&lt;/li>
&lt;li>创建并初始化 Beats 配置文件中所需要的 beats-writer 用户名和密码。从而消除消除所有明文密码。以上脚本只需要在节点上更新的时候才允许，允许后删除，从而不会留下任何明文密码和账户信息。Beats 的任何模块配置中，如果需要配置任何密码账户也需要如法炮制，从而保证基本的安全性。&lt;/li>
&lt;li>启动 Beats 服务&lt;/li>
&lt;/ul>
&lt;p>以上脚本所使用的配置文件文件如下。&lt;/p>
&lt;p>filebeat-v1.yml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">filebeat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">inputs&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">paths&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#============================= Filebeat modules ===============================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">filebeat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">period&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">60&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-------------------------- Elasticsearch output ------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hosts&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;es1.zenlab.local:9200&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;es2.zenlab.local:9200&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;es3.zenlab.local:9200&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">BEATS_WRITER_PW&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">BEATS_WRITER_USERNAME&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">protocol&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#================================ Processors =====================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">processors&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_host_metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">netinfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cache&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">geo&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">bj&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">location&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">35.5528&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">116.2360&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">continent_name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Asia&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">country_iso_code&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">CN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">region_name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Beijing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">region_iso_code&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">CN&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">BJ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">city_name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Beijing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_cloud_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_docker_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_kubernetes_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_fields&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">target&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fields&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;Elastic Cloud&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;ec-ww&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#==================== Best Practice Configuration ==========================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">setup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ilm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">check_exists&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">level&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">error&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">queue&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">spool&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>metricbeat.yml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># =========================== Modules configuration ============================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">metricbeat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">period&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">120&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-------------------------- Elasticsearch output ------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hosts&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;es1.zenlab.local:9200&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;es2.zenlab.local:9200&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;es3.zenlab.local:9200&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">BEATS_WRITER_PW&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">BEATS_WRITER_USERNAME&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">protocol&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#================================ Processors =====================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">processors&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_host_metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">netinfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cache&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">geo&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">bj&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">01&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">location&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">35.5528&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">116.2360&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">continent_name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Asia&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">country_iso_code&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">CN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">region_name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Beijing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">region_iso_code&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">CN&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">BJ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">city_name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Beijing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_cloud_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_docker_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_kubernetes_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_fields&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">target&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fields&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;Elastic Cloud&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;ec-ww&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#==================== Best Practice Configuration ==========================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">setup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ilm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">check_exists&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">level&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">error&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">queue&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">spool&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>解释一下相关的重要配置。&lt;/p>
&lt;ul>
&lt;li>netinfo.enabled: true 收集所有网卡的配置信息，覆盖多块网卡的情况&lt;/li>
&lt;li>geo: 地理位置信息对以后基于位置的查询打下基础，这对于监控和信息安全都非常重要。为以后基于 host 的上下文关联打下基础，方便在 apm、log、metric、heartbeat 和机器学习的界面中相互跳转。&lt;/li>
&lt;li>add_fields: 在 fields 下面维护 ECS 数据定义中的必要的有意义的数据，在网上查询 ECS 的数据定义，这些字段可以优化以后的搜索逻辑。&lt;/li>
&lt;li>最后一段是其它必要的最佳实践设置&lt;/li>
&lt;li>output.elasticsearch : 这里使用了三个 ES 节点的链接地址，这里应该使用至少 2 个 Elasticsearch 集群中的 ingest 节点。&lt;/li>
&lt;/ul>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>本文没有展开说明和配置的地方包括：对 Best 节点的工作状态的监控；对索引生命周期规则的调优（用尽磁盘），冷热数据的自动化迁移规则。&lt;/p>
&lt;p>完成的配置包括：&lt;/p>
&lt;ul>
&lt;li>配置 ES 3 节点集群内部的 TLS 加密传输，对外的 HTTPS 加密协议服务&lt;/li>
&lt;li>Kibana 基于证书的 SSL 加密配置&lt;/li>
&lt;li>Beats 的高可靠性后台传输数据，TLS加密传输数据&lt;/li>
&lt;li>用基于角色的访问控制，创建了只写权限的 beats-writer 角色和用户。&lt;/li>
&lt;li>用 beats 的 keystore 将配置文件中的明文密码消除。&lt;/li>
&lt;/ul></description></item><item><title>徘徊在 3 种 DevOps 平台服务之间难以抉择（上）</title><link>https://martinliu.cn/blog/a-comparison-of-devops-tools-p1/</link><pubDate>Sun, 21 Jun 2020 18:42:56 +0800</pubDate><guid>https://martinliu.cn/blog/a-comparison-of-devops-tools-p1/</guid><description>&lt;p>中国 DevOps 社区在最近两年期间得到了长足的发展，从最初的单一官网站点，发展到现在的社区官网、社区峰会官网、社区论坛、社区微信公众号和社区服务号等多种对外公众界面。在这些网站平台之后的是 20 多位社区志愿者们的辛勤工作和贡献。&lt;/p>
&lt;p>社区官网最初是在 GitHub 上通过 Github-page 的免费空间发布的，在购买了收费的 Hugo 模板之后；网站的代码有了转为私有仓库的需求，因此CODING就从 GitHub 迁移到了 GitLab；当时 Github 还没有免费不限数量的私有仓库，而且 Github 也不能免费实现 20+ 社区代码贡献者的组队维护多个项目。GitLab 总的来说能满足目前的所有社区开发和协作需求：这些需求包括无限私有仓库，足够数量的代码协作人员，免费的 CI 构建和发布功能。GitLab 平台也可以实现 GitLab-page 的静态网站托管服务，但是，如果代码仓库设置为通过 page 实现静态网站发布的情况，需要整个代码库设置为对外公开访问，而这与代码库本身依然需要保持私密矛盾。因此社区的小伙伴也无奈的在 GitLab 上维护代码，然后将 hugo 构建后的结果再发布到 Github-page 的项目去。&lt;/p>
&lt;p>根据以上社区网站代码库迁移的经历，下面总结一下中国 DevOps 社区在网站开发维护和配套 CI/CD 方面的总体需求：&lt;/p>
&lt;ul>
&lt;li>实现多人（20+志愿者）私有和共有代码仓库的协作，相关工作包括社区网站内容维护和新功能开发，社区书籍和技术白皮书协作翻译等。&lt;/li>
&lt;li>实现 OKR 风格的社区网站开发相关工作管理，季度目标制定，任务跟踪等。&lt;/li>
&lt;li>实现 Scrum 风格的软件项目计划、分配和跟踪；统一规划开发和运维相关的所有任务；与季度 OKR 相关联。&lt;/li>
&lt;li>实现自动化的 CI、CD 流水线。&lt;/li>
&lt;li>自动化和快速的部署软件项目工件（Artifacts）到腾讯云服务器（和其它相关服务），包括静态网页到 Nginx 服务器的发布，到云存储的发布，目前也可能即将会用到 K8s 服务/Serverless 服务的发布。&lt;/li>
&lt;/ul>
&lt;p>基于目前社区的相关工作需求，我们在三个平台之间进行了综合的对比和评测：GitLab（免费版）、Jira Cloud（免费版） 和 CODING - 高级版（腾讯云 DevOps 平台服务）。总的来说我们需要一种能满足以上所有需求的、集成化的 DevOps 工具 SaaS 平台服务。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/atlassian-marketplace.png"
loading="lazy"
alt="DevOps持续循环"
>&lt;/p>
&lt;p>在开始 DevOps 平台选项之前，值得再次研究一下上面这幅图。重申一下，这幅图表达了两个意思：&lt;/p>
&lt;ol>
&lt;li>DevOps 是持续不断的循环，并不是单向的多少次重复的流程。理想情况下一次循环对应着敏捷开发的一个迭代，每个迭代 done 的定义并不是编码完成就结束了，还包括后面的测试和运维的所有工作，应该管理到从开发到上线过程中的所有工作。本次迭代的结果可以作为下一个迭代的输入之一。&lt;/li>
&lt;li>DevOps 工具平台需要支持的每一次循环中包括的阶段有：计划、构建、持续集成、部署、运维、持续反馈（监控）；如果某个阶段无法直接实现，用其他独立工具实现也不是不可以，例如持续监控阶段（但是监控的状态必须实时透明的反馈给DevOps循环中的所有人）。&lt;/li>
&lt;/ol>
&lt;p>下面我们分阶段的描述以上三个 DevOps 工具平台的实际结果，每个阶段中会提出不同的功能需求点，然后横向比对三个工具的优缺点。声明这里是基于中国 DevOps 社区的实际需求做出的工具平台的需求使用体验调研，这些调研结果决定了最后平台选择的决定。&lt;/p>
&lt;h2 id="计划---plan">计划 - Plan
&lt;/h2>&lt;p>&lt;strong>OKR 管理 ：&lt;/strong> &amp;ndash; 传统的社区项目规划往往是技术导向，或者比较就事论事的安排某些开发和维护工作。而中国 DevOps 社区更希望能应用高于项目本身一个层级的 OKR 概念来统筹所有项目的工作。需要用一个顶级目标对应多个KR，每个 KR 能关联到不同项目中的各种工作，也需要能跟踪孤立的 KR。&lt;/p>
&lt;ul>
&lt;li>GitLab ：在 Gitlab 官方文档和网上并没有查到的 OKR 的实现方式。&lt;/li>
&lt;li>Jira Cloud：默认云服务没有 OKR 的功能，不过可以通过两种方式实现：安装第三方 App，使用 Structure 功能扩展实现。实际测试了一个名为 OKR for Jira （by Digital Toucan）的 App；能满足需求。在 OKR 关联界面中可以关联项目 issue，在 issue 的界面里也可以关联 KR；实现双向关联和跟踪。&lt;/li>
&lt;li>CODING：在团队管理页面的‘团队目标’功能里有内置的 OKR 管理功能。功能性完全满足社区需求。可以在一个平面的可折叠页面中管理大量的 OKR 条目。O 的完成进度可以根据 KR 的进展自动计算，KR 的完成度可以手工拖到，也可以根据所连接的项目状态自动计算，所有条目的排序可以自由拖动。操作简洁方便。在项目工作的界面里不能关联到 OKR。&lt;/li>
&lt;/ul>
&lt;p>下图是 OKR for Jira 免费 app 的截图：
&lt;img src="https://martinliu.cn/images/CODING-jira-okr.jpeg"
loading="lazy"
alt="OKR for Jira 免费 app "
>&lt;/p>
&lt;p>下面是 CODING 中管理 OKR 的界面截图。
&lt;img src="https://martinliu.cn/images/CODING-okr.jpeg"
loading="lazy"
alt="CODING ork"
>&lt;/p>
&lt;p>&lt;strong>项目规划/协同 ：&lt;/strong> &amp;ndash; 社区网站相关工作需要在每一个项目的执行过程中实现需求分析、工作分解、工作分配和进度追踪等功能。并不需要实现高级的企业产品路线图和Eprics的管理，由于并不开发复杂的商业产品，至少目前工作的复杂度没有这个需求。&lt;/p>
&lt;ul>
&lt;li>GitLab：项目管理功能齐全，而且包含可定制的看板功能（Scum board / Kanban board），里程碑和 Todos 也是比较特色的功能。具备Issue 状态和代码PR 自动化的关联。&lt;/li>
&lt;li>Jira Cloud：默认项目管理丰富，Issue 的默认查看视图有多种方式支持各种看板。Issue 的查看、编辑和相关操作非常符合开发者视角的思路，可以从 Issue 上一键式的创建分支，并且看到分支代码提交、构建和部署的各种状态。&lt;/li>
&lt;li>CODING：支持项目中的 Backlog 规划，管理迭代、Epric、需求、任务和缺陷。它可以很方便的定制每一种工作的状态和工作流，特别符合国人默认流程定制的需求。支持项目中的模块管理。操作比较简洁直观可用。一个项目中可以容纳和管理多个代码库。&lt;/li>
&lt;/ul>
&lt;p>下面是 CODING 中管理项目协同中的任务管理，虽然没有看板展示的模式，不过用拖拽的方式可以方便的对 Backlog 中的工作条目做迭代规划，点击每个工作条目都可以对其进行编辑修改。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/CODING-plan.jpeg"
loading="lazy"
alt="CODING plan"
>&lt;/p>
&lt;h2 id="构建---build">构建 - Build
&lt;/h2>&lt;p>&lt;strong>代码托管 ：&lt;/strong> 社区需要使用 Git 代码仓库管理各种网站和应用的代码开发，包括markdown 格式的网站内容更新，主要是用基于主干的开发，或者部分功能分支的方式。&lt;/p>
&lt;ul>
&lt;li>GitLab：功能强大和丰富的代码仓库管理，支持丰富的合并请求（MR）策略。&lt;/li>
&lt;li>Jira Cloud：通过 bitbucket 实现代码仓库管理。从源码到提交、分支、PR 等等都可以关联和跳转。&lt;/li>
&lt;li>CODING：虽然不是老牌的 Git 仓库工具，它可以支持 git 和 SVN 仓库。能满足代码的提交、分支、合并请求、版本、对比等功能。功能完全满足需求。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>云端开发工具 ：&lt;/strong> 如果开发者在不能访问自己的工作电脑的情况下，还是需要可以访问到一个功能齐全的线上代码编辑环境。确保社区参与者能够容易的参与相关开发工作。&lt;/p>
&lt;ul>
&lt;li>GitLab：代码库中的每个文件都可以通过 Web IDE 功能打开，能实现代码的语法检查、提交变化提示、Markdonwn 编辑/预览等功能。具备一定的可用性。&lt;/li>
&lt;li>Jira Cloud：在 bitbucket 中选取文件点击编辑后，能进入一个基本的文本文件编辑模式。无其他高级功能，很难胜任稍微复杂一些的程序代码变更。&lt;/li>
&lt;li>CODING：代码库中的代码文件可以支持在线的编辑，具有一定的语法加亮和变更对比功能，能提供基础的线上开发能力。同时还提供了全功能的线上 IDE 环境 &lt;a class="link" href="https://cloudstudio.net/%ef%bc%8c%e8%bf%99%e4%b8%aa%e5%8a%9f%e8%83%bd%e5%be%88%e7%b1%bb%e4%bc%bc%e4%ba%8e%e4%b8%80%e4%b8%aa%e7%ba%bf%e4%b8%8a%e7%89%88%e6%9c%ac%e7%9a%84" target="_blank" rel="noopener"
>https://cloudstudio.net/，这个功能很类似于一个线上版本的&lt;/a> vs code，它可以拉取 git 仓库地址，并在与之的多种语言环境中开展代码开发工作。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>代码检查 ：&lt;/strong> 在尽可能的提供代码质量扫码、评估和反馈会对每个社区开发者的工作质量提供帮助，需要帮助社区小伙伴们开发出高质量和安全的社区网站代码。&lt;/p>
&lt;ul>
&lt;li>GitLab：可以集成第三方的代码扫码服务，在 CI 的过程中调用第三方服务实现。&lt;/li>
&lt;li>Jira Cloud：同上。&lt;/li>
&lt;li>CODING：内置了一套简洁的代码扫描功能，可以针对不同的开发语言定制各种代码扫描方案，实现代码检查、质量评估、路径过滤等功能。扫描结果可以生成在总体概览视图报表和任务管理清单。&lt;/li>
&lt;/ul>
&lt;p>下图是一个代码扫描方案编辑示例。
&lt;img src="https://martinliu.cn/images/CODING-scan.jpeg"
loading="lazy"
alt="CODING plan"
>&lt;/p>
&lt;p>&lt;strong>私有制品库/镜像仓库 ：&lt;/strong> 随着后期复杂社区项目的开发，以及容器化和微服务化的趋势。需要使用轻量的解决方案予以满足。&lt;/p>
&lt;ul>
&lt;li>GitLab：为每个项目提供包管理（支持通用、Conan、Maven，NPM、NuGet、PyPi）和 Docker 镜像仓库。满足在一个内的制品管理。&lt;/li>
&lt;li>Jira Cloud：需要集成第三方的服务实现。&lt;/li>
&lt;li>CODING：为每个项目提供了各种类型的制品仓库，包括：Generic、Docker, Maven, NPM, PyPi, Helm, Composer, NuGet, Conan。可以设置项目内、团队内和公开的访问范围权限。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>编译构建 ：&lt;/strong> 需要提供自动化的编译构建能力，通过自动化的 CI 流水线给开发者快速的反馈，提供友好的 DevOps 流水线构建和修订界面。平台提供免费的构建算力，能够按需要自行接入构建节点和 K8S 环境。&lt;/p>
&lt;ul>
&lt;li>GitLab：提供基于 gitlab-ci.yml 文件的 Pipeline as Code 的流水线管理模式。无流水线的图形编辑界面。可以通过部署 Runner 的方式扩展构建环境到外部的服务器上，或者 k8s 的环境中。&lt;/li>
&lt;li>Jira Cloud：在 Bitbucket 中提供基于 bitbucket-pipelines.yml 文件的 Pipeline as Code 的流水线管理模式。无流水线的图形编辑界面。这个流水线的后台应该是一个共享的基于 Bamboo 的SaaS 服务，还没有发现扩展这个部署环境的方法。&lt;/li>
&lt;li>CODING：提供基于 Jenkins 的 CI 服务。也就是说 CODING 服务用套娃的方式包装了 Jenkins 服务，通过共享的构建服务提供基础的构建算力，如果需要的话也可以和 GitLab 一样扩展到外部的构建服务器或者 K8s 服务集群。这里 CODING 还提供了 构建服务到腾讯云的相关服务的集成。因此它能提供 Jenkins+ 的服务能力，对于 Jenkins 服务的构建能力这里就不在赘述。由于 Jenkins 流水线技术比较普及。社区的同学用了半天的时间实现了社区官网构建发布流水线的调试。将基于 Hugo 的网站构建结果用 ssh 命令的方式发布到腾讯云里的 Nginx 服务器的目录中。&lt;/li>
&lt;/ul>
&lt;p>下图是在图形流水线编辑器中对标准模板的调试，这里简单的实现了构建和打包的过程，在部署的步骤里，通过远程 ssh 的命令实现了对网站发布包到腾讯云虚拟机的部署。
&lt;img src="https://martinliu.cn/images/CODING-pipeline.jpeg"
loading="lazy"
alt="CODING plan"
>&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>以上是中国 DevOps 社区对 DevOps 工具平台服务的选型测试过程的一部分总结，这里仅仅从社区的实际工作需求出发，通过试用对比的方式探索了几种平台。总的来说腾讯的 CODING 平台使用体验要好于其它两个服务。具体说有以下几个方面：&lt;/p>
&lt;ul>
&lt;li>CODING 的页面访问速度非常快，由于是相对比较年轻的产品，目前它比起 Jira 和 GitLab 还处于婴儿期；因此这种够用就好的阶段也降低了对复杂高级产品的认知难度。通过 git 命令下载和提交代码的速度非常快。&lt;/li>
&lt;li>OKR 的管理功能具备够用的可用性。&lt;/li>
&lt;li>流水线功能同支持图形的流水线编辑和自控制的 Jenkins 文件。如果已经具备了一定的 Jenkins 能力，你就能快速上手开始构建和部署项目了。这个界面整合良好的套娃服务其实还具备了一定的可迁移性。&lt;/li>
&lt;li>与腾讯云服务的良好互访问性。如果已经使用了腾讯云的服务，那么 CODING 的部署流水线将对其非常友好，易于衔接已有资源。&lt;/li>
&lt;/ul>
&lt;p>后续还将按需测试和对比 DevOps 循环中的其它阶段。如果你也感兴趣参与中国 DevOps 社区的相关志愿者开发工作，请随时和我联系。也希望对此感兴趣的小伙伴能报名参与我们的这种主题评测活动。&lt;/p></description></item><item><title>入门 Elastic Workplace Search</title><link>https://martinliu.cn/blog/getting-start-elastic-workplace-search/</link><pubDate>Fri, 24 Apr 2020 10:37:16 +0800</pubDate><guid>https://martinliu.cn/blog/getting-start-elastic-workplace-search/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-1.jpg" alt="Featured image of post 入门 Elastic Workplace Search" />&lt;h2 id="简介">简介
&lt;/h2>&lt;p>Elastic Workplace Search 提供了一个统一的搜索体验，从而便于任何人在任何时间找到所需的文档信息。为企业搭建了一个横跨所有工作内容、所有团队和真相的统一搜索参考平台。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/Picture1.jpg"
loading="lazy"
>&lt;/p>
&lt;p>这个搜索平台能够对接各种数据源，并且实现文档内容级别的索引，目前所支持的数据源包括：OneDrive、SharePoint、ServiceNow、Box、Dropbox、Github、Github Enterprise、Google Drive、JIRA、Confluence、Salesforce、Zendesk 等。&lt;/p>
&lt;p>它具有以下特点：&lt;/p>
&lt;ul>
&lt;li>配置部署简单，缩短了系统上线和等待时间。不像是传统的消耗数个月甚至一年都无法完成的搜索项目，这个解决方案可以让企业在几天或几周内就能投入使用。&lt;/li>
&lt;li>个性化定制的搜索体验。通过 Elasticsearch 所提供的搜索能力，管理员可以控制企业、团队级别的数据源，个体用户可以控制自己的私有数据源，所有级别上都可以调整相关度权重，从而提高搜索结果的准确性和实用性&lt;/li>
&lt;li>提供各种自然语言的和关键字的搜索。系统提供了强大的语言分析和关键字检测能力，用户可以使用任意关键字和搜索开关轻松的搜索到所需的信息。&lt;/li>
&lt;li>具备丰富的开箱即用功能：无须开发即可实现用户管理、数据源管理、基于用户和组的数据源可见性设置、数据源对不同用户和组的权重等功能。&lt;/li>
&lt;/ul>
&lt;h2 id="系统安装配置">系统安装配置
&lt;/h2>&lt;p>本文的假设，文中所使用的安装包和需要部署的配置文件都在 /vagrant 这个目录下面。下面的所有命令中都假设从这个目录里选用和复制。配置文件见代码库：&lt;a class="link" href="https://github.com/martinliu/elastic-labs" target="_blank" rel="noopener"
>https://github.com/martinliu/elastic-labs&lt;/a>&lt;/p>
&lt;p>本文所使用的安装测试环境是：&lt;/p>
&lt;ul>
&lt;li>CentOS Server 8&lt;/li>
&lt;li>JDK 11&lt;/li>
&lt;li>Elasticsearch 7.6.1&lt;/li>
&lt;li>Kibana 7.6.1&lt;/li>
&lt;li>Elastic Workplace Search 7.6.1&lt;/li>
&lt;/ul>
&lt;p>下面使用 &lt;code>vagrant up&lt;/code> 一键式拉起基础测试环境的说明，请参考之前的文章。本测试所使用的基础 ES 安装脚本如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="n">I&lt;/span> &lt;span class="n">am&lt;/span> &lt;span class="n">provisioning&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">Elasticsearch&lt;/span> &lt;span class="n">Server&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">date&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">vagrant_provisioned_at&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">swapoff&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">sysctl&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">w&lt;/span> &lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">max_map_count&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">262144&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sysctl&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">sh&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="s2">&amp;#34;echo &amp;#39;elasticsearch - nofile 65535&amp;#39; &amp;gt;&amp;gt; /etc/security/limits.conf&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">sh&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="s2">&amp;#34;echo &amp;#39;**** -- -- -- -- -- -- -- -- ****&amp;#39; &amp;gt; /etc/motd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">sh&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="s2">&amp;#34;echo &amp;#39;**** Welcome to Elastic Stack Labs&amp;#39; &amp;gt;&amp;gt; /etc/motd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">sh&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="s2">&amp;#34;echo &amp;#39;**** -- -- -- -- -- -- -- -- ****&amp;#39; &amp;gt;&amp;gt; /etc/motd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">sh&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="s2">&amp;#34;echo &amp;#39;*&amp;#39; &amp;gt;&amp;gt; /etc/motd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">rpm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">ivh&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rpm&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">7.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">x86_64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rpm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">certutil&lt;/span> &lt;span class="n">cert&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">out&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elastic&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">certificates&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">p12&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="k">pass&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">chmod&lt;/span> &lt;span class="mi">660&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elastic&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">certificates&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">p12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">cp&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yml&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">daemon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">status&lt;/span> &lt;span class="n">elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">setup&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">passwords&lt;/span> &lt;span class="n">auto&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="n">Provisioning&lt;/span> &lt;span class="n">script&lt;/span> &lt;span class="n">works&lt;/span> &lt;span class="n">good&lt;/span>&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">echo&lt;/span> &lt;span class="n">Please&lt;/span> &lt;span class="n">go&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.10&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9200&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="n">using&lt;/span> &lt;span class="n">above&lt;/span> &lt;span class="n">passwords&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这段脚本配合 vagrant 的 provision 功能使用，它本来就是一段 shell 脚本，可以可以独立执行，它的输出结果如下。&lt;/p>
&lt;p>使用 vagrant up 命令拉起了测试虚拟机之后，在屏幕的输出信息中复制出 elastic 用户的密码。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> master1: Changed password for user apm_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> master1: PASSWORD apm_system = XAZnaek3wm0GxN3OHwhP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> master1: Changed password for user kibana
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> master1: PASSWORD kibana = sUg8OaYqh4f55GzoYApk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> master1: Changed password for user logstash_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> master1: PASSWORD logstash_system = RLthIQOH3aOFLVKqaTMu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> master1: Changed password for user beats_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> master1: PASSWORD beats_system = 73yH90G3hvrzYgVDnG3y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> master1: Changed password for user remote_monitoring_user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> master1: PASSWORD remote_monitoring_user = Sk9J77H9QFPsOZtVQJld
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> master1: Changed password for user elastic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> master1: PASSWORD elastic = OeR3gADZ1Fw1cgc90pwE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>本示例使用了 &lt;code>elasticsearc-native&lt;/code> 的用户认证模式。 为了方便起见，安装了 Kibana 7.6.1 ，过程此处忽略；在 Kibana 的用户管理中创建如下用户：&lt;/p>
&lt;ul>
&lt;li>sales1 、 sales2&lt;/li>
&lt;li>dev1 、 dev2&lt;/li>
&lt;/ul>
&lt;p>示例如下图所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-22_09-15-47.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>这些是测试用户，用于 Elastic Workplace Search 的测试中。&lt;/p>
&lt;h2 id="安装-elastic-enterprise-search">安装 Elastic Enterprise Search
&lt;/h2>&lt;p>Elastic Enterprise Search 需要 JDK 8 或者 JDK 11， 本实例安装了 Oracle JDK 11。&lt;/p>
&lt;p>&lt;code>sudo rpm -ivh /vagrant/rpm/jdk-11.0.6_linux-x64_bin.rpm&lt;/code>&lt;/p>
&lt;p>复制 Enterprise Search 的安装包到 &lt;code>/opt&lt;/code> 目录下，解压缩这个安装包。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/rpm/enterprise-search-7.6.0.tar.gz.tar /opt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cd /opt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo tar zxvf /opt/enterprise-search-7.6.0.tar.gz.tar
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在 Enterprise Search 的配置文件中加入 &lt;code>elastic&lt;/code> 用户的密码等配置信息。并且将配置文件部署到测试服务器中。本实例的配置文件 &lt;code>enterprise-search.yml&lt;/code> 内容如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">elasticsearch.username: elastic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">elasticsearch.password: eZhp0h2ZTPKchlxxwwex
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">elasticsearch.host: http://192.168.50.10:9200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">allow_es_settings_modification: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ent_search.auth.source: elasticsearch-native
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ent_search.external_url: http://192.168.50.10:3002
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ent_search.listen_host: 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ent_search.listen_port: 3002
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将以上目标配置文件复制到 Elastic Workplace Search 的配置文件目录中，覆盖默认配置文件。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/enterprise-search/enterprise-search.yml /opt/enterprise-search-7.6.0/config/enterprise-search.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>启动 Enterprise Search 服务器，并且设置默认的管理员密码。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo ENT_SEARCH_DEFAULT_PASSWORD=martin1demo /opt/enterprise-search-7.6.0/bin/enterprise-search
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在启动的过程中，关注一下的屏幕输出信息，则表示一切正常。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">*** Default user credentials have been setup. These are only printed once, so please ensure they are recorded. ***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: enterprise_search
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: martin1demo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No secret management encryption keys were provided.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your secrets will be stored unencrypted.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You can use the following generated encryption key in your config file to store new encrypted secrets:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">secret_management.encryption_keys: [911f804cd11f7bc2dd338743ea1752b0b7cd2589cc80060159ed94a918bc09d3]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>等待服务器启动正常后，参考相关文档。完成 Github、Jira 和 Confluence 等数据源的配置。&lt;/p>
&lt;h2 id="配置数据源">配置数据源
&lt;/h2>&lt;p>见介绍文档 &lt;a class="link" href="https://www.elastic.co/guide/en/workplace-search/current/workplace-search-content-sources.html" target="_blank" rel="noopener"
>https://www.elastic.co/guide/en/workplace-search/current/workplace-search-content-sources.html&lt;/a>&lt;/p>
&lt;ul>
&lt;li>Confluence Cloud&lt;/li>
&lt;li>Confluence Server&lt;/li>
&lt;li>Dropbox&lt;/li>
&lt;li>GitHub&lt;/li>
&lt;li>Google Drive&lt;/li>
&lt;li>Jira Cloud&lt;/li>
&lt;li>Jira Server&lt;/li>
&lt;li>OneDrive&lt;/li>
&lt;li>Salesforce&lt;/li>
&lt;li>ServiceNow&lt;/li>
&lt;li>SharePoint Online&lt;/li>
&lt;li>Zendesk&lt;/li>
&lt;/ul>
&lt;p>除了默认支持以上数据源外，还可以使用 Custom API 实现自己的数据源接入。数据源的类型分：&lt;/p>
&lt;ul>
&lt;li>组织级：可以分配给个人和用户组&lt;/li>
&lt;li>私有级：用户个体接入某个数据源，而仅供自己使用&lt;/li>
&lt;/ul>
&lt;h3 id="github-数据源对接">GitHub 数据源对接
&lt;/h3>&lt;p>首先你需要属于 GitHub 的一个组织，或者多个组织，然后在某个组织，或者几个组织做为一个数据源，对接到 Elastic Workplace Search 中。具体的配置步骤如下.&lt;/p>
&lt;p>在 GitHub 中找到需要搜索的组织，每个 repo 的 issue 和 pr 都是全文搜索的目标。
&lt;img src="https://martinliu.cn/images/2020-04-21_14-31-43.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>在 GitHub 的账户中创建一个 OAuth App，图中 1、2、3、4 信息点需要和你的测试环境匹配。复制出 client ID 和 Client Secret 备用。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-21_14-17-22.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>在 Elastic Workplace Search 的数据源配置页面创建 GitHub 数据源。填入上一步的两个 ID。
&lt;img src="https://martinliu.cn/images/2020-04-21_14-35-49.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>保存以上配置后，在这一步点击 Connect GitHub。
&lt;img src="https://martinliu.cn/images/2020-04-21_14-39-16.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>在这一步选择需要搜索的组织，勾选后，点击完成连接配置。
&lt;img src="https://martinliu.cn/images/2020-04-21_14-40-38.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>正常连接成功后，就可以看到这个组织里所有 repo 中的 issue 和 pr 了。
&lt;img src="https://martinliu.cn/images/2020-04-21_14-55-21.jpeg"
loading="lazy"
>&lt;/p>
&lt;h3 id="atlassion-数据源对接">Atlassion 数据源对接
&lt;/h3>&lt;p>支持对 Confluence 和 Jira 两款产品的云服务和本地部署的搜索。配置的过程非常简单， 如果你有多套独立的 Confluence 和 Jira 环境，那么就可以给每个需要搜索的环境配置一个数据源，并且按照需要将对它们的统一搜索配置到一个统一的搜索平台之内。&lt;/p>
&lt;p>配置文档见： &lt;a class="link" href="https://www.elastic.co/guide/en/workplace-search/current/workplace-search-confluence-cloud-connector.html" target="_blank" rel="noopener"
>https://www.elastic.co/guide/en/workplace-search/current/workplace-search-confluence-cloud-connector.html&lt;/a> 和其它。下面是一个配置成功的 Jira 云服务的结果。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-26_10-23-51.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>如果所示，每套 Atlassion 环境的产品都可以仅仅通过配置接入这个搜索平台。Jira 中索引的内容类型如下：&lt;/p>
&lt;ul>
&lt;li>Task&lt;/li>
&lt;li>子任务&lt;/li>
&lt;li>长篇故事&lt;/li>
&lt;li>Project&lt;/li>
&lt;li>Other&lt;/li>
&lt;/ul>
&lt;p>配置完成以后，默认的同步周期是 2 小时做一次增量索引。下图是用户对 Jira 和 Confluence 的两个本地部署服务器联合统一搜索的效果。管理员可设置任何一个人和用户组能搜索那些数据源，每个数据源在搜索结果中的权重排位。从而实现对任何一个用户组定制化搜索结果的作用。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG32.jpeg"
loading="lazy"
>&lt;/p>
&lt;h2 id="用户配置示例">用户配置示例
&lt;/h2>&lt;p>本文的目标是给两个用户组的人分配不同的数据源权重，从而得到各异的搜索结果排名。下面是一些建议的思路和配置过程。&lt;/p>
&lt;p>这里把仅有的两个数据源设置成了组织级别的可搜索，也就是他可以进入任何一个合法用户的搜索清单中。加入是特定团队所使用的数据源，在这里需要关闭搜索开关。
&lt;img src="https://martinliu.cn/images/2020-04-26_11-17-20.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>本文使用的 Elasticsearc 原生用户的认证，示例中将用户名为 sales* 开头的的用户名分配到 Elastic Workplace Search 的 “销售&amp;amp;市场” 组中。
&lt;img src="https://martinliu.cn/images/2020-04-26_11-23-23.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>示例中将用户名为 dev* 开头的的用户名分配到 Elastic Workplace Search 的 “产品开发和运维” 组中。这里只是示例，你可以用任何已知用户与搜索用户组的对应，从而满足你的使用场景。
&lt;img src="https://martinliu.cn/images/2020-04-26_11-24-29.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>在组织级别的组属性设置中，先设置默认用户的数据源权重，这里使用默认的 1，也就是不区分两个数据源的权重，使用相同权重。
&lt;img src="https://martinliu.cn/images/2020-04-26_11-30-03.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>下面是对 “销售&amp;amp;市场” 组的数据源权重设置，这里假设这个组的人员可能更会搜索 Jira 中的关于项目开发、问题解决进展这类的信息，不会太关注工程师实际解决的代码相关的问题。因此将 Jira 中的权重从 1 增加到 5 ，从而在相同关键字中，提升 Jira 中搜索结果的整体排名。
&lt;img src="https://martinliu.cn/images/2020-04-26_19-14-15.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>同理为 “产品开发&amp;amp;运维” 团队设置 GitHub 的高权重。
&lt;img src="https://martinliu.cn/images/2020-04-26_19-15-07.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>最后在这个安全的选项设置中，开启了搜索用户可以自主添加数据源的情况，也就是说这部分是个性化的数据源，可能是自己所使用的网盘，或者个人的 GitHub 组织等等，都可以！用户可以将对自己有帮助的，需要搜索的数据源都自助式的添加上，从而提高自己的工作效率。
&lt;img src="https://martinliu.cn/images/2020-04-26_19-16-19.jpeg"
loading="lazy"
>&lt;/p>
&lt;h2 id="搜索效果确认">搜索效果确认
&lt;/h2>&lt;p>下面是用户 sales1 搜索 &lt;code>ealsticsearch&lt;/code> 关键字的结果示意图。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-26_19-54-40.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>在上图中，搜索用户可以点击右侧的数据源图标，点选其中的一个数据源作为搜索范围，可以点击 All Time 时间设置条件，筛选出目标时段的文档等。还可以在搜索框中使用类似 &lt;code>ppt&lt;/code> 等文件类型搜索条件。 搜索结果是故意设置的，这是 Jira 中的一个 pdf 附件，pdf 的原文也可以搜索，而且对于 销售&amp;amp;市场 用户组来说， Jira 的权重大于 GitHub 很多，因此即使 Github 中有四个匹配的结果，也就将其排了在了最下面。&lt;/p>
&lt;p>下图是 dev1 用户（属于产品开发&amp;amp;运维组）的登录后界面。这里显示了建议的搜索快捷短语 &lt;code>pull requests form last week&lt;/code> ，页面上的搜索结果是按照数据源中最更新的文档靠前的规则排列的。
&lt;img src="https://martinliu.cn/images/2020-04-26_20-01-51.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>下面这个用户搜索可关键词 &lt;code>app search&lt;/code>，从这个结果中可以看出，即使是在 GitHub 中的一半匹配（并无完整的 app search 这个词组出现在任何文档里）搜索结果的排名都比 Jira 中的完全命中的排名高。
&lt;img src="https://martinliu.cn/images/2020-04-26_20-03-00.jpeg"
loading="lazy"
>&lt;/p>
&lt;h2 id="测试总结">测试总结
&lt;/h2>&lt;p>到目前为止，本文展示了一部分 Elastic Workplace Search 的基础功能。以及一些假象的搜索和配置场景，相信对此感兴趣的读者参考本文，也可以在 1 天之内完全实现以上所有的测试场景，从而为正确评估这个产品打下一个基础。&lt;/p>
&lt;p>如果，想进一步集成自己的资料库的话，可以参考自定义 API 的相关文档，开发自定义的数据源。这就是一个功能齐全的搜索平台，它可以非常方便的集成任何公司的环境中，并且实现集中统一搜索平台的效果。&lt;/p>
&lt;h2 id="devops核心能力建设">DevOps核心能力建设
&lt;/h2>&lt;p>如果你也是 DevOps 的实践者，如果你看过我之前写的关于 DevOps 状态调查报告和能力成长模型的相关文章，你可能对下图也有印象。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567339751/2019-dora-DevOps-all.jpg"
loading="lazy"
>&lt;/p>
&lt;p>这是 DORA 出的最新版本的 DevOps 能力成长模型，在 2019 年的DevOps 能力调查中，增加了对生产力工具的调查，该模型中所关注的三种生产力能力工具包括：&lt;/p>
&lt;ul>
&lt;li>各种有用易用的工具&lt;/li>
&lt;li>互联网搜索&lt;/li>
&lt;li>内网搜索&lt;/li>
&lt;/ul>
&lt;p>在这个部分有两项生产力影响因素能力是关于搜索的。在我国的很多工作环境中，特别是开发相关的工作，无 Internet 环境的纯内网是很普遍的。而内网上的 Atlassian 相关产品，微软相关产品又是最多用的；不同业务部门或者团队拥有自建的 Jira 或者 Confulence 服务器；在团队协作的时候，或者在执行跨部门的项目的时候，项目资料的统一搜索就成了问题。类似的需求和现象不胜枚举，希望本文介绍的 Elastic Workplace Search 统一搜索平台可以成为你的帮手，为你填补 DevOps 能力成长模型中关于 &lt;code>内网搜索&lt;/code> 的这一项空白。当然，这个平台所支持的外网 SaaS 服务也是很多的，可以综合使用。&lt;/p></description></item><item><title>随心所欲的为应用无痛添加搜索功能</title><link>https://martinliu.cn/blog/getting-start-elastic-app-search/</link><pubDate>Sat, 11 Apr 2020 09:36:49 +0800</pubDate><guid>https://martinliu.cn/blog/getting-start-elastic-app-search/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-1.jpg" alt="Featured image of post 随心所欲的为应用无痛添加搜索功能" />&lt;p>开发搜索功能从此再也不用犯愁了，有了 App Search ，为应用增加搜索功能一下子变得简单了很多。本文描述了如何轻松上手这套搜索平台的所有步骤。&lt;/p>
&lt;p>什么是 App Search? 这是一套强大的 API 和开发者工具集，以构建功能强大的面向用户的搜索应用为目标。相关详细介绍见 &lt;a class="link" href="https://www.elastic.co/cn/app-search" target="_blank" rel="noopener"
>https://www.elastic.co/cn/app-search&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/apps1.jpg"
loading="lazy"
>&lt;/p>
&lt;p>丰富的开箱即用功能:&lt;/p>
&lt;ul>
&lt;li>为相关性搜索应用场景而优化&lt;/li>
&lt;li>拼写错误容忍&lt;/li>
&lt;li>相关度调整&lt;/li>
&lt;li>支持第三方 API 客户端，且具备强大的 API&lt;/li>
&lt;li>独立的 API 日志和搜索分析&lt;/li>
&lt;li>自动化扩展&amp;amp;运维支持&lt;/li>
&lt;li>Search UI library&lt;/li>
&lt;/ul>
&lt;h2 id="环境准备">环境准备
&lt;/h2>&lt;p>测试环境现需要一台 Elasticsearch 服务器，或者和下面等同的环境。&lt;/p>
&lt;p>本文的环境描述如下：&lt;/p>
&lt;ul>
&lt;li>macOS 10.15.4&lt;/li>
&lt;li>vagrant 2.2.7&lt;/li>
&lt;li>virtualbox 6.0.15&lt;/li>
&lt;li>虚拟机模板 bento/centos-8&lt;/li>
&lt;li>elasticsearch 7.6.1&lt;/li>
&lt;li>app-search 7.6.1&lt;/li>
&lt;li>jdk-11.06&lt;/li>
&lt;/ul>
&lt;p>本文的测试环境基于 Vagrant + VirtualBox 的组合环境搭建而成，基础安装工作可以一键完成。&lt;/p>
&lt;p>主要脚本 Vagrantfile、pre-install-ES.sh 请参考此代码库：&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/martinliu/elastic-labs/tree/master/app-search" target="_blank" rel="noopener"
>https://github.com/martinliu/elastic-labs/tree/master/app-search&lt;/a>&lt;/p>
&lt;p>开启并登陆这套安装环境的命令如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">vagrant up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vagrant ssh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在以上命令的启动信息里找到如下的 elastic 用户密码部分备用。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">master1: Changed password for user elastic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master1: PASSWORD elastic = eczHJ7NPrsO1B1BRA8SS
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="安装-app-search">安装 App Search
&lt;/h2>&lt;p>浏览 App Search 的安装文档： &lt;a class="link" href="https://swiftype.com/documentation/app-search/self-managed/installation" target="_blank" rel="noopener"
>https://swiftype.com/documentation/app-search/self-managed/installation&lt;/a>&lt;/p>
&lt;p>安装 App Search 所需的 JDK 8 或者 11 ，本文安装的是 Oracle 的 JDK 11。本文假设所有的安装文件和已经编辑好的配置文件都放在了 /vagrant 目录下。&lt;/p>
&lt;p>&lt;code>sudo rpm -ivh /vagrant/rpm/jdk-11.0.6_linux-x64_bin.rpm&lt;/code>&lt;/p>
&lt;p>安装 App Search 服务器。&lt;/p>
&lt;p>&lt;code>sudo rpm -ivh /vagrant/rpm/app-search-7.6.1.rpm&lt;/code>&lt;/p>
&lt;p>浏览 App Search 服务器默认的配置文件，了解有哪些可用选项。&lt;/p>
&lt;p>&lt;code>sudo more /usr/share/app-search/config/app-search.yml&lt;/code>&lt;/p>
&lt;p>将 Elasticsearch 服务器安装时产生的随机密码更新到 app-search.yml 文件中，并且定制它的内容如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">allow_es_settings_modification&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.10&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">elastic&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">eczHJ7NPrsO1B1BRA8SS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app_search&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">external_url&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.10&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3002&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app_search&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">listen_host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app_search&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">listen_port&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">3002&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">log_directory&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">search&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">filebeat_log_directory&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">search&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将更新好的 app-search.yml 更新到它默认的路径中。&lt;/p>
&lt;p>&lt;code>sudo cp /vagrant/appsearch/app-search.yml /usr/share/app-search/config/app-search.yml&lt;/code>&lt;/p>
&lt;p>启动 App Search 服务器。&lt;/p>
&lt;p>&lt;code>sudo /usr/share/app-search/bin/app-search&lt;/code>&lt;/p>
&lt;p>在启动日志中，找到如下的默认用户名和密码。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#########################################################
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*** Default user credentials have been setup. These are only printed once, so please ensure they are recorded. ***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> username: app_search
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password: vjqmjhv2s5rzixjc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#########################################################
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在服务器初始化启动完毕之后，用上面的用户名和密码，在浏览器中登录 App Search 服务器 &lt;a class="link" href="http://192.168.50.10:3002" target="_blank" rel="noopener"
>http://192.168.50.10:3002&lt;/a>&lt;/p>
&lt;p>到此为止，App Search 服务器的安装就完成了。它其实是一个基于 Elasticsearch 的搜索服务平台。&lt;/p>
&lt;p>它的特点是帮助开发者随心所欲的为已有的或者正在开发的项目增加功能强大的搜索功能，而且将搜索功能的实施成本降低到无痛点的程度。App Search 可以覆盖的使用场景如下：&lt;/p>
&lt;ul>
&lt;li>SaaS / web 应用&lt;/li>
&lt;li>复杂的电商应用&lt;/li>
&lt;li>客户支持服务站点&lt;/li>
&lt;li>Geo 地理搜索&lt;/li>
&lt;li>公司官网&lt;/li>
&lt;li>内部的搜索&lt;/li>
&lt;li>还有更多其他&lt;/li>
&lt;/ul>
&lt;h2 id="创建名为-games-的搜索引擎">创建名为 games 的搜索引擎
&lt;/h2>&lt;p>在首页的创建引擎的输入框中输入 games， 语言选择默认选项，点击创建。浏览新创建的引擎，点击左下角的菜单 Credentials，复制 privite-key 备用。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/apps2.jpg"
loading="lazy"
>&lt;/p>
&lt;p>找到这个搜索引擎的 API 调用网址备用。
&lt;code>http://192.168.50.10:3002/api/as/v1/&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/apps3.jpg"
loading="lazy"
>&lt;/p>
&lt;h2 id="通过-api-索引数据文档">通过 API 索引数据文档
&lt;/h2>&lt;p>需要通过 App Search 提供的 API 索引一份具有 4000+ 条数据的 json 文件。数据文件见代码库中的 &lt;code>video-games.json&lt;/code> 。本文使用 Ruby 编写了一个上传脚本，见 &lt;code>upload.rb&lt;/code> ，该脚本使用了名为 elastic-app-search 的客户端库。你可以使用其他编程语音，实现待接入系统和 App Search 服务器的对接，并与之保持同步，保持待搜索数据的更新。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># `gem install elastic-app-search progress_bar`
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">require &amp;#39;elastic-app-search&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">require &amp;#39;json&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">require &amp;#39;progress_bar&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">API_ENDPOINT = &amp;#39;http://192.168.50.10:3002/api/as//v1/&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">API_KEY = &amp;#39;private-jdhcmi1yhy8wjxo6upb4qki3&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ENGINE_NAME = &amp;#39;games&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">client = Elastic::AppSearch::Client.new(:api_key =&amp;gt; API_KEY, :api_endpoint =&amp;gt; API_ENDPOINT)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">file = File.read(&amp;#39;./video-games.json&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">data = JSON.parse(file)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bar = ProgressBar.new(data.count / 100)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">data.each_slice(100) do |slice|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> client.index_documents(ENGINE_NAME, slice)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bar.increment!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上脚本中的 API_ENDPOINT 和 API_KEY 需要更新，与当前测试系统匹配。这个脚本的运行效果如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="n">app&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">search&lt;/span> &lt;span class="n">git&lt;/span>&lt;span class="p">:(&lt;/span>&lt;span class="n">master&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="err">✗&lt;/span> &lt;span class="n">ruby&lt;/span> &lt;span class="n">upload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="c1">##########################################################################] [40/40] [100.00%] [00:54] [00:00] [ 0.73/s]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>索引之后，在搜引擎的 Documents 页面，浏览索引后的数据，用 Query Tester 进行一些搜索，了解这些数据的内容，注意观察当前搜索的结果和排序。&lt;/p>
&lt;h2 id="修订-schema">修订 Schema
&lt;/h2>&lt;p>开发者可以按照需要随时修改 Schema，实际上这是一个 Schema 的平台。 Schema 的修改后，数据即可生效，在这个过程中前端用户的搜索体验不会受到任何影响。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/apps4.jpg"
loading="lazy"
>&lt;/p>
&lt;p>修改三个字段的定义，并增加 language 字段，点击右上角的 Update Type 按钮生效。&lt;/p>
&lt;h2 id="按需进行搜索设置">按需进行搜索设置
&lt;/h2>&lt;h3 id="创建同义词">创建同义词
&lt;/h3>&lt;p>为 Pokemon 创建同义词 Pikachu，如下图所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/apps5.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="调整搜索字段的权重">调整搜索字段的权重
&lt;/h3>&lt;p>为 globa_sales 增加 Functional Boost 1。
&lt;img src="https://martinliu.cn/images/apps6.jpg"
loading="lazy"
>&lt;/p>
&lt;p>为 Name 增加 weight 3 ，点击右上角的 Save 保存。在这个过程中观察右侧的搜结果的动态变化，还可以做其他字段的修改，知道搜素结果满意为止。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/apps7.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="创建-curations">创建 curations
&lt;/h3>&lt;p>故意将某条搜索结果置顶，这有可能因为，这款游戏目前是热评游戏，是畅销爆款，是高利率商品，是广告商品，或者其他业务原因。可以给某个关键字，置顶一条或者多条搜索结果。下面将 pokemon 的 pokemon-ranger-ds-2006 这款产品置顶。点击右上角的 Query Tester 测试一下效果。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/apps8.jpg"
loading="lazy"
>&lt;/p>
&lt;h2 id="创建用户端搜索界面">创建用户端搜索界面
&lt;/h2>&lt;p>Reference UI 是提供给用户使用的搜索界面，它可以是只有一个输入框，也可以是比较复杂的条件查询。如下所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/apps10.jpg"
loading="lazy"
>&lt;/p>
&lt;p>调整之后点击 Create Preview 按钮，进入搜素界面的确认页面，尝试使用所设定的搜索功能。满意后点击右上角的 Download ZIP Package 按钮下载这个界面的所有代码。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/apps11.jpg"
loading="lazy"
>&lt;/p>
&lt;p>在本地解压缩这份搜索代码，并进行调试。&lt;/p>
&lt;p>在命令行，进入这个目录，先执行 &lt;code>npm install&lt;/code>命令，然后执行&lt;code>npm start&lt;/code>命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Compiled successfully!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You can now view app-search-reference-ui-react in the browser.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local: http://localhost:3000/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> On Your Network: http://192.168.1.6:3000/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Note that the development build is not optimized.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To create a production build, use npm run build.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在弹出的网页中，在本地测试这个搜索界面的可用性。最后运行 &lt;code>npm run build&lt;/code> 命令，&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">➜ games-react-demo-ui git:(master) ✗ npm run build
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; app-search-reference-ui-react@1.2.0 build /Users/martin/code/elastic-labs/app-search/games-react-demo-ui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; npm-run-all build-css build-js
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; app-search-reference-ui-react@1.2.0 build-css /Users/martin/code/elastic-labs/app-search/games-react-demo-ui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; node-sass-chokidar src/ -o src/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No input files were found.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; app-search-reference-ui-react@1.2.0 build-js /Users/martin/code/elastic-labs/app-search/games-react-demo-ui
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; node ./scripts/build-no-chunks.js
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Creating an optimized production build...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Browserslist: caniuse-lite is outdated. Please run next command `npm update`
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Browserslist: caniuse-lite is outdated. Please run next command `npm update`
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Compiled successfully.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">File sizes after gzip:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 109.1 KB build/static/js/main.2f745bc0.js
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3.64 KB build/static/css/main.e43852a4.css
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The project was built assuming it is hosted at the server root.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You can control this with the homepage field in your package.json.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">For example, add this to build it for GitHub Pages:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;homepage&amp;#34; : &amp;#34;http://myname.github.io/myapp&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The build folder is ready to be deployed.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You may serve it with a static server:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> npm install -g serve
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> serve -s build
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Find out more about deployment here:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> https://bit.ly/CRA-deploy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后将构建结果部署到一个目标的先安装的 Nginx 服务器上。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo yum install -y nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo mv -f build/* /usr/share/nginx/html
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在浏览器中访问 Nginx 服务器 &lt;code>http://192.168.50.10/index.html&lt;/code> 观察最终的实现效果。
&lt;img src="https://martinliu.cn/images/apps12.jpg"
loading="lazy"
>&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>使用 App Search 搜索平台，开发者可以快速的开发出一套定制化的搜索系统，轻松的实现后台搜索业务逻辑的调整，并轻松的将用户搜索界面测试后部署上线。&lt;/p></description></item><item><title>使用 Elastic Stack 监控 Covid-19 疫情发展</title><link>https://martinliu.cn/blog/using-elastic-stack-for-monitoring-covid-19/</link><pubDate>Wed, 08 Apr 2020 17:04:08 +0800</pubDate><guid>https://martinliu.cn/blog/using-elastic-stack-for-monitoring-covid-19/</guid><description>&lt;p>代号为 COVID-19 的新型冠状病毒肺炎在全球肆虐着，剧情翻转的非常快，目前欧美已经成为了全球的重灾区。
本文介绍如何使用 Elastic Stack，实现对国内外疫情发展态势的分析。介绍一种简单易行的数据分析流程。说不定你也可以得出独到的高价值洞察。&lt;/p>
&lt;p>本文使用的 Elastic Stack 版本和环境如下：&lt;/p>
&lt;ul>
&lt;li>Vagrant 的基础镜像 bento/centos-8&lt;/li>
&lt;li>Elasticsearch 7.6.1&lt;/li>
&lt;li>Kibana 7.6.1&lt;/li>
&lt;li>Logstash 7.6.1&lt;/li>
&lt;/ul>
&lt;p>关于使用 Vagrant 环境搭建 Elastic Stack 的方法，见我之前的文章。本文的数据分析处理流程图如下所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_17-58-31.jpeg"
loading="lazy"
>&lt;/p>
&lt;h2 id="分析和展示丁香园数据">分析和展示丁香园数据
&lt;/h2>&lt;p>本文的目标分析数据源是 &lt;a class="link" href="https://ncov.dxy.cn/ncovh5/view/pneumonia" target="_blank" rel="noopener"
>https://ncov.dxy.cn/ncovh5/view/pneumonia&lt;/a> 这个也是我们最近一直在关注的关于中国的疫情公布平台。&lt;/p>
&lt;p>丁香园网页的数据被香港大学的 Isaac Lin 同学，通过他所开发的网络爬虫抓取加工后，用 API 的形式和 csv 数据文件的形式提供了出来，他的爬虫程序和结果数据给很多目前分析疫情的人带来了很大的帮助，有不少人去他的 blog 和 github 上点赞和评论的。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/BlankerL/DXY-COVID-19-Data/tree/master/csv" target="_blank" rel="noopener"
>https://github.com/BlankerL/DXY-COVID-19-Data/tree/master/csv&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://lab.isaaclin.cn/nCoV/" target="_blank" rel="noopener"
>https://lab.isaaclin.cn/nCoV/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>你可以用 Python 程序调用 Lin 同学的 API 然后在将处理后的结果写入 ES，这样的脚本可以参考 Rockybean 的这个 &lt;a class="link" href="https://www.yuque.com/elastictalk/blog/et25?from=timeline%e3%80%82%e4%b9%9f%e5%8f%af%e4%bb%a5%e7%94%a8%e4%b8%8b%e9%9d%a2%e7%9a%84%e5%91%bd%e4%bb%a4%e5%b0%86Github" target="_blank" rel="noopener"
>https://www.yuque.com/elastictalk/blog/et25?from=timeline。也可以用下面的命令将Github&lt;/a> 的 csv 文件下载到本地，在做手工的数据分析，这样也等于是对林同学的数据内容和定义进行一次深入的探索，这也将更有益于你理解数据，方面后面使用 Kibana 做数据分析。&lt;/p>
&lt;p>在本机使用 git 做数据下载和同步的命令如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git clone https://github.com/BlankerL/DXY-COVID-19-Data.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd DXY-COVID-19-Data/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git pull
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>你也可以用用&lt;code>git pull&lt;/code>命令在日后做数据更新，并进行后续的跟踪分析。&lt;/p>
&lt;p>同步到本地的数据也可以使用 Logstash 或者是 Filebeat 持续的同步到 ES 中，这样就可以在 Kibana 上看到每日的实时更新结果。&lt;/p>
&lt;h3 id="导入数据并初始化索引">导入数据并初始化索引
&lt;/h3>&lt;p>本文选择了最简单直接的方式，使用 Kibana 自带的数据导入功能，手工导入丁香园的 csv 时序数据文件 &lt;code>csv/DXYArea.csv&lt;/code>。 如下图所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_10-23-22.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>这个工具是机器学习的周边工具 &lt;code>数据可视化器&lt;/code> ，它对这份数据做了初步的分析和识别，点击导入，然后在下面点击 Advancd ，进入高级设置，如下图所示：&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_10-27-15.jpeg"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>可以在 index name 中可以输入&lt;code>dxy-area-m5&lt;/code> 作为本次新建的索引名称。&lt;/li>
&lt;li>然后删除默认的 Mapping 定义，输入下面的重新重定义的数据结构。&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;@timestamp&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;date&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;continentEnglishName&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;keyword&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;continentName&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;keyword&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;countryEnglishName&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;keyword&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;countryName&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;keyword&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;provinceEnglishName&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;keyword&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;provinceName&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;keyword&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;province_confirmedCount&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;integer&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;province_curedCount&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;integer&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;province_deadCount&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;integer&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;province_suspectedCount&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;integer&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;province_zipCode&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;integer&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;cityEnglishName&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;keyword&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;cityName&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;keyword&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;city_confirmedCount&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;integer&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;city_curedCount&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;integer&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;city_deadCount&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;integer&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;city_suspectedCount&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;integer&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;city_zipCode&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;integer&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;level&amp;#34;:{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;keyword&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;location&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;geo_point&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;is_china&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;boolean&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;updateTime&amp;#34;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;type&amp;#34;: &amp;#34;date&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;format&amp;#34;: &amp;#34;yyyy-MM-dd HH:mm:ss&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>对以上 Mapping 的简要说明：&lt;/p>
&lt;ul>
&lt;li>增加了字段 level, is_china 和 Location，你也可以加入你所需要的其它待用字段，所有新增无值字段都需要后期进行初始化。&lt;/li>
&lt;li>level 定义了数据记录的级别为：国家、港澳台和省级。&lt;/li>
&lt;li>is_china 定义了国内外数据标识&lt;/li>
&lt;li>在导入后，本文使用的字段的批量初始化/维护是调用 /_update_by_query 方法，也可以是使用 ingest pipline 的方式，或者其它 Elastic Stack 中的其它替代功能。&lt;/li>
&lt;/ul>
&lt;p>如上图所示的数据导入成功之后，点击 View index in Discovery， 我们可以使用 Kibana 的 Discovery 功能来对所导入的数据进行分析和确认，特别是一些关键字段的数值。观察这些数据的格式和内容的含义是什么。使用 filter 功能了解数据的内容和特征。建议使用下面的 filter 和组合探索一下【也可以使用 kql 语言做查询，如果用 kql 做查询的话，也可以很方便的将这些查询条件进行复用】。&lt;/p>
&lt;ul>
&lt;li>countryName:中国&lt;/li>
&lt;li>NOT countryName:中国&lt;/li>
&lt;li>countryName:中国 / provinceName:中国&lt;/li>
&lt;li>countryName:中国 / NOT provinceName:中国 / cityName exists&lt;/li>
&lt;li>countryName:中国 / NOT provinceName:中国 / NOT cityName exists&lt;/li>
&lt;li>countryName:中国 / cityName: 境外输入&lt;/li>
&lt;/ul>
&lt;p>以上的 / 是多个 filter 叠加的含义，可以大概的猜测出下面的结论。&lt;/p>
&lt;ul>
&lt;li>中国国内数据&lt;/li>
&lt;li>国外数据&lt;/li>
&lt;li>中国省级统计数据&lt;/li>
&lt;li>中国各省的各个城市的统计数据&lt;/li>
&lt;li>中国的港澳台数据&lt;/li>
&lt;li>中国海关所监控到的境外输入数据&lt;/li>
&lt;/ul>
&lt;p>为了后面使用省的名称做地图分析，这里需要查看数据中各个省英文名称，以广西为例，设置查询条件：provinceEnglishName Guangxi&lt;/p>
&lt;p>现在来浏览 Elastic Map 地图服务所引用的中国各省的中英文名称和代码，查看 &lt;a class="link" href="https://maps.elastic.co/#file/china_provinces" target="_blank" rel="noopener"
>https://maps.elastic.co/#file/china_provinces&lt;/a> ；&lt;/p>
&lt;p>可以发现现所导入的数据和 Elastic 地图服务的官方数据不一致。&lt;/p>
&lt;p>下图是用 Excel 分析对比的结果，建议使用 Python、logstash 或者其它工具在导入的过程中对这个字段做预处理和校准。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-07_12-55-23.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>本文下面描述了 Dev Tool 中运行相关的数据优化和及校准脚本。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#维护is_china字段
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">POST dxy-area-m5/_update_by_query
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;script&amp;#34;:{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;lang&amp;#34;: &amp;#34;painless&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;source&amp;#34;: &amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (ctx._source.countryEnglishName == &amp;#34;China&amp;#34;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.is_china = true;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.is_china = false;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#维护 level 字段，对于中国的数据来说，如果省的名字是中国这就是国家级的统计数据
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">POST dxy-area-m5/_update_by_query
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;script&amp;#34;:{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;lang&amp;#34;: &amp;#34;painless&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;source&amp;#34;: &amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if(ctx._source.provinceName == ctx._source.countryName){
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.level = &amp;#34;country&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (ctx._source.cityName == null) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.level = &amp;#34;cn-hmt&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> } else {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.level = &amp;#34;province&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#更新省的名字为国际代码
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">POST dxy-area-m5/_update_by_query
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;script&amp;#34;:{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;lang&amp;#34;: &amp;#34;painless&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;source&amp;#34;: &amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (ctx._source.provinceEnglishName == &amp;#34;Guangxi&amp;#34;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.provinceEnglishName = &amp;#34;Guangxi Zhuang Autonomous Region&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (ctx._source.provinceEnglishName == &amp;#34;Hong Kong&amp;#34;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.provinceEnglishName = &amp;#34;HongKong&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (ctx._source.provinceEnglishName == &amp;#34;Macao&amp;#34;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.provinceEnglishName = &amp;#34;Macau&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (ctx._source.provinceEnglishName == &amp;#34;Neimenggu&amp;#34;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.provinceEnglishName = &amp;#34;Inner Mongolia&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (ctx._source.provinceEnglishName == &amp;#34;Ningxia&amp;#34;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.provinceEnglishName = &amp;#34;Ningxia Hui Autonomous Region&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (ctx._source.provinceEnglishName == &amp;#34;Taiwan&amp;#34;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.provinceEnglishName = &amp;#34;Taiwan Province&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.provinceName = &amp;#34;台湾省 (中华人民共和国)&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (ctx._source.provinceEnglishName == &amp;#34;Xizang&amp;#34;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.provinceEnglishName = &amp;#34;Tibet&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (ctx._source.cityName == &amp;#34;境外输入人员&amp;#34;) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ctx._source.cityName = &amp;#34;境外输入&amp;#34;;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注意：以上的三个 POST 方法调用的对象是 &lt;code>dxy-area-m5&lt;/code> ，这个索引的名字需要和你上面导入数据创建的索引一致。由于是手工初次处理这些数据，建议再次运行以上的一系列搜索过滤条件，确认这些目标字段和数据得到了正确的处理。&lt;/p>
&lt;h3 id="可视化和展示数据">可视化和展示数据
&lt;/h3>&lt;p>在分析数据就绪了以后，下面介绍一组通过 Kibana 进行数据可视化分析展示的思路和方法。&lt;/p>
&lt;h4 id="-从-discovery-界面中直接调用可视化视图创建">💻 从 Discovery 界面中直接调用可视化视图创建
&lt;/h4>&lt;p>在 Discovery 的查询界面里，点击左侧 fields 清单中的 provinceName，或者其它想进行可视化分析的字段，点击后即可查看其中一部分的数值分布情况，点击下面的 Visualize 按钮。就可以进入可视化编辑模式。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_11-11-13.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>进入这个 field 的默认可视化配置模式，选择 Y 轴的指标为 province_confirmedCount 的最大值，然后在上方增加 is_china:true 和 level:province 过滤条件后，就可以得到下面的结果。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_11-09-48.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>还可以对 Buckets 里面 X 轴的值进行调整，使用省的名字。 这样基本上得出了确诊数省排名的结果。或者你还可以调整出其它的分析结论。在分析结束后，点击左上角的 Save ，将分析组合保存下来用于后期的仪表板的制作。&lt;/p>
&lt;h4 id="-使用-visualization-的-lens-功能探索数据">💻 使用 Visualization 的 lens 功能探索数据
&lt;/h4>&lt;p>点击 New Visualization，选择左上角的 Lens 图标。在 CHANGE INDEX PATTERN 中选择目标的索引如：dxy-area-m5。 拖拽几个字段进入中间的显示区：continentName countryName province_confirmedCount 这些字段，也可以尝试将这些字段拖入右侧的 X 轴或者 Y 轴。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_12-35-17.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>拖入不同的位置，图形下方的建议可视化展示风格会随之变化，Lens 功能在预判和猜测你可能会用到的展示和分析组合。感受这些建议图形所提供的数据分析的线索。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_12-59-59.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>同样的，你也可以在上面使用过滤器和时间段选择功能，这些数据筛选条件发生变化之后，可视化的图形数据也会随之变化。&lt;/p>
&lt;h4 id="使用-tsvb-时序数据可视化构造器">使用 TSVB 时序数据可视化构造器
&lt;/h4>&lt;p>这个控件的功能稍微复杂一些，用下图说明它的用法。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_19-02-31.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>如上图所示，现在 Panel Options 里面设置需要使用的数据索引，以及其他参数。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_19-08-55.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>然后在 Data 中选择需要显示的数据指标，如上图中选择了全国累计确诊和累计治愈，两个指标。将他们放在一起更能回答这样一个问题：是否治愈的速度是足够的，如果治愈速度跟得上的话，说明医疗资源是足够用的，如果这两条线之间的落差比较大就危险了。&lt;/p>
&lt;p>上方的 TSVB 图形显示了所有数值和格式调整后的预览效果。可以无限的修订知道满意为止。这个控件天然支持指标数值、排行榜、速度表、Markdown 文本和数据表。可以切换到不同的视角看它的展示效果。&lt;/p>
&lt;h4 id="使用地图展示省级累计数据">使用地图展示省级累计数据
&lt;/h4>&lt;p>我们可以使用已经导入的数据在地图上显示省级的累计确诊和治愈人数。过程是这样的：&lt;/p>
&lt;ul>
&lt;li>点击 Kibana 左侧的 Maps 图标，创建一个新的地图。&lt;/li>
&lt;li>创建图层，选择 EMS Boundaries ，选择这个图层所使用的基础地图为 China Provinces&lt;/li>
&lt;li>点击 Add layer 按钮&lt;/li>
&lt;li>在图层配置里输入图层名称缩放级别，透明度的设置&lt;/li>
&lt;li>设置 Tooltip fields 的设置中增加 name(zh) ,中文的省名称&lt;/li>
&lt;li>设置 Term Joins 的规则，点击 Join 关键字，设置索引中的数据和地图的关联。如下图所示，这就是我们为什么要把导入数据中的省英文名称与 EMS 的定义数据对齐了。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_21-30-40.jpeg"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>点击 and use metrics 设置在每个省上显示的数据。如下图所示。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_21-31-05.jpeg"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>最后设置 Layer Style， 将 Fill color 填色设置为 By Value， 选择省累计确诊，下面的颜色可以选择白色到深红的过度。&lt;/li>
&lt;li>最后点击 Save &amp;amp; close 按钮。&lt;/li>
&lt;/ul>
&lt;p>这里的技术点在于：Elastic 地图中的基础数据（地理名称代码）必须和目标索引中的相关字段能够匹配上（join）上，然后才能将索引中的实际做聚合运算的字段根据地理名称进行处理，例如根据数值的大小，将各个省填充成不同的颜色，用 tooltips 显示这个省的数据信息。&lt;/p>
&lt;h4 id="创建-dashboard-仪表板">创建 Dashboard 仪表板
&lt;/h4>&lt;p>上面所设计的所有的图示和地图都是创建 Dashboard 的素材，等做了一些素材之后就可以做仪表板了。这个过程就是在空白的仪表板上逐渐加入合适的图表，然后不断调整图表布局的过程，然后呈现出一个阶段性的效果。如下图所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_13-44-03.jpeg"
loading="lazy"
>&lt;/p>
&lt;h2 id="世卫组织数据的处理和展示">世卫组织数据的处理和展示
&lt;/h2>&lt;p>浏览世卫组织的数据 &lt;a class="link" href="https://github.com/CSSEGISandData/COVID-19" target="_blank" rel="noopener"
>https://github.com/CSSEGISandData/COVID-19&lt;/a>&lt;/p>
&lt;p>基于以上数据可以制作一个如下的仪表板：&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_13-44-40.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>这个仪表板中的地图是亮点，建议仔细学习研究一下。 这个仪表板的来源是一篇国外的文章： &lt;a class="link" href="https://www.siscale.com/importing-covid-19-data-into-elasticsearch/" target="_blank" rel="noopener"
>https://www.siscale.com/importing-covid-19-data-into-elasticsearch/&lt;/a>&lt;/p>
&lt;p>我在一个小时左右，根据经验顺利的在我的实验环境里顺利生成了这个成果。下面是根据这篇文章怎么样使用 logstash 导入 Github 中世卫组织发布的数据，并持续与之保持同步。这里是他们的代码：&lt;a class="link" href="https://github.com/siscale/covid-19-elk" target="_blank" rel="noopener"
>https://github.com/siscale/covid-19-elk&lt;/a>&lt;/p>
&lt;p>下面描述如何使用这份代码。首先你需要有一个安装好的切正常运行的 Elasticsearch 7.6.1 服务器，一个可以正常使用的 Kibana 7.6.1 服务器。在此基础之上，安装 logstash 服务器，修改并放好 logstash 的配置文件。 在 Kibana 的 Dev Tool 中导入索引的 Mapping。启动 logstash 服务器，等待和确认数据的传入。导入 Kibana 的相关对象。浏览查看和确认 siscale （国外一家 Elastic 的合作伙伴公司） 的作品。理解每个可视化展示控件的设计细节。&lt;/p>
&lt;p>你可以参考下面的安装步骤和注意事项。&lt;/p>
&lt;ul>
&lt;li>登录 Kibana，进入 Dev Tool 中，将文件 index-template-mapping.json 中的内容复制进去并点击执行按钮。&lt;/li>
&lt;li>安装 Logstash 7.6.1&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">yum install java-11-openjdk-11.0.6.10-0.el8_1.x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rpm -ivh logstash-7.6.1.rpm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>将配置文件中的 /etc/logstash/covid-19-hashes.json 修改为 /usr/share/logstash/covid-19-hashes.json 然后把它们复制到 logstash 的配置目录中&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cp logstash-github-covid-19-daily-reports-template.conf logstash-github-covid-19-time-series-template.conf /etc/logstash/conf.d/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>确保你的虚拟机（测试环境和 github 以及其他的国外基本正常的情况下）网络正常的情况下，启动 logstash 服务并且关注该服务的日志信息&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="n">logstash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">tail&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">logstash&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">logstash&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">plain&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>PS:在日志中可以看到 logstash 完全正常的启动成功，或者看到报错，这时候就需要停止 logstash 服务，并进行调整。直到服务彻底运行成功不报错。&lt;/p>
&lt;p>在 logstash 服务正常运行的情况下，世卫组织的数据是会被正常的导入到 ES 中的，你可以在 Discovery 中查看如下的查询结果。那么恭喜你，你已经和世卫组织的数据保持实时同步了。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_22-05-06.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>最后是导入该项目的仪表板对象。操作步骤参考：登录 kibana， 进入管理， 点击 Kibana 下面的 saved objeces ； 点击 import 按钮。选择 kibana-7.6.1-covid-19-dashboard.ndjson ，然后即可浏览名为 COVID 19 的仪表板了。导入后在 Kibana 的仪表板清单中选择查看名为 “COCID 19” 的仪表板。预祝你能看到和我相同的结果，建议仔细查看他们的地图设计，做的是非常的细致，如下图所示，它是三个图层叠加的显示效果。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-04-08_23-34-36.jpeg"
loading="lazy"
>&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>最后希望你通过本文已经成功的展示出了以上的预期结果。下面简单总结一下相关知识点。&lt;/p>
&lt;ul>
&lt;li>对陌生数据集的首次探索可以是手动导入 csv 文件的手动过程&lt;/li>
&lt;li>在导入的过程中需要做适当的 field mapping 的调整，和扩展，让后期的查询和数据分析更加清晰&lt;/li>
&lt;li>对导入后的数据，充分利用 Discovery 的查询和分析能力，确定好数据校准和调优的更新策略&lt;/li>
&lt;li>充分利用 ES 的批量查询修改 API，可以轻松快捷的实现数据修订。&lt;/li>
&lt;li>地图的使用重点在地理信息代码和数据索引中的实际 field 的 join，因此需要特别设计和维护 join 的字段，确保他们的精确性。&lt;/li>
&lt;li>仪表板的制作和设计依赖于各种图标的设计&lt;/li>
&lt;/ul>
&lt;p>Elastic Stack 在本案例中得到了充分而综合的运用。从 E 到 L 到 K 一个都不能少。建议大家能平衡掌握这个技术栈的各种技术能力，补足不太擅长的部分。&lt;/p>
&lt;p>本文参考的网址如下：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://gisanddata.maps.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6" target="_blank" rel="noopener"
>https://gisanddata.maps.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://covid.surge.sh/" target="_blank" rel="noopener"
>http://covid.surge.sh/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://informationisbeautiful.net/visualizations/covid-19-coronavirus-infographic-datapack/" target="_blank" rel="noopener"
>https://informationisbeautiful.net/visualizations/covid-19-coronavirus-infographic-datapack/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://ncov.dxy.cn/ncovh5/view/pneumonia" target="_blank" rel="noopener"
>https://ncov.dxy.cn/ncovh5/view/pneumonia&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/CSSEGISandData/COVID-19" target="_blank" rel="noopener"
>https://github.com/CSSEGISandData/COVID-19&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://lab.isaaclin.cn/nCoV/" target="_blank" rel="noopener"
>https://lab.isaaclin.cn/nCoV/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/siscale/covid-19-elk" target="_blank" rel="noopener"
>https://github.com/siscale/covid-19-elk&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.mapbox.cn/coronavirusmap/#3.35/28.47/109.74" target="_blank" rel="noopener"
>https://www.mapbox.cn/coronavirusmap/#3.35/28.47/109.74&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://ncov.deepeye.tech/" target="_blank" rel="noopener"
>https://ncov.deepeye.tech/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.siscale.com/importing-covid-19-data-into-elasticsearch/" target="_blank" rel="noopener"
>https://www.siscale.com/importing-covid-19-data-into-elasticsearch/&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>如何在墙内正常导入 Vagrant 虚拟机模板</title><link>https://martinliu.cn/blog/download-import-vagrant-box/</link><pubDate>Thu, 26 Mar 2020 08:57:57 +0800</pubDate><guid>https://martinliu.cn/blog/download-import-vagrant-box/</guid><description>&lt;img src="https://martinliu.cn/images/vagrant-download-box.jpg" alt="Featured image of post 如何在墙内正常导入 Vagrant 虚拟机模板" />&lt;p>当你满心欢喜的安装完了 vagrant 之后，在你第一次 &lt;code>vagrant up&lt;/code> 命令的时候，是下载超时么？你的内心是什么感受？想放弃了么？&lt;/p>
&lt;p>其实你只需要找到国内的 box 文件镜像服务器，或者下载地址，然后手工下载对应的 Box 文件（操作系统镜像文件），并导入即可，本文将帮你铲除这只官方镜像文件下载失败的拦路虎。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/vagrant-home-page.png"
loading="lazy"
>&lt;/p>
&lt;p>Vagrant 的优势：&lt;/p>
&lt;ul>
&lt;li>虚拟机对于系统级开发和测试工作具有不可替代的作用&lt;/li>
&lt;li>手工安装的虚拟机非常&lt;/li>
&lt;/ul>
&lt;h2 id="准备工作">准备工作
&lt;/h2>&lt;p>我的测试环境如下，如果你的测试环境和我的不同，但是本操作方法和过程也同样的适用于相似的环境。&lt;/p>
&lt;p>环境描述：&lt;/p>
&lt;ul>
&lt;li>macOS catalina version 10.15.3&lt;/li>
&lt;li>vagrant 2.2.4&lt;/li>
&lt;li>Virtuabox 6.0.15r135660&lt;/li>
&lt;/ul>
&lt;p>如果你也百度了’ vagrant box 国内镜像‘的话，结果会使你很失望，清华大学等站点只是缓存了个别的镜像文件，并没有其它版本特别全面的网站，更没有完整的镜像。如果你知道其它国内的镜像站点请告诉我，我会增加到本文。&lt;/p>
&lt;p>Ubuntu 的可以浏览这两个目标下载网址。&lt;/p>
&lt;p>&lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/vagrant/" target="_blank" rel="noopener"
>https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/vagrant/&lt;/a>&lt;/p>
&lt;p>然后用vagrant 下面的命令就可以将 box 下载并且添加到本地。&lt;/p>
&lt;ul>
&lt;li>ubuntu 18.04 LTS:&lt;/li>
&lt;/ul>
&lt;p>vagrant box add &lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/bionic/current/bionic-server-cloudimg-amd64-vagrant.box" target="_blank" rel="noopener"
>https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/bionic/current/bionic-server-cloudimg-amd64-vagrant.box&lt;/a> &amp;ndash;name ubuntu18&lt;/p>
&lt;ul>
&lt;li>ubunt 16.04 LTS：&lt;/li>
&lt;/ul>
&lt;p>vagrant box add &lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/xenial/current/xenial-server-cloudimg-amd64-vagrant.box" target="_blank" rel="noopener"
>https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/xenial/current/xenial-server-cloudimg-amd64-vagrant.box&lt;/a> &amp;ndash;name ubuntu16&lt;/p>
&lt;ul>
&lt;li>ubuntu14：&lt;/li>
&lt;/ul>
&lt;p>vagrant box add &lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/vagrant/trusty/current/trusty-server-cloudimg-amd64-vagrant-disk1.box" target="_blank" rel="noopener"
>https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/vagrant/trusty/current/trusty-server-cloudimg-amd64-vagrant-disk1.box&lt;/a> &amp;ndash;name ubuntu14&lt;/p>
&lt;p>对于 CentOS 而言，它的官网整理的比较好，提供了各种格式的下载，可能需要科学上网才能访问到 Centos 的下载网址。&lt;/p>
&lt;p>&lt;a class="link" href="http://cloud.centos.org/centos/7/vagrant/" target="_blank" rel="noopener"
>http://cloud.centos.org/centos/7/vagrant/&lt;/a>
&lt;a class="link" href="http://cloud.centos.org/centos/8/vagrant/" target="_blank" rel="noopener"
>http://cloud.centos.org/centos/8/vagrant/&lt;/a>&lt;/p>
&lt;p>实战建议：你并不需要下载过多的 box 操作系统镜像文件，够用即可。建议将最近有可能使用到的 Box 文件用断点续传的多线程下载工具下载到本机磁盘备用。我下载了一些，关注的微信号‘ MyDevOps ’ 回复 box1 即可获得百度网盘下载地址，这个共享目录中有本文中所提到的所有 Box 文件。&lt;/p>
&lt;h2 id="导入-box-文件">导入 Box 文件
&lt;/h2>&lt;p>用 &lt;code>vagrant box add&lt;/code> 命令将本地下载好的 box 文件导入到 vagrant 的主目录中，macOS 下是在&lt;code>~/.vagrant/&lt;/code> 目录里。&lt;/p>
&lt;p>使用&lt;code>vagrant box list&lt;/code>名先查看本地已有的 box 清单，下面的执行结果如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">➜ ~ vagrant box list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Puppetlabs Ubuntu 12.04.2 x86_64, VBox 4.2.10, No Puppet or Chef (virtualbox, 0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bento/centos-7.1 (virtualbox, 2.2.2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bento/centos-7.2 (virtualbox, 2.3.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bento/centos-8 (virtualbox, 202002.04.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bento/ubuntu-16.04 (virtualbox, 0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coreos-alpha (virtualbox, 1451.2.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">geerlingguy/centos6 (virtualbox, 0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">geerlingguy/centos7 (virtualbox, 0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">geerlingguy/ubuntu1604 (virtualbox, 0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu/trusty64 (virtualbox, 20161207.0.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu/trusty64 (virtualbox, 20170307.0.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu/wily64 (virtualbox, 20160715.0.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu/xenial64 (virtualbox, 20161214.0.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu/xenial64 (virtualbox, 20170307.0.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">➜ ~
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用&lt;code>vagrant box add&lt;/code>导入，并确认。 参考下面的执行过程&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="n">vagrant&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="o">~/&lt;/span>&lt;span class="n">Downloads&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">box&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bionic&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cloudimg&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bionic&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">box&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Box&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">was&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">detected&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">metadata&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Adding&lt;/span> &lt;span class="n">it&lt;/span> &lt;span class="n">directly&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">box&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Adding&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="s1">&amp;#39;ubuntu/bionic&amp;#39;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">v0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">provider&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">box&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Unpacking&lt;/span> &lt;span class="n">necessary&lt;/span> &lt;span class="n">files&lt;/span> &lt;span class="n">from&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">///&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">martin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Downloads&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">box&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bionic&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cloudimg&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">box&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Successfully&lt;/span> &lt;span class="n">added&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="s1">&amp;#39;ubuntu/bionic&amp;#39;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">v0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;virtualbox&amp;#39;&lt;/span>&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="n">vagrant&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="n">list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Puppetlabs&lt;/span> &lt;span class="n">Ubuntu&lt;/span> &lt;span class="mf">12.04&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">x86_64&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">VBox&lt;/span> &lt;span class="mf">4.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">No&lt;/span> &lt;span class="n">Puppet&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">Chef&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bento&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">centos&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">7.1&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">2.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bento&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">centos&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">7.2&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">2.3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bento&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">centos&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">202002.04&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bento&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">16.04&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">coreos&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">alpha&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">1451.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">geerlingguy&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">centos6&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">geerlingguy&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">centos7&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">geerlingguy&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ubuntu1604&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bionic&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">trusty64&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">20161207.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">trusty64&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">20170307.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">wily64&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">20160715.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">xenial64&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">20161214.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">xenial64&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">20170307.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="校验所导入的-box">校验所导入的 Box
&lt;/h2>&lt;p>创建一个测试目录，并执行&lt;code>vagrant init ubuntu/bionic&lt;/code> ，然后使用 vagrant up 测试。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pwd&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">martin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">code&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">➜&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">init&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bionic&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">Vagrantfile&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">has&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">been&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">placed&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">directory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">You&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">are&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">ready&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">up&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">virtual&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">environment&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Please&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">read&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">comments&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Vagrantfile&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">well&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">documentation&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">vagrantup&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">more&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">information&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">using&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Vagrant&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>test 目录下面现在生成了一个默认的 Vagrantfile 文件，查看这个默认的 Vagrantfile 配置文件。这是一个很好的学习资料。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="n">test&lt;/span> &lt;span class="n">cat&lt;/span> &lt;span class="n">Vagrantfile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -*- mode: ruby -*-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vi: set ft=ruby :&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># All Vagrant configuration is done below. The &amp;#34;2&amp;#34; in Vagrant.configure&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># configures the configuration version (we support older styles for&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># backwards compatibility). Please don&amp;#39;t change it unless you know what&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># you&amp;#39;re doing.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># The most common configuration options are documented and commented below.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># For a complete reference, please see the online documentation at&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># https://docs.vagrantup.com.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Every Vagrant development environment requires a box. You can search for&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># boxes at https://vagrantcloud.com/search.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;ubuntu/bionic&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Disable automatic box update checking. If you disable this, then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># boxes will only be checked for updates when the user runs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># `vagrant box outdated`. This is not recommended.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.box_check_update = false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Create a forwarded port mapping which allows access to a specific port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># within the machine from a port on the host machine. In the example below,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># accessing &amp;#34;localhost:8080&amp;#34; will access port 80 on the guest machine.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># NOTE: This will enable public access to the opened port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.network &amp;#34;forwarded_port&amp;#34;, guest: 80, host: 8080&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Create a forwarded port mapping which allows access to a specific port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># within the machine from a port on the host machine and only allow access&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># via 127.0.0.1 to disable public access&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.network &amp;#34;forwarded_port&amp;#34;, guest: 80, host: 8080, host_ip: &amp;#34;127.0.0.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Create a private network, which allows host-only access to the machine&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># using a specific IP.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.network &amp;#34;private_network&amp;#34;, ip: &amp;#34;192.168.33.10&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Create a public network, which generally matched to bridged network.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Bridged networks make the machine appear as another physical device on&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># your network.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.network &amp;#34;public_network&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Share an additional folder to the guest VM. The first argument is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># the path on the host to the actual folder. The second argument is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># the path on the guest to mount the folder. And the optional third&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># argument is a set of non-required options.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.synced_folder &amp;#34;../data&amp;#34;, &amp;#34;/vagrant_data&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Provider-specific configuration so you can fine-tune various&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># backing providers for Vagrant. These expose provider-specific options.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Example for VirtualBox:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.provider &amp;#34;virtualbox&amp;#34; do |vb|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # Display the VirtualBox GUI when booting the machine&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># vb.gui = true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # Customize the amount of memory on the VM:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># vb.memory = &amp;#34;1024&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># View the documentation for the provider you are using for more&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># information on available options.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Enable provisioning with a shell script. Additional provisioners such as&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Puppet, Chef, Ansible, Salt, and Docker are also available. Please see the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># documentation for more information about their specific syntax and use.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.provision &amp;#34;shell&amp;#34;, inline: &amp;lt;&amp;lt;-SHELL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># apt-get update&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># apt-get install -y apache2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># SHELL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>现在可以踏实的运行 vagrant up 了，Ubuntu 的 Box 文件导入通常没有什么问题。默认配置的 Ubuntu 版本 bionic 的 vm 现在就正常启动了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="n">test&lt;/span> &lt;span class="n">vagrant&lt;/span> &lt;span class="n">up&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Bringing&lt;/span> &lt;span class="n">machine&lt;/span> &lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span> &lt;span class="n">up&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="s1">&amp;#39;virtualbox&amp;#39;&lt;/span> &lt;span class="n">provider&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Importing&lt;/span> &lt;span class="n">base&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="s1">&amp;#39;ubuntu/bionic&amp;#39;&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Matching&lt;/span> &lt;span class="n">MAC&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">NAT&lt;/span> &lt;span class="n">networking&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Setting&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">VM&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">test_default_1585496539631_90780&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Clearing&lt;/span> &lt;span class="n">any&lt;/span> &lt;span class="n">previously&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">interfaces&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Preparing&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">interfaces&lt;/span> &lt;span class="n">based&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">configuration&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Adapter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">nat&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Forwarding&lt;/span> &lt;span class="n">ports&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">22&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">guest&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">2222&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">adapter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="s1">&amp;#39;pre-boot&amp;#39;&lt;/span> &lt;span class="n">VM&lt;/span> &lt;span class="n">customizations&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Booting&lt;/span> &lt;span class="n">VM&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Waiting&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">machine&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">boot&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">may&lt;/span> &lt;span class="n">take&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">few&lt;/span> &lt;span class="n">minutes&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">SSH&lt;/span> &lt;span class="n">address&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">127.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2222&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">SSH&lt;/span> &lt;span class="n">username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">vagrant&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">SSH&lt;/span> &lt;span class="n">auth&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">private&lt;/span> &lt;span class="n">key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Warning&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Connection&lt;/span> &lt;span class="n">reset&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Retrying&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Vagrant&lt;/span> &lt;span class="n">insecure&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="n">detected&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Vagrant&lt;/span> &lt;span class="n">will&lt;/span> &lt;span class="n">automatically&lt;/span> &lt;span class="n">replace&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">newly&lt;/span> &lt;span class="n">generated&lt;/span> &lt;span class="n">keypair&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">better&lt;/span> &lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Inserting&lt;/span> &lt;span class="n">generated&lt;/span> &lt;span class="n">public&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="n">within&lt;/span> &lt;span class="n">guest&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Removing&lt;/span> &lt;span class="n">insecure&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">guest&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">it&lt;/span>&lt;span class="s1">&amp;#39;s present...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Key&lt;/span> &lt;span class="n">inserted&lt;/span>&lt;span class="o">!&lt;/span> &lt;span class="n">Disconnecting&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">reconnecting&lt;/span> &lt;span class="n">using&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">SSH&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Machine&lt;/span> &lt;span class="n">booted&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">ready&lt;/span>&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Checking&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">guest&lt;/span> &lt;span class="n">additions&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">VM&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">guest&lt;/span> &lt;span class="n">additions&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="n">VM&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">match&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">installed&lt;/span> &lt;span class="n">version&lt;/span> &lt;span class="n">of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">VirtualBox&lt;/span>&lt;span class="o">!&lt;/span> &lt;span class="n">In&lt;/span> &lt;span class="n">most&lt;/span> &lt;span class="n">cases&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">fine&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">but&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">rare&lt;/span> &lt;span class="n">cases&lt;/span> &lt;span class="n">it&lt;/span> &lt;span class="n">can&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">prevent&lt;/span> &lt;span class="n">things&lt;/span> &lt;span class="n">such&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">shared&lt;/span> &lt;span class="n">folders&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">working&lt;/span> &lt;span class="n">properly&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">If&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">see&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">shared&lt;/span> &lt;span class="n">folder&lt;/span> &lt;span class="n">errors&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">please&lt;/span> &lt;span class="n">make&lt;/span> &lt;span class="n">sure&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">guest&lt;/span> &lt;span class="n">additions&lt;/span> &lt;span class="n">within&lt;/span> &lt;span class="n">the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">virtual&lt;/span> &lt;span class="n">machine&lt;/span> &lt;span class="n">match&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">version&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">VirtualBox&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">have&lt;/span> &lt;span class="n">installed&lt;/span> &lt;span class="n">on&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">host&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">reload&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">VM&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Guest&lt;/span> &lt;span class="n">Additions&lt;/span> &lt;span class="n">Version&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">5.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">34&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">VirtualBox&lt;/span> &lt;span class="n">Version&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">6.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Mounting&lt;/span> &lt;span class="n">shared&lt;/span> &lt;span class="n">folders&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">vagrant&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">martin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">code&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>现在 ssh 登录到这个崭新的 vm 。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="n">test&lt;/span> &lt;span class="n">vagrant&lt;/span> &lt;span class="n">ssh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Welcome&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">Ubuntu&lt;/span> &lt;span class="mf">18.04&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">4&lt;/span> &lt;span class="n">LTS&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">GNU&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Linux&lt;/span> &lt;span class="mf">4.15&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">91&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">generic&lt;/span> &lt;span class="n">x86_64&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="n">Documentation&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">help&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="n">Management&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">landscape&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">canonical&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="n">Support&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">advantage&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span> &lt;span class="n">information&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">Sun&lt;/span> &lt;span class="n">Mar&lt;/span> &lt;span class="mi">29&lt;/span> &lt;span class="mi">15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">53&lt;/span> &lt;span class="n">UTC&lt;/span> &lt;span class="mi">2020&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span> &lt;span class="nb">load&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.25&lt;/span> &lt;span class="n">Processes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">99&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Usage&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">%&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="mf">9.63&lt;/span>&lt;span class="n">GB&lt;/span> &lt;span class="n">Users&lt;/span> &lt;span class="n">logged&lt;/span> &lt;span class="ow">in&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Memory&lt;/span> &lt;span class="n">usage&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">12&lt;/span>&lt;span class="o">%&lt;/span> &lt;span class="ne">IP&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">enp0s3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Swap&lt;/span> &lt;span class="n">usage&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">0&lt;/span> &lt;span class="n">packages&lt;/span> &lt;span class="n">can&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">updated&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">0&lt;/span> &lt;span class="n">updates&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">security&lt;/span> &lt;span class="n">updates&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">vagrant&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bionic&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">~$&lt;/span> &lt;span class="n">top&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="导入-centos-7-可能遇到的问题">导入 CentOS 7 可能遇到的问题
&lt;/h2>&lt;p>CentOS 7 和 8 的相关版本在我的测试环境中都出现了导入正常 vagrant up 异常的问题，通常网络搜索错误代码后，就可以解决了，如果有任何问题，欢迎到我的微信公众后台留言。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>Vagrant 的功能性和必要性是非常高的，特别是对于天朝的码农而言，就更加重要了。它是 DevOps 工具链上的知名工具，而它的使用率和广泛性却不高。后续还会出这方面的系列内容，讲解更多关于 Vagrant 的优化和功能。&lt;/p>
&lt;p>2io&lt;/p></description></item><item><title>最简化 Elasticsearch &amp; Kibana &amp; Filebeat 安装说明</title><link>https://martinliu.cn/blog/elk-stack-install/</link><pubDate>Thu, 26 Mar 2020 08:51:15 +0800</pubDate><guid>https://martinliu.cn/blog/elk-stack-install/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-1.jpg" alt="Featured image of post 最简化 Elasticsearch &amp; Kibana &amp; Filebeat 安装说明" />&lt;p>&lt;img src="https://martinliu.cn/images/980-elastic-stack.jpg"
loading="lazy"
alt="elk"
>&lt;/p>
&lt;p>本文描述如何搭建一套具备用户名和密码安全认证的 Elastic Stack 系统，并开始使用 Filebeat 的基础模块实现分布式的日志收集。&lt;/p>
&lt;ul>
&lt;li>安装单节点 Elasticsearch 服务器，启用用户名和密码安全认证，并创建 TLS 数字证书备用&lt;/li>
&lt;li>安装 Kibana 服务器，并配置与 Elasticsearch 服务的连接&lt;/li>
&lt;li>安装和配置 Filebeat 代理程序，并配置 system 和 auditd 模块&lt;/li>
&lt;li>使用 Kibana 监控 Filebeat 所采集的系统日志，并监控系统的状态&lt;/li>
&lt;/ul>
&lt;p>为了使你也获得与我一致的安装和测试体验，请先下载并浏览相本文所使用的代码库：&lt;a class="link" href="https://github.com/martinliu/elastic-labs" target="_blank" rel="noopener"
>https://github.com/martinliu/elastic-labs&lt;/a>&lt;/p>
&lt;h2 id="试验环境概述和启动">试验环境概述和启动
&lt;/h2>&lt;p>本文所使用相关软件以及版本。&lt;/p>
&lt;ul>
&lt;li>macOS Catalina version 10.15.3&lt;/li>
&lt;li>Vagrant 2.2.4&lt;/li>
&lt;li>VirtalBox 6.0&lt;/li>
&lt;li>操作系统镜像: bento/centos-8 (virtualbox, 202002.04.0)&lt;/li>
&lt;li>Elastic Stack 安装包（RPM）
&lt;ul>
&lt;li>Elasticsearch 7.6.1&lt;/li>
&lt;li>Kibana 7.6.1&lt;/li>
&lt;li>Filebeat 7.6.1&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>使用 Vagrant 的目录共享功能，分享安装包到测试机的 /vagrant/rpm 目录下&lt;/li>
&lt;/ul>
&lt;p>注意事项：&lt;/p>
&lt;ol>
&lt;li>你也可以使用任何一台 CentOS 8 虚拟机或者云主机，则后续的安装命令和 rpm 安装包的路径需要有所变化。&lt;/li>
&lt;li>Vagrant 文件中定义的虚拟机配置为 4 GB 内存，建议你的操作系统最低为 8GB 内存，推荐 16GB 或者更高，&lt;/li>
&lt;li>本文也适用于 Linux 或 Windows 操作系统的 Vagrant 测试环境，需要提前下载并且准备好 bento/centos-8 的基础操作系统镜像。&lt;/li>
&lt;/ol>
&lt;p>启动测试环境。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">vagrant up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vagrant status
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="安装-elasticsearch-服务器">安装 Elasticsearch 服务器
&lt;/h2>&lt;p>SSH 登录测试虚拟机。&lt;/p>
&lt;p>&lt;code>vagrant ssh&lt;/code>&lt;/p>
&lt;p>执行 RPM 安装命令，安装 elasticsearch 服务器。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">cd&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rpm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">rpm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">ivh&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">7.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">x86_64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rpm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">daemon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">status&lt;/span> &lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>测试 Elasticsearch 服务是否功能正常 【 Dry run 】&lt;/p>
&lt;p>curl localhost:9200&lt;/p>
&lt;p>期待的输出类似下面。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;name&amp;#34; : &amp;#34;elk-master&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;cluster_name&amp;#34; : &amp;#34;elasticsearch&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;cluster_uuid&amp;#34; : &amp;#34;X4V2Yvc-SJ6ccjWbXQ5OmQ&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;version&amp;#34; : {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;number&amp;#34; : &amp;#34;7.6.1&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;build_flavor&amp;#34; : &amp;#34;default&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;build_type&amp;#34; : &amp;#34;rpm&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;build_hash&amp;#34; : &amp;#34;aa751e09be0a5072e8570670309b1f12348f023b&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;build_date&amp;#34; : &amp;#34;2020-02-29T00:15:25.529771Z&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;build_snapshot&amp;#34; : false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;lucene_version&amp;#34; : &amp;#34;8.4.0&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;minimum_wire_compatibility_version&amp;#34; : &amp;#34;6.8.0&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;minimum_index_compatibility_version&amp;#34; : &amp;#34;6.0.0-beta1&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;tagline&amp;#34; : &amp;#34;You Know, for Search&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>浏览和学习 Elasticsearch 默认的配置文件。&lt;/p>
&lt;p>&lt;code>sudo cat /etc/elasticsearch/elasticsearch.yml&lt;/code>&lt;/p>
&lt;p>使用 Elasticsearch 的精简版目标测试配置文件。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/elasticsearch/elasticsearch.yml /etc/elasticsearch/elasticsearch.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl restart elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status elasticsearch.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>手工查看 Elasticsearch 服务器的日志，并确认服务启动正常。&lt;/p>
&lt;p>&lt;code>sudo tail -f /var/log/elasticsearch/my-elk.log&lt;/code>&lt;/p>
&lt;p>Ctl + c 终止以上日志查看，再次测试 Elasticsearch 服务。&lt;/p>
&lt;p>&lt;code>curl localhost:9200&lt;/code>&lt;/p>
&lt;p>替换为 IP 地址测试。&lt;/p>
&lt;p>&lt;code>curl http://192.168.50.10:9200/&lt;/code>&lt;/p>
&lt;h2 id="配置-elasticsearch-服务的-tls-数字证书和身份验证">配置 Elasticsearch 服务的 TLS 数字证书和身份验证
&lt;/h2>&lt;p>停止 Elasticsearch 服务。&lt;/p>
&lt;p>&lt;code>sudo systemctl stop elasticsearch.service&lt;/code>&lt;/p>
&lt;h3 id="创建-tls-数字证书">创建 TLS 数字证书
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd /usr/share/elasticsearch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo bin/elasticsearch-certutil cert -out /etc/elasticsearch/elastic-certificates.p12 -pass &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo chmod 660 /etc/elasticsearch/elastic-certificates.p12
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="更新-elasticsearch-配置文件">更新 Elasticsearch 配置文件
&lt;/h3>&lt;p>手工打开 Elasticsearch 配置文件。&lt;/p>
&lt;p>&lt;code>sudo vi /etc/elasticsearch/elasticsearch.yml&lt;/code>&lt;/p>
&lt;p>在配置文件的末端增加下面的配置段落。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------- TLS and Cert ---------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.enabled: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.transport.ssl.enabled: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.transport.ssl.verification_mode: certificate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.transport.ssl.keystore.path: elastic-certificates.p12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.transport.ssl.truststore.path: elastic-certificates.p12
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>重新启动配置 Elasticsearch 服务。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo systemctl restart elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status elasticsearch.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>确认服务已经正常启动。&lt;/p>
&lt;p>&lt;code>sudo tail -f /var/log/elasticsearch/my-elk.log&lt;/code>&lt;/p>
&lt;h3 id="创建-elasticsearch-服务的用户密码">创建 Elasticsearch 服务的用户密码
&lt;/h3>&lt;p>运行 Elasticsearch 的密码配置工具，为各种内置用户生成随机的密码。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo cd /usr/share/elasticsearch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo bin/elasticsearch-setup-passwords auto
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将生成的密码信息妥善保存备用。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Changed password &lt;span class="k">for&lt;/span> user apm_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD &lt;span class="nv">apm_system&lt;/span> &lt;span class="o">=&lt;/span> AHyg5HzJRZg8Fiva0buW
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password &lt;span class="k">for&lt;/span> user kibana
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD &lt;span class="nv">kibana&lt;/span> &lt;span class="o">=&lt;/span> Kt72IXkiarlGr7do02Yp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password &lt;span class="k">for&lt;/span> user logstash_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD &lt;span class="nv">logstash_system&lt;/span> &lt;span class="o">=&lt;/span> Q9nnlOdf6V9kyPbbhqN7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password &lt;span class="k">for&lt;/span> user beats_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD &lt;span class="nv">beats_system&lt;/span> &lt;span class="o">=&lt;/span> bLNrZDggPKRSKc35EG32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password &lt;span class="k">for&lt;/span> user remote_monitoring_user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD &lt;span class="nv">remote_monitoring_user&lt;/span> &lt;span class="o">=&lt;/span> o1pi2yTDnhrKBGcS6xqP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password &lt;span class="k">for&lt;/span> user elastic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD &lt;span class="nv">elastic&lt;/span> &lt;span class="o">=&lt;/span> RO11xymgXTCD16ivTP33
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在浏览器中访问&lt;a class="link" href="http://192.168.50.10:9200/" target="_blank" rel="noopener"
>http://192.168.50.10:9200/&lt;/a> ，测试并确认上面的 elastic 用户的密码。&lt;/p>
&lt;h2 id="安装和配置-kibana-服务器">安装和配置 Kibana 服务器
&lt;/h2>&lt;p>执行 Kibana 安装命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd /vagrant/rpm/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rpm -ivh kibana-7.6.1-x86_64.rpm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看并学习 Kibana 默认配置文件&lt;/p>
&lt;p>&lt;code>sudo cat /etc/kibana/kibana.yml&lt;/code>&lt;/p>
&lt;p>更新默认配置文件，准备好 elastic 用户的密码，将其更新到 Kibana 配置文件中。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/kibana/kibna.yml /etc/kibana/kibana.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start kibana.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status kibana.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看重启的服务是否工作正常。&lt;/p>
&lt;p>&lt;code>sudo tail -f /var/log/messages&lt;/code>&lt;/p>
&lt;p>在浏览器里测试登录 Kibana &lt;a class="link" href="http://192.168.50.10:5601" target="_blank" rel="noopener"
>http://192.168.50.10:5601&lt;/a> ，使用 elastic 的用户名和密码。&lt;/p>
&lt;h2 id="安装-filebeat-并配置-2-个模块">安装 filebeat 并配置 2 个模块
&lt;/h2>&lt;p>执行 Filebeat 安装包。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd /vagrant/rpm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rpm -ivh ./filebeat-7.6.1-x86_64.rpm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看默认的 Filebeat 配置文件。&lt;/p>
&lt;p>&lt;code>sudo cat /etc/filebeat/filebeat.yml&lt;/code>&lt;/p>
&lt;p>更新默认配置文件，准备好 elastic 用户的密码，将其更新到 Kibana 配置文件中。&lt;/p>
&lt;p>&lt;code>sudo cp /vagrant/filebeat/filebeat.yml /etc/filebeat/filebeat.yml&lt;/code>&lt;/p>
&lt;p>查看 Filebeat 的默认日志监控模块。&lt;/p>
&lt;p>&lt;code>sudo filebeat modules list&lt;/code>&lt;/p>
&lt;p>启用 Filebeat 的 System 和 Auditd 模块，监控系统日志和基础的操作系统安全信息。&lt;/p>
&lt;p>&lt;code>sudo filebeat modules enable system auditd&lt;/code>&lt;/p>
&lt;p>查看 Filebeat 监控模块的配置文件。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo cd /etc/filebeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ls -l modules.d/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>建议查看以上启用的 System 和 Auditd 模块的配置文件。&lt;/p>
&lt;p>运行 Filebeat 在后台的初始化命令，在后台创建 Filebeat 所需要的索引 filebeat-* ，并导入所有模块相关的 Dashboard 等 Kibana 日志可视化分析工具。&lt;/p>
&lt;p>&lt;code>sudo filebeat setup&lt;/code>&lt;/p>
&lt;p>在浏览器中登录 &lt;a class="link" href="http://192.168.50.10:5601" target="_blank" rel="noopener"
>http://192.168.50.10:5601&lt;/a> Kibana 后，点击左侧的 Dashboard 图标，查看所有刚才导入的内容，搜索并打开 System 关键字的 Dasboard。&lt;/p>
&lt;p>在启动日志收集代理 Filebeat 服务前，运行一下命令测试 Filebeat 配置文件的正确性。&lt;/p>
&lt;p>&lt;code>sudo filebeat test config&lt;/code>&lt;/p>
&lt;p>启动 Filebeat 服务，开始对这台操作系统的日志进行监控。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo systemctl start filebeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status filebeat
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="建议的测试">建议的测试
&lt;/h2>&lt;ol>
&lt;li>点击左侧的 Dicovery 图标，选中 Filebeat-* 索引，打开并一条日志数据，并查看所有字段；用 KQL 进行全文搜索。&lt;/li>
&lt;li>点击左侧的 Dashboard 图标，搜索 system 关键字，查看一个仪表板的日志展示；搜索 audit 关键字，并查打开一个仪表板，在命令行中尝试 ssh localhost，多尝试几次，刷新 Audit 仪表板，观察数据是否发生了变化。&lt;/li>
&lt;li>点击左侧的 Logs 图标，用鼠标上下滚动日志信息流， 点击右上角的开始 Live Stream 查看模式，观察日志信息流的自动滚动效果，在 KQL 搜素框中输入 tags : demo-service ，体验它的搜索建议功能，在 Highlight 中输入 &lt;a class="link" href="http://192.168.50.10:5601/app/infra" target="_blank" rel="noopener"
>http://192.168.50.10:5601/app/infra&lt;/a> ，观察日志信息流显示的变化。&lt;/li>
&lt;li>点击左侧的 SIEM 图标，看看这里都有什么内容。&lt;/li>
&lt;/ol>
&lt;h2 id="后续">后续
&lt;/h2>&lt;ul>
&lt;li>用启用 Filebeat 的 Elasticsearch, Kibana 日志监控模块&lt;/li>
&lt;li>安装 Apache, MySQL 等软件，并开启 Filebeat 的日志监控模块&lt;/li>
&lt;/ul>
&lt;p>参考文档：
&lt;a class="link" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setting-system-settings.html" target="_blank" rel="noopener"
>https://www.elastic.co/guide/en/elasticsearch/reference/current/setting-system-settings.html&lt;/a>&lt;/p></description></item><item><title>怎样使用两个DevOps研究模型？</title><link>https://martinliu.cn/blog/2019-state-devops-report-insight-2/</link><pubDate>Sun, 01 Sep 2019 17:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/2019-state-devops-report-insight-2/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/1-jafadjf.jpg" alt="Featured image of post 怎样使用两个DevOps研究模型？" />&lt;p>本文要覆盖的章节是《 How to use the research models》 这一章。双模型在今年的报告中首次出现了，它们是效能模型和生产力模型。为什么会存在两个模型？有什么区别？有什么相似之处？最重要的问题是，你怎么用它们来指导你的DevOps工作？&lt;/p>
&lt;p>本文的阅读建议：&lt;/p>
&lt;ul>
&lt;li>下载我整理的最新版的《DevOps能力成长模型》，含双模型分解图。&lt;/li>
&lt;li>阅读和参考前5年的DevOps状态调查报告，了解今年这份报告的历史和发展历程。以前的文章中有下载链接/二维码。&lt;/li>
&lt;li>阅读2019年的调查问卷的中文版，感谢中国DevOps社区翻译团队对英文原版问卷的翻译工作，如果你都不知道这些调查结果是通过什么问卷调查得出的，那真的是很可惜。如果你想用这套问卷工具在企业内部做调研，请使用前文中的免费调查服务申请流程。样例问卷的访问地址：&lt;a class="link" href="https://www.wjx.cn/jq/43837840.aspx" target="_blank" rel="noopener"
>https://www.wjx.cn/jq/43837840.aspx&lt;/a>&lt;/li>
&lt;li>在Google的网站上做极简版DevOps行业基础测试，它是6年行业调查结果数据库的首次对外开放。&lt;/li>
&lt;/ul>
&lt;h2 id="模型是怎么诞生的">模型是怎么诞生的？
&lt;/h2>&lt;p>首先，我们需要了解一下这份持续了6年的报告是谁主导并开发的？这是一个怎样的团队？从DORA公司网站的这个页面上，可以看到团队人员介绍。&lt;a class="link" href="https://devops-research.com/about.html" target="_blank" rel="noopener"
>https://devops-research.com/about.html&lt;/a> 如下所示。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567336555/1sajldfkj.png"
loading="lazy"
>&lt;/p>
&lt;p>不做其它任何解读和评论，只想请大家关注一下分析报告的主持者的title : Dr Nicole Forsgren, CEO and Chief Scientist ; 翻译一下 Nicole Forsgren 博士，CEO和首席科学家。她是一个长期的IT行业从业人员，最早专注于DevOps的行业调研员。她持有管理信息系统的博士学位和会计硕士学位。从社交媒体上可以看出她和行业大咖Jez Humber和Gene Kim都是好朋友。&lt;/p>
&lt;p>其次，如果你也回顾了所有往届的DevOps状态调查报告，我们应该能体会到这场历时6年行业调研的基本逻辑和脉络。在第一年就已经提出了四大黄金度量指标，并且以此为主线；每年反复验证状态，以及其他相关影响因素。使用了&lt;strong>穷举&lt;/strong>的逻辑，每年根据行业的发展动态，根据和其它业内大咖的讨论，适当的加入新的调查点。当然每个调查的能力点也是需要每年反复确认和验证，调查点之间的逻辑关系也越来越明显，经过二次研究之后就形成了DevOps能力成长模型。&lt;/p>
&lt;p>最后，DevOps能力成长模型诞生于《Accelerate:The Science of Lean Software and DevOps: Building and Scaling High Performing Technology Organizations 》这本书。
&lt;a class="link" href="https://www.amazon.com/Accelerate-Software-Performing-Technology-Organizations/dp/1942788339" target="_blank" rel="noopener"
>https://www.amazon.com/Accelerate-Software-Performing-Technology-Organizations/dp/1942788339&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1530036828/Accelerate.jpg"
loading="lazy"
>&lt;/p>
&lt;p>在这本书里分模块（局部）的介绍了DevOps能力模型的影响逻辑关系，从转型型领导力一直推导出模型的最右侧：组织效能和非商业效能。这个模型应该就是历届DevOps状态调查研究背后的理论基础，当然它也应该是慢慢发展和完善出来的，起码数字转型这个话题是2018年才出现的热点。模型的数值计算算法，见近两年报告的附录部分。这个模型在本书中是从各个不同的局部关系逐渐介绍的。如下图所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567337105/3-jsfjaksjf333.png"
loading="lazy"
>&lt;/p>
&lt;p>Accelerate全书的逻辑不仅在于介绍各种DevOp实践、技术、文化、领导力等等相关因素有哪些，更重要的是揭示出这些影响因素（能力点）之间的关联关系。在书的最后展示了DevOps能力成长模型的全图，如下图所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567337168/4-ruwiur848.png"
loading="lazy"
>&lt;/p>
&lt;p>Accelerate这本书也提供了这幅图的电子版下载链接：&lt;a class="link" href="https://devops-research.com/assets/transformation_practices.pdf" target="_blank" rel="noopener"
>https://devops-research.com/assets/transformation_practices.pdf&lt;/a>&lt;/p>
&lt;p>这是一份非常棒的学习资料，如果你还没有买本书的话，也可以下载学习这份精华资料。这份文档的总标题是：”调研总体策划“，除了模型之外该文档还提供了一张全面复杂的表格，表格的名字：”高效能团队，管理、领导力行为和实践调查表，由Steve Bell，Karen Whitley Bell“；如果你想对自己的组织进行全面的调研的话，这也是一份优秀的调研方案。调研的矩阵如下：&lt;/p>
&lt;ul>
&lt;li>纵向：文化、组织结构、直接学习和对齐价值、部署策略、通过分析提高流动性和训练有素的问题解决、工作方式节奏化&amp;amp;日常化&lt;/li>
&lt;li>横向：团队实践、管理实践、领导力实践。&lt;/li>
&lt;/ul>
&lt;p>我很有幸2017年在北京DevOpsDays大会上参加Jez先生的培训，并获赠了Jez先生的签名版《Accelerate》纸版书，其实在这以前我已经购买了Kindle的电子版和Audible的有声书版。我反复研读了这本书的各种版本，再次强烈推荐所有DevOps相关的管理者一定要学习这本书。&lt;/p>
&lt;p>以书中的模型为基础，2018年的DevOps状态报告里以又进一步做了各种扩展，如果你读过去年的报告，你可以看到如下的各种局部的扩展。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567337168/7asdfweruui238.png"
loading="lazy"
>&lt;/p>
&lt;p>大家注意看2018年的这个局部模型图的标题”精益和敏捷实践“，这里也包含敏捷开发实践。我在反复琢磨这个模型之后，用Twitter私信问过Nicole博士。我问他为何没有专项调查过敏捷开发实践？模型上为何不给敏捷开发一个位置？她的回复是，我们之前已经调研过了，而且模型上也提到了。可能在全球的软件开发工程水平看，有可能Nicole博士团队认为敏捷开发应该是比较基础的软件开发实践，据我个人了解国外高水平公司要么都已经规范照做了，要么也有像Google这样的高水平公司确实也不显性的宣传自己是敏捷开发，甚至吐槽敏捷的。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567337168/8jfasjflsdf.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567337168/9ruwueriowur.png"
loading="lazy"
>&lt;/p>
&lt;p>2018年对模型的扩展力度还是很大的，提出了很多新的调查项；为了能看到方便的看到一个DevOps能力模型的全景视图，我使用OmniGraffle软件基于《Accelerate》书中的模型，扩充绘制了如下的模型图：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567338260/12-23ru83.png"
loading="lazy"
>&lt;/p>
&lt;p>这幅图向我们完整的揭示了到2018年以来的所有DevOps调研点，有些点是经过多年反复验证的，有些是2018年新引入的。这幅图花了我几天时间，在这个过程中也反复的推敲了其中的逻辑关系。这幅图仅代表我个人的观点，不代表DORA和《Accelerate》书籍的任何观点；需要声明的是：我绘制的DevOps能力成长模型并非我的个人著作，引用了DORA和《Accelerate》的著作，但我力求精确无误的表达整个模型。再次声明，这个模型图非官方出品，是我的个人研究。&lt;/p>
&lt;p>研究模型的研究逻辑是穷举法，是从左到右的推导和影响关系。最新发布的2019年DevOps状态调查报告显示了新的变化，这触发了对以上模型的更新。本文将提供最新版高清大图的下载。&lt;/p>
&lt;h2 id="为何两个模型">为何两个模型？
&lt;/h2>&lt;p>为何2019年会分化出两个模型，简单的讲：穷举的范围越来越大了，生产力作为一个新的全局共享目标进入了调查问卷的范围。我们之前社区的小伙伴已经将2019年的近100道调查题问题翻译成中文了，敬请参阅参考DevOps状态调研问卷。在翻译完那些题目后，我并没有意识到今年可能会新增出这样一个全局共享目标的调研对象，真的以为：这个效能模型（组织效能和非商业效能）会一条道走到最后。&lt;/p>
&lt;h3 id="效能模型">效能模型
&lt;/h3>&lt;p>对效能模型的更新变化如下图所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567339754/2019-dora-perf.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="生产力模型">生产力模型
&lt;/h3>&lt;p>新增的生产力模型令我感到相当意外，它的结构如下所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567339754/2019-dora-prod.jpg"
loading="lazy"
>&lt;/p>
&lt;p>总之，还无法预测明年的调研范围会有怎样的更新。可以确认的是行业DevOps的能力模型是在动态变化的，想跟上世界级的水平还必须不断刷新自己的能力组合。否则你的同行的对手可能早就一骑绝尘而去了。DevOps能力发展不是一个有限游戏（例如刷黄金5级），是每年都和整个行业一起发展的无限游戏。&lt;/p>
&lt;h2 id="如何使用模型">如何使用模型？
&lt;/h2>&lt;p>2019年的报告中给出了模型的使用和阅读方法的官方解释，见2019年报告英文原版的27页。本文对其的解读如下。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567379589/11-3kgsfdgjds.png"
loading="lazy"
>&lt;/p>
&lt;h3 id="使用模型指导转型">使用模型指导转型
&lt;/h3>&lt;p>识别你将要改善的能力点。模型中的每个被箭头所指向的方块被称之为构造，构造有单级构造，也有二级构造（如精益产品开发、软件开发实践），历年来的报告中已经为你展示和所有DevOps能力点，你现在需要做的是从中选择出你需要改进的候选能力点。&lt;/p>
&lt;p>开展加速度的组织转型需要一个前提条件，一个扎实的基础作为起点。报告中并没有解释这个条件，你需要自己理解。聚焦在转型所急需的那些候选能力点上，在多个候选能力点里选择出亟需改进的”约束点“「此处参考TOC限制理论，相关书籍《目标》」。想想：那些能力的不足造成了最大的延期？「记住这里说的是最大值，这需要一个量化的跨组织的分析调研」什么最让你头痛？什么是最大的问题？经过以上的引导问题的提示，从清单中选出3~5个候选优化发展的能力项，安排出专项人力和财力资源，先重拳出击改善第一波能力点。不要担心你还有其他的很多问题；现阶段不妨聚焦在那个最大的问题上；这样你才能将瓶颈（约束点）各个击破，发掘这个其他的协同功效，避免不必要的工作。这个部分基本上是经典TOC理论的应用，关于这个理论在DevOps实施中的详细使用方法描述，请参考《DevOps实践指南》的第二章 2.5 持续识别和改善约束点。&lt;/p>
&lt;p>以上DevOps转型工作还有其他的产出。那些追求SDO组织效能的组织还会得到这些收益，降低职业透支（996icu）和部署的痛，提高安全水平。附加的好处还包括，它能提高生产力，提高了生产力就可以获得工作生活平衡且降低职业透支。&lt;/p>
&lt;h3 id="怎样阅读模型">怎样阅读模型？
&lt;/h3>&lt;p>报告使用了结构方程模型 （Structural equation modeling &lt;a class="link" href="https://en.wikipedia.org/wiki/Structural_equation_modeling%ef%bc%89" target="_blank" rel="noopener"
>https://en.wikipedia.org/wiki/Structural_equation_modeling）&lt;/a> ，来作为一种预测模型，用它测试各个构造之间的关系。模型中的每个方块就是一个调研度量的点，就是一个构造。剪头表示了构造之间的关系。一个大的包含多个构造的方框称之为二级构造。淡蓝色的构造表示一个控制变量，它用点线连接。&lt;/p>
&lt;p>在报告原文中，将第31页和57页的模型称之为全模型，见报告的27页的原文：”See pages 31 and 57 for full models.“；而在我的系列文章中，则将下图称之为全模型。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567339751/2019-dora-DevOps-all.jpg"
loading="lazy"
>&lt;/p>
&lt;p>以上阅读方法同样的适用于上图。总之请仔细理解了左下角的图例，正确的阅读和理解模型。不管你是将DevOps实践的实施视为组织转型也好，把它当做项目做也罢；当你识别你的目标的时候，都可以参考这个模型。&lt;/p>
&lt;h3 id="两个研究模型的重叠">两个研究模型的重叠
&lt;/h3>&lt;p>由于SDO效能和生产力在很多方面本来就是相关的。它们的产出都是使用各种优秀的方法创造和交付各种技术，从而为组织和个人交付价值。那些优化软件交付的支持工作也将使生产力受益，这也是理所当然的。虽然他们的某些诱因是相同的，它们看起来很相似，但是他们度量的产出确实不同的，报告团队也是组织了独立的分析调研。总之，SDO效能和生产力是两个不同的调研模型。&lt;/p>
&lt;h3 id="重叠模型的妙用">重叠模型的妙用
&lt;/h3>&lt;p>当你在应用SDO效能模型的时候，可以在消减职业透支方面做出聪明点的投资，更高的生产力也同样能降低职业透支。因此这个应该是向各种组织和技术团队大力提倡的做法，由于工作需求是持续增长的。工作是没完没了的，这个项目完了，还有下一个项目。而我们需要注意，我们也要关注生活和工作的平衡，而降低职业透支。&lt;/p>
&lt;p>心理安全性文化也能对SDO效能、组织效能和生产力作出贡献。研究结果表明了创造和发展健康的文化对组织和个人都有好处。&lt;/p>
&lt;p>投资在代码可维护性、松耦合架构和监控方面，也能同时帮助SDO效能、生产力（它们是通过消减技术债间接的影响到生产力的）。好的工具和系统也非常值得关注。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>通过本文我相信你已经可以正确的理解2019年状态报告中的模型了，模型包括SDO效能模型和生产力模型。包括我绘制的全模型。希望DORA官方能后续推出官方版模型全图。&lt;/p>
&lt;blockquote>
&lt;p>模型的意义在于：DevOps能力点是整个软件开发和交付行业都应该关注的，在投资DevOps实践的时候，需要能聚焦到组织各自不同的急需改进的能力约束点组合上。通过模型最右侧的组织级统一共享目标来度量和验证DevOps的实践是否实际有效。&lt;/p>&lt;/blockquote>
&lt;p>TOC是一个值得关注的问题解决套路，参考其它的相关文章和其它各种书籍。&lt;/p>
&lt;p>请关注DevOps教练的公众号，在后台输入2019，下载本文中各种模型的高清大图。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566516259/DevOps-Coach-qrcode_for_gh_bce38ef330e5_430.jpg"
loading="lazy"
>&lt;/p>
&lt;hr></description></item><item><title>如何做横向行业的DevOps表现基准测试？</title><link>https://martinliu.cn/blog/2019-state-devops-report-insight-1/</link><pubDate>Wed, 28 Aug 2019 07:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/2019-state-devops-report-insight-1/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/1-jafadjf.jpg" alt="Featured image of post 如何做横向行业的DevOps表现基准测试？" />&lt;p>长期关注我的blog和微信公众号（DevOps教练）的朋友可以发现，我今年从这个调查问卷开始，陆续发布了一些列文章。如果给这些文章一个文集标题的话，那么应该是：死磕2019年加速度全球DevOps状态调查报告系列。 为了帮助大家充分利用这份优秀的行业报告，我会用一些列文章，分章节的解读这份长达80多页的报告。上一篇文章如果你已经解读了该报告的核心重要发现和看点。本文要覆盖的章节是 How do we compare 这一章。&lt;/p>
&lt;p>本文的阅读建议：&lt;/p>
&lt;ul>
&lt;li>先阅读和参考前5年的DevOps状态调查报告，了解今年这份报告的历史和发展历程。以前的文章中有下载链接/二维码。&lt;/li>
&lt;li>阅读2019年的调查问卷的中文版，感谢中国DevOps社区翻译团队对英文原版问卷的翻译工作，如果你都不知道这些调查结果是通过什么问卷调查得出的，那真的是很可惜。如果你想用这套问卷工具在企业内部做调研，请使用前文中的免费调查服务申请流程。样例问卷的访问地址：&lt;a class="link" href="https://www.wjx.cn/jq/43837840.aspx" target="_blank" rel="noopener"
>https://www.wjx.cn/jq/43837840.aspx&lt;/a>&lt;/li>
&lt;li>在Google的网站上做极简版DevOps行业基础测试，它是6年行业调查结果数据库的首次对外开放。&lt;/li>
&lt;/ul>
&lt;h2 id="why-devops">WHY DEVOPS？
&lt;/h2>&lt;p>这是一个可以持续反复问自己的问题，首先让我们澄清一件事情：为什么要做DevOps？&lt;/p>
&lt;p>是否是为了提高研发效能？是否是为了提高生产力？是否是为了提高效率？这些答案可能都对，也可都不对。对于一个组织而言：如果IT对它的使命和目标至关重要的情况下，组织对IT会产生强依赖关系，DevOps才对该组织才有意义。历年来的DevOps状态调查告诉我们：DevOps对于那些以IT为命脉的组织而言直观重要，对所有从事软件交付的组织广泛有效。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/12-23ru83.png"
loading="lazy"
>&lt;/p>
&lt;p>从DevOps能力成长模型中可以看出，图中的诸多能力项都正向贡献/预测到最右侧的两个组织级别目标，他们是：组织效能和非商业效能（商业和非商业目标），它们是：&lt;/p>
&lt;ul>
&lt;li>盈利能力 （商业）&lt;/li>
&lt;li>生产力&lt;/li>
&lt;li>市场份额 （商业）&lt;/li>
&lt;li>客户数量 （商业）&lt;/li>
&lt;li>产品或服务的数量 （商业）&lt;/li>
&lt;li>运营效率&lt;/li>
&lt;li>客户满意度 （商业）&lt;/li>
&lt;li>提供的产品或服务的质量 （商业）&lt;/li>
&lt;li>实现组织或使命目标&lt;/li>
&lt;/ul>
&lt;p>如果你的某项/某几项DevOps实践能够直接贡献到以上的商业目标，或者说能持续的创造客户价值，即商业价值；那么你的DevOps就是成功的。反之，如果你仅仅期望研发效能、生产力、效率能够就等同于创造出了很多的客户价值，那是一种幻觉；这就像是：你经过了很多预赛和体能的准备，而在冠军争夺赛中，你依然名落孙山，当你的组织的绩效远远低于预期的商业目标的时候，你的各种XXX效率都是无用的。&lt;/p>
&lt;h2 id="四大黄金度量指标">四大黄金度量指标
&lt;/h2>&lt;p>6年来的DevOps状态调查报告（我只关注DORA主导和执行的这个）已经在用量化的方式，帮助我们作出了精英表现者的画像，当然还有其它的落后者。可以明确的一点是：强者从四个维度上同时都表现强劲。（去年已经打破了常见的一个误区：过度的保守主义导致在组织四个指标之中做折中选择，常见的是牺牲吞吐量指标，确保稳定性，可是后果往往是相反的。）&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/10-2373.png"
loading="lazy"
>&lt;/p>
&lt;p>先来回顾和梳理所谓的四大黄金度量指标的分类：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>吞吐量&amp;ndash;部署频率&lt;/strong>：对于您工作的主要应用程序或服务，您的组织在生产环境进行代码部署或向最终用户做发布的频率。调查这个指标的问题见2019年加速度DevOps状态调查问卷中的第二部分的第二题。&lt;/li>
&lt;li>&lt;strong>吞吐量&amp;ndash;前置时间&lt;/strong>：对于您工作的主要应用程序或服务，从代码提交到在生产中成功运行的过程需要的时间。调查这个指标的问题见2019年加速度DevOps状态调查问卷中的第二部分的第一题。&lt;/li>
&lt;li>&lt;strong>稳定性&amp;ndash;服务恢复时间&lt;/strong>：对于您工作的主要应用程序或服务，当服务中断或出现影响用户Bug时（如：计划外中断、服务受损），恢复服务通常需要的时间。调查这个指标的问题见2019年加速度DevOps状态调查问卷中的第二部分的第四题。&lt;/li>
&lt;li>&lt;strong>稳定性&amp;ndash;变更失败率&lt;/strong>：对于您所工作的主要应用程序或服务，对于生产变更，或向最终用户发版的变更，百分之多少会导致服务质量下降（如：服务受损或服务中断），并需要进行后续的修复工作（需要热补丁、回滚，前向修复，打补丁修复）。调查这个指标的问题见2019年加速度DevOps状态调查问卷中的第二部分的第五题。&lt;/li>
&lt;/ul>
&lt;p>上面的四个指标是DevOps状态调查报告使用cluster算法做受众分类的主要依据，这个类聚分析的结果就是那张四大DevOps等级的泡泡图。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567001372/11-w97459438isuuf.png"
loading="lazy"
>&lt;/p>
&lt;p>在这个泡泡图中，我们可以看到有多少比例的受访者处于精英、高效、中等和低效的阵营。复述一下今年的一个重大发现：精英表现者已经从去年的高效能表现者集团中脱颖而出，他们在指标的绝对值和总体数量上都增长迅敏，增长率高达将近3倍。&lt;em>【DevOps教练点评：回顾一下这份报告的标题中加入的加速度的关键字，一旦某个组织的实施方法得当，一个持续优化的组织的整体效能就可能做上火箭，加速度的飞离地球。而加速度不足的企业则处于持续跌回地面的窘境。】&lt;/em>&lt;/p>
&lt;p>这四大黄金度量指标的采集方法就是调查问卷中那些四个问题。对所有实践DevOps的组织而言，我们需要的是持续实施和优化追踪这些度量指标的方法和系统，确保能实时查看这四个指标的状态是最完美的。可是目前几乎还没有什么企业能够做到，手工分别统计上报，定期公布到全体IT部门也是非常可取的做法。总之，没有度量就不存在管理，就无从系统性的改进。&lt;/p>
&lt;h2 id="我在行业里的表现如何">我在行业里的表现如何？
&lt;/h2>&lt;p>这是我写作本文想要回答的核心问题。如果你能够度量自己的四个黄金指标了，也能够随时拿出一组确切的数据，我们就能做行业基准测试比较了。&lt;/p>
&lt;p>这可能是Google收编DORA团队所买到的最有价值的一部分资产，历年来的DevOps调查问卷参与者的问卷答案数据库。Google今年将这个数据库向公众开放了，网址在 &lt;a class="link" href="https://beta.devops-research.com/performance.html" target="_blank" rel="noopener"
>https://beta.devops-research.com/performance.html&lt;/a> (这个网址应该不用科学上网，会出现证书错误提示，请忽略继续访问该页面)。在你回答了下面的五个问题后，就可以获得一份自己的行业基准测试报告。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/2-faldjfald.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/3-adfjafdasldf.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/4-9578921374.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/5-faljdfl2e44.png"
loading="lazy"
>&lt;/p>
&lt;p>最后一个问题是，从13个行业中选择出一个最合适的所在行业。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/6-ajflasjfd22.png"
loading="lazy"
>&lt;/p>
&lt;p>下图是你在整个所有行业里的横向对比。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/7-fjlasf.png"
loading="lazy"
>&lt;/p>
&lt;p>下图是你在所在行业里的横向对比。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/8-ajflasjf2.png"
loading="lazy"
>&lt;/p>
&lt;p>下图是四个黄金指标在四个表现级别/集团上的度量；表明你每个指标处于哪个等级。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/9-asjfl23uu.png"
loading="lazy"
>&lt;/p>
&lt;p>经过以上的最简版DevOps表现状态基准测试以后，你就看到了你在所有行业中和所在行业中的横向比较。当然，我们也能预测一下自己处于那个阵营和等级。然而，这并不是你的DevOps旅程的剧终情节。&lt;/p>
&lt;p>所有DevOps的实践者一旦上路以后，都是一条不归路的感觉，我们可以定期的关注我们的基准测试结果，并观察自己在动态变化的行业基线中的位置，而更重要的是：找到每个现阶段的改进空间，并且持续突破自己DevOps的能力瓶颈和极限。持续的无限制的加速度发展所有DevOps能力点才是这个DevOps旅程的终极意义。&lt;/p>
&lt;h2 id="关于服务运维效能">关于服务运维效能
&lt;/h2>&lt;p>服务效能指标是在去年的效能报告中新引进的，而在去年和今年的调查问卷和结果报告中并没有直接的关于这项指标的采集数据和结果。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/10-2373.png"
loading="lazy"
>&lt;/p>
&lt;p>从上图中我们可以直接的理解一下，左侧的四大黄金指标都关乎于软件开发部门，而这个指标关乎于服务运维部门。去年并没有给出关于可用性指标的度量方法，今年也没有在调查问卷中做直接/显性的问题设置。只是在今年2019年的报告中做了进一步的解释，说这个可用性指标的实施方法论是SRE套路。我正在翻译SRE Workbook，这本书比起之前翻译的DevOps Handbook，更具有实操性。我们拭目以待，明年的状态调查问卷是如何对可用性设问和调查分析的。关于SRE的基础概念和实施方法，心急的朋友不妨参加中国DevOps社区今年10月在杭州举办的年度大会，我有一个关于SRE的主题分享，让我们一起讨论SRE的落地套路，让用SRE套路使我们的DevOps故事闭环。&lt;/p>
&lt;p>总之我们实践DevOps的时候要全局的关注“软件交付和运维效能”，简称SDO效能（software delivery and operational performance）；有O了才完整的闭环了。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>本文写道这里，我认为你可以无障碍的阅读2019年加速度全球DevOps状态调查报告到第25页了。我们总结一下，你应该能理解吞吐量和稳定性的四大黄金度量指标的定义；持续度量和关注这些指标的正确方法；使用Google所提供的极简版度量工具，找到自己在行业中的定位和所处的效能级别。关注SDO效能的完整性，尝试了解和实践SRE实践，让你的DevOps体验闭环和完整起来。下一期死磕2019年加速度全球DevOps状态调查报告系列将为你呈现更新版本的DevOps能力成长模型，进一步讲解如何应用今年分化出来的两个研究模型：SDO和组织效能模型与生产力模型。&lt;/p>
&lt;hr></description></item><item><title>2019年加速度DevOps状态调查报告-导读</title><link>https://martinliu.cn/blog/2019-state-devops-survey-report/</link><pubDate>Thu, 22 Aug 2019 07:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/2019-state-devops-survey-report/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/abstract-4.jpg" alt="Featured image of post 2019年加速度DevOps状态调查报告-导读" />&lt;p>凭借六年多的来自全球31,000多名专业人士的数据的研究，2019年加速发展状态报告是同类研究中规模最大、持续时间最长的研究。2019年加速度DevOps状态调查首发，首发的位置在Google Cloud网站上的Blog栏目，发布于产品新闻分类下。&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>文章使用的主标签 DevOps 、SRE。&lt;/li>
&lt;/ul>&lt;/blockquote>
&lt;ul>
&lt;li>文章地址：&lt;a class="link" href="https://cloud.google.com/blog/products/devops-sre/the-2019-accelerate-state-of-devops-elite-performance-productivity-and-scaling" target="_blank" rel="noopener"
>https://cloud.google.com/blog/products/devops-sre/the-2019-accelerate-state-of-devops-elite-performance-productivity-and-scaling&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>下文为对Google文章原文的翻译和整理。并且加入了我本人的各种判断和见解。&lt;/p>
&lt;p>关于今年的DevOps状态调查报告有什么更新和变化？报告文章中给我们了一句话的概要介绍：今年会对部署工具链、云计算、灾难恢复和工作方式等主题进行深度调查。更详细的情况，详细的参过问卷调查的您自有评判。&lt;/p>
&lt;p>‘DevOps之研究和评估’（DORA）是通过数据驱动的洞察力，帮助组织实现DevOps和高效能组织的先驱，而Google Cloud很高兴地宣布推出2019年加速DevOps报告 。（前期文章介绍过DORA加入Google Cloud的细节） 该报告提供了DevOps行业的全景视图，为各种规模和所有行业的组织提供可操作的指导，从而提高他们的软件交付效能，最终使之成为精英DevOps实践者。&lt;/p>
&lt;h2 id="2019年的新洞见">2019年的新洞见
&lt;/h2>&lt;p>我们看到：有持续的证据表明了软件的速度、稳定性和可用性有助于提高组织绩效，今年我们能够发现一些关于推动DevOps高绩效表现，以及实践和功能的新洞见。 部分如下所示：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>DevOps已经‘跨越了鸿沟’&lt;/strong>：各个行业的组织继续地提高着他们的DevOps专业知识，特别是在表现最高那部分人群中。 精英表现者的比例几乎提高了两倍，目前他们占所有组织的&lt;em>20％。 这也得到了其他行业分析师报告的证实。&lt;/em>【教练解读：精英表现者实现了从7%到20%的增长。】&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566509912/DevOps_insights.0986061310991192.max-2000x2000.png"
loading="lazy"
alt="DevOps insights"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>精英表现者更有可能使用云计算 ：快速自动扩缩容、成本可见性和可靠性是云计算提供的一些关键优势。更具国家标准与技术研究院（NIST）定义的云计算所具有的五项特征功能，效能最高的DevOps团队比低效能团队在这些方面执行的可能性高24倍，5大特性包括按需的自助服务、广泛的网络访问、资源池，快速弹性和可度量的服务。 &lt;em>【教练解读：你们家使用的云计算是假的。】&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>大多数云计算用户并未充分发挥其潜力 ：只有29％的使用云计算的受访者符合NIST上述的五项标准特征。 这证明了这样一个事实，即声称使用云计算的组织，未必采用了所有必要的云计算特征模式来实现精英水平的业绩，这也有可能会阻碍他们通过云计算获益。 &lt;em>【教练解读：你号称的优势正在阻碍你。】&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>首次呈现出了行业差异性 ：在今年的报告中，零售行业在速度和稳定性方面都展示出了更好的表现。然而，与前几年保持一致的是，根据持续的证据表明，DevOps更好或更差的表现，并没有其行业的差异性。这依然表明：各种类型和规模的组织，包括金融服务、政府和零售等高度监管的行业，也都是可以通过应用DevOps实践来实现高水平的绩效。【教练解读：今年零售业做的很突出，还是你们进来刷榜了？】&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DevOps走进企业 - 第1部分 ：我们首次发现，根据证据显示大型企业组织（员工人数超过5,000人）的效能低于小型企业（员工人数少少于5,000人）。重量级的流程和控制措施，以及紧耦合的体系架构是导致较低速度，以及相关不稳定性的部分原因。&lt;em>【教练解读：大型组织的坑也更大。】&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DevOps走进企业 - 第2部分 ：我们的分析显示最高能的DevOps表现者（即高级和精英表现者），专注于通过结构化的解决方案来构建DevOps社区，这些解决方案包括以下四种模式之一：社区建设者、大学、涌现和实验者（Community Builders, University, Emergent, and Experimenters）。&lt;em>【教练解读：需要给它山之石提供存在的土壤。】&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>没有“一刀切”的方法，成功有赖于一致的努力付出 ：在投资于DevOps的各项能力时，特别是在大型组织中，需要同时关注团队级别和组织级别的工作成果。在团队层面上，持续集成、自动化测试和监控等实践的一些工作投入运作良好。组织级能力包括：在多个部门和团队之间，设置系统体系结构或变更审批策略的能力。 该报告分解了这些能力并概述了应该采取的策略，因此您也可以执行相关的DevOps策略，并从中获得最大的效果。&lt;em>【教练解读：单纯的刷某个团队或者项目也是然并卵。】&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>表现较差的组织比高级和精英表现者使用的软件更多 ：维护和支持私有商业软件的成本可能过高，这促使高级和精英表现者使用开源解决方案。 这和以前报告中的结果一致。 事实上， 2018年的加速度 DevOps报告就表明，精英表现者大量使用开源组件、库和平台的可能性是其它组织的 1.75倍。&lt;em>【教练解读：开源软件正在吞噬着整个世界。】&lt;/em>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="你如何改进devops">你如何改进DevOps？
&lt;/h2>&lt;p>今年的报告提供了有助于推动DevOps改进性能和生产力的两种研究模型。&lt;/p>
&lt;p>&lt;strong>效能研究模型&lt;/strong> 着眼于哪些能让你提升组织绩效的结构和抓手，提供相关的云计算、持续交付、灾难恢复测试，明确变更管理和心理安全文化是如何对软件交付绩效产生积极作用的见解。 本次研究还发现重量级的变革流程是不起作用的。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566512814/performance_research_model.max-2000x2000.png"
loading="lazy"
alt="效能研究模型"
>&lt;/p>
&lt;p>图片翻译参考：&lt;/p>
&lt;ul>
&lt;li>左侧的一列，从上至下：清晰的变更流程、重量级变更流程、灾难恢复测试、代码的可维护性、松耦合的架构、监控、主干开发、自动化部署。&lt;/li>
&lt;li>中间的一列，从上至下：心理安全感文化、持续交付、云计算、持续集成、自动化测试。&lt;/li>
&lt;li>右侧的一列，从上至下：行业（控制）企业（控制）、工作恢复、透支&lt;/li>
&lt;li>图例，从上至下：结构、二级结构、团队或者组织的统一目标、控制变量、正向预测关系、双向影响、负面影响关系、粗体字-今年新的调查结果（左侧1～4，中间1）&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>生产力研究模型&lt;/strong> 表明：组织可以通过投资易于易用的工具和信息搜索引擎、心理安全文化，以及消除技术债务的方式来提高工程师的生产力。 提高生产力还有助于提高员工的工作-生活平衡，并降低职业透支（教练注释-996icu）。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566513555/productivity_research_model.max-1600x1600.png"
loading="lazy"
alt="生产力研究模型"
>&lt;/p>
&lt;p>图片翻译参考：&lt;/p>
&lt;ul>
&lt;li>左侧的一列，从上至下：实用且易用的工具、内部搜索引擎、外部搜索引擎、代码可维护性。&lt;/li>
&lt;li>中间的一列，从上至下：心理安全感文化、生产力、技术债、松耦合的架构、监控。&lt;/li>
&lt;li>右侧的一列，从上至下：多年的经验（控制）、SDO效能、软件交付效能、可用性、组织级效能、透支&lt;/li>
&lt;li>图例，从上至下：结构、正向预测关系、负面影响关系、团队或者组织的统一目标、控制变量、弱关联性、粗体字-今年新的调查结果（左侧1～4，中间1～2，右侧2）&lt;/li>
&lt;/ul>
&lt;p>今年的报告再次确认了连续第六年各种重要发现：首先，可以在不牺牲速度的情况下优化稳定性。 其次，DevOps通过影响商业和非商业目标为​​客户和最终用户提供价值。&lt;/p>
&lt;p>感谢为调查做出贡献的所有人。 我们希望此报告能够帮助各种规模，行业和地区的组织改进。 我们期待听到您对报告的想法和反馈。 您可以通过以下方式了解有关2019年加速状态报告的更多信息。&lt;/p>
&lt;h2 id="相关材料和扩展">相关材料和扩展
&lt;/h2>&lt;h3 id="报告尝鲜试读">报告尝鲜试读
&lt;/h3>&lt;h4 id="报告封面">报告封面
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518180/state-of-devops-2019.jpg"
loading="lazy"
>&lt;/p>
&lt;p>关注点：DORA + Google， 新的赞助商的支持。&lt;/p>
&lt;h4 id="报告目录">报告目录
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518068/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.51.36.png"
loading="lazy"
>&lt;/p>
&lt;p>目录结构很类似，内容大不同。&lt;/p>
&lt;h4 id="devops四大核心度量指标">DevOps四大核心度量指标
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518068/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.51.58.png"
loading="lazy"
>&lt;/p>
&lt;p>四个级别的表现者在四大度量维度上的比较，以及今年的数据更新。&lt;/p>
&lt;h4 id="精英表现者">精英表现者
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518069/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.52.10.png"
loading="lazy"
>&lt;/p>
&lt;p>他们始终遥遥领先。重点是所有的指标同时都好。&lt;/p>
&lt;h4 id="两大研究模型的分化">两大研究模型的分化
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518069/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.52.23.png"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>效能模型&lt;/li>
&lt;li>生产力模型&lt;/li>
&lt;/ul>
&lt;h4 id="灾难恢复测试">灾难恢复测试
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518069/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.52.49.png"
loading="lazy"
>&lt;/p>
&lt;p>灾难恢复测试和DevOps强相关。&lt;/p>
&lt;h4 id="心理安全性">心理安全性
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518068/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.53.04.png"
loading="lazy"
>&lt;/p>
&lt;p>文化建设的一个关键组成。&lt;/p>
&lt;h4 id="devops转型的策略一览表">DevOps转型的策略一览表
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518068/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.53.41.png"
loading="lazy"
>&lt;/p>
&lt;p>你们都用了哪些推广DevOps的策略呢？抱歉并没有刷成熟度这一项。&lt;/p>
&lt;h3 id="下载报告">下载报告
&lt;/h3>&lt;p>目前Google的官网上提供了所有DORA的DevOps状态调查报告的下载包括2019年度最新的状态调查报告。为了方便国内DevOp实践者的学习，我将它下载到了百度网盘。请大家需要的按照一下方法下载阅读。&lt;/p>
&lt;p>报告下载方法：&lt;/p>
&lt;ol>
&lt;li>扫码下面的二维码，关注DevOps教练的微信公众号&lt;/li>
&lt;li>进入DevOps教练的微信公众号的文字输入状态&lt;/li>
&lt;li>输入数字 ： 2019&lt;/li>
&lt;li>识别自动回复的二维码&lt;/li>
&lt;li>下载pdf版本的2019加速度DevOps状态调查报告&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566516259/DevOps-Coach-qrcode_for_gh_bce38ef330e5_430.jpg"
loading="lazy"
alt="DevOps教练"
>&lt;/p>
&lt;h3 id="使用2019调查问卷服务">使用2019调查问卷服务
&lt;/h3>&lt;p>前面的文章发布了2019DevOps问卷调查的中文翻译版本，&lt;a class="link" href="https://martinliu.cn/posts/2019-state-devops-survey-chinese-version/" target="_blank" rel="noopener"
>https://martinliu.cn/posts/2019-state-devops-survey-chinese-version/&lt;/a> 这是对原版英文调查问卷的翻译，由中国DevOps社区翻译组完成，现在我们已经将它通过问卷星平台转化成了可以使用的调查服务。&lt;/p>
&lt;p>如果你的企业正在实施DevOps，如果你想了解一下这种称之为DevOps的科学的调查问卷，不妨可以通过下面的流程申请使用这个问卷服务：&lt;/p>
&lt;ol>
&lt;li>发邮件到 &lt;a class="link" href="mailto:info@DevOpsChina.org" >info@DevOpsChina.org&lt;/a> ；邮件标题为 dora 2019&lt;/li>
&lt;li>邮件内容请包含：公司名称、使用范围（全公司、团队）、使用其实时间、联系人姓名、联系人手机/微信、调查问卷的套数（题套问卷对应一个网站，可下载一份数据采集结果）&lt;/li>
&lt;li>本服务为免费社区服务，在收到邮件后就会尽快为您提供所需要数量的网址，并在约定的结束时间发送调查结果到你的邮箱。&lt;/li>
&lt;/ol>
&lt;h2 id="后续">后续
&lt;/h2>&lt;p>经过了多年对这项行业顶级调查问卷和报告的追逐。今年的报告内容量大，新发现多，而且引入了新的研究模型。我会从内容和模型层面做更多的总结和研究。后续用一系列的文章进行报道。请关注“DevOps教练”微信号的更新文章和本网址的更新。&lt;/p>
&lt;hr></description></item><item><title>中文版：2019年DevOps状态调查问卷</title><link>https://martinliu.cn/blog/2019-state-devops-survey-chinese-version/</link><pubDate>Mon, 06 May 2019 12:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/2019-state-devops-survey-chinese-version/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-dora.png" alt="Featured image of post 中文版：2019年DevOps状态调查问卷" />&lt;p>本文是中文版《2019年加速度DevOps状态调查》问卷。如果你还没有填写该问卷的话，可以在线上填写英文版，点击这个链接 &lt;a class="link" href="https://bit.ly/2UzLMH2" target="_blank" rel="noopener"
>https://bit.ly/2UzLMH2&lt;/a> ，进入问卷调查网站。本文可以作为你的帮助文档。&lt;/p>
&lt;blockquote>
&lt;p>译者团队：刘征、张晔、刘頲、朱婷、王英伟、王虹、李建芳、沈越飞、井建宇、申屠欣欣&lt;/p>&lt;/blockquote>
&lt;p>本文由以上翻译团队经过两周的时间，在业余时间翻译完成，如果对本文有任何改进建议请发邮件到 martin AT DevOpsCoach.org&lt;/p>
&lt;p>发布本文的另外一个原因：作为历时6年，被称之为DevOps界之科学的调查研究，我们可以透过这套问卷，洞察如何用问卷的方式定量的度量DevOps的现状。对于已经实施了多年DevOps企业，本问卷可谓是一道营养丰富的大餐。&lt;/p>
&lt;h2 id="历年来的devops状态报告">历年来的DevOps状态报告
&lt;/h2>&lt;p>如果你需要下载学习的话，请点击下面的链接（扫码二维码），这里还有历年来英文版报告全集和部分中文版本。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1555778529/reports-download.png.png"
loading="lazy"
alt="下载"
>&lt;/p>
&lt;hr>
&lt;p>下面是2019年DevOps状态调查问卷的简体中文版译文。&lt;/p>
&lt;h2 id="第一部分">第一部分
&lt;/h2>&lt;p>欢迎参加2019年全球DevOps全球行业调查。&lt;/p>
&lt;ul>
&lt;li>我们有兴趣了解您的工作方式以及工作环境。&lt;/li>
&lt;li>答案并没有对错。&lt;/li>
&lt;li>如果您不知道答案，可以选择“我不知道或不适用”，您的作答将被忽略。&lt;/li>
&lt;/ul>
&lt;p>非常感谢您花时间帮助我们去探索那些能使技术进步的秘密！&lt;/p>
&lt;h3 id="1-您的组织主要属于哪个行业">1. 您的组织主要属于哪个行业？
&lt;/h3>&lt;ul>
&lt;li>教育&lt;/li>
&lt;li>能源&lt;/li>
&lt;li>金融服务&lt;/li>
&lt;li>政府&lt;/li>
&lt;li>医疗保健和制药&lt;/li>
&lt;li>工业与制造业&lt;/li>
&lt;li>保险&lt;/li>
&lt;li>媒体/娱乐&lt;/li>
&lt;li>非盈利&lt;/li>
&lt;li>零售/消费品/电子商务&lt;/li>
&lt;li>技术&lt;/li>
&lt;li>电信&lt;/li>
&lt;li>其他。请明确说明： [____]&lt;/li>
&lt;/ul>
&lt;h3 id="2-有多少员工在您的组织里工作">2. 有多少员工在您的组织里工作？
&lt;/h3>&lt;ul>
&lt;li>1-4&lt;/li>
&lt;li>5-9&lt;/li>
&lt;li>10-19&lt;/li>
&lt;li>20-99&lt;/li>
&lt;li>100-499&lt;/li>
&lt;li>500-1,999&lt;/li>
&lt;li>2,000-4,999&lt;/li>
&lt;li>5,000-9,999&lt;/li>
&lt;li>10,000+&lt;/li>
&lt;li>我不知道&lt;/li>
&lt;/ul>
&lt;h3 id="3-你们的服务器上都部署了哪些操作系统">3. 你们的服务器上都部署了哪些操作系统？
&lt;/h3>&lt;ul>
&lt;li>Windows 2003 / 2003R2&lt;/li>
&lt;li>Windows 2008 / 2008R2&lt;/li>
&lt;li>Windows 2012 / 2012R2&lt;/li>
&lt;li>Windows 其他&lt;/li>
&lt;li>Linux Debian / Ubuntu变种&lt;/li>
&lt;li>Linux Enterprise Linux变体（RHEL，Oracle，CentOS）&lt;/li>
&lt;li>Linux Fedora&lt;/li>
&lt;li>Linux SUSE Linux Enterprise Server&lt;/li>
&lt;li>Linux OpenSUSE&lt;/li>
&lt;li>Linux Arch&lt;/li>
&lt;li>Linux其他&lt;/li>
&lt;li>其他的UNIX&lt;/li>
&lt;li>FreeBSD / NetBSD / OpenBSD系统&lt;/li>
&lt;li>AIX&lt;/li>
&lt;li>Solaris&lt;/li>
&lt;li>其他&lt;/li>
&lt;/ul>
&lt;h3 id="4-在过去一年中关于下列绩效指标您的组织实现的程度如何">4. 在过去一年中，关于下列绩效指标，您的组织实现的程度如何？
&lt;/h3>&lt;ul>
&lt;li>您组织的整体表现&lt;/li>
&lt;li>您组织的整体盈利能力&lt;/li>
&lt;li>主要产品的相对市场份额&lt;/li>
&lt;li>客户数量增加&lt;/li>
&lt;/ul>
&lt;p>（表现远低于目标 表现低于目标 略低于目标 达到了目标 略高于目标 表现高于目标 表现远高于目标 不适用或我不知道）&lt;/p>
&lt;h3 id="5-我们也有兴趣了解其他一些目标选择指示您的组织在过去一年中如何针对以下目标执行的选项">5. 我们也有兴趣了解其他一些目标。 选择指示您的组织在过去一年中如何针对以下目标执行的选项
&lt;/h3>&lt;ul>
&lt;li>产品或服务的数量&lt;/li>
&lt;li>运营效率&lt;/li>
&lt;li>消费者满意度&lt;/li>
&lt;li>所提供的产品或服务的质量&lt;/li>
&lt;li>实现组织的/使命的目标&lt;/li>
&lt;li>通过其它的方面向外部各方证明了贵组织实现预期成果&lt;/li>
&lt;/ul>
&lt;p>（表现远低于目标 表现低于目标 略低于目标 达到了目标 略高于目标 表现高于目标 表现远高于目标 不适用或我不知道）&lt;/p>
&lt;h3 id="6-我们有兴趣了解devops或敏捷方法是怎样在您组织的各个团队中传播的">6. 我们有兴趣了解DevOps或敏捷方法是怎样在您组织的各个团队中传播的。
&lt;/h3>&lt;p>在这里，我们将描述我们看到过的那些常见的模式，并要求您从中选择出&lt;strong>哪些在自己的组织中最常见&lt;/strong>方式（请选择所有适用的选项）&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>培训中心（有时也称为&lt;strong>&lt;strong>DOJO&lt;/strong>&lt;/strong>）&lt;/strong> - 让人们暂时脱离正常的工作惯例，以便在一段时间内学习新的工具或技术、实践甚至文化，然后再回到正常的工作环境中，目标（希望？）是：他们会坚持使用新的工作方式，甚至可能推广给其他的人。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>卓越中心&lt;/strong> - 一个所有专业知识都具足，然后为内部各方提供咨询的地方。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>止步于概念证明&lt;/strong> - 进行概念证明（PoC）项目，通常执行团队可以突破组织规范（通常是官方的规则）的羁绊，从而自由的按照所认为的最好的方式构建。然而，在PoC之后，那些付出就停滞不前了。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>用概念证明当模板&lt;/strong> - 也是从小规模的概念证明（PoC）项目（如上所述）开始，然后开始使用这个最初的模式在组织中的其它团队进行复制。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>用概念证明做种子&lt;/strong> - 也是从小规模的概念证明（PoC）开始，然后将PoC知识传播给其他团队。这是通过打散PoC（可以是第一个PoC团队，或是后续/并行的PoC团队）执行团队，并将他们派发到其他团队，去分享他们所学到的知识和实践的方式来完成的。也可以称此为轮岗，那些前PoC团队成员沉浸在其他团队中，发挥着传播新的实践和文化，并兼做导师的职责。他们可能会无限期地留在这个新的群体中，或者只是用足够长的时间来确保，他带来的新的做法是可持续的。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>实践社区&lt;/strong> - 在组织内培养对工具、语言或方法有共同兴趣的团体，以便在他们的彼此之间、团队之间，以及在组织内部分享他们的知识和专业技能。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>大爆炸式&lt;/strong> - 组织进行整体一次性的DevOps方法（当然他们要选择对其下的定义）转型，通常采用自上而下的指令。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>自下而上或草根方式&lt;/strong> - 那些在一线工作的小团队将资源整合在一起，然后在整个组织中，通过非官方的形式分享所取得的成功，并进行推广，而无需任何组织官方的支持或资源。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>混搭型&lt;/strong> - 组织实施过了上述的若干种方法，通常由于无法得到成功所需的资源和重视，只能是半途而废了。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="第二部分">第二部分
&lt;/h2>&lt;p>这部分涉及您的工作及其成果，以及它对您自身的影响。&lt;/p>
&lt;h3 id="1-在你工作的过程中你的感受是怎样的">1. 在你工作的过程中，你的感受是怎样的？
&lt;/h3>&lt;p>请评价您对以下陈述的同意或不同意程度。&lt;/p>
&lt;ul>
&lt;li>我经常处于高水平的生产力&lt;/li>
&lt;li>我经常能够进入一个良好的“流程”，在那里我可以完成复杂、耗时的任务，同时最大限度地减少干扰和中断。&lt;/li>
&lt;li>我对我的工作很满意。&lt;/li>
&lt;li>我有足够的工具和资源来完成我的工作。&lt;/li>
&lt;li>我的工作很好地利用了我的技能和能力。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h3 id="2-对于您工作的主要应用程序或服务变更前置时间即从代码提交到在生产中成功运行的过程需要的时间是多长">2. 对于您工作的主要应用程序或服务，变更前置时间（即：从代码提交到在生产中成功运行的过程需要的时间）是多长？
&lt;/h3>&lt;ul>
&lt;li>超过六个月&lt;/li>
&lt;li>一个月到六个月之间&lt;/li>
&lt;li>一周到一个月之间&lt;/li>
&lt;li>一天到一周之间&lt;/li>
&lt;li>不到一天&lt;/li>
&lt;li>不到一个小时&lt;/li>
&lt;li>我不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="3-对于您工作的主要应用程序或服务您的组织在生产环境进行代码部署或向最终用户做发布的频率是什么">3. 对于您工作的主要应用程序或服务，您的组织在生产环境进行代码部署或向最终用户做发布的频率是什么？
&lt;/h3>&lt;ul>
&lt;li>每六个月少于一次&lt;/li>
&lt;li>每一到六个月一次&lt;/li>
&lt;li>每周到每月一次&lt;/li>
&lt;li>每天到每周一次&lt;/li>
&lt;li>每小时到每天一次&lt;/li>
&lt;li>按需（每天都要进行多次部署）&lt;/li>
&lt;li>我不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="4-对于您工作的主要应用程序或服务当服务中断或出现影响用户bug时如计划外中断服务受损恢复服务通常需要多长时间">4. 对于您工作的主要应用程序或服务，当服务中断或出现影响用户Bug时（如：计划外中断、服务受损），恢复服务通常需要多长时间？
&lt;/h3>&lt;ul>
&lt;li>超过六个月&lt;/li>
&lt;li>一个月到六个月之间&lt;/li>
&lt;li>一周到一个月之间&lt;/li>
&lt;li>一天到一周之间&lt;/li>
&lt;li>一天之内&lt;/li>
&lt;li>一小时之内&lt;/li>
&lt;li>我不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="5-对于您所工作的主要应用程序或服务对于生产变更或向最终用户发版的变更百分之多少会导致服务质量下降如服务受损或服务中断并需要进行后续的修复工作需要热补丁回滚前向修复打补丁修复">5. 对于您所工作的主要应用程序或服务，对于生产变更，或向最终用户发版的变更，百分之多少会导致服务质量下降（如：服务受损或服务中断），并需要进行后续的修复工作（需要热补丁、回滚，前向修复，打补丁修复）
&lt;/h3>&lt;ul>
&lt;li>0％-15％&lt;/li>
&lt;li>16％-30％&lt;/li>
&lt;li>31％-45％&lt;/li>
&lt;li>46％-60％&lt;/li>
&lt;li>61％-75％&lt;/li>
&lt;li>76％-100％&lt;/li>
&lt;li>我不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="6-接下来的问题会询问可靠性以及您和您的团队如何看待它">6. 接下来的问题会询问可靠性，以及您和您的团队如何看待它。
&lt;/h3>&lt;p>请评价您对以下陈述的同意或不同意程度。
对于您所工作的主要应用程序或服务：&lt;/p>
&lt;ul>
&lt;li>定义了明确的可用性目标（如服务级别协议/服务级别目标），这些目标在团队和客户之间达成了清晰的共识。&lt;/li>
&lt;li>我知道最近一段时间实际的可用性。&lt;/li>
&lt;li>在最近一段时间内，我的团队达到或超过了可用性目标。&lt;/li>
&lt;li>当我们未达成可用性目标时，就会进行改进工作，也或将对调整工作的优先级。&lt;/li>
&lt;li>如果使用云服务，我的团队就会借助云计算的高可用性（如：使用多个可用区）来提高可靠性。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h3 id="7-工作的可持续性很重要而职场透支是一个相关的重要度量指标您能否回答几个问题让我们知道您的工作对您有何影响">7. 工作的可持续性很重要，而职场透支是一个相关的重要度量指标。您能否回答几个问题，让我们知道您的工作对您有何影响？
&lt;/h3>&lt;p>请评价您对以下声明的同意或不同意程度：&lt;/p>
&lt;ul>
&lt;li>我感觉透支很严重。&lt;/li>
&lt;li>我感到筋疲力尽。&lt;/li>
&lt;li>我对所从事的工作无语或愤世嫉俗。&lt;/li>
&lt;li>我觉得工作效率低下。&lt;/li>
&lt;li>我觉得工作应对业余的正常生活产生负面影响。&lt;/li>
&lt;li>我能够完成工作并保持良好的整体状态。&lt;/li>
&lt;li>我能够有效应对与工作有关的压力。&lt;/li>
&lt;li>我可以在业余时间中（即，当我选择不工作时）脱离工作。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h2 id="第三部分">第三部分
&lt;/h2>&lt;p>当你回答以下问题的时候，请回想一下你在团队中的经历&lt;/p>
&lt;h3 id="1-请评价您对以下声明的同意或不同意程度">1. 请评价您对以下声明的同意或不同意程度
&lt;/h3>&lt;ul>
&lt;li>如果我对我们的团队犯了错误，也不会有不良影响。&lt;/li>
&lt;li>我们团队的成员能够发现问题和提出棘手的问题。&lt;/li>
&lt;li>我们团队的成员不会因为差异性而互相拒绝。&lt;/li>
&lt;li>对我们的团队而言冒风险是安全的。&lt;/li>
&lt;li>想让我们团队的其人提供帮助并不困难。&lt;/li>
&lt;li>我们团队中没有人会以任何形式故意破坏我的工作成果。&lt;/li>
&lt;li>团队非常重视我独特的技术和才能。&lt;/li>
&lt;li>我们的团队能够在出现冲突时解决冲突。&lt;/li>
&lt;li>我们团队内部有很高的信任度。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h3 id="2-当你回答以下问题时回想你是如何和你的团队合作的">2. 当你回答以下问题时，回想你是如何和你的团队合作的
&lt;/h3>&lt;p>请评价您对以下声明的同意或不同意程度：&lt;/p>
&lt;ul>
&lt;li>当我的团队成员之间存在相反的意见时，我们会互相尊重。&lt;/li>
&lt;li>我可以依靠我的团队来产出高质量的成果。&lt;/li>
&lt;li>我的团队提供了一个可以创新的环境。&lt;/li>
&lt;li>我的团队有明确的角色和责任。&lt;/li>
&lt;li>我的团队所承担的项目对我来说具有个人和专业意义。&lt;/li>
&lt;li>我能够获得有效完成工作所需的必要的信息（例如，战略、新产品、组织变革，我们的优先事项和价值观）。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h3 id="3-回想一下你的团队是如何工作和组织的">3. 回想一下你的团队是如何工作和组织的
&lt;/h3>&lt;p>请评价您对以下陈述的同意或不同意程度。&lt;/p>
&lt;p>对于您使用的主要应用程序或服务：&lt;/p>
&lt;ul>
&lt;li>为了完成我自己的工作，我不需要与团队外的人沟通和协调。&lt;/li>
&lt;li>在我的团队中，我们可以对系统的设计进行大规模更改，而无需为其他团队创建重要的工作。&lt;/li>
&lt;li>在我的团队中，我们可以对系统的设计进行大规模更改，而不用依赖于其他团队的大量工作。&lt;/li>
&lt;li>我的团队可以根据需要独立部署和发布我们的产品或服务，而不依赖于其依赖的其他服务。&lt;/li>
&lt;li>我们可以按需的进行大部分的测试，而无需等待一个集成测试环境。&lt;/li>
&lt;li>在我的团队中，我们在正常工作指端中执行部署，停机时间可忽略不计。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h3 id="4-最后我们想了解一下您的组织文化">4. 最后，我们想了解一下您的组织文化
&lt;/h3>&lt;p>请评价您对以下声明的同意或不同意程度：&lt;/p>
&lt;ul>
&lt;li>我的组织氛围宜人，重视各种不同的观点。&lt;/li>
&lt;li>我的组织是一个所有类型的员工（例如，所有性别，种族，文化背景）都能够完全发挥其能力的地方。&lt;/li>
&lt;li>当我在组织中发言时，我的意见很受重视。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h2 id="第四部分">第四部分
&lt;/h2>&lt;p>这部分关于你所处环境中知识是如何供给和获取的。
让我们换个角度，告诉我们您的日常工作。&lt;/p>
&lt;h3 id="1-当您工作时您会在哪里寻找信息">1. 当您工作时，您会在哪里寻找信息？
&lt;/h3>&lt;ul>
&lt;li>当我需要相关知识用于解决问题时，我会频繁访问外部信息（如Stack Overflow、百度等）。&lt;/li>
&lt;li>当我遇到具有挑战性的问题，需要寻找类似问题的解决方案时，我经常访问外部信息 (如Stack Overflow、百度等)。&lt;/li>
&lt;li>当我处理困难的任务时，我经常和可能遇到类似问题的人沟通。&lt;/li>
&lt;li>当我需要工作相关主题或问题的知识时，我经常与其他人讨论。&lt;/li>
&lt;li>在处理任务时，我经常会参考内部知识库或工具来帮助找到解决方案。&lt;/li>
&lt;li>当我处理具有挑战性的问题时，我经常搜索内部工具或代码库以便找到类似问题或示例的解决方案。&lt;/li>
&lt;li>当我有疑问或寻找代码示例时，我经常搜索组织的源代码库&lt;/li>
&lt;li>当我有疑问或遇到有挑战的问题时，我会搜索内部文档&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="2-当您遇到问题时您会定期检查哪些信息来源请选择所有适用项">2. 当您遇到问题时，您会定期检查哪些信息来源？请选择所有适用项
&lt;/h3>&lt;ul>
&lt;li>内部(组织)知识库、论坛或文档&lt;/li>
&lt;li>内部(组织)代码库&lt;/li>
&lt;li>Stack Overflow 网站&lt;/li>
&lt;li>在线教程和视频&lt;/li>
&lt;li>百度、Bing或其它类似的公开搜索引擎&lt;/li>
&lt;li>外部(公共)参考文档&lt;/li>
&lt;li>当面请教同事&lt;/li>
&lt;li>通过电子邮件、文本或聊天工具请教同事&lt;/li>
&lt;li>朋友或同行(如微信、网络兴趣组、微博等)&lt;/li>
&lt;li>您自己的个人笔记&lt;/li>
&lt;li>其它。请填写&lt;/li>
&lt;li>以上都不是&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h2 id="第五部分">第五部分
&lt;/h2>&lt;p>这部分关于你的角色，以及你们团队做变更的特征和模式等。&lt;/p>
&lt;h3 id="1-现在让我们谈谈您工作时的感受">1. 现在让我们谈谈您工作时的感受
&lt;/h3>&lt;p>无论您的正式职位是什么，让我们谈谈您所做的工作。在您的日常工作中，您负责多少个不同的角色（或工作类型）？请选择所有适用项&lt;/p>
&lt;ul>
&lt;li>软件开发&lt;/li>
&lt;li>测试&lt;/li>
&lt;li>基础设施/运营&lt;/li>
&lt;li>数据库管理&lt;/li>
&lt;li>信息/应用安全&lt;/li>
&lt;li>人员管理&lt;/li>
&lt;li>项目或产品管理&lt;/li>
&lt;li>文档&lt;/li>
&lt;li>需求分析&lt;/li>
&lt;li>用户体验&lt;/li>
&lt;li>随时待命/事件响应&lt;/li>
&lt;li>其它。请列出您执行的其他角色&lt;/li>
&lt;/ul>
&lt;h3 id="2-您每天在这些角色之间切换多少次">2. 您每天在这些角色之间切换多少次？
&lt;/h3>&lt;ul>
&lt;li>不想回应&lt;/li>
&lt;li>0&lt;/li>
&lt;li>1&lt;/li>
&lt;li>2&lt;/li>
&lt;li>3&lt;/li>
&lt;li>4&lt;/li>
&lt;li>5&lt;/li>
&lt;li>6&lt;/li>
&lt;li>7&lt;/li>
&lt;li>8&lt;/li>
&lt;li>9&lt;/li>
&lt;li>10&lt;/li>
&lt;li>11&lt;/li>
&lt;li>12&lt;/li>
&lt;li>13&lt;/li>
&lt;li>14&lt;/li>
&lt;li>15&lt;/li>
&lt;li>16&lt;/li>
&lt;li>17&lt;/li>
&lt;li>18&lt;/li>
&lt;li>19&lt;/li>
&lt;li>20或以上&lt;/li>
&lt;/ul>
&lt;h3 id="3-您现在正工作在多少个项目或产品上">3. 您现在正工作在多少个项目或产品上？
&lt;/h3>&lt;ul>
&lt;li>不想回应&lt;/li>
&lt;li>0&lt;/li>
&lt;li>1&lt;/li>
&lt;li>2&lt;/li>
&lt;li>3&lt;/li>
&lt;li>4&lt;/li>
&lt;li>5&lt;/li>
&lt;li>6&lt;/li>
&lt;li>7&lt;/li>
&lt;li>8&lt;/li>
&lt;li>9&lt;/li>
&lt;li>10&lt;/li>
&lt;li>11&lt;/li>
&lt;li>12&lt;/li>
&lt;li>13&lt;/li>
&lt;li>14&lt;/li>
&lt;li>15&lt;/li>
&lt;li>16&lt;/li>
&lt;li>17&lt;/li>
&lt;li>18&lt;/li>
&lt;li>19&lt;/li>
&lt;li>20或以上&lt;/li>
&lt;/ul>
&lt;h3 id="4-您通常在一周中工作在多少个项目上">4. 您通常在一周中工作在多少个项目上？
&lt;/h3>&lt;ul>
&lt;li>不想回应&lt;/li>
&lt;li>0&lt;/li>
&lt;li>1&lt;/li>
&lt;li>2&lt;/li>
&lt;li>3&lt;/li>
&lt;li>4&lt;/li>
&lt;li>5&lt;/li>
&lt;li>6&lt;/li>
&lt;li>7&lt;/li>
&lt;li>8&lt;/li>
&lt;li>9&lt;/li>
&lt;li>10&lt;/li>
&lt;li>11&lt;/li>
&lt;li>12&lt;/li>
&lt;li>13&lt;/li>
&lt;li>14&lt;/li>
&lt;li>15&lt;/li>
&lt;li>16&lt;/li>
&lt;li>17&lt;/li>
&lt;li>18&lt;/li>
&lt;li>19&lt;/li>
&lt;li>20或以上&lt;/li>
&lt;/ul>
&lt;h3 id="5-思考下你过去3个月的工作-请以这些记忆里的工作对以下陈述进行回应">5. 思考下你过去3个月的工作。 请以这些记忆里的工作对以下陈述进行回应
&lt;/h3>&lt;p>我遇到过的代码，脚本，配置或系统&amp;hellip;&amp;hellip;&lt;/p>
&lt;ul>
&lt;li>包含已知的错误，这些错误不支持新功能开发&lt;/li>
&lt;li>没有足够的测试或测试覆盖率&lt;/li>
&lt;li>与低下的代码质量或设计有关&lt;/li>
&lt;li>取消或放弃项目后尚未进行清理&lt;/li>
&lt;li>在我所在的团队中没有人有专业知识能够理解&lt;/li>
&lt;li>有不完全或不正确的迁移&lt;/li>
&lt;li>使用了过时的技术&lt;/li>
&lt;li>文档和/或注释存在缺失、不完整或过时的情况&lt;/li>
&lt;/ul>
&lt;h3 id="6-现在思考在你的组织中的进行变更及相应流程是什么样的">6. 现在思考在你的组织中的进行变更及相应流程是什么样的
&lt;/h3>&lt;p>在我的组织中&amp;hellip;&amp;hellip;&lt;/p>
&lt;ul>
&lt;li>在实施或部署之前，必须由外部机构（例如，变更审批委员会，经理等）批准生产变更&lt;/li>
&lt;li>我的组织有一个正式的流程来批准在实施或发布之前对应用程序或生产系统进行变更。&lt;/li>
&lt;li>我清楚地了解批准实施​​变更的流程&lt;/li>
&lt;li>我相信我能够及时通过审批流程来实施变更&lt;/li>
&lt;li>对于我通常所做的各类变更，我知道每次从“提交”到“已接受”所需的步骤。&lt;/li>
&lt;li>我们依靠同事的同行评审（例如代码审查或结对编程）来管理或批准变更。&lt;/li>
&lt;li>我的团队遵循基于风险的政策来批准变更，通过自动化方法推进低风险变更，只有高风险变更才需要人工批准。&lt;/li>
&lt;li>所有重大变更必须在实施前由高级经理批准&lt;/li>
&lt;/ul>
&lt;h2 id="第6部分">第6部分
&lt;/h2>&lt;p>对于此页面上的问题，请思考你为测试生产系统的弹性所做的工作。&lt;/p>
&lt;h3 id="1以下哪些活动用于测试我们的it系统服务的弹性">1.以下哪些活动用于测试我们的IT系统/服务的弹性？
&lt;/h3>&lt;ul>
&lt;li>未在真实系统上进行沙盘推演&lt;/li>
&lt;li>基础设施（包括数据中心）故障转移&lt;/li>
&lt;li>应用程序故障转移&lt;/li>
&lt;li>模拟破坏类生产的测试系统（包括故障注入、如降级网络链路、关闭路由器等）&lt;/li>
&lt;li>模拟破坏生产系统（包括故障注入，如降级网络链路，关闭路由器等）&lt;/li>
&lt;li>创建自动化和系统，定期，持续地破坏生产系统&lt;/li>
&lt;li>其他。 请明确说明：&lt;/li>
&lt;li>以上都不是&lt;/li>
&lt;/ul>
&lt;h3 id="2-你所在的组织多久执行一次中断生产系统的模拟包括故障注入例如降级网络链路关闭路由器等">2. 你所在的组织多久执行一次中断生产系统的模拟（包括故障注入，例如降级网络链路、关闭路由器等）
&lt;/h3>&lt;ul>
&lt;li>从不&lt;/li>
&lt;li>仅在初次部署&lt;/li>
&lt;li>按周&lt;/li>
&lt;li>按月&lt;/li>
&lt;li>按年&lt;/li>
&lt;li>少于一年一次&lt;/li>
&lt;li>不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="3-你所在的组织多久执行一次基础设施包括数据中心故障转移以测试弹性">3. 你所在的组织多久执行一次基础设施（包括数据中心）故障转移以测试弹性？
&lt;/h3>&lt;ul>
&lt;li>从不&lt;/li>
&lt;li>仅在初次部署&lt;/li>
&lt;li>按周&lt;/li>
&lt;li>按月&lt;/li>
&lt;li>按年&lt;/li>
&lt;li>少于一年一次&lt;/li>
&lt;li>不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="4-你所在的组织多久执行一次应用程序故障转移以测试弹性">4. 你所在的组织多久执行一次应用程序故障转移以测试弹性？
&lt;/h3>&lt;ul>
&lt;li>从不&lt;/li>
&lt;li>仅在初次部署&lt;/li>
&lt;li>按周&lt;/li>
&lt;li>按月&lt;/li>
&lt;li>按年&lt;/li>
&lt;li>少于一年一次&lt;/li>
&lt;li>不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="5-如果我的组织在灾备演习时发现了任何改进的机会我们会创建行动任务并在下一次演习前修复这些改进项">5. 如果我的组织在灾备演习时发现了任何改进的机会，我们会创建行动任务并在下一次演习前修复这些改进项
&lt;/h3>&lt;ul>
&lt;li>非常同意&lt;/li>
&lt;li>同意&lt;/li>
&lt;li>有点同意&lt;/li>
&lt;li>既不赞成也不反对&lt;/li>
&lt;li>不太同意&lt;/li>
&lt;li>不同意&lt;/li>
&lt;li>强烈反对&lt;/li>
&lt;li>不适用或我不知道&lt;/li>
&lt;/ul>
&lt;h2 id="第七部分">第七部分
&lt;/h2>&lt;p>此页将会询问您或您的组织关于云应用的一些问题&lt;/p>
&lt;h3 id="1-我主要负责的产品或服务在哪运行请选择所有适用的选项">1. 我主要负责的产品或服务在哪运行？（请选择所有适用的选项）
&lt;/h3>&lt;ul>
&lt;li>公有云（包含多个公有云）&lt;/li>
&lt;li>私有云&lt;/li>
&lt;li>混合云（将公有云和私有云/数据中心/本地设施结合在一起）&lt;/li>
&lt;li>在数据中心或本地（不是云）&lt;/li>
&lt;li>我桌面下的一个小服务器&lt;/li>
&lt;li>其他&lt;/li>
&lt;/ul>
&lt;h3 id="2采用多个云提供商的驱动因素是什么请最多选择3个">2.采用多个云提供商的驱动因素是什么？（请最多选择3个）
&lt;/h3>&lt;ul>
&lt;li>我们只有一个云提供商, 或者我们没有使用公有云&lt;/li>
&lt;li>法律合规性&lt;/li>
&lt;li>灾备可用性&lt;/li>
&lt;li>对一个供应商缺乏信任&lt;/li>
&lt;li>利用每个提供商的独特优势&lt;/li>
&lt;li>谈判策略或采购要求&lt;/li>
&lt;li>其他&lt;/li>
&lt;/ul>
&lt;h3 id="3请评价您对以下陈述同意或不同意的程度">3.请评价您对以下陈述同意或不同意的程度
&lt;/h3>&lt;ul>
&lt;li>我主要负责的产品或服务最初是设计在云中运行或基于云设计架构的。&lt;/li>
&lt;li>对于我主要负责的产品或服务, 环境配置和部署仅使用存储在版本控制库中的脚本和信息, 无需手动步骤 (审批除外)。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="4请评价您使用云服务时对以下陈述的同意或不同意程度">4.请评价您使用云服务时对以下陈述的同意或不同意程度
&lt;/h3>&lt;ul>
&lt;li>一旦我有了访问权限, 我就可以根据需要独立地配置和配置产品或服务所需的云资源和功能, 而无需提高票证或需要人工交互。&lt;/li>
&lt;li>我主要负责的服务或产品设计为通过网络从各种设备 (如智能手机、平板电脑、笔记本电脑) 访问, 而不需要专有插件或协议。&lt;/li>
&lt;li>我的产品或服务所运行的云，服务于多个团队和应用程序, 并根据需要动态分配和重新分配计算和基础架构资源。&lt;/li>
&lt;li>我可以根据需求动态地增加或减少可用于主要支持的服务或产品的云资源。&lt;/li>
&lt;li>我可以监视或控制我主要支持的服务或产品所使用的云资源的数量和成本。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="5换个主题在您工作的时候您是怎样看待成本的">5.换个主题，在您工作的时候，您是怎样看待成本的？
&lt;/h3>&lt;ul>
&lt;li>我的团队可以准确地估计操作我们软件的成本。&lt;/li>
&lt;li>我的团队可以轻松识别我们运营成本最高的应用程序。&lt;/li>
&lt;li>我的团队很少超出我们的成本费用或支出预算。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h2 id="第八部分">第八部分
&lt;/h2>&lt;p>关于版本控制系统、分支模型、自动化测试、持续集成、持续交付等一直到生产环境的反馈等等实践。
现在让我们谈谈您和您的团队所做的技术工作。&lt;/p>
&lt;h3 id="1请介绍一下您和您的团队如何开发软件我的团队">1.请介绍一下您和您的团队如何开发软件。我的团队
&lt;/h3>&lt;ul>
&lt;li>我们的组织将所有代码存储在一个单一庞大的版本控制存储库中&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>组织中所有工程师都可以查看和搜索组织中所有代码&lt;/li>
&lt;li>我可以在自己之外的项目中编辑代码，并适时提交&lt;/li>
&lt;li>我们将应用程序的所有依赖项源代码（例如软件库）都存储到版本控制存储库中&lt;/li>
&lt;li>我们为发行版本创建的所有包，包括依赖项，都是在单个版本控制中创建的，而不是从多个版本或分支中创建的&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="2我们关注您工作中使用什么代码请评价您对以下陈述同意或不同意程度">2.我们关注您工作中使用什么代码，请评价您对以下陈述同意或不同意程度
&lt;/h3>&lt;ul>
&lt;li>如果需要，我们很容易更改其他团队维护的代码&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>我很容易在代码库中找到示例&lt;/li>
&lt;li>我经常从团队之外的工程师那里收到项目的更新。&lt;/li>
&lt;li>我很容易重新使用别人的代码&lt;/li>
&lt;li>我很容易对我的项目增加新的依赖项&lt;/li>
&lt;li>我很容易移动新的依赖项版本&lt;/li>
&lt;li>我的依赖项是稳定的很少破坏我的代码&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="3我们关注您在工作中遵循的开发实践和模式">3.我们关注您在工作中遵循的开发实践和模式
&lt;/h3>&lt;ul>
&lt;li>我团队中的所有开发人员至少每天都会将代码推送到trunk / master&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>应用程序的代码库中不到三个活动分支&lt;/li>
&lt;li>我们的应用程序团队从来没有代码锁定期，任何时候没有人可以签入代码或由于合并配置而执行请求。&lt;/li>
&lt;li>在合并到master之前，分支和分叉的生命周期非常短（不到一天）。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="4下一组问题是关于在工作中提交代码搭建和部署软件">4.下一组问题是关于在工作中提交代码、搭建和部署软件
&lt;/h3>&lt;p>对于您使用的主要应用程序或服务：&lt;/p>
&lt;ul>
&lt;li>代码提交会自动生成软件&lt;/li>
&lt;li>代码提交会运行一系列自动化测试&lt;/li>
&lt;li>每天成功地执行自动化的构建和测试&lt;/li>
&lt;li>当构建中断时，它通常在十分钟内修复&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="5许多团队使用自动化测试来优化他们的软件">5.许多团队使用自动化测试来优化他们的软件
&lt;/h3>&lt;p>请评价您对以下陈述的同意或不同意程度
回答这些问题时，请考虑您自己的测试过程：&lt;/p>
&lt;ul>
&lt;li>当自动化测试通过时，我确信软件是可发布的&lt;/li>
&lt;li>自动测试失败可能表明存在真正的缺陷&lt;/li>
&lt;li>开发人员很容易重现和修复验收失败的测试&lt;/li>
&lt;li>我们测试必要的数据，以便每一步都能轻松运行自动化测试&lt;/li>
&lt;li>我可以在十分钟内从自动测试中得到反馈&lt;/li>
&lt;li>我们经常使用之前的测试运行数据来提高自动化测试套件的质量&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="6请评价您对以下陈述的同意或不同意程度">6.请评价您对以下陈述的同意或不同意程度
&lt;/h3>&lt;p>对于您使用的主要应用程序或服务：&lt;/p>
&lt;ul>
&lt;li>我们的软件在整个生命周期中都处于可部署状态&lt;/li>
&lt;li>我的团队优先考虑保持软件可部署而不是处理新功能&lt;/li>
&lt;li>团队中的任何人都可以获得系统在质量和可部署性方面的快速反馈&lt;/li>
&lt;li>当人们得到系统不可部署的反馈时（例如构建或测试失败），他们将优先解决这些问题&lt;/li>
&lt;li>我们可以根据需要随时将我们的系统部署到生产或最终用户&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="7-请结合自己的测试过程回答以下问题">7. 请结合自己的测试过程回答以下问题
&lt;/h3>&lt;ul>
&lt;li>当通过自动化测试后，我相信软件是可发布的。&lt;/li>
&lt;li>自动化测试失败表明存在真正的缺陷。&lt;/li>
&lt;li>开发人员很容易重现并修复验收测试发现的缺陷。&lt;/li>
&lt;li>我们有必要的测试数据，用于每个步骤中轻松地运行自动化测试。&lt;/li>
&lt;li>我可以在10分钟内收到自动化测试反馈。&lt;/li>
&lt;li>我们经常使用以前测试运行的数据来提高自动化测试套件的质量。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="8-对于您工作的主要应用或服务">8. 对于您工作的主要应用或服务
&lt;/h3>&lt;ul>
&lt;li>我们的软件始终处于可部署的状态。&lt;/li>
&lt;li>在我的团队中，保持软件处于可部署状态的优先级高于实现新需求。&lt;/li>
&lt;li>任何团队成员都可以快速反馈系统的质量和可部署性。&lt;/li>
&lt;li>团队成员将修复导致系统无法部署的问题（如编译失败、测试失败等）置于最高优先级。&lt;/li>
&lt;li>我们可以随时根据需要将系统部署到生产环境或最终用户。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="9-对于您工作的主要应用或服务实现完全自动化部署到生产环境或最终用户的比例是">9. 对于您工作的主要应用或服务，实现完全自动化部署到生产环境或最终用户的比例是
&lt;/h3>&lt;ul>
&lt;li>0%-15%&lt;/li>
&lt;li>16%-30%&lt;/li>
&lt;li>31%-45%&lt;/li>
&lt;li>46%-60%&lt;/li>
&lt;li>61%-75%&lt;/li>
&lt;li>76%-100%&lt;/li>
&lt;li>我不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="10-对于您工作的主要应用或服务部署过程需要多长时间才能使软件新版本可供用户使用">10. 对于您工作的主要应用或服务，部署过程需要多长时间才能使软件新版本可供用户使用
&lt;/h3>&lt;ul>
&lt;li>小于1小时&lt;/li>
&lt;li>在1小时和1天之间&lt;/li>
&lt;li>在1天和3天之间&lt;/li>
&lt;li>在3天和1周之间&lt;/li>
&lt;li>在1周和1个月之间&lt;/li>
&lt;li>大于1个月&lt;/li>
&lt;li>我不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="11-您如何监控和了解正在运行的系统">11. 您如何监控和了解正在运行的系统
&lt;/h3>&lt;ul>
&lt;li>我的团队有一套技术解决方案用以报告系统的整体健康状况（如系统功能是否正常？系统是否有充足的可用资源等？）。&lt;/li>
&lt;li>我的团队有一套技术解决方案用以报告基于用户使用情况的系统状态（如用户是否知道系统已关闭，是否有不良的体验等？）。&lt;/li>
&lt;li>我的团队有一套技术解决方案用以监控主要业务和系统参数。&lt;/li>
&lt;li>我的团队有工具用于协助我们了解和调试生产环境上的系统。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h2 id="第九部分">第九部分
&lt;/h2>&lt;p>这页面询问了一些细节关于您的技术环境和工作&lt;/p>
&lt;p>请选择以下之一&lt;/p>
&lt;h3 id="1--为了部署我们的软件解决方案我的团队使用以下ci--cd-测试自动化工具链">1. 为了部署我们的软件解决方案，我的团队使用以下CI / CD /测试自动化工具链
&lt;/h3>&lt;ul>
&lt;li>主要是内部开发（自研）的，且所有权属于我的组织&lt;/li>
&lt;li>混合使用专有工具，开源和商业现成软件&lt;/li>
&lt;li>主要是开源和商用现货，高度定制&lt;/li>
&lt;li>主要是开源和商用现货，很少定制&lt;/li>
&lt;li>主要是商业现成的套装软件&lt;/li>
&lt;li>主要是开源的，高度定制&lt;/li>
&lt;li>主要是开源的，很少定制&lt;/li>
&lt;li>其他&lt;/li>
&lt;li>不适用或我不知道&lt;/li>
&lt;/ul>
&lt;h2 id="2-请评价您对以下说法的同意或不同意程度">2. 请评价您对以下说法的同意或不同意程度
&lt;/h2>&lt;ul>
&lt;li>在我的团队中，与组织中的其他团队相比，我们的CI/CD/自动化测试过程和工具是为我们的需求而定制的&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="3-请评价您对以下说法的同意或不同意程度-通过ci--cd工具链部署软件时">3. 请评价您对以下说法的同意或不同意程度。 通过CI / CD工具链部署软件时
&lt;/h3>&lt;ul>
&lt;li>使用CI / CD工具链可以提高我的效率在我的工作中&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>使用CI / CD工具链在我的工作中提高我的生产力&lt;/li>
&lt;li>使用Ci/CD工具链提高了我的工作效率&lt;/li>
&lt;li>我发现CI / CD工具链在我的工作中很有用。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="4-请评价您对以下说法的同意或不同意程度-通过ci--cd-测试自动化工具链部署软件时">4. 请评价您对以下说法的同意或不同意程度。 通过CI / CD /测试自动化工具链部署软件时
&lt;/h3>&lt;ul>
&lt;li>我的交互在工具链是清晰易懂的&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>与工具链交互并不需要我的大量精力&lt;/li>
&lt;li>我发现工具链容易使用&lt;/li>
&lt;li>我发现容易让工具链做我想要做的事&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="5-选择最能代表谁负责创建和维护ci--cd-测试自动化工具链及其配置的选项">5. 选择最能代表谁负责创建和维护CI / CD /测试自动化工具链及其配置的选项
&lt;/h3>&lt;ul>
&lt;li>我们的团队有完全自治选择和配置自己的CI / CD /自动化测试的工具链。&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>我们需要使用一个统一工具链，但是我们为构建/测试/部署过程维护自己的脚本，并且在配置方式上有很多自主权。&lt;/li>
&lt;li>我们需要使用一个统一工具链具有预配置脚本和构建步骤，测试和部署过程的步骤，我们可以根据需要重构或自定义。&lt;/li>
&lt;li>我们需要使用带有预配置脚本和步骤的统一工具链，而我们几乎没有能力重构它&lt;/li>
&lt;li>所有构建，测试和部署软件，都由我们建立的统一团队处理&lt;/li>
&lt;li>不适用或我不知道&lt;/li>
&lt;/ul>
&lt;h3 id="6-我的工具链包括以下内容请选择所有适用的选项">6. 我的工具链包括以下内容（请选择所有适用的选项）
&lt;/h3>&lt;ul>
&lt;li>自动化构建&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>自动化单元测试&lt;/li>
&lt;li>自动化验收测试&lt;/li>
&lt;li>自动化性能测试&lt;/li>
&lt;li>自动安全测试&lt;/li>
&lt;li>自动化配置和部署到测试环境&lt;/li>
&lt;li>自动化部署到生产&lt;/li>
&lt;li>与chatbots / Slack集成&lt;/li>
&lt;li>与生产监控和可视化工具集成&lt;/li>
&lt;li>以上都不是&lt;/li>
&lt;/ul>
&lt;h2 id="第十部分">第十部分
&lt;/h2>&lt;p>最后一页！请花几分钟时间告诉我们你自己。
请注意，此数据仅用于研究目的，此调查是匿名的，仅以匿名方式汇总报告。&lt;/p>
&lt;h3 id="1-你的性别">1. 你的性别？
&lt;/h3>&lt;ul>
&lt;li>男&lt;/li>
&lt;li>女&lt;/li>
&lt;li>非二元&lt;/li>
&lt;li>不想回应&lt;/li>
&lt;/ul>
&lt;h3 id="2-在您的团队中工作的女性比例是多少">2. 在您的团队中工作的女性比例是多少？
&lt;/h3>&lt;p>请输入0到100之间的数字。&lt;/p>
&lt;ul>
&lt;li>女性团队的百分比： [___]&lt;/li>
&lt;li>不想回应&lt;/li>
&lt;/ul>
&lt;h3 id="3-您是否认定为少数派群体的成员">3. 您是否认定为少数派群体的成员？
&lt;/h3>&lt;ul>
&lt;li>是&lt;/li>
&lt;li>没有&lt;/li>
&lt;li>不想回应&lt;/li>
&lt;/ul>
&lt;h3 id="4-你认定是残疾人吗">4. 你认定是残疾人吗？
&lt;/h3>&lt;p>包括与视觉，听觉，步行，记忆/集中，自我保健或沟通相关的残疾&lt;/p>
&lt;ul>
&lt;li>是&lt;/li>
&lt;li>没有&lt;/li>
&lt;li>不想回应&lt;/li>
&lt;/ul>
&lt;h3 id="5-哪个最贴切地描述了你的工作角色">5. 哪个最贴切地描述了你的工作角色？
&lt;/h3>&lt;ul>
&lt;li>开发或工程师&lt;/li>
&lt;li>DevOps或SRE&lt;/li>
&lt;li>信息安全&lt;/li>
&lt;li>IT运营或基础设施&lt;/li>
&lt;li>网络运营&lt;/li>
&lt;li>产品管理&lt;/li>
&lt;li>用户体验或软件分析&lt;/li>
&lt;li>经理&lt;/li>
&lt;li>专业服务&lt;/li>
&lt;li>质量工程师或QA&lt;/li>
&lt;li>发布工程师&lt;/li>
&lt;li>销售工程师&lt;/li>
&lt;li>销售或营销&lt;/li>
&lt;li>我是顾问、教练或培训师&lt;/li>
&lt;li>我是C级高管&lt;/li>
&lt;li>我是学生&lt;/li>
&lt;li>我不属于任何部门&lt;/li>
&lt;li>其他&lt;/li>
&lt;li>不想回答&lt;/li>
&lt;/ul>
&lt;h3 id="6-你有多少年的经验">6. 你有多少年的经验？
&lt;/h3>&lt;ul>
&lt;li>0-2&lt;/li>
&lt;li>3-5&lt;/li>
&lt;li>6-10&lt;/li>
&lt;li>11-15&lt;/li>
&lt;li>超过16&lt;/li>
&lt;li>不想回应&lt;/li>
&lt;/ul>
&lt;h3 id="7-请选择您所在的地理区域">7. ­­­­­请选择您所在的地理区域
&lt;/h3>&lt;ul>
&lt;li>非洲&lt;/li>
&lt;li>亚洲&lt;/li>
&lt;li>中美洲&lt;/li>
&lt;li>东欧洲&lt;/li>
&lt;li>欧洲联盟&lt;/li>
&lt;li>中东&lt;/li>
&lt;li>北美&lt;/li>
&lt;li>大洋洲&lt;/li>
&lt;li>南美洲&lt;/li>
&lt;li>加勒比&lt;/li>
&lt;/ul>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>本文是否帮你解答了这样一个疑问：每年的DevOps状态报告中的参考数据是从哪里来的？是通过什么方式采集的？到目前为止，我们还不清楚这些数据是通过什么打分规则和算法处理的。如果你是这方面的专家，请和我们分享以下你的观点。&lt;/p></description></item><item><title>2019年DevOps状态调查问卷开放中</title><link>https://martinliu.cn/blog/2019-state-devops-survey-open/</link><pubDate>Sat, 20 Apr 2019 22:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/2019-state-devops-survey-open/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/abstract-4.jpg" alt="Featured image of post 2019年DevOps状态调查问卷开放中" />&lt;p>2019年加速度DevOps状态调查首发，首发的位置在Google Cloud网站上的Blog栏目，发布于产品新闻分类下。&lt;/p>
&lt;ul>
&lt;li>文章使用的主标签 DevOps 、SRE。&lt;/li>
&lt;li>文章地址：https://cloud.google.com/blog/products/devops-sre/make-your-voice-heard-take-the-2019-accelerate-state-of-devops-survey&lt;/li>
&lt;/ul>
&lt;p>关于今年的状态调查有什么更新和变化，文章中只给出了一句话的概况：今年会对部署工具链、云计算、灾难恢复和工作方式等主题进行深度调查。更详细的情况，详细你参与完问卷调查只有自由评判。&lt;/p>
&lt;h2 id="如何参与2019年devops状态调查">如何参与2019年DevOps状态调查
&lt;/h2>&lt;p>点击这个链接 &lt;a class="link" href="https://bit.ly/2UzLMH2" target="_blank" rel="noopener"
>https://bit.ly/2UzLMH2&lt;/a> ，进入问卷调查网站。&lt;/p>
&lt;p>从围观到参与是一种积极的态度。与其观望这份行业报告的产生过程，倒不如参与其中。由于今年这个问卷调查是Google发起的，可能会有更多的人会参与。&lt;/p>
&lt;p>精通英文的人应该能在半个小时内完成这个调查。如果英文不好的话，最多也用不了2个小时，以上推测，基于我去年的填写经历。&lt;/p>
&lt;p>我还想发起一个基于这个调查的兴趣小组，请符合以下条件之一的人进微信群交流：&lt;/p>
&lt;ol>
&lt;li>正在认证填写这份问卷，想从群里获得必要的帮助，从而可以能正确的作答。&lt;/li>
&lt;li>想研究这份文件的题库，大家共同分析DORA设问的目标和结构。&lt;/li>
&lt;li>跟进一步的，交流关于DevOps度量方面的话题&lt;/li>
&lt;/ol>
&lt;h2 id="关于2018年的devops状态报告">关于2018年的DevOps状态报告
&lt;/h2>&lt;p>有幸去年策划和参与了这份报告的翻译工作。也算是相对其他人更深入的学习和研究了去年的结果。并对它的总结和推论都有非常深刻的印象，也受益匪浅。&lt;/p>
&lt;p>2018年DevOps状态调查报告的中文版本，在2018年DevOpsDays 深圳大会上做了发布，我也在台上和张乐一起向与会者做了简短的分享。如果你需要下载学习的话，请点击下面的链接（扫码二维码），这里还有历年来英文版报告全集和部分中文版本。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1555778529/reports-download.png.png"
loading="lazy"
alt="下载"
>&lt;/p>
&lt;p>在2018年里Nicole Forsgren博士发布了《Accelerate》这本书，书里算是对这场从2014年开始的，持续对年的行业专项调查研究的一个总结。书中对度量DevOps这个主题做了详解科学的解读，它是那些需要度量DevOps成果的组织的一本很好的参考书。中文版本据说在翻译的过程中，期待它的出版。等不及的话可以去国外买英文电子版，这本书我是读了不下三遍，也做了相关的分享演讲，确实有很多收获。&lt;/p>
&lt;p>分享几个我观察到的小细节：&lt;/p>
&lt;ul>
&lt;li>DORA在2018年结束了与Puppet公司的合作调查，因此2018年的报告标题中增加了一个单词“加速度”，即：2018 Acclerate State of DevOps Report； 以前的都叫做 xxxx年 State of DevOps Report。&lt;/li>
&lt;li>Puppet公司也没有闲着，Puppet和Splunk公司携手也进行了状态调查和分析，也发布了名为《2018 State of DevOps Report》，问卷的问题肯定和以前无法延续和持续的，但是报告的命名保持下来了。我猜这也是为何DORA的报告需要加一个词的原因，&lt;/li>
&lt;/ul>
&lt;p>总结一下，由Nicole Forsgren博士主持进行的DevOps状态调查报告的下载站点都在 &lt;a class="link" href="https://puppet.com/resources/whitepaper" target="_blank" rel="noopener"
>https://puppet.com/resources/whitepaper&lt;/a> ， 在这里依然可以下载到名为 2018 State of DevOps Report 的报告，但是这一个和Nicole博士无关；所有她主持的报告下载地址在她的DORA网站上 &lt;a class="link" href="https://devops-research.com/research.html" target="_blank" rel="noopener"
>https://devops-research.com/research.html&lt;/a> 。 在DORA加入了Google Cloud以后，Nicole博士主持的调查问卷名为“ Accelerate State of DevOps Report” ； 相信我们所期待的最终的分析结果的标题应该是“ 2019 Accelerate State of DevOps Report” ； 而Puppet公司应该还是会持续发布名为“2019 State of DevOps Report”的报告。我相信肯定会有很多人在2018年去年就有点晕了，怎么出来两个名字相似，可是内容大相径庭的DevOps状态报告。&lt;/p>
&lt;h2 id="devops背后的科学访谈nicole-forsgren">DevOps背后的科学：访谈Nicole Forsgren
&lt;/h2>&lt;p>最近在Nicole Forsgren正式发布了2019年的DevOps状态调查报告之后，她接受了RealWorldDevOps电台的访问。Nicole Forsgren保持这一贯的爽朗、认真和理性的特点，与电台主播迈克进行了42分钟的畅谈。&lt;/p>
&lt;ul>
&lt;li>访谈英文原文：https://www.realworlddevops.com/episodes/the-science-behind-devops-with-dr-nicole-forsgren 在这个页面上还可以收听或者下载这期访谈节目。&lt;/li>
&lt;li>英文原文的翻译版本（Google机器翻译，为修订）见下文。&lt;/li>
&lt;li>访谈中的几个关键内容（并不是所有观点）：
&lt;ul>
&lt;li>2014年开始DevOps状态调查分析和报告工作&lt;/li>
&lt;li>这项工作前期与Puppet公司合作进行&lt;/li>
&lt;li>Nicole和Jez Humble建立了独立的DORA，即DevOps Research &amp;amp; Assessment公司 &lt;a class="link" href="https://devops-research.com/" target="_blank" rel="noopener"
>https://devops-research.com/&lt;/a>&lt;/li>
&lt;li>2018年12月DORA被Google收购，Nicole加入Google后，Google将作为DORA的特别调查样本和支持公司，保持DORA持续进行。&lt;/li>
&lt;li>Nicole叙述了最有意义的三件事：架构高于技术，云计算很重要，外包是不起作用的。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>在这次访谈中，我们也可以听出一点关于这个行业调查的宗旨和调性。紧跟时代发展步伐，每年做一定的突破和更新，保持厂商/工具无关性等等。具体内容详见下面的机器翻译文字。&lt;/p>
&lt;h3 id="访谈笔录">访谈笔录
&lt;/h3>&lt;p>以下为电台网站英文版本的直接机器翻译，未做修订，不保证能够被人正确理解；有疑问的地方请参考英文原文和访谈音频。&lt;/p>
&lt;hr>
&lt;p>迈克朱利安：这是真实的世界DevOps播客，我是你的主持人迈克朱利安。我正准备在DevOps世界中遇到最有趣的人。从您喜爱的工具的创作者到精彩会议的组织者，以及出色的公共演讲者的伟大着作的作者，我想向您介绍我能找到的最有趣的人。&lt;/p>
&lt;p>迈克朱利安：啊，崩溃报道。经常被遗忘的一块坚实的监控策略。您是否很难复制您从用户那里听到的错误或难以捉摸的性能问题？你应该看看Raygun。无论你是负责网络应用程序还是移动应用程序，Raygun都可以在几分钟内轻松找到并诊断出问题，而不是你通常做的事情，如果你像我一样，请问最近的人，“嘿，是app适合你？“得到一个空白的凝视，因为嘿，这是星巴克，谁是一个奇怪的人提出有关移动应用程序性能的问题？无论如何，Raygun，我个人感谢他们帮助使这个播客成为可能。您可以访问raygun.com查看今天的免费试用版。&lt;/p>
&lt;p>迈克朱利安：嗨伙计们。我是Mike Julian，你是Real World DevOps Podcast的主持人。本周我的客人是Nicole Forsgren博士。您可能知道她是“加速：精益软件和DevOps的科学”一书的作者，或者可能是年度DevOps状态报告背后的研究员。当然，这不是全部。她也是最近被谷歌收购的DevOps研究和评估的创始人，他是管理信息系统和会计教授，同时也是一名性能工程师和系统管理员。说我很高兴与你交谈，这可能是一种轻描淡写。所以，欢迎来到节目。&lt;/p>
&lt;p>Nicole Forsgren：谢谢。很高兴来到这里。我很高兴我们终于联系了。我们试图做多久了？&lt;/p>
&lt;p>迈克朱利安：几个月。我想我已经联系过你了，现在已经是三月了。我在11月份到达了，你说，“嗯，你知道，我还有其他的东西在继续，顺便说一句，我的公司被收购了。”&lt;/p>
&lt;p>Nicole Forsgren：那么，那时候，我必须狡猾，对吧？我不得不说，“我有一个真正的大项目。我很抱歉。我们以后可以见面吗？”而且，上帝保佑，你是非常仁慈和善良的，你说，“当然 - ”&lt;/p>
&lt;p>迈克朱利安：谢谢你。&lt;/p>
&lt;p>Nicole Forsgren：&amp;hellip;&amp;hellip;“我们以后可以聊聊。”然后我想你在说：“哦，恭喜你的&amp;rsquo;大项目&amp;rsquo;&amp;lsquo;之后给我发了一条消息。”我说，“谢谢。”&lt;/p>
&lt;p>迈克朱利安：听起来不错。&lt;/p>
&lt;p>Nicole Forsgren：我很感激。是啊。然后，你再次伸出手，我说，“哦，我正在做另一个大项目。但是，这一次&amp;hellip;&amp;hellip;”&lt;/p>
&lt;p>迈克朱利安：这不是收购。&lt;/p>
&lt;p>Nicole Forsgren：是的，这不是收购。这一次，这是一个正常的大项目，这是今年的DevOps状态报告。我们刚刚启动了调查，所以我非常兴奋，我们再次收集数据。&lt;/p>
&lt;p>迈克朱利安：所以我们可以解决这个问题，你在哪里可以找到DevOps状态报告？&lt;/p>
&lt;p>Nicole Forsgren：所有DevOps状态报告都在DORA网站上发布。我们仍然有网站。我们所参与的所有报道，我想说我们从2014年开始，我已经很老了，我已经忘记了。我们完成的所有报告都是托管的。我们会在演出笔记中发布它们。如果你可以拿自己的健怡可乐或咖啡或茶或水，或者你想要波本威士忌。舒服。坐下来，大约需要25分钟。我知道，对，每个人都喜欢，“女孩，25分钟？”&lt;/p>
&lt;p>迈克朱利安：这是一项重大调查。&lt;/p>
&lt;p>妮可福斯格伦：我知道。它是。但这是因为DevOps状态报告是科学的，对吧？我们研究预测，而不仅仅是相关性。但请坐下来，舒服一点，让我知道做你的工作是什么感觉。因为今年我们正在挖掘其他一些东西;生产力，工具链，关于职业倦怠和幸福的额外事情，以及我们如何进入流动，以及真正的样子。还有一些非常棒的事情是，在以非常深思熟虑的方式进行调查之后，已经有很多人已经准备好了。顺便说一下，如果你有的话，我爱你们所有人。与同事分享，与同行分享。&lt;/p>
&lt;p>但是他们已经说过，仅仅通过参加调查，他们已经离开了，甚至在报告出来之前，他们已经走开了有关如何使他们的工作更好的非常有趣的想法和技巧和见解。&lt;/p>
&lt;p>迈克朱利安：是的，想到这一点很疯狂，参加调查的行为实际上改善了我的工作。因为我采取的大多数调查，我已经完成了，我想，“嗯，这有点浪费时间。”感觉就像我只是放弃了一堆东西而没有得到任何东西。&lt;/p>
&lt;p>Nicole Forsgren：是的，我认为这种方式起作用的原因是因为我们对问题的处理方式非常谨慎，有时只是采取调查的行为可以帮助你思考你的工作方式。因此，采取某些问题的行为可以帮助人们思考他们正在做的事情。然后，当然，就像我开玩笑说，这是我的生活圈，调查将持续到5月3日，然后我将进入数据分析和报告撰写。我们预计报告本身将在8月中旬左右公布。&lt;/p>
&lt;p>迈克朱利安：嗯，为什么我们不退后几步说&amp;hellip;每个人都喜欢一个好的起源故事。很多年前，我相信你和我在一次LISA会面。您正在与Carolyn Rowland联合举办研讨会 -&lt;/p>
&lt;p>Nicole Forsgren：哦，我喜欢Carolyn。&lt;/p>
&lt;p>迈克朱利安：是的，她也很精彩。我应该让她在这里。&lt;/p>
&lt;p>妮可福斯格伦：我的双胞胎。是。绝对。&lt;/p>
&lt;p>迈克朱利安：所以当我第一次见到你时你就是一名教授。我想，你知道教授在LISA上闲逛，并就如何理解商业价值给出了所有这些很好的建议，我认为这绝对令人着迷。教授，在DevOps世界中闲逛，这是怎么发生的？&lt;/p>
&lt;p>Nicole Forsgren：哦，天哪。好的，有趣的是，我实际上是从工业开始的。我的第一份工作是在一个主框架上，编写医疗系统，然后编写财务系统。所以我是一名大型机程序员。然后支持我的主框架系统，对吧？这就是Ops中我们这么多人在Ops中开始的原因，有人说，“好吧，有人必须这样做。”对？我还在学校，然后我最终成为DEV，对吗？我在IBM担任软件工程师已有好几年了，然后转向学术界。我得到了博士学位，在那里我开始询问有关如何分析系统的问题，所以我实际上在做NLP，自然语言处理。&lt;/p>
&lt;p>迈克朱利安：很有意思。&lt;/p>
&lt;p>Nicole Forsgren：是的，我在做&amp;hellip;&amp;hellip;&lt;/p>
&lt;p>迈克朱利安：是的，这是一个奇怪的切入点。绝对不是我所期望的。&lt;/p>
&lt;p>Nicole Forsgren：是的，所以疯狂的事情，我的第一年实际上是欺骗检测。&lt;/p>
&lt;p>迈克朱利安：我打赌这太棒了。&lt;/p>
&lt;p>Nicole Forsgren：这真的很有趣，非常有趣。但是我从系统工作中充分利用了我的背景，对吧？因为我们做什么？我们分析日志系统。&lt;/p>
&lt;p>迈克朱利安：对。&lt;/p>
&lt;p>妮可福斯格伦：对吗？我们习惯于以凌乱的格式分析大量数据，很多时候基于文本，超级嘈杂，不能总是信任它，对吧？现在人们都说，“我不相信调查。人们撒谎。”孩子们，我们的系统也是如此。&lt;/p>
&lt;p>迈克朱利安：一直以来。&lt;/p>
&lt;p>妮可福斯格伦：对吗？所以，他们喜欢我的一大堆这项工作。突然间，我随机对系统管理员进行了可用性研究。我们写了结果，把它们还给了IBM，IBM就像是，“你的意思是什么？我们遵循UCD指南，用户中心设计指南。这应该是适用的。”我就像是，“等等，哇哇哇哇哇哇哇哇哇哇哇哇哇哇&lt;/p>
&lt;p>当时，他们为所有用户提供了一套UCD指南。超级先进，高级别的高级系统管理员，他们正在做备份，灾难恢复，一切。那些买过笔记本电脑并且在生命中第一次使用电子邮件的人。&lt;/p>
&lt;p>迈克朱利安：我确信那个过得很好。&lt;/p>
&lt;p>妮可福斯格伦：什么？我想，“就是这样。改变我的论文。”当然，这让我的顾问惊慌失措。他们就像是，“你会去做什么？”所以我开始做什么，当时是DevOps的基础。那是什么，你如何理解和预测信息系统？通过信息系统，技术，自动化，使用和预测，然后是团队，组织层面的个人团队的结果和影响。&lt;/p>
&lt;p>现在，我说了所有这些，那是大词，这是学术用语，基本上是什么是DevOps。我如何理解人们何时使用自动化和流程以及工具和文化，以及我如何知道它汇总起来以产生影响并增加价值？现在我们就像，“哦，那是DevOps。”&lt;/p>
&lt;p>这是2007年末。&lt;/p>
&lt;p>迈克朱利安：哦，哇。所以你和我们在一起很早。&lt;/p>
&lt;p>Nicole Forsgren：是的。这是一个非常有趣的平行轨道，因为现在我们回顾过去，我们就像，大约10年前。这与DevOps同时是新生的起源，对吧？所以，我们这么多人在同一时间偶然发现了它。我不知道这是在工业中发生的事情。我一直在偷偷摸摸，我一直这样做，偶然发现LISA，试图连接数据，当然，就像每个好学者一样。拼命想找到数据。&lt;/p>
&lt;p>偶然发现，撞到了一个收集类似东西但使用不同粗糙方法的小组。一个来自一个可爱的小配置管理创业公司的团队叫做Puppet，对吧？开始与他们合作，邀请自己参与该项目。上帝保佑他们，我对他们有如此多的爱和尊重，因为他们基本上让这个随机的，随机的学术撕裂他们的研究并重做它并亲切地告诉我以前从未见过的这两个家伙，在电话中，名叫Jean和Jez，他们做错了什么，他们使用的这个词不是正确的词。 Redid，在2013年末，DevOps状态报告，使其在学术上严谨，然后，持续了几年，对吗？然后突然间，我们在几年后重新编写了一堆东西。&lt;/p>
&lt;p>我离开学术界，离开即将任职的地方，去另一个可爱的小配置管理创业公司Chef，这很有趣，对吗？因此，我正在与Puppet合作，为Chef工作，并继续研究并与组织和公司合作。我离开了学术界，因为我看到这个疯狂的DevOps事情有所作为。但是在学术界，他们还没有完全掌握它。而且我想确保我可以做出更大的改变，因为我在98,99,2000开始在大学的科技工作;我们举起这个疯狂的网络泡沫破灭。&lt;/p>
&lt;p>它不是一场萧条，因为一切都崩溃了，世界就像人们想象的那样结束了，但公司失败了，它对人们的遭遇产生了巨大的影响和影响。他们失去了工作，打破了家庭，他们感到沮丧，影响了他们的生活，有些人正在自杀。而且我非常担心当我们再次击中这一波时会发生什么，我们又开始看到那次击中。那么，如果公司和组织不了解制造技术的智能方法会发生什么，因为你不能只是让人们不顾问题，或者让同样的人陷入困境。当我说同样的人扔我的意思时，七天强行游行。&lt;/p>
&lt;p>当他们让我们这样做时，我在IBM，对吗？他们陷入集体诉讼，你不能这样做。这不是一种生活方式。&lt;/p>
&lt;p>迈克朱利安：是的，我参与其中很多，他们是残酷的。而且它们没有任何有用的结果。&lt;/p>
&lt;p>Nicole Forsgren：这只是破碎的心灵和破碎的生命，对吧？所以，有些人喜欢说，你真的关心这个。我只是这个书呆子的学者，他只关心我做的事情。因此，如果我们真的可以，从根本上改变人们制作软件的方式，因为如果它实际上实际上，从根本上改善了他们的生活&amp;hellip;&amp;hellip;让我们这样做。&lt;/p>
&lt;p>然后，感谢上帝，我们发现它确实存在。当然，它很好地为企业提供价值，但这很重要，因为那时它的作用是帮助他们做出更明智的投资，因为这样可以减少倦怠。它让人们更快乐，让他们的生活更美好，我认为这是重要的部分。&lt;/p>
&lt;p>迈克朱利安：所以你发现的是，一家公司实施所有这些更好的持续部署实践，更快的交付时间，更快的价值实现&amp;hellip;&amp;hellip;它使人们的生活更好地完成了工作？&lt;/p>
&lt;p>Nicole Forsgren：是的，John Shook也发现了这一点。对？他在精益中做了这项伟大的工作，为了改变&amp;hellip;有些人说，“你如何改变文化？”让我们找到改变文化的方法。有时，改变文化的最佳方式是改变你的工作方式，我相信我们已经看到了自己，对吗？在我们生活的其他方面。改变我们的感受，改变家庭的工作方式，改变我们的关系工作方式。你实际上改变了你的生活经历，或者你生活经历的某些方面。&lt;/p>
&lt;p>因此，如果我们改变我们制作软件的方式，我们将改变我们团队的运作方式，这正在改变文化的方式。换句话说，如果我们可以告诉我们的组织在技术和流程方面做出哪些明智的投资，那么我们也可以改善文化。我们也可以改变人们的生活吧？微软Bing团队发现了这个，对吧？他们希望在持续交付方面进行明智的投资。&lt;/p>
&lt;p>在一年之内，他们看到了工作生涯的分数，我将其从头脑中拉下来，但我想说它从38％上升到75％。那太大了。&lt;/p>
&lt;p>迈克朱利安：这是一个令人难以置信的跳跃。&lt;/p>
&lt;p>妮可福斯格伦：对。这是因为人们能够在工作中离开工作然后回家。你可以去看你的家人，你可以去看电影，你可以去吃饭，你可以有爱好，或者你可以去狂欢看格雷的解剖。你可以做你想做的。&lt;/p>
&lt;p>迈克朱利安：这对我来说最令人难以置信的事情之一是，为了让公司取得成功，他们必须推动员工，让他们通过振铃器。直观地说，这是永远不会正确的。而你实际上有数据表明这是不对的。做这些事实上让每个人都变得更好。业务得到了显着改善，人们的生活得到了极大的改善，而且一切都很棒。&lt;/p>
&lt;p>Nicole Forsgren：是的，如果我们想要推动人们，这是不可持续的。如果有的话，我们希望推动人们做他们擅长的事情，我们希望利用自动化来实现自动化擅长的事情。那是什么意思呢？&lt;/p>
&lt;p>我们希望让人们做有创意，创新，新颖的事情。让我们让人们解决问题，让自动化做我们需要的一致性，可靠性，可重复性，可自动性。让我们不要让人敲打锤子并不断进行手动测试。让我们让人们弄清楚如何解决问题，做一两次以确保这是正确的事情，自动化，将其委托给自动化，机器和工具，交付，完成，然后拉人回到循环中进入循环，找出新的东西。&lt;/p>
&lt;p>我认为是Jesse Purcell说：“我想让自己不断自动化。”对？使自己脱离当前的工作，然后找到一份新工作，让自己再次自动化。我们永远不会失业。&lt;/p>
&lt;p>Mike Julian：是的，当我第一次开始使用DevOps时，我常常担心这一点，实际上，当我第一次开始自动化时，当时并不是DevOps，它是在大学中自动化Windows桌面部署。这是在21世纪初。我最大的担忧之一是，因为我花了半个星期的时间来做这件事，如果我要自动化，我会花一个小时做这个，剩下的时间我会做什么呢？他们只是要解雇我，因为他们不再需要我了。&lt;/p>
&lt;p>事实证明，不，这根本不是发生的事情。更高的工作价值变得有效，因为我并没有那么专注于辛劳。&lt;/p>
&lt;p>Nicole Forsgren：对，那些类型的东西，机器和电脑都做不到。而另一件事，我曾经告诉我的所有朋友，在工作保障方面不考虑这一点，对吧？不要试图将自己描绘成一个别人无法做到的事情，因为那样你就无法被替换，因为这也意味着你永远无法得到晋升。&lt;/p>
&lt;p>如果我们始终确保工作的某些方面可以实现自动化，以便我们有机会获得新工作，那么这只会为创造更多的事物创造更多机会。总会有问题，我们总有一些问题需要解决。我不想被困在做无聊的工作。&lt;/p>
&lt;p>迈克朱利安：是的，上帝知道这是事实。&lt;/p>
&lt;p>妮可福斯格伦：哦，天哪，我知道。我不想被困在做无聊，重复的工作。这简直令人头痛。如果我们能找到，特别是真正具有挑战性的复杂事物，如果我们能找到自动化的方法，相信我，我们永远不会把自己挖到那个洞的底部。那总是存在的。&lt;/p>
&lt;p>Mike Julian：所以我想谈谈DevOps状态报告，我想先问一个你之前提到过的问题。你提到这句话，学术严谨。那是什么意思？&lt;/p>
&lt;p>Nicole Forsgren：学术严谨包括一些事情，好吗？因此学术严谨的一部分是研究设计。所以这不只是在回答一堆问题&amp;hellip;&amp;hellip;对不起，yolo是我的简写，“你的方法论是有问题的。”&lt;/p>
&lt;p>迈克朱利安：我最近看到很多调查结果出来了。&lt;/p>
&lt;p>Nicole Forsgren：是的。所以一个是研究设计。有人说，“妮可，研究设计是什么意思？”那么研究设计是，您要求的问题类型是否与您用于收集数据的方法相匹配？对？这些东西是否匹配？对于某些事情，调查是恰当的。一次，所以一次是横截面，一个时间跨整个行业的调查。有些事情适合。有些事情不适合。&lt;/p>
&lt;p>一个很好的例子，很多人真的希望我在DevOps状态报告中做开放空间和问题。&lt;/p>
&lt;p>迈克朱利安：这是什么意思？喜欢开放式问题？&lt;/p>
&lt;p>Nicole Forsgren：不，开放空间。所以很多人对开放式办公空间有很多感觉。我应该在开放的办公空间工作吗？开放办公空间会影响生产力吗？或配对编程&amp;hellip;&amp;hellip;配对编程会影响生产力吗？配对编程会影响质量吗？人们对这些事情有很多感觉。在DevOps状态报告中使用的研究设计类型是一个完全匿名部署的调查，在整个行业中的单个时间点，并不适合回答其中任何一个问题的研究设计。&lt;/p>
&lt;p>迈克朱利安：那是为什么？&lt;/p>
&lt;p>Nicole Forsgren：因为您需要做的是拥有更加可控的研究设计。所以我需要知道，例如，你和谁一起工作。我需要知道，所以让我们继续进行同行评审，我需要知道你正在处理的问题类型，代码问题的类型，我现在需要问题的复杂性，我需要知道它花了多长时间，对吧？如果你现在想要提高生产力，对吧？因为我需要了解一定的生产力。我需要知道结果是什么。因此，如果我的结果是生产力，我需要衡量生产力，因为我需要控制困惑，对吧？因为事情比较复杂，我们希望花更长的时间。那些不那么复杂的东西，我希望不会那么久，对吧？&lt;/p>
&lt;p>然后我需要匹配和控制。对？甚至像开放式办公空间这样的东西，对吧？因为如果你在一个开放的办公空间而不是一个开放的办公空间进行同行编程，如果你在办公室里这样做，我需要知道这个人的资历，或者一些资历代理。我现在需要你如何配对，你是否与你的近似经验水平的人配对，如果不是资历经验水平。我需要知道配对编程是如何工作的，我需要知道所涉及的技术，我需要知道你是否偏远，或者你是否真的坐在一起。我需要知道你是否能够同时输入文本，或者是否有人插入而另一个人没有。&lt;/p>
&lt;p>因此，当我进行比较时，我知道比较是什么样的。&lt;/p>
&lt;p>迈克朱利安：这是一个令人难以置信的信息量。我没想到你必须知道这么多才能从中得到一个好的答案。&lt;/p>
&lt;p>Nicole Forsgren：这不是我的头脑。是的，因为你问了我一个很好的问题，我吐了一口气。这只是研究设计，然后你继续分析，对吗？当您继续进行分析时，我们需要了解您提出的问题类型。这些类型的问题，我们是否在考虑相关性？我们在看预测吗？我们在考虑因果关系吗？我们提供哪些类型的数据以及适合哪种类型的分析和问题？&lt;/p>
&lt;p>同样，他们需要以正确的方式匹配。某些类型的数据不适用于某些类型的分析或问题。所以你真的需要确保每一个都适合于正确类型的东西。对？某些类型的分析，如机械，调查问题，永远不适合机械分析，对吧？虽然，老实说，没有人会做机械分析。从来没有，顺便说一句，如果有人来找我并说他们正在做机械分析，我会坐下来非常专心地听你的，非常感兴趣，因为我认为没有人在做机械&amp;hellip;&amp;hellip;这不是一个事情。&lt;/p>
&lt;p>迈克朱利安：所以当你分析调查结果时，我们看到的是一个问题，然后是另一个问题，接下来是另一个问题，你知道数百个问题。当您分析这些内容时，您是在一次查看问题，还是在查看多个问题，然后根据您在几个不同问题中看到的内容来解释答案？&lt;/p>
&lt;p>Nicole Forsgren：所以当我写完结果时，当我写这份报告时，我正在写出我的分析结果，而我的分析正在考虑一个非常非常仔细的研究设计。现在意味着什么，我的研究设计经过精心构建，以尽量减少误解。它试图尽量减少答案中的漂移。所以，我们这样做的一种方式，这在加速的第二部分中概述，如果有任何想要阅读的统计数据书呆子，我们做的事情称为潜在结构。&lt;/p>
&lt;p>所以，你问过只有几个问题或几个问题。我提到过，我们这样做的一种方式称为潜在构造。如果我想问你关于文化的话，我可以向10个人询问文化，我会得到15个答案。因为文化可能意味着许多不同的事情，对吗？一般来说，当我们在DevOps环境中谈论文化时，我们倾向于得到一些东西&amp;hellip;&amp;hellip;人们会说非常常见的事情，如打破孤岛，拥有良好的信任，拥有新奇，对吧？&lt;/p>
&lt;p>因此，我们所做的是从定义开始，然后我们将提出几个项目，问题，捕获每个维度。所以你可能想要考虑一个涂料维恩图，其中每个问题都被覆盖，然后是所有他们拥有最大或完美覆盖的东西，它们是中心，那个小坚果，这就是构造是什么。这就是文化，即文化所代表的。&lt;/p>
&lt;p>然后每个圈子都是问题。这就是我们在研究设计中所做的。研究设计的一部分。当我进入统计分析模式时，我会考虑所有问题，所有项目，不仅仅是文化，而是我正在考虑的每一件事。因此，在过去的几年里，我已经完成了监视可观察性，我已经完成了CI，我已经完成了自动化测试，我已经完成了版本控制，我已经完成了所有这些工作，并且我将所有这些都扔进了漏斗，对？&lt;/p>
&lt;p>迈克朱利安：我敢肯定，这可能是你庞大的Excel电子表格。&lt;/p>
&lt;p>Nicole Forsgren：不，这是SPSS。我使用SPSS但您可以使用几种不同的统计工具。我们做主成分分析。而我们所做的就是它们如何加载？基本上，他们如何组合在一起，我们是否具有收敛有效性？它们会聚合吗？他们只测量他们应该测量的东西吗？我们是否有判别有效性？他们不衡量他们不应该衡量的东西吗？我们有可靠性吗？每个阅读这些问题的人都会以非常相似的方式阅读吗？&lt;/p>
&lt;p>一旦我们掌握了所有这些，并且对所有这些事情进行了几次统计测试，那么我说，“好的，这些项目，通常是三到五项，所有这些项目都是文化，”或“所有这些项目一起是CI，“或”所有这些，正确的这些项目分组，代表了这一点。“好的，现在，现在，我可以开始查看关联，预测或其他内容，然后我会看到报告，现在我只想谈谈文化。&lt;/p>
&lt;p>所以我把它作为一件事情谈论，但实际上是几件事，然后当我谈到文化时，我可以说，“这就是文化是什么”，我可以用这种细微的，多维的方式谈论它，我知道那些维度是什么，因为它由三到五，六到七个问题组成，顺便说一下，如果其中一个问题不合适，因为我从统计分析中知道，我可以抛弃它，我知道为什么。我总是有几件事。如果您只有一个问题或者您只有两个问题，那就是风险。如果其中一个不起作用，哪一个是错误的？你不知道。对？因为，是A还是B？我不知道。&lt;/p>
&lt;p>至少如果我从三开始，一个失败，那么它可能是好的两个。&lt;/p>
&lt;p>迈克朱利安：是的。这里的许多听众已经采取了很多由营销组织进行的调查，除了调查也是由营销人员设计的&amp;hellip;&lt;/p>
&lt;p>Nicole Forsgren：他们是由想要特定答案的人设计的。&lt;/p>
&lt;p>迈克朱利安：没错。&lt;/p>
&lt;p>Nicole Forsgren：这就是挑战。&lt;/p>
&lt;p>迈克朱利安：是的，然而，为了清楚地说明，DevOps状态报告根本就不是这样。正如你所说，有很多东西都是严格的。&lt;/p>
&lt;p>Nicole Forsgren：好的一点是，我们一直是供应商和工具无关的。&lt;/p>
&lt;p>迈克朱利安：你不是在寻找一个非常特别的答案，你想知道实际上是什么。&lt;/p>
&lt;p>Nicole Forsgren：我们并不是在寻找产品的答案。那么，在CI的例子中，什么是CI？我不关心工具。我说，如果你正在做CI，如果你正在进行CI，持续集成，以一种预测智能结果的方式，你将拥有这四样东西。其中的力量是，任何人都可以回过头来看待这个评估工具。如果您是经理，领导者或开发人员，您可以说，“我使用的任何工具，世界上的任何工具，我应该寻找这四件事”，或“我自己构建的任何工具，或者如果我正在做CI，我应该有这四件事。“&lt;/p>
&lt;p>如果你是一个供应商，你应该说，“如果我认为我正在建立或销售CI，我最好有这四件事。对吗？这就是伟大的事情，我必须说，上帝保佑我的新团队。他们让我以同样的方式运行它。它仍然是相同的。它仍然是供应商和工具无关，它仍然是能力集中。你寻找的每一件事，无论是自动化或流程，文化或结果，它的供应商和工具不可知，它的能力集中，再次，权力是你可以用它作为一个评估工具。&lt;/p>
&lt;p>我的团队是这样做的吗？我的工具是这样做的吗？我的技术是这样做的吗？我能做到吗？如果我不是，我的弱点是什么？我的约束是什么？因为如果我把我们带回到开头，是什么驱使我和DORA团队，那么我们想要摆脱这一点是什么？我们想让事情变得更好。我们该怎么做？我们可以为人们提供简单的评估标准。而且我并不是说这很容易，因为所有这些都很简单，需要工作。但如果有明确的评估标准，我们就有了可以去的地方。&lt;/p>
&lt;p>Mike Julian：因为我知道你喜欢谈论你几年来所做的事情。您提出了哪些最有趣的结果？&lt;/p>
&lt;p>Nicole Forsgren：哦，有很多好的。&lt;/p>
&lt;p>迈克朱利安：让我们选择你的前三名。&lt;/p>
&lt;p>Nicole Forsgren：好的，我认为我的最爱之一是，我会用俗气的营销方式来做&amp;hellip;&lt;/p>
&lt;p>迈克朱利安：请接受。我们已经做好了准备。&lt;/p>
&lt;p>Nicole Forsgren：有一个小创业公司并且不得不假装它作为营销人员一分钟的人，我们将看到我在这方面做了什么。&lt;/p>
&lt;p>架构很重要，而不是技术没有。第一。好的。那是什么意思呢？这意味着，我们发现如果您以正确的方式构建它，您的架构结果会比您的技术堆栈产生更大的影响。所以架构成果，一些关键问题是：我可以测试吗？我可以部署吗？我可以建立没有细粒度的沟通和协调吗？&lt;/p>
&lt;p>迈克朱利安：细粒度意味着什么？&lt;/p>
&lt;p>Nicole Forsgren：我是否必须与他人见面并一起工作并征用一些东西，我是否需要开辟一些疯狂的新测试环境，还是必须获得17个不同团队的批准？请注意，我刚刚提到过团队。沟通和协调可能是技术限制，也可能是人的限制。这让人很难回到康威定律。&lt;/p>
&lt;p>迈克朱利安：我最喜欢的法律之一。&lt;/p>
&lt;p>妮可福斯格伦：对吗？这是一个DevOp的事情。但是，这是真的。无论我们的沟通模式如何，我们通常最终会融入我们的技术。现在，我将说这在云和云原生环境中通常更容易实现，但它也可以在Legacy和Mainframe环境中完全实现。我们没有看到前几年布朗菲尔德和格林菲尔德受访者之间存在统计学上的显着差异。&lt;/p>
&lt;p>迈克朱利安：很高兴知道。&lt;/p>
&lt;p>Nicole Forsgren：是的，我喜欢那个。那个人很有趣。&lt;/p>
&lt;p>好的，第二个。云很重要，但只有你做得对。&lt;/p>
&lt;p>迈克朱利安：噢，这意味着什么？&lt;/p>
&lt;p>Nicole Forsgren：Dun dun duh。所以，这是我最喜欢的统计数据之一。我们发现，如果您正在执行所有五个重要的云特征，那么您成为精英表演者的可能性要高23倍。根据美国国家标准技术研究院（NIST）的说法，我想你可以说你是否正在完成云计算的所有五个基本特征。所以我没有提出这个，这来自NIST，好吗？&lt;/p>
&lt;p>所以它很有趣，因为我们询问了很多人是否在云端。他们就像，当然我们在云端，我们完全在云端，对吗？但只有22％的人正在做五件事。那这五个是什么？所以这五个是按需自助服务。您可以在没有人工干预的情况下配置资源，如果您必须填写一张票并等待一个人办票，这不算数。没有积分。&lt;/p>
&lt;p>另一个是广泛的网络访问。因此，您可以通过任何类型的平台访问您的云端内容;手机，平板电脑，笔记本电脑，工作站。大多数人都非常擅长这一点。另一个是资源池，因此可以根据需要动态分配和重新分配资源。另一个是快速弹性，对，爆裂魔法。我们通常都知道这个。&lt;/p>
&lt;p>现在最后一个是测量服务。所以我们只支付我们使用的费用。因此，最常查看的通常是广泛的网络访问和按需自助服务。&lt;/p>
&lt;p>迈克朱利安：是的，有趣的是，对我来说，那里没有任何东西阻止，比如说，从排位赛开始的内部开放堆栈集群。&lt;/p>
&lt;p>Nicole Forsgren：没错，对。所以这可能是私有云。我爱你指出了这一点。之所以如此重要的原因是，它只是归结为执行。它可以完成，另一个挑战是组织，管理人员或董事会经常说你必须去云，所以有人说，“哦，是的，我们要去云端。”但后来有人重新定义了云中的意义。对？所以，你到达那里，有人检查他们的小盒子，把金星放在某人的图表上，他们走开了，他们就像是，“好吧，我们没有看到任何好处。”好吧，是的，因为你没有这样做。&lt;/p>
&lt;p>迈克朱利安：对。是的。&lt;/p>
&lt;p>Nicole Forsgren：就像是，“我买了一个健身房会员，我已经完成了。”不，再说一遍，我不是说这很容易，对吧？有一些工作涉及。现在我喜欢的另一件事是，让我们说你不在云端，由于某种原因你必须留在Legacy环境中，你可以看看这五件事你可以尽可能多地实现，你仍然可以实现利益。&lt;/p>
&lt;p>迈克朱利安：对。这不是一个全有或全无的方法。你可以做其中的一些，并从中获得很多好处。&lt;/p>
&lt;p>Nicole Forsgren：这几乎就像一个骗子回到了第一，这是建筑问题，技术没有。我怎么能做一个备忘单，看看如何到达那里的一些非常好的技巧？&lt;/p>
&lt;p>迈克朱利安：那你的三号是什么？&lt;/p>
&lt;p>Nicole Forsgren：我的第三个可能是，外包不起作用。&lt;/p>
&lt;p>迈克朱利安：是的。&lt;/p>
&lt;p>Nicole Forsgren：有些人讨厌我，他们从他们的眼睛射出激光束。所以我们说外包不起作用*。&lt;/p>
&lt;p>迈克朱利安：好的，什么是星号？&lt;/p>
&lt;p>Nicole Forsgren：Asterisk，星号将是功能性外包不起作用。&lt;/p>
&lt;p>迈克朱利安：好的，所以说外包我的待命职责，可能不会那么好用。&lt;/p>
&lt;p>Nicole Forsgren：拿走所有的DEV，把它运走。全部采用TEST，将其运走。拿走所有OPS，运送它。现在，为什么呢？因为那样，你们所做的一切都是另一套交接，你们创造了另一个孤岛。你还批量完成了大量的工作，而你却让每个人都等待这种情况发生。目标是创造价值而不是让人们等待。如果现在每个人都必须等待所有东西回来，如果你正在做高价值的工作等待低价值的工作，因为它必须回到一起，这通常是它的工作方式，你是骨头。&lt;/p>
&lt;p>现在，功能外包。如果您有一个与您合作并与您协调并以相同的节奏交付的外包合作伙伴，那么这不是功能性外包。那是星号。&lt;/p>
&lt;p>迈克朱利安：好的，有问题。&lt;/p>
&lt;p>Nicole Forsgren：另外，如果他们是你的团队的一部分，他们是你公司的一部分，但他们基本上一次消失了三个月。对不起孩子，这是功能外包。我没有任何积分，愿上帝怜悯你的灵魂。这没用。&lt;/p>
&lt;p>迈克朱利安：对。在我看来，你怎么知道你是否处于这种困境中，如果你的团队和你给这些项目的人之间有明显的交接，你就有功能外包。那会是对的吗？&lt;/p>
&lt;p>Nicole Forsgren：是的，特别是如果有一个明显的手，然后是一个黑盒子的神秘。&lt;/p>
&lt;p>迈克朱利安：就像，工作是如何完成的？&lt;/p>
&lt;p>Nicole Forsgren：第一步，第二步，问号，第三步：获利。&lt;/p>
&lt;p>迈克朱利安：也许吧。所以前两个，这一切都很好，因为我们可以看到从哪里去，但第三个实际上看起来有点困难，因为如果我是一个系统管理员，我完全无法控制这个功能外包。我可能也讨厌它，我可能自己讨厌它，但我对它没有任何控制权。我可以做什么作为系统管理员，或操作员，开发人员，我该如何改善这种情况？&lt;/p>
&lt;p>妮可福斯格伦：所以一些想法可能包括一些事情，看看是否有任何方法可以改善过渡期间的沟通或节奏。对？您可能仍然拥有该外包合作伙伴，因为这就是它的方式。但是，假设您已经以三个月的增量进行了工作，有没有办法将切换增加到每月一次？有没有什么方法可以让我们知道我们知道我们导入的功能，小批量工作，只是增加切换？有什么方法可以将它们整合到我们的节奏中，融入我们的团队吗？&lt;/p>
&lt;p>现在我意识到这里有一些挑战，因为从法律的角度来看，我们不能像我们的团队那样对待他们，因为那时，至少从美国的角度来看，一旦我们像对待员工那样对待他们，那么我们就要对就业税负责以及所有其他合法的东西。但是，如果我们能够将它们整合到我们的工作节奏中，或者更接近我们的工作节奏，那么我们的结果就会得到改善。&lt;/p>
&lt;p>迈克朱利安：好的，很酷。这更有意义。这听起来并不像我担心的那么难。&lt;/p>
&lt;p>Nicole Forsgren：所以它可以开始减少节奏的延迟，要求稍微更清楚地了解正在发生的事情，如果它是一个完整的黑盒子，那就是寻找它。&lt;/p>
&lt;p>迈克朱利安：妮可，这绝对是太棒了。非常感谢你加入我。我有两个最后的问题。人们在哪里可以找到这个DevOps状态报告来进行调查？调查在哪里？&lt;/p>
&lt;p>Nicole Forsgren：哦，我们已经发布了调查结果。我可以将它包含在演出笔记中吗？&lt;/p>
&lt;p>迈克朱利安：当然。好的，大家，查看链接的节目说明。我的最后一个问题是除了这项调查之外，人们可以在哪里找到更多关于你和你的工作的信息？&lt;/p>
&lt;p>Nicole Forsgren：我有几个地方。所以我自己的网站是在nicolefv.com，我总是在Twitter上，通常谈论冰淇淋和健怡可乐，那是@nicolefv。&lt;/p>
&lt;p>迈克朱利安：我确实爱你Twitter推特。这是我的最爱之一。&lt;/p>
&lt;p>Nicole Forsgren：是的，每个人都来打个招呼。我的DM是开放的。&lt;/p>
&lt;p>迈克朱利安：我最喜欢你的Twitter提要大概是在你写报告的时候，说：“天哪，我为什么要这样做？”&lt;/p>
&lt;p>Nicole Forsgren：是的，我试着把它锁起来，但每隔一段时间就会有什么东西会滑落，比如“哦，我的天哪，一件好事正在发生”，或者“哦，我忘记了这一件事”，或“那么多好事正在发生。“&lt;/p>
&lt;p>迈克朱利安：是的，我记得去年就像，“哦，我的上帝，这太酷了，但我无法告诉你。”&lt;/p>
&lt;hr></description></item><item><title>2019年关于DevOps的几个预测</title><link>https://martinliu.cn/blog/2019%E5%B9%B4%E5%85%B3%E4%BA%8Edevops%E7%9A%84%E5%87%A0%E4%B8%AA%E9%A2%84%E6%B5%8B/</link><pubDate>Sat, 09 Mar 2019 22:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/2019%E5%B9%B4%E5%85%B3%E4%BA%8Edevops%E7%9A%84%E5%87%A0%E4%B8%AA%E9%A2%84%E6%B5%8B/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15218597150085.jpg" alt="Featured image of post 2019年关于DevOps的几个预测" />&lt;p>本文汇聚了来自3个网站的预测文章，他们分别是XebiaLabs、G20Group和Veritis。在总共22项预测中，个别预测是相同的。DevOps是一个持续进化和发展的过程，同时也受到目前各种新技术的影响。&lt;/p>
&lt;h2 id="xebialabs的7个预测">XebiaLabs的7个预测
&lt;/h2>&lt;p>英文原文： &lt;a class="link" href="https://blog.xebialabs.com/2019/01/10/7-predictions-for-devops-in-2019/" target="_blank" rel="noopener"
>https://blog.xebialabs.com/2019/01/10/7-predictions-for-devops-in-2019/&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://blog.xebialabs.com/wp-content/uploads/2019/01/crystal-ball-768x450.jpg"
loading="lazy"
alt="XebiaLabs的7个预测"
>&lt;/p>
&lt;h3 id="1-持续集将成作为流水线的重要代办事项">1. 持续集将成作为流水线的重要代办事项
&lt;/h3>&lt;p>如果企业希望提高团队用在功能开发上的可用时间，从而加速向生产环境中交付的话，那么在整个DevOps流水线中，引进持续集成CI部分将成为高优先级且重要的事项。监控CI流水线相关的数据、活动和流程的能力将变得非常重要，这样可以使发布流程中的所有人都能看到最新的流程状态，从而减少开发人员花费在无关任务上的时间。 【来自：XebiaLabs产品开发副总裁Andreas Prins】&lt;/p>
&lt;h3 id="2-价值流映射将被广泛使用">2. 价值流映射将被广泛使用
&lt;/h3>&lt;p>目前，随着软件交付的速度和质量正成为大型企业的巨大竞争优势，越来越多的组织将会探索价值流映射（Value stream mapping）的使用方式，从而确保他们的软件开发是和整体业务价值保持一致的。这种转变将会减少软件发布流水线中的浪费，并创建出更强大的跨职能团队协作。【来自：Lisa Wells，XebiaLabs产品营销副总裁】&lt;/p>
&lt;h3 id="3-实时挖掘软件交付流水线所产生的数据">3. 实时挖掘软件交付流水线所产生的数据
&lt;/h3>&lt;p>在2019年，IT部门通过软件持续不断创造业务价值的压力将会越来越高。因此，组织将用各种方法挖掘在软件交付流程中大量的由机器所生成的数据，而不只是在事后才进行分析，甚至还包括DevOps的可预测性。这样才能够更好地预测软件交付流程和基础架构中所发生的问题，而这些问题可能对应用程序的质量和安全性产生负面影响，可能会使产品上市时间延期。【来自： Lisa Wells，XebiaLabs产品营销副总裁】&lt;/p>
&lt;h3 id="4-在人和流程中培养责任共但文化">4. 在人和流程中培养责任共但文化
&lt;/h3>&lt;p>DevOps同时关乎于人、流程和工具。对于任何DevOps实施计划而言，需要将人和流程视为首要的交付价值的因素。在2019年，我们将看到企业会越来越重视培养承担责任的文化，团队在复杂的应用程序交付流水线中共同承担质量和效率的责任。各个团队需要及时了解协作和进度。关键是在项目的进展过程中，及时的与整个公司分享那些取得了成功的措施和及其成果。除了证明他们的努力能够带来重大成果之外，毕竟，也没有什么比这种方式更能激励团队的了。【来自：T.J. Randall，客户成功副总裁，XebiaLabs】&lt;/p>
&lt;h3 id="5-自服务部署将成为主流">5. 自服务部署将成为主流
&lt;/h3>&lt;p>随着自动化部署已经成为企业的标准实践，随着组织逐渐地意识到可以将信息安全和合规性也融入到他们的交付流程中，在2019年，自助服务式部署会成为主流的工作实践。【来自：T.J. Randall，客户成功副总裁，XebiaLabs】&lt;/p>
&lt;h3 id="6-建立自己的devops能力度量组合">6. 建立自己的DevOps能力度量组合
&lt;/h3>&lt;p>随着DevOps的投资增加，管理层将需要更多的投资回报率证据。团队需要建立他们基于全局测量（不仅仅是单个团队或个人）和结果（具有速度和稳定性的软件交付）的组合来测量DevOps（DevOps Intelligence）的能力。【来自：Vincent Lussenburg，DevOps战略总监，XebiaLabs】&lt;/p>
&lt;h3 id="7-devsecops融入到devops流程中">7. DevSecOps融入到DevOps流程中
&lt;/h3>&lt;p>对信息安全“前置（左移）”的需求将会在DevOps实践中得到更好的理解和更有效的应用。在2018年，“前置（左移）”经常被滥用，被误以为会把软件的安全性责任推给开发人员。在2019年，DevSecOps将成为DevOps的另一个自然的选择，将安全性融入到流程中的每个阶段，并且所有人都对安全性有责任。【来自：Vincent Lussenburg, Director of DevOps Strategy, XebiaLabs】&lt;/p>
&lt;h2 id="g20group的5个预测">G20Group的5个预测
&lt;/h2>&lt;p>原文：https://www.go2group.com/blog/devops-trends-2019-our-top-five-predictions-for-the-year/&lt;/p>
&lt;p>&lt;img src="https://cdn.go2group.com/wp-content/uploads/2019/01/CC-173-devops-trendsV3.jpg"
loading="lazy"
alt="5个预测"
>&lt;/p>
&lt;p>由于文章比较长，下面是核心观点的概述。&lt;/p>
&lt;ol>
&lt;li>使用AI加速/优化的DevOps将开始被逐渐应用。基于AI的预测性可以被用在CI或者CD栋流水线过程中，确保交付流程的有效性。这个趋势将加速应用开发者和数据科学家之间的协作。&lt;/li>
&lt;li>容器化应用不在是新鲜事物了。DevOps和多云架构加速了容器相关的技术在大型企业中国的使用。越来越巨大的软件开发和部署规模也进一步提高了容器生产环境集群的规模和复杂性。Kubernets的广泛使用也进一步加速了应用容器化的进程。&lt;/li>
&lt;li>Functions-as-a-Service (FaaS) 将会崭露头角。随着越来越多的专业人士在生产环境中广泛的使用容器技术。相信FaaS也会逐渐被应用起来，它也比称之为无服务器计算。这种技术的实现包括：AWS Lambda、Google Cloud Functions, Microsoft Azure Functions, IBM 等。&lt;/li>
&lt;li>DevSecOps会变得更加重要。随着企业应用DevOps的范围逐渐扩大化，将安全性和合规性无缝的集成到DevOps转型过程中也得到了广泛的接受。主流的DevOps实践者会把安全性视为代码，安全团队会在DevOps工作流中和各种团队携手打造安全性。&lt;/li>
&lt;li>自动化将会依然非常重要。企业越来越意识到在软件开发周中提高响应速度、运维的可恢复性、更快的上市时间的重要性；这需要将软件开发和运维工作通过自动化更好的链接起来。组织在复杂的生态系统中扩大自动化的应用还是有些难度。&lt;/li>
&lt;/ol>
&lt;h2 id="来自veritis的10个预测">来自Veritis的10个预测
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/DevOps-top-10-Predictions-2019-768x1152.jpg"
loading="lazy"
alt="10个预测"
>&lt;/p>
&lt;p>原文： &lt;a class="link" href="https://www.veritis.com/blog/devops-trends-top-10-predictions-for-devops-in-2019/" target="_blank" rel="noopener"
>https://www.veritis.com/blog/devops-trends-top-10-predictions-for-devops-in-2019/&lt;/a>&lt;/p></description></item><item><title>产品管理遇上Devops</title><link>https://martinliu.cn/blog/csg-product-meet-devops/</link><pubDate>Thu, 07 Mar 2019 12:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/csg-product-meet-devops/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1551950710/bjxysnye.png" alt="Featured image of post 产品管理遇上Devops" />&lt;p>DevOps企业峰会是历史悠久的DevOps主题企业级峰会，近年来在北美的拉斯维加斯和欧洲的伦敦每年各举办一次。
&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_15-50-17.jpg"
loading="lazy"
alt="2019-03-07_09-17-49"
>&lt;/p>
&lt;p>这个大会的官网：&lt;a class="link" href="https://events.itrevolution.com/" target="_blank" rel="noopener"
>https://events.itrevolution.com/&lt;/a> 2019年的会议时间已经发布，感兴趣的可以参加。&lt;/p>
&lt;p>CSG公司连续多年参加DevOps企业峰会，本分享主题是CSG在2018年美国拉斯维加斯的峰会上的主旨演讲之一。本文是对这个演讲的视频回放的整理，该视频已经上传到了腾讯视频。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_15-50-44.jpg"
loading="lazy"
alt="2019-03-07_09-17-49"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;h2 id="csg-international公司简介">CSG International公司简介
&lt;/h2>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_09-17-49.jpg"
loading="lazy"
alt="2019-03-07_09-17-49"
>&lt;/p>
&lt;p>CSG是一个基于SaaS的客户支持和计费公司。CSG是美国最大的账单打印和呼叫中心公司。帮助他们的合作伙伴公司完成水电费、宽带费、通信费等相关业务的收款工作，并为最终客户提供热线电话支持。&lt;/p>
&lt;p>CSG的技术堆栈范围广泛，从Mainframe主机到Linux开放系统到AWS云服务，CSG认为如果正确的运用DevOps技术的话，技术堆栈并不是阻力和限制。&lt;/p>
&lt;p>CSG的DevOps旅程经历了如下几个阶段。&lt;/p>
&lt;h2 id="2012年-敏捷转型">2012年 敏捷转型
&lt;/h2>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_09-31-46.jpg"
loading="lazy"
alt="2019-03-07_09-31-46"
>&lt;/p>
&lt;p>敏捷转型历经四年，进行了组织结构调整，在这个过程中关注点和亮点如下：&lt;/p>
&lt;ul>
&lt;li>应用精益思想消除了各种等待队列&lt;/li>
&lt;li>应用康威定律重组重组了团队&lt;/li>
&lt;li>重组团队之后形成跨职能团队，将设计团队，开发和测试团队融为一体&lt;/li>
&lt;li>实施持续集成技术，落地持续部署流水线作为业务开发的基础设施&lt;/li>
&lt;li>实施了测试自动化&lt;/li>
&lt;li>实施了共享的遥测数据，这就是今天所热议的可观察性&lt;/li>
&lt;li>将作业批量尺寸缩减为以前的一半&lt;/li>
&lt;li>成立了多个独立于研发团队的共享的运维团队【注意：运维还没有和研发团队融为一体，共享运维团队管理所有IT环境并和所有产品团队协作】&lt;/li>
&lt;/ul>
&lt;p>敏捷转型的效果：&lt;/p>
&lt;ol>
&lt;li>发布影响业务的事件数量下降（在固定的时间周期里统计由于发布导致的影响客户服务的事件数量）&lt;/li>
&lt;li>变更失败率下降&lt;/li>
&lt;/ol>
&lt;h2 id="2012-2015-敏捷转型和devops早期">2012-2015 敏捷转型和DevOps早期
&lt;/h2>&lt;p>在敏捷转型的持续集成的基础上，CSG实施了持续部署实践，持续部署被视为应用DevOps实践的标志性动作，将所有部署转为为可重复执行的自动化部署。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_09-46-07.jpg"
loading="lazy"
alt="2019-03-07_09-46-07"
>&lt;/p>
&lt;p>上图是运维工程师们在工作时段里进行日间部署的场景，但是平均每天进行15.1个部署，71个面向最终用户的特性发布。在部署期间，运维工程师们在信心满满的打着电动。由于每一个生产环境的部署都已经做过了大量的自动化测试，且在其它环境中至少部署过7遍了。&lt;/p>
&lt;h2 id="2016-反作用力和挣扎期">2016 反作用力和挣扎期
&lt;/h2>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_09-57-30.jpg"
loading="lazy"
alt="2019-03-07_09-57-30"
>&lt;/p>
&lt;p>上图的情形应该很常见，CSG也经历了这个阶段。&lt;/p>
&lt;p>开发团队追逐：&lt;/p>
&lt;ul>
&lt;li>交付速度&lt;/li>
&lt;li>更好、更快的环境&lt;/li>
&lt;li>更好的服务请求工具&lt;/li>
&lt;li>憎恨变更请求队列（流程）&lt;/li>
&lt;/ul>
&lt;p>运维团队追逐：&lt;/p>
&lt;ul>
&lt;li>稳定性！&lt;/li>
&lt;li>高质量代码&lt;/li>
&lt;li>更敏捷的工具&lt;/li>
&lt;li>憎恨变更请求队列（流程）&lt;/li>
&lt;/ul>
&lt;p>开发和运维团队都厌恶的：&lt;/p>
&lt;ul>
&lt;li>变更管理流程&lt;/li>
&lt;li>发布管理流程&lt;/li>
&lt;li>生产环境的运维部门&lt;/li>
&lt;li>PMO项目经理&lt;/li>
&lt;/ul>
&lt;p>客户想要的是：“更快得到高质量的特性！”&lt;/p>
&lt;h2 id="2016-devops团队融合阶段">2016 DevOps团队融合阶段
&lt;/h2>&lt;p>大家一起反思这个问题：“我们为何不站在同一条战线上，一起追逐相同的目标？”&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_10-05-41.jpg"
loading="lazy"
alt="2019-03-07_10-05-41"
>&lt;/p>
&lt;p>设置共同（共享）目标：更快、更稳定和更安全！融为同一个团队，为了更好的服务客户而努力奋斗。&lt;/p>
&lt;h2 id="20162018-后devops时代">2016~2018 后DevOps时代
&lt;/h2>&lt;p>为了化解在的研发和运维之间的依然持续存的矛盾现象，在大家反思之后；进行了再次的团队组织结构调整，消除了所有共享的运维团队，将运维团队的工程师融入了各个研发团队。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_10-34-22.jpg"
loading="lazy"
alt="2019-03-07_10-34-22"
>&lt;/p>
&lt;p>CSG的DevOps转型阶段的重点：&lt;/p>
&lt;ul>
&lt;li>运用了不同于双模IT的模型，即”统模IT“，在DevOps实践面前，各种类型的IT架构都一视同仁&lt;/li>
&lt;li>转型后的开发团队统一负责产品的构建、测试、运行和服务质量&lt;/li>
&lt;li>下放变更管理委员会（CAB）职责到各个开发团队，成立本地化的CAB（详见ITIL的术语表）&lt;/li>
&lt;li>建立了群策群力的服务支持响应机制（参考精益思想的安灯拉绳），因此大幅度缩短了MTTR时间&lt;/li>
&lt;li>实施了反向布兰特操作，消除大量普遍存在的布兰特（这是一个比喻，详见《凤凰项目》的人物布兰特）&lt;/li>
&lt;li>建立整合的Backlog，将开发、测试和运维的工作统筹管理&lt;/li>
&lt;li>实施基础设施自动化&lt;/li>
&lt;li>将运维问题（目标不一致、反作用力、部门墙）视为工程实践问题：更好的工程实践，更少的苦活累活！&lt;/li>
&lt;/ul>
&lt;p>【注意】如上图所示，新增了一个度量指标：Inc/Mo 每月的事件数量（ITIL的术语），这是生产环境中每月发生的事件单的数量，数量的降低说明了生产环境的稳定性的提高。&lt;/p>
&lt;p>CSG在这个阶段中所引入的DevOps实践参考指南书籍是《DevOps Handbook》，中文版封面如下图所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1524360305/devops-handboo-3d-500x500.jpg"
loading="lazy"
alt="DevOps Handbook"
>&lt;/p>
&lt;p>&lt;a class="link" href="https://book.douban.com/subject/30186150/" target="_blank" rel="noopener"
>https://book.douban.com/subject/30186150/&lt;/a>&lt;/p>
&lt;p>在始于2016年的DevOps旅程中，CSG从改善负面指标阶段，步入了追逐正向业务价值目标的阶段。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_11-01-46.jpg"
loading="lazy"
alt="2019-03-07_11-01-46"
>&lt;/p>
&lt;p>CSG通过打敏捷开发、精益思想和DevOps实践的组合拳，实现了稳定性和业务的同步增长。&lt;/p>
&lt;ul>
&lt;li>从2012年到2018年业务订阅用户数增长了27%。&lt;/li>
&lt;li>生产系统的交易吞吐量（TPS每秒的交易数），增长了433%&lt;/li>
&lt;/ul>
&lt;h2 id="产品管理遇上devops的主旋律">产品管理遇上DevOps的主旋律
&lt;/h2>&lt;p>产品管理和DevOps之间的关系该如何协调和处理，在这个阶段里得到了定义。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_11-13-18.jpg"
loading="lazy"
alt="2019-03-07_11-13-18"
>&lt;/p>
&lt;p>整个集体应该遵从的三大主旋律：&lt;/p>
&lt;ol>
&lt;li>将策略连接落实到人，从而改善了产品管理和DevOp的关系，基于相同的业务诉求：实现了更好的价值产出&lt;/li>
&lt;li>IT不是是独立于业务之外：管理的应该是产品价值流，而非项目。&lt;/li>
&lt;li>运维问题是一个同时于与工程和产品都相关的问题&lt;/li>
&lt;/ol>
&lt;p>见上图，寻找划出的重点和关键词。&lt;/p>
&lt;p>出现了新的度量指标：&lt;/p>
&lt;ul>
&lt;li>Impact minutes ：业务恢复时间 MTRR&lt;/li>
&lt;li>Release on demand ： 特性按需发布比率&lt;/li>
&lt;li>eNPS ：员工对企业的点赞比率&lt;/li>
&lt;/ul>
&lt;p>以上数据的度量周期是从2017年至今的，影响这些指标的内因包括：&lt;/p>
&lt;ul>
&lt;li>精益领导力组合&lt;/li>
&lt;li>产品经理遇上DevOps&lt;/li>
&lt;/ul>
&lt;h2 id="产品管理为何要遇上devops">产品管理为何要遇上DevOps？
&lt;/h2>&lt;p>在CSG工作了19年之久，经历和目睹敏捷和DevOps转型全过程的项目经理，Brian Clark（VP Product management）的简单版答案：“业务成果”。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_11-32-23.jpg"
loading="lazy"
alt="2019-03-07_11-32-23"
>&lt;/p>
&lt;p>CSG的处于一个非常稳定的成熟市场，而且是市场的领导者；上游的电信运营商公司和宽带网络公司的业务都已经很难成长了。&lt;/p>
&lt;p>CSG所在行业的复合年均增长率约等于2%，CSG公司的复合年均增长率是3.92%。他们面临着如何保留高级技术人才的挑战。而在实施了DevOps实践之后，业务成果好转，新增了两个BBS企业客户。雇员的eNPS增长了400%，人员保有率大于95%，目标市场的业务占用率提高了。&lt;/p>
&lt;p>从2015开始产品经理和DevOps团队开始讨论“团队的精益领导力组合”，定义了组织级别的愿景：“将工作可视化，把我们的人员和策略链接在一起，驱动参与度、价值和兴奋度。”&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_11-59-38.jpg"
loading="lazy"
alt="2019-03-07_11-59-38"
>&lt;/p>
&lt;p>所谓的精益领导力组合如下图所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_12-02-46.jpg"
loading="lazy"
alt="2019-03-07_12-02-46"
>&lt;/p>
&lt;p>主要有三部分组成：&lt;/p>
&lt;ol>
&lt;li>组合管理&lt;/li>
&lt;li>发布管理&lt;/li>
&lt;li>转型赋能&lt;/li>
&lt;/ol>
&lt;p>回顾一下CSG过去的三年，主要经历了6里程碑。
&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-18-48.jpg"
loading="lazy"
alt="2019-03-07_14-18-48"
>&lt;/p>
&lt;h3 id="1-服务请求管理">1 服务请求管理
&lt;/h3>&lt;p>从梳理服务目录开始，将100多种IT服务梳理在一个服务目录中，需要这些服务的人通过服务请求并获得服务。以前这些服务工作交付所付出的大量运维性劳动是无法可视化和计量的。通过服务目录的不断完善，以前不可见的运维工作都可以察觉到，并可以计量和统计。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_12-11-29.jpg"
loading="lazy"
alt="2019-03-07_12-11-29"
>&lt;/p>
&lt;p>到2018年为止，统计数据表明：&lt;/p>
&lt;ul>
&lt;li>服务目录管理的服务条目数量是 620 个&lt;/li>
&lt;li>从服务目录创建并完成的服务请求单数量是 53000+ 个&lt;/li>
&lt;li>使用同一个服务目录增加了工作的可视化程度，并且还具有潜在的成长空间&lt;/li>
&lt;li>服务目录请求站点的访问量达到了 75000+ 次&lt;/li>
&lt;/ul>
&lt;p>服务目录的实施结果是可以被统计的，将这些数据呈现给了领导层团队；领导层随后决定增加了这些方面的投资，从而优化和消除了大量可重复的工作。这个阶段的成果也是非常突出的。举两个简单的例子如下：&lt;/p>
&lt;ol>
&lt;li>自动化了一个非常耗时的服务，该项服务每年需要消耗5000+人工时，这几乎是3个专职工程师一年的工作量。&lt;/li>
&lt;li>优化了一个通常需要耗时10天才能完成的服务，后来该项服务现可以在请求的当天就得以满足。&lt;/li>
&lt;/ol>
&lt;p>随着以上成果的逐渐扩大化，服务请求方和交付方都更加愿意和领导团队接触，并参与到等多的提议和计划中。这些成果足以值得让团队兴奋起来，下图是史诗一号团队在举行团建活动，以此来庆祝第一步的成功。【注：想获取兴奋度就喝起来！】&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_12-16-40.jpg"
loading="lazy"
alt="2019-03-07_12-16-40"
>&lt;/p>
&lt;h3 id="2-建立技术和产品组合规划室---tam-room">2 建立技术和产品组合规划室 - TAM Room
&lt;/h3>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_12-57-06.jpg"
loading="lazy"
alt="2019-03-07_12-57-06"
>&lt;/p>
&lt;p>为了让项目执行过程和项目中的工作内容都更加可视化，建立了“技术和产品组合规划室”。在这个房间的墙上设立大型工作看板，将不同类型的工作用不同的颜色表示。这面墙展示了所有团队当前的工作内容，是产品和项目级别管理的全貌，任何事情如果不在这面墙上，团队不会对它耗费一秒钟。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_12-57-20.jpg"
loading="lazy"
alt="2019-03-07_12-57-20"
>&lt;/p>
&lt;ul>
&lt;li>蓝色： 安全相关&lt;/li>
&lt;li>红色：客户相关&lt;/li>
&lt;li>黄色：云计算相关&lt;/li>
&lt;li>绿色：技术相关&lt;/li>
&lt;li>橙色：项目管理&lt;/li>
&lt;/ul>
&lt;p>这些是史诗级别的工作，是经过客户优先级排序的工作。 接下来构建了十六个团队的团队级别看板，团队会把这些实施工作拿走到他们自己的看板上。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_13-01-47.jpg"
loading="lazy"
alt="2019-03-07_13-01-47"
>&lt;/p>
&lt;p>当团队工作在这个看板上之后，团队可以很好的处理计划外工作。如果有什么经理人员向团队提出其它工作的时候，团队可以回答“Yes”；然后请他看看当前的工作状态，说出可能的选项是什么？【注：讨论的结果很可能是，用Yes婉拒了计划外工作，或者请工作提出者交换他的进行中的工作。】&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_13-08-31.jpg"
loading="lazy"
alt="2019-03-07_13-08-31"
>&lt;/p>
&lt;p>TAP Room还是每个一个项目周期结束时，大家一起做回顾的场所，房间里提供了汉堡和热狗等午餐，团队成员用午餐会的形式交流各自的收获和想法。&lt;/p>
&lt;h3 id="3-向全员推广并提升参与度---各种坛子">3 向全员推广，并提升参与度 - 各种坛子
&lt;/h3>&lt;p>如何将以上的成功经验传播到整个组织里，如何让更多的人参与其中，并提升全员的参与度。CSG创建了各种坛子的想法。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_13-15-03.jpg"
loading="lazy"
alt="2019-03-07_13-15-03"
>&lt;/p>
&lt;p>每个坛子都有各自的负责人和执行周期。如Shark Tank是两周进行一次，如果任何人对产品和技术有谏言建议都会发到这里，负责人会统一收集和用不同的优先级排序。&lt;/p>
&lt;ul>
&lt;li>Shark Tank 组织战略级别的，由VP们管理&lt;/li>
&lt;li>Think Tank 产品组合级别的，由产品经理/负责人管理&lt;/li>
&lt;li>DO Tank Scrum团队级别，由团队的负责人管理&lt;/li>
&lt;/ul>
&lt;p>上面一行的三个坛子是把组织级别的业务战略直接贯彻和对齐到底（Engineer）方式，当然任何人也可以在各个层面上提出反馈建议，并实现了每个人的参与度的从下而上的反馈回路。&lt;/p>
&lt;p>下面一行的三个坛子和他们的组织架构相关，也分别有各种独立的定义和用法，所有坛子都是两周执行一次回顾和处理。&lt;/p>
&lt;h3 id="4-倡导价值驱动和交付">4 倡导价值驱动和交付
&lt;/h3>&lt;p>在这个阶段中，CSG不想仅仅止步于成功经验的传播和反馈，希望让更多人知道能从哪里，获得他们需要的信息和帮助，从而复制那些在组织级别已经取得成功的套路。&lt;/p>
&lt;p>CSG制作了视频短片，用阶段性回顾的方式，总结了他们所谓的参与度、有趣、有价值和有意义等概念，希望人多人能加入到史诗团队中。让人们觉得是和公司息息相关的。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_13-33-37.jpg"
loading="lazy"
alt="2019-03-07_13-33-37"
>&lt;/p>
&lt;p>这个短片用产品周报发布的全公司，根据数据统计显示，有大约500人在发布的当天从头看到尾。使所有人都参与到价值交付中，并感受到激动。&lt;/p>
&lt;h3 id="5-产能洞察管理---capacity-insights">5 产能洞察管理 - Capacity Insights
&lt;/h3>&lt;p>CSG也和其它所有公司一样，每个团队都很忙，项目经理和交付的工程师团队也存在在感受不一致的情况。如下高压力对话也很常见。&lt;/p>
&lt;ul>
&lt;li>你们能做更多工作么？&lt;/li>
&lt;li>不能！&lt;/li>
&lt;li>怎么会啊！&lt;/li>
&lt;li>我们很忙！&lt;/li>
&lt;li>给我一个忙的证据！&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_13-52-11.jpg"
loading="lazy"
alt="2019-03-07_13-52-11"
>&lt;/p>
&lt;p>产能管理工具（Capacity Insights）的出现缓解了这个问题，首先，CSG把计划内的工作输入到这个工具里，并进行工作量的跟踪和记录。同时还把计划外的工作也纳入这个系统，进行统一的跟踪和记录。这里的数据在项目、产品和团队级别上被透明的分享和沟通，从此团队的高压力对话现象得到了大幅度的缓解，大家更有意愿进行合作了。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_13-53-16.jpg"
loading="lazy"
alt="2019-03-07_13-53-16"
>&lt;/p>
&lt;p>这些数据可以按照各种价值流的维度将耗费的工作时间（计划和实用）统计出来，并按照产品、团队和技术技能等各种维度进行钻去和统计。这样就可以把宝贵的产能合理的使用，实现了好钢用在刀刃上。&lt;/p>
&lt;h3 id="6-生活和工作平衡">6 生活和工作平衡
&lt;/h3>&lt;p>CSG不希望工程师团队周末加班，当然一周工作时间超长的情况也很常见，CSG希望他们能过上正常人的生活。领导层关注到这个问题后，开始实施一些措施。建立了产品迭代回顾的画廊，如下图所示。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-05-09.jpg"
loading="lazy"
alt="2019-03-07_14-05-09"
>&lt;/p>
&lt;p>在这个画廊上关注着一些数据的状态。&lt;/p>
&lt;ul>
&lt;li>31个团队的总工作时间是15000小时&lt;/li>
&lt;li>削减了25%的值守加班时间&lt;/li>
&lt;li>削减了100%的测试数据配置工作，用自动化的方法削减了相当于3个全职工程师的工作量&lt;/li>
&lt;li>用自动化的方式消除了某个业务流程确认环节90%的时间&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-14-16.jpg"
loading="lazy"
alt="2019-03-07_14-14-16"
>&lt;/p>
&lt;p>CSG的成功秘诀是人，这都仰仗于赋能的员工：开放、分享、参与和兴奋。&lt;/p>
&lt;h2 id="产品和项目的pk">产品和项目的PK
&lt;/h2>&lt;p>对于这个话题的总结如下。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-21-06.jpg"
loading="lazy"
alt="2019-03-07_14-21-06"
>&lt;/p>
&lt;ul>
&lt;li>部门墙（Queue）有碍于学习进步&lt;/li>
&lt;li>基于项目的团队管理有碍于学习进步&lt;/li>
&lt;li>基于产品的团队才可以精进成长&lt;/li>
&lt;/ul>
&lt;p>CSG公司在2017年以前的工作模式，产品和项目并存。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-25-21.jpg"
loading="lazy"
alt="2019-03-07_14-25-21"
>&lt;/p>
&lt;p>开发团队 - 产品工作&lt;/p>
&lt;ul>
&lt;li>基于业务需求的史诗 （最左侧的）&lt;/li>
&lt;li>基于发布节奏的工作&lt;/li>
&lt;li>管理产品代办工作&amp;amp;排序&lt;/li>
&lt;li>交付工作完成的解决方案&lt;/li>
&lt;/ul>
&lt;p>运维团队 - 项目工作&lt;/p>
&lt;ul>
&lt;li>处理临时、非计划的发布工作&lt;/li>
&lt;li>被各种会议驱动和中断&lt;/li>
&lt;li>接受研发发布过来的解决方案（临时和计划的）&lt;/li>
&lt;li>同时处理各种基础设施的IT项目（最右侧的）&lt;/li>
&lt;/ul>
&lt;p>当两者的工作节奏交织在一起的时候，就会产生各种冲突。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-32-34.jpg"
loading="lazy"
alt="2019-03-07_14-32-34"
>&lt;/p>
&lt;p>出现了各种明显的问题：&lt;/p>
&lt;ul>
&lt;li>双向的依赖关系&lt;/li>
&lt;li>多个任务工作时间计划相互撞车&lt;/li>
&lt;li>缺乏统一的依赖管理和产能规划，这进一步产生了大量进行中工作（WIP）&lt;/li>
&lt;li>项目制的工作模式导致研发在迫于发布周期的情况下，交付了质量很低的解决方案&lt;/li>
&lt;/ul>
&lt;p>CSG随后进行了基于价值流的产品条线的聚焦，将开发和运维团队的代办工作事项都整合到了统一的单独入口，从而进行统一的管理。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-40-40.jpg"
loading="lazy"
alt="2019-03-07_14-40-40"
>&lt;/p>
&lt;ul>
&lt;li>单一的工作入口管理可以更好的在统一的时间轴上进行优先级排序管理，并且能够实现所有工作的可视化和排序。&lt;/li>
&lt;li>设置不同的发布节奏，从2周到12周不等，还有特性的按需发布&lt;/li>
&lt;li>根据完成度、业务需求和耦合程度，不同工作任务选取不同的发布节奏&lt;/li>
&lt;li>进行工程上的重构：自动化、架构和运维即服务模式&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-46-45.jpg"
loading="lazy"
alt="2019-03-07_14-46-45"
>&lt;/p>
&lt;p>完全参考和接受了ThoughtWorks技术雷达提出的：应用产品管理的方式到内部平台。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-47-58.jpg"
loading="lazy"
alt="2019-03-07_14-47-58"
>&lt;/p>
&lt;p>运维团队的人也将IT工作转为产品交付的方式，指定专人专家管理内部的平台。安全运维被视为工程和产品问题，通过重构的工程方法优化平台。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-53-24.jpg"
loading="lazy"
alt="2019-03-07_14-53-24"
>&lt;/p>
&lt;p>基于产品/服务价值流交付的管理方式是多个迭代，往复循环的迭代，而不会是简单的停止于测试完毕的验收发布。&lt;/p>
&lt;p>配置管理、服务请求变更管理、遥测、监控管理、安全、事件问题管理和相应都是产品管理的一部分，这些运行态的工作是产品生命周期中不可或缺的。也不应该被其它孤立的外部团操作。&lt;/p>
&lt;p>因此服务持续性管理也变成为一种内置的持续的动作，而不是这个流程之外的独立事件。&lt;/p>
&lt;p>CSG提倡：运维是工程和产品的问题，在本图中也得到体现，运维工作是产品的运行时管理工作，也是包括在持续的产品开发迭代中，最好有一个统一的持久的团队负责。&lt;/p>
&lt;p>CSG举例说明了”运维是工程和产品的问题“；CSG的业务系统需要处理信用卡信息，因此需要满足PCI的合规需求。在这个业务需求的驱动下，运维团队花费了无数的安全审计时间（20000+小时）去满足合规的标准。在产品驱动的思维下，运维团队和安全专家合作开发了，实现PCI合规的配置管理工具。这些安全管理工具是基于Chef开发的，也在Chef的开发者大会上分享过，而且现在是一个开源的产品，任何人都可以下载使用。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_15-06-49.jpg"
loading="lazy"
alt="2019-03-07_15-06-49"
>&lt;/p>
&lt;p>通过以下的对比发现CSG在这个思维转型了以后所得到的收益。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_15-09-19.jpg"
loading="lazy"
alt="2019-03-07_15-09-19"
>&lt;/p>
&lt;p>CSG在跨价值流的工作可视化管理方面也取得了一定的收益。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_15-14-10.jpg"
loading="lazy"
alt="2019-03-07_15-14-10"
>&lt;/p>
&lt;p>以前各种不同工作分类的工作内容，上图每种颜色的方框就是一个分类，每个分类的工作都有各自不同的跟踪管理系统（工单系统）。在这种情况下如果跨价值流分析相关的工作内容，则非常困难，要依赖大量的手工统计和集成工作。统一的工作可视化无法实现。因此CSG使用Jira来统一管理和跟踪以上各种工作，从而得到准确和实时的视图。&lt;/p>
&lt;h2 id="2019年的目标">2019年的目标
&lt;/h2>&lt;p>CSG的2019年DevOps的发展目标和举措也很值得参考。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_15-22-01.jpg"
loading="lazy"
alt="2019-03-07_15-22-01"
>&lt;/p>
&lt;ul>
&lt;li>Impact Minutes 服务受影响的时间 ： 4700分钟，实现年同步增长50%；计划实施系统的强壮性工程，落实人的可恢复性&lt;/li>
&lt;li>Release on Demond 按需发布 ： 希望最终是消除发布这个环节，或者是高于70%的按需发布比例；计划实施的举措是重构架构、自动化、解耦。&lt;/li>
&lt;li>eNPS 员工推荐率 ： 提升这个比例；计划实施的举措有精益领导力组合，链接到每个人，工作生活平衡。&lt;/li>
&lt;/ul></description></item><item><title>成熟度模型已死</title><link>https://martinliu.cn/blog/maturity-is-dead/</link><pubDate>Wed, 27 Jun 2018 21:34:04 +0800</pubDate><guid>https://martinliu.cn/blog/maturity-is-dead/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1549271017/Anubis-Background-Download-Free.jpg" alt="Featured image of post 成熟度模型已死" />&lt;p>上一篇文章重要观点回顾：&lt;/p>
&lt;ul>
&lt;li>应用DevOps的企业不应该使用成熟度模型度量&lt;/li>
&lt;li>应用DevOps的不同企业/部门不会参考某个所谓标准&lt;/li>
&lt;li>应用DevOps的不同企业/部门应该参考5大类24项的能力成长模型，来度量其发展进度，在磨练这些能力的过程中，选择符合自身业务需求的，且优先级别高能力先发展。&lt;/li>
&lt;/ul>
&lt;h2 id="成熟度模型已死">成熟度模型已死
&lt;/h2>&lt;p>这个模型在各行各业都可能存在，而且可能是最容易被人接受的模型之一。对于很多新生的领域，如法炮制的套用这个模型合适么？无论合适与否，它还是会出现在DevOps的领域中。为了避免实践者试错，我们不得来分析一下这种模型的特点。&lt;/p>
&lt;h3 id="特征1">特征1
&lt;/h3>&lt;p>它总是阶梯式的，而且从来都是5个等级，人们经常戏称为Golden 5。常见的5级成熟度模型有下列几种。&lt;/p>
&lt;p>&lt;em>CMMI 能力成熟度模型集成&lt;/em>&lt;/p>
&lt;p>&lt;img src="https://pic.baike.soso.com/p/20131203/20131203141932-427475281.jpg"
loading="lazy"
alt="CMMI"
>&lt;/p>
&lt;p>&lt;em>ITIL/ITSM的成熟度模型&lt;/em>&lt;/p>
&lt;p>&lt;img src="http://www.jp1.cn/image/h1/2_200644102151993.jpg"
loading="lazy"
alt="ITIL"
>&lt;/p>
&lt;p>&lt;em>IT与业务融合的成熟度&lt;/em> &lt;a class="link" href="http://www.cio.com.cn/eyan/1431.html" target="_blank" rel="noopener"
>http://www.cio.com.cn/eyan/1431.html&lt;/a>&lt;/p>
&lt;p>&lt;img src="http://www.cio.com.cn/source/attachments/image/20120417/20120417164221_20236.jpg"
loading="lazy"
alt="ITIL"
>&lt;/p>
&lt;p>&lt;em>德勤网络安全合规成熟度示意图&lt;/em>&lt;/p>
&lt;p>&lt;img src="https://www2.deloitte.com/content/dam/Deloitte/cn/Images/inline_images/serv-risk/cn-ra-cyberrisk-compliance-model-3.jpg/_jcr_content/renditions/cq5dam.web.700.350.desktop.jpeg"
loading="lazy"
alt="网络安全合规"
>&lt;/p>
&lt;p>&lt;em>持续交付流程成熟度&lt;/em>&lt;/p>
&lt;p>&lt;img src="http://www.ibm.com/developerworks/cn/rational/1402_zhaojing_urbancode1/image011.jpg"
loading="lazy"
alt="CD"
>&lt;/p>
&lt;p>如果你百度“成熟度模型”，还可以轻易地找到很多类似模型。客观的讲，这个模型是被广泛应用的神五级。&lt;/p>
&lt;p>这个模型对于任何使用的组织来说都是统一的，不会说对于有些企业是8级的，对于另外一些企业是10级的。&lt;/p>
&lt;p>这种模型的另外一个代名词是“XXX标准”，或者“XX行业标准”。&lt;/p>
&lt;h3 id="特征2">特征2
&lt;/h3>&lt;p>通常对于每个等级上还可以定义出3到7个不同的维度。维度的数量少则3个级别，多字7到10个维度；可以要在每一个级别的不同维度上进行评价。这些维度一旦确定下来，也通常是十年如一日的静止不变。&lt;/p>
&lt;p>只是一种纵横交叉的矩阵的模式，如以上的持续交付流程成熟度、德勤网络安全合规成熟度示意图和IT与业务融合的成熟度都是这样。&lt;/p>
&lt;p>维度和等级往往都是静态的，通常模型发布之后，在很长一段时间里，不会发生改变。&lt;/p>
&lt;h3 id="特征3">特征3
&lt;/h3>&lt;p>这些模型对于不同的组织而言，组织的目标都是一致而单纯的，即“通过/到达”某个级别。请你回忆一下以前的经历。一个软件开发组织经过一年的奋斗，他们通过了CMMI3级认证；第二年的时候，项目组一狠心，一跺脚一次性通过了5级认证。请问他们为什么一定要在第二年通过5级？在第三年里，相比以前，软件开发的质量提高了么？在第四年，有没有可能出现倒退的现象？如果你回答不了这些问题的话，可以尝试请教一个更资深一些的，工作10年以上的朋友或者同事。&lt;/p>
&lt;h2 id="成熟度模型的局限性">成熟度模型的局限性
&lt;/h2>&lt;p>根据以上的三个主要特征，这种模型的局限性大概有以下几个方面：&lt;/p>
&lt;p>每一个企业的自身条件、业务环境、资源约束都是不同的。让他们都对标一个统一的静态成熟度模型是不合适的。这就像是目前某些国家的教育体制一样。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload//3-levels.jpeg"
loading="lazy"
alt="3levels"
>&lt;/p>
&lt;p>IT行业每天都在发生着巨大的变化，这就是我么经常提到的乌卡时代，今年流行的技术，很快就会过时，明年也将出现新的、未知的技术领域。很多行业的特点就是，在不断反复的被颠覆。而这些成熟度模型通常是永恒不变的。&lt;/p>
&lt;p>成熟度模型通常是在微观上进行考察，对很多考察点做孤立的分析和评测。这样做只能度量到技术、工具或者流程本身的一些方面。而忽视了组织通过它们所获得的总体成果产出。举个例子一个企业在通过了CMMI5级之后，发现收入/利润比以前还下降了；解释CMMI到达顶级的企业，业务收入还退步了，这本来就是一件比较尴尬的事情。&lt;/p>
&lt;p>如果一个集团企业，在所有IT组织/部门中强推某种成熟度模型的话，还有可能出现停滞不前的博弈现象。某些组织可能会宁愿待在中间的某个不成熟等级，并不愿意快速的提升到最高等级。那样的话，他们将失去每年一定数量的，用于提高成熟度等级的资源和预算。从最大化局部利益的角度考虑，最高级的成熟度可能等于最低级的资源支持。&lt;/p>
&lt;p>最后，无论到达了那个等级的成熟度，这种明确而清晰的满足感，滋生出了锚定效应。这其实阻碍了组织持续的探索和尝试未知领域，组织因此学习的知识就会越来越少。甚至于出现能力的下滑和倒退。&lt;/p>
&lt;p>综上所述，在DevOps的领域里，成熟度模型和统一标准已经过时了，它不适合用于DevOps的度量；而且，纵观整个行业，国际上目前还没有那一个适用的DevOps成熟度模型被应用于任何组织。那么还有什么其他DevOps适用的模型？&lt;/p>
&lt;h2 id="devops能力成长模型">DevOps能力成长模型
&lt;/h2>&lt;p>这个模型是在《Accelerate-加速器》这本书里被提出的。相信大家对Nicole博士联合Puppet Lab发起的DevOps状态调查和年度报告并不陌生。这本书分析了DevOps状态报告四年的历史数据，书里所展示的内容，其实也正好是作者Nicole Forsgren博士对DevOps现状调研的第一个迭代的阶段性成果。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Accelerate.jpg"
loading="lazy"
alt="模型"
>&lt;/p>
&lt;p>这本书的目标是解密高效能组织的高明之处，以及背后的原因。从探寻影响组织绩效的因素为起点，经过了四年的不断调研，Nicole博士向我们展示了一个相对比较完整的，各种影响因素的关系网。特别说明的是：下图来自于《加速器》这本书，这个形态是经过4年演进出来的，我们无法猜测2018年Nicole博士究竟怎样地拓展了调研的范围；更无法猜测的是：在2018年的状态报告结果中，这幅图会变成什么样子？&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/devops-cap-mod.jpg"
loading="lazy"
alt="开始"
>&lt;/p>
&lt;p>Nicole博士总结出了DevOps能力的5大分类，包含的能力点有24项。&lt;/p>
&lt;h3 id="第一类持续交付">第一类：持续交付
&lt;/h3>&lt;ol>
&lt;li>对生产环境的所有工件进行版本控制&lt;/li>
&lt;li>运用自动化部署流程&lt;/li>
&lt;li>实施持续集成&lt;/li>
&lt;li>运用基于主干的开发方法&lt;/li>
&lt;li>实施测试自动化&lt;/li>
&lt;li>进行测试数据管理&lt;/li>
&lt;li>前置信息安全管理&lt;/li>
&lt;li>实施持续交付&lt;/li>
&lt;/ol>
&lt;h3 id="第二类系统架构">第二类：系统架构
&lt;/h3>&lt;ol>
&lt;li>应用松耦合的架构设计&lt;/li>
&lt;li>授权团队进行架构重构的决策&lt;/li>
&lt;/ol>
&lt;h3 id="第三类产品和流程">第三类：产品和流程
&lt;/h3>&lt;ol>
&lt;li>收集和实施客户反馈&lt;/li>
&lt;li>运用价值流模式可视化工作流&lt;/li>
&lt;li>运用小批量的工作模式&lt;/li>
&lt;li>培养和赋能团队进行试验&lt;/li>
&lt;/ol>
&lt;h3 id="第四类精益管理和监控">第四类：精益管理和监控
&lt;/h3>&lt;ol>
&lt;li>应用轻量变更审批流程&lt;/li>
&lt;li>业务决策得到从应用到基础架构的全堆栈支持&lt;/li>
&lt;li>前瞻性地监控系统的状况&lt;/li>
&lt;li>应用WIP来进行价值流的工作管理&lt;/li>
&lt;li>通过可视化来监控团队工作质量和进行沟通&lt;/li>
&lt;/ol>
&lt;h3 id="第五类企业文化">第五类：企业文化
&lt;/h3>&lt;ol>
&lt;li>发展并支持生机型企业文化&lt;/li>
&lt;li>鼓励和支持学习&lt;/li>
&lt;li>支持和辅助团队间的协作&lt;/li>
&lt;li>提供工作所需要的资源和工具&lt;/li>
&lt;li>支持和落实领导力转型&lt;/li>
&lt;/ol>
&lt;h2 id="devops能力成长模型的特点">DevOps能力成长模型的特点
&lt;/h2>&lt;p>首先，这个模型是基于4年以上的、科学的调查分析而来的。Nicole博士和全球最顶尖的DevOps公司，以及各种业内大咖，历经了多年的协作。其次，此模型是演变出来的，而且一定会持续更新。最后，分析一下这个模型的特点。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/devops-cap-mod1.jpg"
loading="lazy"
alt="模型"
>&lt;/p>
&lt;ul>
&lt;li>它目标是适用于能力和起点本来就参差不齐的不同的组织/团队。&lt;/li>
&lt;li>它适用于每个团队在能力上优劣各不相同的情况。而且每个团队的业务使命和向下文也不相同。&lt;/li>
&lt;li>它使每个团队聚焦在各自不同的能力点上，发展和解决各不相同的约束点/弱点。&lt;/li>
&lt;li>以上能力模型来上游调查数据就是一个行业基线（基线也在不断变化中），不同的团队参考每一项能力的行业基线定义各自的下一步的发展目标。&lt;/li>
&lt;/ul>
&lt;h2 id="建议的度量套路">建议的度量套路
&lt;/h2>&lt;p>可以将DevOps能力成长模型作为企业应用DevOps的一个有效的度量工具。通过持续的度量，现状分析和改进，让DevOps的优化全局价值产出的特性加速企业客户价值的增长。这里简单描述一下建议的套路&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/outcome1.jpg"
loading="lazy"
alt="模型"
>&lt;/p>
&lt;ul>
&lt;li>度量关键产出：这些指标是衡量你的团队软件交付的好坏与否的一个高阶的度量。相关指标有：IT效能、前置时间、部署频率、MTTR、变更失败率、加班程度和部署痛点。&lt;/li>
&lt;li>能力驱动的改进：这些能力是你提升关键产出的抓手。由于你提高了一些能力，你在这些能力得到提升的同时，还能更快且可靠的交付软件。&lt;/li>
&lt;li>按优先级改进：通过能力模型的评估，你识别出了那些能力约束点/瓶颈，是它们在阻止你达到更高的技术阶段，然后确定那些能力需要先优先发展。&lt;/li>
&lt;/ul></description></item><item><title>参与2018年DevOps状态调查报告</title><link>https://martinliu.cn/blog/2018-devops-survey/</link><pubDate>Wed, 27 Jun 2018 00:09:21 +0800</pubDate><guid>https://martinliu.cn/blog/2018-devops-survey/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/abstract-6.jpg" alt="Featured image of post 参与2018年DevOps状态调查报告" />&lt;p>听说这里有一个15分钟就能完成的DevOps调查问卷，有25位参与者或将得到总值为3200美元的亚马逊购物券。一年也就是这一次机会。问卷调查将在10天后就关闭。&lt;/p>
&lt;p>这是DevOps状态报告调查问卷的第七年。在过去的6年里，已经有两万七千多人参与了这项调查。这项调查已经获得了丰硕的成果，主要是帮助你了解在DevOps之旅上当前的进展。今年又扩展了调查的范围，再度加深了对DevOps之旅的调研。&lt;/p>
&lt;p>我已经帮你把问题的套路摸清楚了，其实问题都很清晰直白，很容易和你所在企业的DevOps状态做匹配。填写问卷调查也是一个学习的过程，可以用开放的心态去了解一下，调查报告对DevOps的观察角度都有哪些？&lt;/p>
&lt;p>对其中的部分问题做出了简要的说明，预祝你在参加这项全球性著名调查的过程中，有一个愉快的体验。&lt;/p>
&lt;h2 id="今年的看点">今年的看点
&lt;/h2>&lt;p>据说DevOps状态调查报告的一个最大的价值就是：在你的组织中，你可以用这些数据展示出DevOps的价值，从而取得管理层的支持，并启动DevOps项目。&lt;/p>
&lt;p>在今年的调查研究工作中，新加入的，对在企业中应用和推广DevOps有深度洞察的专家包括：&lt;/p>
&lt;ul>
&lt;li>Andi Mann, the chief technology advocate at Splunk and co-author of Visible Ops – Private Cloud and and The Innovative CIO.&lt;/li>
&lt;li>Michael Stahnke, a director of engineering at Puppet and the author of Pro OpenSSH.&lt;/li>
&lt;li>Alanna Brown, the director of product marketing at Puppet and creator of the first State of DevOps Report in 2013.&lt;/li>
&lt;/ul>
&lt;p>参加这项问卷调查将有25人会得到亚马逊购物券，价值 $100, $200 或 $500 ； 抽奖说明：&lt;/p>
&lt;ol>
&lt;li>$500 2 人&lt;/li>
&lt;li>$200 8 人&lt;/li>
&lt;li>$100 15 人&lt;/li>
&lt;/ol>
&lt;p>注：规则完整版 &lt;a class="link" href="https://puppet.com/2018-devops-survey-contest-rules" target="_blank" rel="noopener"
>https://puppet.com/2018-devops-survey-contest-rules&lt;/a>&lt;/p>
&lt;h2 id="参与此项调研报告">参与此项调研报告
&lt;/h2>&lt;p>每道问题选择了答案之后，会影响到后续所出现的问题，我选择了金融（含保险）行业的DevOps软件工程师的路径。&lt;/p>
&lt;p>这个调查的问题库非常强大，每一个问题的回答都在影响下一个问题的范围。有些问题是情景设定和分析题，会预设一个阶段（有可能是你还未达到的），在这种情况里作出你的判断和选择。&lt;/p>
&lt;p>翻墙之后网页刷新速度会更快一些。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/survery.jpg"
loading="lazy"
alt="开始"
>&lt;/p>
&lt;h3 id="第一部分">第一部分
&lt;/h3>&lt;ol>
&lt;li>Where do you work? / 你在那个大洲工作？&lt;/li>
&lt;li>In which country do you work? / 在那个国家工作？&lt;/li>
&lt;li>What is the principal industry of your organization? / 你的组织是什么行业的？&lt;/li>
&lt;li>Which of the following best describes your title or role in your company? / 下面的各种头衔/角色那个和你最匹配？&lt;/li>
&lt;li>What department do you work in? / 你什么部门工作？&lt;/li>
&lt;li>And what team do you work on? / 你在什么团队工作？&lt;/li>
&lt;li>Which of the following describes your level of knowledge regarding your organization’s IT operations and software delivery? / 下面那一项最准确地描述了你的组织在IT运维和软件交付方面的知识程度？&lt;/li>
&lt;/ol>
&lt;h3 id="第二部分">第二部分
&lt;/h3>&lt;p>Many people say that there are four elements of DevOps that work together as enterprises evolve. They are:&lt;/p>
&lt;ul>
&lt;li>Culture 文化&lt;/li>
&lt;li>Automation 自动化&lt;/li>
&lt;li>Measurement 度量&lt;/li>
&lt;li>Sharing 分享&lt;/li>
&lt;/ul>
&lt;p>The next few questions will ask about each of these elements.&lt;/p>
&lt;p>这部分是对企业的CAMS调查的。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Where would you say you are at culture-wise, on your DevOps journey so far? / 在你目前的DevOps旅程中，DevOps文化存在于怎样的范围里？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Where would you say you are at automation-wise, on your DevOps journey so far? / 在你目前的DevOps旅程中，自动化的程度是怎样的？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Where would you say you are at measurement-wise, on your DevOps journey so far? Please select all that apply. / 在你目前的DevOps旅程中，在那些方面实施了度量？- 多选&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Where would you say you are at sharing-wise, on your DevOps journey so far? / 在你目前的DevOps旅程中，在分享方面是怎么做的？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>How frequently do each of these practices occur in your organization? / 下列实践在你的组织中发生的频率？从来没用过 ~ 总是在用 5级&lt;/p>
&lt;ul>
&lt;li>We balance lowering technical debt, with new feature work&lt;/li>
&lt;li>Configurations are managed by a configuration management tool&lt;/li>
&lt;li>A cross-functional review is done before implementation of a project&lt;/li>
&lt;li>Teams use continuous delivery&lt;/li>
&lt;li>Before starting a project, we establish concrete success criteria&lt;/li>
&lt;li>We create learning opportunities across teams (e.g., training, internal DevOps workshops, etc.)&lt;/li>
&lt;li>We expose data and services via APIs&lt;/li>
&lt;li>Success metrics for projects are visible&lt;/li>
&lt;li>DevOps initiatives are supported by senior leadership&lt;/li>
&lt;li>Teams use agile approaches across development and operations&lt;/li>
&lt;li>Developers are on-call for production issues&lt;/li>
&lt;li>Teams use continuous integration&lt;/li>
&lt;li>Source code is made available to other teams&lt;/li>
&lt;li>Experiences and lessons are shared externally (e.g., meetups / conferences, blog posts, etc.)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>How frequently were each of these practices used when you were first starting out with DevOps? / 在你的DevOps刚刚起步的阶段，下列实践的使用频率是怎样的？从来没用过 ~ 总是在用 5级&lt;/p>
&lt;ul>
&lt;li>Application configurations are in version control&lt;/li>
&lt;li>Infrastructure teams use version control&lt;/li>
&lt;li>Automate system configurations (e.g. operating system baselines)&lt;/li>
&lt;li>System configurations are in version control&lt;/li>
&lt;li>Automate provisioning (e.g. server, VM, cloud instances, etc.)&lt;/li>
&lt;li>Application development teams use version control&lt;/li>
&lt;li>Automate security policy configurations&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>How frequently were these practices used after you started to see some traction with DevOps? / 在你开始感受到DevOps的优势以后，下列实践的使用频率是怎样的？从来没用过 ~ 总是在用&lt;/p>
&lt;ul>
&lt;li>We reuse deployment patterns for building applications or services&lt;/li>
&lt;li>Monitoring and alerting are configurable by the team operating the service&lt;/li>
&lt;li>We deploy on a single standardized operating system&lt;/li>
&lt;li>We deploy on a set of standardized operating systems&lt;/li>
&lt;li>We build on a standardized set of technologies&lt;/li>
&lt;li>Configurations are managed by a configuration management tool&lt;/li>
&lt;li>We reuse testing patterns for building applications or services&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>How frequently were the following used while you were expanding DevOps practices? / 在你推广DevOps实践的过程中，下列实践的使用频率是怎样的？从来没用过 ~ 总是在用 5级&lt;/p>
&lt;ul>
&lt;li>We have post-incident reviews and share results&lt;/li>
&lt;li>Security teams are involved in technology design and deployment&lt;/li>
&lt;li>Teams contribute improvements to tooling provided by other teams&lt;/li>
&lt;li>We reuse testing patterns for building applications or services&lt;/li>
&lt;li>Individuals can do their work without manual approval from outside of their team&lt;/li>
&lt;li>We reuse deployment patterns for building applications or services&lt;/li>
&lt;li>Monitoring and alerting are configurable by team operating service&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>How frequently were these practices used while you were optimizing your DevOps practices? / 当你在优化DevOps实践的过程中，下列实践的使用频率是怎样的？从来没用过 ~ 总是在用 5级&lt;/p>
&lt;ul>
&lt;li>Infrastructure changes are tested before deploying to production&lt;/li>
&lt;li>Rearchitect applications based on business needs (e.g., reducing operational costs, ease of deployment, etc.)&lt;/li>
&lt;li>Individuals accomplish changes without significant wait times&lt;/li>
&lt;li>Monitoring and alerting are configurable by team operating service&lt;/li>
&lt;li>Teams contribute improvements to tooling provided by other teams&lt;/li>
&lt;li>Service changes can be made during business hours&lt;/li>
&lt;li>Incident responses are automated&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>How frequently were these practices used while you were enabling self-service? / 在你管理自助服务的情况下，下列实践的使用频率是怎样的？从来没用过 ~ 总是在用 5级&lt;/p>
&lt;ul>
&lt;li>Teams contribute improvements to tooling provided by other teams&lt;/li>
&lt;li>Resources (e.g., accounts, infrastructure, etc.) made available via self-service&lt;/li>
&lt;li>Logging configuration is deployed with the application or service&lt;/li>
&lt;li>Monitoring and alerting are configurable by team operating service&lt;/li>
&lt;li>App developers deploy testing environments on their own&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Which, if any, of the following processes or tools are “self-service” in your DevOps approach? Please select all that apply. / 在你的DevOps计划中，下列哪些流程或者工具会做成自助服务？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Which of the following organizational structures have you used in your DevOps journey? / 在你DevOps的旅程中，你曾经用过下列哪些组织结构？&lt;/p>
&lt;ul>
&lt;li>Cross-functional teams that are responsible for specific services or applications&lt;/li>
&lt;li>A centralized IT team and multiple application development teams&lt;/li>
&lt;li>A Site Reliability Engineering (SRE) team&lt;/li>
&lt;li>A service provider that provides DevOps capabilities (e.g. builds test environments, provides monitoring, etc.)&lt;/li>
&lt;li>A dedicated DevOps team&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Please tell us what kind of development your organization does. / 你的组织开发各种类型软件的比例是多少？5个问题填写百分比，凑够100&lt;/p>
&lt;ul>
&lt;li>We do custom development for internal users&lt;/li>
&lt;li>We do custom development for COTS (commercial off-the-shelf software)&lt;/li>
&lt;li>We manage COTS (commercial off-the-shelf software (e.g., upgrades)&lt;/li>
&lt;li>We do in-house development of custom applications for external users&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>If you could move the needle on one metric related to DevOps, what would it be? / 如果让你仅仅选择一个度量DevOps的指标，这个指标是什么？ - 描述题&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Just a few more questions to help us categorize your answers. / 下列问题帮助我们对你的组织进行分类。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>What figure best describes your company’s annual revenue in US$ equivalent? / 你们公司的年营业额是多少美元？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>What is the proportion of genders working on your team? / 你所在的团队男女比例？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Please tell us how you identify. / 请问告诉我们你认为自己是什么性别。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>What is your current annual salary in US dollars? / 你的年薪是多少美元？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Do you consider yourself to be part of a visible or invisible minority where you work? / 你认为自己工作是显耀的还是无足轻重（少数派）的？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Please tell us of what minority(ies) you consider yourself to be a member. Please select all that apply. / 请告诉我们你的这种无足轻重是指哪方面？-多选&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Would you like to receive an email with the report link when it is available? / 你是否希望收到这份报告的下载链接？&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="完毕">完毕
&lt;/h3>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/survy.jpg"
loading="lazy"
alt="开始"
>&lt;/p>
&lt;p>本文来源：&lt;a class="link" href="https://puppet.com/blog/introducing-2018-state-devops-survey-new-research-focus" target="_blank" rel="noopener"
>https://puppet.com/blog/introducing-2018-state-devops-survey-new-research-focus&lt;/a>&lt;/p>
&lt;p>调查问卷网址：&lt;a class="link" href="https://polls.onresearch.net/DevOps/blog" target="_blank" rel="noopener"
>https://polls.onresearch.net/DevOps/blog&lt;/a>&lt;/p>
&lt;h2 id="后记">后记
&lt;/h2>&lt;p>DevOps圈子里的人都知道，这项问卷调查在IT行业里的知名度和权威性。它的目的在于：通过持续的研究DevOps在各个企业中应用的状态特征，定量的收集大量行业基础分析数据，这样所有的企业就有了一个可以参照的基线数据。更重要的是，它还将企业的绩效分成了高中低三个等级；对这些数据，用科学的分析方法，总结出了高绩效企业之所以高明的原因，将这些结论/假设/原因还在逐年推演和求证中。因此它形成了最具说服力的一些列结论。这些结论都展示在了历年来的DevOps状态报告中。&lt;/p>
&lt;p>今年 Nicole Forsgren博士，《Accelerate》一书的主要作者，用此书对多年来的DevOps状态分析做了一个总结。此书一出版就高居亚马逊畅销榜榜首，还被誉为DevOps界的科学。这本书为你展示了历年来的状态分析报告是怎么来的？调查的范围和方向是如何演进的？为什么会得出这样的分析结果？&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Accelerate.jpg"
loading="lazy"
alt="开始"
>&lt;/p>
&lt;p>调查报告的分析结果是客观而科学的。而这本书向你展示了这些报告数据背后的How和Why。它提出了一个全新的主题“DevOps能力发展模型”；该书的一些结论也是非常具有颠覆性：&lt;/p>
&lt;ul>
&lt;li>应用DevOps的企业不应该使用成熟度模型度量&lt;/li>
&lt;li>应用DevOps的不同企业/部门不会参考某个共同标准&lt;/li>
&lt;li>应用DevOps的不同企业/部门应该参考5大类24项的能力成长模型，来度量其发展进度，在磨练这些能力的过程中，选择符合自身业务需求的，且优先级别高能力先发展。&lt;/li>
&lt;/ul>
&lt;p>下图是24项能力的分解表：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/nengli.jpg"
loading="lazy"
alt="开始"
>&lt;/p>
&lt;p>我在这本刚发布的时候购买了电子版。在参加5月份的DevOpsDays大会北京站的深度培训“持续交付”课上，遇到了这个培训老师的Jez Humble先生，他也是本书的合著者之一。意外地获赠了一本他的签名实体书。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/my-acceleate.jpg"
loading="lazy"
alt="开始"
>&lt;/p>
&lt;p>在学习了一段时间以后，我总结和归纳了一些内容：关于对DevOps能力发展模型的详细剖析，对24项DevOps主要发展能力之间的关联关系的解读；这些内容将会在8月份上海的DevOpsDays大会上呈现。&lt;/p></description></item><item><title>从完美风暴说开去，直到DevOpsDays社区</title><link>https://martinliu.cn/blog/perfect-storm-devops-days/</link><pubDate>Sun, 20 May 2018 10:54:51 +0800</pubDate><guid>https://martinliu.cn/blog/perfect-storm-devops-days/</guid><description>&lt;img src="http://res.cloudinary.com/martinliu/image/upload/v1526781579/Eye_Of_The_Storm_Hurricane_From_Space_freecomputerdesktopwallpaper_1600x900.jpg" alt="Featured image of post 从完美风暴说开去，直到DevOpsDays社区" />&lt;p>各种大会、各种喧嚣，你都看够了么？免费的，收费的，都与你有何相干？哪里是你自己的社区，哪里可以找到同类和导师？本文是我对社区的一点个人的思考，感兴趣的读一下。&lt;/p>
&lt;p>本文的标题图片是中国DevOpsDays社区志愿者招募的标题图片，这是NASA的一张完美风暴的航拍图片，暂时不欣赏这幅图的完美之处。让我来先讲讲它的出处，这幅图来自于樊登读书会App，源于他最近读到的一本书《谢谢你迟到》。&lt;/p>
&lt;p>我觉得书名和DevOps有些相关性，DevOps在IT行业中的兴起是最近9年的事，说来这是一段不长不短的时间。纵观最近几年的IT行业，这是一个从业人员的幸福感和优越感急剧下降的过程，是敏捷、精益、CMM和ITSM等管理等套路，在逐渐被人质疑的过程，是IT行业内的大厂纷纷走向没落的9年。DevOps并不是从无到有蹦出来的，它的姗姗来迟也并不具有任何的偶然性，相反它是各种管理实践分久必合的必然结果，它是一个各种最佳实践的聚合体，它是从敏捷社区发源，然后逐步融入了各种必要的元素，而且各种元素之间产生了化学反应后的化合物。&lt;/p>
&lt;p>我对社区的认识源于很久以前在大学中对Linux的喜爱，从哪里听说了开源社区这种事物。对开源软件社区的深刻理解是在加入Red Hat公司期间形成的。Red Hat公司创造了一种神奇的开放文化（见CEO Jim出版的Open Orgnazation一书），让曾经在哪里工作过的员工可以将自己的职业生涯清晰的化为：Red Hat阶段和非Red Hat两个阶段（所有其它公司都是和Red Hat迥异的，都是雷同的）。这不是我自己总结的，是今天早晨和一个公司同事聊出来的，我们都曾经在Red Hat工作过，不过在那段时间里我们并不认识。&lt;/p>
&lt;p>在Red Hat的时候，当你加入到某个开源项目的邮件讨论组的时候，你会很自豪的有一等公民的感觉。由于你发现你的同事在各种项目的讨论中频繁出现，他们的日常工作就是在开源社区中修复bug，提交feature。虽然我并不贡献代码，不过还是觉得占了“Red Hat是个活雷锋”的形象的光。Red Hat公司的工程师在开源社区中的贡献，是这种项目的助推剂和催化剂。&lt;/p>
&lt;p>当然也有人觉得Red Hat是商业开源而已，少了早年开源社区的那种乌托邦式的纯粹感，并不是一种无欲无求的奉献。但是时代还是要继续，而且是不断的变迁的。开源软件社区就是这样轻易的颠覆了软件世界的格局，纷纷倒闭和没落的昔日贵族们，他们不都是巨无霸级别的闭源殿堂么？&lt;/p>
&lt;p>开源软件的开放性和分享精神给了我非常大的影响，这加深了我对社区的认识。DevOpsDays社区是不同于开源软件社区的，我对他的感受和理解基于软件开源社区，但隐约感觉到它们是两种社区，应该是不同的类型，但是目前还说不清楚。&lt;/p>
&lt;p>用台风眼作为DevOpsDays社区的比喻是在我听樊登讲《谢谢你迟到》时想到的。听完之后，看了一下App里的此书的图文描述，发现这的确是我所需要的寓意，下面直接转述，不做解释。&lt;/p>
&lt;hr>
&lt;p>2.台风眼&lt;/p>
&lt;p>在台风来袭时，位于台风中心的台风眼反而是最安全、最风平浪静的。回到社区，找到自己熟悉的中心，就像是台风中的“台风眼”。&lt;/p>
&lt;p>台风眼也不是固定不动的，它能保持安稳的一大原因就是，它会应时而动。台风持续不断地移动，就像这个时代的脉搏，台风眼也随着它移动，保持自己始终处在有利的位置。&lt;/p>
&lt;p>台风眼就是我们每个人最好的老师。&lt;/p>
&lt;hr>
&lt;p>我现在所深度参与的是“DevOpsDays社区”，它的历史可以追溯到 #DevOps 这个词的诞生，它的全球广泛程度可以参考官网 &lt;a class="link" href="https://DevOpsDays.org" target="_blank" rel="noopener"
>https://DevOpsDays.org&lt;/a> ； 这也是我喜爱这个社区的两个原因。&lt;/p>
&lt;p>另外，我觉得DevOps本身对这个时代应该是很有价值的；此时此刻的深夜，我扫了一眼微信朋友圈，还是能看到“深夜、聚众、上线加夜班的团队”在上演着这不断重复的人间悲喜剧，看到他们相互的点赞、加油和鼓励；可是从DevOps的观点出发，我们其实可以冒出这样一句话：“其实还有一条更好的路”。&lt;/p>
&lt;p>虽然，有时候你觉得DevOps无处不在；但是，我个人深刻的意识到，其实IT行业中还有巨大数量的人，他们并不知道DevOps的存在。还有大量的人，个人掌握了DevOps的知识和实践，但是还是无法影响和改变周遭的人。还有大量的团队在迷迷糊糊地实施着DevOps。更有大量的公司在观望着DevOps。&lt;/p>
&lt;p>很显然，DevOps的推广和传播还是不够的，这是我觉得各种DevOps社区都应该意识到的一个事实。我们都有责任传播正确的理念和信息，切勿蹭着这个热点，而有不负责的传播着错误和误导的信息。所有博主、微信号和公司都应该自省。纷繁复杂的DevOps实践之间本来就已经存在着千丝万缕的联系，而它们的落地无不挑战和考验着所有的DevOps实践者们；只有在各自公司的业务场景里，运用科学系统的思维方式，经历相当长一段时间的实验阶段，才可能感知和捕捉到DevOps的好处和优势。在这个过程中，和同行的实践者坐而论道或将是一种很好的学习和提升的方式。而这也是DevOpsDays社区期望能为实践者们提供的。为此DevOpsDays社区需要做如下的工作，才能提供出以上的学习环境：&lt;/p>
&lt;ul>
&lt;li>线上线下的分享会&lt;/li>
&lt;li>线下的城市聚会&lt;/li>
&lt;li>举办区域的大会&lt;/li>
&lt;/ul>
&lt;p>这些活动的发生时需要一定数量的人力、物力和财力。如果我们想在国内覆盖更大数量的群体，必然需要更多数量的志愿者。如果没有坚实的志愿者群体，没有志愿者群体的奉献，任何社区可能都是难于发展和存在的。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>本文其实是写给我自己的和整个国内DevOps社区的，仅仅是简单地回顾了一下我个人的社区经历而已。不是想引导任何人来加入我们所发起的这个志愿者群体的。原因很简单：不到24小时，我们收到了近百人的报名申请。这让我们核心组织者措手不及。之前是发愁没有志愿者分担我们的劳动，而现在发愁的是如何与已经报名的人联系起来，我个人也没有管理如此数量志愿者群体的经验。最后希望我们可以快速的度过这个幸福难题；使志愿者们可以自组织地运作起来，让DevOpsDays社区为这个行业传播价值，让它在人和人之间创建有意义的链接。&lt;/p>
&lt;p>参与中国DevOpsDays社区的三种姿势：&lt;/p>
&lt;ul>
&lt;li>关注，从中学习所需要的知识；就这样静静的看着挺好。&lt;/li>
&lt;li>加入，分担一些志愿者工作，结交新朋友。&lt;/li>
&lt;li>分享，为这个社区注入新鲜的知识和经验，社区需要更多这样的人，需要有更多的人可以成长为分享者，分享也是一种更高阶的学习。&lt;/li>
&lt;/ul>
&lt;p>中国DevOpsDays社区的官网是： &lt;a class="link" href="http://ChinaDevOpsDays.org" target="_blank" rel="noopener"
>http://ChinaDevOpsDays.org&lt;/a>&lt;/p>
&lt;p>.&lt;/p></description></item><item><title>7种DevOps工程师必备技能</title><link>https://martinliu.cn/blog/7-skills-devops-engineer/</link><pubDate>Sat, 24 Mar 2018 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/7-skills-devops-engineer/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Nyala_ZH-CN13349334824_1920x1080.jpg" alt="Featured image of post 7种DevOps工程师必备技能" />&lt;p>使用DevOps的目的是改变和改善开发与IT运营之间的关系，倡导两个部门之间更好的沟通与协作。虽然这看起来有些简单，然后，DevOps工程师还需要做更多的工作，才能成功部署代码，并将Dev和Ops两个部分成功地绑定在一起。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15218598197884.jpg"
loading="lazy"
alt="7种DevOps工程师必备技能"
>&lt;/p>
&lt;p>从应付DevOps压力的角度出发，DevOps工程师除了需要日常技能的基础，每个工程师都必须具备多种技能。DevOps工程师除了要对脚本和编码有着强烈的热情之外，还必须具有开放的思想和协作精神，才能成功地执行该过程。&lt;/p>
&lt;p>“DevOps教练”参考一些文献，已经为你设计了一个清单，列出了下面的7种必备技能，公司的DevOps工程师的招聘需求里，应该明确提出下列所有品质。&lt;/p>
&lt;h2 id="1-灵活性">1. 灵活性
&lt;/h2>&lt;p>编码是一个持续的过程，不断变化，总是需要更新。要成为一个成功而有效的DevOps工程师，理想的候选人必须有能力不断地开发新的系统，并将其集成到主干代码中。DevOps工程师必须具有灵活的工作技能并适应不断变化的代码。&lt;/p>
&lt;p>无论是集成、测试、发布还是部署，工程师都必须能够轻松地从一个软件构建领域迁移到另一个领域。例如，持续集成需要具备快速有效地管理变更的技术技能，并且能够在团队中协作，以保证每个人都朝着共同的目标努力。&lt;/p>
&lt;h2 id="2-安全技能">2. 安全技能
&lt;/h2>&lt;p>与许多其他所熟练的领域一样，安全始终是最重要的，尤其是在编码方面。黑客进入系统的一个简单方法是利用漏洞，破坏现有的系统并获取数据。
&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15218597269514.jpg"
loading="lazy"
alt="7种DevOps工程师必备技能"
>&lt;/p>
&lt;p>DevOps带来了更快的代码开发和部署周期，这意味着漏洞也比以前更容易引入代码。因此，工程师必须具备编写安全代码的技能，以保护应用程序免受不期望的攻击，此外还要确保系统针对常见的网络安全漏洞建立防御机制。&lt;/p>
&lt;p>DevOps工程师在受雇时必须具备安全技能，因为软件从部署一开始就内置了安全性(而不是在以后添加)是至关重要。如果从一开始就没有安全措施，那么黑客就有更多的机会通过网络注入破坏性代码。因此，在招聘下一位DevOps工程师时，确保安全性是技能列表中最重要的一项。&lt;/p>
&lt;h2 id="3-协作">3. 协作
&lt;/h2>&lt;p>对于一个成功的DevOps工程师来说，不具备八面玲珑的和周围打成一片的能力是不行的——协作实际上是DevOps概念的核心，它将软件开发和软件运维结合在一起。DevOps工程师必须具备团队合作的能力，在DevOps流程中协作提供了更多的跨职能的联动。&lt;/p>
&lt;h2 id="4-脚本编写技巧">4. 脚本编写技巧
&lt;/h2>&lt;p>尽管这一点听起来很显然，但任何开发人员都必须具备编写代码的高超技能。无论是JavaScript、Python、Perl还是Ruby，一个成功的开发工程师都必须能够编写代码。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15218597150085.jpg"
loading="lazy"
alt="7种DevOps工程师必备技能"
>&lt;/p>
&lt;p>从编写手动代码到替换手动操作流程(如分配IP地址或DNS代码)，必须团队里必须具有能够编写这些代码的人员，这是完美的候选人应该能够做到的。&lt;/p>
&lt;h2 id="5-决策">5. 决策
&lt;/h2>&lt;p>一个优柔寡断的候选人不是你想要的业务开发工程师。一个成功DevOps工程师候选人将有能力自信而迅速地作出决定，即使是在繁忙的环境工作。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15218598592359.jpg"
loading="lazy"
alt="7种DevOps工程师必备技能"
>&lt;/p>
&lt;p>代码不断变化的特性使得必须快速决定如何修复代码中任何不连贯的元素。果断性必须是雇用DevOps工程师时要考虑的一个因素，因为快速决策允许工程师保持快速开发和部署新编码更改的能力。&lt;/p>
&lt;h2 id="6-基础架构知识">6. 基础架构知识
&lt;/h2>&lt;p>脚本编写只是开发人员应具备的关键技能之一，仅次于云和基础架构的经验。工程师应该对基于数据中心和云基础架构的各种组件的工作方式有一定了解。这包括软件如何联网、并运行在虚拟网络上等要素。&lt;/p>
&lt;p>如果没有理解基础架构的能力，要成为全栈软件开发工程师可能会有些困难。整合基础架构技能将使有效的DevOps工程师能够使用最佳的平台，有效地设计和部署应用程序。还能提出优化建议。&lt;/p>
&lt;h2 id="7-软技能">7. 软技能
&lt;/h2>&lt;p>如上所述，当一名DevOps工程师不是一个人在工作，所以在这种情况下，任何未来的员工必须具备软技能和技术。在信任的前提下，DevOps文化使所有员工能够与流程进行沟通和理解，在需要的时候作出变化。&lt;/p>
&lt;p>当开发人员有效地相互沟通时，应用程序可以在比某些工作人员不在上下文中的情况里要短得多的时间内交付。以及更快的进入市场，良好的通信将导致更少的错误，从而降低成本并提高代码质量。&lt;/p></description></item><item><title>2018年必须认识到的6个DevOps趋势</title><link>https://martinliu.cn/blog/6-devops-trends-aware/</link><pubDate>Fri, 23 Mar 2018 17:50:25 +0800</pubDate><guid>https://martinliu.cn/blog/6-devops-trends-aware/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Decaying_Startrails_nimiaRM_165652_1080_HD_ZH-CN1933491271.jpg" alt="Featured image of post 2018年必须认识到的6个DevOps趋势" />&lt;p>DevOps已经出现了很长时间，我们中的很多人都认为它只是一个时髦词。现在我们知道这并不是一个神话。DevOps已经成为一个IT主流的焦点，并且在过去的几年里一直在重塑着软件世界。专家表示，DevOps将成为主流，2018年DevOps的人气将达到顶峰。&lt;/p>
&lt;p>下面是术语“DevOps”在Google趋势里的现状，以及对2018年预计增长的假设。
&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15217987958903.png"
loading="lazy"
>&lt;/p>
&lt;p>谈到统计数据，从2015年到2016年，DevOps的应用企业数增加了约8%，预计2018年这一数字将大幅增长，如上所示。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15217988516530.png"
loading="lazy"
>&lt;/p>
&lt;p>你可以阅读&lt;a class="link" href="https://www.rightscale.com/blog/cloud-industry-insights/new-devops-trends-2016-state-cloud-survey" target="_blank" rel="noopener"
>RightScale&lt;/a>的整个报告。甚至&lt;a class="link" href="https://go-forrester.clclp.me/blogs/2018-the-year-of-enterprise-devops" target="_blank" rel="noopener"
>Forrester的报告&lt;/a>也明确提到2018年将是DevOps的一年。&lt;/p>
&lt;p>最近发表的关于DevOps的事实和统计数据的文章得到了DevOps爱好者的热烈响应，它只是表明许多技术布道者者对了解更多DevOps并在他们的组织中实施DevOps很感兴趣。&lt;/p>
&lt;p>今天，我们将看到以下事实将塑造DevOps的未来。&lt;/p>
&lt;h2 id="1-将重心从ci流水线移到devops装配线">1 将重心从CI流水线移到DevOps装配线
&lt;/h2>&lt;p>通过CI流水线可以显示应用程序从源代码管理到生产的完整可视化。你可以在一个统一的视图上看到一切。它不仅仅只关于CI，它更多是作为CD (连续交付)的基础；组织正在投入时间和精力来进一步了解自动化其完整的软件开发流程。2018年，第一大DevOps转变将是从单纯的CI流水线转变为&lt;a class="link" href="http://blog.shippable.com/the-difference-between-ci-pipelines-and-devops-assembly-lines-0" target="_blank" rel="noopener"
>DevOps的装配线&lt;/a>链接是Shippable关于装配线的描述。&lt;/p>
&lt;h2 id="2-自动化将成为主要关注点">2 自动化将成为主要关注点
&lt;/h2>&lt;p>在DevOps中，我们经常谈论自动化。如果可能，对服务器的零接触自动化将是未来的趋势。这并不意味着你必须自动化一切，但如果你必须这样做，那么你应该能够做到。了解DevOps循环的6个C，并确保在这些阶段之间应用自动化是关键，这将是2018年的主要目标。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15217988430927.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="3-测试人员需要学会编写代码">3 测试人员需要学会编写代码
&lt;/h2>&lt;p>在DevOps中，需要测试人员知道如何编写自动化脚本来测试各种情况。如果您是一名测试人员，如果在是否学习编码的问题上进退两难，那么我建议您学习编码。了解不同的DevOps工具和自动化脚本，在当今的软件开发中起着至关重要的作用，这将在2018年占据主导地位。&lt;/p>
&lt;p>如果测试人员不学习自己编写自动化测试脚本，他们将会灭亡。手动测试将在2018年过时，它将占用大量时间。自动化测试不仅可以提高效率，还可以确保功能更快地交付给市场。&lt;/p>
&lt;h2 id="4-微服务体系结构应用的增加">4 微服务体系结构应用的增加
&lt;/h2>&lt;p>DevOps和微服务最近正是天作之合。微服务是独立的实体，因此不会在出现问题时由于任何依赖关系而中断其他系统。微服务体系结构可帮助公司轻松进行部署和添加新功能。预计公司将转向微服务体系结构，以提高其运行时间和效率。不要因为别人采用了微服务体系结构就跟着他们走，点这个文章：&lt;a class="link" href="http://blog.shippable.com/why-you-should-adopt-microservices" target="_blank" rel="noopener"
>了解自己并理解为什么应该采用微服务体系结构&lt;/a>。&lt;/p>
&lt;h2 id="5-预计将有更多的公司选择企业版devops工具">5 预计将有更多的公司选择企业版DevOps工具
&lt;/h2>&lt;p>目前有许多公司仍然处于建造还是购买的两难境地。但是，我们建议您做您最擅长的事情，并根据您的要求购买工具。这不仅有助于您专注于自己的目标，而且通过完全依赖第三方平台来提高工作效率。许多公司现在都在寻求企业版本，以获得自己的DevOps基础架构，并确保安全性尽可能掌握在最佳人员手中。&lt;/p>
&lt;h2 id="6-kubernetes将会大行其道">6 KUBERNETES将会大行其道
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.upwork.com/hiring/for-clients/kubernetes-vs-openshift-vs-tectonic/" target="_blank" rel="noopener"
>Kubernetes&lt;/a>因其优异的功能性和易用性，从而成为增长最快的容器技术。kubernetes围绕它建立了一个伟大的开源社区。在全球范围内，许多首席信息官和技术人员都采用了Kubernetes，采用比例预计将在2018年进一步提升。&lt;/p>
&lt;p>最近，&lt;a class="link" href="https://events.linuxfoundation.org/events/kubecon-cloudnativecon-north-america-2018/" target="_blank" rel="noopener"
>在KubeCon + CloudberNativeCon北美&lt;/a>( 2017年12月6日至8日)之前，云计算基金会进行了一项调查，并分享了容器编排环境正在发生的变化和向Kubernetes的转变。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15218007889881.png"
loading="lazy"
>&lt;/p>
&lt;p>来源:容器业务流程环境正在更改。&lt;/p>
&lt;p>以上是将在2018年复现的DevOps的6个趋势。&lt;/p></description></item><item><title>2018值得关注的15个DevOps大会</title><link>https://martinliu.cn/blog/2018-best-devops-event/</link><pubDate>Thu, 22 Mar 2018 08:30:13 +0800</pubDate><guid>https://martinliu.cn/blog/2018-best-devops-event/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/carauari-brazil.png" alt="Featured image of post 2018值得关注的15个DevOps大会" />&lt;p>本文向你简要介绍2018年DevOps界的15大最重要的大会活动。DevOps的一个方面就是持续&amp;hellip;&amp;hellip;.参加大会学习！全球范围内看，基本上每个月都至少有一个我们值得重点关注的大会。我们不能奢望都你有机会参加，但是作为DevOps业内人士，如果你不了解这个大会的情况，你就Out了。&lt;/p>
&lt;p>这些大会中有些社偏技术的、有些是注重社交和体验；根据你的业务需求和学习目标，今年走出去参加最高端DevOps盛会的奢望可以有。不提前做功课，怎么能说服领导支持你呢？万一领导批准了呢？&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15216787212180.jpg"
loading="lazy"
>&lt;/p>
&lt;h2 id="1-cloud--devops-world">1. Cloud &amp;amp; DevOps World
&lt;/h2>&lt;p>June 12-14, London&lt;/p>
&lt;p>cloud&amp;amp;DevOps World是techxl 8的一部分，是一系列各种技术会议、网络机会和博览会的一部分。cloud&amp;amp;DevOps World涵盖云创新和管理微服务、DevOps、容器、无服务器体系结构和监管实践。云与云世界的一大亮点是，您可以通过展览的其他部分(如物联网和虚拟现实会议)看到云概念和云概念在发挥作用。&lt;/p>
&lt;p>与会者还可以向观众演示他们的云解决方案，并享受联网、交互式会话和讨论面板。在去年的展会上，有300多家参展商和15000多名与会者参加，使这成为业界最大的展会之一。&lt;/p>
&lt;h2 id="2-devops-enterprise-summit-does">2. DevOps Enterprise Summit (DOES)
&lt;/h2>&lt;p>June 25-26, London&lt;/p>
&lt;p>DevOps企业峰会针对的是参与DevOps革命的主要企业的高级经理。该大会深入探讨了各种重要的主题，一方面涉及技术和架构问题，另一方面涉及领导力挑战。DevOps Enterprise Summit的主题演讲、专题小组讨论、聊天室、社交圈区和展览大厅。&lt;/p>
&lt;p>伦敦活动的讲演者包括来自IBM、Puppet、微软和各行各业的资深人士。DOES是一项每年举办两次的活动，地点在美国和欧洲之间变化。上一次在旧金山举行的展览有1400多人参加。&lt;/p>
&lt;h2 id="3-oreilly-velocity-conference">3. O’Reilly Velocity Conference
&lt;/h2>&lt;p>June 11-14, San Jose&lt;/p>
&lt;p>Velocity会议是本列表上排名第三的活动，由O’Reilly Media欧莱利媒体公司举办，该公司是一家技术媒体公司，在各种技术领域举办了无数的展览。Velocity会议在讨论站点可靠性工程、基础架构(如代码)、混沌工程、自动化、连续交付、恢复能力和安全性时，吸引了web ops、系统工程师和开发专家。圣何塞展览(今年在不同城市实际上有三个Velocity会议)的演讲者包括来自微软、Netflix、亚马逊和谷歌的代表。&lt;/p>
&lt;h2 id="4-chefconf">4. ChefConf
&lt;/h2>&lt;p>May 22-25, Chicago&lt;/p>
&lt;p>ChefConf面向开发、自动化和法规遵从性感兴趣的管理员和开发人员。ChefConf关注处理整个应用程序开发和管理生命周期所需的策略和技能。本次活动侧重于实践和经验，以涵盖构建云应用程序、持续法规遵从性和广泛的自动化等活动。去年的ChefConf吸引了大约1，500名与会者，来自Chef和其他重要科技公司的演讲者。&lt;/p>
&lt;h2 id="5-continuous-lifecycle">5. Continuous Lifecycle
&lt;/h2>&lt;p>May 15-18, London&lt;/p>
&lt;p>Continuous Lifecycle每年在伦敦举行，主要集中在开发、容器化、连续交付和敏捷方面。这是一个为期三天的活动，包括会议和研讨会，与会者包括开发负责人、架构师、开发人员、CTO、工程师和工具/基础架构专家。每一个行业都有代表，从高技术的最高水平到制造企业。&lt;/p>
&lt;h2 id="6-devops-con">6. DevOps Con
&lt;/h2>&lt;p>May 28-31, Berlin&lt;/p>
&lt;p>你是德国人吗？就算你只能说有点德文，DevOps Con也是值得一游的。它可能被认为是一年中最重要的持续交付会议，在微服务、Docker、云计算和精益业务方面进行了出色的讨论。今年的演讲者包括优步、红帽和西门子的高级职员。DevOps Con演讲者使用德语和英语，让与会者忙于实际的研讨会、会议和主旨演讲。&lt;/p>
&lt;h2 id="7-devops-days">7. DevOps Days
&lt;/h2>&lt;p>今年DevOpsDays在国内举办三场：北京-5月，上海-8月，深圳-11月。&lt;/p>
&lt;p>如果你还不能参加一个DevOps Days会议，那你肯定是住在了月球上。从亚特兰大到苏黎世，DevOps日一年四季都在不断发生，一个月内有多达几十个大会活动，遍布全球。DevOps Days活动关注软件开发和IT基础架构运营，重点关注自动化、测试、安全性和组织文化。&lt;/p>
&lt;p>每场大会的地点都不尽相同，因此如果您有特定的感兴趣区域，请确保您注册了最感兴趣的城市，以便充分利用2018年DevOps的重大活动。DevOps Days甚至鼓励专业人士在大会上组织自己的日程。&lt;/p>
&lt;h2 id="8-dockercon">8. DockerCon
&lt;/h2>&lt;p>June 11-15, San Francisco&lt;/p>
&lt;p>Docker大会的演讲者人大多来Docker本身，这并不奇怪。然而，在过去的几年里，来自AWS、Puppet、Cisco和cloudBee的演讲者也逐渐加入。为期三天的会议探讨了分布式、基于容器的应用程序的未来，并提供了一个引人入胜的视角，看看领先公司目前是如何开发Docker平台和容器的。&lt;/p>
&lt;p>与会者将有机会参加技术演示、实验教程和主题演讲。上一届会议有5 000多人出席。&lt;/p>
&lt;h2 id="9-gartner-it-operations-strategies-and-solutions">9. Gartner IT Operations Strategies and Solutions
&lt;/h2>&lt;p>May 15-17, Orlando&lt;/p>
&lt;p>由于Gartner分析师的数量超过了您的能力范围，因此IT运营战略和解决方案展览是向真正了解DevOps行业全局的专家学习的绝佳途径。&lt;/p>
&lt;p>该活动非常适合IT运营管理、云运营和IT服务支持专业人员。今年展会的主题包括IT运营优化、开发与敏捷、云与自动化、新兴IT运营趋势和战略。&lt;/p>
&lt;h2 id="10-itdev-connections">10. IT/Dev Connections
&lt;/h2>&lt;p>Oct 15-18, Dallas&lt;/p>
&lt;p>IT/Dev Connections将自己描述为“反基调”会议。这意味着它集中于实践科目和培训，避免了供应商过多的营销。说到实际，IT/Dev Connections的组织者甚至有一个“出勤证明中心”。&lt;/p>
&lt;p>除了各种讲习班、小组讨论和网络活动外，该会议还值得一提的是其妇女参与技术午餐会。IT/Dev Connections分为五个方面，涉及云和数据中心、数据平台、业务智能、企业协作、管理、移动性、安全性和DevOps的会话超过250个。&lt;/p>
&lt;h2 id="11-jenkins-world">11. Jenkins World
&lt;/h2>&lt;p>September 16-19, San Francisco&lt;/p>
&lt;p>DevOps只是Jenkins World涵盖的主题之一，它还涉及社区、CloudBee和生态系统等不同领域。虽然这一活动更倾向于一个特定的工具集，但它仍然非常受欢迎，2017年的活动约有2，000人参加。过去的讲演者代表了诸如Docker、Red Hat和亚马逊网络服务等公司。&lt;/p>
&lt;h2 id="12-large-installation-system-administration-conference-lisa">12. Large Installation System Administration Conference (LISA)
&lt;/h2>&lt;p>October 29–31, Nashville&lt;/p>
&lt;p>LISA会议将自己标榜为“供应商中立”，以便将市场营销保持在最低限度。LISA由美国先进计算系统协会Usenix组织，每年在美国不同的城市举办。本次大会吸引了大量供应商和系统管理员，重点关注关键系统的设计、构建和维护，以及围绕体系结构、文化和工程的实际考虑。讲演者包括戴尔、Netflix、Facebook和fasty等公司的高级代表。&lt;/p>
&lt;h2 id="13-microsoft-ignite">13. Microsoft Ignite
&lt;/h2>&lt;p>September 24-28, Orlando&lt;/p>
&lt;p>这将是2018年DevOps所有活动的母亲，因为这个大会看起来将超过2017年的人数，将有超过24000人参加。事实上，微软于2014年开始将Ignite作为合并多个会议的一种方式，数字反映了这一点。预计Ignite将非常繁忙，因为它涉及700多个演讲。然而，并不是所有的事情都与微软有关，因为展会包括100多家供应商，他们都是展会和会议演示的一部分。&lt;/p>
&lt;h2 id="14-monitorama">14. Monitorama
&lt;/h2>&lt;p>June 4-6, Portland&lt;/p>
&lt;p>Monitorama是另一个特别的大会，它只限于关于软件和基础架构监控工具和技术的主题。它还主办了一次黑客马拉松活动。Monitorama是为数不多的只有一个主题的大会之一，这样与会者就可以专注于一个问题，避免FOMO体验。该大会自2013年以来一直在进行，观众人数限制在600人左右，因此尽早预订是个好主意。&lt;/p>
&lt;h2 id="15-puppetconf-2018">15. PuppetConf 2018
&lt;/h2>&lt;p>October 9-11, San Francisco&lt;/p>
&lt;p>Puppet是一种开源配置管理工具，它对DevOps、云管理、下一代基础架构、应用程序交付、安全性、法规遵从性和持续交付的影响非常重要。&lt;/p>
&lt;p>PuppetConf由100多位专家提供了80多个课程，是一个非常棒的学习体验，无论是初学者还是老兵。PuppetConf由IT主管参加，他们希望获得有关DevOps转换、云迁移和持续交付的建议。2017年活动的讲演者包括来自Twitter、Yelp、谷歌、销售人员和Slack的Puppet员工和专业人士。&lt;/p>
&lt;h2 id="后记">后记
&lt;/h2>&lt;p>本文的清单是15个比较出名的大会，我发起并动态更新的全球DevOps重要大会的日历，访问的地址在这里：&lt;a class="link" href="https://teamup.com/ks5kh2kcca4w6xva4y" target="_blank" rel="noopener"
>https://teamup.com/ks5kh2kcca4w6xva4y&lt;/a>&lt;/p>
&lt;p>目前整理的全球大会日程表见下图（持续更新中，请直接查看线上版本）：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Screen_Shot_2018-03-23_at_5.26.39_PM.png"
loading="lazy"
alt="p1"
>
&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Screen_Shot_2018-03-23_at_5.26.52_PM.png"
loading="lazy"
alt="p2"
>
&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Screen_Shot_2018-03-23_at_5.27.25_PM.png"
loading="lazy"
alt="p3"
>&lt;/p>
&lt;p>最后一招：参加大会是为了学习先进思想和实践，这些大会是货真价实的真理发源地，在诸位参会学会了以后，回到公司，万一领导还是不理解，不支持怎么办？而且领导也不感冒参加这些大会。那么你可以在公司内部举办类似的大会，可以请外部的和尚来自己的庙里念经。这也是我们中国DevOpsDays核心组织者的一个想法，希望能够提供协助和支持，帮助所有传统企业早上走上上下一心的DevOps转型之旅。&lt;/p></description></item><item><title>基础架构的持续集成和应用部署</title><link>https://martinliu.cn/blog/devops-infrastructure-ci-app-deployment/</link><pubDate>Sat, 17 Mar 2018 10:50:57 +0800</pubDate><guid>https://martinliu.cn/blog/devops-infrastructure-ci-app-deployment/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/coding-snippet.jpg" alt="Featured image of post 基础架构的持续集成和应用部署" />&lt;p>持续集成通常是针对应用而言的，可是基础架构的持续集成应该怎么做？基础架构的持续集成应该属于持续交付/部署的基础。贯串本文的一个问题，或者在阅读本文时，您应该不断地问自己这个问题：我们的应用部署流程是怎样的？&lt;/p>
&lt;p>在回答这个问题之前，我们先来回顾一下，目前几乎所有人正在使用的手工环境和资源交付流程。在源码被编译打包了以后，安装包文件被上传保存到了内部的某个文件服务器上。Ops团队的某个组/人被分配到工单，根据工单描述的需求，它在测试或者生产环境中开始工作：&lt;/p>
&lt;ul>
&lt;li>用图形界面进行虚拟机模板的手工克隆工作，或者由于没有相应的权限或者自助服务，不得不给虚拟化管理员发任务单，然后等待回复。&lt;/li>
&lt;li>获取用户名和密码手工登录服务器，有些企业还要是等待领导的审批，才能得到密码信封和所需要的访问密码。&lt;/li>
&lt;li>根据工单（变更单）里的描述和自己的经验对虚拟机的操作系统进行配置，在这个过程中，Ops往往可能还需和需求方进行不止一次的沟通，确认相关参数。&lt;/li>
&lt;li>手工的下载应用安装包，然后分别手工上传到目标的服务器，凭经验和工单信息部署应用，然后测试部署结果，可能是看下页面有没有正常显示，或者服务起没起.&lt;/li>
&lt;li>手工测试和确认这些虚拟机的服务和状态，凭经验觉得OK了以后，回复工单，关闭工单。&lt;/li>
&lt;/ul>
&lt;p>以上的工作场景，可能是Ops人员很常规的一天，或者是几天内的工作，当然在这个过程中，他们还需要参与一些救火行动；他们在这个过程中也可能会有疑问，也可能会对此工作结果不确定；但是，日常的工作经验告诉他，差不多了，关闭任务单要紧，还有好多项目催活呢！就这样，配置并不精确的虚拟机环境就交给了下游的需求方。&lt;/p>
&lt;p>以上工作过程的问题如下：&lt;/p>
&lt;ol>
&lt;li>工作周期长，速度慢。实际上工作周期拖延的越久，工作结果的质量就越差，而并不是我们想想中的慢工出细活。&lt;/li>
&lt;li>所有步骤都是纯手工操作，不仅费事费力，而且出错几率高，也几乎不可能无痛的回退。可能有人会说了，我们不需要那么快，我们也不是互联网公司；可是从精益思想的角度看，以上这些工作都属于对业务价值的交付贡献为零的工作；你可能是由于公司给你发着工资，才错误的感觉到，这项工作活动应该有它的价值。&lt;/li>
&lt;li>上游传递来的信息可能不全面，不准确，因此Ops很有可能造成错误配置，因此会返工。&lt;/li>
&lt;li>传递给下游的虚拟机很可能会在后续的部署过程中，由于应用需求的变化，而需要下游的人员对其重新配置，产生重复的劳动。&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>手工部署的时间和代价 = 应的数量 X 应用版本数量 X 环境数量&lt;/p>&lt;/blockquote>
&lt;p>对以上工作系统进行优化的原则：如果某一项活动的重复频率越高，那么对它进行优化，所产生的回报也会越明显；这里还要参考限制理论，优化的顺序要正确。&lt;/p>
&lt;p>我们从这个角度出发，就可以来设定基础架构持续集成和应用部署流程的改进目标了：&lt;/p>
&lt;ul>
&lt;li>减少总体人工工作时间和代价&lt;/li>
&lt;li>提高交付的速度、可靠性和频率&lt;/li>
&lt;li>能进行应用部署，能进行数据库Schema的更新&lt;/li>
&lt;li>能够实现部署流程的自服务，让任何需要部署应用的人能一键式部署任何版本&lt;/li>
&lt;/ul>
&lt;p>到了这里我们就必须将上述手工劳动，变为自动化的过程。因此，基础架构即代码IaC （Infrastructure as code）和相关的配置管理工具就会用到。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/delivery-Pipeline.png"
loading="lazy"
alt="delivery-Pipeline"
>&lt;/p>
&lt;p>上图是一个典型的持续交付流水线模型，在此我们对它的关注点如下：&lt;/p>
&lt;ul>
&lt;li>代码的变更被Jenkins自动化的构建（CI是基础），打包后的安装包被存储在Artifactory里，Artifactory里面还可以存储应用包的其它相关元数据，如测试结果，能否可以用于下一步部署的标签等等。&lt;/li>
&lt;li>Jenkins自动化的搭建所需要的环境，调用虚拟化或者公有云资源池的API，制备虚拟机资源，然后调用Chef完成对虚拟机的配置，完成应用包部署所需要的所有层次的配置。&lt;/li>
&lt;li>环境配置完成后，应用正常运行了，在相关的测试工具对部署后的环境做验收测试，Chef具有支持测试驱动的相关工具。&lt;/li>
&lt;/ul>
&lt;h2 id="基础架构的持续集成">基础架构的持续集成
&lt;/h2>&lt;p>为了实现完整的基础架构持续集成流程，以上持续交付流水线必须具备的能力和概念包括：分层的系统管理、基础架构即代码IaC、配置管理、Chef工具等。下面详细对它们进行描述。&lt;/p>
&lt;h3 id="分层的系统管理">分层的系统管理
&lt;/h3>&lt;p>系统管理的层次涉及到OS相关的三个层次。下面自下而上地简单描述一下。&lt;/p>
&lt;ol>
&lt;li>制备管理：涉及到虚拟化层，这一层是资源表达层，目前所有主流的虚拟化都支持标准的Rest API，包括VMWare、EC2和Nuanix等。大多数主流配置管理工具都具备用于虚拟机生命周期管理（从生成、到开机、到删除等）的API功能，能按需的获得任何数量、规模、网络和操作系统类型的部署环境。&lt;/li>
&lt;li>配置管理：在任何类型的操作系统里自动化的安装和配置软件包，将所有配置参数配置好以后，持续保持这些配置点的状态。对于简单应用，来说按配置参数启动服务即任务完成。&lt;/li>
&lt;li>应用编排管理：对于复杂的分布式系统，由于各个自服务之间存在着依赖关系，所有自服务之前需要互通一些配置参数才能实现，应用程序整体的正常运行，配置应用服务器的odbc数据库连接，配置web前端的ldap认证服务器等等。目前微服务所涉及的服务发现和路由，是应用编排必备的配套设施。&lt;/li>
&lt;/ol>
&lt;p>不同的DevOps配置管理工具也都力求能覆盖以上三个层次，但是他们所追求的方向，或者想解决的主要问题并不相同。因此各个工具之间功能上有重叠。&lt;/p>
&lt;p>因此在运用这些工具的时候，不仅要追求其卓越的功能，还要能意识到，并有意的在不同层面上做取舍。&lt;/p>
&lt;h3 id="基础架构即代码">基础架构即代码
&lt;/h3>&lt;p>IaC这个概念最早是被Chef这类工具提出并实现，它的基本想法就是让Ops人员象开发人员一样的，工作在基础架构的代码上，而不是面对着数十个图形和文字终端界面。使用类似于开发应用程序的方式，开发和管理基础架构环境，因此基础架构能通过API访问和操控是基础，目前所有主流的虚拟化/云计算平台都具备很好的API接口；可惜的是在传统的企业环境中，这些资源池的API功能几乎没有被用到。&lt;/p>
&lt;p>像开发应用代码一样的管理IT基础架构，基础架构的开发和管理也需要遵循与应用开发类似的原则，这些原则包括：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>一切从源代码开始&lt;/strong>:并对其进行严格的版本管理，要对基础架构变更，就需要对相应的代码进行变更和测试，最后发布这些代码。从而力求做到服务器的无人登录运维。&lt;/li>
&lt;li>&lt;strong>模块化设计&lt;/strong>:不同应用底层所使用的基础架构有着大量的相似之处，模块化的设计不仅意味着标准化，也意味着更少的重复代码。我所用过的Terraform、Chef和Puppet这三种工具，都具有高度的模块化特性。&lt;/li>
&lt;li>&lt;strong>抽象能力&lt;/strong>：能够使用不同的模块和参数对任何特征的应用进行建模，用IaC代码进行表达，基础架构的代码开发也就是借助这种抽象能力，将所有管理对象（配置管理项）具体化地描述为应用服务模型。编写出来的基础架构代码，不仅包含了所有对应用配置描述性的语义，而且还是能够被执行的代码，在IaC代码执行之后，你就得到了所期望的虚拟机、应用配置和应用服务。&lt;/li>
&lt;li>&lt;strong>可测试性&lt;/strong>：这是一个经常忽略的能力，而在了解之后，你会发现IaC也是编程语言，就是对基础架构进行高级的编程，而且IaC代码本身和它的运行结果都是可以测试的。在执行前对其语义语法测试，在运行以后对其运行结果测试。Chef在这方面表现的尤为突出。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/chef-logo.png"
loading="lazy"
alt="Chef"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/LogoTerraform.png"
loading="lazy"
alt="Terraform"
>&lt;/p>
&lt;h3 id="配置管理">配置管理
&lt;/h3>&lt;p>我可能是最早的一批进行ITIL配置管理实践，CMDB建设的这批人；我以前和甲方客户有着大量的关于配置管理和CMDB的对话，所经历过的项目也非常煎熬。而在DevOps场景下，感觉以前的经历也是很有意思的，只是我现在说到的CI，在没有特指的情况下，是持续集成的概念，还不是配置项了。&lt;/p>
&lt;blockquote>
&lt;p>Process for establishing and maintaining consistency of a product’s performance, functional and physical attributes with its requirements, design and operational
information throughout its life。&lt;/p>&lt;/blockquote>
&lt;p>以上是配置管理在维基百科里的定义，它所表达的含义还是值得借鉴的；而如今很多人对DevOps的认识，还有人是建立在DevOps配置管理相关的工具上的。为了纠正这个错误观点，我们经常说：“天文学并不只是关于望远镜的。”&lt;/p>
&lt;p>配置管理工具中有很多是基于主机（OS）的管理工具，包括：CFEngine、Puppet、Chef、Salt和Ansible等。它们都具有基础架构即代码的相关原则和特征。都能实现：定义服务器的目标期望状态的能力，在每一次执行周期里，它们都进行状态检查，汇报当前状态和目标状态的偏差，在必要的时候也可以自动的执行必要的状态修复操作。&lt;/p>
&lt;p>Chef这种配置管理工具，使用了Ruby风格的DSL语言，使用者只需要用Chef代码表达”What“即可，而不需要明白”How“；”What“既是对目标配置状态的描述，使用者只需要将需求转换为Chef代码，然后用Chef客户端工具运行它即可。Chef的代码清晰，描述能力强大。在编码的时候遵循DSL规则，如果有必要的话也可以调用Ruby。&lt;/p>
&lt;p>Chef是客户端服务器的架构，安装了&lt;strong>Chef-client&lt;/strong>程序的节点可以注册到一个&lt;strong>Chef管理服务器&lt;/strong>里。&lt;/p>
&lt;p>Chef的开发人员（IaC编码者），在安装了用于和Chef服务器交互的名为&lt;strong>knife&lt;/strong>的工具，称之为&lt;strong>工作站&lt;/strong>的系统上开发基础架构代码。Chef使用大量内置的DSL资源（例如：package，service，file，directory等操作系统资源分类）对目标节点的配置进行建模，代码可以映射到内部的用来执行这些代码的各种&lt;strong>提供者&lt;/strong>上。&lt;/p>
&lt;p>所能实现的示例代码如下所示，下面是配置Linux操作系统中的Apache服务器。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">package&lt;/span> &lt;span class="s1">&amp;#39;httpd&amp;#39;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">action&lt;/span> &lt;span class="ss">:install&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">service&lt;/span> &lt;span class="s1">&amp;#39;httpd&amp;#39;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">action&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="ss">:enable&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">:start&lt;/span> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>下面是在Linux操作系统里配置 &lt;code>/a/b/c&lt;/code> 目录&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">directory&lt;/span> &lt;span class="s1">&amp;#39;/a/b/c&amp;#39;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">owner&lt;/span> &lt;span class="s1">&amp;#39;admin&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;admin&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="s1">&amp;#39;0755&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">action&lt;/span> &lt;span class="ss">:create&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">recursive&lt;/span> &lt;span class="kp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以下面就是 &lt;code>/a/b/c&lt;/code> 目录的配置结果状态：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$ls&lt;/span> ‐ld /a/b/c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-­‐xr-­‐x. &lt;span class="m">5&lt;/span> admin admin &lt;span class="m">4096&lt;/span> Feb &lt;span class="m">14&lt;/span> 11:22 /a/b/c
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Chef其它的重要术语：&lt;/p>
&lt;ul>
&lt;li>recipe ：包含了一个或者对个资源描述定义（Chef预定义了文件、用户、软件包、服务等等资源，可以扩展开发自定义资源类）&lt;/li>
&lt;li>cookbook ：包含了一个或多个recipe配方&lt;/li>
&lt;li>data bag ：包含了一个或多个配置数据点(data bag item)，是JSON格式，一个cookbook食谱可以包含一个或者多个数据袋&lt;/li>
&lt;li>run list ：包含了一个或者多个cookbook食谱，可将其部署在被管理的node节点上&lt;/li>
&lt;li>role ：一组特定内容的run list运行清单构成了一个角色&lt;/li>
&lt;li>environments：同我们现在对环境的定义，并可以一一对应起来&lt;/li>
&lt;/ul>
&lt;p>Chef是偏主机配置管理的非常的Iac语言，它具有很丰富的扩展能力和生态系统。它有很好的扩展能力，很强的逻辑性，能够进行深度的表达和锻造。它和Terraform和Ansible都有较大差异。&lt;/p>
&lt;h2 id="部署流程设计">部署流程设计
&lt;/h2>&lt;p>将以上手工处理过程转换为自动化执行的、一键式触发或者自动触发的流程需要关注很多个要点。&lt;/p>
&lt;p>使用Chef部署自开发的应用程序，包括配置所依赖的操作系统配置和软件，以及自身所需的应用配置。可以使用Liquibase进行数据库的schema部署和更新。可以用Jenkins协调和组织所有工序的执行。使用Jenkins管理部署流程的感觉和用它执行CI是类似。&lt;/p>
&lt;p>从简单开始，尽量将一组彼此相关的、版本化的可部署物组织在一起发布，例如在一个发布集合中可以包含：UI、REST服务器、消息服务和数据库。尽量使用一条命令构建，使用一条命令部署。&lt;/p>
&lt;h3 id="cookbook设计类型">Cookbook设计类型
&lt;/h3>&lt;p>&lt;strong>Library Cookbook 库食谱&lt;/strong> ：这种类型的食谱涵盖了通用的、可重用的逻辑。例如所有配置基线，也可以是安全基线。例如：dns、ntp、主机登录提示、用户和组、禁用服务清单等等。开发扩展的自定义chef资源，用来部署自开发应用。&lt;/p>
&lt;p>&lt;strong>Application Cookbook 应用系统食谱&lt;/strong> ：在以上库食谱的基础上，为一个套应用系统开发一个Cookbook食谱，每个应用可是一个recipe配方，recipe配方使用自定义开发的Chef资源。这样就形成了非常轻量的代码库。&lt;/p>
&lt;p>&lt;strong>Data Bag 数据袋&lt;/strong>：包含了各种应用配置，例如：服务端口、JAVA_OPTS等等。一个应用系统Cookbook食谱对应一个数据袋，袋子里面包含了该应用在每一套环境里的相关所有配置点。&lt;/p>
&lt;p>上线一个应用的新版本意味着新版本IaC代码的更新和部署，大致的流程是：编辑Chef代码、推送到Chef管理服务器、在节点上运行Chef客户端程序执行部署动作。Chef服务器的版本始终和版本控制库里的Master主干保持一致，这同样意味着环境配置和Master主干代码保持一致。&lt;/p>
&lt;p>用Chef开发自定义应用资源的实例代码如下，这段代码表示了一个Java应用war包的部署。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/carbon.png"
loading="lazy"
alt="carbon"
>&lt;/p>
&lt;p>基于类似于以上的自定义资源类型，在必要的情况下，还可以对其开发Action（chef资源的操作），可能的操作定义有：&lt;/p>
&lt;ul>
&lt;li>从Artifactory服务器下载Java、Tomcat和WAR包。&lt;/li>
&lt;li>在标准的路径安装Java和Tomcat。&lt;/li>
&lt;li>创建和配置Tomcat容器&lt;/li>
&lt;li>在特定的容器里安装WAR包&lt;/li>
&lt;li>在主机上开防火墙端口&lt;/li>
&lt;li>生成应用属性文件&lt;/li>
&lt;li>启动Tomcat容器&lt;/li>
&lt;/ul>
&lt;p>Data Bag数据袋的实例代码结构如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;1.4.9&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;runtime&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;my-­app-­ui&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;java_opts&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;-­‐Xmx2G -­‐XX:MaxPermSize=1024m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;app_config&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;db.url&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;jdbc:postgresql://devdb:5432/myapp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;svc.foo.url&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;http://devsvc:9000/foo&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上是data_bags/my_app/DEV.json的定义，还可以有其它环境的定义data_bags/my_app/TEST.json和data_bags/my_app/PROD.json等。&lt;/p>
&lt;h2 id="人员角色">人员角色
&lt;/h2>&lt;p>基础架构的持续集成需要Dev和Ops的相互协作，才能做通，才能全面覆盖应用所需要的技术栈。&lt;/p>
&lt;p>&lt;strong>部署人员&lt;/strong> 更data_bag新数据袋和环境定义文件，触发生产环境部署的动作，调度chef-client客户端的运行，或者推送新版本的Chef代码更新。&lt;/p>
&lt;p>&lt;strong>技术负责人&lt;/strong> 维护应用系统Cookbook食谱。&lt;/p>
&lt;p>&lt;strong>框架开发人员&lt;/strong> 维护库Cookbook食谱，维护框架，持续改进流程。&lt;/p>
&lt;p>以上这三种角色，从上到下是从Ops到Dev的过渡。对于传统IT组织的架构，部署人员是Ops团队的，框架开发人员是Dev团队的。&lt;/p>
&lt;p>这三种角色都凑齐了，才能起到全套应用系统的整体建模和编码，而且每个角色都有负责的部分。技术负责人可能是来自Ops和Dev团队的技术大拿。他们对整体的正确性和完整性负责。&lt;/p>
&lt;p>目前也有Dev团队在其内部招聘运维研发的角色。这三种角色是基础架构即代码的层次结构和人员团队架构的对应，在实际工作中可以灵活应用；一方面覆盖所有技术层次，另外一方面引入所有必要的人员，是团队形成合力。&lt;/p>
&lt;p>如果不是本着将全套应用系统做全量的部署，以上任何角色做自己职责范围内的IaC自动化实践，其实效果是事倍功半的，或者机会只有技术学习和探索的价值。&lt;/p>
&lt;h2 id="构建cookbook">构建Cookbook
&lt;/h2>&lt;p>在开发了各种Cookbook之后，我们就需要对其进行持续测试，因此就需要使用Cookbook的持续构建流程。这个步骤就如同我们对应用程序的代码做CI一样。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/cookbook-build.png"
loading="lazy"
alt="cookbook-build"
>&lt;/p>
&lt;p>开发人员（程序员不是业务应用开发者的专业名词，这里指IaC开发者，可能来自任何团队）在Workstations工作站上开发Chef的Cookbook代码，将代码提交到GitHub上的Chef代码仓库。&lt;/p>
&lt;p>Jenkins的Master服务器会触发CI Job，调用Ruby Slave对Cookbook代码进行集成和测试，然后触发EC2临时实例的创建，将Cookbook在EC2实例中进行测试，使用Artifactory中存储的应用软件包部署应用。如果测试都通过了，就触发Release Job，它将Cookbook代码上传到Chef服务器，供所各种环境中的被管理节点使用。&lt;/p>
&lt;p>上图用EC2作为Chef代码的CI环境，可以替代的方案有Vagrant+虚拟化（Virtual Box或者kvm），或者使用其它虚拟机资源池，如Ovirt KVM、Xen、Nutanix。我实际测试过使用Terraform对接Nutanix资源池，虚拟机创建超级快，几乎是秒得的速度。现有的虚拟化资源池就是最方便的对接对象，需要了解一下API和对接工具即可。&lt;/p>
&lt;p>对于Jenkins构建服务器而言，每一套应用系统对应的Cookbook组/集合的测试和发布都会在同一个构建服务器上发生，一般情况下这个服务器也是这些应用的CI服务器；这个Jenkins服务器也是相关Cookbook的CI作业和发布作业的运行地点。这个服务器上会安装所需要的Ruby gem包，应该能访问到与Chef服务器链接所需要的秘钥；应该可以使用到创建EC2测试节点虚拟机的秘钥，或者说访问其他类型虚拟机资源池的用户名和密码。&lt;/p>
&lt;h3 id="cookbook-ci-job">Cookbook CI Job
&lt;/h3>&lt;p>Cookbook CI作业的触发条件是：当有新Chef代码被合并的时候。它会进静态代码扫码和测试工作，包括如下内容：&lt;/p>
&lt;ul>
&lt;li>使用json和gem的相关工具分析JSON的句法&lt;/li>
&lt;li>使用Tailor做Ruby的句法和风格扫描&lt;/li>
&lt;li>使用Knife做Chef代码的句法分析&lt;/li>
&lt;li>使用Foodctritic做Che代码的句法分析和正确性分析&lt;/li>
&lt;/ul>
&lt;p>Chef代码在测试虚拟机里的集成测试是本文的重点，集成测试工具使用Test Kitchen，这个工具有一系列和虚拟化/云环境对接的插件，如 kitchen-ec2插件等。能按需临时的创建用于集成测试的虚拟机，在测试完毕，得出了测试结果之后，就删除本作业所创建的临时虚拟机。&lt;/p>
&lt;p>在集成测试的生命周期过程中也可能创建多个测试虚拟机/EC2实例，这个过程使对应用系统里的所有组件进行仿真的、实际的安装包和服务部署，进行单节点或者多节点的全量应用系统部署。在每个节点上都执行Chef代码，在Chef对应用系统的配置和部署完成之后，在对运行中的应用进行验证测试，测试包括测试相关的服务端口是否能访问，返回结果是否正常等等，Chef是可以进行测试驱动开发的，因此可以写出较细致的测试代码，从而分析本Cookbook集成测试通过与否。在测试结束了以后（最好是10分钟左右或更短），删除所有测试的虚拟机资源。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/nutanix-logo.png"
loading="lazy"
alt="Nutanix"
>&lt;/p>
&lt;p>应该尽可能的优化这个集成测试，尽量缩短它的执行时间。可以创建专用的EC2-AMI/Nutanix/Kvm/VMWare操作系统镜像，预装所需要的Ruby环境和Chef工具。&lt;/p>
&lt;p>使用Chef Solo（不依赖chef服务器）执行Chef代码的测试，以免将临时节点也添加到了Chef服务器，同时也消除了Chef的客户端和服务器架构之间相互通讯的消耗，这个场景里其实没有使用Chef服务器的必要。使用一个名为CHEFDEV的伪环境来测试代码，而JSON文件里定义的真实环境则被保留用于正式生产环境。在创建EC2虚拟机的时候，给它们打上特定的标签，从而保持一定的可追踪性和环境的可维护性。&lt;/p>
&lt;h3 id="cookbook-release-job">Cookbook Release Job
&lt;/h3>&lt;p>这个作业的运行内容和CI Job基本一致的，而它是靠人为手工触发的，从Chef角度看，可以说：本文上述的所有描述，属于Chef风格的基础架构即代码程序的持续交付。本作业将测试成功的代码在GitHub/GitLab里打上标签，并且上传Cookbook的新版本到正式的Chef生产服务器上。&lt;/p>
&lt;p>可以想象经过多个Cookbook的build job之后，Cookbook的某个版本被发布到了生产环境中，用于环境的配置和应用的部署。本Job作业交付了IaC的开发结果到生产环境中的Chef管理服务器。&lt;/p>
&lt;p>其它IaC的基础架构持续及集成与本文描述的也应该是类似流程。&lt;/p>
&lt;h2 id="应用部署流程">应用部署流程
&lt;/h2>&lt;p>Cookbook的开发和集成完毕了以后，它的结果产物是一些列新版本的Cookbook代码，它们最终上传到Chef服务器。支持生产环境应用部署的Chef服务器与各种环境保持连接，包括测试、预发布和生产等等。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/app-deploy-process.png"
loading="lazy"
alt="app-deploy-process"
>&lt;/p>
&lt;p>在发布过程中所使用到的制品是从Artifactory中拉取的。下面简单说下这个架构中的关键点。&lt;/p>
&lt;p>&lt;strong>Jenkins部署服务器&lt;/strong> 这是专门用于各种部署工作的Jenkins Master服务器，它和上一个步骤里Cookbook的Build服务器是不同的。它的Slave应该满足这些需求：安装了所需要Ruby环境和gem包。安装了Chef工具，并且具有能更新Chef服务器的秘钥。具有能访问各种虚拟化环境中节点的SSH秘钥。&lt;/p>
&lt;p>&lt;strong>部署作业的类型&lt;/strong> 可以对于每一个应用组（一套应用系统）设置两个部署作业：在开发环境中的，用于开发人员使用的DEV部署作业；另外是运维人员所使用的Non-Dev部署作业。在实践过程中也能发展出其他类型。&lt;/p>
&lt;p>部署人员的工作流程：&lt;/p>
&lt;ol>
&lt;li>变更Chef相关代码和配置，包括：编辑应用的data bag配置数据点，有必要的话编辑环境文件，合并代码。&lt;/li>
&lt;li>然后在Jenkins部署服务器上执行作业。&lt;/li>
&lt;/ol>
&lt;p>通过以上的流程和工具，开发、测试和运维的相关人员，如果需要部署应用了，就可以用一键式的、自助式的部署模式，将任何应用应用系统通过一键式的方式自动化的部署到各种应用环境中。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/push-button-deploy.png"
loading="lazy"
alt="push-button-deploy"
>&lt;/p>
&lt;p>这样我们将大量各种角色人员都从事的、没有附加值的应用部署工作，彻底的消灭掉了，节省的时间可以用来做更多有意义的工作，Dev人员有更多时间编码、测试人员不需要等待时间、运维人员也降低的工作压力。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>关于基础架构的持续集成，还有下列值得参考的原则：&lt;/p>
&lt;ul>
&lt;li>尽可能的标准化：包括技术、设计和流程等方面；要能够支持环境的规模化扩展，例外是可以的，但是要尽量避免。&lt;/li>
&lt;li>所有工具最好有API：避免在某个工具，在工具链上的任何环节的脱节。&lt;/li>
&lt;li>使用多种形式的沟通路径：这个实践需要用各种方式进行宣传和推广，包括：全员大会的主题分享、每个团队的启动会议、与开发人员的随时沟通，使用文档进行知识传播和沟通。&lt;/li>
&lt;li>保持乐观，尽量发现和找到那些志同道合的早期响应者，让他们和你站在一条战线上。&lt;/li>
&lt;/ul>
&lt;h2 id="引用">引用
&lt;/h2>&lt;h3 id="参考视频">参考视频
&lt;/h3>&lt;p>&lt;a class="link" href="https://www.youtube.com/watch?v=PQ6KTRgAeMU" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=PQ6KTRgAeMU
&lt;/a>&lt;/p>
&lt;h3 id="参考书籍">参考书籍
&lt;/h3>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/book-infrastructure-as-code.png"
loading="lazy"
>&lt;/p>
&lt;hr></description></item><item><title>DevOps on Nutanix[Beta]</title><link>https://martinliu.cn/blog/devops-on-nutanix/</link><pubDate>Mon, 26 Feb 2018 11:08:53 +0800</pubDate><guid>https://martinliu.cn/blog/devops-on-nutanix/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/testdrive_background.jpg" alt="Featured image of post DevOps on Nutanix[Beta]" />&lt;p>Nutanix是什么？中文名字是路坦力，是我目前所在的公司；我负责运营商行业以及与云服务商的合作业务，解决客户在售前、架构和DevOps等方面的问题，我是Nutanix Calm产品的专家。&lt;/p>
&lt;p>之前也发过一些介绍Nutanix和超融合技术的文章，本文会是一篇持续更新的文章，我会把在Nutanix上开展超融合的方法，持续的更新在这里。&lt;/p>
&lt;p>本文上属于Beta版本，会持续更新，欢迎各种类型的反馈信息，发邮件到： &lt;a class="link" href="mailto:martin.liu@nutanix.com" >martin.liu@nutanix.com&lt;/a>&lt;/p>
&lt;p>变更日志：&lt;/p>
&lt;ul>
&lt;li>2018-2-26，发表了相关概况介绍性内容&lt;/li>
&lt;/ul>
&lt;h2 id="什么是devops">什么是DevOps？
&lt;/h2>&lt;blockquote>
&lt;p>我的定义：DevOps是为了将软件开发、运维和质量保证等部门紧密地协作和集成在一起，而运用的一组成熟的、相互融合在一起的最佳实践。它使人们能准时/及时地生产软件产品或服务，从而满足企业的某个业务目标，开发与运维工作将在一个统一的目标之下协同工作，它是对IT组织内部各个角色之间的相互依存关系的一种新的理解。这个实践集合主要包含了四种最佳实践，如下图所示：&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="http://res.cloudinary.com/martinliu/image/upload/q_auto:eco/devops-house.png"
loading="lazy"
alt="DevOps 定义"
>&lt;/p>
&lt;p>注意：上图里Nutanix的定位在持续交付，超融合平台能高速平滑的交付IT服务。&lt;/p>
&lt;p>来自网络的其它定义还有如下。&lt;/p>
&lt;blockquote>
&lt;p>定义2：You cannot buy DevOps and install it. DevOps is not just automation or infrastructure as code. DevOps is people following a process enabled by products to deliver value to end users. &amp;ndash; Donovan Brown, Microsoft DevOps Program Manager&lt;/p>&lt;/blockquote>
&lt;p>以上出自：&lt;a class="link" href="http://www.donovanbrown.com/post/2015/09/01/what-is-devops" target="_blank" rel="noopener"
>Donovan&amp;rsquo;s blog post on &amp;ldquo;What is DevOps&amp;rdquo;.&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>定义3：DevOps（Development和Operations的组合词）是一种重视“软件开发人员（Dev）”和“IT运维技术人员（Ops）”之间沟通合作的文化、运动或惯例。透过自动化“软件交付”和“架构变更”的流程，来使得构建、测试、发布软件能够更加地快捷、频繁和可靠。&lt;/p>&lt;/blockquote>
&lt;p>以上出自：&lt;a class="link" href="http://zh.wikipedia.org/wiki/DevOps" target="_blank" rel="noopener"
>维基百科 Wikipedia - DevOps&lt;/a>&lt;/p>
&lt;h2 id="什么是hci-超融合基础架构">什么是HCI-超融合基础架构
&lt;/h2>&lt;p>我对超融合的定义：将计算、存储和网络这三种资源的至少两种融合在一起的技术就可以称之为超融合技术。Nutanix是将计算和存储融合在了一个系统只能，这里说的系统可以理解一个物理的机箱，并且在这个机箱里搭载了目前业内最通用的KVM虚拟化功能。Nutanix的超融合系统是开箱即用的IaaS平台，可以无节点数限制的水平扩展，能够支持服务器虚拟化、VDI、Oracle RAC等关键性数据库、企业核心业务系统、大数据和私有云等工作负载。在性能和功能上是专门为HCI而打造的。HCI技术正在颠覆着传统的三层架构技术堆栈（指的是：服务器-存储网络-集中存储）。&lt;/p>
&lt;p>Nutanix在2018年Gartner融合基础架构分析报告中，Nutanix在领导象限里遥遥领先。&lt;/p>
&lt;p>&lt;img src="http://res.cloudinary.com/martinliu/image/upload/Gartner-report-2018.png"
loading="lazy"
alt="Gartner 报告"
>&lt;/p>
&lt;p>2018 年 2 月 9 日，北京 ——企业云计算领域的领先企业 Nutanix（纳斯达克：NTNX）今天宣布， Gartner 将 Nutanix 评为 2018 年 Gartner 超融合基础架构（HCI）魔力象限领导者。Nutanix 认为，此次跻身“领导者”象限有力印证了 Nutanix 在其率先开拓的市场上的领导地位，也充分彰显了公司致力于提供下一代企业云操作系统的愿景。&lt;/p>
&lt;p>随着越来越多的企业机构认识到超融合基础架构（HCI）的优势，企业基础设施正在经历根本性的转变。这些企业机构采用了一种新的架构设计，将网络规模技术和消费级设计相融合，实现“隐形基础设施”，从而使 IT 团队能将更多的时间投入到业务应用中。同时，这些企业机构还纷纷采取了能够利用多云基础设施和云服务的 IT 战略。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>Nutanix 认为，利用其企业云操作系统软件，用户不但能实现公有云的精简性、敏捷性以及部分 IT 消费收益，还能保障企业数据中心的高可控性与安全性。在融合了私有云、公有云和分布式云的统一 IT 操作环境下，Nutanix 企业云操作系统软件提供单点控制来管理任何云的基础设施与应用，从而为云运营商和采用云交付式服务及应用的用户提供统一、高性能、无缝的使用体验。&lt;/p>
&lt;p>关于Nutanix的更多视频，&lt;a class="link" href="http://i.youku.com/i/UMzM5NzI4MDg1Mg==?spm=a2hzp.8244740.0.0" target="_blank" rel="noopener"
>请访问Youku的频道。&lt;/a>&lt;/p>
&lt;h3 id="学习nutanix核心技术">学习Nutanix核心技术
&lt;/h3>&lt;p>关于Nutanix超融合系统的核心技术特性请访问：&lt;a class="link" href="http://nutanixbible.com/" target="_blank" rel="noopener"
>Nutanix 圣经&lt;/a>，圣经网站上有中文版本pdf下载，最近会有一次中文版的修订请关注。&lt;/p>
&lt;h3 id="试用nutanix产品">试用Nutanix产品
&lt;/h3>&lt;p>Nutanix提供免费的社区版本，对此感兴趣的人都可以下载和使用。使用这个版本，你能够在几个小时内，搭建起数量为1、3或者4个的物理服务器组成的Nutanix集群。&lt;/p>
&lt;p>关于如何安装和试用Nutanix CE版本的技术文档，访问我的Nutanix实验室文档站点：&lt;a class="link" href="https://nutanix.martinliu.cn/" target="_blank" rel="noopener"
>https://nutanix.martinliu.cn/&lt;/a>&lt;/p>
&lt;h2 id="使用nutanix-calm实现devops持续交付">使用Nutanix Calm实现DevOps持续交付
&lt;/h2>&lt;p>Nutanix是一种开箱即用的高性价比的虚拟化资源池，你可以用最小的时间成本完成大规模资源池的搭建和部署。而现实情况下：所有企业的虚拟化管理员的工作模式还是基于工单的手工VM模板克隆的方式。还没有人能将基于vm的业务系统做到自动化的持续交付。Nutanix Calm就是一项解决这个问题的技术。它是Nutanix超融合系统内置的一个功能，可以一键式的开启这项功能。&lt;/p>
&lt;p>&lt;img src="http://res.cloudinary.com/martinliu/image/upload/WechatIMG224.jpeg"
loading="lazy"
alt="Nutanix Calm"
>&lt;/p>
&lt;p>Nutanix Calm的主要功能如下所示：&lt;/p>
&lt;ul>
&lt;li>应用生命周期管理：利用预定义的应用蓝图，全面地实现了传统型多层应用和流行的分布式服务的自动化运维，包括系统制备、扩缩容和资源释放等操作。应用蓝图将极大地简化了私有云和公有云的应用管理和运维。&lt;/li>
&lt;li>应用蓝图管理：将应用系统的所有组成部分（包括相关的虚拟机、配置和可执行程序）融入到了一个可视化的、操作直观的蓝图里，从而简化了企业应用的配置管理和日常运维。应用蓝图提升了基础架构团队的管理效率。IT团队再也不用像以前那样，在应用管理的日常工作上花费大量时间。&lt;/li>
&lt;li>Nutanix应用市场：应用蓝图可以在Nutanix 应用市场（Marketplace）里把应用直接发布给最终用户，使产品经理和开发人员能够持续交付产品，快速地供给应用，及时地满足IT服务请求。&lt;/li>
&lt;li>应用治理：Calm基于角色的访问控制机制可以限制用户的操作权限。此外，系统会集中地记录所有操作活动和变更，可以实现端到端的可追溯性，这些信息可以提供给安全团队，用来配合相关合规审核工作。&lt;/li>
&lt;li>混合云管理：能在混合云的架构里，自动化地制备应用，包括AWS公有云环境，能实现多层应用和分布式应用的弹性扩缩容。Calm能全局统计资源用量，让您对公有云的实际消费成本一目了然，方便您按照业需求和预算做出合理的决策。&lt;/li>
&lt;/ul>
&lt;p>Nutanix Calm的蓝图编辑器如下所示。&lt;/p>
&lt;p>&lt;img src="http://res.cloudinary.com/martinliu/image/upload/blueprint.png"
loading="lazy"
alt="Nutanix Calm Blueprint"
>&lt;/p>
&lt;p>在我的&lt;a class="link" href="https://nutanix.martinliu.cn/" target="_blank" rel="noopener"
>Nutanix实验室：&lt;/a>文档站点里已经写了一些操作使用的方法和产品截图。如果您已经是Nutanix用户了，请参考和使用这些文档。如果你还不是的话，可以联系Nutanix试用这个产品。&lt;/p>
&lt;hr>
&lt;p>后续会持续更新这一部分，会根据DevOps的逻辑将Nutanix Calm的能力全面的展示出来，敬请期待。&lt;/p>
&lt;h2 id="使用nutanix实现完美的docker-datacenter体验">使用Nutanix实现完美的Docker Datacenter体验
&lt;/h2>&lt;p>CaaS on IaaS的简洁实现方式莫过于在Nutanix超融合平台上部署Docker Datacenter产品。其实Docker Datacenter还是一个很容易使用的Docker平台，易用性非常好，入门级Docker用户建议走这条路试试，毕竟K8s的学习曲线目前还比较陡峭。&lt;/p>
&lt;p>这个组合的免费试用方法：&lt;/p>
&lt;ol>
&lt;li>安装部署Nutanix CE（文档见Nutanix实验室）&lt;/li>
&lt;li>申请和下载Docker Datacenter的安装包和许可证文件（10个节点免费试用，30天到期了还可以无限次延续）&lt;/li>
&lt;li>在Nutanix上创建10个虚拟机用于部署Docker Datacenter&lt;/li>
&lt;li>安装部署Docker Datacenter （&lt;a class="link" href="https://nutanix.martinliu.cn/04-nucalm-advance/02-owncloud-dvp/" target="_blank" rel="noopener"
>文档见Nutanix实验室&lt;/a>）&lt;/li>
&lt;li>Enjoy it forever!&lt;/li>
&lt;/ol>
&lt;p>如果你使用4台物理服务器安装Nutanix CE，建议的服务器配置：2路20核 Intel XeonCPU，内存256，SSD 512GB一块，SAS HDD 4TB两块；这样形成的群集的总资源量：&lt;/p>
&lt;ul>
&lt;li>160个物理CPU核，一个物理核跑两个虚拟机的话，你可以跑320个虚拟机；当然内存够的情况下，你还可以尝试更高的整合比，如1个物理的核带5到10个虚拟机&lt;/li>
&lt;li>总存储空间为18TB，使用两副本存数据，你有9TB可用空间，打开去重压缩等功能的话你可以拥有更多的存储空间。&lt;/li>
&lt;li>2TB的SSD存储可以让你应付大量的热数据，所有热数据相当于使用了全闪存储一般。&lt;/li>
&lt;li>建议这些服务器使用10GB或更高速的以太网，以保证更优雅的性能&lt;/li>
&lt;li>不建议这个环境跑生产负载，记住不要把研发环境不算生产负载。&lt;/li>
&lt;li>如果需要生产级别的保障，请考虑使用费CE版本的正式Nutanix产品。&lt;/li>
&lt;/ul>
&lt;h2 id="使用nutanix-acs20实现完美的k8s体验">使用Nutanix ACS2.0实现完美的K8s体验
&lt;/h2>&lt;p>此产品预计18年发布，敬请期待。&lt;/p></description></item><item><title>Devops Handbook《DevOps实践指南》简介</title><link>https://martinliu.cn/blog/devops-handbook/</link><pubDate>Sun, 25 Feb 2018 22:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/devops-handbook/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/IT_Revolution_press.png" alt="Featured image of post Devops Handbook《DevOps实践指南》简介" />&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/TMNS-book-review-DevOps-1.png"
loading="lazy"
alt="本文内容主要来源"
>&lt;/p>
&lt;p>企业如何通过DevOps实践提高盈利能力，改善工作文化，实现卓越的生产力目标。如今这些高绩效管理技术比以往的任何时候都要更加重要，由于这对于企业的商业竞争力而言是至关重的，数十年以来，技术组织的领导者们始终在努力地维持这IT系统的敏捷性、可靠性和安全性。然后惨痛的案例依然比比皆是&amp;ndash;不论是healthcare.gov的崩溃，持卡人数据的泄露；还是在云计算环境中大数据的丢失。&lt;/p>
&lt;p>然而，那些运用DevOps原则的高绩效企业（例如Google，Amazon，Facebook，Etsy和Netflix）则每天都可以在生产环境中成百上千次频繁地部署代码。那么DevOps理论、原则和实践到底是何等的殊胜呢？相信所有人在看了本书之后一定会得到答案。&lt;/p>
&lt;h2 id="通过数字看这本书">通过数字看这本书
&lt;/h2>&lt;h3 id="基础数据">基础数据
&lt;/h3>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/devops-handbook-by-number.png"
loading="lazy"
alt="本文内容主要来源"
>&lt;/p>
&lt;h3 id="原作者4人">原作者4人
&lt;/h3>&lt;p>Jene Kim是这本书的主要作者，他在出版了《凤凰项目》之后，开始与其他三位作者编写本书的。Jez Humble是《持续交付》的作者，是持续交付实践和概念的重要发起人。Patrick Debios是DevOpsDays大会的发起人，是他最早在Twiter是用 #DevOps 这个短标签的，是DevOps运动和社区的重要人物。John Willis是DevOps社区早期的推动者之一，曾任Docker公司生态系统发展总监。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/handbook-AUTHORS.png"
loading="lazy"
alt="authors"
>&lt;/p>
&lt;h3 id="译者4人">译者4人
&lt;/h3>&lt;p>在我和人民邮电出版社联系并进行试译之后，组织了翻译小组。王磊和马博文是我这几年结识的DevOps圈内的技术大拿；曾朝京是IT管理领域的资深专家，是我的前同事。王磊的著作有&lt;a class="link" href="https://www.amazon.cn/dp/B018SRCFI6/" target="_blank" rel="noopener"
>《微服务架构与实践》&lt;/a>；马博文翻译的书籍有&lt;a class="link" href="https://www.amazon.cn/dp/B01LWLRQF3/" target="_blank" rel="noopener"
>《DevOps 实践》&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/devops-handbook-translator.png"
loading="lazy"
alt="translator"
>&lt;/p>
&lt;blockquote>
&lt;p>刘征，Nutanix路坦力资深架构师。Exin首批国内DevOps Master和DevOps Professional认证讲师。持有红帽RHCA认证和AWS高级架构师认证。谙熟企业数据中心的IT服务管理。目前致力于推广DevOps相关的理念和实践，在DevOps社区中积极地参与培训和研讨会等活动，DevOpsDays大会活动在中国的核心组织者。&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>王磊，前ThoughtWorks首席咨询师，EXIN首批国内DevOps Master认证教练。较早倡导和实践微服务的先行者，著有国内首本微服务架构相关书籍《微服务架构与实践》一书。超过10年以上的软件行业经验，对服务化架构、持续交付以及DevOps转型等有丰富的实践经验，同时他也是西安DevOpsMeetup联合发起人，西安GDCR组织者，并译有《Ruby Gems开发实战》一书。&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>马博文, 前ThoughtWorks 高级咨询师，AWS助理架构师。曾从事多年web开发和DevOps，熟悉持续交付，微服务。参与翻译《Scala编程实战》、《DevOps实践》等书，是西安DevOps Meetup活动的发起人。&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>曾朝京，Micro Focus资深解决方案顾问，参加Exin首批国内Devops Master讲师认证培训。长期从事IT运维管理领域咨询工作，曾为能源、金融、航空运输、政府行业中的多个大型企业提供 IT 运维管理规划。目前致力于探索Devops理念在企业IT部门的实践。&lt;/p>&lt;/blockquote>
&lt;p>翻译小组完成翻译，并提交给出版社的日期是2017年12月8日。&lt;/p>
&lt;h2 id="目录提前曝光">目录提前曝光
&lt;/h2>&lt;p>本书目前（本文的发布日期）正处于出版社编辑阶段。预计在五月份左右正式出版。下面是本书的目录。&lt;/p>
&lt;ul>
&lt;li>序言&lt;/li>
&lt;li>前言&lt;/li>
&lt;li>导言：展望DevOps新世界&lt;/li>
&lt;li>第一部分 三步工作法
&lt;ul>
&lt;li>第1章 敏捷、持续交付和三步法&lt;/li>
&lt;li>第2章 第一步，流动原则&lt;/li>
&lt;li>第3章 第二步，反馈原则&lt;/li>
&lt;li>第4章 第三步，持续学习与实验原则&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>第二部分 从何处开始
&lt;ul>
&lt;li>第5章 选择合适的价值流作为切入点&lt;/li>
&lt;li>第6章 理解、可视化和运用价值流&lt;/li>
&lt;li>第7章 参考康威定律设计组织结构&lt;/li>
&lt;li>第8章 将运维融入日常开发工作&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>第三部分 第一步：流的技术实践
&lt;ul>
&lt;li>第9章 为部署流水线奠定基础&lt;/li>
&lt;li>第10章 实现快速可靠的自动化测试&lt;/li>
&lt;li>第11章 应用和实践持续集成&lt;/li>
&lt;li>第12章 自动化和低风险发布&lt;/li>
&lt;li>第13章 降低发布风险的架构&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>第四部分 第二步：反馈的技术实践
&lt;ul>
&lt;li>第14章 建立能发现并解决问题的遥测系统&lt;/li>
&lt;li>第15章 分析遥测数据以更好地预测故障和实现目标&lt;/li>
&lt;li>第16章 应用反馈实现安全部署&lt;/li>
&lt;li>第17章 将假设驱动的开发和A/B测试融入日常工作&lt;/li>
&lt;li>第18章 建立评审和协作流程以提升当前工作的质量&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>第五部分 第三步：持续学习与实验的技术实践
&lt;ul>
&lt;li>第19章 将学习融入每天的工作中&lt;/li>
&lt;li>第20章 将局部经验转化为全局改进&lt;/li>
&lt;li>第21章 预留组织学习和改进的时间&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>第六部分 集成信息安全、变更管理和合规性的技术实践
&lt;ul>
&lt;li>第22章 将信息安全融入每个人的日常工作&lt;/li>
&lt;li>第23章 保护部署流水线&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>行动起来 - DevOps手册总结&lt;/li>
&lt;li>附录&lt;/li>
&lt;li>附加资源&lt;/li>
&lt;/ul>
&lt;p>以上目录标题有可能在出版社的编辑过程中会有所调整。不过已经可以看出其主要内容。&lt;/p>
&lt;h2 id="来自出版社-it-revolution-press-october-6-2016">来自出版社-IT Revolution Press (October 6, 2016)
&lt;/h2>&lt;p>&lt;img src="http://res.cloudinary.com/martinliu/image/upload/q_auto:eco/handbook-1.jpg"
loading="lazy"
alt="DevOps Handbook"
>&lt;/p>
&lt;p>&lt;a class="link" href="https://itrevolution.com/book/the-devops-handbook/" target="_blank" rel="noopener"
>IT Revolution Press&lt;/a>是 &lt;em>DevOps Handbook&lt;/em> 一书的的出版社，位于美国的波特兰市。这本书的简体中文版的书名是《DevOps实践指南》，它是作者继《凤凰项目》之后的一个重大作品，它向你展示了如何将产品经理、开发、质量保证、IT运维和信息安全集成在一起，从而帮助你提升企业的竞争力并赢得市场；如何复制前人那些惊人的DevOps经验成果。&lt;/p>
&lt;p>那么《DevOps实践指南》是否适合你？本书的作者Gene Kim、Jez Humble、Patrick Debois和John Willis为那些希望对IT组织进行转型的人共同编写了此书；特别是为那些想通过DevOps实际进行重大的变革，从而提高生产力、盈利能力并赢得市场的人。这本书涉及DevOps转型的很多方面，是一本从规划到实操的全方位指南，同时它还介绍了DevOps的历史背景，支撑DevOps的各种原则，以及数十个DevOps案例研究。它还提供了各种最佳实践，能有助于组织团结团队一心，使他们实现共同目标，同时获得高层领导支持。&lt;/p>
&lt;p>《DevOps实践指南》深入地研究了DevOps的三个基本原则，现在我们称其为“DevOps工作三步法”，它们是流动、反馈、持续学习与实验”。 《DevOps实践指南》是Gene Kim继《凤凰项目》一书之后编写的，在那本书里也对“三步法”作了概括的描述，后来发展成为本书第一部分的重要内容。&lt;/p>
&lt;p>随着本书循序渐进地揭示DevOps工作三步法，读者将能够清晰的了解到，那些高绩效公司是如何利用这些原则取得成功的。希望任何大型组织也能够复制这些高绩效企业所使用过的成功经验，从而指导他们自己也进行一场成功的DevOps转型。本书用六个部分描述了详实的内容，其中包括：&lt;/p>
&lt;ul>
&lt;li>在五年时间里，4位合著者为本书投入了2000多小时的工作时间&lt;/li>
&lt;li>40多个DevOps案例研究，包括亚马逊，Etsy，Capital One，Google，Facebook，Intuit，Nationwide保险等等&lt;/li>
&lt;li>编写了长达400多页的DevOps实践指南、经验总结和工作指导。&lt;/li>
&lt;li>参考和使用来来自25,000多个数据收集点的DevOps相关数据。&lt;/li>
&lt;/ul>
&lt;p>《Phoenix项目》（英文版）已经售出35万本，2018年2月进行了第五次印刷。《DevOps实践指南》从DevOps的历史开始讲起，解释了它是怎样从数十年的相关联的知识体系中发展出来的，以及由此应运而生的相关技术、架构和文化实践。在为读者奠定了这些历史基础后，读者就能够深入了解三步工作法的原则了。读者将逐步对当今的DevOps相关理论和原则有更深入的理解。在本书的相关章节里介绍了各种具体原则和模式，以及如何将它们应用在实际的技术价值流中。&lt;/p>
&lt;p>我们很自豪的宣布 DevOps Handbook - 《DevOps实践指南》获得了2016年，年度DevOps最佳图书奖，详见：&lt;a class="link" href="https://devops.com/the-2016-devops-dozen-winners-announced/" target="_blank" rel="noopener"
>https://devops.com/the-2016-devops-dozen-winners-announced/&lt;/a>&lt;/p>
&lt;h2 id="在亚马逊书网上书店">在亚马逊书网上书店
&lt;/h2>&lt;p>本书的英文版本在亚马逊有三种格式：Kindle、纸质印刷版和有声书版本。这本书的排名和评价如下，下图的抓取时间是：2018-2-25。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/handbook-rank.png"
loading="lazy"
alt="排名"
>&lt;/p>
&lt;ul>
&lt;li>在信息管理分类里排名：7&lt;/li>
&lt;li>在流程和基础架构里排名：107&lt;/li>
&lt;li>在管理书籍里排名：111&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/handbook-reviews.png"
loading="lazy"
alt="书评"
>&lt;/p>
&lt;p>有85%的读者给本书了5星的评价。关于这本书在亚马逊的最新状态，&lt;a class="link" href="https://www.amazon.com/DevOps-Handbook-World-Class-Reliability-Organizations/dp/1942788002/ref=tmm_pap_swatch_0?_encoding=UTF8&amp;amp;qid=&amp;amp;sr=" target="_blank" rel="noopener"
>请点这里。&lt;/a>&lt;/p>
&lt;p>本书的日文版是在2017年6月在日本发布的，&lt;a class="link" href="http://amzn.asia/2Yqn47O" target="_blank" rel="noopener"
>详情见日本亚马逊网站&lt;/a>。&lt;/p>
&lt;h2 id="本书的使用方式">本书的使用方式
&lt;/h2>&lt;p>在上一篇文章《DevOps登山指南》里我分析和介绍了美国金融行业Nationwide保险公司的DevOps案例，&lt;a class="link" href="https://martinliu.cn/posts/devops-climbing-guide/" target="_blank" rel="noopener"
>原文点这里&lt;/a>。这家公司在实施DevOps的过程中将本书做为参考指南，所有DevOps团队通过每周一次的读书会的方式，持续地对照和改进自己的DevOps实践状态。他们总结出来的DevOps项目实施指南如下图所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/devops-climbing-guide.jpg"
loading="lazy"
alt="DevOps登山指南手册"
>&lt;/p>
&lt;p>本图在Nationwide公司内部的使用场景如下：&lt;/p>
&lt;ol>
&lt;li>本图将DevOps实施核心团对指导产品开发团队（也可以说是业务团队、服务团队、这样的团队他们有200多个）取得的经验总结在一张纸上，供其它有实施DevOps想法的团队参考。&lt;/li>
&lt;li>该登山指南简化了对其它非DevOps团队的教育和指引。&lt;/li>
&lt;li>他们将DevOps的实施分成三个阶段，分别用大本营、北坡营地和顶峰作比喻。&lt;/li>
&lt;li>这三个阶段里的技术实践都来自于DevOps Handbook，通过他们的筛选和整理，并根据自己的经验做了分阶段的规划。&lt;/li>
&lt;/ol></description></item><item><title>DevOps工作三步法：第一步流动原则</title><link>https://martinliu.cn/blog/devops-first-way-flow/</link><pubDate>Wed, 21 Feb 2018 23:10:01 +0800</pubDate><guid>https://martinliu.cn/blog/devops-first-way-flow/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/IT_Revolution_press.png" alt="Featured image of post DevOps工作三步法：第一步流动原则" />&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/TMNS-book-review-DevOps-1.png"
loading="lazy"
alt="本文内容主要来源"
>&lt;/p>
&lt;p>本文内容主要来源于《DevOps Handbook》-DevOps实践指南，本文概述的原则是DevOps工作三步法的第一步，它的目标是先建立最底层的基础，即：DevOps技术实践和合理的应用架构；只有这样才能使工作快速而稳定地从开发端流动到运维端；与此同时还能保证不会给生产环境带来混乱，不会中断客户的服务。这就意味着需要降低在生产环境中部署和发布变更的风险。可以通过 &lt;em>持续交付&lt;/em> 的技术实践来实现这个目标。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/first_way.png"
loading="lazy"
alt="The first way flow"
>&lt;/p>
&lt;p>持续交付基于稳定的自动化部署流水线，团队能够使用自动化测试持续验证代码，确保代码始终处于可部署的状态，开发人员要保证每天都向主干提交代码，以及设计和实现有利于实施低发布风险的环境和软件架构。&lt;/p>
&lt;p>在流动原则的指导下，需要开展的重要的工作内容如下：&lt;/p>
&lt;ul>
&lt;li>奠定部署流水线的基础&lt;/li>
&lt;li>实现快速、可靠的自动化测试&lt;/li>
&lt;li>实现并实践持续集成和持续测试&lt;/li>
&lt;li>通过自动化、架构解耦等方式实现低风险发布&lt;/li>
&lt;/ul>
&lt;p>以上技术实践能够有效地缩短创建类生产环境的前置时间。同时，持续测试可以为所有团队成员提供快速的反馈，使小型团队能够安全、独立地开发、测试和向生产环境部署代码，从而将生产环境的部署和发布作为日常工作的一部分。&lt;/p>
&lt;p>此外，通过将QA人员和运维人员的任务集成到DevOps实施团队的日常工作中，能够减少救火、困境以及繁琐的重复劳动的发生，使团队成员的工作高效且充满乐趣。这不仅能提升团队的工作质量，还能提高组织的竞争力。&lt;/p>
&lt;p>流动原则相关的详细技术实践请参考请《DevOps实践指南》一书的第三部分，这部分包含第10章到第13章，一共描述了5个技术实践。&lt;/p>
&lt;p>在流动原则里我们强调的而是全局的目标而不是局部的目标，局部目标的例子如下所示：&lt;/p>
&lt;ul>
&lt;li>特性开发完成率&lt;/li>
&lt;li>测试发现/修复缺陷的比例&lt;/li>
&lt;li>运维的可用性指标&lt;/li>
&lt;/ul>
&lt;p>我们需要减少价值流中的工作交接的次数，由于当交接次数多到一定程度时，所有人就会彻底的迷失，无法回答工作的上下文联系是什么？也不清楚我们要解决的是什么问题？或者组织的全局目标是什么？&lt;/p>
&lt;h2 id="价值流的应用实例">价值流的应用实例
&lt;/h2>&lt;p>如果我们选择做DevOps转型的项目是棕地项目，我们就需要对当前的工作，进行细致的值流研讨和分析；需要画出当前的状态。如下图的示例所示（注：这是一个示例，你的棕地项目分析完之后并非如此）。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/VSM-As-Is.jpg"
loading="lazy"
alt="VSM as is"
>&lt;/p>
&lt;p>为了在实施DevOps的过程中持续的度量和改进，我们需要分析出当前价值流的核心定量指标：&lt;/p>
&lt;ol>
&lt;li>总计前置时间 = 求和价值流中每个工作步骤里的LT 【这个指标是DevOps项目的北极星】&lt;/li>
&lt;li>总计增值时间 = 求和值流中每个工作步骤里的VA&lt;/li>
&lt;li>完成且精确百分比 = 连乘值流中每个工作步骤的%C/A&lt;/li>
&lt;/ol>
&lt;p>如果是绿地项目，我们在第一个工作周里，价值流图是没有这些数值的。我们需要每天都在CI/CD流水线工具中采集相关数据，在每个人的日常工作中关注和记录相关数据，在第二周和后续的每一周里度量和分析以上指标，最好用仪表板展示工具，将这些数据实时地显示在所有项目组成员都可以轻松看到的位置。&lt;/p>
&lt;p>对这个价值流进行持续的优化，使它更高效的工作，并不断的进化和改进。如果是棕地项目，那么在分析完以上的机制流之后，可以定制新的进化版的价值流图，并按照新版本的价值流图重新开始项目的执行。如下图的示例所示（注：这是一个示例，你的棕地项目改进优化完之后并非如此）。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/VSM-To-Be.jpg"
loading="lazy"
alt="VSM as is"
>&lt;/p>
&lt;h2 id="优化和改进日常工作">优化和改进日常工作
&lt;/h2>&lt;h3 id="goldratt博士的约束理论toc">Goldratt博士的约束理论(TOC)
&lt;/h3>&lt;p>在实践运用流动原则的技术实践时，可以使用Goldratt博士给出的方法，随时识别并解决价值流中的约束点，这个五步法如下：&lt;/p>
&lt;ul>
&lt;li>识别系统的约束点。&lt;/li>
&lt;li>决定如何利用这个系统约束点。&lt;/li>
&lt;li>基于上述决定，考虑全局工作。&lt;/li>
&lt;li>改善系统的约束点。&lt;/li>
&lt;li>如果约束点已经突破了，请回到第一步，但要杜绝惯性导致的系统约束。&lt;/li>
&lt;/ul>
&lt;p>以上五步法是DevOps实施项目组日常工作的必备流程优化工具。&lt;/p>
&lt;h3 id="常见的4个约束点">常见的4个约束点
&lt;/h3>&lt;p>传统企业或者团队里最容易发生的约束点有一定的共性，一般可能会按照以下顺序逐个攻克和优化：&lt;/p>
&lt;ol>
&lt;li>环境搭建&lt;/li>
&lt;li>代码部署&lt;/li>
&lt;li>测试的准备和执行&lt;/li>
&lt;li>紧密耦合的架构&lt;/li>
&lt;/ol>
&lt;p>可以清楚的看到大多数约束点比较偏Ops这一侧，而攻克所有这些约束点需要Dev和Ops一起协作完成。&lt;/p>
&lt;h3 id="常见的9中浪费">常见的9中浪费
&lt;/h3>&lt;p>在DevOps工作团队里需要尽快能地避免以下浪费现象的发生：&lt;/p>
&lt;ul>
&lt;li>半成品&lt;/li>
&lt;li>额外/多余工序&lt;/li>
&lt;li>额外/多余功能&lt;/li>
&lt;li>任务切换&lt;/li>
&lt;li>等待&lt;/li>
&lt;li>移动&lt;/li>
&lt;li>缺陷&lt;/li>
&lt;li>非标准或手工操作&lt;/li>
&lt;li>填坑侠&lt;/li>
&lt;/ul>
&lt;p>以上浪费现象最早是从制造行业的精益管理中总结出来的，这些也是完全可以应用到技术价值流中，IT相关的工作能对每一条有很多痛点清晰的解读，你可以尝试在自己的工作环境中寻找以上所有浪费现象。&lt;/p>
&lt;h2 id="devops工作三步工作法-in凤凰项目">DevOps工作三步工作法 in《凤凰项目》
&lt;/h2>&lt;p>在本书中，我们阐述了这一基础原理，即所有开发运维模式都来自“三步工作法”，它旨在阐明指导开发运维的流程与实践的价值观与理念。&lt;/p>
&lt;p>&lt;strong>第一工作法&lt;/strong>是关于从开发到IT运维再到客户的整个自左向右的工作流。为了使流量最大化，我们需要小的批量规模和工作间隔，绝不让缺陷流向下游工作中心，并且不断为了整体目标（相对于开发功能完成率、测试发现/修复比率或运维有效性指标等局部目标）进行优化。&lt;/p>
&lt;p>必要的做法包括持续构建、集成以及部署，按需创建环境，严控半成品，以及构建起能够顺利变更的安全系统和组织。&lt;/p>
&lt;p>&lt;strong>第二工作法&lt;/strong>是关于价值流各阶段自右向左的快速持续反馈流，放大其效益以确保防止问题再次发生，或者更快地发现和修复问题。这样，我们就能在所需之处获取或嵌入知识，从源头上保证质量。&lt;/p>
&lt;p>“必要的做法包括：在部署管道中的构建和测试失败时“停止生产线”；日复一日地持续改进日常工作；创建快速的自动化测试套装软件，以确保代码总是处于可部署的状态；在开发和IT运维之间建立共同的目标和共同解决问题的机制；建立普遍的产品遥测技术，让每个人都能知道，代码和环境是否在按照设定的运行，以及是否达到了客户的目标。&lt;/p>
&lt;p>&lt;strong>第三工作法&lt;/strong> 是关于创造公司文化，该文化可带动两种风气的形成：不断尝试，这需要承担风险并从成功和失败中吸取经验教训；理解重复和练习是熟练掌握的前提。”&lt;/p>
&lt;p>“尝试和承担风险让我们能够不懈地改进工作系统，这经常要求我们去做一些与几十年来的做法大不相同的事。一旦出了问题，不断重复的日常操练赋予我们的技能和经验，令我们可以撤回至安全区域并恢复正常运作。&lt;/p>
&lt;p>必要的做法包括营造一种勇于创新、敢于冒险（相对于畏惧或盲目服从命令）以及高信任度（相对于低信任度和命令控制）的文化，把至少20%的开发和IT运维周期划拨给非功能性需求，并且不断鼓励进行改进。”&lt;/p>
&lt;p>From: [美] 金（Gene Kim ），[美] 贝尔（Kevin Behr），[美] 斯帕福德（George Spafford）. “凤凰项目一个IT运维的传奇故事.”。&lt;/p></description></item><item><title>DevOps登山指南</title><link>https://martinliu.cn/blog/devops-climbing-guide/</link><pubDate>Tue, 20 Feb 2018 00:34:09 +0800</pubDate><guid>https://martinliu.cn/blog/devops-climbing-guide/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/q_auto:eco/Evest.jpg" alt="Featured image of post DevOps登山指南" />&lt;p>美国金融行业Nationwide保险公司DevOps案例研究，来源DOES17 San Francisco，主题-DevOps Handbook Experiments in Accelerating Delivery&lt;/p>
&lt;p>全美互惠保险公司(Nationwide)美国公司。在2017年6月7日，《财富》2017年美国500强排行榜发布，全美互惠保险公司排名第68位。营业收入40074.1百万美元。&lt;/p>
&lt;p>这家公司是DevOps Handbook（DevOps实践指南）书中的案例研究之一。这是一家DevOps水平较高的企业，是DevOpsDays大会上分享嘉宾的常客，也是各个DevOps工具厂商（New Relic）经常邀请的案例分享嘉宾。他们也经常参加DevOps企业峰会，曾多次做过自己的DevOps应用状况案例分享。&lt;/p>
&lt;p>本文分析和整理了他们在2017年11月旧金山站DevOps企业峰会上他们的演讲，主题为《DevOps Handbook Experiments in Accelerating Delivery - Nationwide》（翻译：使用DevOps Handbook在加速开发交付的过程中的实验）&lt;/p>
&lt;p>本文根据这个演讲的YouTube视频整理而成。视频已经上传到腾讯视频，&lt;a class="link" href="https://v.qq.com/x/page/v0555haemus.html" target="_blank" rel="noopener"
>点这里观看该视频。&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="devops登山指南手册">DevOps登山指南手册
&lt;/h2>&lt;p>我在翻译DevOps Handbook的过程中，感觉书中所描述的这家公司的案例研究，并不像本演讲里所说的这样的精彩。&lt;/p>
&lt;p>而时光已经很快的流转到了将近2018年，他们的DevOps也经过了几年的发展，本文案例向我们展示了一个金融行业（我们往往认为不太容易实施DevOps的行业）企业，在很大的企业规模了，所取得的令人敬佩的成就。&lt;/p>
&lt;p>下面这张图是本文的精华，先给各位呈现出来。他们使用攀登珠穆朗玛峰做为比喻，对DevOps的实施做了生动的诠释。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/devops-climbing-guide.jpg"
loading="lazy"
alt="DevOps登山指南手册"
>&lt;/p>
&lt;p>本图在Nationwide公司内部的使用场景如下：&lt;/p>
&lt;ol>
&lt;li>本图将DevOps实施核心团对指导产品开发团队（也可以说是业务团队、服务团队、这样的团队他们有200多个）取得的经验总结在一张纸上，供其它有实施DevOps想法的团队参考。&lt;/li>
&lt;li>该登山指南简化了对其它非DevOps团队的教育和指引。&lt;/li>
&lt;li>他们将DevOps的实施分成三个阶段，分别用大本营、北坡营地和顶峰作比喻。&lt;/li>
&lt;li>这三个阶段里的技术实践都来自于DevOps Handbook，通过他们的筛选和整理，并根据自己的经验做了分阶段的规划。&lt;/li>
&lt;/ol>
&lt;p>为了知其所以然，我们将继续向下发掘，详细了解这个案例分享所讲的主要内容。下面的内容也包含了我对他们的分析和评论，欲了解原始资料，请请参看我上传到腾讯的视频。&lt;/p>
&lt;hr>
&lt;h2 id="主题devops-handbook-在加速交付中的各种实验">主题：DevOps Handbook-在加速交付中的各种实验
&lt;/h2>&lt;p>分享者介绍。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-001.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;p>这个演讲距2018年2月也就是三个月，还算是很新鲜的一个案例。Cindy是DevOps团队中的核心人员之一，她的头衔是Director，角色是夏尔巴人（后面会详细解释这个比喻的含义），为业务产品组提供内部的DevOps咨询和辅导。Jim属于业务条线/BU的Dev这一侧，他是业务部门的解决方案架构师。&lt;/p>
&lt;h2 id="nationwide的核心价值保护对你最有价值的">Nationwide的核心价值：保护对你最有价值的
&lt;/h2>&lt;p>公司简介和状况。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-002.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>在很多险种上Nationwide都在业内排名第一名，包括：宠物保险、农场保险、公司寿险等等。&lt;/li>
&lt;li>这是一家有90年历史的老店&lt;/li>
&lt;li>汽车保险也行业排名第八（后面就是用这个业务为例，来佐证DevOps实施的效果）&lt;/li>
&lt;li>不光在财富500强企业排名68，还是财富所评选的前100个最佳的工作企业。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="nationwide-it的规模很大">Nationwide IT的规模很大
&lt;/h2>&lt;p>IT组织的特点和相关数据。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-003.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>IT组织庞大，结构复杂，业务条线众多&lt;/li>
&lt;li>在选择应用某个DevOps实践的时候，总是要考虑到规模因素，需要评估该实践是否能在200多个业务开发团队的规模上全面地推广和实施&lt;/li>
&lt;li>IT人员总数超过5100人，其中程序员和测试人员的数量超过2600人；在电脑世界的IT最佳工作地点的排行帮上位居第51名&lt;/li>
&lt;li>该公司有用200多个产品开发团队，他们服务于23个业务部门BU&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="nationwide-it的组织结构">Nationwide IT的组织结构
&lt;/h2>&lt;p>典型、复杂和庞大的组织结构&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-004.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>I&amp;amp;O是基础架构和操作运维团队，该组织不仅运维了所有的IT服务，还服务于所有的业务开发团队。&lt;/li>
&lt;li>多个共享服务团队提供企业级的共享服务，包括Scrum测试等传统开发服务，同时也为企业内部的DevOps实践提供技术咨询，他们支持所有类型的企业应用堆栈&lt;/li>
&lt;li>业务部门如前所述有23个，有200多个开发团队，Jim服务于金融业务BU&lt;/li>
&lt;li>该公司的架构模型近似于典型的Dev、QA和Ops架构；他们的Ops组织也是集中式的；如此复杂的架构带来了DevOps流水线的复杂度方面的挑战，为某个业务BU实施的持续交付流水线会横跨多个BU，有时候甚至需要三个BU的CIO级别领导一起来参与决策，这里也会出现项目投资方和项目决策方不统一的难题。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="从哪里开始">从哪里开始
&lt;/h2>&lt;p>应用DevOps的企业环境背景和定位。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-005.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>IT组织十年以来追求的战略目标：构建具有全球竞争力的内包式软件开发能力；为此而采用了不同的管理框架和实践，应用和开始的时间点也不同
&lt;ul>
&lt;li>Agile：敏捷软件开发是10年前就开始的，定位和目标是通过敏捷软件开发交付高质量的软件&lt;/li>
&lt;li>DevOps：今年加入了DevOps实践，定位是如何实现速度、效率和降低风险。&lt;/li>
&lt;li>Lean IT：定位是确保将IT管理的各种实践（包括以上的敏捷和DevOps）提升和推广到企业级规模。（他们认为在团队级别上任何敏捷和DevOps相关的实践都是很容易实现的，而企业级规模的推广是更高等级的管理，是不容易达到的）&lt;/li>
&lt;li>CMMI：使用行业规范的软件开发成熟度标准评价和考量自身的软件开发能力，为自身的不断提高提供标准参考。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>该公司DevOps实践是最晚开始应用的，其它的三个方面使用的历史比较长了，为了达成一个战略目标，需要4个战术层面实践的支持，这些战术的采用时期和定位不同；4个战术从不同的侧面支持了战略目标的实现。该企业也在Lean IT的论坛上分享和演讲过。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="从哪里开始续">从哪里开始（续）
&lt;/h2>&lt;p>应用DevOps的时间轨迹和历程，各个时期的关键词。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-006.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>2015-简化：DevOps小屋是入手DevOps实践时，最早使用过的参考框架；他们分析梳理了所有相关的方法论；工具方面专注在部署工具的改进上，所有产品线采用了IBM UrbanCode作为统一的部署工具；可是这个阶段接触的实践还是比较庞杂。&lt;/li>
&lt;li>2016-组织：在获得了高层领导的支持以后，他们同时在三个方向出击：软件开发模型、精益IT管理和供应链管理；在三个方面都直接提高和优化了DevOps的速度。&lt;/li>
&lt;li>2017-实验：在取得了天时地利人和之后，他们展开了所谓的“双模实验”的实践道路；从业务需求入手（规划了使用了MMP最小化可市场产品的概念），逐渐抛开了纷繁复杂的实践和方法论，他们开始聚焦在了“程序员体验”上，通过各种实验验证DevOps Handbook中描述的实践是如何影响并提升他们的。孵化和实验各种DevOps Handbook书里的实践。&lt;/li>
&lt;li>2018-促动：如何把相关的工具推广到200多个开发团队，如何引入Google的SRE模型，将交付流水线作为产品对待，在复杂的组织中，实施跨部门的流水线的挑战依旧不轻。&lt;/li>
&lt;li>该公司的DevOps实践道路是一步一个台阶的持续改进过程，经历了三年多时间，每个阶段的关键词代表了他们的成果和挑战。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="devops团队间的交互模型">DevOps团队间的交互模型
&lt;/h2>&lt;p>【重点】团队组织结构和交互方式。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-007.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>这是实验各种DevOps实践的团队组织模型，开展每项DevOps实践都遵循PDCA的持续改进方法。&lt;/li>
&lt;li>所有团队遵循着三个基础原则：1速度，江湖武功唯快不破，这是他们清醒而简单的唯一追求目标，成为检验所有优化改进的唯一验收标准和条件。2实践者之成功，他们做的并不是自顶向下的、政令式的强推，而是让参与DevOps实践的团队自己提出工作想法，自己来决定在哪里尝试改进能提升速度。3范围，从端到端的价值流全局看，既不推崇极左的做法，也不推崇极右的做法，他们将范围限定在，从一张工作卡片进入DevOps产品代办工作（Backlog）开始，直至将它的成果发布到生产环境中。&lt;/li>
&lt;li>实施“双模实验”团队的模型，两个团队都提出自己想做的实验想法，双方的工作内容都汇总到一个集中的DevOps产品代办工作队列中，每一项工作/卡片都是一项实验，每一项实验都由两个团队分别完成，A/B团队的做法和实现结果可能不同，这样也自然地应用到了A/B测试的模型。&lt;/li>
&lt;li>DevOps Leadership Team团队里是Cindy和Jim所在的团队（应该是一个虚拟团队组织），他们确保所有代办工作都遵循以上的三个基础原则，另外使用系统性思考来确保每种实验如果取得了成功，在推敲是否它能推广并应用到其它的200多个开发团队。&lt;/li>
&lt;li>DevOps平台团队辅助和优化双模实验团队的工作，例如双模团队可能都需要自动化变更流程（ITSM的管理范畴）的API，而这些工作就可以踢给平台团队做，平台团队负责设计实现这个API，并且保证它具有企业级规模的能力，然后交付双模团队使用即可。&lt;/li>
&lt;li>治理团队是由该公司的各个CIO级别的利益干系人组成的，上文说过某些复杂的DevOps持续交付流水线会跨三个以上的部门，这些BU的大佬会在这个团队中；他们在每个迭代都会出现在双模团队的工作现场，一起现场查看状况，现场解决问题。Jim认为他们亲自临场观察和了解实验工作的效果，远远比将实验成果作出PPT后再给他们去汇报的效果要好。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="epic史诗">EPIC史诗
&lt;/h2>&lt;p>【重点】DevOps团队根据Handbook为基础，提出了所有想实验的工作内容。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-008.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>开发团队从寻找什么拖慢了速度出发，寻找优化和改进工作内容的方法，在渐梳理和过滤以后，发现最后确定要做的工作都可以在Handbook中得到确认。甚至有些人在讨论某个工作条目的时候，能清晰的告诉大家可以参考Handbook书中的章节和页数。&lt;/li>
&lt;li>DevOps产品代办工作里的EPIC史诗工作必须是在Handbook书中能够出现和参考到的，如果不是的话，团队可能会对它表示质疑。&lt;/li>
&lt;li>这里Cindy简述了自动化测试这项工作的实验，故事是这样的：开发团队自己描述到，当前的Test Bed已经大到不可管理的程度，测试运行的时间太长了，因此不能保持测试的精简和有效性，这样的情况持续了一段时间以后，大家就失去了对自动化测试的信心。而且由于开发和测试人员不在同一个组织/团队里，团队之间必须进行工作交接（部门墙），导致了大量复测试案例的存在。他们的解决方法是，让开发和测试人员结对子，这样就减少了重复测试。当测试套件又变得精简和绿色了以后，大家又开始相信这些自动化测试了，之后大家对自动化测试的文化转变为：将自动化测试案例失败视为零容忍事件（失败的测试会导致全team的人停下来，并在1天内解决）。另外一个故事关于性能测试，性能测试是通过一个位于俄亥俄州的集中式性能测试团队做的，任何开发团队的申请时间是90天（被识别为最长时间的约束点），他们认为这个前置时间是无法接受的。解决方法是，将性测试脚本和运行权限交还给了开发团队，最后90天的性能周期被缩短为了2小时。&lt;/li>
&lt;li>DevOps团队和管理层对Handbook书里的实践内容达成了共识和一致，上下一致的参考书中这些业界已经验证过的实践，节省了决策和探索DevOps做法和套路的时间。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="开发者程序员体验十八般神兵利器大量的上下文切换">开发者/程序员体验：十八般神兵利器，大量的上下文切换
&lt;/h2>&lt;p>【重点】2017年的实践核心是“开发者/程序员体验”（程序员要“富养”）&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-009.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;p>在专注于开发者体验优化的过程中，应用了大量DevOps工具，最后发现如果开发者把它们都用一遍的话，要花好几个小时的时间。为了解决这个问题，他们体验了Rocket.Chat工具，开发者们对此工具提出了一致好评。&lt;/p>
&lt;p>为了让公司领导层支持增加这个工具，他们请领导们到现场亲自视察观看开发人员在使用了Rocket.Chat之后，优化的体验。领导们就这样决策增加的这个工具。&lt;/p>
&lt;hr>
&lt;h2 id="开发者程序员体验拥抱聊天机器人减少上下文切换">开发者/程序员体验：拥抱聊天机器人，减少上下文切换
&lt;/h2>&lt;p>优化后的开发者工具集如下所示。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-010.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>开发者直接面对的工具精简了很多，他们几乎只需要专注于写代码和处理代码的提交和PR即可。&lt;/li>
&lt;li>之前开发者如果需要部署代码，就需要手工的在UrbanCode里点击十几二十次鼠标，才能完成一次部署操作。&lt;/li>
&lt;li>在使用了聊天机器人之后，他们只需要对聊天机器人说：deploy；即可&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="devops登山指南">DevOps登山指南
&lt;/h2>&lt;p>通过这一页纸的手册，为新来的DevOps实践者提供了清晰的指导。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-011.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;p>攀登高山隐喻了这是一个艰难的旅程。&lt;/p>
&lt;hr>
&lt;h2 id="北极星---前置时间">北极星 - 前置时间
&lt;/h2>&lt;p>【重点】各项DevOps工作的唯一参考指标是“前置时间”（指南针）&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-012.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;p>选用这个指标的三个原因：&lt;/p>
&lt;ul>
&lt;li>这个指标可以在横向的200多个敏捷开发团队里实施；在纵向的组织级、部门级和团队级上，大家都能理解和认可这一指标，都能够掌握前置时间的计算和测量方法。缩短前置时间的目标是清晰的：及时要加快交付速度。&lt;/li>
&lt;li>各个开发团队可以自行选择优化前置时间的方法和路径，其实这鼓励了团队的创造性。&lt;/li>
&lt;li>对此指标的度量和持续改进，是可以按天实时进行的，同时还要保证实现部署的零宕机时间。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="devops登山用品地图和装备">DevOps登山用品：地图和装备
&lt;/h2>&lt;p>DevOps实践者基础的精神和物质需求。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-013.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>工具和DevOps实践直接相关&lt;/li>
&lt;li>每个工具都有其价值和应用场景（例如Rocket.Chat）&lt;/li>
&lt;li>DevOps Handbook（中文书名：DevOp实践指南）的作用是地图，每个DevOps实践团队都进行至少每周一次的读书俱乐部活动，每次都对书中具体的章节进行团队讨论和学习。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="devops的支持模型">DevOps的支持模型
&lt;/h2>&lt;p>DevOps支持团队的作用。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-014.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;p>为了满足企业级的支持规模，让水平参差不齐的200多个开发团队都能顺利应用DevOps实践，没有这个支持模型是不可能走远的。&lt;/p>
&lt;ul>
&lt;li>夏尔巴人团队的作用是支持和辅导DevOps实践团队，提升团队的思想意识观念和技能，帮助它们构建某些特定领域的工作能力。&lt;/li>
&lt;li>参与DevOps实践的开发团队必须自己登上山顶，哪怕是爬也是自己爬上去。绝不勉强，不想进步的团队就不要参与了。&lt;/li>
&lt;li>逐渐开展了沉浸式配对的支持模式，让低水平团队的人员在DevOps高水平团队中进行交叉培训，让他们现场看到相同的工作确实可以有不同的、更好的做法。&lt;/li>
&lt;li>他们进行每月一次的DevOps道场，在道场里DevOps技术顾问现场指导和帮助前来提高的团队。&lt;/li>
&lt;li>将流水线视为产品，流水线的管理确实也是他们的痛点之一。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="devops成功的那一刻">DevOps成功的那一刻
&lt;/h2>&lt;p>DevOps对业务有毛用？！&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-015.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;p>这个故事是该公司刚开始品尝DevOps成功硕果的那一刻。飓风哈维（是2017年大西洋飓风季中的一个热带气旋。2017年8月25日，登陆美国德克萨斯州沿岸，时速130英里）导致车辆涉水险的申报数量剧增。业务部门的人处理这些车险事件的过程中意识到，他们的业务流程对这个险种的索赔并不友好，于是就来找到了IT部门，提出想要优化这个险种报案和索赔处理。&lt;/p>
&lt;p>这是第一次业务部门找上门来提出的业务需求，IT部门在当天就搞定的经历。业务人员和IT部门的人用了一个小时的时间讨论优化方案，决定去掉索赔流程里40%的多余步骤。IT部门开始设计和实施这个想法，决定需要变更多个应用，他们在当天里，在剩下的7个小时内就完成了这些业务需求的开发和测试，这些业务变更的生产环境部署工作是在工作时段进行的，变更在当天的营业时间结束前就上线了。他们始终以速度为先的实践原则在一年后，在这一天里得到了回报。以前需要至少90天的周期才能完成这样的变更，性能测试会就会占用一半以上的前置时间。而他们觉得这次在整个的设计、实施和部署过程中，其实并没有感到什么压力和风险。&lt;/p>
&lt;hr>
&lt;h2 id="后记">后记
&lt;/h2>&lt;p>本文的价值在于，向你展示一个有参考价值的DevOps案例。它的很多特征和成功之处都值得借鉴和思考。本文的文字主要来源于对视频中的叙述，其中也包含了大量我个人的观点和分析；&lt;a class="link" href="https://v.qq.com/x/page/v0555haemus.html" target="_blank" rel="noopener"
>欢迎读者在观看本案例视频后&lt;/a>，与我分享和讨论以上内容。&lt;/p></description></item><item><title>容器编排器之战</title><link>https://martinliu.cn/blog/container-orchestration-wars/</link><pubDate>Fri, 12 Jan 2018 23:33:32 +0800</pubDate><guid>https://martinliu.cn/blog/container-orchestration-wars/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-11.jpg" alt="Featured image of post 容器编排器之战" />&lt;p>K8s在2017年底为这场速战速决的站点话上了句号，结果是所有竞争对手都选择了增加对K8s的支持。在各自的编排器框架里内置了K8s。本文是根据Mesosphere公司的大拿Karl KARL ISENBERG在各种大会上分享过多次的一份演讲稿改版的。&lt;/p>
&lt;h2 id="karl-isenberg-是谁">KARL ISENBERG 是谁？
&lt;/h2>&lt;p>所在公司?&lt;/p>
&lt;ul>
&lt;li>Mesosphere（当前）&lt;/li>
&lt;li>Pivotal&lt;/li>
&lt;/ul>
&lt;p>做过的产品?&lt;/p>
&lt;ul>
&lt;li>DC/OS&lt;/li>
&lt;li>opensource&lt;/li>
&lt;li>CloudFoundry&lt;/li>
&lt;li>BOSH&lt;/li>
&lt;/ul>
&lt;p>联络信息：&lt;/p>
&lt;ul>
&lt;li>github.com/karlkfi&lt;/li>
&lt;li>twitter.com/karlkfi&lt;/li>
&lt;li>linkedin.com/in/karlkfi&lt;/li>
&lt;li>karl.isenberg.us&lt;/li>
&lt;/ul>
&lt;h2 id="基础架构的进化">基础架构的进化
&lt;/h2>&lt;p>传统的应用架构在逐渐向下面两种架构演变。&lt;/p>
&lt;h3 id="可扩展的单体应用架构">可扩展的单体应用架构
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-12%20at%2011.42.23%20PM.png"
loading="lazy"
alt="Screen Shot 2018-01-12 at 11.42.23 P"
>&lt;/p>
&lt;p>关键词：&lt;/p>
&lt;ul>
&lt;li>Online 基于互联网&lt;/li>
&lt;li>Latency Routed 用户访问基于延迟路由&lt;/li>
&lt;li>Multi-Region 多区部署&lt;/li>
&lt;li>Load Balanced 负载均衡接入&lt;/li>
&lt;li>Multi-Zone 多个Zone&lt;/li>
&lt;li>Replicated 应用实例多副本&lt;/li>
&lt;li>Auto-Scaled 容量自动化收缩&lt;/li>
&lt;li>Data Replication 区内数据多副本&lt;/li>
&lt;li>Data Synchronization 跨区数据同步&lt;/li>
&lt;/ul>
&lt;h3 id="可扩展的微服务架构">可扩展的微服务架构
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-12%20at%2011.50.47%20PM.png"
loading="lazy"
alt="Screen Shot 2018-01-12 at 11.50.47 P"
>&lt;/p>
&lt;p>上图出处：Wheel of Doom ，来自&lt;a class="link" href="https://sudo.hailoapp.com/services/2015/03/09/journey-into-a-microservice-world-part-3/" target="_blank" rel="noopener"
>A Journey into Microservices by Hailo&lt;/a>&lt;/p>
&lt;h3 id="应用裸金属服务器">应用+裸金属服务器
&lt;/h3>&lt;p>APPLICATION
PROVISIONING
ON
BARE METAL&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-12%20at%2011.54.26%20PM.png"
loading="lazy"
alt="Screen Shot 2018-01-12 at 11.54.26 P"
>&lt;/p>
&lt;h3 id="应用iaas">应用+IaaS
&lt;/h3>&lt;p>APPLICATION
PROVISIONING
ON
VIRTUAL INFRASTRUCTURE
PLATFORM
(IaaS)&lt;/p>
&lt;blockquote>
&lt;p>“Ultimately, utility cloud providers have
exposed how difficult it is to properly operate
data centers — and reminded all of us that the
ability to expertly operate infrastructure is
what really fuels the consumption of open
source infrastructure.”
&amp;ndash;Brian Stein (Rackspace VP - 2017)&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://martinliu.cn/images/images/Screen%20Shot%202018-01-12%20at%2011.58.36%20PM.png"
loading="lazy"
alt="Screen Shot 2018-01-12 at 11.58.36 P"
>&lt;/p>
&lt;h3 id="应用paasapaasiaas">应用+PaaS/aPaaS+IaaS
&lt;/h3>&lt;p>APPLICATION
PLATFORM
(PaaS / aPaaS)
ON
INFRASTRUCTURE
PLATFORM
(IaaS)&lt;/p>
&lt;blockquote>
&lt;p>“The goal of Cloud Foundry is to put more of the
controls back in the hands of developers so they can
self-provision, so there aren’t a lot of roadblocks in their way. But it gives a lot of guardrails.”
&amp;ndash; Chip Childers (Cloud Foundry Foundation CTO - 2017)
&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%2012.03.37%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 12.03.37 A"
>&lt;/p>&lt;/blockquote>
&lt;h3 id="容器编排器iaas">容器编排器+IaaS
&lt;/h3>&lt;p>CONTAINER
ORCHESTRATION
ON
INFRASTRUCTURE
PLATFORM
(IaaS)&lt;/p>
&lt;blockquote>
&lt;p>“&amp;hellip;traditional “PaaS” roles have now been
taken over by containers… The piece that is
left for PaaS is the part that was always the
most important part of PaaS in the first place,
and that’s the opinionated developer
experience.”
&amp;ndash;Brendan Burns (Kubernetes Cofounder - 2017)&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%2012.08.37%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 12.08.37 A"
>&lt;/p>
&lt;h3 id="caasiaas">CaaS+IaaS
&lt;/h3>&lt;p>CONTAINER
PLATFORM
(CaaS)
ON
INFRASTRUCTURE
PLATFORM
(IaaS)
&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%2012.10.28%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 12.10.28 A"
>&lt;/p>
&lt;h3 id="caas裸金属服务器">CaaS+裸金属服务器
&lt;/h3>&lt;p>CONTAINER
PLATFORM
(CaaS)
ON
BARE METAL&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%2012.11.42%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 12.11.42 A"
>&lt;/p>
&lt;h3 id="faasiaas">FaaS+IaaS
&lt;/h3>&lt;p>FUNCTION
PLATFORM
(FaaS)
ON
INFRASTRUCTURE
PLATFORM
(IaaS)&lt;/p>
&lt;blockquote>
&lt;p>“If your PaaS can efficiently start instances in 20ms that run for half a second, then call it serverless.”
&amp;ndash;Adrian Cockcroft-(AWS VP - 2016)&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%2012.13.46%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 12.13.46 A"
>&lt;/p>
&lt;h3 id="faascaas">FaaS+CaaS
&lt;/h3>&lt;p>FUNCTION
PLATFORM
(FaaS)
ON
CONTAINER
PLATFORM
(CaaS)
&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%206.43.06%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 6.43.06 A"
>&lt;/p>
&lt;h3 id="faascaasiaas">FaaS+CaaS+IaaS
&lt;/h3>&lt;p>FUNCTION PLATFORM
(FaaS)
ON
CONTAINER PLATFORM
(CaaS)
ON
INFRASTRUCTURE PLATFORM
(IaaS)&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%206.44.49%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 6.44.49 A"
>&lt;/p>
&lt;h2 id="平台频谱---platform-spectrum">平台频谱 - PLATFORM SPECTRUM
&lt;/h2>&lt;p>从左到右，资源的抽象程度不断提高；最左侧的弹性最高，最右侧的速率最高。
&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%206.47.36%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 6.47.36 A"
>&lt;/p>
&lt;p>下图是不同类型里的厂商和软件。
&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%206.48.19%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 6.48.19 A"
>&lt;/p>
&lt;h2 id="容器平台层次">容器平台层次
&lt;/h2>&lt;p>容器编排器的层次如下：
&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%206.49.36%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 6.49.36 A"
>&lt;/p>
&lt;ul>
&lt;li>User workloads 用户工作负载&lt;/li>
&lt;li>Distributed container management 分布式容器管理&lt;/li>
&lt;li>Local container management 本地容器管理&lt;/li>
&lt;li>Container agnostic infrastructure 容器无关性基础架构&lt;/li>
&lt;/ul>
&lt;p>容器平台的层次如下：
&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%206.51.23%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 6.51.23 A"
>&lt;/p>
&lt;p>CONTAINER PLATFORM&lt;/p>
&lt;ul>
&lt;li>User workloads 用户工作负载&lt;/li>
&lt;li>System management &amp;amp; service enablement 系统管理和服务管理&lt;/li>
&lt;li>Distributed container management 分布式容器管理&lt;/li>
&lt;li>Local container management 本地容器管理&lt;/li>
&lt;li>Container aware infrastructure 容器感知的基础架构&lt;/li>
&lt;li>Container agnostic infrastructure 容器无关的基础架构&lt;/li>
&lt;/ul>
&lt;p>分布式操作系统的层次如下：
&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%206.52.52%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 6.52.52 A"
>&lt;/p>
&lt;h2 id="容器平台功能点">容器平台功能点
&lt;/h2>&lt;p>CONTAINER
PLATFORM
CAPABILITIES&lt;/p>
&lt;h3 id="运行态的能力">运行态的能力
&lt;/h3>&lt;p>1 容器&lt;/p>
&lt;ul>
&lt;li>Resource Isolation&lt;/li>
&lt;li>Resource Constraints&lt;/li>
&lt;li>Process Tree&lt;/li>
&lt;li>Environment Isolation&lt;/li>
&lt;li>Shell / Exec&lt;/li>
&lt;/ul>
&lt;p>2 镜像&lt;/p>
&lt;ul>
&lt;li>Build&lt;/li>
&lt;li>Layers&lt;/li>
&lt;li>Download&lt;/li>
&lt;li>Cache&lt;/li>
&lt;li>Publish&lt;/li>
&lt;li>Prune&lt;/li>
&lt;/ul>
&lt;p>3 网络&lt;/p>
&lt;ul>
&lt;li>Container&lt;/li>
&lt;li>Bridge&lt;/li>
&lt;li>Host&lt;/li>
&lt;li>Virtual&lt;/li>
&lt;li>Overlay&lt;/li>
&lt;li>Remote&lt;/li>
&lt;li>User-defined&lt;/li>
&lt;li>Port Mapping&lt;/li>
&lt;/ul>
&lt;p>4 数据卷&lt;/p>
&lt;ul>
&lt;li>Ephemeral&lt;/li>
&lt;li>Host&lt;/li>
&lt;li>Backup / Restore&lt;/li>
&lt;li>Copy In / Out&lt;/li>
&lt;li>Shared&lt;/li>
&lt;/ul>
&lt;h3 id="编排器的能力">编排器的能力
&lt;/h3>&lt;p>调度&lt;/p>
&lt;ul>
&lt;li>Placement&lt;/li>
&lt;li>Replication/Scaling&lt;/li>
&lt;li>Readiness Checking&lt;/li>
&lt;li>Resurrection&lt;/li>
&lt;li>Rescheduling&lt;/li>
&lt;li>Rolling Updates&lt;/li>
&lt;li>Collocation&lt;/li>
&lt;li>Daemons&lt;/li>
&lt;li>Cron Jobs&lt;/li>
&lt;/ul>
&lt;p>资源管理&lt;/p>
&lt;ul>
&lt;li>Memory&lt;/li>
&lt;li>CPU&lt;/li>
&lt;li>GPU&lt;/li>
&lt;li>Ephemeral Volumes&lt;/li>
&lt;li>Remote Persistent Volumes&lt;/li>
&lt;li>Local Persistent Volumes&lt;/li>
&lt;li>Ports&lt;/li>
&lt;li>IPs (per container)&lt;/li>
&lt;/ul>
&lt;p>服务管理&lt;/p>
&lt;ul>
&lt;li>Labels&lt;/li>
&lt;li>Groups/Namespaces&lt;/li>
&lt;li>Dependencies&lt;/li>
&lt;li>Load Balancing (L7)&lt;/li>
&lt;li>VIPs (L3/L4 LB)&lt;/li>
&lt;li>DNS&lt;/li>
&lt;li>DNS Proxy&lt;/li>
&lt;li>Secrets&lt;/li>
&lt;li>Config Mgmt&lt;/li>
&lt;/ul>
&lt;h3 id="运维方面的能力">运维方面的能力
&lt;/h3>&lt;p>管理&lt;/p>
&lt;ul>
&lt;li>GUI&lt;/li>
&lt;li>CLI&lt;/li>
&lt;li>Metrics API&lt;/li>
&lt;li>Logs API&lt;/li>
&lt;li>Events API&lt;/li>
&lt;li>Rolling Upgrades&lt;/li>
&lt;li>Backups &amp;amp; Restores&lt;/li>
&lt;/ul>
&lt;p>MULTI-INFRASTRUCTURE&lt;/p>
&lt;ul>
&lt;li>Multi-cloud&lt;/li>
&lt;li>Multi-zone&lt;/li>
&lt;li>Multi-region&lt;/li>
&lt;li>Hybrid-cloud&lt;/li>
&lt;li>Federation&lt;/li>
&lt;/ul>
&lt;p>系统服务&lt;/p>
&lt;ul>
&lt;li>Auto-Scaling&lt;/li>
&lt;li>Package Management&lt;/li>
&lt;li>Service Catalog&lt;/li>
&lt;li>Service Brokers&lt;/li>
&lt;li>Admin Proxy&lt;/li>
&lt;li>API Gateway&lt;/li>
&lt;/ul>
&lt;h3 id="平台的能力">平台的能力
&lt;/h3>&lt;p>容器网络&lt;/p>
&lt;ul>
&lt;li>Overlay&lt;/li>
&lt;li>Routing&lt;/li>
&lt;li>Network Address Translation (NAT)&lt;/li>
&lt;li>Firewalls&lt;/li>
&lt;li>Access Control Lists&lt;/li>
&lt;li>Quality of Service&lt;/li>
&lt;/ul>
&lt;p>容器存储&lt;/p>
&lt;ul>
&lt;li>Local Volumes&lt;/li>
&lt;li>Remote Volumes&lt;/li>
&lt;li>Block Storage&lt;/li>
&lt;li>File System Storage&lt;/li>
&lt;li>Object Storage&lt;/li>
&lt;/ul>
&lt;p>平台数据库&lt;/p>
&lt;ul>
&lt;li>Lock Service&lt;/li>
&lt;li>Key-Value Database&lt;/li>
&lt;li>Relational Database&lt;/li>
&lt;li>Time Series Database&lt;/li>
&lt;/ul>
&lt;p>安全&lt;/p>
&lt;ul>
&lt;li>User Accounts&lt;/li>
&lt;li>Service Accounts&lt;/li>
&lt;li>System/User Space&lt;/li>
&lt;li>E2E Encryption&lt;/li>
&lt;li>Non-root User Workloads&lt;/li>
&lt;li>Audit Logging&lt;/li>
&lt;li>Public Key Infrastructure&lt;/li>
&lt;li>Certifications&lt;/li>
&lt;/ul>
&lt;p>多租户&lt;/p>
&lt;ul>
&lt;li>User Groups&lt;/li>
&lt;li>Permissions&lt;/li>
&lt;li>RBAC&lt;/li>
&lt;li>ABAC&lt;/li>
&lt;li>Resource Sharing
&lt;ul>
&lt;li>FIFO&lt;/li>
&lt;li>Fair&lt;/li>
&lt;li>Quotas&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Branding&lt;/li>
&lt;li>Quality of Service&lt;/li>
&lt;/ul>
&lt;p>非功能需求&lt;/p>
&lt;p>稳定性&lt;/p>
&lt;ul>
&lt;li>Performance&lt;/li>
&lt;li>Responsiveness&lt;/li>
&lt;li>Efficiency&lt;/li>
&lt;/ul>
&lt;p>可用性&lt;/p>
&lt;ul>
&lt;li>Fault Tolerance&lt;/li>
&lt;li>Robustness,&lt;/li>
&lt;li>Reliability,&lt;/li>
&lt;li>Resilience,&lt;/li>
&lt;li>Disaster Recovery&lt;/li>
&lt;/ul>
&lt;p>灵活性&lt;/p>
&lt;ul>
&lt;li>Format Support,&lt;/li>
&lt;li>Interoperability,&lt;/li>
&lt;li>Extensibility,&lt;/li>
&lt;li>Container Runtimes&lt;/li>
&lt;/ul>
&lt;p>可用度&lt;/p>
&lt;ul>
&lt;li>Familiarity,&lt;/li>
&lt;li>Maintainability,&lt;/li>
&lt;li>Compatibility,&lt;/li>
&lt;li>Debuggability&lt;/li>
&lt;/ul>
&lt;p>可移植性&lt;/p>
&lt;ul>
&lt;li>Host OS,&lt;/li>
&lt;li>Cloud,&lt;/li>
&lt;li>Bare-Metal,&lt;/li>
&lt;li>Hybrid&lt;/li>
&lt;/ul>
&lt;p>安全性&lt;/p>
&lt;ul>
&lt;li>Encryption Quality,&lt;/li>
&lt;li>Vulnerability Process,&lt;/li>
&lt;li>Fast Patching,&lt;/li>
&lt;li>Backporting&lt;/li>
&lt;/ul>
&lt;h2 id="容器平台对比">容器平台对比
&lt;/h2>&lt;p>市场里的主要技术厂商如下。
&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%206.57.44%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 6.57.44 A"
>&lt;/p>
&lt;p>其它值得考虑的厂商如下。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%206.58.36%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 6.58.36 A"
>&lt;/p>
&lt;p>下面的能力对比的时间点是 06/2017，这个时候K8s是否能胜出还是个悬念。&lt;/p>
&lt;h3 id="调度">调度
&lt;/h3>&lt;p>图示说明：&lt;/p>
&lt;ul>
&lt;li>绿勾：包含此能力&lt;/li>
&lt;li>横杠：New/External/Partial/Experimental&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%206.59.42%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 6.59.42 A"
>&lt;/p>
&lt;h3 id="资源管理">资源管理
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%207.00.38%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 7.00.38 A"
>&lt;/p>
&lt;h3 id="服务管理">服务管理
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/images/Screen%20Shot%202018-01-13%20at%207.01.16%20AM.png"
loading="lazy"
alt="Screen Shot 2018-01-13 at 7.01.16 A"
>&lt;/p>
&lt;h2 id="如何选择">如何选择
&lt;/h2>&lt;h3 id="第一阵营重量级">第一阵营：重量级
&lt;/h3>&lt;p>KUBERNETES&lt;/p>
&lt;ul>
&lt;li>Huge community&lt;/li>
&lt;li>Solid API&lt;/li>
&lt;li>Some assembly required&lt;/li>
&lt;li>Multitude of vendors/installers&lt;/li>
&lt;/ul>
&lt;p>OPENSHIFT&lt;/p>
&lt;ul>
&lt;li>Application platform based on Kubernetes&lt;/li>
&lt;li>Always trailing Kubernetes releases&lt;/li>
&lt;li>No assembly required&lt;/li>
&lt;li>Open core, enterprise platform&lt;/li>
&lt;/ul>
&lt;p>DC/OS&lt;/p>
&lt;ul>
&lt;li>Runs native applications (non-Docker)&lt;/li>
&lt;li>Specialized in data services&lt;/li>
&lt;li>Ambitious scope (on-prem AWS)&lt;/li>
&lt;li>No assembly required&lt;/li>
&lt;li>Open core, enterprise platform&lt;/li>
&lt;/ul>
&lt;p>DOCKER&lt;/p>
&lt;ul>
&lt;li>Huge community&lt;/li>
&lt;li>Fast moving API&lt;/li>
&lt;li>Integrated orchestration and runtime&lt;/li>
&lt;li>Recent pivot from runtime to orchestration&lt;/li>
&lt;li>Open core, enterprise platform&lt;/li>
&lt;/ul>
&lt;h3 id="第二阵营轻量级">第二阵营：轻量级
&lt;/h3>&lt;p>EC2 CONTAINER SERVICE (ECS)&lt;/p>
&lt;ul>
&lt;li>Hosted-only solution&lt;/li>
&lt;li>Tight integration with AWS services&lt;/li>
&lt;li>Closed platform&lt;/li>
&lt;/ul>
&lt;p>RANCHER CATTLE&lt;/p>
&lt;ul>
&lt;li>Gateway to Kubernetes, Mesos, and Docker&lt;/li>
&lt;li>Open platform, enterprise support&lt;/li>
&lt;/ul>
&lt;p>NOMAD&lt;/p>
&lt;ul>
&lt;li>Provisioner with orchestration features&lt;/li>
&lt;li>Runs native applications (non-Docker)&lt;/li>
&lt;li>Tight integration with Vault and Consul&lt;/li>
&lt;li>Some assembly required&lt;/li>
&lt;li>Open platform, enterprise support&lt;/li>
&lt;/ul>
&lt;p>KONTENA&lt;/p>
&lt;ul>
&lt;li>Simple to set up&lt;/li>
&lt;li>No assembly required&lt;/li>
&lt;li>Open core, enterprise platform&lt;/li>
&lt;/ul>
&lt;h3 id="karl个人的考察点">Karl个人的考察点？
&lt;/h3>&lt;ul>
&lt;li>Which is more important to you: &lt;strong>velocity or flexibility&lt;/strong>?&lt;/li>
&lt;li>Do you want an &lt;strong>opinionated&lt;/strong> application platform?&lt;/li>
&lt;li>Do you need to support &lt;strong>Big Data&lt;/strong> initiatives and pipelines?&lt;/li>
&lt;li>Do you want a &lt;strong>hosted&lt;/strong> solution?&lt;/li>
&lt;li>Are you willing to &lt;strong>build out your own integrations&lt;/strong>?&lt;/li>
&lt;li>Do you need &lt;strong>on-prem &amp;amp; hybrid&lt;/strong> capabilities?&lt;/li>
&lt;li>Do you want to avoid infrastructure &lt;strong>lock-in&lt;/strong>?&lt;/li>
&lt;li>Are you already invested in a specific infrastructure?&lt;/li>
&lt;li>Are you already invested in a specific operating system?&lt;/li>
&lt;li>Do you need &lt;strong>federation and multi-region&lt;/strong>support?&lt;/li>
&lt;li>Do you want &lt;strong>multi-tenancy&lt;/strong> or is multi-instance good enough?&lt;/li>
&lt;li>How important are seamless automated &lt;strong>rolling upgrades&lt;/strong>?&lt;/li>
&lt;li>&lt;strong>How many nines&lt;/strong> do your customers need?&lt;/li>
&lt;li>How important is reverse compatibility &amp;amp; API &lt;strong>stability&lt;/strong>?&lt;/li>
&lt;li>Do you need to support &lt;strong>non-Docker workloads&lt;/strong>?&lt;/li>
&lt;/ul></description></item><item><title>Kubecon 2017演讲稿和视频下载</title><link>https://martinliu.cn/blog/kubecon17/</link><pubDate>Wed, 03 Jan 2018 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/kubecon17/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-10.jpg" alt="Featured image of post Kubecon 2017演讲稿和视频下载" />&lt;p>Kubernetes 无疑当下最火热的技术之一，Google 公司围绕着它下了更大的一盘棋 CNCF。这是在国际寡头 IT 软件公司的统治局面渐渐退去之后，各种新鲜技术百花齐放了一段时间以后，再通过 CNCF 的形式又逐渐集中化起来的趋势。KubeCon 的人气很旺，演讲分享的人很多。&lt;/p>
&lt;p>最近一次的 KubeCon，2017 年在奥斯汀站的演讲稿和视频下载的清单已经发布出来了：&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/cloudyuga/kubecon17" target="_blank" rel="noopener"
>https://github.com/cloudyuga/kubecon17&lt;/a>&lt;/p>
&lt;p>我在 YouTube 里听了一部分视频，感觉确实有很多新鲜的工程实践经验的分享。下面分享一个觉得不错的实战案例分享。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/15149407077880.jpg"
loading="lazy"
>&lt;/p>
&lt;h2 id="box-公司分享持续交付实战经验">Box 公司分享持续交付实战经验
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/2341514940915_.pic_hd.jpg"
loading="lazy"
alt="2341514940915_.pic_hd"
>&lt;/p>
&lt;p>关于这个分享的看点：&lt;/p>
&lt;ul>
&lt;li>Box 公司全面实施 Kubernetes 的案例，涵盖了所有的环境：Dev、Staging 和 Prod&lt;/li>
&lt;li>遇到的挑战和问题共性强&lt;/li>
&lt;li>Jenkins 流水线+金丝雀部署+持续交付的组合&lt;/li>
&lt;li>解决问题的模式值得借鉴&lt;/li>
&lt;li>工具集里开发出来的核心组件已经开业分享在 Github 上&lt;/li>
&lt;/ul>
&lt;p>分享者经典语录：&lt;/p>
&lt;blockquote>
&lt;p>我们是软件工程师，我们不是坐在那按按钮的猴子！&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://martinliu.cn/images/2251514938283_.pic.jpg"
loading="lazy"
alt="2251514938283_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2261514938305_.pic.jpg"
loading="lazy"
alt="2261514938305_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2271514938328_.pic.jpg"
loading="lazy"
alt="2271514938328_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2281514938357_.pic.jpg"
loading="lazy"
alt="2281514938357_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2291514938389_.pic.jpg"
loading="lazy"
alt="2291514938389_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2301514938410_.pic.jpg"
loading="lazy"
alt="2301514938410_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2311514938432_.pic.jpg"
loading="lazy"
alt="2311514938432_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2321514938453_.pic.jpg"
loading="lazy"
alt="2321514938453_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2331514938477_.pic.jpg"
loading="lazy"
alt="2331514938477_.pi"
>&lt;/p>
&lt;p>以上分享的持续交付方案里 kube-applier 的源代码分享：&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/box/kube-applier" target="_blank" rel="noopener"
>https://github.com/box/kube-applier&lt;/a>&lt;/p>
&lt;p>PS：非常敬佩这种开放和分享的工程式文化。很符合开源的精神，爱分享的人，不把东西分享出来的话可能会不爽。&lt;/p>
&lt;p>延伸阅读：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://blog.box.com/blog/introducing-kube-applier-declarative-configuration-for-kubernetes/" target="_blank" rel="noopener"
>https://blog.box.com/blog/introducing-kube-applier-declarative-configuration-for-kubernetes/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.box.com/blog/kubernetes-box-microservices-maximum-velocity/" target="_blank" rel="noopener"
>https://blog.box.com/blog/kubernetes-box-microservices-maximum-velocity/
&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="观看以上演讲视频">观看以上演讲视频
&lt;/h2>&lt;!-- raw HTML omitted --></description></item><item><title>2017DevOps企业峰会旧金山站</title><link>https://martinliu.cn/blog/2017-does-sfo/</link><pubDate>Thu, 28 Dec 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/2017-does-sfo/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-7.jpg" alt="Featured image of post 2017DevOps企业峰会旧金山站" />&lt;p>DevOps Enterprise Summit由美国的Gene Kim发起并举办的，他是两本流行书籍的作者：《凤凰项目》和《DevOps Handbook》（中文书名《DevOps实践指南》预计于2018年春季出版）。&lt;/p>
&lt;h2 id="大会简介">大会简介
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/does-logo.png"
loading="lazy"
alt="DOES Logo"
>&lt;/p>
&lt;p>下面是来自这个大会官网的简单介绍：&lt;/p>
&lt;blockquote>
&lt;p>DevOps Enterprise Summit is a conference for the leaders of large, complex organizations implementing DevOps principles and practices. The event programming emphasizes both evolving technical and architectural practices and the methods needed to lead widespread change efforts in large organizations. The goal is to give leaders the tools and practices they need to develop and deploy software faster and to win in the marketplace.&lt;/p>&lt;/blockquote>
&lt;p>From:&lt;a class="link" href="https://events.itrevolution.com/us/" target="_blank" rel="noopener"
>https://events.itrevolution.com/us/&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/DOES-2017-header-web.jpg"
loading="lazy"
alt="15048603211912"
>&lt;/p>
&lt;h2 id="推荐视频">推荐视频
&lt;/h2>&lt;p>最近我通过微信公众号分享过关于Seek公司DevOps转型的精彩视频。&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;h2 id="演讲稿目录">演讲稿目录
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>星期&lt;/th>
&lt;th>场次&lt;/th>
&lt;th>名称&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Rocha, Aloisio, Betting on DevOps- How NetEnt Transforms Online Gaming Delivery.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Wallgren, Andres, Architecting Your App and Your Pipeline for Continuous Delivery - 10 DO&amp;rsquo;s for Successful DevOps.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Mckay, Gary, From Mainframe to Microservices- How Somos Keeps Telcos and Us All Connected.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Pullen, Wesley, DevOps from Grassroots to Mainstream.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Esser, John, DevOps Transformation 2.0- From Ancestry.com to AdvancedMD - applying strategies for leading DevOps innovation.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Comtois, Pauly, Bringing DevOps to Product.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Raia, Alice, Overcoming 75 years of inertia in healthcare; a Top-down + bottoms-up DevOps Transformation.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Perret, Jennifer, Guckenheimer, Sam, The Skype Journey to 1ES and Cloud.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Hering, Micro, What got you here, wont get you there - A story of transformations.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Dominica DeGrandis - DeGrandis_Nov 12.2017.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Olivier, Dawie, Agile:Dawie ruined my life.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Thrasher, Paula, Scaling DevOps Talent in a Large Enterprise.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Daththreya, Gnani, Shunmugasundaram, Sathiya, Continuous Chaos in DevOps.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Hockaday, Kurt, Turning the Battleship A Principled Approach to Driving Change in DoD IT.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Mayner, Steve, Transformational Leadership and DevOps - Beyond the Research.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Johnson, Suzette, Yeman, Robin, What Legacy government organizations need to advance the state of DevOps.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Nassello, Scott, Using DevOps to build your learning organization.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Morrison, Erica, Prugh, Scott, More Culture, More Engineering, Less Duct-Tape.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Aggarwal, Manish, Intel&amp;rsquo;s Journey to Build Quality In How QA and Test Automation Drive DevOps Transformation.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Priolo, Marc, Mastering the Three S’s for a Successful Pipeline-as-a-Service Strategy Standardization, Self-service, Scale.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Stroud, Robert, DevOps From Analyst Inquiry to Organizational Action.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Gruver, Gary, Starting and Scaling DevOps in the Enterprise.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Reed, J. Paul, Navigating the Software Delivery Minefield DevOps and the Art of Release Engineering.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Blank-Edelman, David, SRE For Enterprises.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Lackey, Zane, DevSecOps How to use DevOps to make you more secure.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Burgin, Andy Devops in a Data Warehouse Inside Out.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Nowak, Chris, Alliances, Data and Startup Mentality – How we Led Three Banks through DevOps Transformations.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Rinehart, Aaron, Wickett, James, DevOps and the Healthcare Giant.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Kolli, Rama, Supercharging PayPal’s application development to help democratize financial services.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Fong, Richard, Nir, Erez, From Dev Opps to DevOps.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Nielsen, Suzanne, Shewell, Sarah, Transformation at Scale, One Cup at a Time.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Finster, Bryan, Pendergraft, Brent, CD Solving the talent problem.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Edmundson, Jill, Musil, Jill, Service Request Management CSG&amp;rsquo;s Journey from Chaos to Clarity.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Magennis, Troy, Prioritization – 10 different techniques for choosing what to start next.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Owczarek, David, Best Practices for Availability.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Forsgren, Nicole, The key to high performance What the data says.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Matthew, Tisson, The Making of Amazon Prime Now.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Allspaw, John, How Your Systems Keep Running Day After Day - Resilience Engineering as DevOps.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tuesday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Brady, Jennifer, Pal, Tapabrata, Better Governance – Banking on Continuous Delivery.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Morales, Marco, Process-as-Code Real-World Examples that Scale.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Lynn, Angelo, Best Practices for DevOps-Ready Infrastructure Management and Automation.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>McKnight, Ken,Data-Driven DevOps Taking Action!.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Doucet, Chris, Best Practices for Model Driven Approach to Application Release.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Sutton, Mark, BizDevOps Using KPIs to Unlock a Common Language.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Electric Cloud Track&lt;/td>
&lt;td>Schuller, Manuel, How Financial Services are Leveraging Legacy IT Investments When Transitioning to DevOps.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>England, Rob, Surviving DevOps.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Konno, Miki, Marks, Justin, User Feedback at the Speed of DevOps.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Finn, Ray, Singh, Aru, Service Ownership - Devops for Salesforce.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Hill, Chris, Context Switches in Software Engineering.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Wester, Julia, Taming the Chaos- Beyond the Quick Wins.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Kernaghan, Chris, Can you do Devops in SAP DOES.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Jelleda, Kishore, DevOps at Scale is a Hard Problem- Challenges, Insights and Lessons Learned.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Radcliffe, Rosalind, Two Amazing Mainframe DevOps Transformation Case Studies.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Shoup, Randy, Scaling Personalization- DevOps at Stitch Fix.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>DeArdo, Carmen, Kersten, Mik, The Case for Value Stream Architecture.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>Breakout Session&lt;/td>
&lt;td>Rizzo, David, Two Amazing Mainframe DevOps Transformation Case Studies.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Boecker, Scott, Forrester, Ron There is No Finish Line.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Clanton, Ross, Kumar, Nanda, Fear does not exist in the dojo - a devops journey with a competitive twist.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Smart, Jonathan, The Yin and Yang of Speed and Control.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Hendrickson, Elisabeth, Data and DevOps Breaking Down the Silos.pdf&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wednesday&lt;/td>
&lt;td>General Session&lt;/td>
&lt;td>Dekker, Sindey, The human factor Inspiring the pursuit of success and averting drift into failure.pdf&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="演讲稿下载">演讲稿下载
&lt;/h2>&lt;p>我从官网的Dropbox网盘里下载了所有演讲稿，分享到了微云的网盘里。&lt;/p>
&lt;p>&lt;a class="link" href="https://share.weiyun.com/d4ae9b43e05419260648af74b2c98178" target="_blank" rel="noopener"
>点这里下载&lt;/a>
以上文件压缩包大将近700MB。&lt;/p>
&lt;p>也可以从GitHub看到这些分享的文件：&lt;a class="link" href="https://github.com/devopsenterprise/2017-San-Francisco" target="_blank" rel="noopener"
>https://github.com/devopsenterprise/2017-San-Francisco&lt;/a>&lt;/p>
&lt;p>同样的今年6月份在伦敦举行的欧洲场次的DevOps企业峰会的演讲稿下载地址在：&lt;a class="link" href="https://github.com/devopsenterprise/2017-london" target="_blank" rel="noopener"
>https://github.com/devopsenterprise/2017-london&lt;/a>&lt;/p></description></item><item><title>Tips for Docker on Mac</title><link>https://martinliu.cn/blog/tips-for-docker-on-mac/</link><pubDate>Tue, 26 Sep 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/tips-for-docker-on-mac/</guid><description>&lt;img src="https://martinliu.cn/images/sandrali-3.JPG" alt="Featured image of post Tips for Docker on Mac" />&lt;h1 id="tips-for-docker-on-mac">Tips for Docker on Mac
&lt;/h1>&lt;p>在macOS上使用Docker很长时间了，本文总结一些我不想忘记的tips，方便自己反复使用的同时，也顺便总结分享一下，留下本文作为长期更新的备忘录。&lt;/p>
&lt;h2 id="搭建私有镜像库">搭建私有镜像库
&lt;/h2>&lt;p>运行一个本地镜像库&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d -p 5000:5000 --restart=always --name registry registry:2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这条命令会从docker hub 下载 registry:2 镜像，在本机运行一个镜像库服务。&lt;/p>
&lt;p>下载一个测试用的镜像。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker pull ubuntu:16.04
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>给这个镜像打上私有镜像库的标签&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker tag ubuntu:16.04 localhost:5000/ubuntu:16.04
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>push这个测试镜像到本地的镜像库&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker push localhost:5000/ubuntu:16.04
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这时候你会发现我的本地这样岂不是有了两份相同的镜像了，有这个必要么？是不是多余了？下面几个场景中会用到：&lt;/p>
&lt;p>当你用docker-machine在本机启动1个vm的时候，你运行任何docker run或者docker-compose up的时候你可能需要一个之前在本地就有的image，这是一种分享本机image给docker-machine vm的一种方式。&lt;/p>
&lt;p>当你用docker-machine在本机启动多个个vm的时候，你可能会把它们作出docker Swarm群集，当你在这个群集上启动一个服务的时候，docker compose文件中的镜像地址可以引用这个本地地址，引用地址类似这样 image: 192.168.99.1:5000/influxdb&lt;/p>
&lt;p>当你用 minikube start启动了一个minikube的vm的时候，你可能也需要本机的docker镜像，尤其是在你做demo的时候，这是最快的下载途径。
需要注意的是，以上三种情况都需要指定一下&amp;ndash;engine-insecure-registry 192.168.99.1:5000 这个参数。&lt;/p>
&lt;h2 id="自动化创建docker-swarm群集">自动化创建Docker Swarm群集
&lt;/h2>&lt;p>在我的文件目录中存放着这个脚本&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cat create-swarm.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine create manager --engine-insecure-registry 192.168.99.1:5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine create agent1 --engine-insecure-registry 192.168.99.1:5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine create agent2 --engine-insecure-registry 192.168.99.1:5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine create agent3 --engine-insecure-registry 192.168.99.1:5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">eval `docker-machine env manager`
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker swarm init --advertise-addr `docker-machine ip manager`
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine ssh agent1 docker swarm join --token `docker swarm join-token -q worker` `docker-machine ip manager`:2377
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine ssh agent2 docker swarm join --token `docker swarm join-token -q worker` `docker-machine ip manager`:2377
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine ssh agent3 docker swarm join --token `docker swarm join-token -q worker` `docker-machine ip manager`:2377
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker node ls
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>解释一下上面的代码：创建四个docker-machine vm，初始化swarm群集，把三个worker节点加入群集。这样四节点的群集就up and running了。&lt;/p>
&lt;p>清除以上群集虚拟机的命令如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker-machine rm -y manager agent1 agent2 agent3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>关于DevOps 的那些事</title><link>https://martinliu.cn/blog/about-devops-china/</link><pubDate>Sat, 23 Sep 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/about-devops-china/</guid><description>&lt;img src="https://martinliu.cn/images/tf_5.jpg" alt="Featured image of post 关于DevOps 的那些事" />&lt;p>DevOps是孕育于敏捷社区，又反哺给整个IT技术行业的，是一次彻底而全面的技术和文化运动。本文从它的出处谈起，一直描述到当前国内的现状。最后总结了相关的核心技术和主要实践。&lt;/p>
&lt;h2 id="devops简史">DevOps简史
&lt;/h2>&lt;p>在2008年多伦多举办的敏捷大会（Velocity Conf 2008 ）上，Patrick DeBois 和AndrewClay Shafer 先生首次提议讨论“敏捷基础架构”这个话题。在第二年的敏捷大会上有一个具有里程碑的意义技术分享，来自Flickr公司《每天部署10次》的分享，它激发了随后Patrick DeBios在同年十月，在比利时的根特市举办的首届DevOpsDays活动，这个活动是两天的日程，为了大家方便在twitter上的传播，人们把DevOpsDays这个词简写为 “#DevOps” 。 此后，“DevOps”一词问世了，这个词所包含的理念和实践一时在越来越广大的人群中产生了共鸣，随后成为全球IT界在各种大会和论坛里热议和讨论的焦点话题，很多大型IT论坛也都开设出了DevOps专题讨论。这就是DevOps这个词的由来。DevOpsDays活动随后在Patrick DeBios等相关核心发起人的推动下，在全球范围内蓬勃发展了起来。2010年在美国山景城(Mountain View) 举办的DevOpsDays 活动中，Damon Edwards先生使用“CAMS”这个缩写，高度概括和诠释了DevOps，即文化（Culture）、自动化（Automation）、度量（Measurement or Metrics）和分享（Sharing）。随后Jez Humble先生将“L”精益 (Lean) 原则也加入其中，最终变成了CALMS。&lt;/p>
&lt;ul>
&lt;li>Culture（文化）- 是指拥抱变革，促进协作和沟通&lt;/li>
&lt;li>Automation（自动化）- 是指将人为干预的环节从价值链中消除&lt;/li>
&lt;li>Lean（精益）- 是指通过使用精益原则促使高频率循环周期&lt;/li>
&lt;li>Metrics（指标）- 是指衡量每一个环节，并通过数据来改进循环周期&lt;/li>
&lt;li>Sharing（分享）- 是指与他人开放分享成功与失败的经验，并在错误中不断学习改进&lt;/li>
&lt;/ul>
&lt;p>“CALMS”完全吻合Patrick DeBois先生所一向倡导的“DevOps is a human problem” (DevOps 是关于人的问题) 的理念 。&lt;/p>
&lt;h2 id="devopsdays活动的现状">DevOpsDays活动的现状
&lt;/h2>&lt;p>从DevOps概念的产生，到如今它在全球范围内的蔓延和认同，已经经历了9个年头的时间。它的火爆推广也伴随着IT行业的迅速变迁和发展，现在已经到了移动互联网时代的后半场，国内的信息化建设已经完成了很多年；如今各行各业的企业也都亟待完成全方位的数字化转型。IT信息技术的先进程度标志着一个企业的核心能力，任何一个成功的企业，敏捷高效的软件开发创新实力和IT管理综合能力不只是门面而已，而是实实在在的市场竞争能力。DevOps倡导打敏捷、持续交付和ITIL三种实践的组合拳，同时应用精益生产理念为基础的管理思想，这正在逐渐地被广泛的接受和认可。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/devopsdays-map.png"
loading="lazy"
alt="devopsdays-map"
>&lt;/p>
&lt;p>在过去的几年中，国内的各种IT大会也蓬勃发展，其中DevOps相关的专题和分会场也颇受人们的关注。各种云计算、运维等IT技术的社交媒体也都非常重视DevOps这个话题的分享。一个专属于DevOps社群的、国际性的、有影响力的DevOps大会正呼之欲出。在这样的时代背景下DevOpsDays大会北京站在2017年的3月18日来到中国，在同年的8月18日上海，还要举办DevOpsDays Shanghai站的大会。&lt;/p>
&lt;p>下面列举一些DevOpsDays大会的相关数据，&lt;!-- raw HTML omitted -->数据来源于DevOpsDays.org&lt;!-- raw HTML omitted --> 网站。从2009年到2016年，已经在全球的61个城市/国家成功地举办了117场。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/year.png"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://martinliu.cn/images/devops-citys.png"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>在谈这个话题前先看一下DevOps相关工具集的全貌，如下图所示：&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/devops-tools.png"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://martinliu.cn/images/devops-v20.png"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://martinliu.cn/images/devops-house.png"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;p>（上图来源于：Exin DevOps白皮书）&lt;!-- raw HTML omitted -->&lt;/p>
&lt;!-- raw HTML omitted --></description></item><item><title>用Minikube体验单节点K8S</title><link>https://martinliu.cn/blog/install-minikube-k8s/</link><pubDate>Thu, 21 Sep 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/install-minikube-k8s/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-1.jpg" alt="Featured image of post 用Minikube体验单节点K8S" />&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://martinliu.cn/images/minikube-logo.png"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>Usage:
minikube [command]&lt;/p>
&lt;p>Available Commands:
addons Modify minikube&amp;rsquo;s kubernetes addons
completion Outputs minikube shell completion for the given shell (bash)
config Modify minikube config
dashboard Opens/displays the kubernetes dashboard URL for your local cluster
delete Deletes a local kubernetes cluster
docker-env Sets up docker env variables; similar to &amp;lsquo;$(docker-machine env)&amp;rsquo;
get-k8s-versions Gets the list of available kubernetes versions available for minikube
ip Retrieves the IP address of the running cluster
logs Gets the logs of the running localkube instance, used for debugging minikube, not user code
mount Mounts the specified directory into minikube
profile Profile sets the current minikube profile
service Gets the kubernetes URL(s) for the specified service in your local cluster
ssh Log into or run a command on a machine with SSH; similar to &amp;lsquo;docker-machine ssh&amp;rsquo;
ssh-key Retrieve the ssh identity key path of the specified cluster
start Starts a local kubernetes cluster
status Gets the status of a local kubernetes cluster
stop Stops a running local kubernetes cluster
update-context Verify the IP address of the running cluster in kubeconfig.
version Print the version of minikube&lt;/p>
&lt;p>Flags:
&amp;ndash;alsologtostderr log to standard error as well as files
-b, &amp;ndash;bootstrapper string The name of the cluster bootstrapper that will set up the kubernetes cluster. (default &amp;ldquo;localkube&amp;rdquo;)
-h, &amp;ndash;help help for minikube
&amp;ndash;log_backtrace_at traceLocation when logging hits line file:N, emit a stack trace (default :0)
&amp;ndash;log_dir string If non-empty, write log files in this directory
&amp;ndash;loglevel int Log level (0 = DEBUG, 5 = FATAL) (default 1)
&amp;ndash;logtostderr log to standard error instead of files
-p, &amp;ndash;profile string The name of the minikube VM being used.
This can be modified to allow for multiple minikube instances to be run independently (default &amp;ldquo;minikube&amp;rdquo;)
&amp;ndash;stderrthreshold severity logs at or above this threshold go to stderr (default 2)
-v, &amp;ndash;v Level log level for V logs
&amp;ndash;vmodule moduleSpec comma-separated list of pattern=N settings for file-filtered logging&lt;/p>
&lt;p>Use &amp;ldquo;minikube [command] &amp;ndash;help&amp;rdquo; for more information about a command.
&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>Starting local Kubernetes v1.7.5 cluster&amp;hellip;
Starting VM&amp;hellip;
Getting VM IP address&amp;hellip;
Moving files into cluster&amp;hellip;
Setting up certs&amp;hellip;
Connecting to cluster&amp;hellip;
Setting up kubeconfig&amp;hellip;
Starting cluster components&amp;hellip;
Kubectl is now configured to use the cluster.
&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h1 id="we-have-now-launched-an-echoserver-pod-but-we-have-to-wait-until-the-pod-is-up-before-curlingaccessing-it">We have now launched an echoserver pod but we have to wait until the pod is up before curling/accessing it
&lt;/h1>&lt;h1 id="via-the-exposed-service">via the exposed service
&lt;/h1>&lt;h1 id="to-check-whether-the-pod-is-up-and-running-we-can-use-the-following">To check whether the pod is up and running we can use the following
&lt;/h1>&lt;p>$ kubectl get pod
NAME READY STATUS RESTARTS AGE
hello-minikube-3383150820-vctvh 1/1 ContainerCreating 0 3s&lt;/p>
&lt;h1 id="we-can-see-that-the-pod-is-still-being-created-from-the-containercreating-status">We can see that the pod is still being created from the ContainerCreating status
&lt;/h1>&lt;p>$ kubectl get pod
NAME READY STATUS RESTARTS AGE
hello-minikube-3383150820-vctvh 1/1 Running 0 13s&lt;/p>
&lt;h1 id="we-can-see-that-the-pod-is-now-running-and-we-will-now-be-able-to-curl-it">We can see that the pod is now Running and we will now be able to curl it
&lt;/h1>&lt;p>$ curl $(minikube service hello-minikube &amp;ndash;url)
CLIENT VALUES:
client_address=172.17.0.2
command=GET
real path=/
query=nil
request_version=1.1
request_uri=&lt;a class="link" href="http://192.168.99.100:8080/" target="_blank" rel="noopener"
>http://192.168.99.100:8080/&lt;/a>&lt;/p>
&lt;p>SERVER VALUES:
server_version=nginx: 1.10.0 - lua: 10001&lt;/p>
&lt;p>HEADERS RECEIVED:
accept=&lt;em>/&lt;/em>
host=192.168.99.100:31721
user-agent=curl/7.54.0
BODY:
-no body in request-%
&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>$ APISERVER=$(kubectl config view | grep https | cut -f 2- -d &amp;ldquo;:&amp;rdquo; | tr -d &amp;quot; &amp;ldquo;)&lt;/p>
&lt;p>$ curl $APISERVER &amp;ndash;header &amp;ldquo;Authorization: Bearer $TOKEN&amp;rdquo; &amp;ndash;insecure
{
&amp;ldquo;paths&amp;rdquo;: [
&amp;ldquo;/api&amp;rdquo;,
&amp;ldquo;/api/v1&amp;rdquo;,
&amp;ldquo;/apis&amp;rdquo;,
&amp;ldquo;/apis/&amp;rdquo;,
&amp;ldquo;/apis/admissionregistration.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/admissionregistration.k8s.io/v1alpha1&amp;rdquo;,
&amp;ldquo;/apis/apiextensions.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/apiextensions.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/apiregistration.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/apiregistration.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/apps&amp;rdquo;,
&amp;ldquo;/apis/apps/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/authentication.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/authentication.k8s.io/v1&amp;rdquo;,
&amp;ldquo;/apis/authentication.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/authorization.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/authorization.k8s.io/v1&amp;rdquo;,
&amp;ldquo;/apis/authorization.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/autoscaling&amp;rdquo;,
&amp;ldquo;/apis/autoscaling/v1&amp;rdquo;,
&amp;ldquo;/apis/autoscaling/v2alpha1&amp;rdquo;,
&amp;ldquo;/apis/batch&amp;rdquo;,
&amp;ldquo;/apis/batch/v1&amp;rdquo;,
&amp;ldquo;/apis/batch/v2alpha1&amp;rdquo;,
&amp;ldquo;/apis/certificates.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/certificates.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/extensions&amp;rdquo;,
&amp;ldquo;/apis/extensions/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/networking.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/networking.k8s.io/v1&amp;rdquo;,
&amp;ldquo;/apis/policy&amp;rdquo;,
&amp;ldquo;/apis/policy/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/rbac.authorization.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/rbac.authorization.k8s.io/v1alpha1&amp;rdquo;,
&amp;ldquo;/apis/rbac.authorization.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/settings.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/settings.k8s.io/v1alpha1&amp;rdquo;,
&amp;ldquo;/apis/storage.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/storage.k8s.io/v1&amp;rdquo;,
&amp;ldquo;/apis/storage.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/healthz&amp;rdquo;,
&amp;ldquo;/healthz/autoregister-completion&amp;rdquo;,
&amp;ldquo;/healthz/ping&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/apiservice-registration-controller&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/apiservice-status-available-controller&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/bootstrap-controller&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/ca-registration&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/extensions/third-party-resources&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/generic-apiserver-start-informers&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/kube-apiserver-autoregistration&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/start-apiextensions-controllers&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/start-apiextensions-informers&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/start-kube-aggregator-informers&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/start-kube-apiserver-informers&amp;rdquo;,
&amp;ldquo;/logs&amp;rdquo;,
&amp;ldquo;/metrics&amp;rdquo;,
&amp;ldquo;/swagger-2.0.0.json&amp;rdquo;,
&amp;ldquo;/swagger-2.0.0.pb-v1&amp;rdquo;,
&amp;ldquo;/swagger-2.0.0.pb-v1.gz&amp;rdquo;,
&amp;ldquo;/swagger.json&amp;rdquo;,
&amp;ldquo;/swaggerapi&amp;rdquo;,
&amp;ldquo;/ui&amp;rdquo;,
&amp;ldquo;/ui/&amp;rdquo;,
&amp;ldquo;/version&amp;rdquo;
]
}%&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://martinliu.cn/images/Overview---Kubernetes-Dashboard.jpg"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted --></description></item><item><title>DevOps术语表</title><link>https://martinliu.cn/2017/01/07/devops-glossary/</link><pubDate>Sat, 07 Jan 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/2017/01/07/devops-glossary/</guid><description>&lt;img src="https://martinliu.cn/images/pexels-photo.jpg" alt="Featured image of post DevOps术语表" />&lt;h2 id="简介">简介
&lt;/h2>&lt;p>这份术语表的旨在为DevOps实践者提供参考，在重要的专业术语上保持一致。最初的来源是《DevOps Handbook》英文版。译者在翻译的过程中，梳理和总结了一部分。Exin的DOP认证考试基于此书，考试样题也影响和参考了本术语表。本术语表是开放的，欢迎各界业内人士对其修订和增补。目标是形成一份较为完整和准确的参考资料。参与修订的方式见页脚。欢迎但不限于以下方面的专家参与评审和修订：&lt;/p>
&lt;ul>
&lt;li>敏捷开发&lt;/li>
&lt;li>精益/精益UX/精益创业&lt;/li>
&lt;li>丰田生产系统&lt;/li>
&lt;li>ITIL&lt;/li>
&lt;li>互联网公司&lt;/li>
&lt;li>传统企业&lt;/li>
&lt;/ul>
&lt;p>这个页面的另外一个存在：&lt;a class="link" href="https://handbook.martinliu.cn/glossary/" target="_blank" rel="noopener"
>https://handbook.martinliu.cn/glossary/&lt;/a>&lt;/p>
&lt;h2 id="变更日志">变更日志
&lt;/h2>&lt;ul>
&lt;li>2017年1月7日，在Martin‘s Blog和Github上发布了第一个版本。有几个人在Github上参与了修订（请参与者通过邮件或者其他方式告诉我，这里希望再次申明致谢。）&lt;/li>
&lt;li>2017年12月27日，参与修订的人包括卢梦纯（Exin）、刘征、张乐、Wang Jun和许峰。&lt;/li>
&lt;li>本网页当前接受繁体中文的增补，&lt;a class="link" href="https://github.com/DevOps-Handbook/DevOps-Handbook.github.io/graphs/contributors" target="_blank" rel="noopener"
>所有参与者名单&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="术语表">术语表
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>英文&lt;/th>
&lt;th>中文&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>A/B Testing&lt;/td>
&lt;td>A/B测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Acceptance Stage&lt;/td>
&lt;td>验收阶段&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Acceptance Test-Driven Development (Atdd)&lt;/td>
&lt;td>验收测试驱动开发&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Acceptance Tests&lt;/td>
&lt;td>验收测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Accident&lt;/td>
&lt;td>事故&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Affinity&lt;/td>
&lt;td>亲和&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Agile&lt;/td>
&lt;td>敏捷&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Andon Cord&lt;/td>
&lt;td>安灯拉绳&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Anomaly Detection Techniques&lt;/td>
&lt;td>异常探测技术&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Antifragility&lt;/td>
&lt;td>抗脆弱性&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Application Deployment&lt;/td>
&lt;td>应用部署&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Artifact Management&lt;/td>
&lt;td>构件制品库管理&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Artifacts&lt;/td>
&lt;td>制品&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Automated Tests&lt;/td>
&lt;td>自动化测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Automation&lt;/td>
&lt;td>自动化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Backlog&lt;/td>
&lt;td>待办事项列表&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Bad Apple Theory&lt;/td>
&lt;td>坏苹果理论&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Bad Paths&lt;/td>
&lt;td>失败路径&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Batch Sizes&lt;/td>
&lt;td>批次尺寸、批量大小&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Blame&lt;/td>
&lt;td>责备&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Blameless Post Mortem&lt;/td>
&lt;td>免责事后分析&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Blamelessness&lt;/td>
&lt;td>免责&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Blue-Green Deployment&lt;/td>
&lt;td>蓝绿部署&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Blue-Green Deployment Pattern&lt;/td>
&lt;td>蓝绿部署模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Branching Strategy&lt;/td>
&lt;td>分支策略&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Brownfield&lt;/td>
&lt;td>棕地&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Build&lt;/td>
&lt;td>构建&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Business Value&lt;/td>
&lt;td>业务价值&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Canary Release&lt;/td>
&lt;td>金丝雀发布&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Canary Release Pattern&lt;/td>
&lt;td>金丝雀发布模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Card&lt;/td>
&lt;td>卡片&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Change Categories&lt;/td>
&lt;td>变更类别&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Change Schedules&lt;/td>
&lt;td>变更计划&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Cloud Computing&lt;/td>
&lt;td>云计算&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Cloud Configuration Files&lt;/td>
&lt;td>云配置文件&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Cluster Immune System Release Pattern&lt;/td>
&lt;td>集群免疫系统发布模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Code Branch&lt;/td>
&lt;td>代码分支&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Code Review Forms&lt;/td>
&lt;td>代码审查表&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Codified Nfr&lt;/td>
&lt;td>成文的非功能需求&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Collaboration&lt;/td>
&lt;td>协作&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Commit Stage&lt;/td>
&lt;td>提交阶段&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Commit Code&lt;/td>
&lt;td>提交代码&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Compliance Requirement&lt;/td>
&lt;td>合规性要求&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Compliance Checking&lt;/td>
&lt;td>合规性检查&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Compliancy Officer&lt;/td>
&lt;td>合规检测官&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Configuration Management&lt;/td>
&lt;td>配置管理&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Container(S)&lt;/td>
&lt;td>容器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Continuous Deployment&lt;/td>
&lt;td>持续部署&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Continuous Integration&lt;/td>
&lt;td>持续集成(CI)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Continuous Delivery&lt;/td>
&lt;td>持续交付(CD)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Conways Law&lt;/td>
&lt;td>康威定律&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Cycle Time&lt;/td>
&lt;td>周期时间&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Defect Tracking&lt;/td>
&lt;td>缺陷跟踪&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Definition Of Done (Dod)&lt;/td>
&lt;td>完成的定义&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Dev Rituals&lt;/td>
&lt;td>开发仪式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Developer&lt;/td>
&lt;td>开发人员&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Development&lt;/td>
&lt;td>开发&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Devops Transformation&lt;/td>
&lt;td>DevOps转型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Downstream/Upstream&lt;/td>
&lt;td>下游/上游&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Downwards Spiral&lt;/td>
&lt;td>恶性循环&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>E-Mail Pass-Around&lt;/td>
&lt;td>电子邮件轮查&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Expand/Contract Pattern&lt;/td>
&lt;td>扩张/收缩模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Exploratory Test&lt;/td>
&lt;td>探索性测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Fast Feedback&lt;/td>
&lt;td>快速反馈&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Feature&lt;/td>
&lt;td>特性&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Feature Flag&lt;/td>
&lt;td>特性标志&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Feature Toggles&lt;/td>
&lt;td>特性开关&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Feedback/Feedback Loop&lt;/td>
&lt;td>反馈/反馈回路&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Feedforward/Feedforward Loop&lt;/td>
&lt;td>前馈/前馈回路&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Flow&lt;/td>
&lt;td>流&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Gated Commit&lt;/td>
&lt;td>门控提交&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Gaussian Distribution&lt;/td>
&lt;td>高斯分布&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Green Build&lt;/td>
&lt;td>绿色构建&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Greenfield&lt;/td>
&lt;td>绿地&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Handoff&lt;/td>
&lt;td>交接&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Hand-Off Readiness Review&lt;/td>
&lt;td>交接就绪评审&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Happy Paths&lt;/td>
&lt;td>快乐路径&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Hypothesis-Driven Development&lt;/td>
&lt;td>假设驱动开发&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Incident&lt;/td>
&lt;td>事件&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Information Radiators&lt;/td>
&lt;td>信息辐射器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Infosec&lt;/td>
&lt;td>信息安全&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Infrastructure Automation&lt;/td>
&lt;td>基础架构自动化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Infrastructure As Code&lt;/td>
&lt;td>基础设施即代码&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Integration Tests&lt;/td>
&lt;td>集成测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>I-Shaped, T-Shaped, E-Shaped&lt;/td>
&lt;td>I型，T型，E型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Iteration&lt;/td>
&lt;td>迭代&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Itsm (It Service Management)&lt;/td>
&lt;td>IT服务管理&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Ji-Kotei-Kanketsu (Jkk)&lt;/td>
&lt;td>质量检查（JKK）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Just Culture&lt;/td>
&lt;td>公正文化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Just-In-Time (Jit)&lt;/td>
&lt;td>准时制&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Kaizen (In Lean)&lt;/td>
&lt;td>持续改善&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Kaizen Blitz (Or Improvement Blitz)&lt;/td>
&lt;td>持续改善闪电战&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Kanban&lt;/td>
&lt;td>看板&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Kata&lt;/td>
&lt;td>Kata&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Large Batch Size Merge&lt;/td>
&lt;td>大批量合并&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Latent Defects&lt;/td>
&lt;td>潜在缺陷&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Lauching Guidance&lt;/td>
&lt;td>发布指导&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Launch Readiness Review&lt;/td>
&lt;td>投产就绪评审&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Lead Time&lt;/td>
&lt;td>前置时间&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Lean&lt;/td>
&lt;td>精益&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Learning Culture&lt;/td>
&lt;td>学习文化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Logging Levels&lt;/td>
&lt;td>日志级别&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Loosely Coupled Architecture&lt;/td>
&lt;td>松耦合架构&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Micro-Services&lt;/td>
&lt;td>微服务&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Minimum Viable Product&lt;/td>
&lt;td>最小化可行产品&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monitoring Framework&lt;/td>
&lt;td>监控框架&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monolithic Applications&lt;/td>
&lt;td>单体应用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monolytics&lt;/td>
&lt;td>单体应用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Mttr&lt;/td>
&lt;td>平均恢复时间&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Non-Functional Requirement (Nfr)&lt;/td>
&lt;td>非功能性需求&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Non-Functional Requirement (Nfr) Testing&lt;/td>
&lt;td>非功能需求测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>(Non) Ideal Testing Pyramid&lt;/td>
&lt;td>（非）理想测试金字塔模型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>One-Piece-Flow&lt;/td>
&lt;td>单件流&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Operations&lt;/td>
&lt;td>运维&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Operations Story&lt;/td>
&lt;td>运维故事&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Ops Liaison&lt;/td>
&lt;td>运维联络人&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Organisational Typology Model&lt;/td>
&lt;td>组织结构模型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Organization Archetypes&lt;/td>
&lt;td>组织原型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Organizational Learning&lt;/td>
&lt;td>组织级学习&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Over-The-Shoulder&lt;/td>
&lt;td>观察者评审&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Packages&lt;/td>
&lt;td>包&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Pair Programming&lt;/td>
&lt;td>结对编程&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Peer Review&lt;/td>
&lt;td>同行评审&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Pilot&lt;/td>
&lt;td>试点&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Pipeline&lt;/td>
&lt;td>流水线&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Plan-Do-Check-Act Cycle (Pdca Cycle)&lt;/td>
&lt;td>计划-实施-检查-改进 （戴明环）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Post Mortems&lt;/td>
&lt;td>事后回顾&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Post-Mortem&lt;/td>
&lt;td>事后剖析&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Process Time&lt;/td>
&lt;td>处理时间&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Product Owner&lt;/td>
&lt;td>产品负责人&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Pull Request Process&lt;/td>
&lt;td>拉动请求流程&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Qa&lt;/td>
&lt;td>质量保证&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Reduce Batch Size&lt;/td>
&lt;td>降低批次尺寸&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Reduce Number Of Handoffs&lt;/td>
&lt;td>减少交接次数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Regression Test&lt;/td>
&lt;td>回归测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Release Branch&lt;/td>
&lt;td>发布分支&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Release Managers&lt;/td>
&lt;td>发布经理&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Release Patterns&lt;/td>
&lt;td>发布模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Retrospective&lt;/td>
&lt;td>回顾&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Rhythm&lt;/td>
&lt;td>节奏&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Roll-Back&lt;/td>
&lt;td>回滚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Sad Path&lt;/td>
&lt;td>悲伤路径&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Safety Culture&lt;/td>
&lt;td>安全文化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Safety Conditions&lt;/td>
&lt;td>安全条件&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Scaling&lt;/td>
&lt;td>规模化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Scrum&lt;/td>
&lt;td>Scrum&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Scrum Master&lt;/td>
&lt;td>Scrum Master&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Security Testing&lt;/td>
&lt;td>安全测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Self Service Capability&lt;/td>
&lt;td>自服务能力&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Service Deployment&lt;/td>
&lt;td>服务部署&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Service Level Agreement (Sla)&lt;/td>
&lt;td>服务级别协议(SLA)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Shared Goals&lt;/td>
&lt;td>共享目标&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Shared Operations Team (Sot)&lt;/td>
&lt;td>共享运维团队&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Shared Version Control&lt;/td>
&lt;td>共享版本控制&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Single Repository&lt;/td>
&lt;td>单一存储库&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Smoke Testing&lt;/td>
&lt;td>冒烟测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Sprint&lt;/td>
&lt;td>冲刺&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Staging&lt;/td>
&lt;td>Staging&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Staging Environments, Sit&lt;/td>
&lt;td>准生产环境&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Stakeholder&lt;/td>
&lt;td>利益干系人&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Standard Deviation&lt;/td>
&lt;td>标准差&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Standard Operations&lt;/td>
&lt;td>标准运维&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Static Code Analysis&lt;/td>
&lt;td>静态代码分析&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Swarm&lt;/td>
&lt;td>聚集、聚焦、会诊、围观（动词）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Swarming&lt;/td>
&lt;td>聚集&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>System Of Engagement (Soe)&lt;/td>
&lt;td>交互系统&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>System Of Records (Sor)&lt;/td>
&lt;td>记录系统&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Technical Debt&lt;/td>
&lt;td>技术债务&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Technology Adaption Curve&lt;/td>
&lt;td>技术适应曲线&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Technology Executives&lt;/td>
&lt;td>技术主管&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Telemetry&lt;/td>
&lt;td>遥测&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Test Coverage Analysis&lt;/td>
&lt;td>测试覆盖率分析&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Test Story&lt;/td>
&lt;td>测试故事&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Test-Driven Development&lt;/td>
&lt;td>测试驱动开发&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>The Downward Spiral - Tds&lt;/td>
&lt;td>下行螺旋&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>The Agile Manifesto&lt;/td>
&lt;td>敏捷宣言&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>The Lean Movement&lt;/td>
&lt;td>精益运动&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>The Simian Army: Chaos Gorilla, Chaos Kong, Conformity Monkey, Doctor Monkey, Janitor,Monkey, Latency Monkey, Security Monkey&lt;/td>
&lt;td>猿猴军团（可靠性监控服务），Chaos Gorilla（混沌大猩猩）， Chaos Kong（混沌金刚）, Conformity Monkey（一致性猴子）, Doctor Monkey（医生猴子）, Janitor Monkey（看门猴子）, Latency Monkey（延迟猴子）, Security Monkey（安全猴子）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>The Three Ways&lt;/td>
&lt;td>三步工作法&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Theory Of Constraints&lt;/td>
&lt;td>约束理论&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Ticketing System&lt;/td>
&lt;td>工单系统&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tightly-Coupled&lt;/td>
&lt;td>紧耦合&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tool-Assisted Review&lt;/td>
&lt;td>工具辅助评审&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tools&lt;/td>
&lt;td>工具&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Toyota Production System (Tps)&lt;/td>
&lt;td>丰田生产系统&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Toyoto Kata&lt;/td>
&lt;td>丰田套路&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Transformation Team&lt;/td>
&lt;td>转型团队&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Trunk&lt;/td>
&lt;td>主干&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>User Story&lt;/td>
&lt;td>用户故事&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Value Stream Mapping&lt;/td>
&lt;td>价值流映射&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Value Stream&lt;/td>
&lt;td>价值流&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Velocity&lt;/td>
&lt;td>速率&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Version Control&lt;/td>
&lt;td>版本控制&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Virtualized Environment&lt;/td>
&lt;td>虚拟化环境&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Visible&lt;/td>
&lt;td>可视的&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Visualisation&lt;/td>
&lt;td>可视化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Waste&lt;/td>
&lt;td>浪费&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Waste Reduction&lt;/td>
&lt;td>减少浪费&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Waterfall&lt;/td>
&lt;td>瀑布式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wip (Work In Progress / Process)&lt;/td>
&lt;td>在制品&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wip Limit&lt;/td>
&lt;td>在制品限制&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Work Center&lt;/td>
&lt;td>工作中心&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="参与修订说明">参与修订说明
&lt;/h2>&lt;p>请帮忙改进本术语表，请直接Fork本代码库，然后提交PR；或者发邮件到：&lt;a class="link" href="mailto:liuzh66@gmail.com" >liuzh66@gmail.com&lt;/a>&lt;/p>
&lt;p>建议最好提供修订原文的简要说明和参考依据。&lt;/p>
&lt;p>GitHub操作注意事项：&lt;/p>
&lt;ul>
&lt;li>建议Fork整个repo做批量更新，小批量可以直接在github网页上提交&lt;/li>
&lt;li>请不要完全删除之前的翻译，可以把旧翻译划横线（使用markdown），在右边添加新的中文意思。&lt;/li>
&lt;/ul></description></item><item><title>DevOps书单</title><link>https://martinliu.cn/2017/01/03/devops-booklist/</link><pubDate>Tue, 03 Jan 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/2017/01/03/devops-booklist/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/pexels-photo.jpg" alt="Featured image of post DevOps书单" />&lt;p>学习DevOps应该会使用到的书籍清单。&lt;/p>
&lt;p>我在豆瓣建立了一个书单，欢迎在豆瓣给我留言，评论和建议。&lt;a class="link" href="https://www.douban.com/doulist/46341810/" target="_blank" rel="noopener"
>豆瓣书单点这里。&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-25.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-22-24.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-19-21.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-16-18.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-13-15.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-10-12.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-7-9.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-4-6.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-1-3.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;hr>
&lt;p>本清单来自于《DevOps Handbook》书中提到的书，更新到第五本；《看板方法》、《精益思想》、《Implementing Lean Software Development: From Concept to Cash》、《第五项修炼:学习型组织的艺术与实践》、《探索吧!深入理解探索式软件测试》&lt;/p>
&lt;h2 id="看板方法-科技企業漸進變革成功之道">《看板方法-科技企業漸進變革成功之道》
&lt;/h2>&lt;p>转自：&lt;a class="link" href="https://ruddyblog.wordpress.com/2014/09/30/%E7%9C%8B%E6%9D%BF%E6%96%B9%E6%B3%95-%E7%A7%91%E6%8A%80%E4%BC%81%E6%A5%AD%E6%BC%B8%E9%80%B2%E8%AE%8A%E9%9D%A9%E6%88%90%E5%8A%9F%E4%B9%8B%E9%81%93/" target="_blank" rel="noopener"
>Rubbyblog.wordpress.com&lt;/a>/images/&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/kanban-book.png"
loading="lazy"
alt="kanban-book"
>&lt;/p>
&lt;p>今天要介紹看板方法的由來， 上面這本書是由看板方法之父 David J. Anderson 於: 2010年 4月所著。簡字版是 2014 年2月出版。這篇文章在我上 TechDays 課程時就想登出來了，想把好書介紹給大家。但由於台灣的書商都沒有進口，所以一直等到我拿到第一批書後，肯定大家可以在坊間買到書時才把他登出來。原文書名: Kanban: Successful Evolutionary Change for Your Technology Business.&lt;/p>
&lt;p>看板方法：它是敏捷陣營中實施起來阻力最小，生產力又能大幅提升、前置時間大幅下降，而可預測性又絕佳的敏捷解決方案之一。好神奇喔 … 哈哈! 確實如此，所以我才會這麼急切的推薦給大家。另一個原因是Kanban Method 現在在美國正熱烈風行中，而我們現在開始追正是時候。為此放下了許多手上正在做的工作(包括一本 Scrum的教本)，努力開始推廣希望大家能受用。首先說明: 為何他推廣起來阻力最小?&lt;/p>
&lt;p>※ 實施起來阻力最小:&lt;/p>
&lt;p>因為David J. Anderson 本身是一個微軟的 PM出身，他跟大家一樣知道變革會讓許多人害怕，人們會認為自己的技術是否落伍了，開始擔心害怕變革會對自己的工作事業帶來不利，這種恐懼常常會帶來一種莫名的對立，因此在還沒開始變革之前就已經採取抵制的態度了。所以他創始的看板方法選擇從哪裡開始實施呢? 就從現在既有的流程開始。由工作者本身最熟悉的地方開始。起步的秘訣是甚麼呢? 是精實精神中從豐田系統中學來的原則，先從不浪費開始，作法: 在識別浪費後消除浪費。&lt;/p>
&lt;p>※ 如何能讓生產力大幅提升?&lt;/p>
&lt;p>由審視既有流程，依據 Little’s law的最大產出方法，接著找出阻礙最大產能的瓶頸所在，然後正視這個造成瓶頸的問題，把它顯現在看板上面，讓大家一起站在看板前面討論如何解決它，解決之後再持續進行改善的作業。&lt;/p>
&lt;p>※ 前置時間大幅下降&lt;/p>
&lt;p>過去我們都以為唯有透過良好的規劃及配合才能夠讓前置作業時間下降，但豐田企業的及時(Just In Time)備料讓庫存降至最低，讓半成品減至最少改變了工作流程的前置時間(Lead time)，因此得到大幅下降。&lt;/p>
&lt;p>看板還是看板方法 (Kanban or Kanban Method) 英文叫 Kanban，上網去搜尋會得到一大堆有關製造業的看板資料。所以請使用 Kanban Method去搜尋，因此中文就該叫做「看板方法」。簡體版的作者有用心在翻譯因此翻對了，值得買來閱讀。全書分成四部分:&lt;/p>
&lt;p>※ 第一部分；導讀: 作者說出他的想法，以及創作看板方法的原由。&lt;/p>
&lt;p>※ 第二部分；談使用看板方法的好處: 這裡有他個人做顧問時的經驗談，值得仔細閱讀。&lt;/p>
&lt;p>※ 第三部分；開始談實施看板方法的步驟了。(由六到十五章，好長又夠完整)&lt;/p>
&lt;p>※ 第四部分；談持續改進。在這裡你終於可以感受到精實軟體開發對作者的影響，以及作者由經濟學的角度來看精實軟體開發的第一原則: 消除浪費。&lt;/p>
&lt;p>接下來我就不在多說了，請讀者自己去看吧!(透漏一下，為了共襄盛舉，我正在寫一本有關精實開發的書，內容除了看板方法之外會大幅談到精實軟體開發，在這裡不想打廣告，因此書名就等出版後再說了!)&lt;/p>
&lt;h2 id="精益思想白金版">精益思想(白金版)
&lt;/h2>&lt;p>这本书在亚马逊中国有售：&lt;a class="link" href="https://www.amazon.cn/%e7%b2%be%e7%9b%8a%e6%80%9d%e6%83%b3-%e8%a9%b9%e5%a7%86%e6%96%afP-%e6%b2%83%e9%ba%a6%e5%85%8b" target="_blank" rel="noopener"
>https://www.amazon.cn/精益思想-詹姆斯P-沃麦克&lt;/a>
&lt;img src="https://martinliu.cn/images/14836204523398.jpg"
loading="lazy"
>&lt;/p>
&lt;p>&lt;strong>简介&lt;/strong>&lt;/p>
&lt;p>《精益思想》于1996年秋季首次出版，历经20年，畅 销十多个国家，累计销量上百万册。本书的成功在于它对精益生产方式做了最 好的总结，为读者提供了精益的核心原则，实地考察了美国、德国、日本若干具有代表性的大小企业推行精益的实际情况和心得，为准备跨入精益之门和进一步学习、实施精益的人提供了最 好的指南，从而成为精益方面的经典著作。&lt;/p>
&lt;p>&lt;strong>基本信息&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">出版社: 机械工业出版社; 第1版 (2015年8月1日)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">外文书名: Lean Thinking ：Banish Waste and Create Wealth in Your Corporation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">丛书名: 精益思想丛书
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">平装: 365页
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">语种： 简体中文
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">开本: 16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN: 7111510712, 9787111510710
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">条形码: 9787111510710
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品尺寸: 24 x 17.4 x 1.8 cm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品重量: 621 g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">品牌: 机械工业出版社
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ASIN: B0142EC7AA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">用户评分: 平均4.5 星 浏览全部评论 (82 条商品评论)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">亚马逊热销商品排名: 图书商品里排第7,694名
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="implementing-lean-software-development-from-concept-to-cash">Implementing Lean Software Development: From Concept to Cash
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14837758468347.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="基本信息">基本信息
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">出版社: Addison-Wesley Professional; 1 (2009年10月31日)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">丛书名: Addison-Wesley Signature Series (Beck)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">平装: 312页
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">语种： 英语
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN: 0321620704
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">条形码: 9780321620705
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品尺寸: 17.5 x 1.8 x 22.9 cm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品重量: 499 g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">品牌: Pearson
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ASIN: 0321620704
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">用户评分: 分享我的评价
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">亚马逊热销商品排名: 图书商品里排第1,441,726名 (查看图书商品销售排行榜)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">第64位 - 图书 &amp;gt; 进口原版书 &amp;gt; Computers &amp;amp; Technology（计算机与科技） &amp;gt; Business &amp;amp; Management（商业与管理） &amp;gt; Project Management
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">第393位 - 图书 &amp;gt; 进口原版书 &amp;gt; Computers &amp;amp; Technology（计算机与科技） &amp;gt; Programming（编程） &amp;gt; Software Design, Testing &amp;amp; Engineering &amp;gt; Software Development
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="作者简介">作者简介
&lt;/h3>&lt;p>Mary Poppendieck has led teams implementing various solutions ranging from enterprise supply chain management to digital media. Mary is the president of Poppendieck LLC, which specializes in bringing lean techniques to software development.&lt;/p>
&lt;p>Tom Poppendieck, an enterprise analyst, architect, and agile process mentor, currently assists organizations in applying lean principles and tools to software development processes. The Poppendiecks are authors of Lean Software Development, winner of the 2004 Jolt Software Development Productivity Award, and Implementing Lean Software Development (both from Addison-Wesley).&lt;/p>
&lt;h2 id="the-fifth-discipline-the-art--practice-of-the-learning-organization">The Fifth Discipline: The Art &amp;amp; Practice of The Learning Organization
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14840700653952.jpg"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/14840700772382.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="基本信息--第五项修炼学习型组织的艺术与实践">基本信息 第五项修炼：学习型组织的艺术与实践
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">出版社: 中信出版社; 第1版 (2009年10月1日)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">外文书名: The Fifth Discipline:The Art &amp;amp; Practice of The Learning Organization
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">平装: 455页
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">语种： 简体中文
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">开本: 16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN: 7508616820, 9787508616827
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">条形码: 9787508616827
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品尺寸: 22.8 x 17 x 2.8 cm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品重量: 739 g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">品牌: 中信出版股份有限公司
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ASIN: B002QMKJ4C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">用户评分: 平均4.5 星 浏览全部评论 (322 条商品评论)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">亚马逊热销商品排名: 图书商品里排第1,333名 (查看图书商品销售排行榜)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">第6位 - 图书 &amp;gt; 经济管理 &amp;gt; 管理学理论与方法论 &amp;gt; 管理学基础理论
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">第17位 - 图书 &amp;gt; 经济管理 &amp;gt; 企业经营与管理 &amp;gt; 管理指南
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">第617位 - 图书 &amp;gt; 在线试读
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="编辑推荐">编辑推荐
&lt;/h3>&lt;p>《第五项修炼:学习型组织的艺术与实践(新世纪全新扩充修订版)》由当代最杰出的新管理大师彼得•圣吉撰写的著作，被誉为21世纪的管理圣经、20世纪屈指可数的几本管理经典、世界上影响最深远的管理书籍之一，并被《哈佛商业评论》评为过去75年具有影响力的管理类图书，还荣获世界企业学会荣誉的开拓者奖！
进入21世纪以来，全球经济的迅猛发展，使得全球企业管理趋势、管理理念也顺应发生了巨大的变化，作为新世纪全新扩充修订版，《第五项修炼:学习型组织的艺术与实践(新世纪全新扩充修订版)》其背后是15年来把原书理念付诸实践的经验和案例。圣吉明确指出，从长远来看，你的组织可持续的竞争优势，就是比对手更好更快的学习能力。15年前，许多《第五项修炼》的核心理念都曾显得很激进。但这些理念的许多应用方法，后来已经被融入到人们观察世界的方式中，也被整合到人们的管理实践中；《第五项修炼:学习型组织的艺术与实践(新世纪全新扩充修订版)》对前一版进行了全面修订，新版书中的领导力案例故事揭示了这些经历。并增添了新的内容：实践中的反思，为企业、个人读者更准确理解最新管理理念，对学习型组织进行了有效的反思，对建设学习型组织所面临的新疑惑提供了新的思维。&lt;/p>
&lt;h3 id="名人推荐">名人推荐
&lt;/h3>&lt;p>流行的管理体系很摧残人……教育界、工商界和政府机构的管理层的任务，应该是使系统最优化……彼得·圣吉的著作《第五项修炼》是帮助开始这项工作的好书，它让我学到了许多东西。
——爱德华·戴明博士，全面质量管理运动(TQM）的先驱。&lt;/p>
&lt;h3 id="媒体推荐">媒体推荐
&lt;/h3>&lt;p>《第五项修炼》是过去75年来最有影响力的管理学著作之一。
——《哈佛商业评论》
圣吉的这本著作已经是一本不折不扣的管理学经典。
——《波士顿环球报》&lt;/p>
&lt;h3 id="作者简介-1">作者简介
&lt;/h3>&lt;p>作者：（美国）彼得•圣吉 译者：张成林&lt;/p>
&lt;p>彼得•圣吉博士（Dr.Peter M. Senge），麻省理工学院斯隆管理学院的高级教授讲师，国际组织学习学会（SoL）和索奥中国（SoL China）的创始主席。除《第五项修炼》之外，他还与人合著了《第五项修炼实践篇》（1994）、《变革之舞》（1999）、《学习型学校》（Schools that Learn, 2000）、《体悟当下》（Presence, 2004），以及最近出版的《必要的革命》（The Necessary Revolution, 2008）等著作。圣吉被誉为最富创新精神的世界级管理学和领导学思想大师之一。他早年毕业于斯坦福大学工程专业，并获得麻省理工社会系统模型硕士和管理学博士，现家居美国马萨诸塞州。&lt;/p>
&lt;h2 id="explore-it-reduce-risk-and-increase-confidence-with-exploratory-testing">Explore It!: Reduce Risk and Increase Confidence with Exploratory Testing
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14841498198916.jpg"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/14841498461381.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="探索吧深入理解探索式软件测试">探索吧!深入理解探索式软件测试
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">出版社: 机械工业出版社; 第1版 (2014年1月1日)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">外文书名: Explore It! Reduce Risk and Increase Confidence with Exploratory Testing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">丛书名: 软件工程技术丛书
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">平装: 151页
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">语种： 简体中文
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">开本: 16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN: 9787111451587
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">条形码: 9787111451587
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品尺寸: 24.2 x 16.8 x 0.8 cm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品重量: 281 g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">品牌: 机械工业出版社
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ASIN: B00IHQBQZC
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>编辑推荐
《探索吧!深入理解探索式软件测试》给出实用性很强的理念，可用于探索从典型GUI场景到测试软件需求的一切，还包括如何探索低层级代码的建议。此书不只是给软件测试人员看的，对软件管理人员、开发人员也具有重大意义。&lt;/p>
&lt;p>名人推荐
“Elisabeth开创了将探索式测试应用于敏捷开发的先河，并推动它不断演进，使其成为了一种主流实践。”
——Ward Cunnningham wiki概念的发明者 设计模式和敏捷软件方法的先驱之一&lt;/p>
&lt;p>“这是我看到的最佳书籍之一。优良的测试设计源自优良的测试思路，这本书里满是各种优秀的测试思路，辅以故事情节烘托，涎玉沫珠。”
——Alan Page 微软公司Principal SDEI《微软的软件测试之道》作者&lt;/p>
&lt;h2 id="the-field-guide-to-understanding-human-error">The Field Guide to Understanding &amp;lsquo;Human Error‘
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14842313763902.jpg"
loading="lazy"
>&lt;/p>
&lt;p>This latest edition of The Field Guide to Understanding ‘Human Error&amp;rsquo; will help you understand how to move beyond &amp;lsquo;human error&amp;rsquo;; how to understand accidents; how to do better investigations; how to understand and improve your safety work. You will be invited to think creatively and differently about the safety issues you and your organization face. In each, you will find possibilities for a new language, for different concepts, and for new leverage points to influence your own thinking and practice, as well as that of your colleagues and organization.&lt;/p>
&lt;h3 id="product-details">Product Details
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">File Size: 3149 KB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Print Length: 247 pages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Publisher: Ashgate; 3 edition (December 28, 2014)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Publication Date: December 28, 2014
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sold by: Amazon Digital Services LLC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Language: English
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ASIN: B00Q8XCSFI
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Text-to-Speech: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">X-Ray:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Not Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Word Wise: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Lending: Not Enabled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="about-the-author">About the Author
&lt;/h3>&lt;p>Sidney Dekker (PhD Ohio State University, USA, 1996) is currently professor at Griffith University in Brisbane, Australia, where he runs the Safety Science Innovation Lab. He is also Professor (Hon.) of psychology at The University of Queensland, and Professor (Hon.) of human factors and patient safety at the Royal Children&amp;rsquo;s Hospital in Brisbane. Previously, Sidney was Professor of human factors and system safety at Lund University in Sweden. After becoming full professor, he learned to fly the Boeing 737, working part-time as an airline pilot out of Copenhagen. Sidney is the best-selling author of a multitude of human factors and safety books, including, most recently, Safety Differently (2014), Second Victim (2013), Just Culture (2012), Drift into Failure (2011), and Patient Safety (2011).&lt;/p>
&lt;h2 id="lean-it-enabling-and-sustaining-your-lean-transformation">Lean IT: Enabling and Sustaining Your Lean Transformation
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14844093662859.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="review">Review
&lt;/h3>&lt;p>This book will have a permanent place in my bookshelf. In my ten-year study of high performing IT organizations, I’ve found that businesses rely on IT far more than they think. The impacts of poor flow from application development into IT operations can be devastating: ever increasing cycle times and amounts of rework, and an ever increasing amount of heroics required in IT operations to preserve the illusion of stability and reliability.
―Gene Kim, Chief Technology Officer, Tripwire, Inc.&lt;/p>
&lt;p>There has never been a more critical time to improve how IT integrates with the global business enterprise. This book provides an unprecedented look at the role that Lean will play in making this revolutionary shift and the critical steps for sustained success.
―Steve Castellanos, Lean Enterprise Director; Nike, Inc.&lt;/p>
&lt;p>Twenty years from now the firms which dominate their industries will have fully embraced lean strategies throughout their IT organizations. Ten years from now those organizations will have started pulling ahead of their competitors as the result of lean IT. Today this book will show those organizations the path they need to start out on. Will your organization be one of them?
―Scott W. Ambler, Chief Methodologist for Agile and Lean, IBM Rational&lt;/p>
&lt;p>&amp;hellip; goes both wide and deep in its exploration of Lean … a great survival manual for those needing nimble and adaptive systems.
―Dr. David Labby, MD, PhD, Medical Director and Director of Clinical Support and Innovation, CareOregon&lt;/p>
&lt;p>This book makes a major contribution in an often-ignored but much-needed area. It ranges over a huge area – including excellent cases – that will bring IT professionals into the Lean fold but will also enable Lean managers to reach out to IT.
―John Bicheno, Program Director MS in Lean Operations, Cardiff University&lt;/p>
&lt;p>… a comprehensive view into the world of Lean IT, a must read!
―Dave Wilson, Quality Management, Oregon Health &amp;amp; Science University&lt;/p>
&lt;h3 id="about-the-author-1">About the Author
&lt;/h3>&lt;p>Steve Bell, CFPIM brings over twenty years&amp;rsquo; experience in finance, operations management and information systems. He is the author of Lean Enterprise Systems, Using IT for Continuous Improvement. (2006)&lt;/p>
&lt;p>Mike Orzen, CMA, CFPIM, PMP delivers a unique blend of IT, operations management, Lean, Six Sigma, and project management. With a BA from Stanford University in economics and an MBA from the University of Oregon, Mike has been consulting, coaching, and teaching for over 20 years.&lt;/p>
&lt;p>Steve and Mike are faculty members of the Lean Enterprise Institute. Together, the authors combine their experience in information systems and process improvement to share their lessons learned.&lt;/p>
&lt;h3 id="product-details-1">Product Details
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Hardcover: 370 pages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Publisher: Productivity Press; 1 edition (September 14, 2010)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Language: English
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN-10: 1439817561
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN-13: 978-1439817568
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Product Dimensions: 6.1 x 1 x 9 inches
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Shipping Weight: 1.4 pounds (View shipping rates and policies)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Average Customer Review: 4.9 out of 5 stars See all reviews (20 customer reviews)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Amazon Best Sellers Rank: #129,956 in Books (See Top 100 in Books)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="true-north-discover-your-authentic-leadership">True North: Discover Your Authentic Leadership
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14844095698595.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="review-1">Review
&lt;/h3>&lt;p>&amp;ldquo;With great clarity and insight, Bill George and Peter Sims make a persuasive argument that the journey toward authentic leadership—that finding and pursuing your own True North&amp;ndash;is the key to leadership in all fields, whether in business, government, or the nonprofit arena.&amp;rdquo;
—From the Foreword by David Gergen&lt;/p>
&lt;p>&amp;ldquo;In True North, Bill George once again provides a roadmap for leadership in the 21st Century. The future belongs to leaders who want to win, without ever losing track of their own values. We live in a day when the best people can work anywhere. They will follow only authenticity—a person who leads with passion and purpose.&amp;rdquo;
—Jeff Immelt, CEO, General Electric&lt;/p>
&lt;p>&amp;ldquo;True North is an awe-inspiring gift to the world. The 125 men and women whose leadership journeys are so beautifully rendered in this book show us that we can have enormous impact without compromising our values—indeed, that we are more successful when we stay true to our ideals. Every aspiring leader (or leader who aspires to become even better) will draw strength and wisdom from this wonderful book.&amp;rdquo;
—Rosabeth Moss Kanter, Harvard Business School professor and best-selling author of Confidence: How Winning Streaks &amp;amp; Losing Streaks Begin &amp;amp; End&lt;/p>
&lt;p>&amp;ldquo;True North is about the power of authentic leadership. Great leaders are defined by a sense of passion and purpose and by a profound desire to make a difference. Anyone can find their own True North, if you care deeply and love what you do. This book is a wonderful roadmap for how to get started on the journey.&amp;rdquo;
—Andrea Jung, chairman and CEO, Avon Products, Inc.&lt;/p>
&lt;p>&amp;ldquo;If you want to move your leadership in the right direction, read True North. Drawing on the personal stories of some of the world’s most effective leaders, the book shows that you become a successful leader when you stay on course with your highest self.&amp;rdquo;
—Ken Blanchard, coauthor of The One Minute Manager® and Leading at a Higher Level&lt;/p>
&lt;p>&amp;ldquo;True North provides a new leadership paradigm and a window into the stories and approaches of dozens of our nation’s best leaders. It is an inspirational, invaluable source of guidance for those who want to make a significant impact.&amp;rdquo;
—Wendy Kopp, president and founder of Teach for America&lt;/p>
&lt;p>&amp;ldquo;True North reveals just how powerful authentic leadership can be and, best of all, how to achieve it.&amp;rdquo;
—Warren Bennis&lt;/p>
&lt;h3 id="product-details-2">Product Details
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Hardcover: 251 pages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Publisher: Jossey-Bass; 1 edition (March 9, 2007)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Language: English
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN-10: 0787987514
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN-13: 978-0787987510
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Product Dimensions: 6.3 x 1 x 9.4 inches
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Shipping Weight: 1 pounds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Average Customer Review: 4.5 out of 5 stars See all reviews (129 customer reviews)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Amazon Best Sellers Rank: #17,250 in Books (See Top 100 in Books)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="gemba-walks">Gemba Walks
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14844099928904.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="editorial-reviews">Editorial Reviews
&lt;/h3>&lt;p>In 12 new essays, ranging from the provocative to the practical and written specially for the second edition of Gemba Walks author and management expert Jim Womack reflects on the past 30 years of lean, and assesses the current state of lean today.
He also shares thoughts on how lean thinking and practice can continue to make the world a better place by gaining traction in areas such as government and healthcare, provides practical guidance for how leaders everywhere can realize the full benefits of a lean management system, and shares hope for continued improvement on the path to better work and more value.
Over the past 30 years, Womack has developed a method of going to visit the gemba at countless companies and keenly observing how people work together to create value. He has shared his thoughts and discoveries from these visits with the lean community through a monthly letter. With Gemba Walks second edition, Womack has selected and re-organized his key letters, as well as written 12 new essays.
Gemba Walks shares his insights on topics ranging from the application of specific tools, to the role of management in sustaining lean, as well as the long-term prospects for this fundamental new way of creating value. Reading this book will reveal to readers a range of lean principles, as well as the basis for the critical lean practice of: go see, ask why, and show respect.
Womack explains:
• whatever happened to Toyota and what happens next to lean?
• how lean got its name 25 years ago; a special essay co-authored by Jim and John Krafcik, president and CEO, Hyundai Motors America
• work, management, and leadership &amp;ndash; what is the real work of the lean leader?
• don’t offshore or reshore –leanshore
• why companies need fewer heroes and more farmers (who work daily to improve the processes and systems needed for perfect work and who take the time and effort to produce long-term improvement)
• how “good” people who work in “bad” processes become as “bad” as the process itself
• how the real practice of showing respect comes down to helping workers frame and solve their own problems
• how the short-term gains from lean tools can be translated to enduring change from lean management.
• how the lean manager has a “restless desire to continually rethink the organization’s problems, probe their root causes, and lead experiments to test the best currently known countermeasures”
By sharing his personal path of discovery, Womack sheds new light on the continued adoption and development of the most important new business system of the past fifty years. His journey will provide courage and inspiration for every lean practitioner today.&lt;/p>
&lt;h3 id="product-details-3">Product Details
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Paperback: 311 pages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Publisher: Lean Enterprise Institute, Inc.; 2nd ed. edition (January 1, 2013)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Language: English
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN-10: 193410938X
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN-13: 978-1934109380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Product Dimensions: 6 x 1 x 8.9 inches
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Shipping Weight: 1.6 pounds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Average Customer Review: 3.7 out of 5 stars See all reviews (10 customer reviews)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Amazon Best Sellers Rank: #357,633 in Books (See Top 100 in Books)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 11799 in Books &amp;gt; Textbooks &amp;gt; Business &amp;amp; Finance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 39798 in Books &amp;gt; Business &amp;amp; Money
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Continuous Delivery: Reliable Software Releases Through Build, Test, and Deployment Automation&lt;/p>
&lt;p>持续交付：发布可靠软件的系统方法&lt;/p>
&lt;p>&lt;a class="link" href="http://item.jd.com/10843669.html" target="_blank" rel="noopener"
>http://item.jd.com/10843669.html&lt;/a>&lt;/p>
&lt;p>Eric J.Evans在《领域驱动设计》一书中&lt;/p>
&lt;p>**Domain Driven Design by Eric J. Evans.&lt;/p>
&lt;p>《Architecture and Patterns for IT Service Management, Resource Planning, and Governance: Making Shoes for the Cobbler’s Children, observes》&lt;/p>
&lt;p>正如Steven j. Spear在他的书《The High-Velocity Edge》&lt;/p>
&lt;p>1984年由Eliyahu M. Goldratt博士写的《目标：简单而有效的常识管理》。&lt;/p>
&lt;p>2009年，Mike Rother编写了《丰田套路：转变我们对领导力与管理的认知》（&lt;em>Toyota Kata: Managing People for Improvement, Adaptiveness and Superior Results&lt;/em>）&lt;/p>
&lt;p>Value Stream Mapping: How to Visualize Work and Align Leadership for Organizational Transformation&lt;/p>
&lt;p>(英语) 精装 – 2013年12月16日
Karen Martin (作者), Mike Osterling (作者)&lt;/p>
&lt;p>&lt;a class="link" href="https://www.amazon.com/dp/B00EHIEJLM/ref=dp-kindle-redirect?_encoding=UTF8&amp;amp;btkr=1" target="_blank" rel="noopener"
>https://www.amazon.com/dp/B00EHIEJLM/ref=dp-kindle-redirect?_encoding=UTF8&amp;btkr=1&lt;/a>&lt;/p>
&lt;p>In the book Implementing Lean Software Development: From Concept to Cash, Mary and Tom Poppendieck describe waste and hardship in the software development stream as anything that causes delay for the customer, such as activities that can be bypassed without affecting the result.&lt;/p>
&lt;p>“点名、责备和羞辱”模式是Sydney Dekker博士批评的坏苹果理论的一部分，在他的书《The Field Guide to Understanding Human Error》里有深入讨论。&lt;/p>
&lt;p>《Gemba Walks》的作者Jim Womack描述了领导者和前线工作者之间必须发生的互补工作关系和相互尊重。根据Womack的说法，这种关系是必要的，因为谁都无法单独解决问题 - 领导者并不会足够的贴近一线工作，这是解决任何问题所需要的，而前线工作者也没有更广的组织背景的认知或权&lt;/p>
&lt;p>After the near-death experience of eBay in the late 1990s, Marty Cagan, author of Inspired: How To Create Products Customers Love, the seminal book on product design and management, codified the following lesson:&lt;/p>
&lt;p>界定上下文(Bounded contexts)是Eric J.Evans在《领域驱动设计》一书中提出的概念。其思路是开发人员能够理解和更新服务的代码，而不需要知道其关联服务（peers）的内部逻辑。同时，服务间严格通过API协作，不共享数据结构、数据库Schema或内部的对象。界定上下文确保服务间职责的划分，并具有良好定义的接口，同时也提高了可测试性。&lt;/p>
&lt;p>Scrumisanagiledevelopmentmethodology,describedas“aflexible,holisticproductdevel- opment strategy where a development team works as a unit to reach a common goal.” It was first fully described by Ken Schwaber and Mike Beedle in the book Agile Software Development with Scrum. In this book, we use the term “agile development” or “iterative development” to encompass the various techniques used by special methodologies such as Agile and Scrum.&lt;/p></description></item></channel></rss>