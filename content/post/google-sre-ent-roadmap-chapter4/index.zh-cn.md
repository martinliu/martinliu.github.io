---
title: "《企业 SRE 路线图》第四章：SRE 的实践"
date: 2024-05-02T21:41:05+08:00
description:  Google SRE 整理了一些建议，希望能帮助到更多企业。通过评估企业现有的环境、设定合理的预期，并确保企业朝着正确的方向迈出正确的步伐，企业可以从评估 SRE的原则和实践，从评估SRE在组织中的运作方式开始。
slug: google-enterprise-roadmap-to-sre-chapter4
image: pexels-anete-lusina-4792380.jpg
categories:
    - SRE
tags:
    - Google
    - 白皮书
comments: true
toc: true
draft: true

---

建立了 SRE 团队并掌握了相应原则之后，接下来就要发展具体的实践方法了。团队的实践取决于成员的技能、知识、工具，以及他们对这些资源的熟练程度。团队的职责最初基于其宗旨和工作环境而定。常见的做法是承担开发团队未覆盖的所有任务，但这种做法可能隐藏着风险。通过将团队的注意力集中在特定的运维职责上，他们可以逐步构建能力，形成一个相互促进的循环。如果团队被置于一个范围不明确的工作环境中，只会带来过度的工作量和挫败感。  
  
另一个常见的错误做法是把 SRE 工作增加到已经负担过重的团队身上。  
  
团队的知识可以通过教育来扩展，无论是自发的还是组织安排的。应该鼓励团队定期举办同事间的学习交流会——比如，每周安排一个小时，欢迎任何与生产相关的问题，无论是新手还是老手都可以提问。如果有人能回答问题，就可以进行分享教学；如果没人知道答案，就可以变成一次团队合作的调查。根据我们的经验，这些交流会对团队成员都极有价值。新手可以学习新知识，资深成员有机会分享他们的经验，有时还会发现之前没人知道的新事物。  
  
同样，进行“命运之轮”或桌面演习也非常有助于提高团队成员在紧急情况下的应对能力和在无压力环境中处理生产问题的舒适度。通过回顾最近的系统故障来开始是一个不错的选择。如果有团队成员能扮演引导者的角色，实时展示问题发生时的情况，其他成员就可以讨论他们的应对措施或直接使用工具来调查事件当时的系统状态。  
  
团队还应该被鼓励去了解他们负责运维的系统的更多信息，这些信息应该从开发团队那里获得。这不仅有助于更好地理解现有系统，还是直接引入新监控工具、讨论和规划系统变更如性能提升或解决可扩展性和一致性问题的绝佳机会。这样的交流对于团队间建立信任非常有价值。  
  
通过引入新的第三方工具、开源软件工具或团队自主开发工具，也可以扩展团队的能力。  
  
### 从哪里开始？  
  
在为团队增加能力时，应该从哪里入手呢？可靠性和 SRE 的领域非常广泛，并不是所有能力都一开始就适用。我们建议从一套能够帮助团队学习并确定下一步工作内容的实践开始。抽象地说，我们推荐使用所谓的“计划－执行－检查－行动（PDCA）”模型。通过根据系统当前的工作状态来决定下一步，你的每一步都将是切合实际的。我们将在本章后面解释如何构建这些能力的平台以及从哪里开始。这些初期的能力将形成一个良性循环，团队就不必猜测接下来应该构建或采用什么——他们将能够根据对系统的观察自然而然地得出结论。  
  
你的目标是什么？  
  
设定适当的目标非常重要。并不是所有系统都需要达到“五个九”（99.999%）的超高可靠性。我们建议根据你的服务和应用的可靠性需求进行分类，并相应地设定投入水平。如我们之前提到的，记住每提升一个“九”成本可能是前一个“九”的十倍，即99.99%的成本可能是99.9%的十倍。虽然这个说法很难精确证明，但这个原则是成立的。因此，如果没有深思熟虑就盲目或过于广泛地设定目标，可能会让你的投入变得非常昂贵，并让努力陷入困境。过分追求不必要的高可靠性目标也可能导致团队失去顶尖人才。如果你的目的只是到达近地轨道，就没有必要设定登月的目标。  
  
确保你成功的路径是逐步实现目标，而不是期望一次性通过大型项目或革命性变革来实现。在这里，渐进式改进才是关键。  
  
当你的团队开始尝试新的实践时，确保记录下所取得的成果，并在团队内部及对外宣传这些成果。同行间的认可非常重要，可以通过在团队站立会议中表扬成员、在会议上让人们分享他们是如何避免灾难的、在内部通讯中发布近失事件，以及向整个组织展示如果没有采取预防措施会发生什么等方式来进行。庆祝这类工作成果非常重要，尤其是在过去没有这样做习惯的环境中。口头表扬和书面表扬可以与奖金或礼物相结合。即使是小礼物，也能产生很大的鼓励作用。  


### 如何到达目标  
  
不要制定一个长期且过于详细的计划，例如三年的详细规划。相反，你应该专注于确定前进的大方向。了解你的长期目标，但根据当前完成的任务来决定下一步。确立了方向之后，不必急于全面改变现有的团队和流程来适应新模型。相反，应该逐步引导团队向正确的方向发展。  
  
我们将这种方法称为“战争迷雾”策略，意味着你清楚最终的目的地，但也为途中可能遇到的任何小问题做好了准备。  
  
在这个过程中，短期规划和灵活性至关重要，尤其是在初期，迅速取得成效并立即展示其影响力，对于一个刚刚起步的项目和团队的士气有着极大的积极作用。设定可达成的短期目标来解决当下问题，同时开始构建可通用、可复用的长期能力，让多个团队都能受益。通过构建一个能够提供这些能力的基础设施，你可以放大投资的影响力。我们将在本章后面进一步详细阐述这个平台和能力的概念。  
  
组织内不同的产品开发团队在需求和现有能力方面都有所不同。引入SRE时，你应当在参与模式上保持灵活，以适应各个团队的具体情况。通过理解产品团队的现状，你可以解决当前的问题，同时引入全组织范围的标准和最佳实践。当SRE团队刚开始运作时，如果很多团队都寻求他们的帮助，他们可能会感到负担过重。通过制定明确的参与“菜单”，你可以避免一次性的合作或其他不可持续的合作模式。参与模式有几种类型，包括嵌入式、咨询式、基础设施支持等，这些在谷歌客户可靠性工程（CRE）团队的博客文章以及《SRE手册》第32章中有很好的描述。  
  
对于SRE的采用，明确的汇报结构在早期就很关键。我们建议形成一个独立的组织，并且SRE领导应在执行团队中拥有一席之地。通过将SRE的领导层与产品开发部门分开，SRE团队更容易专注于可靠性的核心目标，而不会受到那些更关注速度和功能交付的团队的直接压力。然而，在这样做时，要避免形成一个孤立的“运维”部门，因为SRE与企业其他部分的紧密合作至关重要。开发团队应该对这些共享的SRE团队进行投资，以确保从这个团队获得的价值大于自行构建SRE功能。  
  
什么是SRE成功的关键？  
  
SRE的成功不仅仅取决于实践方法，如服务水平目标（SLOs）和事故回顾（postmortems）。这些实际上是最初创造SRE工作文化的产物。因此，成功地采用SRE不仅需要模仿这些实践，还必须采纳一种兼容的文化才能取得成功。  
  
这种文化建立在团队自身的信任和安全感之上。当团队负责控制主要系统时，他们必须感到在心理上是安全的。他们必须能够在不担心报复的情况下对同事和领导说“不”。他们必须感到自己的时间被重视，他们的意见受到倾听，他们的贡献得到认可。最重要的是，SRE不应该感到自己比开发部门的同事更为“另类”或“次等”。这是一个基于历史上Dev与Ops对立模型的常见陷阱。  
  
无责事故回顾就是一个著名的例子。通过记录“出了什么问题”，团队可以协作地确定导致故障的各种因素，无论是技术问题还是程序问题。经常，当人为错误发生时，将错误归咎于“人的因素”可能很有诱惑力，但这已被证明是没有意义的，也不是改进系统的有效方式。相反，SRE倡导无责文化。可以这样理解：系统应该让人很难犯错。应当有自动化和检查措施来验证操作者的输入，并且鼓励同行审查来促进共识和协作。当人们在报告中自由地提及自己的名字，并且知道不会因为可能发生在任何人身上的简单错误而受到羞辱、降级或负面绩效评估时，这表明你已经实现了无责事故回顾。如果你看到事故回顾中使用了“工程师”或“人员1”这样的表述，你可能认为这是一种良好的无责实践，但这实际上可能反映了潜在的文化问题，必须直接解决。如果文件中的名字被隐去并替换为“工程师”或“人员1”，但在事故回顾之外仍然对工程师进行指责，那么责任文化问题就没有得到解决。你绝对不应该自动化地从记录或文件中删除名字——这并不能解决根本的文化问题，只会使文件更加难以阅读和理解。与其表面上删除名字，不如直接解决潜在的文化问题，以实现真正的无责文化。  
  
一个不良文化的标志是西瓜指标：外表看似绿油油，实则内部问题重重。这类指标反映了团队的努力，它们被精心设计，看上去很美好，但实际上隐藏了真正的缺陷。这与古德哈特法则类似，即任何成为目标的指标就不再是好的衡量指标。例如，过分关注支持票据数量或整体平均解决时间（MTTR）往往会被滥用，不管是故意的还是出于好意但不自知的错误。通过衡量团队的活动，我们把这些活动变成了目标，而不是客户的成果。相反，团队应该定义自己的成功指标，这些指标直接反映了客户满意度、系统稳定性和开发速度等因素。  
  
SRE不应仅仅被视为“20%的时间”角色，而应该是组织内一个明确的职位和头衔。应该有一个公开的职业晋升路径，包括转岗要求和晋升期望。团队间的级别和薪酬应该公平对等。转岗不应该有任何显著的影响。  
  
一个成熟的SRE团队是否成功的好方法是观察人员转入和转出SRE的情况。确保人员转移是常规的且没有任何官僚主义或限制，这样你可以快速了解人们是否感到在SRE中“被困”，或者它是否是一个理想的角色。通过观察从开发转移到SRE的自愿转移率，你可以判断这一角色是否吸引人。  
  
SRE必须知道他们的时间是被重视的，尤其是当他们的工作需求超出了“正常工作时间”。例如，在谷歌，当SRE需要在正常工作时间以外值班时（即“on-call”），他们应该获得补偿。谷歌的一些团队允许值班工程师在金钱补偿和休假之间选择，按值班时间的一定比例，通常有一个上限。不应该对一个团队提出超出其交付能力的需求，因此，确保值班池足够大是很重要的。常见的错误是仅将值班池限定为SRE，这是不必要的限制。值班池也应该是基于自愿加入的。一旦团队感觉他们的时间被滥用，就会迅速导致士气下降。  
  
另一个文化触点是规划和目标设定。由于SRE最接近生产问题，他们通常很清楚最重要的是什么，哪些问题最紧急，哪些问题造成了最大的痛苦。允许SRE团队设定自己的优先级和路线图，你就赋予了团队权力，他们将会更加有效率和幸福。管理层应遵循共同制定并达成对预期成果的共识的做法。业务需要加速吗？用户需要更快获得结果吗？一个常见的反模式是泰勒主义，即领导者独立设定和优先考虑详细的计划和任务，然后将它们分配给工人。  
  
构建能力平台  
  
SRE团队可以构建一个平台，向合作团队提供能力，理想情况下，随着时间的推移，他们的贡献将扩展到整个组织。通过在共享服务、实践、规范和代码中引入弹性机制，这些团队可以开发出由自动化、代码、共享库、管道、流程、规范、文档、手册组成的共享平台，甚至包括那些只存在于人们头脑中的特殊未记录知识。与其让每个团队都试图创建自己的最佳实践，不如将这些实践融入到平台中。产品可以从头在平台上构建（所谓的“数字原住民”），也可以移植到平台上。随着平台能力的增长，团队对其操作特性越来越有信心和舒适，越来越关键的工作负载可以迁移过来。通过采纳这种将能力编码到平台中的模型，SRE团队可以通过将能力同时应用到多个服务中来放大他们的影响力。平台是一个内部产品，应该像产品一样进行管理，将服务团队视为客户，接受功能请求，并跟踪缺陷（见图4-1）。  
  
图 4-1. 能力平台示意图。  
  
当一个团队构建一个平台时，他们会面临一个问题：“首先应该构建什么？”通过首先采用低风险的服务，你可以将需求列表最小化为一个最小可行产品（MVP）。随着时间的推移，你会添加更多的能力。但下一步是什么呢？有两个来源：你的开发人员和你的环境。也就是说，根据他们的需求来构建，例如，“我们需要一个消息总线！”以及根据你所知道他们将需要的来构建，例如，“必须有一个可扩展的服务发现系统，否则这将无法工作。”  
  
对于环境所需的能力，这些通常包括：  
  
- DevOps的改进，例如增强软件开发生命周期（SDLC），更快、更安全地发布更多代码；  
- 可靠性工程的改进：最小化那些已经潜入系统中的错误带来的风险。  
  
为了加强可靠性工程，我们推荐在团队中培养一种持续改进的机制。如果你不确定应该从哪里开始，可以从分析系统中断事件入手，采取以下措施：  
  
- 制定服务水平目标（SLO），明确可接受的系统性能标准。  
- 建立一套正式的事故响应流程，确保在发生故障时迅速有效地响应。  
- 开展无责任的事故回顾和审查，鼓励团队成员坦诚地分析问题，而不担心受到指责。  
- 利用风险建模来确定改进的优先顺序，确保优先处理最关键的风险点。  
- 使用错误预算或其他风险管理方法来消化待解决的可靠性问题，以保持系统的整体稳定性。  
  
让这种持续改进成为推动团队不断创新的动力。例如，如果一次部署导致了整个服务器群的宕机，你可能需要探索减少这种风险的方法，比如通过限制影响范围、实施金丝雀发布或使用其他逐步部署策略。如果发现内存泄露问题，你可以在部署前的流程中加入新的负载测试方法。这些新能力将被集成到你的基础设施平台中，为平台上的每项服务提供额外的保护和优势。随着这些通用的缓解策略证明其价值，单次修复的情况将会大幅减少。  


### 领导力  
  
要构建这样的技术平台，你需要投入宝贵的工程资源，这些资源本可以用于开发新功能。这就要求从基层到高层都需要施加影响力。在功能开发和系统稳定性之间进行权衡时，决策者必须具有全局视野并得到适当的激励。我们越来越多地看到“首席可靠性官”这一职位，他们在组织内占有一席之地，参与制定战略性的可靠性决策（这一概念在马克·施瓦茨的《在桌边》一书中有所讨论）。虽然这是SRE成功实施的关键角色，但并不是一个常见的职位名称，通常是现有高管的额外职责。  
  
了解效果  
  
一个运作良好、重视可靠性的组织会展现出几个明显的特征。首先是面对可靠性问题时，能够及时减缓或暂停新功能的发布。如果唯一目标是快速发布，可靠性和其他非功能性需求就会被牺牲。你的组织是否总是将可靠性工作推到新功能之后？是否有因“时间不足”而永远无法完成的项目？重要的是，这并不意味着你应该放慢代码交付流程的速度，而是保持持续的推进。  
  
另一个成功的迹象是，个体英雄主义不再受到赞扬，反而被积极劝阻。当系统的成功依赖于少数人的担当时，团队就会形成一种不可持续的英雄主义文化，这种文化终将崩塌。英雄们会被鼓励独占知识，而不愿意去系统地预防问题的发生。这与《凤凰项目》一书中的布伦特角色类似。依赖个体英雄不仅效率低下，而且可能非常危险。团队必须积极阻止个体英雄行为的发生，同时保持团队责任感，因为英雄主义在短期内看似合理，但实际上不可取。  
  
一个表现良好的团队还会在出现中断前就对可靠性工作进行投资，作为主动规划的一部分。在表现不佳的团队中，我们看到仅在发生一系列中断之后才开始对可靠性进行投资。虽然这可能是必要的增加，但这种投资需要长期维持，而不是被视为一次性的应对措施或在情况好转后就被撤销。  
  
进一步说明，设想你的组织对于可靠性有两种不同的态度：和平时期和战时。它们分别对应于“一切正常”和“所有人都知道问题即将爆发”。通过区分这两种状态，你可以做出关于投资的决策。在战时，你会在平台的隐性特性、基础设施、流程和培训上投入更多的时间和金钱。而在和平时期，你不会放弃这些工作，但你肯定会减少投资。  
  
然而，谁决定公司何时进入战时？这个决定是如何做出的？它如何在整个公司传达，而不造成恐慌或人才流失？一种方式是使用优先级代码，比如黄色警报或红色警报。这些是帮助团队确定工作优先级的组织实践。  
  
黄色警报意味着在一个季度内可能会变成商业紧急情况的技术问题。红色警报则表示问题可能在几天内发生，或者是已经存在的威胁。这些警报应该有明确的标准，所有领导团队成员都必须理解并同意这些标准。宣布这些警报必须得到领导层的批准才能产生预期效果。这些警报的结果应该是变更团队的工作优先级，可能会暂停现有的工作（如红色警报的情况），批准大额支出，并能够直接协调其他团队提供帮助。优先级警报对企业来说是一项昂贵的操作，因此你应该确保它们有明确的预期结果。这些结果应该从一开始就定义为退出标准，并在完成时清晰地传达。否则，团队会经历信号疲劳，不再适当响应。  
  
选择投资于可靠性  
  
那么，这样一个可靠性领导者可能会做出哪些较不戏剧性的改变呢？这将涉及政策和支出。  
  
当政策从基层推动时，设置全组织的政策往往是不一致的。如果有一个领导角色来审核、消除重复、批准和传播这些政策，那将更为有效。同样，公司的资金支出，包括人员、硬件、软件、旅行和服务，通常是以分层的方式进行的。  
  
在构建前面提到的结构之前，必须考虑组织内可靠性的价值。为了使其有意义，组织必须将可靠性视为一项投资，甚至是产品差异化因素，而不是成本中心。应该明确可靠性是最重要的隐性产品特性。一个不可用、缓慢或充满错误的产品，无论功能如何丰富，对客户的价值都会大打折扣。设定这个方向必须在高层进行，以确保持一致性，特别是如果这是一个新的方向。  
  
一个简单的论点是，可靠性可以作为更容易理解的概念的替代物，例如代码质量。如果系统出现了用户可见的失败，那么诸如逐步变化等可靠性实践的应用可以使系统在直接解决代码质量问题之前，对最终用户显得更加稳定。例如，通过对1%的用户推出有缺陷的变更，99%的用户就不会遇到问题。这使得系统看起来比实际上好100倍，并显著减少了支持成本和声誉损害。  
  
做出决策  
  
将可靠性建立为对更强大产品的投资后，你可以制定更长远的计划，带来更大的影响。传统模型将IT视为成本中心，完全专注于随着时间的推移降低成本。但最终，如果服务不可用，无论它有多便宜都没有意义。你仍然可以实施成本削减，但应该在实现可靠性目标之后再考虑。如果你发现维持所设定的可靠性目标的成本过高，你可以明确重新定义这些目标——比如，降低一个“9”的标准——并评估由此产生的权衡。  
  
要实现这些目标，你可能需要说服某个管理委员会、决策者群体或高层管理。你需要他们的支持，以便随着时间推移配备并维护团队，提供必要的资源，并培训及进一步发展团队成员。这应该被视为长期投资，并明确得到相应的资金支持，而不是隐藏在其他预算项下。  
  
反模式：忽视尤利西斯  
  
在处理可靠性问题时，一个常见的反模式是让预期中的中断或其他“坏消息”影响你的规划周期。通常，领导层在面对坏消息时会感到需要“采取行动”，而“坚持计划”通常感觉不够有力。然而，如果计划中已经预料到会发生中断，除非对系统的理解发生了重大变化，否则“坚持计划”才是正确的做法。“尤利西斯契约”在这里可以作为一个有用的比喻。这是指领导者（尤利西斯）告诉他的团队（水手们）坚持计划（即使他被绑在桅杆上驶过塞壬）。当团队坚持计划（尽管他奋力挣扎和恳求停下），他就会祝贺他们。他们没有被短期思维所诱惑，他们的计划考虑了长期影响，并且他们在混乱开始前就制定了明确的计划。  
  
通过允许团队做出即时决策，你通常选择忽视一个良好的计划，转而做出基于情绪或自我驱动的选择。典型的例子是领导者在没有完整背景的情况下“介入中断”并接管指挥，尽管有一个能够控制局面的团队。这通常是公司文化的体现。  
  
基于最高收入者意见的决策文化（HiPPO）可能会对事件管理和总体可靠性产生极其不良的影响。相反，听从尤利西斯的建议，坚持计划，不要放弃。这不仅适用于事件响应，也适用于在面临“非常糟糕”的事件时坚守错误预算和跟踪服务水平目标（SLO）。  
  
如果你的计划是在错误预算耗尽时暂停功能发布，但每次为了“这个重要的功能”而例外，你的领导力就会受到严重削弱。引入“银色子弹”的做法可以有效改善这种情况，即授权领导者有限次数地使用覆盖预期计划的权力。通过这种人为设定的稀缺性，领导者被迫做出明确的权衡。同样，如果一个事件消耗了整个服务水平目标，不要忽视它。应召集团队分析这一事件如何改变大家对系统的集体理解。是否之前从未考虑过这种失败类型？对中断的响应是否不足？  
  
反模式：混合使用  
  
另一个反模式是试图在不做任何修改的情况下混合使用旧模型和新模型。这会使团队面临奇怪的拉扯，并应该避免。例如，在ITIL问题管理中，通常期望一个中央团队通过问题经理来推动所有问题的根本原因分析和解决时间缩短。而在SRE中，期望嵌入式工程师通过事后分析和审查来推动自己问题的解决。虽然两者的最终目标一致——减少中断次数和持续时间，但所采取的方法和角色却大相径庭。试图同时采用两种方法，最终会导致混乱，两种方法的预期结果会相互冲突，导致效果打折扣。  
  
我们把SRE和非SRE原则的不良混合称为“有毒组合”，类似于药物间不良反应的医学术语。单独使用每一种可能都是有益的，但两者混合使用却可能导致意想不到的负面后果。我们发现，尝试同时使用两者背后的好意通常是为了保持现有员工的参与，或试图在报告上保持连续性。然而，这种做法的吸引力远不能抵消因此带来的更糟糕的结果：更长的中断时间、更多的重复劳动和降低的可靠性。  

### 人员配置与留存  
  
在人员配置和角色定义过程中，也可能出现一些反模式。在组建SRE团队时，可能会有从外部招聘SRE以整顿现有团队的冲动。这实际上可能是一种努力的浪费，因为新来的SRE往往无法深刻理解团队或现有技术的特点，并可能机械地应用过往经验，而不确定这些经验是否适合新环境。  
  
我们建议改为培养现有团队成为SRE团队。单纯的更名是无效的，但提供一个结构化的学习路径和一个促进成长和繁荣的环境则是行之有效的。  
  
当然，转型也可能失败。如果个人没有被正确引导以取得成功，而是期望他们通过简单“阅读书本”就立即能担任高级SRE的角色，他们可能会感到沮丧并寻找其他就业机会。同样的，一些工程师可能不认同变革的必要性，没有得到激励，或对采纳新角色有极大的抵触情绪。通过提供有偿教育、学习的时间和空间，以及让团队理解变革必要性的背景，你可以成功地将一个团队转型为SRE。这需要时间、努力和耐心。在转型不成功的情况下，进行一次离职面试是重要的，特别是针对转型过程以及对个人的影响进行讨论。你可能会发现自己计划中的缺陷，或意识到实施的方式并不符合你的初衷。最后，要求团队承担更复杂、影响更大的工作时，请记住，这实际上是价值更高的工作，团队应该得到相应的报酬。也就是说，当你的团队开始表现得像SRE时，你也应该按照SRE的标准支付薪酬，否则他们可能会转去其他愿意这样做的公司。如果你投资于团队学习高价值技能，而他们选择离开并将这些技能应用于其他地方，那么只能怪你自己。  
  
技能提升  
  
在将现有员工培养和转型为SRE时，构建一个提升技能的计划至关重要。这包括需要哪些技能（what）以及如何使员工获得这些技能（how）。此时，技能差距分析和调查等工具具有本质的价值，它们可以帮助验证工作所需基础技能的假设。  
  
这些技能，虽然在SRE相关文献中并未特别提及，但对于让SRE扩大他们在整个组织中的贡献至关重要。例如，传统的运维团队可能不熟悉软件工程的基础知识，如版本控制、单元测试和软件设计模式。确保这些基础知识成为你的技能提升计划的一部分，并根据每个学习者的特点进行定制，这不仅是为了在团队中建立关键技能基础，也是为了让个人平稳过渡到新角色的期望，并因此帮助减少团队的流失。


[]()

[]()


[]()

[]()



![]()

![]()

![]()


Feature picture ❤️ Anete Lusina: <https://www.pexels.com/photo/miniature-toy-car-on-top-of-monopoly-board-game-4792380/>
