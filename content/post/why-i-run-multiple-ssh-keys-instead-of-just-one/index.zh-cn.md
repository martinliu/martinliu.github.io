---
title: "æˆ‘ä¸ºä»€ä¹ˆä½¿ç”¨å¤šä¸ª SSH å¯†é’¥ï¼Œè€Œä¸æ˜¯åªç”¨ä¸€ä¸ªï¼Ÿ"
date: 2025-08-25T10:00:00+08:00
description: "ä»å•ç‚¹æ•…éšœåˆ°å¤šå±‚å®‰å…¨ï¼šå­¦ä¹ å¦‚ä½•é€šè¿‡æŒ‰ç”¨é€”å’Œç¯å¢ƒåˆ†ç¦» SSH å¯†é’¥æ¥æå‡ç³»ç»Ÿå®‰å…¨æ€§ï¼Œé™ä½çˆ†ç‚¸åŠå¾„é£é™©ã€‚"
slug: why-i-run-multiple-ssh-keys-instead-of-just-one
image: ssh-key-management-best-practices-feature.jpg
categories:
    - SRE
tags:
    - SSH
    - å®‰å…¨
    - Linux
    - æœ€ä½³å®è·µ
    - ç³»ç»Ÿç®¡ç†
    - å¯†é’¥ç®¡ç†
comments: true
toc: true
---

>ä½œè€…ï¼šFaruk Ahmed

å¯¹äºè®¸å¤š Linux ç®¡ç†å‘˜æ¥è¯´ï¼Œä½¿ç”¨å•ä¸ª SSH å¯†é’¥å¯¹ç™»å½•ä»–ä»¬æ‰€æœ‰çš„æœåŠ¡å™¨ã€æµ‹è¯•ç¯å¢ƒæˆ–äº‘å®ä¾‹æ˜¯é»˜è®¤åšæ³•ã€‚
è¿™ç§æ–¹å¼ç®€å•ã€æ–¹ä¾¿â€”â€”ä½†å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå•ç‚¹æ•…éšœã€‚

éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘äº†è§£åˆ°**æŒ‰ç”¨é€”å’Œç¯å¢ƒåˆ†ç¦» SSH å¯†é’¥**ä¸ä»…æ˜¯è‰¯å¥½çš„å®‰å…¨ä¹ æƒ¯ï¼Œæ›´æ˜¯é‡å¤§çš„å®‰å…¨æå‡ã€‚

## ğŸ›‘ â€œä¸€é’¥é€šåƒâ€çš„é£é™©

å¦‚æœä½ å¯¹æ‰€æœ‰äº‹åŠ¡éƒ½ä½¿ç”¨åŒä¸€ä¸ª SSH ç§é’¥ï¼Œé‚£ä¹ˆä¸€æ—¦æ³„éœ²ï¼Œåæœå¯èƒ½æ˜¯ç¾éš¾æ€§çš„ï¼š

- ç¬”è®°æœ¬ç”µè„‘ä¸¢å¤±ï¼Ÿæ‰€æœ‰ä½¿ç”¨è¯¥å¯†é’¥çš„æœåŠ¡å™¨éƒ½å°†é¢ä¸´é£é™©ã€‚
- å¯†é’¥ä»å®‰å…¨æ€§è¾ƒä½çš„ç¯å¢ƒä¸­è¢«çªƒå–ï¼Ÿæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¸—é€åˆ°å…³é”®ç³»ç»Ÿã€‚
- éœ€è¦è½®æ¢å¯†é’¥ï¼Ÿä½ å°†ä¸å¾—ä¸æ‰‹å¿™è„šä¹±åœ°åœ¨*æ‰€æœ‰åœ°æ–¹*æ›¿æ¢å®ƒã€‚

è¿™å°±æ˜¯**çˆ†ç‚¸åŠå¾„é—®é¢˜ (blast radius problem)** çš„å®šä¹‰ã€‚

## ğŸ§© æˆ‘å¦‚ä½•åˆ’åˆ†å¯†é’¥

æˆ‘ä¸ºä»¥ä¸‹ç”¨é€”ç»´æŠ¤**å•ç‹¬çš„ SSH å¯†é’¥**ï¼š

1. **ç”Ÿäº§ç¯å¢ƒ (Production)**
    - å­˜å‚¨åœ¨ç¡¬ä»¶ä»¤ç‰Œ (hardware token) æˆ–å®‰å…¨å¯†é’¥ä¿ç®¡åº“ (secure key vault) ä¸­
    - ä»…ç”¨äºå…³é”®æœåŠ¡å™¨
    - ç»ä¸ç¦»å¼€å®‰å…¨è®¾å¤‡

2. é¢„æ¼”/æµ‹è¯•ç¯å¢ƒ (Staging/Test)
    - ä¸ç”Ÿäº§ç¯å¢ƒåˆ†ç¦»
    - å­˜åœ¨äºå·¥ä½œç¬”è®°æœ¬ç”µè„‘ä¸Š
    - æ˜“äºæ›¿æ¢

3. ä¸ªäººé¡¹ç›® (Personal Projects)
    - ç”¨äºå®¶åº­å®éªŒå®¤ (home labs)ã€ä¸ªäºº VPSã€æ ‘è“æ´¾ (Raspberry Pis)
    - ç»ä¸ä¸å·¥ä½œç³»ç»Ÿæ··ç”¨

4. ä¸€æ¬¡æ€§/ä¸´æ—¶ç”¨é€” (Disposable/Temporary)
    - ä¸ºçŸ­æœŸé¡¹ç›®æˆ–ä¾›åº”å•†è®¿é—®åˆ›å»º
    - ä½¿ç”¨ååˆ é™¤

## ğŸ›  æˆ‘çš„å·¥ä½œæµç¨‹

**å¯†é’¥ç”Ÿæˆ (Key Generation)**ï¼š

```bash
ssh-keygen -t ed25519 -f ~/.ssh/prod_id_ed25519 -C "Production Key"
ssh-keygen -t ed25519 -f ~/.ssh/staging_id_ed25519 -C "Staging Key"
ssh-keygen -t ed25519 -f ~/.ssh/personal_id_ed25519 -C "Personal Key"
```

**SSH é…ç½®ç¤ºä¾‹** (`~/.ssh/config`)ï¼š

```config
Host prod-server-1
    HostName 192.168.1.100
    User admin
    IdentityFile ~/.ssh/prod_id_ed25519

Host staging-box-alpha
    HostName staging.example.com
    User deploy
    IdentityFile ~/.ssh/staging_id_ed25519

Host personal-pi
    HostName raspberrypi.local
    User pi
    IdentityFile ~/.ssh/personal_id_ed25519
```

è¿™æ ·ï¼Œæˆ‘å°±ä¸å¿…è®°ä½è¦ä½¿ç”¨å“ªä¸ªå¯†é’¥â€”â€”SSH ä¼šè‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„å¯†é’¥ã€‚




## ğŸ§  è¿™ç§æ–¹æ³•ä¸ºä½•æœ‰æ•ˆ

- **é™åˆ¶æŸå®³ (Limits Damage)** â€” å¦‚æœä¸€ä¸ªå¯†é’¥æ³„éœ²ï¼Œåªæœ‰è¯¥ç¯å¢ƒé¢ä¸´é£é™©ã€‚
- **æ›´æ˜“è½®æ¢ (Easier Rotation)** â€” æˆ‘å¯ä»¥è½®æ¢å•ä¸ªå¯†é’¥è€Œæ— éœ€è§¦åŠå…¶ä»–å¯†é’¥ã€‚
- **åˆ©äºå®¡è®¡ (Audit-Friendly)** â€” å¯†é’¥ç›´æ¥æ˜ å°„åˆ°å…¶ç”¨é€”ï¼Œä½¿åˆè§„æ€§ (compliance) æ›´å®¹æ˜“ã€‚
- **é¼“åŠ±æœ€å°æƒé™åŸåˆ™ (Encourages Principle of Least Privilege)** â€” æ²¡æœ‰å•ä¸ªå¯†é’¥å¯ä»¥è®¿é—®*æ‰€æœ‰*å†…å®¹ã€‚

## ğŸ“Œ æ€»ç»“

ä¸€å¼€å§‹ï¼Œç®¡ç†å¤šä¸ª SSH å¯†é’¥å¯èƒ½æ„Ÿè§‰æœ‰äº›å¤šä½™ï¼Œä½†è¿™å´æ˜¯æœ€ç®€å•ã€æœ€ä¸å½±å“æ•ˆç‡çš„é£é™©é™ä½æ–¹æ³•ä¹‹ä¸€ã€‚

ä¸€ä¸ªå¯†é’¥é€šåƒæ‰€æœ‰äº‹åŠ¡å¯èƒ½å¾ˆæ–¹ä¾¿â€¦â€¦ç›´åˆ°å®ƒä¸å†æ–¹ä¾¿ä¸ºæ­¢ã€‚


## æ‰©å±•é™„å½•ï¼šSSH Config å¸¸ç”¨æŠ€å·§

### 1. é€šé…ç¬¦ä¸æ¨¡å¼åŒ¹é…

- `Host *`  
  åŒ¹é…æ‰€æœ‰ä¸»æœºï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰å…¨å±€é»˜è®¤é…ç½®ã€‚  
- `Host *.example.com`  
  åŒ¹é…æ‰€æœ‰ `example.com` åŸŸä¸‹çš„ä¸»æœºã€‚  
- `Host staging-*`  
  åŒ¹é…å‰ç¼€ä¸º `staging-` çš„æ‰€æœ‰ä¸»æœºåˆ«åã€‚  

> **ä¼˜å…ˆçº§**ï¼šå…·ä½“åŒ¹é… > é€šé…ç¬¦åŒ¹é… > `Host *`ã€‚

### 2. Include æŒ‡ä»¤

å¯ä»¥æ‹†åˆ†é…ç½®æ–‡ä»¶ï¼Œä¿æŒæ¸…æ™°ï¼š

```config
Include ~/.ssh/config.d/*.conf
```



### 3. JumpHost / ProxyJump

- é€šè¿‡ä¸­é—´è·³æ¿æœºè¿æ¥ï¼š

  ```config
  Host prod-app
      HostName app.internal
      User deploy
      ProxyJump bastion.example.com
  ```



### 4. ç«¯å£è½¬å‘

- æœ¬åœ°è½¬å‘ï¼š

  ```config
  LocalForward 8080 localhost:80
  ```

- è¿œç¨‹è½¬å‘ï¼š

  ```config
  RemoteForward 9000 localhost:9000
  ```

### 5. æŒ‡å®šç«¯å£ä¸è¶…æ—¶

- éæ ‡å‡†ç«¯å£ï¼š

  ```config
  Port 2222
  ```

- è¿æ¥ä¿æŒæ´»è·ƒï¼š

  ```config
  ServerAliveInterval 60
  ServerAliveCountMax 5
  ```



### 6. å¤šèº«ä»½å¯†é’¥ç®¡ç†

- å…¨å±€é»˜è®¤å¯†é’¥ï¼š

  ```config
  IdentityFile ~/.ssh/id_ed25519
  ```

- é’ˆå¯¹ç‰¹å®šä¸»æœºæŒ‡å®šï¼š

  ```config
  Host gitlab.com
      User git
      IdentityFile ~/.ssh/gitlab_id_ed25519
  ```

### 7. æ§åˆ¶è¿æ¥å¤ç”¨ (æå‡é€Ÿåº¦)

- é¿å…é‡å¤æ¡æ‰‹ï¼Œå¤ç”¨è¿æ¥ï¼š

  ```config
  Host *
      ControlMaster auto
      ControlPath ~/.ssh/control-%r@%h:%p
      ControlPersist 10m
  ```



### 8. åˆ«åä¸ç®€åŒ–å‘½ä»¤

- é…ç½®å¥½ `Host` åˆ«ååï¼Œå¯ä»¥ç›´æ¥ï¼š

  ```bash
  ssh prod-server-1
  ssh staging-box-alpha
  ssh personal-pi
  ```



âš¡ è¿™äº›æŠ€å·§ç»„åˆä½¿ç”¨ï¼Œå¯ä»¥å¤§å¹…ç®€åŒ– SSH æ—¥å¸¸ç®¡ç†ï¼Œå°¤å…¶æ˜¯ **å¤šç¯å¢ƒè¿ç»´** æˆ– **å¼€å‘è°ƒè¯•** åœºæ™¯ã€‚

