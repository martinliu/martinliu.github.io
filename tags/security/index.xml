<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Security on Martin Liu's Blog</title><link>https://martinliu.cn/tags/security/</link><description>Recent content in Security on Martin Liu's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 28 Aug 2025 16:07:06 +0800</lastBuildDate><atom:link href="https://martinliu.cn/tags/security/index.xml" rel="self" type="application/rss+xml"/><item><title>CloudBees 全球企业高管安全管理调查报告-2022年</title><link>https://martinliu.cn/blog/cloudbees-global-c-suite-security-survey-report-2022/</link><pubDate>Sun, 18 Dec 2022 12:17:39 +0800</pubDate><guid>https://martinliu.cn/blog/cloudbees-global-c-suite-security-survey-report-2022/</guid><description>&lt;img src="https://martinliu.cn/blog/cloudbees-global-c-suite-security-survey-report-2022/cover.webp" alt="Featured image of post CloudBees 全球企业高管安全管理调查报告-2022年" />&lt;p>《CloudBees全球CxO安全调查》对美国、英国、法国、德国、西班牙和澳大利亚的600名CxO高管进行了调查，发现安全和合规性挑战是大多数组织的创新战略的一个重要障碍。四分之三的企业高管表示，合规性挑战（76%）和安全挑战（75%）限制了他们公司的创新能力。这部分是由于在合规性审计、风险和缺陷上花费了大量时间。调查还显示，高管们绝大多数赞成左移的方法，即把软件测试和评估转移到开发生命周期的早期，把安全和合规的负担放在开发团队身上。尽管如此，58%的人也同意左移的安全策略对开发团队来说是一种负担。总的来说，调查结果显示，全球的公司将从改善和精简安全和合规性流程中大大受益，以确保他们的软件供应链，改善开发人员的经验，并增加创新的时间。&lt;/p>
&lt;blockquote>
&lt;p>本报告解读的视频如下：&lt;/p>&lt;/blockquote>
&lt;div class="video-wrapper">
&lt;iframe src="https://player.bilibili.com/player.html?as_wide=1&amp;amp;high_quality=1&amp;amp;page=1&amp;bvid=BV1Lv4y1X7dY"
scrolling="no"
frameborder="no"
framespacing="0"
allowfullscreen="true"
>
&lt;/iframe>
&lt;/div>
&lt;p>感谢和我一起晚上直播的三位朋友：[大鲲、南方、悟空]&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-02.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q1 你对软件供应链的攻击有多担心（如果有的话）？&lt;/p>&lt;/blockquote>
&lt;p>十分之九的企业高管表示，他们对软件供应链攻击感到担忧，其中一半表示非常担忧。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-03.jpg"
loading="lazy"
>&lt;/p>
&lt;p>来自澳大利亚、法国、西班牙、英国和美国的C-suite高管比德国的C-suite高管更有可能说他们担心软件供应链的攻击。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-04.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q2 与两年前相比，您认为您对软件供应链攻击的担忧是多还是少？&lt;/p>&lt;/blockquote>
&lt;p>超过五分之四的C-suite高管表示，与两年前相比，他们对软件供应链攻击更加担忧。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-05.jpg"
loading="lazy"
>&lt;/p>
&lt;p>在所有六个国家中，至少有四分之三的C-Suite高管表示，与两年前相比，他们更担心软件供应链的攻击。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-06.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q3 你认为你的软件供应链的安全性如何？&lt;/p>&lt;/blockquote>
&lt;p>去年，超过九成（95%）的C-suite高管表示他们的软件供应链是安全的，超过一半表示非常安全。在2022年，这一比例下降到88%，认为它是安全的，只有三分之一（32%）的人认为它是非
常安全的。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-07.jpg"
loading="lazy"
>&lt;/p>
&lt;p>德国的首席执行官比其他国家的执行官更有可能说他们的软件供应链不安全。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-08.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q4 您认为您的软件供应链的合规性如何？&lt;/p>&lt;/blockquote>
&lt;p>超过四分之三的C-Suite高管（78%）表示他们的软件供应链完全或几乎完全合规，低于去年十分之九（90%）的说法。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-09.jpg"
loading="lazy"
>&lt;/p>
&lt;p>澳大利亚、法国、英国和美国的首席执行官比德国和西班牙的首席执行官更有可能说他们的软件供应链完全或几乎完全合规。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-10.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q5 虽然两者都很重要，但哪个对你的组织最重要？&lt;/p>&lt;/blockquote>
&lt;p>四分之三的C-suite高管表示，安全和合规是最重要的，而四分之一的人表示快速和合规是最重要的。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-11.jpg"
loading="lazy"
>
每个国家至少有三分之二的C-Suite高管表示安全和合规比快速和合规更重要。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-12.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q6 您认为，贵公司的团队每年平均花多少时间在合规性审核上？如果您不确定，请使用您最好的估计。如果您真的不知道，请选择不确定。&lt;/p>&lt;/blockquote>
&lt;p>虽然超过五分之一的C-suite高管表示他们完全不确定，但平均而言，C-suite高管表示他们的团队每年花在合规性审计上的时间超过37天。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-13.jpg"
loading="lazy"
>
来自西班牙、英国和美国的C-Suite比其他三个国家的C-Suite更有可能说他们的团队每年平均花更多时间在合规性审计上，而德国的C-Suite更有可能说他们完全不确定。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-14.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q7 在平均一周内，您认为您的团队在以下各项上花费的时间是多少？如果您不确定，请使用您最好的估计。&lt;/p>&lt;/blockquote>
&lt;p>尽管首席执行官们说他们的团队在创新上花费了更多的时间，但他们在风险和缺陷上花费的时间也相差不远。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-15.jpg"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>innovation 创新&lt;/li>
&lt;li>risks 风险管理&lt;/li>
&lt;li>Defacts 缺陷管理&lt;/li>
&lt;li>Technical Debt 技术债务&lt;/li>
&lt;/ul>
&lt;p>虽然所有国家的比例都差不多，但在澳大利亚和西班牙，花在风险上的时间比花在创新上的时间多。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-16.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q8 在平均一周内，您认为您的团队应该在以下各项上花费多少时间？如果您不确定，请使用您的最佳估计。&lt;/p>&lt;/blockquote>
&lt;p>毫不奇怪，C-suites说他们的团队应该把最大的时间花在创新上。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-17.jpg"
loading="lazy"
>&lt;/p>
&lt;p>德国和英国的C-suites高管比其他国家的高管更有可能说更多的时间应该花在创新上，而美国和西班牙的C-suites更有可能说更多的时间应该花在风险上。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-18.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q8-A 是什么阻碍了你的开发团队将更多的时间花在你认为他们应该花时间的活动上？请选择所有适用的。&lt;/p>&lt;/blockquote>
&lt;p>超过一半的C-suite高管表示，合规性和/或流程占用时间是阻止他们的开发团队花更多时间在他们认为应该花时间的活动上的原因。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-19.jpg"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>合规和/或流程所需要的时间&lt;/li>
&lt;li>合规和/或安全方面的知识&lt;/li>
&lt;li>过多的技术债务&lt;/li>
&lt;li>糟糕的产品测试&lt;/li>
&lt;li>其他的东西&lt;/li>
&lt;li>没有什么能阻止他们&lt;/li>
&lt;/ul>
&lt;p>澳大利亚和美国的C-suite高管比其他国家的C-suite高管更有可能说合规和/或安全知识是阻止他们的开发团队花更多时间在他们希望他们花时间的活动上。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-20.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q9 你有多大程度上同意或不同意以下说法？&lt;/p>&lt;/blockquote>
&lt;p>几乎十分之九的C-suite高管表示，与两年前相比，他们现在更多地考虑保障软件供应链的安全和合规问题。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-21.jpg"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>我现在比两年前更多地考虑保障供应链的安全。&lt;/li>
&lt;li>我现在比两年前更多地考虑合规问题&lt;/li>
&lt;li>合规挑战限制了我们的创新能力&lt;/li>
&lt;li>安全挑战限制了我们的创新能力&lt;/li>
&lt;li>我宁愿处理自然灾害，也不愿处理我们软件供应链中的安全问题&lt;/li>
&lt;li>在我们公司，安全问题可能是一个缓慢的部门。&lt;/li>
&lt;li>如果我们的软件供应链受到攻击，我不确定我们会首先向谁求助&lt;/li>
&lt;/ul>
&lt;p>几乎三分之二的C-suite高管表示，在他们的公司中，安全可能是最慢的部门。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-20.jpg"
loading="lazy"
>&lt;/p>
&lt;p>人口统计学上的差异。按C-suite高管的类型 :CEO比CTO/CIO/CISO和其他C-suites更有可能说。&lt;/p>
&lt;ul>
&lt;li>他们现在比两年前更多地考虑合规问题（93% vs. 85%和79%）。&lt;/li>
&lt;li>合规挑战限制了他们的创新能力（82%对73%和73%）。&lt;/li>
&lt;li>安全挑战限制了他们的创新能力（84% vs. 72% &amp;amp; 64%）。&lt;/li>
&lt;li>他们宁愿处理自然灾害，也不愿处理软件供应链中的安全问题（80% vs. 62% &amp;amp; 52%）。&lt;/li>
&lt;li>在他们的公司里，安全可能是最慢的部门（79% vs. 58% &amp;amp; 50%）。&lt;/li>
&lt;li>如果我们的软件供应链受到攻击，我不确定我们会首先向谁求助（70%对45%和51%）。&lt;/li>
&lt;/ul>
&lt;p>人口统计学上的差异。按年龄划分 :40岁以下和40至54岁之间的人比55岁以上的人更有可能说。&lt;/p>
&lt;ul>
&lt;li>安全挑战限制了他们的创新能力（82% &amp;amp; 74% vs. 55%）。&lt;/li>
&lt;li>他们宁愿处理自然灾害也不愿处理软件供应链中的安全问题。
供应链的安全问题（69% &amp;amp; 69% 对 48%）。&lt;/li>
&lt;li>在他们的公司里，安全可能是最慢的部门（71% &amp;amp; 65% vs. 39%）。&lt;/li>
&lt;li>他们不确定如果他们的软件供应链受到攻击，他们会首先求助于谁（62% &amp;amp; 55% vs. 34%）。&lt;/li>
&lt;/ul>
&lt;p>人口统计学上的差异。按公司规模划分：员工人数少于1000人的公司比员工人数在1000人以上的公司更可能说。&lt;/p>
&lt;ul>
&lt;li>他们更愿意处理自然灾害而不是软件供应链中的安全问题（70%对62%）。&lt;/li>
&lt;/ul>
&lt;p>人口统计学上的差异。按在C-suite的时间划分 ：在C-Suite工作10年以下的人比10年以上的人更有可能说。&lt;/p>
&lt;ul>
&lt;li>在他们的公司里，安全可以成为缓慢的部门（67%对52%）。&lt;/li>
&lt;/ul>
&lt;p>澳大利亚的C-Suite高管比其他国家的高管更有可能说，如果他们的软件供应链受到攻击，他们不确定会首先求助于谁。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-27.jpg"
loading="lazy"
>&lt;/p>
&lt;p>所有这些与去年相比都有所下降，但这可能与西班牙和澳大利亚的加入有更大关系，而不是条件的变化。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-28.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q10 每项的自动化程度如何？&lt;/p>&lt;/blockquote>
&lt;p>五分之三的C-suites（59%）说他们的软件供应链几乎或完全自动化；比去年的四分之三（75%）有所下降。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-29.jpg"
loading="lazy"
>&lt;/p>
&lt;p>澳大利亚、英国和美国的首席执行官比法国、德国和西班牙的首席执行官更可能说他们的软件供应链是自动化的。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-30.jpg"
loading="lazy"
>&lt;/p>
&lt;p>近五分之三的企业高管表示他们的合规流程完全或几乎全部自动化，而四分之一的企业高管表示他们的合规流程大约有一半自动化。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-31.jpg"
loading="lazy"
>&lt;/p>
&lt;p>澳大利亚和美国的C-suites比其他国家的C-suites更可能说他们的合规流程是自动化的。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-32.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q11 当谈到你拥有的安全和/或合规性问题的工具时，哪种工具与你正在使用的工具最接近？&lt;/p>&lt;/blockquote>
&lt;p>五分之三的C-suite高管（59%）表示，他们拥有的安全和/或合规性工具全部或大部分都来自外部，而十分之三的人拥有混合的工具，十分之一的人（11%）拥有大部分或全部自己创建的工具。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-33.jpg"
loading="lazy"
>&lt;/p>
&lt;p>与法国、德国和西班牙相比，澳大利亚、英国和美国的首席执行官们表示，他们在安全和/或合规问题上使用了所有或大部分的外部工具。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-34.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q12 你目前是否在你的组织中实施了向左转的安全和合规方法？&lt;/p>&lt;/blockquote>
&lt;p>超过四分之三的C-suite高管表示，他们正在其组织中实施 &amp;ldquo;左移 &amp;ldquo;的安全和合规方法，其中三分之一表示他们肯定在实施。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-35.jpg"
loading="lazy"
>&lt;/p>
&lt;p>澳大利亚、西班牙、英国和美国的首席执行官比法国和德国的首席执行官更有可能说他们正在其组织中实施 &amp;ldquo;左移 &amp;ldquo;的安全和合规方法，而德国人更有可能说他们没有实施这种方法。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-36.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q13 哪一个最接近左移方法对你的开发者的影响？&lt;/p>&lt;/blockquote>
&lt;p>近五分之三的C-suite高管说 &amp;ldquo;左移 &amp;ldquo;方法对他们的开发人员是一种负担，而超过三分之一的人说它是一种帮助。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-37.jpg"
loading="lazy"
>&lt;/p>
&lt;p>澳大利亚的C-suites比其他国家的C-suites更有可能说 &amp;ldquo;左移 &amp;ldquo;方法对他们的开发人员是一种负担，而德国和西班牙的C-suites更有可能说这是对他们的帮助。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-38.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q14 你有多同意或不同意以下说法？&lt;/p>&lt;/blockquote>
&lt;p>十分之九的C-suite高管表示他们的风险管理团队拥有建立和/或确保安全的软件供应链的知识和专长，而几乎十分之九的人表示他们的架构师和/或开发人员拥有。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-39.jpg"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>我们的风险管理团队拥有建立和/或确保安全的软件供应链的知识和专长。&lt;/li>
&lt;li>我对我们的软件在生产中的安全性非常有信心&lt;/li>
&lt;li>我们的架构师和/或开发人员拥有构建和/或确保软件供应链安全的知识和专业技能&lt;/li>
&lt;li>我们的风险管理团队拥有他们需要的所有工具&lt;/li>
&lt;li>我们的开发人员拥有他们需要的所有工具&lt;/li>
&lt;li>左移对我们的组织来说是很重要的&lt;/li>
&lt;/ul>
&lt;p>超过五分之四的C-suite高管表示 &amp;ldquo;左移 &amp;ldquo;对他们的组织很重要。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-40.jpg"
loading="lazy"
>&lt;/p>
&lt;p>西班牙、英国和美国的C-suite高管比澳大利亚、法国和德国的C-suite高管更有可能说他们对自己的软件在生产中的安全性非常有信心。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-41.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>S4 目前有多少开发人员在贵公司工作？如果您不确定，请使用您最好的估计。&lt;/p>&lt;/blockquote>
&lt;p>五分之二的C-suite高管（41%）说他们公司目前有100个或更少的开发人员，而超过三分之一（35%）的人超过200个。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-42.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>Q2 与两年前相比，您认为您对软件供应链攻击的担忧是多还是少？&lt;/p>&lt;/blockquote>
&lt;p>法国、德国、西班牙和英国的C-suite高管比澳大利亚和美国的C-suite高管更有可能说他们的公司目前有1-50名开发人员，而澳大利亚的高管则更有可能说他们有201-300名。
&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-43.jpg"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-44.jpg"
loading="lazy"
>&lt;/p>
&lt;blockquote>
&lt;p>方法论&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>CloudBees与Regina Corso Consulting合作，对澳大利亚、法国、德国、西班牙、英国和美国的C-suite高管进行了调查，以收集关于软件供应链和围绕它的安全问题的见解。&lt;/li>
&lt;li>本次调查的对象是来自至少有250名员工的公司的600名C-suite高管，澳大利亚、法国、德国、西班牙、英国和美国各有100名受访者。&lt;/li>
&lt;li>本次调查于2022年6月27日至7月8日在网上进行。&lt;/li>
&lt;li>阅读图表时注意。由于四舍五入，或由于问题允许多次回答，百分比的总和可能不是100%。此外，&amp;rdquo;*&amp;ldquo;表示回答少于0.5%。除非另有说明，所有幻灯片的基数代表600名C-suite管理人员的总数。如果问题与前一年的调查重复，则显示趋势数据。&lt;/li>
&lt;li>关于逐年数据的说明。2021年只有四个国家（法国、德国、美国和英国），而2022年增加了两个国家。&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>人口统计学&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>年龄：18-39岁=45%，40-54岁=40%；和55岁以上=16%。&lt;/li>
&lt;li>性别特征。男性=70%；女性=29%；非二进制=*。&lt;/li>
&lt;li>公司规模。250-999名员工=53%，1000名或以上员工=48%。&lt;/li>
&lt;li>C-suite高管的类型。CEO=34%；CIO=21%；CTO=19%；首席审计官=6%；CISO=6%；首席风险官=2%；以及其他C-suite=12%。&lt;/li>
&lt;li>担任C-suite高管的时间：5年或以下=29%；6-10年=48%；11-20年=16%，20年以上=7%。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/sec-survey-2022/CloudBees_2022_Global_C_Suite_Security_Survey_Report-47.jpg"
loading="lazy"
>&lt;/p>
&lt;p>&lt;a class="link" href="CloudBees_2022_Global_C_Suite_Security_Survey_Report.pdf" >点此处，下载本报告的 PDF 文件 📃&lt;/a>&lt;/p></description></item><item><title>Elastic Agent 和 Fleet 服务器 安装手册 v8.4</title><link>https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/</link><pubDate>Tue, 18 Oct 2022 21:32:14 +0800</pubDate><guid>https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/</guid><description>&lt;img src="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/observability.webp" alt="Featured image of post Elastic Agent 和 Fleet 服务器 安装手册 v8.4" />&lt;p>测试过程和环境概述：&lt;/p>
&lt;ul>
&lt;li>用一个 RHEL 9 虚拟机安装 Elasticsearch 和 Kibana；然后部署 Fleet 服务器。&lt;/li>
&lt;li>在另外一个虚拟机安装 Elastic Agent，初始化注册到 Fleet 服务器，然后更新对它的管理策略。&lt;/li>
&lt;li>在 Kibana 的可观测性和安全解决方案中观察采集到的数据。&lt;/li>
&lt;/ul>
&lt;h2 id="安装-elasticsearch">安装 Elasticsearch
&lt;/h2>&lt;p>下载 Elasticsearch 的 rpm 安装包，用 rpm 的方式安装 Elasticssearch 服务器。 &lt;code>dnf install elasticsearch-8.4.3-x86_64.rpm &lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># dnf install elasticsearch-8.4.3-x86_64.rpm &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Updating Subscription Management repositories.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Red Hat Enterprise Linux &lt;span class="m">9&lt;/span> &lt;span class="k">for&lt;/span> x86_64 - BaseOS &lt;span class="o">(&lt;/span>RPMs&lt;span class="o">)&lt;/span> 3.9 kB/s &lt;span class="p">|&lt;/span> 4.1 kB 00:01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Red Hat Enterprise Linux &lt;span class="m">9&lt;/span> &lt;span class="k">for&lt;/span> x86_64 - AppStream &lt;span class="o">(&lt;/span>RPMs&lt;span class="o">)&lt;/span> 3.9 kB/s &lt;span class="p">|&lt;/span> 4.1 kB 00:01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dependencies resolved.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=============================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Package Architecture Version Repository &lt;span class="nv">Size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=============================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installing:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elasticsearch x86_64 8.4.3-1 @commandline &lt;span class="m">540&lt;/span> M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transaction &lt;span class="nv">Summary&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=============================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Install &lt;span class="m">1&lt;/span> Package
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total size: &lt;span class="m">540&lt;/span> M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed size: 1.1 G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Is this ok &lt;span class="o">[&lt;/span>y/N&lt;span class="o">]&lt;/span>: y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Downloading Packages:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running transaction check
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transaction check succeeded.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running transaction &lt;span class="nb">test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transaction &lt;span class="nb">test&lt;/span> succeeded.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running transaction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Preparing : 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Running scriptlet: elasticsearch-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Creating elasticsearch group... OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Creating elasticsearch user... OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Installing : elasticsearch-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Running scriptlet: elasticsearch-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------- Security autoconfiguration information ------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Authentication and authorization are enabled.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TLS &lt;span class="k">for&lt;/span> the transport and HTTP layers is enabled and configured.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The generated password &lt;span class="k">for&lt;/span> the elastic built-in superuser is : guJrLagKN5bsmUh72bha
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">If this node should join an existing cluster, you can reconfigure this with
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;/usr/share/elasticsearch/bin/elasticsearch-reconfigure-node --enrollment-token &amp;lt;token-here&amp;gt;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">after creating an enrollment token on your existing cluster.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You can &lt;span class="nb">complete&lt;/span> the following actions at any time:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Reset the password of the elastic built-in superuser with
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;/usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic&amp;#39;&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generate an enrollment token &lt;span class="k">for&lt;/span> Kibana instances with
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;/usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana&amp;#39;&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generate an enrollment token &lt;span class="k">for&lt;/span> Elasticsearch nodes with
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;/usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s node&amp;#39;&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### NOT starting on installation, please execute the following statements to configure elasticsearch service to start automatically using systemd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo systemctl &lt;span class="nb">enable&lt;/span> elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### You can start elasticsearch service by executing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo systemctl start elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/lib/tmpfiles.d/elasticsearch.conf:1: Line references path below legacy directory /var/run/, updating /var/run/elasticsearch → /run/elasticsearch&lt;span class="p">;&lt;/span> please update the tmpfiles.d/ drop-in file accordingly.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Verifying : elasticsearch-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed products updated.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> elasticsearch-8.4.3-1.x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Complete!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装完毕之后，用 vi 编辑器打开 &lt;code>/etc/elasticsearch/elasticsearch.yml&lt;/code> 配置文件 ； 在这个默认配置文件中寻找类似这样的一行 &lt;code>cluster.initial_master_nodes: [&amp;quot;elk8&amp;quot;]&lt;/code> ；将这一行注释掉。&lt;/p>
&lt;p>然后在此配置文件的最下面增加下面这几行。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">cluster.name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">homelab-elk8&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">discovery.type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">single-node&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">network.host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.authc.api_key.enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>启动 Elasticsearch 服务，并查看服务的状态。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status elasticsearch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在使用 ES 前，可以先修改ES服务初始化的内建用户密码，改成自己好记的安全可控密码。否则需要到 ES 的启动日志里寻找系统自动生产的管理员密码。&lt;/p>
&lt;p>运行 &lt;code>/usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic -i&lt;/code> 命令修改 ES 的管理员账号 elastic 的密码。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic -i&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">This tool will reset the password of the &lt;span class="o">[&lt;/span>elastic&lt;span class="o">]&lt;/span> user.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You will be prompted to enter the password.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Please confirm that you would like to &lt;span class="k">continue&lt;/span> &lt;span class="o">[&lt;/span>y/N&lt;span class="o">]&lt;/span>y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter password &lt;span class="k">for&lt;/span> &lt;span class="o">[&lt;/span>elastic&lt;span class="o">]&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Re-enter password &lt;span class="k">for&lt;/span> &lt;span class="o">[&lt;/span>elastic&lt;span class="o">]&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password &lt;span class="k">for&lt;/span> the &lt;span class="o">[&lt;/span>elastic&lt;span class="o">]&lt;/span> user successfully reset.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在启动 ES 服务前，打开后续测试所需要的防火墙端口。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">firewall-cmd --permanent --add-port&lt;span class="o">=&lt;/span>9200/tcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --permanent --add-port&lt;span class="o">=&lt;/span>5601/tcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --permanent --add-port&lt;span class="o">=&lt;/span>8220/tcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall-cmd --reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在浏览器里访问 es 的访问网址 https://10.0.30.105:9200/ ，忽略关于证书的安全提示，输入上面所修改的 elastic 账户信息，测试是否可以正常登录。&lt;/p>
&lt;h2 id="安装-kibana">安装 Kibana
&lt;/h2>&lt;p>下载 Kibana 的 rpm 安装包到服务器，然后执行下面的安装命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># dnf install kibana-8.4.3-x86_64.rpm &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Updating Subscription Management repositories.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Last metadata expiration check: 0:22:56 ago on Sun &lt;span class="m">16&lt;/span> Oct &lt;span class="m">2022&lt;/span> 02:20:20 PM CST.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dependencies resolved.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=======================================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Package Architecture Version Repository &lt;span class="nv">Size&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=======================================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installing:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kibana x86_64 8.4.3-1 @commandline &lt;span class="m">274&lt;/span> M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transaction &lt;span class="nv">Summary&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">=======================================================================================================================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Install &lt;span class="m">1&lt;/span> Package
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total size: &lt;span class="m">274&lt;/span> M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed size: &lt;span class="m">649&lt;/span> M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Is this ok &lt;span class="o">[&lt;/span>y/N&lt;span class="o">]&lt;/span>: y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Downloading Packages:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running transaction check
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transaction check succeeded.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running transaction &lt;span class="nb">test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Transaction &lt;span class="nb">test&lt;/span> succeeded.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Running transaction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Preparing : 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Running scriptlet: kibana-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Installing : kibana-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Running scriptlet: kibana-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Creating kibana group... OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Creating kibana user... OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Created Kibana keystore in /etc/kibana/kibana.keystore
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/lib/tmpfiles.d/elasticsearch.conf:1: Line references path below legacy directory /var/run/, updating /var/run/elasticsearch → /run/elasticsearch&lt;span class="p">;&lt;/span> please update the tmpfiles.d/ drop-in file accordingly.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Verifying : kibana-8.4.3-1.x86_64 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed products updated.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kibana-8.4.3-1.x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Complete!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在启动 Kiban 服务器之前，先需要创建 Kibana 需要的各种加密 key ，执行下面的命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">/usr/share/kibana/bin/kibana-encryption-keys generate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.encryptedSavedObjects.encryptionKey: 2e71f1b16031c2b111b76276268dbf9e
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.reporting.encryptionKey: 84cb58b5e944fa9f65f73382384612a5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.encryptionKey: c5ac5b306ee011838a67e2eaf4154dd0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>记录以上三行配置参数，并增加2行新参数，将它们全部添加到 Kibana 默认的配置文件中。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">server.host&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0.0.0.0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">server.publicBaseUrl&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;http://10.0.30.105:5601&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.encryptedSavedObjects.encryptionKey&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">2e71f1b16031c2b111b76276268dbf9e&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.reporting.encryptionKey&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">84cb58b5e944fa9f65f73382384612a5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">xpack.security.encryptionKey&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">c5ac5b306ee011838a67e2eaf4154dd0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>用 vi 打开 Kibana 的默认配置文件 &lt;code>/etc/kibana/kibana.yml&lt;/code> ，将上面的 5 行配置参数添加到文件中。&lt;/p>
&lt;p>在命令行执行 &lt;code>systemctl enable --now kibana&lt;/code> 命令启动 Kibana 服务器.&lt;/p>
&lt;p>然后执行命令 &lt;code>tail -f /var/log/messages&lt;/code> ， 在日志中寻找 Kibana 服务启动的信息，等待出现 Kibana 配置的访问 URL。在日志中寻找类似这样的信息：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="err">Oct&lt;/span> &lt;span class="mi">18&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">36&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">48&lt;/span> &lt;span class="err">elk&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="err">kibana&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2163&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="err">i&lt;/span> &lt;span class="err">Kibana&lt;/span> &lt;span class="err">has&lt;/span> &lt;span class="err">not&lt;/span> &lt;span class="err">been&lt;/span> &lt;span class="err">configured.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">Oct&lt;/span> &lt;span class="mi">18&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">36&lt;/span>&lt;span class="err">:&lt;/span>&lt;span class="mi">48&lt;/span> &lt;span class="err">elk&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="err">kibana&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2163&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="err">Go&lt;/span> &lt;span class="err">to&lt;/span> &lt;span class="err">http:&lt;/span>&lt;span class="c1">//0.0.0.0:5601/?code=732948 to get started.
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将 0.0.0.0 替换为这台虚拟机的 IP 地址，然后在浏览器中打开这个类似这个 &lt;code>http://10.0.30.105:5601/?code=732948&lt;/code> 网址。网页中会出现一个大输入框，等待输入Kibana 注册秘钥。&lt;/p>
&lt;p>在命令行执行 &lt;code>/usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana&lt;/code> 命令，从而获取 Kibana 的注册令牌。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">eyJ2ZXIiOiI4LjQuMyIsImFkciI6WyIxOTIuMTY4LjEwLjEwOjkyMDAiXSwiZmdyIjoiZTdlOTdlZWU2YWVlYjVmYTczZWM1YTVkNzBiNDJkZGUzZjlkZmNjMDJhNTVmZDcwZjAxOTQwZmExNzE5YWM2MSIsImtleSI6IjNHLVEzNE1CYnA4c3p4TEZEZXpCOk0wUDMzRC1VVFAyT0ZxQVFBekNKSWcifQ&lt;/span>&lt;span class="o">==&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将这个 Token 复制到网页里，完成Kibana 的初始化配置，最后用 es 的管理员账号登录 Kibana。&lt;/p>
&lt;p>从 kiban 目录中找到 es 的根 ca 证书，将其安装在系统的默认根证书目录中。查看 Kibana 的配置文件找到类似这样的一行配置信息。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">elasticsearch.ssl.certificateAuthorities: &lt;span class="o">[&lt;/span>/var/lib/kibana/ca_1666060779947.crt&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>运行下面的命令安装这个根证书。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">update-ca-trust &lt;span class="nb">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cp /var/lib/kibana/ca_1666060779947.crt /etc/pki/ca-trust/source/anchors/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">update-ca-trust extract
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>建议将这个根证书也用这个方法复制到其他需要用 Elastic Agent 采集监控数据的操作系统中，并安装备用。也可以在 Elastic Agent 安装的时候指定忽略 ES 证书校验的参数。&lt;/p>
&lt;h2 id="安装-fleet-服务器">安装 Fleet 服务器
&lt;/h2>&lt;p>在 Kibana 的菜单中找到， Fleet 选项，点击 Settings，然后点击 Edit Hosts ，选择增加 Fleet server 配置信息，输入 &lt;code>https://10.0.30.105:8220&lt;/code> ，注意这里必须是 https协议。&lt;/p>
&lt;p>回到 Fleet 主页，找到 agent 管理的地方，按照流程做，点击创建 Fleet Server 配置。然后就会在页面上生成 Fleet 服务器的安装配置命令。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_10-46-39.webp"
width="1280"
height="1090"
srcset="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_10-46-39_hu_353c859e47b50488.webp 480w, https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_10-46-39_hu_d3a71f9e9ac28864.webp 1024w"
loading="lazy"
alt="Fleet server"
class="gallery-image"
data-flex-grow="117"
data-flex-basis="281px"
>&lt;/p>
&lt;p>按着提示的命令参数安装 Fleet 服务器。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar xzvf elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> elastic-agent-8.4.3-linux-x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ./elastic-agent install &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --fleet-server-es&lt;span class="o">=&lt;/span>https://192.168.10.10:9200 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --fleet-server-service-token&lt;span class="o">=&lt;/span>AAEAAWVsYXN0aWMvZmxlZXQtc2VydmVyL3Rva2VuLTE2NjU5MTM3ODg1NTA6aWdrR1pvNk9SWmk5N09tV3pUQktTUQ &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --fleet-server-policy&lt;span class="o">=&lt;/span>fleet-server-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --insecure
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面是连续四条安装命令，需要在最后一条命中，增加一个参数 &lt;code>--insecure&lt;/code> ；这样可以确保 Fleet 服务器的正常配置。&lt;/p>
&lt;p>在 Fleet 服务器正常启动以后，上面创建 Fleet 服务器配置的网页上的最后一步就会显示：Fleet 服务器已经连接正常，等待注册 Elastic Agent 。这样表明 Fleet 服务器已经安装正常，并且运行在默认的代理配置采集策略下。&lt;/p>
&lt;p>可以在 Kibana 的界面里查看 Fleet 服务器的监控信息。点击 Kibana 左上角的菜单：Observability -&amp;gt; Infrastructure -&amp;gt; Inventory ，即可看到 Fleet 服务器的监控数据。&lt;/p>
&lt;h2 id="安装-elastic-agent-监控代理">安装 Elastic Agent 监控代理
&lt;/h2>&lt;p>在 Fleet 的管理界面中新增一个名为 my-policy1 的管理策略，避免和 Fleet 服务器使用相同的策略。点击 Add agent 连接，获取如下代理注册命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar xzvf elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> elastic-agent-8.4.3-linux-x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ./elastic-agent install --url&lt;span class="o">=&lt;/span>https://10.0.30.105:8220 --enrollment-token&lt;span class="o">=&lt;/span>&lt;span class="nv">NW9ZTjZZTUJtUENhc0ZFTDI5SV86MkZQT1hlc2dUOEdWZnRrWWhNbXVjdw&lt;/span>&lt;span class="o">==&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将上面的命令复制到一个写字板中，修改最后一条命令，在最后增加&lt;code>--insecure&lt;/code> 参数&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">./elastic-agent install --url&lt;span class="o">=&lt;/span>https://10.0.30.105:8220 --enrollment-token&lt;span class="o">=&lt;/span>&lt;span class="nv">NW9ZTjZZTUJtUENhc0ZFTDI5SV86MkZQT1hlc2dUOEdWZnRrWWhNbXVjdw&lt;/span>&lt;span class="o">==&lt;/span> --insecure
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>通过执行上面的命令，我们就在被管理服务器上，一键式的安装了用于数据采集功能的 Elastic Agent ，并将其注册到 Fleet 服务器上。你也可以手工下载好 &lt;code>elastic-agent-8.4.3-linux-x86_64.tar.gz &lt;/code> 文件，但是反复在多个被管理服务器上复制也很麻烦。&lt;/p>
&lt;h2 id="搭建本地安装包下载服务器">搭建本地安装包下载服务器
&lt;/h2>&lt;p>为了让局域网中的操作系统能就近下载 Elastic Stack 技术栈中，所有可以通过 Fleet 服务器管理（安装、配置、升级、删除等）的组件，我们可以参考文档的方法：https://www.elastic.co/guide/en/fleet/8.4/air-gapped.html#host-artifact-registry 在本地部署一个安装包下载服务器。&lt;/p>
&lt;p>首先，安装一个 Nginx 服务器，在根目录下创建目录 downloads ，并且运行下面的下载脚本。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/apm-server/apm-server-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/apm-server/apm-server-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/apm-server/apm-server-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/auditbeat/auditbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/auditbeat/auditbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/auditbeat/auditbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/heartbeat/heartbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/heartbeat/heartbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/heartbeat/heartbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/osquerybeat/osquerybeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/osquerybeat/osquerybeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/osquerybeat/osquerybeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/packetbeat/packetbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/packetbeat/packetbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/beats/packetbeat/packetbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/cloudbeat/cloudbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/cloudbeat/cloudbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/cloudbeat/cloudbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/endpoint-dev/endpoint-security-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/endpoint-dev/endpoint-security-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/endpoint-dev/endpoint-security-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/fleet-server/fleet-server-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/fleet-server/fleet-server-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -O https://artifacts.elastic.co/downloads/fleet-server/fleet-server-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将下载后的目录结构整理的和下载路径一致，目录结构如下所示：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 html&lt;span class="o">]&lt;/span>&lt;span class="c1"># tree downloads/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">downloads/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── apm-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── apm-server-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── apm-server-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── apm-server-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── beats
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── auditbeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── auditbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── auditbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── auditbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── elastic-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── elastic-agent-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── elastic-agent-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── filebeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── filebeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── filebeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── filebeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── heartbeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── heartbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── heartbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── heartbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── metricbeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── metricbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── metricbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── metricbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── osquerybeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── osquerybeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── osquerybeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── osquerybeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── packetbeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── packetbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── packetbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── packetbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── cloudbeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── cloudbeat-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── cloudbeat-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── cloudbeat-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── endpoint-dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── endpoint-security-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── endpoint-security-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── endpoint-security-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── fleet-server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── fleet-server-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── fleet-server-8.4.3-linux-x86_64.tar.gz.asc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── fleet-server-8.4.3-linux-x86_64.tar.gz.sha512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── pull-bin.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">12&lt;/span> directories, &lt;span class="m">34&lt;/span> files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@elk8 html&lt;span class="o">]&lt;/span>&lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>为了方便查看这个目录的内容，修改 nginx 的默认配置文件，在 http 这个部分增加下面三个参数：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">autoindex on; &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">autoindex_exact_size off;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="l">autoindex_localtime on; &lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>重启 Nginix 服务器后，在浏览器中可以访问： http://192.168.10.10/downloads/ ，确保可以看到正确的目录结构和文件。&lt;/p>
&lt;p>进入 Fleet 的配置页面，在 &lt;code>Agent Binary Download&lt;/code> 下面点击 “Add agent binary source” ，新建一个新的代理安装包下载来源网站。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_14-21-44.webp"
width="1920"
height="1436"
srcset="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_14-21-44_hu_81f6549ac98b5cf0.webp 480w, https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_14-21-44_hu_5513f1e8fc13f2ca.webp 1024w"
loading="lazy"
alt="Agent Binary Download"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
>&lt;/p>
&lt;p>在 Agent Policies 页面新建一个新的测试用 Agent 管理策略，名为 “my-policy2”；进入这个策略的配置界面，修改 &lt;em>Agent Binary Download&lt;/em> 为刚才创建的下载源。保存并测试这个策略。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_14-25-35.webp"
width="1920"
height="1860"
srcset="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_14-25-35_hu_1ee19fedc7a1e756.webp 480w, https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_14-25-35_hu_e38bd9d16b2624f.webp 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="103"
data-flex-basis="247px"
>&lt;/p>
&lt;p>点击 “Add agent” 连接，获取下面的新注册代理注册命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">curl -L -O https://artifacts.elastic.co/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz tar xzvf elastic-agent-8.4.3-linux-x86_64.tar.gz &lt;span class="nb">cd&lt;/span> elastic-agent-8.4.3-linux-x86_64 sudo ./elastic-agent install --url&lt;span class="o">=&lt;/span>https://10.0.30.105:8220 --enrollment-token&lt;span class="o">=&lt;/span>&lt;span class="nv">R29qRDZZTUJtUENhc0ZFTFNDSW06bVFOeW5vcUpTQmFmZDBwLUgyTDBYZw&lt;/span>&lt;span class="o">==&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改这些命令参数，如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">curl -L -O http://192.168.10.10/downloads/beats/elastic-agent/elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar xzvf elastic-agent-8.4.3-linux-x86_64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> elastic-agent-8.4.3-linux-x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ./elastic-agent install --url&lt;span class="o">=&lt;/span>https://10.0.30.105:8220 --enrollment-token&lt;span class="o">=&lt;/span>&lt;span class="nv">R29qRDZZTUJtUENhc0ZFTFNDSW06bVFOeW5vcUpTQmFmZDBwLUgyTDBYZw&lt;/span>&lt;span class="o">==&lt;/span> --insecure
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>SSH 登录到另外一个虚拟机，用新创建的 Agent 管理策略，一键式安装 Elastic Agent 并注册到 Fleet 服务器。由于这个策略使用了本地的安装包（默认会使用到 Filebeat 和 Metricbeat），所以它的部署速度应该会比较快。&lt;/p>
&lt;p>在 Elastic Agent 的日志文件中应该可以看到类似这样的信息。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">cat /opt/Elastic/Agent/elastic-agent-20221018.ndjson
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sb">```&lt;/span>json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;log.level&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;info&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;@timestamp&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;2022-10-18T14:37:26.697+0800&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;log.origin&amp;#34;&lt;/span>:&lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;file.name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;artifact/config.go&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;file.line&amp;#34;&lt;/span>:138&lt;span class="o">}&lt;/span>,&lt;span class="s2">&amp;#34;message&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Source URI changed from \&amp;#34;https://artifacts.elastic.co/downloads/\&amp;#34; to \&amp;#34;http://192.168.10.10/downloads/\&amp;#34;&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;ecs.version&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;1.6.0&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个信息表示：当前的 Agent 会使用上面自建的安装包下载源服务器。&lt;/p>
&lt;p>用这个命令 &lt;code>elastic-agent inspect&lt;/code> 也可以确认这个配置。&lt;/p>
&lt;h2 id="万用采集端的好处">万用采集端的好处
&lt;/h2>&lt;p>在上一篇文章中已经说过了这个问题，这里不赘述。&lt;/p>
&lt;p>为了验证这个功能，可以尝试更新当前的一个 policy，增加 Packetbeat 数据采集能力。操作步骤如下：&lt;/p>
&lt;ol>
&lt;li>打开当前的一个正在使用中 policy&lt;/li>
&lt;li>点击 Add intergation 按钮，在众多选项中选择 Network Packet Capture 模块。&lt;/li>
&lt;li>增加新的采集模块后，保存这个策略。&lt;/li>
&lt;li>它更新了版本，观察 Fleet 界面上所有使用这个策略的节点的状态变化。&lt;/li>
&lt;li>这些节点会自动的，很快的更新到新的管理策略中，Elastic Agent 会自动化安装 Packetbeat 采集模块。&lt;/li>
&lt;li>返回 Kiban ，进入安全管理解决方案，我们可以看到 Filebeat 和 Packetbeat 的采集结果。&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_22-49-08.webp"
width="1920"
height="817"
srcset="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_22-49-08_hu_9315233f52a0deb3.webp 480w, https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_22-49-08_hu_6f705180b238a5b3.webp 1024w"
loading="lazy"
alt="添加 Packetbeat 模块"
class="gallery-image"
data-flex-grow="235"
data-flex-basis="564px"
>&lt;/p>
&lt;p>在策略更新了以后，我们没有在 Elastic Agent 端做任何操作，它就已经自动化的下载新的策略，并更新了自身。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_22-53-55.webp"
width="1920"
height="1675"
srcset="https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_22-53-55_hu_e565716a7037207b.webp 480w, https://martinliu.cn/blog/elastic-agent-fleet-update-8-4/2022-10-18_22-53-55_hu_77b42a837a097172.webp 1024w"
loading="lazy"
alt="查看 安全管理解决方案"
class="gallery-image"
data-flex-grow="114"
data-flex-basis="275px"
>&lt;/p>
&lt;h2 id="常见问题">常见问题
&lt;/h2>&lt;p>Elastic Agent 在采集数据的服务上安装正常，在 Fleet 服务器的管理界面中也可以看到其状态正常。但是在可观测性的页面中看不到它的任何数据。&lt;/p>
&lt;p>可能的原因：Elastic Agent 采集端程序和 ES 后台服务器的通讯不正常，检查 9200 端口，用 curl + ES 服务器端的数字证书，用户名和密码，尝试访问 ES 的服务地址 &lt;code>https://192.168.10.10:9200&lt;/code>。&lt;/p>
&lt;p>也可以尝试在 Fleet 的管理页面上删除这个 Agent；然后在被管理服务器上，用命令 &lt;code>elastic-agent uninstall&lt;/code> 删除服务，然后重新安装注册这个被管理服务器，注意在注册命令的最后面可以尝试增加这两个参数：&lt;code> --insecure --fleet-server-es-insecure&lt;/code> 第一个参数是忽略 Fleet 服务器的 ssl 证书校验，第二个参数是忽略 es 服务器的 ssl 证书校验。或者尝试重新手工安装一遍 es 服务器上的 ca 根证书。&lt;/p>
&lt;p>Feature picture ❤️ Brett Sayles图片: &lt;a class="link" href="https://www.pexels.com/zh-cn/photo/2881224/" target="_blank" rel="noopener"
>https://www.pexels.com/zh-cn/photo/2881224/&lt;/a>&lt;/p></description></item></channel></rss>