<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Centos on Martin Liu's Blog</title><link>https://martinliu.cn/tags/centos/</link><description>Recent content in Centos on Martin Liu's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 20 May 2024 23:30:38 +0800</lastBuildDate><atom:link href="https://martinliu.cn/tags/centos/index.xml" rel="self" type="application/rss+xml"/><item><title>Ovirt 服务器虚拟化测试</title><link>https://martinliu.cn/2015/07/12/ovirt-e69c8de58aa1e599a8e8999ae68b9fe58c96e6b58be8af95/</link><pubDate>Sun, 12 Jul 2015 11:16:44 +0000</pubDate><guid>https://martinliu.cn/2015/07/12/ovirt-e69c8de58aa1e599a8e8999ae68b9fe58c96e6b58be8af95/</guid><description>&lt;h1 id="ovirt-服务器虚拟化测试">Ovirt 服务器虚拟化测试
&lt;/h1>&lt;p>本文安装和测试的软件是 Ovirt+KVM 的服务器虚拟化，这两个项目是红帽 RHEVM+KVM 服务器虚拟化的上游社区产品。可以通过这个文档清晰的了解到红帽服务器虚拟化产品的大体功能，基本特点。本测试文档使用的是 Centos7+社区 yum 源；因此是最新的 ovirt 和 kvm 的功能。如果是正式的企业级需求测试，请使用光纤或者传统存储，从而达到和 vmware 等商业产品最好的类比测试。尽量避免使用嵌套 kvm 虚拟化的方式，除非您很熟悉 Linux，使用两个笔记本是最简单的测试环境。&lt;/p>
&lt;p>下图是 Ovirt 服务器的详细架构图。其中的 ovirt-engine 是本文安装和部署的部分，是用一个 centos7 的虚拟机安装的。Host1 也是用一个 centos7 的虚拟机安装的。半年之前我也配置过一次嵌套 kvm，根本是一头雾水，而且还没有成功，不过这次的配置过程却这么简单容易，就正常工作了。希望简单一点的人，可以把 Host1 用物理机来安装，也会节省很多时间。&lt;/p>
&lt;p>[caption id=&amp;ldquo;attachment_53901&amp;rdquo; align=&amp;ldquo;alignnone&amp;rdquo; width=&amp;ldquo;512&amp;rdquo;]&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2015/07/ovirt-512px-Architecture.png"
loading="lazy"
alt="ovirt 架构图"
> ovirt 架构图[/caption]&lt;/p>
&lt;h2 id="kvm-嵌套虚拟化准备">KVM 嵌套虚拟化准备
&lt;/h2>&lt;p>在测试 KVM 服务器虚拟化的过程中，如果您能有独立的物理机跑 Hypervisor，那么您可以忽略本节。至今进入 ovirt 的安装。  下面的测试的物理机是 Lenovo T440s 笔记本，运行的 Fedora 22 操作系统，使用 KVM manager 做虚拟机的管理工具。本次测试用到两个虚拟机：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>ovirt: 运行服务器虚拟化的管理机 ovirt，这个程序类似于 vmware 的 vcenter。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ovirt-host : 用来被 ovirt 管理的 hypervisor；使用 kvm 嵌套 kvm 的方式，来跑虚拟机。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>确认本机的服务器虚拟机 CPU Bios 配置正常。&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>egrep -c &amp;lsquo;(vmx|svm)&amp;rsquo; /proc/cpuinfo&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;p>本机是 i5 的 CPU，双核开启超线程，显示为 4。还没有启用嵌套 KVM 的虚拟机，需要新建下面这个配置文件，操作系统不同，可能稍微不同，下面是以 Fedora 22 为例。&lt;/p>
&lt;p>vi /etc/modprobe.d/kvm-nested.conf
编辑以上文件，增加下面这行参数即可
options kvm_intel nested=1&lt;/p>
&lt;p>运行下面的命令，为操作系统内核加載此功能。&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>modprobe -r kvm_intel # unload
modprobe kvm_intel # reload again&lt;/p>
&lt;p>cat /sys/module/kvm_intel/parameters/nested
Y&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;p>用上面最后的 cat 的命令确认嵌套功能启用正常，看到的是 Y 即可。&lt;/p>
&lt;p>查看本机虚拟化的 Cpu 相关参数。&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>[root@martin-fedora vm]# virsh capabilities | egrep &amp;ldquo;/model|/vendor&amp;rdquo;
&lt;!-- raw HTML omitted -->Westmere&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->Intel&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->none&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->dac&lt;!-- raw HTML omitted -->
[root@martin-fedora vm]#&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;p>到此，物理机的相关准备工作完成。下面使用 Martin&amp;rsquo;s Perfect CentOS7 模板新建一个 2C/4Gd 的虚拟机 ovirt-host; 用这个虚拟机作为跑虚拟机的 hypervisor 把建立好的虚拟机先别开机，需要对它的配置做修改。编辑 ovirt-host 虚拟机的配置，给这个嵌套的 KVM hypervisor 增加和物理机相同的 cpu 属性。&lt;/p>
&lt;p>virsh edit ovirt-host&lt;/p>
&lt;p>本嵌套 kvm 的虚拟机 cpu 参数如下，如果测试的物理机使用非 i5 的 CPU， 实际的配置参数应该和下面不同。&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>[/bash]&lt;/p>
&lt;p>保存配置，启动这个虚拟机，配置好主机名和网络 ip 地址。安装 ovirt yum 源。做 yum update 之后，reboot 待用。&lt;/p>
&lt;p>[bash]
yum -y update
yum install &lt;a class="link" href="http://plain.resources.ovirt.org/pub/yum-repo/ovirt-release35.rpm" target="_blank" rel="noopener"
>http://plain.resources.ovirt.org/pub/yum-repo/ovirt-release35.rpm&lt;/a>&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;h2 id="安装-ovirt-服务器虚拟化管理机">安装 ovirt 服务器虚拟化管理机
&lt;/h2>&lt;p>使用 Martin&amp;rsquo;s Perfect CentOS7 模板新建一个 1C/4G 的虚拟机 ovirt；这个虚拟机上还需要配置 NFS 服务器，用来做 跑虚拟机的共享存储和用于存储 iso 光盘的存储。&lt;/p>
&lt;p>安装和配置 NFS 的过程如下：&lt;/p>
&lt;h2 id="安装-nfs-服务相关的包">安装 nfs 服务相关的包
&lt;/h2>&lt;p>yum install -y nfs-utils&lt;/p>
&lt;h2 id="创建存储目录">创建存储目录
&lt;/h2>&lt;p>mkdir -p /srv/ovirt/{iso,export,sata}
chown -R vdsm:kvm /srv/ovirt/
chmod -R 770 /srv/ovirt/&lt;/p>
&lt;p>编辑 nfs 配置文件 /ect/exports ， 加入下面三行。&lt;/p>
&lt;p>/srv/ovirt/iso 192.168.10.0/24(rw,anonuid=36,anongid=36,all_squash)
/srv/ovirt/export 192.168.10.0/24(rw,anonuid=36,anongid=36,all_squash)
/srv/ovirt/sata 192.168.10.0/24(rw,anonuid=36,anongid=36,all_squash)&lt;/p>
&lt;p>由于 centos 7 的 nfs 默认是 v4，这和 ovirt 不兼容，需要修改配置文件改为 v3， 编辑 /etc/nfsmount.conf 加入下面两个参数。&lt;/p>
&lt;p>Defaultvers=3
Nfsvers=3&lt;/p>
&lt;h2 id="重启动-nfs-服务器-设置开机启动服务">重启动 nfs 服务器 ，设置开机启动服务
&lt;/h2>&lt;p>systemctl start rpcbind.service &amp;amp;&amp;amp; systemctl enable rpcbind.service
systemctl start nfs-server.service &amp;amp;&amp;amp; systemctl enable nfs-server.service&lt;/p>
&lt;p>下面开始安装 ovirt 服务器。&lt;/p>
&lt;p>yum -y update
yum install &lt;a class="link" href="http://plain.resources.ovirt.org/pub/yum-repo/ovirt-release35.rpm" target="_blank" rel="noopener"
>http://plain.resources.ovirt.org/pub/yum-repo/ovirt-release35.rpm&lt;/a>
yum -y install ovirt-engine&lt;/p>
&lt;p>安装完后，用 engine-setup 命令配置和部署 ovirt 服务器。&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>[root@ovirt ~]# engine-setup
[ INFO ] Stage: Initializing
[ INFO ] Stage: Environment setup
Configuration files: [&amp;rsquo;/etc/ovirt-engine-setup.conf.d/10-packaging-jboss.conf&amp;rsquo;, &amp;lsquo;/etc/ovirt-engine-setup.conf.d/10-packaging.conf&amp;rsquo;]
Log file: /var/log/ovirt-engine/setup/ovirt-engine-setup-20150711225251-f9k7an.log
Version: otopi-1.3.2 (otopi-1.3.2-1.el7.centos)
[ INFO ] Stage: Environment packages setup
[ INFO ] Yum Downloading: ovirt-3.5-patternfly1-noarch-epel/x86_64 (0%)
[ INFO ] Stage: Programs detection
[ INFO ] Stage: Environment setup
[ INFO ] Stage: Environment customization&lt;/p>
&lt;p>&amp;ndash;== PRODUCT OPTIONS ==&amp;ndash;&lt;/p>
&lt;p>Configure Engine on this host (Yes, No) [Yes]: #回车，选择 Yes
Configure WebSocket Proxy on this host (Yes, No) [Yes]: #回车，选择 Yes&lt;/p>
&lt;p>&amp;ndash;== PACKAGES ==&amp;ndash;&lt;/p>
&lt;p>[ INFO ] Checking for product updates&amp;hellip;
[ INFO ] No product updates found&lt;/p>
&lt;p>&amp;ndash;== ALL IN ONE CONFIGURATION ==&amp;ndash;&lt;/p>
&lt;p>&amp;ndash;== NETWORK CONFIGURATION ==&amp;ndash;&lt;/p>
&lt;p>Setup can automatically configure the firewall on this system.
Note: automatic configuration of the firewall may overwrite current settings.
Do you want Setup to configure the firewall? (Yes, No) [Yes]: No #选择 no，由于本机的服务没有安装防火墙
Host fully qualified DNS name of this server [unknown.prolexic.com]: ovirt.xenlab.com #回车继续&lt;/p>
&lt;p>&amp;ndash;== DATABASE CONFIGURATION ==&amp;ndash;&lt;/p>
&lt;p>Where is the Engine database located? (Local, Remote) [Local]: #回车，选择 Local 继续
Setup can configure the local postgresql server automatically for the engine to run. This may conflict with existing applications.
Would you like Setup to automatically configure postgresql and create Engine database, or prefer to perform that manually? (Automatic, Manual) [Automatic]: #回车，选择 继续&lt;/p>
&lt;p>&amp;ndash;== OVIRT ENGINE CONFIGURATION ==&amp;ndash;&lt;/p>
&lt;p>Engine admin password:
Confirm engine admin password:
[WARNING] Password is weak: it is based on a dictionary word
Use weak password? (Yes, No) [No]: yes
Application mode (Virt, Gluster, Both) [Both]: #回车，选择 Both 继续&lt;/p>
&lt;p>&amp;ndash;== PKI CONFIGURATION ==&amp;ndash;&lt;/p>
&lt;p>Organization name for certificate [xenlab.com]:&lt;/p>
&lt;p>&amp;ndash;== APACHE CONFIGURATION ==&amp;ndash;&lt;/p>
&lt;p>Setup can configure the default page of the web server to present the application home page. This may conflict with existing applications.
Do you wish to set the application as the default page of the web server? (Yes, No) [Yes]:
Setup can configure apache to use SSL using a certificate issued from the internal CA.
Do you wish Setup to configure that, or prefer to perform that manually? (Automatic, Manual) [Automatic]:&lt;/p>
&lt;p>&amp;ndash;== SYSTEM CONFIGURATION ==&amp;ndash;&lt;/p>
&lt;p>Configure an NFS share on this server to be used as an ISO Domain? (Yes, No) [Yes]: no # 选择 no，本测试手工配置 NFS，不需要安装程序配置。 继续&lt;/p>
&lt;p>&amp;ndash;== MISC CONFIGURATION ==&amp;ndash;&lt;/p>
&lt;p>&amp;ndash;== END OF CONFIGURATION ==&amp;ndash;&lt;/p>
&lt;p>[ INFO ] Stage: Setup validation
[WARNING] Cannot validate host name settings, reason: resolved host does not match any of the local addresses
[WARNING] Less than 16384MB of memory is available&lt;/p>
&lt;p>&amp;ndash;== CONFIGURATION PREVIEW ==&amp;ndash;&lt;/p>
&lt;p>Application mode : both
Update Firewall : False
Host FQDN : ovirt.xenlab.com
Engine database name : engine
Engine database secured connection : False
Engine database host : localhost
Engine database user name : engine
Engine database host name validation : False
Engine database port : 5432
Engine installation : True
PKI organization : xenlab.com
Configure local Engine database : True
Set application as default page : True
Configure Apache SSL : True
Configure WebSocket Proxy : True
Engine Host FQDN : ovirt.xenlab.com&lt;/p>
&lt;p>Please confirm installation settings (OK, Cancel) [OK]: #回车，选择 OK 继续
[ INFO ] Stage: Transaction setup
[ INFO ] Stopping engine service
[ INFO ] Stopping ovirt-fence-kdump-listener service
[ INFO ] Stopping websocket-proxy service
[ INFO ] Stage: Misc configuration
[ INFO ] Stage: Package installation
[ INFO ] Stage: Misc configuration
[ INFO ] Initializing PostgreSQL
[ INFO ] Creating PostgreSQL &amp;rsquo;engine&amp;rsquo; database
[ INFO ] Configuring PostgreSQL
[ INFO ] Creating/refreshing Engine database schema
[ INFO ] Creating CA
[ INFO ] Configuring WebSocket Proxy
[ INFO ] Generating post install configuration file &amp;lsquo;/etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf&amp;rsquo;
[ INFO ] Stage: Transaction commit
[ INFO ] Stage: Closing up&lt;/p>
&lt;p>&amp;ndash;== SUMMARY ==&amp;ndash;&lt;/p>
&lt;p>[WARNING] Less than 16384MB of memory is available
SSH fingerprint: DF:FF:42:14:80:35:E2:7D:68:3A:1F:83:65:6E:89:EA
Internal CA 99:17:7A:42:D0:9D:D7:33:DE:C3:3E:07:EE:15:5D:01:28:63:4A:BF
Web access is enabled at:
&lt;a class="link" href="http://ovirt.xenlab.com:80/ovirt-engine" target="_blank" rel="noopener"
>http://ovirt.xenlab.com:80/ovirt-engine&lt;/a>
&lt;a class="link" href="https://ovirt.xenlab.com:443/ovirt-engine" target="_blank" rel="noopener"
>https://ovirt.xenlab.com:443/ovirt-engine&lt;/a>
Please use the user &amp;ldquo;admin&amp;rdquo; and password specified in order to login
In order to configure firewalld, copy the files from
/etc/ovirt-engine/firewalld to /etc/firewalld/services
and execute the following commands:
firewall-cmd -service ovirt-postgres
firewall-cmd -service ovirt-https
firewall-cmd -service ovirt-fence-kdump-listener
firewall-cmd -service ovirt-websocket-proxy
firewall-cmd -service ovirt-http
The following network ports should be opened:
tcp:443
tcp:5432
tcp:6100
tcp:80
udp:7410
An example of the required configuration for iptables can be found at:
/etc/ovirt-engine/iptables.example&lt;/p>
&lt;p>&amp;ndash;== END OF SUMMARY ==&amp;ndash;&lt;/p>
&lt;p>[ INFO ] Starting engine service
[ INFO ] Restarting httpd
[ INFO ] Stage: Clean up
Log file is located at /var/log/ovirt-engine/setup/ovirt-engine-setup-20150711225251-f9k7an.log
[ INFO ] Generating answer file &amp;lsquo;/var/lib/ovirt-engine/setup/answers/20150711225734-setup.conf&amp;rsquo;
[ INFO ] Stage: Pre-termination
[ INFO ] Stage: Termination
[ INFO ] Execution of setup completed successfully&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;p>安装成功，用浏览器，访问 ovirt 服务器 IP 地址使用 admin / 密码 登陆管理员控制台，第一次比较慢，验证安装是否完全成功。&lt;/p>
&lt;p>使用命令确认 nfs
[root@ovirt ~]# showmount -e
Export list for ovirt.xenlab.com:
/srv/ovirt/sata 192.168.10.0/24
/srv/ovirt/export 192.168.10.0/24
/srv/ovirt/iso 192.168.10.0/24&lt;/p>
&lt;p>在 ovirt 服务器中添加这三个存储，然后在命令和中确认 iso 存储已经可用。&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>[root@ovirt ~]# engine-iso-uploader list
Please provide the REST API password for the admin@internal oVirt Engine user (CTRL+D to abort):
ISO Storage Domain Name | Datacenter | ISO Domain Status
ovirt-iso | Default | active&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;p>把需要安装的光盘镜像文件，先复制到 ovirt 服务器上，然后传入 iso 存储。&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>[martin@martin-fedora iso]$ scp CentOS-7-x86_64-Minimal-1503-01.iso &lt;a class="link" href="mailto:root@192.168.10.25" >root@192.168.10.25&lt;/a>:/root/
The authenticity of host &amp;lsquo;192.168.10.25 (192.168.10.25)&amp;rsquo; can&amp;rsquo;t be established.
ECDSA key fingerprint is SHA256:KMGYLWZu14ZKaUwizIORgQ598Bpc0PKzNWF0qop2VAQ.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &amp;lsquo;192.168.10.25&amp;rsquo; (ECDSA) to the list of known hosts.
&lt;a class="link" href="mailto:root@192.168.10.25" >root@192.168.10.25&lt;/a>&amp;rsquo;s password:
CentOS-7-x86_64-Minimal-1503-01.iso 100% 636MB 90.9MB/s 00:07
[martin@martin-fedora iso]$&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;p>用这个命令上传光盘。
engine-iso-uploader upload -i ovirt-iso /root/CentOS-7-x86_64-Minimal-1503-01.iso&lt;/p>
&lt;p>之后就可以在控制台中创建虚拟机了。在 Web 界面上安装虚拟机，是需要安装客户的程序的，在 Fedora 22 笔记本中安装它们。
yum install spice-xpi virt-viewer&lt;/p>
&lt;p>点击新创建的虚拟机，启动之后，选择控制台，打开后，开始系统安装。&lt;/p>
&lt;h2 id="参考文档">参考文档
&lt;/h2>&lt;p>本文没有做截图，是由于以下参考文档都有相关截图和步骤说明；因此，在使用本文档的过程中，一定要同时打开这几篇文档。&lt;/p>
&lt;p>&lt;a class="link" href="http://www.ovirt.org/Quick_Start_Guide#Install_oVirt_Engine_.28Fedora.29%60" target="_blank" rel="noopener"
>http://www.ovirt.org/Quick&lt;em>Start_Guide#Install_oVirt_Engine&lt;/em>.28Fedora.29%60&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://jensd.be/?p=550" target="_blank" rel="noopener"
>http://jensd.be/?p=550&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://xrsa.net/2015/02/04/installing-ovirt-3-5-on-centos-7-hosted-engine/" target="_blank" rel="noopener"
>https://xrsa.net/2015/02/04/installing-ovirt-3-5-on-centos-7-hosted-engine/&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://www.server-world.info/en/note?os=Fedora_22&amp;amp;p=kvm&amp;amp;f=8" target="_blank" rel="noopener"
>http://www.server-world.info/en/note?os=Fedora_22&amp;amp;p=kvm&amp;amp;f=8&lt;/a>&lt;/p></description></item><item><title>在CentOS 7上安装部署Katello2.2</title><link>https://martinliu.cn/2015/06/07/e59ca8centos-7e4b88ae5ae89e8a385e983a8e7bdb2katello2-2/</link><pubDate>Sun, 07 Jun 2015 16:35:05 +0000</pubDate><guid>https://martinliu.cn/2015/06/07/e59ca8centos-7e4b88ae5ae89e8a385e983a8e7bdb2katello2-2/</guid><description>&lt;p>Katello 的系统架构如下图：&lt;/p>
&lt;p>&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2015/06/katello-arch-diagram.png"
loading="lazy"
alt="katello-arch-diagram"
>&lt;/p>
&lt;p>Katell 系统是一个复合型开源项目，是 Pulp, Candlepin 和 Foreman 的组合。Foreman 默认使用 Puppet 作配置管理。&lt;/p>
&lt;p>它的安装文档见官方手册：&lt;a class="link" href="http://www.katello.org/docs/2.2/installation/index.html" target="_blank" rel="noopener"
>http://www.katello.org/docs/2.2/installation/index.html&lt;/a>&lt;/p>
&lt;p>为了简化安装，请下在本站提供的 CentOS7 完美安装模板。使用它来创建一个虚拟机，6GB 内存，2VCPU；网络上为了方便，请在 virt-manger 中新建如下所示的网络。&lt;/p>
&lt;p>&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2015/06/QEMU-KVM-Connection-Details_006.png"
loading="lazy"
alt="QEMU-KVM Connection Details_006"
>&lt;/p>
&lt;p>虚拟机启动之后，确保 host 能正常联网。启动刚才创建的虚拟机，配置好 IP，ping 外网网站，确保它能正常联网即可。其它安装命令如下：&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>yum -y localinstall &lt;a class="link" href="http://fedorapeople.org/groups/katello/releases/yum/2.2/katello/RHEL/7Server/x86_64/katello-repos-latest.rpm" target="_blank" rel="noopener"
>http://fedorapeople.org/groups/katello/releases/yum/2.2/katello/RHEL/7Server/x86_64/katello-repos-latest.rpm&lt;/a>
yum -y localinstall &lt;a class="link" href="http://yum.theforeman.org/releases/1.8/el7/x86_64/foreman-release.rpm" target="_blank" rel="noopener"
>http://yum.theforeman.org/releases/1.8/el7/x86_64/foreman-release.rpm&lt;/a>
yum -y localinstall &lt;a class="link" href="http://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm" target="_blank" rel="noopener"
>http://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm&lt;/a>
yum -y localinstall &lt;a class="link" href="http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm" target="_blank" rel="noopener"
>http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm&lt;/a>
yum -y install foreman-release-scl&lt;/p>
&lt;p>yum -y install katello&lt;/p>
&lt;p>katello-installer -v &lt;br>
&amp;ndash;foreman-admin-username admin &lt;br>
&amp;ndash;foreman-admin-password smartvm &lt;br>
&amp;ndash;capsule-dns true &lt;br>
&amp;ndash;capsule-dns-interface eth0 &lt;br>
&amp;ndash;capsule-dns-zone xenlab.com &lt;br>
&amp;ndash;capsule-dns-forwarders 192.168.10.1 &lt;br>
&amp;ndash;capsule-dns-reverse 10.168.192.in-addr.arpa &lt;br>
&amp;ndash;capsule-dhcp true &lt;br>
&amp;ndash;capsule-dhcp-interface eth0 &lt;br>
&amp;ndash;capsule-dhcp-range &amp;ldquo;192.168.10.100 192.168.10.240&amp;rdquo; &lt;br>
&amp;ndash;capsule-dhcp-gateway 192.168.10.1 &lt;br>
&amp;ndash;capsule-dhcp-nameservers 192.168.10.10 &lt;br>
&amp;ndash;capsule-tftp true &lt;br>
&amp;ndash;capsule-tftp-servername $(hostname) &lt;br>
&amp;ndash;capsule-puppet true &lt;br>
&amp;ndash;capsule-puppetca true&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;p>以上的安装命令如果成功，katello 服务器将具有一下功能：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Foreman 服务器：用于自动化网络安装 linux 系统&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Puppet Master 服务器&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Repos 管理服务器&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DNS，DHCP，PXE 服务器&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>安装成功之后，使用默认的用户名和密码就可以登陆了。&lt;/p></description></item><item><title>安装完美 CentOS7 虚拟机模板</title><link>https://martinliu.cn/2015/06/05/e5ae89e8a385e5ae8ce7be8e-centos7-e8999ae68b9fe69cbae6a8a1e69dbf/</link><pubDate>Fri, 05 Jun 2015 15:44:52 +0000</pubDate><guid>https://martinliu.cn/2015/06/05/e5ae89e8a385e5ae8ce7be8e-centos7-e8999ae68b9fe69cbae6a8a1e69dbf/</guid><description>&lt;h2 id="初始化安装">初始化安装
&lt;/h2>&lt;p>下载最新版 CentOS7 DVD 选择 mini 安装。&lt;/p>
&lt;h2 id="网络配置">网络配置
&lt;/h2>&lt;p>安装过程中设置了静态网络地址，如下：&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>[root@centos7-tmp ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0
TYPE=Ethernet
BOOTPROTO=none
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=no
NAME=eth0
DEVICE=eth0
ONBOOT=yes
DNS1=192.168.10.1
DOMAIN=xenlab.com
IPADDR=192.168.10.8
PREFIX=24
GATEWAY=192.168.10.1
UUID=5fb06bd0-0bb0-7ffb-45f1-d6edd65f3e03&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;h2 id="软件包">软件包
&lt;/h2>&lt;p>Change log:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>yum install wget &lt;a class="link" href="http://itgeeker.net/tag/telnet/" target="_blank" rel="noopener"
>telnet&lt;/a> perl perl-devel net-tools kernel-devel&lt;/p>
&lt;/li>
&lt;li>
&lt;p>yum install vim-enhanced.x86_64&lt;/p>
&lt;/li>
&lt;li>
&lt;p>yum -y install git&lt;/p>
&lt;/li>
&lt;li>
&lt;p>yum install acpid&lt;/p>
&lt;/li>
&lt;li>
&lt;p>yum install tree&lt;/p>
&lt;/li>
&lt;li>
&lt;p>yum install ntp&lt;/p>
&lt;/li>
&lt;li>
&lt;p>yum install unzip&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="repo-软件更新源">Repo 软件更新源
&lt;/h2>&lt;p>Change log:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>初始化安装，添加了个几个国内的源&lt;/p>
&lt;/li>
&lt;li>&lt;/li>
&lt;/ol>
&lt;p>rpm -Uvh &lt;a class="link" href="http://rpms.famillecollet.com/enterprise/remi-release-7.rpm" target="_blank" rel="noopener"
>http://rpms.famillecollet.com/enterprise/remi-release-7.rpm&lt;/a>&lt;/p>
&lt;ol start="3">
&lt;li>
&lt;p>/etc/yum.repo/bk/dvd.repo ；这个是在用 KVM 虚拟机挂 ISO 文件光驱的时候用的，到时候 mount /dev/cdrom /media/dvd , 把该文件方的夫目录中即可使用 iso 文件中的 repos&lt;/p>
&lt;/li>
&lt;li>&lt;/li>
&lt;/ol>
&lt;p>当前的软件源如下：&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>[root@centos7-tmp ~]# yum repolist
Loaded plugins: fastestmirror
Repository base is listed more than once in the configuration
Repository updates is listed more than once in the configuration
Repository extras is listed more than once in the configuration
Repository centosplus is listed more than once in the configuration
Loading mirror speeds from cached hostfile&lt;/p>
&lt;ul>
&lt;li>base: mirrors.163.com&lt;/li>
&lt;li>epel: mirrors.neusoft.edu.cn&lt;/li>
&lt;li>extras: mirrors.btte.net&lt;/li>
&lt;li>remi-safe: remi.kazukioishi.net&lt;/li>
&lt;li>updates: mirrors.btte.net
repo id                                 repo name                                                                          status
base/7/x86_64                           CentOS-7 - Base                                                                    8,652
epel/x86_64                             Extra Packages for Enterprise Linux 7 - x86_64                                     8,022
extras/7/x86_64                         CentOS-7 - Extras                                                                    128
remi-safe                               Safe Remi&amp;rsquo;s RPM repository for Enterprise Linux 7 - x86_64                           123
updates/7/x86_64                        CentOS-7 - Updates                                                                   609
repolist: 17,534
[root@centos7-tmp ~]#&lt;/li>
&lt;/ul>
&lt;p>[/bash]&lt;/p>
&lt;h2 id="系统服务配置">系统服务配置
&lt;/h2>&lt;p>Change log:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>关闭 SELinux&lt;/p>
&lt;/li>
&lt;li>
&lt;p>关闭 NetworkManager&lt;/p>
&lt;/li>
&lt;li>
&lt;p>关闭 FirewallD&lt;/p>
&lt;/li>
&lt;li>
&lt;p>systemctl enable acpid.service&lt;/p>
&lt;/li>
&lt;li>
&lt;p>开启 truned-adm virtual-guest 服务模式&lt;/p>
&lt;/li>
&lt;li>
&lt;p>systemctl enable ntpd&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>[bash]&lt;/p>
&lt;p>[root@centos7-tmp tuned]# tuned-adm  list
Cannot talk to Tuned daemon via DBus.
Available profiles:&lt;/p>
&lt;ul>
&lt;li>balanced&lt;/li>
&lt;li>blog&lt;/li>
&lt;li>latency-performance&lt;/li>
&lt;li>network-latency&lt;/li>
&lt;li>network-throughput&lt;/li>
&lt;li>powersave&lt;/li>
&lt;li>throughput-performance&lt;/li>
&lt;li>virtual-guest&lt;/li>
&lt;li>virtual-host
Cannot talk to Tuned daemon via DBus.
It seems that tuned daemon is not running, preset profile is not activated.
Preset profile: virtual-guest&lt;/li>
&lt;/ul>
&lt;p>[/bash]&lt;/p>
&lt;h2 id="模板文件封装">模板文件封装
&lt;/h2>&lt;p>用 sys-unconfig 关机。用 virt-sysprep,  virt-sparsify 去除不必要信息，压缩。&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>[root@martin-fedora vm]# ll -h
total 12G
-rw-r&amp;ndash;r&amp;ndash;  1 qemu qemu  81G Jun  5 22:36 centos7-tmp.qcow2
-rw-r&amp;ndash;r&amp;ndash;  1 root root  81G Jun  5 22:34 centos7-tmp.qcow2.bk
-rw-r&amp;ndash;r&amp;ndash;  1 root root 2.9G Jun  5 07:56 rhel66-clone-1.qcow2
-rw-r&amp;ndash;r&amp;ndash;  1 root root 1.6G Jun  3 15:01 rhel66-clone.qcow2
-rw-r&amp;ndash;r&amp;ndash;  1 root root  81G Jun  3 13:03 rhel66.qcow2
-rw-r&amp;ndash;r&amp;ndash;. 1 root root  81G Jun  1 00:59 rhel71.qcow2
[root@martin-fedora vm]# export TMPDIR=/home/martin
[root@martin-fedora vm]# virt-sparsify &amp;ndash;compress centos7-tmp.qcow2 centos7-tmp-v1.qcow2
Input disk virtual size = 85899345920 bytes (80.0G)
Create overlay file in /home/martin to protect source disk &amp;hellip;
Examine source disk &amp;hellip;
Fill free space in /dev/centos/root with zero &amp;hellip;
100% ⟦▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒⟧ 00:00
Clearing Linux swap on /dev/centos/swap &amp;hellip;
100% ⟦▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒⟧ 00:00
Fill free space in /dev/sda1 with zero &amp;hellip;
Fill free space in volgroup centos with zero &amp;hellip;
Copy to destination and make sparse &amp;hellip;&lt;/p>
&lt;p>Sparsify operation completed with no errors.  Before deleting the old disk,
carefully check that the target disk boots and works correctly.
[root@martin-fedora vm]# ll -h
total 12G
-rw-r&amp;ndash;r&amp;ndash;  1 qemu qemu  81G Jun  5 22:36 centos7-tmp.qcow2
-rw-r&amp;ndash;r&amp;ndash;  1 root root  81G Jun  5 22:34 centos7-tmp.qcow2.bk
-rw-r&amp;ndash;r&amp;ndash;  1 root root 520M Jun  5 23:11 centos7-tmp-v1.qcow2
-rw-r&amp;ndash;r&amp;ndash;  1 root root 2.9G Jun  5 07:56 rhel66-clone-1.qcow2
-rw-r&amp;ndash;r&amp;ndash;  1 root root 1.6G Jun  3 15:01 rhel66-clone.qcow2
-rw-r&amp;ndash;r&amp;ndash;  1 root root  81G Jun  3 13:03 rhel66.qcow2
-rw-r&amp;ndash;r&amp;ndash;. 1 root root  81G Jun  1 00:59 rhel71.qcow2&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;h2 id="yum-update--y">yum update -y
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>2015-07-10 : Done yum updated. 删除了不需要的 Kernel，安装了 unzip, 修改启动过程为直接文字启动。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>2015-11.15: update kernel to 7.1, set old kernel 1: package-cleanup &amp;ndash;oldkernels &amp;ndash;count=1&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="使用方法">使用方法
&lt;/h2>&lt;p>root 密码 martinliu.cn 开机后记得一定要先修改。&lt;/p>
&lt;p>百度网盘下载地址 [su_button url=&amp;ldquo;http://pan.baidu.com/s/1pJurap9&amp;rdquo; target=&amp;ldquo;blank&amp;rdquo; style=&amp;ldquo;stroked&amp;rdquo; size=&amp;ldquo;6&amp;rdquo; icon=&amp;ldquo;icon: codepen&amp;rdquo;]centos7-tmp-v7[/su_button]&lt;/p></description></item><item><title>如何参与 Project Atomic</title><link>https://martinliu.cn/2015/03/19/e5a682e4bd95e58f82e4b88e-project-atomic/</link><pubDate>Thu, 19 Mar 2015 03:23:37 +0000</pubDate><guid>https://martinliu.cn/2015/03/19/e5a682e4bd95e58f82e4b88e-project-atomic/</guid><description>&lt;h2 id="关于-project-atomic-项目">关于 Project Atomic 项目
&lt;/h2>&lt;p>&lt;a class="link" href="http://www.projectatomic.io/" target="_blank" rel="noopener"
>&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2015/03/secure-containers.png"
loading="lazy"
alt="secure-containers"
>&lt;/a>&lt;/p>
&lt;p>Project Atomic 项目相关的开源技术组件如下：&lt;/p>
&lt;p>[wm_list bullet=&amp;ldquo;icon-linux&amp;rdquo; class=&amp;quot;&amp;quot;]&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="http://kernel.org/" target="_blank" rel="noopener"
>linux kernel&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://www.freedesktop.org/wiki/Software/systemd/" target="_blank" rel="noopener"
>systemd&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://wiki.gnome.org/Projects/OSTree" target="_blank" rel="noopener"
>OSTree&lt;/a> and &lt;a class="link" href="http://rpm-ostree.cloud.fedoraproject.org/" target="_blank" rel="noopener"
>rpm-ostree&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.docker.io/" target="_blank" rel="noopener"
>Docker&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/GoogleCloudPlatform/kubernetes" target="_blank" rel="noopener"
>kubernetes&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://rpm-ostree.cloud.fedoraproject.org/" target="_blank" rel="noopener"
>Fedora&lt;/a> and &lt;a class="link" href="http://wiki.centos.org/Cloud" target="_blank" rel="noopener"
>CentOS&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>[/wm_list]&lt;/p>
&lt;p>该项目的网站在： &lt;a class="link" href="http://www.projectatomic.io/" target="_blank" rel="noopener"
>http://www.projectatomic.io/&lt;/a>&lt;/p>
&lt;h2 id="加入-project-atomic-邮件列表">加入 Project Atomic   邮件列表
&lt;/h2>&lt;p>项目一般性讨论： &lt;a class="link" href="https://lists.projectatomic.io/mailman/listinfo/atomic" target="_blank" rel="noopener"
>https://lists.projectatomic.io/mailman/listinfo/atomic&lt;/a>&lt;/p>
&lt;p>项目开发者：&lt;a class="link" href="https://lists.projectatomic.io/mailman/listinfo/atomic-devel" target="_blank" rel="noopener"
>https://lists.projectatomic.io/mailman/listinfo/atomic-devel&lt;/a>&lt;/p>
&lt;p>项目版本发布更新：https://lists.projectatomic.io/mailman/listinfo/atomic-announce&lt;/p>
&lt;p>填写自己的邮箱后，别忘了在邮箱里收信，并且确认。如下图所示：&lt;/p>
&lt;p>&lt;a class="link" href="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2015/03/atomic-dev-mail-list.jpg" target="_blank" rel="noopener"
>&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2015/03/atomic-dev-mail-list.jpg"
loading="lazy"
alt="atomic-dev-mail-list"
>&lt;/a>&lt;/p>
&lt;h2 id="问-project-atomic-问题和讨论">问   Project Atomic 问题和讨论
&lt;/h2>&lt;p>&lt;a class="link" href="http://ask.projectatomic.io/en/questions/" target="_blank" rel="noopener"
>http://ask.projectatomic.io/en/questions/  这里是&lt;/a>项目的论坛可以在这里提问和帮助其他人。&lt;/p>
&lt;h2 id="了解-project-atomic-代码">了解  Project Atomic 代码
&lt;/h2>&lt;p>&lt;a class="link" href="https://github.com/projectatomic/" target="_blank" rel="noopener"
>https://github.com/projectatomic/&lt;/a> 项目的代码在 Github 网站上可以看到，如果你 watch 这个项目的话，可以收到所有开发者对该项目的所有代码更新等活动。&lt;/p></description></item><item><title>既要开源，也要环保</title><link>https://martinliu.cn/2011/03/24/usb-linux/</link><pubDate>Thu, 24 Mar 2011 13:12:58 +0000</pubDate><guid>https://martinliu.cn/2011/03/24/usb-linux/</guid><description>&lt;p>今天看到了我保存的一摞 Linux 光盘，这基本上也记录了我所关注和安装过的所有 Linux 的种类。品种繁多。如下：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>CentOS 4.4&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Ubuntu 8.4 server&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Ubuntu 8.4 desktop&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Opensolaris&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Debian 4.0&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SuSe Enterprise 10.1&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Redhat Enterprise Server 3&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SuSe Linux 10&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Mandriva 2008&lt;/p>
&lt;/li>
&lt;li>
&lt;p>CentOS 4.2&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SuSe 10.0 Eval DVD&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Mandrake 10.0&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Redhat 7.1&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Derbain 3.0&lt;/p>
&lt;/li>
&lt;li>
&lt;p>FreeBSD 5.2&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Suse 9&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SuSe enterprise linux 9.0&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Fedora 4&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Redhat 9&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Solaris 10 x86&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Ubuntu 10.10 Desktop&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SLES 10 sp2&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>![CD fire](&lt;a class="link" href="http://martinliu.cn/wp-content/gallery/fatureimage/thumbs/thumbs_Crstal" target="_blank" rel="noopener"
>http://martinliu.cn/wp-content/gallery/fatureimage/thumbs/thumbs_Crstal&lt;/a> (12).png)总共 50 多张碟片既有 CD 也有 DVD。Linux 这东西最大的特点是更新发展的快，之前硬盘都小，为了安装 Linux 刻盘是最方便的方式，而且多年以前机器还不支持 USB 启动。这么多光盘真的是一大堆的白色垃圾，一直在想废弃光盘该怎么处理的为题，目前好像还没有即能实现废物利用，有环保的处理方法。上周为了在家里的 PC 上安装 Ubuntu 10.10 Desktop，又刻了一张盘，希望这是最后一张 Linux CD，以后考虑 USB 启动安装 Linux 的形式。使用工具软件把 Linux ISO 文件灌注到 U 盘里，在用 U 盘来装。&lt;/p>
&lt;p>推荐两种工具：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="http://www.pendrivelinux.com/universal-usb-installer-easy-as-1-2-3/" target="_blank" rel="noopener"
>Universal USB Installer&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://www.linuxliveusb.com/en/home" target="_blank" rel="noopener"
>LinuxLive USB Creator&lt;/a>&lt;/li>
&lt;/ul>
&lt;!-- raw HTML omitted -->
&lt;p>[](&lt;a class="link" href="http://martinliu.cn/wp-content/gallery/fatureimage/Crstal" target="_blank" rel="noopener"
>http://martinliu.cn/wp-content/gallery/fatureimage/Crstal&lt;/a> (12).png)&lt;/p></description></item></channel></rss>