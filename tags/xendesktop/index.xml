<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Xendesktop on Martin Liu's Blog</title><link>https://martinliu.cn/tags/xendesktop/</link><description>Recent content in Xendesktop on Martin Liu's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sun, 09 Oct 2022 21:44:15 +0800</lastBuildDate><atom:link href="https://martinliu.cn/tags/xendesktop/index.xml" rel="self" type="application/rss+xml"/><item><title>XenDesktop + nVIDIA K1/K2 = BEST 3D VDI</title><link>https://martinliu.cn/2013/08/16/xendesktop-nvidia-k1-k2-best-3d-vdi/</link><pubDate>Fri, 16 Aug 2013 11:52:58 +0000</pubDate><guid>https://martinliu.cn/2013/08/16/xendesktop-nvidia-k1-k2-best-3d-vdi/</guid><description>&lt;p>今天公司到货了 K1，K2 的 GPU 卡，这让我不得不学习一下这个产品。&lt;/p>
&lt;p>&lt;a class="link" href="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2013/08/grid-overview-header.jpg" target="_blank" rel="noopener"
>&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2013/08/grid-overview-header.jpg"
loading="lazy"
alt="grid-overview-header"
>&lt;/a>&lt;/p>
&lt;p>到货实物如下：&lt;/p>
&lt;p>[gallery link=&amp;ldquo;file&amp;rdquo; ids=&amp;ldquo;52542,52543,52544,52545,52546,52547&amp;rdquo;]&lt;/p>
&lt;p>此卡的简单技术指标如下。&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="grid-k1">GRID K1
&lt;/h2>&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h2 id="grid-k2">GRID K2
&lt;/h2>&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>&lt;a class="link" href="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2013/08/NVIDIA_vGPU_News.jpg" target="_blank" rel="noopener"
>&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2013/08/NVIDIA_vGPU_News.jpg"
loading="lazy"
alt="NVIDIA_vGPU_News"
>&lt;/a>&lt;/p>
&lt;p>详细 K1 K2 技术参数指标，&lt;a class="link" href="http://www.nvidia.com/content/cloud-computing/pdf/nvidia-grid-datasheet-k1-k2.pdf" target="_blank" rel="noopener"
> 下载 ； &lt;/a> 这个表格清晰的说明了这两种卡的硬件技术参数。重要的是看它软件合作伙伴这一块。硬件在好，没有支持的软件也不行，我们必须还有看看它的软件合作伙伴：&lt;a class="link" href="http://www.nvidia.com/object/grid-software-partners.html" target="_blank" rel="noopener"
>http://www.nvidia.com/object/grid-software-partners.html&lt;/a>&lt;/p>
&lt;p>首先，是认证的虚拟应用合作伙伴，这里只有 Citrix XenApp；只有 Citrix 可以做 3D 设计软件的应用虚拟化；其它无人能及，基于 Citrix 的应用虚拟化可以真正的把一块 GPU 的共享程度达到最大，能够更加节约支撑的硬件资源。节省每一度电。还要看支持的 API 的版本号，这个说明了对 3D 软件的兼容性，如果这个版本号类型少，支持的低，那么这种方案是不可用的；由于 3D 软件根本就跑不动。&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>总之，Citrix + nVIDIA K1 k2 + XenServer （GPU 直通） + HDX 3D Pro = 业内最好的 3D 虚拟桌面平台方案；而且这个方案里还能具有，其它全部的使用场景，包括：vdi，共享桌面，虚拟应用，流桌面，远程物理桌面等等方式。可以说这是一举多得，面面俱到的解决方案。&lt;/p></description></item><item><title>XenDesktop 7 HDX 3D Pro</title><link>https://martinliu.cn/2013/08/14/xendesktop-7-hdx-3d-pro/</link><pubDate>Wed, 14 Aug 2013 15:38:07 +0000</pubDate><guid>https://martinliu.cn/2013/08/14/xendesktop-7-hdx-3d-pro/</guid><description>&lt;p>&lt;a class="link" href="http://brightcove.vo.llnwd.net/pd16/media/1485836774/1485836774_2603380124001_3DCar4CitrixTV.mp4" target="_blank" rel="noopener"
>http://brightcove.vo.llnwd.net/pd16/media/1485836774/1485836774_2603380124001_3DCar4CitrixTV.mp4&lt;/a>&lt;/p>
&lt;p>Description&lt;/p>
&lt;p>Windows 7 HDX3D Windows Server 2008R2 3D Network Constrained Environment (Simulating 3G speeds) No network constraints Windows Client iPad Client NVidia Demo software utilized is available on NVidia.com Solarwinds Software used for monitoring network traffic&lt;/p>
&lt;p>看点:&lt;/p>
&lt;ul>
&lt;li>桌面虚拟化中的高精尖场景，成本高、技术高、效果精益求精&lt;/li>
&lt;li>Citrix XenDesktop + nVidia = 业内最好 3D 设计虚拟桌面平台&lt;/li>
&lt;li>Citrix 可以兼顾 VDI+独占 GPU 和 共享桌面+共享 GPU 两种模式&lt;/li>
&lt;/ul>
&lt;p>来源：&lt;a class="link" href="http://www.citrix.com/tv/#videos/9008" target="_blank" rel="noopener"
>http://www.citrix.com/tv/#videos/9008&lt;/a>&lt;/p></description></item><item><title>XenDesktop 7 抢鲜测试</title><link>https://martinliu.cn/2013/07/08/xendesktop-7-e68aa2e9b29ce6b58be8af95/</link><pubDate>Mon, 08 Jul 2013 03:45:59 +0000</pubDate><guid>https://martinliu.cn/2013/07/08/xendesktop-7-e68aa2e9b29ce6b58be8af95/</guid><description>&lt;p>[gallery link=&amp;ldquo;file&amp;rdquo; ids=&amp;ldquo;52454,52455,52456&amp;rdquo;]&lt;/p>
&lt;p>XenDesktop 7 问世以来，目前处于市场初级推广阶段；虽然还没有大范围的推广，如果业内的合作伙伴们如果还没有尝试过，那么你们就 Out 了。为了更好的指导大家的测试工作，这里介绍两篇文档：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="http://wiki.citrix-book.org/xendesktop/%E6%B5%8B%E8%AF%95/xendesktop7%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85%E6%89%8B%E5%86%8C" target="_blank" rel="noopener"
>XenDesktop7 快速安装手册&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://wiki.citrix-book.org/xendesktop/%E6%B5%8B%E8%AF%95/xendesktop7%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE%E6%89%8B%E5%86%8C" target="_blank" rel="noopener"
>XenDesktop7 安装和配置手册 from yandong&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>另外隆重推荐的是这个开放维基百科网站“&lt;a class="link" href="http://wiki.citrix-book.org/" target="_blank" rel="noopener"
>Citrix-book.org Citrix 最佳实践&lt;/a>”；退出这个网站的原因是我看到，目前网络资源过于纷乱，大多数技术大拿们都有自己的 bolg 和微博；但是干活资源过于分散；这个网站本着开放自由的出发点，鼓励和欢迎所有的大难能到这里集中和上传你的干活技术资料。投稿方式为自由注册，自行在线新建和编辑文档；也可以根据网站指引投稿。&lt;/p></description></item><item><title>XenDesktop虚拟桌面精品书籍导读(中文版)</title><link>https://martinliu.cn/2013/05/14/xendesktope8999ae68b9fe6a18ce99da2e7b2bee59381e4b9a6e7b18de5afbce8afbbe4b8ade69687e78988/</link><pubDate>Tue, 14 May 2013 05:59:11 +0000</pubDate><guid>https://martinliu.cn/2013/05/14/xendesktope8999ae68b9fe6a18ce99da2e7b2bee59381e4b9a6e7b18de5afbce8afbbe4b8ade69687e78988/</guid><description>&lt;p>[box color=&amp;ldquo;orange&amp;rdquo; icon=&amp;ldquo;flag&amp;rdquo;]
感谢 Eric Yao 的供稿，&lt;a class="link" href="http://weibo.com/ericyaozhen" target="_blank" rel="noopener"
>@老树皮 Eric&lt;/a>
[/box]&lt;/p>
&lt;p>英文版：&lt;a class="link" href="http://support.citrix.com/article/CTX136546" target="_blank" rel="noopener"
>《Citrix Virtual Desktop Handbook》&lt;/a>&lt;/p>
&lt;p>中文版：[download id=&amp;ldquo;20&amp;rdquo;]&lt;/p>
&lt;p>本书是 XD 虚拟桌面实施工程师的必备读物，请相关人员仔细阅读。&lt;/p></description></item><item><title>XenDesktop虚拟桌面精品书籍导读(part5)</title><link>https://martinliu.cn/2013/05/07/xendesktope8999ae68b9fe6a18ce99da2e7b2bee59381e4b9a6e7b18de5afbce8afbbpart5/</link><pubDate>Tue, 07 May 2013 02:36:41 +0000</pubDate><guid>https://martinliu.cn/2013/05/07/xendesktope8999ae68b9fe6a18ce99da2e7b2bee59381e4b9a6e7b18de5afbce8afbbpart5/</guid><description>&lt;p>[box color=&amp;ldquo;orange&amp;rdquo; icon=&amp;ldquo;flag&amp;rdquo;]
感谢 Eric Yao 的供稿，&lt;a class="link" href="http://weibo.com/ericyaozhen" target="_blank" rel="noopener"
>@老树皮 Eric&lt;/a>
[/box]&lt;/p>
&lt;p>今天是&lt;a class="link" href="http://support.citrix.com/article/CTX136546" target="_blank" rel="noopener"
>《Citrix Virtual Desktop Handbook》&lt;/a>第二讲的最后一期，专门论述一下 PVS 的设计。在本期之后我会把所有以往的内容整合在一个完整的白皮书中，稍等几日。。。&lt;/p>
&lt;p>请期待基于本系列 5 篇文章的完整版中文白皮书下载。&lt;/p>
&lt;p>Citrix 桌面虚拟化实施部署白皮书 第二讲之第五期：PVS 的设计&lt;/p>
&lt;ol>
&lt;li>Provisioning Services&lt;/li>
&lt;/ol>
&lt;p>Citrix Provisioning Services（PVS）使用流化的技术简化了虚拟桌面和物理桌面的部署。计算机从一个单个的共享磁盘镜像上被实时制备（Provisioned），管理员完全不需要去管理或者是给每个单独的用户操作系统打补丁。&lt;/p>
&lt;p>&lt;strong>1)        **&lt;strong>决断：*&lt;/strong>*Farm**&lt;/strong>（场）的数量******&lt;/p>
&lt;p>一个 Provisioning Services 的场代表着 Provisioning Services 基础架构的最高层级。所有在一个场的 Provisioning Servers（服务器）都共享同一个 SQL 数据库哦 Citrix License 服务器。当确定需要多少个 Provisioning Services 的场时，我们一般需要考虑以下几个因素：&lt;/p>
&lt;p>l  **网络：**Provisioning Servers 会始终和场数据库通信以获取系统配置信息。因此，一般来说每个 target devices 聚集的地理位置应该部署一个独立的场，当然，如果异地之间的网速足够快，理论上也可以只建立一个 Provisioning Services 场。&lt;/p>
&lt;p>l  **重要程度：**管理者应该决定它可以容仍什么样的风险。尽管可能性非常的低，但是 Provisioning Services 场如果出问题还是会影响整个组织架构的使用。如果一个公司需要非常高等级的可用性，那么多个场的搭建就可以避免这个问题。&lt;/p>
&lt;p>l  **可管理性：**管理者可能需要在基于组织架构划分的基础上，例如国家、地区，又或者是不同部门之间，来进行单独的系统管理。尽管听起来这会增加管理的复杂程度，但是实际上只会增加有限多的配置、桌面创建过程，以及操作系统镜像更新。&lt;/p>
&lt;p>&lt;strong>2)        **&lt;strong>决断：站点（*&lt;/strong>*Sites**&lt;/strong>）的数量******&lt;/p>
&lt;p>每个 Provisioning Services 的场都包含一个或者多个的站点。一个 Provisioning Services 的站点是一个逻辑的实体组成部分，包含了 Provisioning Servers（服务器）、vDisk pools，以及 target devices 的集合。多个站点共享同一个数据库。Target devices 可以在同一个站点中容错到其他的 Provisioning Servers 上。在以下的情况下我们建议创建多个站点：&lt;/p>
&lt;p>l  **网络：**站点用来控制 Provisioning Services 的流数据量。例如，一个站点可以根据站点、rack、或者是刀箱来创建，以确保流数据始终保持在本地而不变成一个网络瓶颈。&lt;/p>
&lt;p>l  **组织架构：**另外一个需要创建多个站点的实际理由是企业组织架构的改变。例如，两个公司通过收购合并了，但是有需要在企业整合过程中保持资源的独立。&lt;/p>
&lt;p>3)         &lt;strong>决断：数据库的配置&lt;/strong>&lt;/p>
&lt;p>Provisioning Services 的数据库存储有所有一个场内的的系统配置信息。Provisioning Services 6.X 版本支持一下版本的 SQL 数据库，包括 Express、标准版、企业版的 SQL Server 2005、2008R2 以及 2012 版。选择哪一个 SQL 版本其实是取决于你需要哪一个级别的容错水平。以下的表格是一个 SQL 2008R2 版本的示例：&lt;/p>
&lt;p>Provisioning Services 场的数据库的大小很少会超过 250M 容量，即使在大型环境下也不会。所以，在测试环境下 Express 版本是最佳选择，因为不需要容错功能。&lt;/p>
&lt;p>下面的公式是用来计算 Provisioning Services 的数据库的容量大小：&lt;/p>
&lt;p>4)         &lt;strong>决断：数据库；离线模式&lt;/strong>&lt;/p>
&lt;p>如果到 Provisioning Services 场的数据库的连接断开，已经连接到 Provisioning Servers 的 target devices 仍然可以正常工作，但是新的 target devices 将会无法启动。&lt;/p>
&lt;p>支持离线数据库功能可以让 Provisioning Services 在失去连接到数据库后仍然可以保持正常操作。在服务器启动时会对数据库做个快照，然后定期保持同步。如果连接丢失，Stream Services 会使用最新的一个快照以获取场的配置信息。一旦数据库连接建立起来了，Stream 过程会把断线期间的变化同步到数据库中。&lt;/p>
&lt;p>&lt;em>需要注意的是，离线数据库功能默认下是关闭状态的，而且也仅仅是在生产环境下的稳定的场环境下推荐使用。评估环境下不推荐使用&lt;/em>&lt;/p>
&lt;p>5)         &lt;strong>决断：服务帐号&lt;/strong>&lt;/p>
&lt;p>Stream 和 SOAP 服务会和其他许多不同的 Provisioning Services 基础架构中的组件进行通信，如下图所示：&lt;/p>
&lt;p>6)         &lt;strong>决断：设备集合&lt;/strong>&lt;/p>
&lt;p>设备集合是用来创建和管理 target devices 逻辑组。创建设备集合可以简化设备管理，因为将来的操作可以不用基于 target device 级别，而是基于集合这个级别。&lt;/p>
&lt;p>设备集合可以基于物理地理位置、子网范围、组织架构中不同的部门来设计。也可以考虑基于 vDisk 的分配来创建不同的设备集合，这样所有分配到一个特定 vDisk 的所有的 target devices 就能被快速的定位。&lt;/p>
&lt;p>7)         &lt;strong>决断：**&lt;strong>Provisioning Server*&lt;/strong>*（服务器）的内存&lt;/strong>&lt;/p>
&lt;p>运行 Provisioning Services 的 Windows 操作系统会把 vDisk 的部分内容缓存在内存（系统缓存）中以降低从存储中读取的操作。从存储中读取数据的速度是显著低于从内存中读取数据的，所以，正确计算 Provisioning Servers 的内存是非常关键的。请参见以下的公式：&lt;/p>
&lt;p>简单地说，就是给每个 vDisk 分配 2G 左右的内存。&lt;/p>
&lt;p>8)         **决断：**&lt;strong>Scale Up*&lt;/strong>*还是****Scale Out**&lt;/p>
&lt;p>&lt;em>题外话：首先对这两个词进行一下解释：&lt;/em>&lt;/p>
&lt;p>&lt;em>Scale Out(&lt;strong>向外扩展)&lt;/strong>：就是指企业可以根据需求增加不同的服务器应用，依靠多部服务器协同运算，借负载平衡及容错等功能来提高运算能力及可靠度。&lt;/em>&lt;/p>
&lt;p>&lt;em>Scale Up(&lt;strong>向上扩展)&lt;/strong>：指企业后端大型服务器以增加处理器等运算资源进行升级以获得对应用性能的要求。&lt;/em>&lt;/p>
&lt;p>随着 Farm 场的增长，管理员需要作出决定以判断是不是需要给 Provisioning Server 增加更高的资源，也可以是在场中增加更加多的 Provisioning Servers，一下了可以是考虑因素：&lt;/p>
&lt;p>l  **冗余：**将用户符合扩展到其他负荷不重的服务器上会有助于降低当 Provisioning Servers 宕机情况下爱所影响的用户数量。如果公司无法接受单点高性能服务器宕机所造成的损失，那就考虑 Scaling Out，就是我们说的向外扩展（既增加多台服务器）。&lt;/p>
&lt;p>l  **容错时间：**在一个单台的 Provisioning Server 上所连接的 Target Devices 越多，在服务器宕机后所需要的恢复时间也就越多。Citrix 的内部测试显示在 Provisioning Services 5.6 SP2 版本下，1500 台 Target Devices 需要大约 8 分钟恢复生产能力；&lt;/p>
&lt;p>l  **数据中心容量：**数据中心一般都是只有有限的空间、电源、冷却能力，此时，可以考虑 Scaling Up，即向上扩展（增加单台服务器的处理能力）。&lt;/p>
&lt;p>l  **硬件成本：**刚开始时，可能 Scale Up 会有更高的性价比，但是继续往后可能 Scale Out 会开始更具性价比，应该做一个成本分析；&lt;/p>
&lt;p>9)         &lt;strong>决断：**&lt;strong>vDisk*&lt;/strong>*的存储位置&lt;/strong>&lt;/p>
&lt;p>一个场可以包含一个或者多个的 vDisk 存储。一般来说有两个主要的选择：&lt;/p>
&lt;p>l  &lt;strong>本地存储或者是 DAS**&lt;/strong>：**DAS 可以是本地的，或者是基于 Block 的存储类型，Provisioning Server 可以直接访问，例如 SATA、SCSI、iSCSI，以及光纤。本地的 vDisk 就只能被本地的 Provisioning Server 所反问，因此，vDisk 应当被手动或者自动的复制到其他的 vDisk 存储位置上。&lt;/p>
&lt;p>&lt;strong>&lt;em>注意：&lt;/em>&lt;/strong>&lt;em>将 vDisk&lt;strong>部署在本地存储上并不会造成单点故障，因为 Provisioning Service&lt;/strong>的负载均衡技术可以让 target devices&lt;strong>自动的在其他 Provisioning Servers&lt;/strong>之间做容错动作。&lt;/em>&lt;/p>
&lt;p>l  &lt;strong>NAS**&lt;/strong>：**NAS 是一种基于文件级存储的 solution。NAS 协议包括 CIFS 和 NFS。NAS vDisk 可以被多个 Provisioning Server 同时所访问。NAS 由于不需要 vDisk 复制功能所以能保证 vDisk 在一个场内的多台 Provisioning Server 之间保持连续性。&lt;/p>
&lt;p>&lt;strong>&lt;em>注意：&lt;/em>&lt;/strong>&lt;em>NAS&lt;strong>反而会造成单点故障，如果网络共享功能不可用，所有从这个 vDisk&lt;/strong>上 Streamed&lt;strong>的 target device&lt;/strong>都会变得不可用了。&lt;/em>&lt;/p>
&lt;p>10)     &lt;strong>决断：评估存储容量&lt;/strong>&lt;/p>
&lt;p>一个 vDisk 包含了一个 VHD 基础镜像文件、一个 properties 文件（.pvd），也可以能包含了一个链条 VHD 差异磁盘（.avhd）。每当一个 vDisk 被 Provisioning Services versioing 所更新时，一个新的差异磁盘就会被创建。&lt;/p>
&lt;p>一个 vDisk 所占空间的评估因素大致有以下几点：&lt;/p>
&lt;p>l  **vDisk****的总容量：**顾名思义&lt;/p>
&lt;p>l  **vDisk chain****的最大版本数：**vDisk versioning 简化了 vDisk 升级以及管理的负担，他能够更加灵活和健壮的管理 vDisks。&lt;/p>
&lt;p>&lt;strong>&lt;em>备注：&lt;/em>&lt;/strong>&lt;em>太多的差异磁盘会显著降低 Provisioning Services&lt;strong>的性能，建议不要超过 5-7&lt;/strong>个的版本数。&lt;/em>&lt;/p>
&lt;p>l  **vDisk****版本变化百分比：**差异磁盘的大小是随着对 vDisk 的改动多少而随着变化的。改得越多，差异磁盘的大小就越大。以下的计算公式可以用于计算 vDisk 容量：&lt;/p>
&lt;p>举例如下：&lt;/p>
&lt;p>比如你计划部署三个 vDisk：&lt;/p>
&lt;p>  Windows 7 (x64) image = 40GB&lt;/p>
&lt;p>  Windows 7 (x86) image = 35GB&lt;/p>
&lt;p>  Windows XP image = 20GB&lt;/p>
&lt;p>每个 vDisk 都不会超过 5 个差异磁盘。预计一个差异磁盘大致是 20%的主 vDisk 镜像文件大小，那么估计 Provisioning Services 存储所需要的空间如下：&lt;/p>
&lt;p>11)     &lt;strong>决断：**&lt;strong>RAID*&lt;/strong>*级别&lt;/strong>&lt;/p>
&lt;p>存储子系统的 RAID 级别会对应用程序和用户的工作负荷产生直接的影响。RAID 0、1 以及 10 对读操作是最优，而 RAID 5 和 6 是对写操作是最优。对于 Provisioning Services 来说，不同的 RAID 级别有如下推荐配置：&lt;/p>
&lt;p>Provisioning Services 中 vDisk 主要是读操作，而对 Write Cache 来说主要是写操作。所以：&lt;/p>
&lt;p>l  &lt;strong>Write Cache**&lt;/strong>：**推荐 RAID 0、1、10 因为这几种 RAID 的写惩罚较低&lt;/p>
&lt;p>l  **vDisk ****存储：**推荐 RAID 0、1、5、10，它可以让读操作分配到 RAID 中的其他磁盘中；&lt;/p>
&lt;p>如果可能，建议将 vDisk 放在 RAID5 上，而写缓存放在 RAID10 上。如果 vDisk 和写缓存一定要放在一起，那么建议采用 RAID10。&lt;/p>
&lt;p>12)     &lt;strong>决断：写缓存的位置&lt;/strong>&lt;/p>
&lt;p>写缓存可以有以下位置：&lt;/p>
&lt;p>l  **缓存在 Target Device****的硬盘上：&lt;strong>由于 Provisioning Servers 不用处理写请求，放在这里会减轻 Provisioning Servers 的资源消耗。尽管没有放在内存中这么快，这种方式的读写都是在本地，还是能提供快速的响应时间；**&lt;/strong>&lt;/p>
&lt;p>l  **缓存在 Target Device****的硬盘上永久保存：**和第一种方式类似，区别在于用户重启之后存储永久保存。该功能目前还是测试阶段，仅在 Windows 2008 R2 和 windows 7 上支持。&lt;/p>
&lt;p>l  **缓存在 Target Device****的内存中：**尽管这种方式在性能上是最优的，但是如果 RAM 别耗尽了也会印象系统的稳定性；&lt;/p>
&lt;p>l  **缓存在 Provisioning Server****的磁盘上：**缓存在 Provisioning Server 的磁盘上作为临时文件存储。所有的写操作均发生在 Provisioning Server 服务器上。这样配置当然会增加 Provisioning Server 的磁盘 IO 操作和网络负担。配置上这种方式最为简单，不过这种方式下 target device 由于所有的到写缓存的读写请求都必须经过网络，target device 的性能会受到较大影响。这种方式仅在 POC 阶段推荐！&lt;/p>
&lt;p>l  **缓存在 Provisioning Server****的磁盘上永久保存：**和上一种方式基本类似，区别在于用户重启之后存储永久保存。这种方式的好处在于 target device 能够保存对 vDisk 所做的改变，在重启之后也仍然保留。任何对 vDisk 的改变都会将缓存文件强制标记为失效状态。例如，如果 vDisk 被设置为 Private Image Mode，一下所有的操作都会导致缓存文件被标记为失效状态：&lt;/p>
&lt;p>n  o  Placing a vDisk in Maintenance mode&lt;/p>
&lt;p>n  o  Mapping the drive from the console&lt;/p>
&lt;p>n  o  Changing the location of the write cache file&lt;/p>
&lt;p>n  o  Using Automatic update&lt;/p>
&lt;p>写缓存包含了 target device 的 MAC 地址和磁盘识别符，他能独一无二的区分出每一台 target device。一个 target device 可以被分配多个 vDisk，因此，也可以关联多个缓存文件。&lt;/p>
&lt;p>将写缓存部署在 target device 上是最为推荐的配置方法，因为既不用消耗而外的 RAM 内存，又不会减少 Provisioning Servers 的扩展性。&lt;/p>
&lt;p>13)     &lt;strong>决断：写缓存的大小&lt;/strong>&lt;/p>
&lt;p>写缓存的大小取决于很多隐私，一般来说都是基于评估和典型的用户配置文件大小。一般来说应当能够存储一下数据：&lt;/p>
&lt;p>n  Temporary application data&lt;/p>
&lt;p>n  User profile temp files&lt;/p>
&lt;p>n  Windows Event Logs&lt;/p>
&lt;p>n  Citrix Logs&lt;/p>
&lt;p>n  Antivirus pattern files&lt;/p>
&lt;p>n  Citrix Application Streaming/Microsoft App-V Cache&lt;/p>
&lt;p>&lt;em>备注：启用了用户配置文件重定向操作能减少写缓存所需要的大小。&lt;/em>&lt;/p>
&lt;p>写缓存的大小极大程度上取决于安装或者是 Streamed 到 vDisk 上的应用程序的大小以及用户配置文件的大小。推荐配置的起点是 2GB。对于大部分虚拟桌面来说，我们有如下推荐配置：&lt;/p>
&lt;p>此外，Windows 的 pagefile 也会写入和写缓存同样的磁盘中，所以：&lt;/p>
&lt;p>例如，如果 Windows 7 的 vDisk 设计是 1.5GB 的 pagefile，那么写缓存的一个安全的评估数据应该是：&lt;/p>
&lt;p>不过由于 Hypervisor 都不能将磁盘精确到小数点后，我们姑且分配 4GB 的空间吧。&lt;/p>
&lt;p>14)     &lt;strong>决断：**&lt;strong>vDisk*&lt;/strong>*的格式&lt;/strong>&lt;/p>
&lt;p>Provisioning Services 支持固定磁盘以及动态磁盘格式。&lt;/p>
&lt;p>l  **固定磁盘格式：**对于私有模式（private mode）的 vDisk，固定尺寸大小的 vDisk 可以对存储 vDisk 磁盘上进行的磁盘碎片整理操作，这对写操作的性能提升会有帮助。不过在私有模式下，访问 vDisk 受限于一个 target device，我们说仅当对 vDisk 进行维护模式时才有实际意义。&lt;/p>
&lt;p>l  **动态磁盘：**相比较而言他需要更少的磁盘空间，但是在写操作上性能会显著降低。尽管在共享模式下（Shared Mode）的 vDisk 不会对 vDisk 执行写操作，不过对完成 vDisk 合并时所要花费的时间会增加许多。&lt;/p>
&lt;p>15)     &lt;strong>决断：**&lt;strong>vDisk*&lt;/strong>*的大小&lt;/strong>&lt;/p>
&lt;p>vDisk 的大小主要取决于操作系统以及安装在操作系统上的应用程序的多少，我们预估的大小如下表所示：&lt;/p>
&lt;p>vDisk 的大小如果设置的太小或者是太大，日后我们还可以在 Provisioning Services 中调整。为了精确的评估 vDisk 的大小，请遵循以下的准则：&lt;/p>
&lt;p>l  **Target Device****的空间：&lt;strong>确认目前作为主 target device 服务的计算机所正在使用的磁盘空间大小；**&lt;/strong>&lt;/p>
&lt;p>l  **应用程序大小：**当应用程序安装时，所需要的空间也在增长。计划大 25%的增长&lt;/p>
&lt;p>16)     &lt;strong>决断：**&lt;strong>vDisk*&lt;/strong>*复制&lt;/strong>&lt;/p>
&lt;p>如果 vDisk 是存储在 DAS 上就需要在他自己有变化的时候复制到其他 DAS 上。Provisioning Services 支持 vDisk 从本地复制到 Provisioning Servers 上，也可以支持在使用共享存储时跨越多个站点之间的复制。复制可以是手动或者是自动：&lt;/p>
&lt;p>l  **手动复制：**简单，但是更耗时；&lt;/p>
&lt;p>l  **自动复制：**大型环境下自动复制更快。一些自动化工具，例如 Microsoft DFS-R 还支持带宽控制。唯一缺点是如果复制出错，管理员还不支持，除非复制平台支持复制重传。&lt;/p>
&lt;p>17)     **决断：微软****Volume Licensing**&lt;/p>
&lt;p>Provisioning Services 支持 Microsoft Key Management Service (KMS)和 Multiple Activation Key (MAK) volume licensing。&lt;/p>
&lt;p>l  &lt;strong>KMS Volume Licensing**&lt;/strong>：&lt;strong>可以在用户的本地网络上激活，无需连接到微软的网站。一台 KMS 服务器支持不受限的 JMS 客户端。微软公司推荐部署两台 KMS 服务器。**&lt;/strong>&lt;/p>
&lt;p>n  Office 2010 的部署只支持 KSM 激活方式；&lt;/p>
&lt;p>l  &lt;strong>MAK Volume Licensing**&lt;/strong>：**MS 的一次性激活方式。&lt;/p>
&lt;p>18)     &lt;strong>决断：高可用&lt;/strong>&lt;/p>
&lt;p>Provisioning Services 是虚拟桌面基础架构中最重要的组成部分，因此为了避免单点故障，需要考虑一下推荐步骤：&lt;/p>
&lt;p>l  &lt;strong>MAK Volume Licensing**&lt;/strong>：**MS 的一次性激活方式。&lt;/p>
&lt;p>l  **数据库：**Provisioning Services 支持两种数据库的高可用方式：&lt;/p>
&lt;p>n  离线的数据库；&lt;/p>
&lt;p>n  镜像数据库&lt;/p>
&lt;p>l  &lt;strong>Provisioning Servers**&lt;/strong>（PVS****服务器）：**所有在一个站点之间的 Provisioning Servers 都能够被配置为向 target device 提供同一个 vDisk。每个站点最少部署两台 PVS 服务器。&lt;/p>
&lt;p>n  Provisioning Services 启动文件应当配置为高可用。在启动文件中可以配置高达 4 台 PVS 服务器的列表。Target Device 会按照顺序连接这些 PVS 服务器。后续所响应的服务器可以不是当初提供 Streaming 服务的服务器。当然，我们也可以配置负载均衡。&lt;/p>
&lt;p>l  **vDisk****和存储：**对于 DAS 上存储的 vDisk，应当做好同步操作。对于 NAS 上的 vDisk，NAS 存储必须提供一条高可用的网络共享连接；&lt;/p>
&lt;p>l  **网络：**Provisioning Servers（PVS 服务器）的网卡应当配置为 Teamed。&lt;/p>
&lt;p>19)     &lt;strong>决断：带宽需求&lt;/strong>&lt;/p>
&lt;p>带宽评估对于整体性能是有至关重要的，特别是当 Target Device 启动的时候。带宽是随着操作系统的不同而有所区别的。Target Device 启动所需要的时间可以参考下面的公式：&lt;/p>
&lt;p>例如，500 个 Windows 7 的 Target Devices 在 1G 以太网下需要 40M 启动：&lt;/p>
&lt;p>1.  1 GB Ethernet = 125MB/s&lt;/p>
&lt;p>2.  500 targets x 40 MB = 20GB&lt;/p>
&lt;p>3.  20GB/125MBs = 160 seconds&lt;/p>
&lt;p>下面的表格列举了在 10GB 网络下启动 500 台不同操作系统的 Target Device 时大致的带宽和启动加载时间：&lt;/p>
&lt;p>备注：防火墙会增加网络延迟，同时也会造成网络瓶颈，如果可能，最好禁用防火墙，如果实在不能避免，最好能开放一下端口的完全访问能力：&lt;/p>
&lt;p>20)     &lt;strong>决断：网络配置&lt;/strong>&lt;/p>
&lt;p>为 PVS 服务器提供 10Gbps 网络能提供最够需要的带宽，如果做不到的话，1Gbps 也可以提供足够的带宽，但是有可能会成为 PVS 服务器的瓶颈。将多块网卡做 Teaming 处理能提供更高的吞吐量，增加网络性能，也能阻止网络的单点故障。下表列出了 PVS 服务器的网络配置属性，从最大容量到最小：&lt;/p>
&lt;p>以下的 NIC 属性应当正确配置在 PVS 服务器以及 Target Devices 的 NIC 上：&lt;/p>
&lt;p>简单地说，就是禁用 Checksum Offloading 属性；关闭 Auto Negotiation，使用强制配置；启用 Jumbo Frame。&lt;/p>
&lt;p>21)     &lt;strong>决断：交换机配置&lt;/strong>&lt;/p>
&lt;p>用于 PVS 服务器和 Target Devices 的网络交换机应当做一下优化：&lt;/p>
&lt;p>l  &lt;strong>生成树协议（Spanning Tree Protocol**&lt;/strong>）/PortFast****：**禁用生成树协议，启用 PortFast；&lt;/p>
&lt;p>l  &lt;strong>风暴控制 Storm Control**&lt;/strong>：**在 Cisco Catalyst 交换机上将 Unicast 流量值设置大一些，或者是禁用 Unicast Filtering。&lt;/p>
&lt;p>l  &lt;strong>Broadcast Helper**&lt;/strong>：**启用之，这样可以转发 PXE 和 TFTP 流量；&lt;/p>
&lt;p>22)     &lt;strong>决断：**&lt;strong>Bootstrap*&lt;/strong>*交付&lt;/strong>&lt;/p>
&lt;p>在一个 Target Device 开始启动过程的时候，他会首先加载一个 bootstrap 程序，该程序会初始化 Target Device 和 PVS 服务器之间的流化会话过程。有三种方法让 Target Device 能收到 bootstrap 程序：&lt;/p>
&lt;p>l  &lt;strong>Broadcast Helper**&lt;/strong>：**启用之，这样可以转发 PXE 和 TFTP 流量；&lt;/p>
&lt;p>l  &lt;strong>使用带有 DHCP**&lt;strong>选项的 PXE*&lt;/strong>*方式；&lt;/strong>&lt;/p>
&lt;p>l  &lt;strong>使用不带有 DHCP**&lt;strong>选项的 PXE*&lt;/strong>*方式；&lt;/strong>&lt;/p>
&lt;p>l  &lt;strong>使用 Boot Device Manager**&lt;/strong>；**&lt;/p>
&lt;p>在企业无法提供 PXE 或者是 TFTP 服务的情况下，或者是无法对 DHCP Scope 选项修改的情况下，可以考虑使用 Boot Device Management 工具通过一个 ISO 文件来提供 bootstrap 文件。&lt;/p>
&lt;p>23)     &lt;strong>决断：审计&lt;/strong>&lt;/p>
&lt;p>默认下审计功能是禁用的，管理员可以将将其打开。打开后该工具可以记录在 Provisioning Services 场内组件所做的配置修改记录，并将结果记录至数据库中。&lt;/p>
&lt;p>24)     &lt;strong>决断：防病毒&lt;/strong>&lt;/p>
&lt;p>大部分的防病毒软件都会是扫描所有的文件和系统进程，对性能影响很大。所以在 PVS 环境下必须优化防病毒软件的配置。请参见 CTX124185 - Provisioning Services Antivirus Best Practices。&lt;/p></description></item><item><title>XenDesktop虚拟桌面精品书籍导读(part4)</title><link>https://martinliu.cn/2013/05/02/xendesktope8999ae68b9fe6a18ce99da2e7b2bee59381e4b9a6e7b18de5afbce8afbbpart4/</link><pubDate>Thu, 02 May 2013 04:22:36 +0000</pubDate><guid>https://martinliu.cn/2013/05/02/xendesktope8999ae68b9fe6a18ce99da2e7b2bee59381e4b9a6e7b18de5afbce8afbbpart4/</guid><description>&lt;p>[su_box color=&amp;ldquo;orange&amp;rdquo; icon=&amp;ldquo;flag&amp;rdquo;]
感谢 Eric Yao 的供稿，&lt;a class="link" href="http://weibo.com/ericyaozhen" target="_blank" rel="noopener"
>@老树皮 Eric&lt;/a>
[/su_box]&lt;/p>
&lt;p>桌面虚拟化项目的实施白皮书  《Citrix Virtual Desktop Handbook 5.x》，&lt;a class="link" href="http://support.citrix.com/article/CTX136546" target="_blank" rel="noopener"
>点击下载&lt;/a>。&lt;/p>
&lt;h2 id="四-控制层-control-layer">四、      控制层 Control Layer
&lt;/h2>&lt;p>控制层是设计架构的第四层。在上面有关用户的三个层面我们所做的决定都会汇总起来到控制层。&lt;/p>
&lt;ol>
&lt;li>访问控制器&lt;/li>
&lt;/ol>
&lt;p>访问控制器子层的职责是给每个用户提供予以支持访问控制层的基础架构组件。这么说可能比较绕口，那就换个说法吧，访问控制器一般包括例如 Web Interface、StoreFront，以及 NetScaler Access Gateway；&lt;/p>
&lt;p>1)        远程访问架构&lt;/p>
&lt;p>如果有用户需要远程或者是离线的移动访问能力，那么就要设计远程访问基础架构了。&lt;/p>
&lt;ol>
&lt;li>**A.        ****决断：拓扑**&lt;/li>
&lt;/ol>
&lt;p>网络拓扑的设计对远程访问架构能够支撑功能性、性能以及安全性至关重要。远程访问架构应当和安全团队一起合作以确保符合企业的安全规范。以下三种主要的拓扑结构我们在设计师可以考虑，每种的安全性逐渐递增：&lt;/p>
&lt;p>l  &lt;strong>1-Arm (Normal Security**&lt;/strong>，单臂模式)****：**在这种架构下，Access Gateway 使用一个物理的或者是逻辑的 Bonded 的网络接口，再加上 VLAN 和 IP 子网的设计，来传递用户和后台虚拟桌面的流量。&lt;/p>
&lt;p>l  **2-Arm (High Security **&lt;strong>双臂模式)*&lt;/strong>*：**在双臂模式下，Access Gateway 利用两张或者更多的物理或者逻辑 Bonded 的网络接口卡，再加上 VLAN 和 IP 子网的设计，来传递用户和后台虚拟桌面的流量。前段用户的流量被导向这些网络接口卡的第一张网卡上，前后端的流量是被分离设计的，就是说说后端虚拟桌面架构服务器的流量是被定向到第二张网卡上的。通过这样的设计我们就可以 DMZ 区来分离前后端的流量，同时还可以定制防火墙策略和流量监控策略。****&lt;/p>
&lt;p>l  **Double-Hop DMZ (Very High Security): **这种模式既利用了双臂拓扑下的特性，又使用了两个单独的 Access Gateway 设备。有一些企业使用了三个物理的/逻辑的防火墙结构来保护他们的内部网络。这三个防火墙将 DMZ 区划分为两个区域来提供额外的内部网络安全。&lt;/p>
&lt;p>在第一个 DMZ 区的 Access Gateway 设备处理用户的连接，完成 SSL VPN 的安全功能。这个 Access Gateway 设备加密客户端连接，判断用户的认证方式，控制能够访问的内部网络服务器；&lt;/p>
&lt;p>第二个 DMZ 区域的 Access Gateway 设备充当与一个代理设备角色。这个 Access Gateway 设备启用 ICA 协议将客户端连接穿越第二个 DMZ 区到后端的服务器场。在第一个 DMZ 区的 Access Gateway 设备和内部网络的 Secure 　 Ticket 　 Authority（STA）也是通过第二个 DMZ 区的 Access Gateway 设备来进行代理的。&lt;/p>
&lt;ol>
&lt;li>**B.        ****决断：平台**&lt;/li>
&lt;/ol>
&lt;p>在 Access Gateway 部分，我们曾经讨论过只要是涉及到远程访问，我们都会考虑 NetScaler Access 　 Gateway 设备。问了确定合适的 NetScaler 平台来满足项目需求，必须确定一些关键资源。由于所有的远程访问流量都是通过 SSL（安全套接层）来加密，再通过 HTTPs 的 HTTP（超文本协议）协议来传输。所以有两种资源 metric 需要确认：&lt;/p>
&lt;p>l  **SSL****吞吐量：**SSL 吞吐量是定义为每秒钟能处理的 GB SSL 流量；&lt;/p>
&lt;p>l  **SSL**&lt;strong>每秒交易量（TPS*&lt;/strong>*）：**TPS metric 定义在每秒每个应用程序交付控制器（ADC）能处理的 SSL 交易数量&lt;/p>
&lt;p>关于这两个参数的更详细解释，可以参考：&lt;a class="link" href="http://assets.citrix.com/NetScaler_0911/ASSETS/Citrix_2048_SSL_Best_Practices.pdf" target="_blank" rel="noopener"
>Best Practices for implementing 2048-bit SSL&lt;/a>&lt;/p>
&lt;p>平均的 SSL 带宽开销在和虚拟桌面的开销比较起来时经常忽略。但是 SSL 带宽的计算将会有助于确定总带宽是否足够。固定带宽加上数据包头开销常常随着加密算法的不同而变化，总带宽开销也常常随着数据包尺寸大小的变化而不同。理想状态下，开销数字应当通过 POC 或者是 Pilot 来实际测试得来，但是在没有这些数据的情况下，在工作负荷带宽基础上加上 2%是一个合理的数字。因此，在确定 NetScaler 平台的时候，SSL 的吞吐量常常是最大并发带宽乘以 1.02，即：&lt;/p>
&lt;p>SSL 吞吐量 = 最大并发带宽 × 1.02&lt;/p>
&lt;p>例如：假设 128M 是最大的并发带宽，那么最合适的 NetScaler 模型应当计算为：&lt;/p>
&lt;p>约 130Mbps = 128M × 1.02&lt;/p>
&lt;p>NetScaler 有三种平台，每种都提供了大量的不同的扩展性：&lt;/p>
&lt;p>l  &lt;strong>VPX**&lt;/strong>：&lt;strong>VPX 平台的 NetScaler 和硬件的 NetScaler 提供完全一致的功能，不过他只适合于小型的测试环境使用。**&lt;/strong>&lt;/p>
&lt;p>l  &lt;strong>MDX**&lt;/strong>：&lt;strong>NetScaler MDX 是 NetScaler 设备的硬件版本。他能支持大型网络可扩展环境；**&lt;/strong>&lt;/p>
&lt;p>l  &lt;strong>SDX**&lt;/strong>：&lt;strong>NetScaler SDX 设备是在物理 NetScaler 设备和虚拟 NetScaler 设备之间的一个桥梁。一个 SDX 设备能够划分为多个虚拟的 NetScaler 设备。**&lt;/strong>&lt;/p>
&lt;p>2)        StoreFront&lt;/p>
&lt;p>Citrix StoreFront 是 Web Interface 的下一代产品，它验证用户连接到后台的 XenDesktop 站点、XenApp 场，以及 AppController（SaaS 应用），然后枚举或者是聚合可用的桌面和应用程序到商店以便让用户通过不同操作系统平台上的 Receiver 来访问，包括安卓、iOS、Linux、Windows、Win8/RT 以及 Web 站点。&lt;/p>
&lt;ol>
&lt;li>&lt;strong>C.         **&lt;strong>决断：Web Interface*&lt;/strong>*还是 StoreFront&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>Web Interface 和 StoreFront 是两种不同的解决方案，在一些功能方面有重叠。所以我们要认真评估我们的需求。一般来说，新的方案应该使用 StoreFront，因为 Web Interface 已经不再有新功能添加了。可以参考下面的链接了解 Citrix 桌面产品的生命周期：&lt;a class="link" href="http://www.citrix.com/support/product-lifecycle/milestones/xendesktop.html" target="_blank" rel="noopener"
>Lifecycle Milestones for Citrix XenDesktop&lt;/a>&lt;/p>
&lt;p>下面的表格也示例了在何种情况下该使用什么产品：&lt;/p>
&lt;p>下面的表格对两种产品在未来功能的开发目标上进行了一个对比，Web Interface 已经不再会有革命性的功能添加了：&lt;/p>
&lt;p>下面的表格是功能对比：&lt;/p>
&lt;p>有一些 Web Interface 有的功能也会被完全整合到未来的 StoreFront 新版本中去：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>A.        **&lt;strong>决断：Web *&lt;/strong>*服务的高可用&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>如果 StoreFront 服务器不可用，或者是其他对应的 Web 服务不可用了，那么用户就不能连接到新的会话，例如打开新的虚拟桌面，无法打开应用程序等操作，因此，至少需要规划两台 StoreFront 来预防单点故障问题。我们可以考虑的方案包括：&lt;/p>
&lt;p>l  &lt;strong>DNS Round Robin**&lt;/strong>：&lt;strong>在多个服务器之间提供基本的负载均衡功能，无法做到是否可用性的检查；在服务器宕机时，部分用户会受到影响。**&lt;/strong>&lt;/p>
&lt;p>l  &lt;strong>Windows NLB**&lt;/strong>：**是 Windows 的一个服务。可以做一些基本的检查来判断服务器是否可用，但是无法判断单个服务的状态。&lt;/p>
&lt;p>l  &lt;strong>Citrix NetScaler**&lt;/strong>：**智能硬件设备，能检查 StoreFront 服务的状态，根据用户请求主动激活负载均衡状态。&lt;/p>
&lt;ol>
&lt;li>**B.        ****决断：应用程序订阅数据库的高可用**&lt;/li>
&lt;/ol>
&lt;p>StoreFront 的配置数据都存储在每一台 StoreFront 服务器的本地，然后被复制到服务器组中的其他的系统中。对比之下，用户应用程序订阅信息存储在应用程序订阅数据库中，该数据库可以是本地的 StoreFront 服务器，也可以是推荐的一个专门的 Microsoft SQL Server。&lt;/p>
&lt;p>如果应用程序订阅数据库不可用，以下功能将不可用：&lt;/p>
&lt;p>l  用户不能在管理他们的应用程序订阅；&lt;/p>
&lt;p>l  无法登陆至 Web 方式的 Reciever，但是已经建立起来的会话可以继续正常工作；&lt;/p>
&lt;p>为了防止应用程序订阅数据库成为单点故障点，Citrix 推荐 SQL 的高可用方案：&lt;/p>
&lt;p>l  **自动容错的 SQL****镜像：&lt;strong>数据库镜像提供了一种比数据库 Clustering 更简单的快速容错方法。数据库镜像技术在每一个镜像点上需要一个标准的 SQL 标准版服务器 License，在加上一个 witness 服务器的 SQL Express License 即可。更多细节可以参考文档：&lt;a class="link" href="http://support.citrix.com/proddocs/topic/dws-storefront-12/dws-configure-conf-file.html" target="_blank" rel="noopener"
>Configuring StoreFront using the Configuration Files.&lt;/a>**&lt;/strong>&lt;/p>
&lt;p>l  **SQl Clustering: **微软的技术，不过老实说，相比较 Mirroring 技术配置太复杂，此外，自动容错的过程也更慢。在 License 上，每个 Cluster 节点都需要一个企业版的 SQL license。****&lt;/p>
&lt;p>l  **Hypervisor****高可用：**数据库部署在一台虚拟机上，通过 Hypervisor 的高可用来实现。这个技术比镜像或者是 clustering 都要便宜，因为只需要一个 SQl Express License 和一台 SQL Server（需要一个具备 HA 功能的 Hypervisor License）。不过，这个技术容错过程较慢，也仅仅是当 SQl Server 的操作系统宕机时才能启动容错机制。如果数据库服务出现错误是无法被 Hypervisor 层检测到的。&lt;/p>
&lt;p>&lt;em>注意：未来的 StoreFront&lt;strong>版本将不会再使用应用程序订阅数据库（Application Subscription Database&lt;/strong>），相反，预订信息会自动的在 StoreFront&lt;strong>服务器组中的 StoreFront&lt;/strong>服务器中自动复制。&lt;/em>&lt;/p>
&lt;ol>
&lt;li>**C.         ****决断：容量规划**&lt;/li>
&lt;/ol>
&lt;p>基于扩展性的测试，单个 StoreFront 服务器可以支持的用户数是无限制的，受限制的是在这个服务器上每小时之内用户同时操作的动作。这是因为仅仅当用户执行一个动作的时候，例如在 Receiver 中订阅一个应用程序是，StoreFront 才被使用。当用户连接到所发布的资源时，StoreFront 实际上是 idle 状态的。因此，下面的表格所展示的内容介绍的是没鸟的请求时，或者是每小时的请求数。我们建立了一个前提条件是每用户在每小时之内启动了五个应用程序，订阅了 2 个应用程序，取消订阅了一个应用程序，总共每小时是 8 个操作量。&lt;/p>
&lt;p>注意：上述数字是在仿真环境下测试得来：基于 SSL 的 XenApp6.5，发布了 100+个应用程序，每个用户在 5 秒钟之内完成操作的。&lt;/p>
&lt;p>StoreFront 对 CPU 的数量更敏感，也就是说对 CPU 的消耗更大，而不是对内存消耗更大。推荐的企业 StoreFront 服务器是 4 个 vCPU 和 4GB RAM。&lt;/p>
&lt;ol>
&lt;li>&lt;strong>D.        **&lt;strong>但服务器扩展性 – *&lt;/strong>*应用程序订阅数据库&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>应用程序订阅数据库包含了每个用户订阅的一系列资源列表情况。基于测试环境下，推荐的一个储存应用程序订阅数据库独立 SQL 服务器的配置是 4vCPU 和 4GB RAM。&lt;/p>
&lt;p>数据库的增长速度大约是每个订阅 10KB 空间消耗：&lt;/p>
&lt;p>数据库大小 = （用户数 × 每用户的订阅数） × 10KB&lt;/p>
&lt;p>1 个订阅 = 1 个用户订阅一个应用程序，例如，1000 个用户订阅 10 个应用程序就是 100MB。&lt;/p>
&lt;ol>
&lt;li>桌面控制器&lt;/li>
&lt;/ol>
&lt;p>这部分内容主要是介绍 XenClient 部分，请大家自行参见&lt;a class="link" href="http://support.citrix.com/article/CTX136546" target="_blank" rel="noopener"
>原始文档&lt;/a>。&lt;/p>
&lt;p>下期预告：下一期我们介绍最后的部分：Provisioning Services&lt;/p></description></item><item><title>XenDesktop虚拟桌面精品书籍导读(part3)</title><link>https://martinliu.cn/2013/04/16/xendesktope8999ae68b9fe6a18ce99da2e7b2bee59381e4b9a6e7b18de5afbce8afbbpart3/</link><pubDate>Tue, 16 Apr 2013 15:29:43 +0000</pubDate><guid>https://martinliu.cn/2013/04/16/xendesktope8999ae68b9fe6a18ce99da2e7b2bee59381e4b9a6e7b18de5afbce8afbbpart3/</guid><description>&lt;p>[box color=&amp;ldquo;orange&amp;rdquo; icon=&amp;ldquo;flag&amp;rdquo;]
感谢 Eric Yao 的供稿，&lt;a class="link" href="http://weibo.com/ericyaozhen" target="_blank" rel="noopener"
>@老树皮 Eric&lt;/a>
[/box]&lt;/p>
&lt;p>桌面虚拟化项目的实施白皮书  《Citrix Virtual Desktop Handbook 5.x》，&lt;a class="link" href="http://support.citrix.com/article/CTX136546" target="_blank" rel="noopener"
>点击下载&lt;/a>。&lt;/p>
&lt;p>智慧的积累靠一蹴而就很难实现，慢慢积累和温故而知新往往是最佳的手段。让我们继续开始《Citrix 桌面虚拟化实施部署白皮书》，这晚我们开讲第二部分的第三单元：桌面层。&lt;/p>
&lt;p>四、 桌面层 Desktop Layer&lt;/p>
&lt;p>设计思想的第三层，也是和用户相关的最后一层，就是桌面层。用户是否能接受桌面虚拟化很多程度上就是在这一层实现的，例如包括个性化、应用程序，以及后台操作系统镜像文件的设计。&lt;/p>
&lt;ol>
&lt;li>应用程序交付&lt;/li>
&lt;/ol>
&lt;p>选择正确的应用程序交付方法会对整个系统设计的可扩展性、可管理性，以及用户感受起到非常大的帮助。基于我们在前几章节的“四、 应用程序数据搜集”，我们可以考虑以下几种交付方法：&lt;/p>
&lt;p>l 直接安装在操作系统镜像文件上：应用程序是基础操作系统镜像文件的一部分；&lt;/p>
&lt;p>l 安装在 Personal vDisk 上：物理是分离的，但是逻辑上是直接安装在基础操作系统镜像文件中；&lt;/p>
&lt;p>l 流化（Streaming）：应用程序被 profiled（XenApp 组件）后通过网络交付到桌面上。应用程序的文件和注册表键值在虚拟桌面的一个容器中保存，但是和基础操作系统镜像文件是分离的。&lt;/p>
&lt;p>l Hosted：应用程序安装在 XenApp 服务器上，用户通过 Citrix HDX 协议远程访问。&lt;/p>
&lt;ol>
&lt;li>决断：应用程序交付方法&lt;/li>
&lt;/ol>
&lt;p>系统架构师应该在基于用户需求、应用程序兼容性，以及其他通过在前几章（“四、 应用程序数据搜集”）搜集上来的应用程序因素基础之上决定采用何种方法来进行应用程序的交付。通常单一的方法是无法满足用户全部的需求的，所以多种方法组合才是最佳答案。但是不管用什么方法，这些交付手段都应当对整个项目的交付复杂程度和后续跟进步骤与以最小的影响。&lt;/p>
&lt;p>下面的表格就是不同的交付方法对系统不同层面的影响：&lt;/p>
&lt;p>除了应用程序交付方法对系统不同层面的应用之外，系统架构师还应该考虑应用程序在不同交付手段上的适用性。下面的表格就是不同应用程序所推荐的部署方法示例：&lt;/p>
&lt;p>上表中需要注意的是最后一种应用程序，我们往往会觉得这种复杂安装和配置的应用程序最好是安装在操作系统镜像文件中，但是最佳实践告诉我们应该安装在 XenApp Server 上，通过 Hosted 的方法发布给用户。&lt;/p>
&lt;ol start="2">
&lt;li>兼容性&lt;/li>
&lt;/ol>
&lt;p>任何一个桌面虚拟化项目都会对一个公司的应用程序交付方法产生巨大的应用。举例来说，许多公司都希望通过在桌面虚拟化中使用流化的应用程序交付或者是 XenApp 交付应用程序来降低升级用户的桌面操作系统的劳动负荷以及提高管理效率。所以在设计阶段我们就要做很多兼容性测试以确定最正确的应用程序交付方法。最重要需要考虑的兼容性需求一般来说包括以下几点：&lt;/p>
&lt;p>l 桌面操作系统的版本：如果操作系统是通过流化安装或者是直接安装在操作系统中，那么应用程序需要考虑和操作系统的兼容性问题；&lt;/p>
&lt;p>l 服务器操作系统的版本：有一些应用程序可能会更合适通过 XenApp 的方式来交付，所以，应用程序是否能安装在服务器版本的操作系统平台上是要考虑的因素；&lt;/p>
&lt;p>l 应用程序本身的架构：应用程序本身的开发平台有可能是 16 位的，32 位的，也可能是 64 位的。16 位的应用程序就不能运行在 64 位的操作系统平台上，例如 Windows 2008Server 　 R2、Windows XP 64bits 等；&lt;/p>
&lt;p>l 互操作性：有一些应用程序如果和某些版本的操作系统共存是会有兼容性问题，例如注册表冲突、DLL 冲突，或者是 ini 冲突。&lt;/p>
&lt;p>l 应用程序流化：应用程序流化到桌面虽然可以简化管理，因为操作系统上不用安装那么多的应用程序了，但是记住有些带有设备驱动程序，或者是使用了 COM+等应用程序就不适合了&lt;/p>
&lt;p>在做应用程序兼容性测试时的三种主要技术手段有：&lt;/p>
&lt;p>l 手动：不言而喻这种方法最消耗时间，每种交付方法都要测试，每种操作系统版本、不同操作系统语言包等也都要验证。手动模式下想要的出应用程序所有方面的测试结果是非常困难的，对应用程序互操作性的测试是几乎测不出来的。而且更多的测试结果是现场使用人员发现的，而不是测试时发现的。&lt;/p>
&lt;p>l 预验证的应用程序：很多应用程序的开发商都会提供该应用程序的兼容性文档和最佳安装方式的文档。参考这些文档会有直接的帮助。此外，Citrix Community Verified 的网站上也有一整系列的由 Citrix 的客户和合作伙伴验证过包括采用流化方法/XenApp/Xendesktop 兼容的应用程序列表。微软公司也提供了类似的应用程序列表：Microsoft Windows 7 Application Compatibility List for IT Professionals；&lt;/p>
&lt;p>l 自动化的工具：Citrix AppDNA 可以快速而且准确的对应用程序的兼容性做出精确的测试，包括测试不同的操作系统平台，测试不同的交付手段，例如 Windows XP、Windows 7、Citrix XenApp、Microsoft App-V，以及 Citrix Streaming 流化交付方式等。应用程序被导入到 AppDNA 时，它会被和数千种应用程序进行兼容性的匹配验证以判断是否有互操作性问题。当发现问题时，AppDNA 会告知问题出自何处，可能的解决办法，以及估计解决的时间。&lt;/p>
&lt;p>上述每种方法的优点和缺点都列在下表中：&lt;/p>
&lt;p>测试做完之后，兼容性的结果就应该填入到之前的应用程序评估表各种以便我们的后续分析：&lt;/p>
&lt;p>l 预运行环境：许多程序都有运行环境的要求，例如 Java、.Net 环境，或者是数据库要求；&lt;/p>
&lt;p>l 程序之间的依赖：例如，需要以 pdf 格式呈现信息的应用程序就需要电脑上安装了 pdf 的阅读器；&lt;/p>
&lt;p>l 16 位的代码：应用程序评估也应该判断是否应用程序包含有 16 位的代码，因为 16 位的代码是不能运行在 64 位的操作系统平台上；&lt;/p>
&lt;p>l Windows XP：确认应用程序是否能通过 Windows XP 的兼容性测试；&lt;/p>
&lt;p>l Windows 7：确认应用程序是否能通过 Windows 7 的兼容性测试；&lt;/p>
&lt;p>l XenApp 6.5：确认应用程序是否能通过 XenApp 6.5 的兼容性测试；&lt;/p>
&lt;p>l Application Streaming 应用程序流化安装：确认应用程序是否能通过流化程序安装的兼容性测试；&lt;/p>
&lt;ol start="3">
&lt;li>用户分类&lt;/li>
&lt;/ol>
&lt;p>通常不是所有用户都需要所有的应用程序，有些程序可能就只有很小一部分用户用的上。所以系统架构师应该做好这个工作，例如如果一个部门的用户都需要的应用程序列表组，我们可以单独做一个操作系统镜像文件。如果只有少部门用户需要使用，那我们建议采用 Personal vDisk 或者是 Streaming 的方式交付应用程序。&lt;/p>
&lt;ol start="4">
&lt;li>业务特点&lt;/li>
&lt;/ol>
&lt;p>l IT 经验：如果 IT 部门已经对某种应用程序交付方式有经验，或者是基础架构已经 Ready 了，那么这种交付模式可能就是合适的方式。例如，如果公司内部已经通过 Microsoft App-V 平台部署过 Streaming 的应用程序，那么 XenApp Streaming 应用程序就应当优先被考虑。&lt;/p>
&lt;p>l 管理需求：应用程序交付的方法很可能严重依赖于应用程序的拥有着。如果应用程序是公司拥有的程序，那么 IT 部门就有责任和义务来维护该应用程序，包括 XenApp 发布或者是 XenApp 流化。如果程序的拥有者是某个下级部门，那么 IT 部门就不方便集中管理，这种情况下应用程序可能就建议安装在 Personal vDisk 上，让部门自己来管理该应用程序。&lt;/p>
&lt;p>l 升级频率：应用程序的升级所需要花费的时间和部门协调也对交付模式的选择有很大影响。如果应用程序经常升级，那么系统架构师就应当选择安装数量最少的交付模式，这样可以减少升级的应用程序数量，以及降低升级的复杂程度。这种情况西 XenApp 交付方式最为合适；&lt;/p>
&lt;p>l 产品 Licensing：如果应用程序没有 License 要求，例如和软件厂商签订了 Site License，那么我们可以将该程序发布给所有的用户也不会产生其他任何成本，将该程序直接安装在操作系统模板里面也能降低交付的复杂性。如果应用程序对 License 很敏感，系统架构师就需要考虑采用一种能够遵守应用程序软件提供商要求的 License 模型。&lt;/p>
&lt;ol start="5">
&lt;li>技术特点&lt;/li>
&lt;/ol>
&lt;p>l 资源使用：如果应用程序对资源要求很高，可能会更合适于直接在虚拟桌面里面直接运行；&lt;/p>
&lt;p>l 技术难点：如果一个应用程序的安装都很复杂，例如需要专门的配置，脚本的运行，或者对其他应用程序有很多要求，我们称之为技术难点。这种情况下，安装在 XenApp Server 上能减少操作系统镜像文件制作的复杂性。&lt;/p></description></item><item><title>XenDesktop虚拟桌面精品书籍导读(part2)</title><link>https://martinliu.cn/2013/04/15/xendesktope8999ae68b9fe6a18ce99da2e7b2bee59381e4b9a6e7b18de5afbce8afbbpart2/</link><pubDate>Mon, 15 Apr 2013 06:52:55 +0000</pubDate><guid>https://martinliu.cn/2013/04/15/xendesktope8999ae68b9fe6a18ce99da2e7b2bee59381e4b9a6e7b18de5afbce8afbbpart2/</guid><description>&lt;p>[box color=&amp;ldquo;orange&amp;rdquo; icon=&amp;ldquo;flag&amp;rdquo;]
感谢 Eric Yao 的供稿，&lt;a class="link" href="http://weibo.com/ericyaozhen" target="_blank" rel="noopener"
>@老树皮 Eric&lt;/a>
[/box]&lt;/p>
&lt;p>桌面虚拟化项目的实施白皮书  《Citrix Virtual Desktop Handbook 5.x》，&lt;a class="link" href="http://support.citrix.com/article/CTX136546" target="_blank" rel="noopener"
>点击下载&lt;/a>。&lt;/p>
&lt;p>上周一我们介绍了《Citrix 桌面虚拟化实施部署白皮书》的第二部分《设计篇 Design》的第一单元：用户层。今天我们继续往前进，开讲第二单元：访问层的部分。&lt;/p>
&lt;p>三、 访问层 Access Layer&lt;/p>
&lt;p>访问层的设计主要是基于每个用户组和终端设备的移动性需求。&lt;/p>
&lt;ol>
&lt;li>决断：认证点&lt;/li>
&lt;/ol>
&lt;p>让用户在什么地点做认证是管理员的决定，一般而言，有四个认证点：&lt;/p>
&lt;p>a) Web Interface：给 XA 和 XD 提供安全访问；&lt;/p>
&lt;p>b) StoreFront：为 Receiver 交付认证能力和资源；&lt;/p>
&lt;p>c) Secure Gateway (Web Interface): Secure Gateway 是一个 Windows 的应用程序，她和 WI 配合工作；&lt;/p>
&lt;p>d) Access Gateway: 硬件&lt;/p>
&lt;p>具体采用哪种方式认证由用户组的移动需求来决定，推荐方案如下：&lt;/p>
&lt;ol start="2">
&lt;li>决断：预认证策略&lt;/li>
&lt;/ol>
&lt;p>如果我们使用的是 Access Gateway，我们就可以选择是否采用预认证策略，这些策略可以是确定终端是否满足某种接入网络前的扫描条件。&lt;/p>
&lt;p>我们可以配置的策略包括测试防病毒软件、防火墙软件、操作系统，甚至是注册表键值。XA 和 XD 可以利用这些策略的检查结果确认后续的动作，包括剪贴板是否开启，打印机映射，甚至是否开启特定的应用程序访问权限。例如，如果用户没有安装防病毒软件，可以配置策略隐藏敏感的应用程序。&lt;/p>
&lt;p>下面的图标从流程上示例策略配置是如何流转的：&lt;/p>
&lt;ol start="3">
&lt;li>决断：认证策略&lt;/li>
&lt;/ol>
&lt;p>l Web Interface, Secure Gateway (Web Interface), or StoreFront: StoreFront 是未来的方向，而 Web Interface 已经是行将就木，所以下面的策略主要是用在 StoreFront 上，当然也适用于 Web Interface&lt;/p>
&lt;p>n 用户名/密码&lt;/p>
&lt;p>n Domain Pass-Through：允许从用户设备上透传 Domain 登录信息，用户登录到加入域的电脑后自动登录到 Store；&lt;/p>
&lt;p>n Access Gateway Pass-Through：用户登录到 Access Gateway 后自动登录到 Store&lt;/p>
&lt;p>l Access Gateway：NetScaler 支持几种不同的认证手段。下面分别列出了几种主要的认证方法，每种方法都可以单独使用，但是在实践中，我们进场组合起来以提供多因素认证。&lt;/p>
&lt;p>n LDAP：轻型目录访问协议是我们最为熟悉的认证方法了，它是一种基于 TCP 协议的目录访问服务，例如 MS 的活动目录就是其中一种实现形式。&lt;/p>
&lt;p>n Radius（aka Token）：Radius 全名是 Remote Authentication Dial In User Service，这是一种基于 UDP 传输协议的安全认证协议。除了认证外，它还提供授权和计费功能。Access Gateway 转发用户输入的用户名和密码给 Radius 服务器，Radius 服务器可以立即检查用户名和密码，也可以转发给目录服务器。&lt;/p>
&lt;p>n 客户端证书：用户登录到 Access Gateway 虚拟服务器后，可以通过本地的客户端证书的属性来做认证。客户端证书通常在用户端的形式是智能卡，或者是 Common Access Cards (CACs)的形式，再通过客户端本地的读卡器来读取信息。&lt;/p>
&lt;p>采用什么认证形式通常都是取决于安全的需求，以及使用什么认证点。下表给出了一个基于安全需求级别的示例：&lt;/p>
&lt;ol start="4">
&lt;li>决断：会话策略&lt;/li>
&lt;/ol>
&lt;p>采用 Access Gateway 作为认证点的用户必须有对应的会话策略来定义用户体验。会话策略的制定是基于 Receiver 在设计阶段制定的。一般而言，首先我们会将设备分为非移动设备和移动设备两种：&lt;/p>
&lt;p>l 移动设备：表达式定义为：“REQ.HTTP.HEADER User-Agent CONTAINS CitrixReceiver”，该语句将移动设备设置为比非移动设备更高优先级以保证移动设备的匹配性。&lt;/p>
&lt;p>l 非移动设备：表达式定义为：“ns_true”，即所有流量。&lt;/p>
&lt;p>更多信息，可以参考 Citrix 公开电子文档：Receiver and Plug-ins&lt;/p>
&lt;p>BTW，另外一种会话策略是采用终端的扫描方法。&lt;/p>
&lt;ol start="5">
&lt;li>决断：会话 Profile（Session Profile）&lt;/li>
&lt;/ol>
&lt;p>每个会话策略（Session Policy）都必须定义一个对应的 Session Profile（姑且翻译成会话配置文件）。这个会话配置文件定义了用户去访问资源时的访问细节。有两种定义到虚拟桌面环境的访问方式的会话配置文件的形式：&lt;/p>
&lt;p>l SSL VPN：传统的 VPN 方式，将网络全部打通。这种方式并不一定十分安全，因为这能导致客户端到内网服务器的攻击访问。&lt;/p>
&lt;p>另外一种办法是考虑是否在 SSL VPN 中开辟一条给客户端网络流量的单独通道。这样通过 receiver 的流量智慧限制在指定的端口，只能访问指定的服务器资源等。&lt;/p>
&lt;p>上述两种方式各有利弊，第一种方式虽然安全性差了，但是可以做客户端流量可以被企业的网络过滤设备，例如入侵检测设备做监视和控制。&lt;/p>
&lt;p>l HDX Proxy：在 HDX 代理方式下，用户是通过 Access Gateway 连接到他们的虚拟桌面和虚拟应用。这种方式下完全没有将内部资源暴露到公网上，此时 Access Gateway 充当了一个微型 VPN 的作用，它仅处理 HDX 的流量。其他的流量，例如电子邮件，又或者是使用者上网的流量都不经过 Access Gateway。&lt;/p>
&lt;ol start="6">
&lt;li>决断：访问带宽&lt;/li>
&lt;/ol>
&lt;p>最后的访问层决断就是要决定虚拟桌面所需要的最大并发网络带宽。其中很重要的一个关键环节就是决定采用 NetScaler Access Gateway 的哪一个平台。&lt;/p>
&lt;p>每个用户所需要的带宽关键还是要看计算的需求。一个时不时才用一下电脑的 ERP 使用者和一个在电脑前屁股都不挪窝的 OA 用户肯定带宽要求是不同的，如果是 CAD 画图的用户那就更不用说了。&lt;/p>
&lt;p>理想情况下带宽的使用情况是通过带宽分析工具来给出来，不过我们还是可以给出一些经验值：&lt;/p>
&lt;p>总带宽的的计算公式可以这样来定义：&lt;/p>
&lt;p>总带宽 = 平均带宽 × 最大并发用户值&lt;/p>
&lt;p>更多细节，可以参考 Citrix 的知识库文章：&lt;/p>
&lt;p>XenDesktop Planning Guide: User Bandwidth Requirements ： &lt;a class="link" href="https://mail.citrix.com/owa/redir.aspx?C=5BdyIzIzrEOfoVxvpzfMxnn5HIs1DdAIlS0opaj6UrOPgSysoUakkdkru0zo0okQlYOGYaDEspc.&amp;amp;URL=http%3a%2f%2fsupport.citrix.com%2farticle%2fCTX126191" target="_blank" rel="noopener"
>XenDesktop Planning Guide: User Bandwidth Requirements&lt;/a>&lt;/p></description></item><item><title>XenDesktop中如何重定向USB设备</title><link>https://martinliu.cn/2013/04/15/xendesktope4b8ade5a682e4bd95e9878de5ae9ae59091usbe8aebee5a487/</link><pubDate>Mon, 15 Apr 2013 06:44:52 +0000</pubDate><guid>https://martinliu.cn/2013/04/15/xendesktope4b8ade5a682e4bd95e9878de5ae9ae59091usbe8aebee5a487/</guid><description>&lt;p>&lt;img src="webkit-fake-url://C94F41EF-2B27-43A6-8999-EBAB0037856E/hdx-monitor-banner.png"
loading="lazy"
alt="hdx-monitor-banner.png"
>&lt;/p>
&lt;p>原文出处：&lt;a class="link" href="http://support.citrix.com/article/CTX136751" target="_blank" rel="noopener"
>http://support.citrix.com/article/CTX136751&lt;/a>  这篇文章你还不会，你就 out 了！&lt;/p>
&lt;p>&lt;strong>概要&lt;/strong>&lt;/p>
&lt;p>本文描述如何映射默认下被禁用的 USB 设备。&lt;/p>
&lt;p>&lt;strong>要求&lt;/strong>&lt;/p>
&lt;p>当重定向 USB 设备，终端用户必须首先识别 USB 设备，将其映射到会话中。假如设备需要特殊驱动，则驱动必须同时安装在客户机和虚拟桌面代理（VDA）上。如果终端识别驱动，设备在没有驱动的情况下仍可映射，但是 VDA 上需安装驱动以确保工作正常。&lt;/p>
&lt;p>&lt;strong>背景&lt;/strong>&lt;/p>
&lt;p>特定 USB Class 默认下被禁用因为它们主要用于本地工作站，例如智能卡阅读器。&lt;/p>
&lt;p>&lt;strong>步骤&lt;/strong>&lt;/p>
&lt;p>&lt;strong>注意&lt;/strong>!这个修复需改变注册表。错误使用注册表编辑器可能产生严重问题，导致你需要重装操作系统。Citrix 不承诺解决错误使用注册表编辑器的问题。使用注册表编辑器存在风险。确保修改前备份注册表。&lt;/p>
&lt;p>完成以下步骤查找设备的 Class ID 和 Hardware ID：&lt;/p>
&lt;ul>
&lt;li>打开终端客户机的设备管理器，查找需要重定向的 USB 设备。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://support.citrix.com/article/html/images/CTX136751-1.gif"
loading="lazy"
alt="ipboard01"
>&lt;/p>
&lt;ul>
&lt;li>右击设备选择&lt;strong>属性&lt;/strong>。注意在 Details 面板上，显示如下图的 Hardware ID 和 Class ID。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://support.citrix.com/article/html/images/CTX136751-2.gif"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="http://support.citrix.com/article/html/images/CTX136751-3.gif"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>在&lt;strong>Citrix Desktop Studio&lt;/strong> &amp;gt; &lt;strong>HDX 策略&lt;/strong> &amp;gt; &lt;strong>用户&lt;/strong>中，点击&lt;strong>新建&lt;/strong>USB 设备重定向策略。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://support.citrix.com/article/html/images/CTX136751-4.gif"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>点击下一步，&lt;strong>类别&lt;/strong>中选择&lt;strong>USB 设备&lt;/strong> &amp;gt; &lt;strong>客户端 USB 设备重定向，&lt;strong>点击&lt;/strong>添加&lt;/strong>，选择&lt;strong>允许&lt;/strong>后&lt;strong>确定&lt;/strong>。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://support.citrix.com/article/html/images/CTX136751-5.gif"
loading="lazy"
>&lt;/p>
&lt;p>然后，类别中选择 USB 设备 &amp;gt; 客户端 USB 设备重定向规则，点击添加&lt;/p>
&lt;p>&lt;img src="http://support.citrix.com/article/html/images/CTX136751-6.gif"
loading="lazy"
>&lt;/p>
&lt;p>点击&lt;strong>新建&lt;/strong>添加允许的 Hardware ID：&lt;/p>
&lt;p>&lt;img src="http://support.citrix.com/article/html/images/CTX136751-7.gif"
loading="lazy"
>&lt;/p>
&lt;p>&lt;strong>确定&lt;/strong>后点击&lt;strong>下一步&lt;/strong>，最后&lt;strong>应用&lt;/strong>此策略。&lt;/p>
&lt;ul>
&lt;li>在终端设备，查看注册表 HKLM\Software_WOW6432Node*\Citrix\Ica Client\GenericUSB，设置_DeviceRules*值为‘Allow: VID=0911 PID=1844’&lt;/li>
&lt;/ul>
&lt;p>你可以删除&lt;em>deny class rule&lt;/em>以使能此 class 的所有设备。但是，为防止非法重定向，增加&lt;strong>Allow&lt;/strong>规则方法更优。&lt;/p>
&lt;p>&lt;strong>注意：&lt;strong>当增加&lt;/strong>Allow&lt;/strong>规则，确保它置于规则列表顶部，使它比规则&lt;strong>Deny&lt;/strong>优先级更高。&lt;/p>
&lt;p>&lt;img src="http://support.citrix.com/article/html/images/CTX136751-8.gif"
loading="lazy"
>&lt;/p>
&lt;p>此时在 Desktop Viewer 上可见对应 USB 设备。&lt;/p>
&lt;p>&lt;img src="http://support.citrix.com/article/html/images/CTX136751-9.gif"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>假如点击设备仍不能映射至会话中，尝试手动在 VDA 的注册表中添加允许标记：
HKLM\Software\Policies\Citrix\ICA_Client\USB\DeviceRules。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>更多信息&lt;/strong>&lt;/p>
&lt;p>默认值存储于 VDA 注册表的 HKLM\SOFTWARE\Citrix\PortICA\GenericUSB Type=String Name=&amp;ldquo;DeviceRules&amp;rdquo;，但是，不建议修改此值，因为当 VDA 自检，它首先查看 HKLM\Software\Policies\Citrix\ICA_Client\USB\DeviceRules，再查看本地路径。优选修改规则方法是使用组管理对象（GPO）模板。&lt;/p>
&lt;p>**注意：**你必须修改终端客户机注册表以允许对应的 USB class。&lt;/p>
&lt;p>查看更多: &lt;a class="link" href="http://support.citrix.com/proddocs/topic/xendesktop-rho/ps-ref-policies-usb-devices.html" target="_blank" rel="noopener"
>http://support.citrix.com/proddocs/topic/xendesktop-rho/ps-ref-policies-usb-devices.html&lt;/a>&lt;/p></description></item><item><title>XenDesktop虚拟桌面精品书籍导读(part1)</title><link>https://martinliu.cn/2013/04/09/xendesktope8999ae68b9fe6a18ce99da2e7b2bee59381e4b9a6e7b18de5afbce8afbb-p1/</link><pubDate>Tue, 09 Apr 2013 02:19:37 +0000</pubDate><guid>https://martinliu.cn/2013/04/09/xendesktope8999ae68b9fe6a18ce99da2e7b2bee59381e4b9a6e7b18de5afbce8afbb-p1/</guid><description>&lt;p>[box color=&amp;ldquo;orange&amp;rdquo; icon=&amp;ldquo;flag&amp;rdquo;]
感谢 Eric Yao 的供稿，&lt;a class="link" href="http://weibo.com/ericyaozhen" target="_blank" rel="noopener"
>@老树皮 Eric&lt;/a>
[/box]&lt;/p>
&lt;p>桌面虚拟化项目的实施白皮书  《Citrix Virtual Desktop Handbook 5.x》，&lt;a class="link" href="http://support.citrix.com/article/CTX136546" target="_blank" rel="noopener"
>点击下载&lt;/a>。该文档是由 Citrix 全球顶级 Consultant 系统架构师 Daniel Feller, Thomas Berger, Rich Meesters, Matt Brooks, Ed Duncan 以及 Roger LaMarca 等大牛合作完成，它介绍了桌面虚拟化架构设计、方法论、经验总结以及最佳实践等知识，更是包含了一步一步指导手册、真实案例分析以及模板手册等。&lt;/p>
&lt;p>序言：关于方法论
一、 Access
二、 Design
三、 Deploy
四、 Manitain
五、 项目计划&lt;/p>
&lt;p>第一部分：Access
一、 业务驱动力
二、 数据搜集
三、 用户数据搜集
四、 应用程序数据搜集
五、 用户分类&lt;/p>
&lt;ol>
&lt;li>FlexCast 模型比较&lt;/li>
&lt;li>FlexCast 模型选择
六、 应用程序评估
七、 项目管理&lt;/li>
&lt;li>Roadmap&lt;/li>
&lt;li>项目团队
a) 业务角色
b) 技术角色&lt;/li>
&lt;/ol>
&lt;p>第二部分：Design
一、 概况
二、 用户层 User Layer&lt;/p>
&lt;ol>
&lt;li>终端类型的选择&lt;/li>
&lt;li>Receiver 的选择&lt;/li>
&lt;li>资源需求
三、 访问层 Access Layer&lt;/li>
&lt;/ol>
&lt;p>序言：关于方法论&lt;/p>
&lt;p>Citrix Virtual Desktop handbook 会紧密遵循 Citrix 顾问实施方法论，即如下图所示：&lt;/p>
&lt;p>一、 Access&lt;/p>
&lt;p>Access 阶段主要提供 Design 阶段所需要的信息，包括：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>业务驱动力；&lt;/p>
&lt;/li>
&lt;li>
&lt;p>数据搜集：包括用户、应用程序、设备以及基础架构；&lt;/p>
&lt;/li>
&lt;li>
&lt;p>用户的分类：用户要根据需要的分类而分成不同的组别，随之应对着不同的 FlexCast 方法论；&lt;/p>
&lt;/li>
&lt;li>
&lt;p>应用程序分类：旧的应用程序应该被删除、应用程序版本应该标准化、非公司程序应该删除，等等这些构成了应用程序的标准化和合理化；&lt;/p>
&lt;/li>
&lt;li>
&lt;p>计划：每个用户组都要根据对业务的影响程度指定不同的实施时间优先级，优先级实施进度结果应该随时更新项目进度和计划。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>二、 Design&lt;/p>
&lt;p>设计阶段主要聚焦在五层的一个方法论上：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>用户层：描述推荐的终端以及所需要的用户功能体验；&lt;/p>
&lt;/li>
&lt;li>
&lt;p>访问层：描述用户层是如何连接到他们的桌面，例如本地桌面是直接连接 StoreFront，而外界用户往往要通过 Firewall 层才能进来，这就涉及到了 FW、VPN 等技术；&lt;/p>
&lt;/li>
&lt;li>
&lt;p>桌面层：主要指用户的虚拟桌面实现技术，即 FlexCast 技术，主要好汉三个主要成分，分别是镜像文件、应用程序，以及个性化内容；&lt;/p>
&lt;/li>
&lt;li>
&lt;p>控制层：如何管理和维护其他层，又分为访问控制、桌面控制，以及基础架构控制；&lt;/p>
&lt;/li>
&lt;li>
&lt;p>硬件层：致力于支撑整个解决方案的硬件物理设备，包括了服务器、CPU、内存、存储设备等；&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>三、 Deploy&lt;/p>
&lt;p>按照第二部分设计好的 FlexCast 方式实施。&lt;/p>
&lt;p>四、 Manitain&lt;/p>
&lt;p>主要包含三种不同的活动：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>监控：在虚拟桌面环境设计和实施到生产环境以后，持续的监控是必需的。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>技术支持；&lt;/p>
&lt;/li>
&lt;li>
&lt;p>测试和变更管理：以后会遇到不断的软件和产品更新；&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>五、 项目计划&lt;/p>
&lt;p>一个设计详尽的项目计划对项目成功的实施时至关重要的。项目经理要通过项目计划来监控成本、管理项目组成员、跟进项目实施进度等。同时项目进度要及时通告项目组所有成员让大家都知道项目的进度。&lt;/p>
&lt;p>在项目的初期一般只需要做 Access 阶段的计划，这个时段需要多 FlexCast 模式、容量、用户分组等有更多的交接，所以无需做 Design 的计划。如下图所示就是一个计划表：&lt;/p>
&lt;p>第一部分：Access&lt;/p>
&lt;p>一、 业务驱动力&lt;/p>
&lt;p>桌面虚拟化项目的第一步应该是去了解对公司所造成的影响，并且将这些影响定一下来，然后对之以优先级排序。有了这些文字描述管理层和项目管理组才能制定出项目成功实施的标准，设计阶段才能有正确的方法论和架构设计。&lt;/p>
&lt;p>下图就定义了一个业务驱动力的优先级示例：&lt;/p>
&lt;p>二、 数据搜集&lt;/p>
&lt;p>数据搜集阶段负责搜集关键信息数据，包括用户、设备、应用程序，以及基础架构等在下一阶段需要使用的数据。&lt;/p>
&lt;p>有三种方法来搜集数据：&lt;/p>
&lt;ol>
&lt;li>手动搜集&lt;/li>
&lt;/ol>
&lt;p>小型企业有可能通过访问每台终端，或者是远程连接凡是来搜集数据。&lt;/p>
&lt;p>中大型企业一般般都有了 ESD（Enterprise Software Deployment），例如微软的 SCCM 等。可以通过这些平台去搜集应用程序的使用情况等信息。但是 ESD 一般都不能提供应用程序性能需求和实际使用的信息。&lt;/p>
&lt;ol start="2">
&lt;li>调查表&lt;/li>
&lt;/ol>
&lt;p>这也是一个好办法，可以通过管理层去通过行政命令来执行。也可以通过面对面的会议或者是电话沟通来进行；这种方式比手动搜集要显著减少了所花费的时间，但是完成率不高也是一个缺点，不够精确反应实际情况也是一个缺点。&lt;/p>
&lt;ol start="3">
&lt;li>自动化搜集&lt;/li>
&lt;/ol>
&lt;p>这样的工具有很多，一般都能自动化生成报表。Citrix 公司为了帮助用户节省实施成本，和 LanDesk 公司合作，为 Project Accelerator 用户提供了一个 60 天免费试用的 LanDesk FastTack 软件 License。LanDesk FastTack 软件是一个专门为 Citrix 实施方法论开发设计的一个专业信息搜集工具。&lt;/p>
&lt;p>上述三种方法的优势和劣势如下表所示：&lt;/p>
&lt;p>三、 用户数据搜集&lt;/p>
&lt;p>信息搜集表可以参考示例表格：Citrix Virtual Desktop Handbook - Assess Workbook.xlsx&lt;/p>
&lt;ol>
&lt;li>业务特性&lt;/li>
&lt;/ol>
&lt;p>业务特性必须通过业务层的管理人员来手动搜集，无法自动化搜集。包括&lt;/p>
&lt;p>A. 身份&lt;/p>
&lt;p>a) 用户名&lt;/p>
&lt;p>b) 部门；&lt;/p>
&lt;p>c) 角色&lt;/p>
&lt;p>d) 业务经理&lt;/p>
&lt;p>e) 所分配的用户组；&lt;/p>
&lt;p>B. 业务&lt;/p>
&lt;p>a) 主要的数据中心&lt;/p>
&lt;p>b) 移动性，下表是示例分类&lt;/p>
&lt;p>c) 个性化&lt;/p>
&lt;p>d) 安全性&lt;/p>
&lt;p>e) 关键性&lt;/p>
&lt;ol start="2">
&lt;li>技术特性&lt;/li>
&lt;/ol>
&lt;p>a) 工作负荷&lt;/p>
&lt;ol start="3">
&lt;li>用户环境&lt;/li>
&lt;/ol>
&lt;p>a) 用户 Profile&lt;/p>
&lt;p>i. Profile 类型：包括本地、漫游、强制、第三方、未知&lt;/p>
&lt;p>ii. Profile 版本：Windows XP 和 Windows Vista/7&lt;/p>
&lt;p>iii. Profile 位置：文件服务器在哪里&lt;/p>
&lt;p>iv. 大小：用户 Profile 的大小&lt;/p>
&lt;p>b) 用户数据主目录&lt;/p>
&lt;p>i. 主目录位置&lt;/p>
&lt;p>ii. 大小&lt;/p>
&lt;ol start="4">
&lt;li>客户端硬件，包括以下需要搜集的信息：&lt;/li>
&lt;/ol>
&lt;p>o Number of CPUs/Cores&lt;/p>
&lt;p>o CPU Speed (GHz)&lt;/p>
&lt;p>o Memory (GB)&lt;/p>
&lt;p>o Disk Size (GB)&lt;/p>
&lt;p>o Operating System&lt;/p>
&lt;p>o Age of the System (years)&lt;/p>
&lt;p>o Peripherals&lt;/p>
&lt;ol start="5">
&lt;li>本地资源映射，包括以下需要搜集的信息：&lt;/li>
&lt;/ol>
&lt;p>o Local Drives&lt;/p>
&lt;p>o Printing&lt;/p>
&lt;p>o Clipboard&lt;/p>
&lt;p>o Audio&lt;/p>
&lt;p>o COM Port&lt;/p>
&lt;p>o USB&lt;/p>
&lt;p>o LPT&lt;/p>
&lt;p>四、 应用程序数据搜集&lt;/p>
&lt;p>信息搜集表可以参考示例表格：Citrix Virtual Desktop Handbook - Assess Workbook.xlsx&lt;/p>
&lt;ol>
&lt;li>身份信息&lt;/li>
&lt;/ol>
&lt;p>a) 应用程序名称和版本&lt;/p>
&lt;p>b) 应用程序所有者&lt;/p>
&lt;p>c) 状态&lt;/p>
&lt;ol start="2">
&lt;li>应用程序技术特性&lt;/li>
&lt;/ol>
&lt;p>a) 分配&lt;/p>
&lt;p>i. 使用者数量&lt;/p>
&lt;p>ii. 部门信息&lt;/p>
&lt;p>iii. 个别用户&lt;/p>
&lt;p>b) 工作负荷&lt;/p>
&lt;p>c) 业务特性&lt;/p>
&lt;p>d) 兼容性&lt;/p>
&lt;p>五、 用户分类&lt;/p>
&lt;p>一旦数据搜集工作完成之后，我们就可以开始准备将用户分成不同的组了，这个时候就要按照 FlexCast 模型的要求去分配不同的实现方式给不同的用户组了。&lt;/p>
&lt;p>我们一般都是按照人物性工作者、分支机构办公人员、移动工作者等方式去区分用户，但是实际上用户的分类远不止这几类，更有甚者，很多用户组都是同时属于上述几个组的。&lt;/p>
&lt;p>最快区分用户的方法就是按照用户的需求不同来分组，一旦将用户的需求区分之后，就可以将这些数据填入 Citrix Virtual Desktop Handbook - Assess Workbook.xlsx 了。&lt;/p>
&lt;ol>
&lt;li>FlexCast 模型比较&lt;/li>
&lt;/ol>
&lt;ol>
&lt;li>
&lt;p>Hosted Shared&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Hosted VDI，又可以细分为&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>a) Pooled-Random/Streaming&lt;/p>
&lt;p>b) Pooled-Static&lt;/p>
&lt;p>c) Pooled/Streamed with Personal vDisk&lt;/p>
&lt;p>d) Dedicated&lt;/p>
&lt;p>e) Existing&lt;/p>
&lt;p>f) Psysical/Remote PC&lt;/p>
&lt;ol start="3">
&lt;li>
&lt;p>Steamed VHD&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Local VM&lt;/p>
&lt;/li>
&lt;li>
&lt;p>On-Demand Apps&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>下表是关于 FlexCast 整体技术的一个概览：&lt;/p>
&lt;ol start="2">
&lt;li>FlexCast 模型选择&lt;/li>
&lt;/ol>
&lt;p>在 XenApp 和 XenDesktop 之间有很多技术上的区别，但是他们都是通过 HDX 来提供的最佳用户体验。他们的区别如下：&lt;/p>
&lt;p>六、 应用程序评估&lt;/p>
&lt;p>在用户分组完成之后，我们已经有了根据需求不同确定下来的不同的用户组，下一步就是向用户提供他们工作需要的应用程序。下面是建议的三部曲：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Rationalization 合理化&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Business Characteristics 业务特性&lt;/p>
&lt;/li>
&lt;li>
&lt;p>兼容性&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>七、 项目管理&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Roadmap&lt;/p>
&lt;/li>
&lt;li>
&lt;p>项目团队&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>下面的表格示例告诉我们在一个虚拟桌面项目中可以建议的业务角色和技术角色分类。虽然角色有很多种，但是很多角色的存在时间都很短，同时很多角色都由一个人同时完成。项目经理和 Citrix 架构师自然是贯穿整个项目的角色，其他就不一定了。&lt;/p>
&lt;p>a) 业务角色&lt;/p>
&lt;p>b) 技术角色&lt;/p></description></item></channel></rss>