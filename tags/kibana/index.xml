<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Kibana on Martin Liu's Blog</title><link>https://martinliu.cn/tags/kibana/</link><description>Recent content in Kibana on Martin Liu's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Tue, 25 Jun 2024 21:44:26 +0800</lastBuildDate><atom:link href="https://martinliu.cn/tags/kibana/index.xml" rel="self" type="application/rss+xml"/><item><title>Elastic 可观测性工作坊</title><link>https://martinliu.cn/blog/workshop-elastic-observability/</link><pubDate>Sat, 06 Feb 2021 10:36:12 +0800</pubDate><guid>https://martinliu.cn/blog/workshop-elastic-observability/</guid><description>&lt;img src="https://martinliu.cn/img/2021/Hubble_01.jpg" alt="Featured image of post Elastic 可观测性工作坊" />&lt;p>本工作坊包括本地虚拟机版本、AWS 和腾讯云共三个版本，目标是用实践的方式理解 Elastic 可观测性解决方案。可观测性是解决运维云原生应用的复杂性和分布式式难点的关键所在。&lt;/p>
&lt;h2 id="简介">简介
&lt;/h2>&lt;p>Elastic 可观测性解决方案是基于 Elastic Stack 的一站式解决方案。该解决方案具有完备的日志、指标、APM 和可用性采集能力，可以在大规模/云原生的环境下，完成服务质量目标（SLO）的管理。本实战工作坊基于多层架构的宠物诊所为示例应用程序，手把手的引导参与者搭建可观测性管理平台，体验分层次的收集整合、分析、关联和搜索运维数据的全过程。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/elastic-obv-solution.png"
loading="lazy"
alt="可观测性解决方案"
>&lt;/p>
&lt;h2 id="为什么要做这个工作坊">为什么要做这个工作坊？
&lt;/h2>&lt;p>从理论的理解到技术工具的实操掌握需要一个过程。&lt;/p>
&lt;ul>
&lt;li>关于可观测性的各种一小时左右的技术、方案、产品分享，完全无法让听众正确理解可观测性的相关概念&lt;/li>
&lt;li>而通过实操性质的，上机动手实验则可以让新手迅速入门，使熟手快速全面的提高&lt;/li>
&lt;li>大量 ELK 用户只使用到了日志管理的部分功能，还不了解任何一种可观测性管理方案的全貌&lt;/li>
&lt;li>社区里的朋友们对可观测性心存大量误解，如“ APM 工具就等于可观测性” 等等，因此相关的正确观念和技术急需尽快普及&lt;/li>
&lt;/ul>
&lt;p>通过半天的实战演练，彻底学会相关知识。&lt;/p>
&lt;h2 id="动手实验">动手实验
&lt;/h2>&lt;p>本工作坊的最佳参与方式是在老师的引导下，在线下/线上同步进行。其次是在视频的指导下自学。所有动手实验的目标是：理解可观测性解决方案的各个组成部分，以及为什么要使用这些工具？而且这个整个方案的实施过程和顺序也是经过精心设计的，目标是让理论和实际彻底融会贯通。&lt;/p>
&lt;p>您将会学到：&lt;/p>
&lt;ol>
&lt;li>搭建单节点 Elasticsearch 服务，并且配置好 Kibana 管理图形管理界面。&lt;/li>
&lt;li>学习可观测性的基本概念和实施步骤&lt;/li>
&lt;li>搭建和配置服务健康检查的探针&lt;/li>
&lt;li>部署采集操作系统性能监控指标的流程&lt;/li>
&lt;li>配置操作系统日志的采集和分析工具&lt;/li>
&lt;li>搭建用于 APM 追踪分析的后台服务&lt;/li>
&lt;li>运行一个多层架构的宠物商店应用，对各个子服务进行 APM 监控埋点&lt;/li>
&lt;li>配置常用的服务质量监控大屏&lt;/li>
&lt;/ol>
&lt;p>本工作坊课程基于如下的应用系统。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/16042852442364.png"
loading="lazy"
alt="架构图"
>&lt;/p>
&lt;p>应用基本概况：&lt;/p>
&lt;ul>
&lt;li>多层宠物商店应用系统&lt;/li>
&lt;li>所有组件都部署在一个虚拟机上&lt;/li>
&lt;li>包括前端、后端和内置的数据库&lt;/li>
&lt;li>使用到的技术有 JavaScript、NodeJs 和 Java Spring 等。&lt;/li>
&lt;li>本应用系统是被监控的对象&lt;/li>
&lt;/ul>
&lt;p>Elastic Stack 的基本状况：&lt;/p>
&lt;ul>
&lt;li>版本 7.9.3&lt;/li>
&lt;li>组件 Elasticsearch、Kibana、APM、Filebeat、Metricbeat 和 Heatbeat。&lt;/li>
&lt;/ul>
&lt;p>实验环境：&lt;/p>
&lt;ul>
&lt;li>本地虚拟机环境，打包好的虚拟机里包含了所有必要的软件包和演示应用。&lt;/li>
&lt;li>AWS 云环境，本课程所使用的公共 AMI 操作系统镜像：宁夏区 &lt;code>ami-0e5a0e294902966af&lt;/code> 北京区 &lt;code>ami-0e1382088b62cb38d&lt;/code>&lt;/li>
&lt;li>腾讯云环境，基于腾讯云提供的 Elasticsearch 服务，演示用的虚拟机在制作中，稍后会发布到云市场。&lt;/li>
&lt;li>阿里云环境，基于阿里云提供的 Elasticsearch 服务的课件正在开发中。&lt;/li>
&lt;/ul>
&lt;h2 id="可观测性构建四步法">可观测性构建四步法
&lt;/h2>&lt;p>可观测性依赖于应用系统自身和监控工具平台的配合实现。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/e2e85893b5dd8014.jpeg"
loading="lazy"
alt="可观测性"
>&lt;/p>
&lt;p>分层次的构建可观测性的推荐过程如下：&lt;/p>
&lt;ol>
&lt;li>STEP0：使用 Heatbeat 构建轻量灵活的服务健康检查能力&lt;/li>
&lt;li>STEP1：使用 Metricbeat 构建全面细致的指标采集能力&lt;/li>
&lt;li>STEP2：使用 Filebeat 构建高维度的日志采集能力&lt;/li>
&lt;li>STEP3：使用 APM 构建分布式应用系统的全堆栈追踪能力&lt;/li>
&lt;/ol>
&lt;p>通过以上的四个构建步骤，使用 Elastic Stack 实施四大服务质量监控能力的构建，搭建了持续统一运维管理的工具平台。&lt;/p>
&lt;p>使用 SRE 基于‘用户旅程’或‘系统边界’的 SLO 分析设定方法，从 Elastic Stack 的已有数据采集能力中，选取第批直接可用的 SLI 采集点。在基于 SLO 的监控过程中，不断的优选 SLI，调整告警的数量和质量，为开发团队提供持续有效的反馈。&lt;/p>
&lt;p>使用 Canvas 的画布功能，定制如下的 SLO 监控大屏。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2020-11-05_00-13-06.jpeg"
loading="lazy"
alt="2020-11-05_00-13-06"
>&lt;/p>
&lt;h2 id="工作坊课件">工作坊课件
&lt;/h2>&lt;p>讲师 PPT 下载： &lt;a class="link" href="https://docs.qq.com/slide/DUGRzYVVTU3ZxblBP" target="_blank" rel="noopener"
>https://docs.qq.com/slide/DUGRzYVVTU3ZxblBP&lt;/a>&lt;/p>
&lt;h3 id="本地虚拟机环境">本地虚拟机环境
&lt;/h3>&lt;p>可以使用本地的 VirtualBox 或者 VMWare 的虚拟机环境，配合以下课件完成所有练习。&lt;/p>
&lt;ol>
&lt;li>&lt;a class="link" href="https://elk-workshop.github.io/codelabs/one-nodes-es-server/#0" target="_blank" rel="noopener"
>‘Elastic Stack 单节点搭建’ 课件&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://elk-workshop.github.io/codelabs/elastic-observability-foundation/#0" target="_blank" rel="noopener"
>‘Elastic 可观测性方案’ 课件&lt;/a>&lt;/li>
&lt;/ol>
&lt;h3 id="aws-云计算环境">AWS 云计算环境
&lt;/h3>&lt;p>可以使用 AWS 云计算（中国区北京或宁夏区）环境，配合以下的课件完成所有练习。&lt;/p>
&lt;ol>
&lt;li>&lt;a class="link" href="https://elk-workshop.github.io/codelabs/one-nodes-es-server/#0" target="_blank" rel="noopener"
>‘Elastic Stack 单节点搭建’ 课件&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://elk-workshop.github.io/codelabs/elastic-observability-foundation/#0" target="_blank" rel="noopener"
>‘Elastic 可观测性方案’ 课件&lt;/a>&lt;/li>
&lt;/ol>
&lt;h3 id="腾讯云计算环境">腾讯云计算环境
&lt;/h3>&lt;p>可以使用腾讯云计环境，配合以下的课件完成所有练习。&lt;/p>
&lt;ol>
&lt;li>在本环境下，不需要搭建 Elastic Stack 的服务器，参展下面课件的第二步骤，创建 Elasticsearch 服务集群。&lt;/li>
&lt;li>&lt;a class="link" href="https://elk-workshop.github.io/codelabs/elastic-observability-foundation-qq/#0" target="_blank" rel="noopener"
>‘Elastic 可观测性方案’ 课件&lt;/a>&lt;/li>
&lt;li>腾讯云环境录播网址：&lt;a class="link" href="https://cloud.tencent.com/developer/salon/live-1304" target="_blank" rel="noopener"
>腾讯课堂查看&lt;/a>&lt;/li>
&lt;/ol>
&lt;h3 id="阿里云计算环境">阿里云计算环境
&lt;/h3>&lt;p>可以使用阿里云环境，配合以下的课件完成所有练习。&lt;/p>
&lt;blockquote>
&lt;p>课件开发中。&lt;/p>&lt;/blockquote>
&lt;h2 id="如何参与本工作坊">如何参与本工作坊？
&lt;/h2>&lt;p>本工作坊会在多个社区中举办，具体安排如下：&lt;/p>
&lt;ul>
&lt;li>定期在 Elastic 社区中举办可观测性主题的线上或者线下的社区活动，具体报名方式，
&lt;ol>
&lt;li>请关注 Elastic 公司的官方微公众号 “Elastic搜索”。&lt;/li>
&lt;li>关注 Elastic 公司社区在百格的社区活动报名网址：&lt;a class="link" href="https://www.bagevent.com/org/738410" target="_blank" rel="noopener"
>https://www.bagevent.com/org/738410&lt;/a>&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>Elasitc 用户日 专场活动，接受企业的团队预约，可以在约定的时间里，通过线上或者线下的方式进行，建议参与学习交流的人数在 10~20 人。 预约邮件： &lt;a class="link" href="mailto:zheng.liu@elastic.co" >zheng.liu@elastic.co&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>由于 Elastic Stack 产品的更新迭代速度特别快，本工作坊的软件版本和学习课件也会不定期更新。欢迎大家积极参与 Elastic 技术社区的交流和学习活动。&lt;/p></description></item><item><title>最简化 Elasticsearch &amp; Kibana &amp; Filebeat 安装说明</title><link>https://martinliu.cn/blog/elk-stack-install/</link><pubDate>Thu, 26 Mar 2020 08:51:15 +0800</pubDate><guid>https://martinliu.cn/blog/elk-stack-install/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-1.jpg" alt="Featured image of post 最简化 Elasticsearch &amp; Kibana &amp; Filebeat 安装说明" />&lt;p>&lt;img src="https://martinliu.cn/images/980-elastic-stack.jpg"
loading="lazy"
alt="elk"
>&lt;/p>
&lt;p>本文描述如何搭建一套具备用户名和密码安全认证的 Elastic Stack 系统，并开始使用 Filebeat 的基础模块实现分布式的日志收集。&lt;/p>
&lt;ul>
&lt;li>安装单节点 Elasticsearch 服务器，启用用户名和密码安全认证，并创建 TLS 数字证书备用&lt;/li>
&lt;li>安装 Kibana 服务器，并配置与 Elasticsearch 服务的连接&lt;/li>
&lt;li>安装和配置 Filebeat 代理程序，并配置 system 和 auditd 模块&lt;/li>
&lt;li>使用 Kibana 监控 Filebeat 所采集的系统日志，并监控系统的状态&lt;/li>
&lt;/ul>
&lt;p>为了使你也获得与我一致的安装和测试体验，请先下载并浏览相本文所使用的代码库：&lt;a class="link" href="https://github.com/martinliu/elastic-labs" target="_blank" rel="noopener"
>https://github.com/martinliu/elastic-labs&lt;/a>&lt;/p>
&lt;h2 id="试验环境概述和启动">试验环境概述和启动
&lt;/h2>&lt;p>本文所使用相关软件以及版本。&lt;/p>
&lt;ul>
&lt;li>macOS Catalina version 10.15.3&lt;/li>
&lt;li>Vagrant 2.2.4&lt;/li>
&lt;li>VirtalBox 6.0&lt;/li>
&lt;li>操作系统镜像: bento/centos-8 (virtualbox, 202002.04.0)&lt;/li>
&lt;li>Elastic Stack 安装包（RPM）
&lt;ul>
&lt;li>Elasticsearch 7.6.1&lt;/li>
&lt;li>Kibana 7.6.1&lt;/li>
&lt;li>Filebeat 7.6.1&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>使用 Vagrant 的目录共享功能，分享安装包到测试机的 /vagrant/rpm 目录下&lt;/li>
&lt;/ul>
&lt;p>注意事项：&lt;/p>
&lt;ol>
&lt;li>你也可以使用任何一台 CentOS 8 虚拟机或者云主机，则后续的安装命令和 rpm 安装包的路径需要有所变化。&lt;/li>
&lt;li>Vagrant 文件中定义的虚拟机配置为 4 GB 内存，建议你的操作系统最低为 8GB 内存，推荐 16GB 或者更高，&lt;/li>
&lt;li>本文也适用于 Linux 或 Windows 操作系统的 Vagrant 测试环境，需要提前下载并且准备好 bento/centos-8 的基础操作系统镜像。&lt;/li>
&lt;/ol>
&lt;p>启动测试环境。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">vagrant up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vagrant status
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="安装-elasticsearch-服务器">安装 Elasticsearch 服务器
&lt;/h2>&lt;p>SSH 登录测试虚拟机。&lt;/p>
&lt;p>&lt;code>vagrant ssh&lt;/code>&lt;/p>
&lt;p>执行 RPM 安装命令，安装 elasticsearch 服务器。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">cd&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">rpm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">rpm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">ivh&lt;/span> &lt;span class="o">./&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">7.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">x86_64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rpm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">daemon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">systemctl&lt;/span> &lt;span class="n">status&lt;/span> &lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>测试 Elasticsearch 服务是否功能正常 【 Dry run 】&lt;/p>
&lt;p>curl localhost:9200&lt;/p>
&lt;p>期待的输出类似下面。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">{
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;name&amp;#34; : &amp;#34;elk-master&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;cluster_name&amp;#34; : &amp;#34;elasticsearch&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;cluster_uuid&amp;#34; : &amp;#34;X4V2Yvc-SJ6ccjWbXQ5OmQ&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;version&amp;#34; : {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;number&amp;#34; : &amp;#34;7.6.1&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;build_flavor&amp;#34; : &amp;#34;default&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;build_type&amp;#34; : &amp;#34;rpm&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;build_hash&amp;#34; : &amp;#34;aa751e09be0a5072e8570670309b1f12348f023b&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;build_date&amp;#34; : &amp;#34;2020-02-29T00:15:25.529771Z&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;build_snapshot&amp;#34; : false,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;lucene_version&amp;#34; : &amp;#34;8.4.0&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;minimum_wire_compatibility_version&amp;#34; : &amp;#34;6.8.0&amp;#34;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;minimum_index_compatibility_version&amp;#34; : &amp;#34;6.0.0-beta1&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> },
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#34;tagline&amp;#34; : &amp;#34;You Know, for Search&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>浏览和学习 Elasticsearch 默认的配置文件。&lt;/p>
&lt;p>&lt;code>sudo cat /etc/elasticsearch/elasticsearch.yml&lt;/code>&lt;/p>
&lt;p>使用 Elasticsearch 的精简版目标测试配置文件。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/elasticsearch/elasticsearch.yml /etc/elasticsearch/elasticsearch.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl restart elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status elasticsearch.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>手工查看 Elasticsearch 服务器的日志，并确认服务启动正常。&lt;/p>
&lt;p>&lt;code>sudo tail -f /var/log/elasticsearch/my-elk.log&lt;/code>&lt;/p>
&lt;p>Ctl + c 终止以上日志查看，再次测试 Elasticsearch 服务。&lt;/p>
&lt;p>&lt;code>curl localhost:9200&lt;/code>&lt;/p>
&lt;p>替换为 IP 地址测试。&lt;/p>
&lt;p>&lt;code>curl http://192.168.50.10:9200/&lt;/code>&lt;/p>
&lt;h2 id="配置-elasticsearch-服务的-tls-数字证书和身份验证">配置 Elasticsearch 服务的 TLS 数字证书和身份验证
&lt;/h2>&lt;p>停止 Elasticsearch 服务。&lt;/p>
&lt;p>&lt;code>sudo systemctl stop elasticsearch.service&lt;/code>&lt;/p>
&lt;h3 id="创建-tls-数字证书">创建 TLS 数字证书
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd /usr/share/elasticsearch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo bin/elasticsearch-certutil cert -out /etc/elasticsearch/elastic-certificates.p12 -pass &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo chmod 660 /etc/elasticsearch/elastic-certificates.p12
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="更新-elasticsearch-配置文件">更新 Elasticsearch 配置文件
&lt;/h3>&lt;p>手工打开 Elasticsearch 配置文件。&lt;/p>
&lt;p>&lt;code>sudo vi /etc/elasticsearch/elasticsearch.yml&lt;/code>&lt;/p>
&lt;p>在配置文件的末端增加下面的配置段落。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------- TLS and Cert ---------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.enabled: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.transport.ssl.enabled: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.transport.ssl.verification_mode: certificate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.transport.ssl.keystore.path: elastic-certificates.p12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xpack.security.transport.ssl.truststore.path: elastic-certificates.p12
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>重新启动配置 Elasticsearch 服务。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo systemctl restart elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status elasticsearch.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>确认服务已经正常启动。&lt;/p>
&lt;p>&lt;code>sudo tail -f /var/log/elasticsearch/my-elk.log&lt;/code>&lt;/p>
&lt;h3 id="创建-elasticsearch-服务的用户密码">创建 Elasticsearch 服务的用户密码
&lt;/h3>&lt;p>运行 Elasticsearch 的密码配置工具，为各种内置用户生成随机的密码。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo cd /usr/share/elasticsearch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo bin/elasticsearch-setup-passwords auto
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将生成的密码信息妥善保存备用。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Changed password &lt;span class="k">for&lt;/span> user apm_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD &lt;span class="nv">apm_system&lt;/span> &lt;span class="o">=&lt;/span> AHyg5HzJRZg8Fiva0buW
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password &lt;span class="k">for&lt;/span> user kibana
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD &lt;span class="nv">kibana&lt;/span> &lt;span class="o">=&lt;/span> Kt72IXkiarlGr7do02Yp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password &lt;span class="k">for&lt;/span> user logstash_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD &lt;span class="nv">logstash_system&lt;/span> &lt;span class="o">=&lt;/span> Q9nnlOdf6V9kyPbbhqN7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password &lt;span class="k">for&lt;/span> user beats_system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD &lt;span class="nv">beats_system&lt;/span> &lt;span class="o">=&lt;/span> bLNrZDggPKRSKc35EG32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password &lt;span class="k">for&lt;/span> user remote_monitoring_user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD &lt;span class="nv">remote_monitoring_user&lt;/span> &lt;span class="o">=&lt;/span> o1pi2yTDnhrKBGcS6xqP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changed password &lt;span class="k">for&lt;/span> user elastic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PASSWORD &lt;span class="nv">elastic&lt;/span> &lt;span class="o">=&lt;/span> RO11xymgXTCD16ivTP33
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在浏览器中访问&lt;a class="link" href="http://192.168.50.10:9200/" target="_blank" rel="noopener"
>http://192.168.50.10:9200/&lt;/a> ，测试并确认上面的 elastic 用户的密码。&lt;/p>
&lt;h2 id="安装和配置-kibana-服务器">安装和配置 Kibana 服务器
&lt;/h2>&lt;p>执行 Kibana 安装命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd /vagrant/rpm/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rpm -ivh kibana-7.6.1-x86_64.rpm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看并学习 Kibana 默认配置文件&lt;/p>
&lt;p>&lt;code>sudo cat /etc/kibana/kibana.yml&lt;/code>&lt;/p>
&lt;p>更新默认配置文件，准备好 elastic 用户的密码，将其更新到 Kibana 配置文件中。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/kibana/kibna.yml /etc/kibana/kibana.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start kibana.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status kibana.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看重启的服务是否工作正常。&lt;/p>
&lt;p>&lt;code>sudo tail -f /var/log/messages&lt;/code>&lt;/p>
&lt;p>在浏览器里测试登录 Kibana &lt;a class="link" href="http://192.168.50.10:5601" target="_blank" rel="noopener"
>http://192.168.50.10:5601&lt;/a> ，使用 elastic 的用户名和密码。&lt;/p>
&lt;h2 id="安装-filebeat-并配置-2-个模块">安装 filebeat 并配置 2 个模块
&lt;/h2>&lt;p>执行 Filebeat 安装包。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd /vagrant/rpm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rpm -ivh ./filebeat-7.6.1-x86_64.rpm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看默认的 Filebeat 配置文件。&lt;/p>
&lt;p>&lt;code>sudo cat /etc/filebeat/filebeat.yml&lt;/code>&lt;/p>
&lt;p>更新默认配置文件，准备好 elastic 用户的密码，将其更新到 Kibana 配置文件中。&lt;/p>
&lt;p>&lt;code>sudo cp /vagrant/filebeat/filebeat.yml /etc/filebeat/filebeat.yml&lt;/code>&lt;/p>
&lt;p>查看 Filebeat 的默认日志监控模块。&lt;/p>
&lt;p>&lt;code>sudo filebeat modules list&lt;/code>&lt;/p>
&lt;p>启用 Filebeat 的 System 和 Auditd 模块，监控系统日志和基础的操作系统安全信息。&lt;/p>
&lt;p>&lt;code>sudo filebeat modules enable system auditd&lt;/code>&lt;/p>
&lt;p>查看 Filebeat 监控模块的配置文件。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo cd /etc/filebeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo ls -l modules.d/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>建议查看以上启用的 System 和 Auditd 模块的配置文件。&lt;/p>
&lt;p>运行 Filebeat 在后台的初始化命令，在后台创建 Filebeat 所需要的索引 filebeat-* ，并导入所有模块相关的 Dashboard 等 Kibana 日志可视化分析工具。&lt;/p>
&lt;p>&lt;code>sudo filebeat setup&lt;/code>&lt;/p>
&lt;p>在浏览器中登录 &lt;a class="link" href="http://192.168.50.10:5601" target="_blank" rel="noopener"
>http://192.168.50.10:5601&lt;/a> Kibana 后，点击左侧的 Dashboard 图标，查看所有刚才导入的内容，搜索并打开 System 关键字的 Dasboard。&lt;/p>
&lt;p>在启动日志收集代理 Filebeat 服务前，运行一下命令测试 Filebeat 配置文件的正确性。&lt;/p>
&lt;p>&lt;code>sudo filebeat test config&lt;/code>&lt;/p>
&lt;p>启动 Filebeat 服务，开始对这台操作系统的日志进行监控。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo systemctl start filebeat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status filebeat
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="建议的测试">建议的测试
&lt;/h2>&lt;ol>
&lt;li>点击左侧的 Dicovery 图标，选中 Filebeat-* 索引，打开并一条日志数据，并查看所有字段；用 KQL 进行全文搜索。&lt;/li>
&lt;li>点击左侧的 Dashboard 图标，搜索 system 关键字，查看一个仪表板的日志展示；搜索 audit 关键字，并查打开一个仪表板，在命令行中尝试 ssh localhost，多尝试几次，刷新 Audit 仪表板，观察数据是否发生了变化。&lt;/li>
&lt;li>点击左侧的 Logs 图标，用鼠标上下滚动日志信息流， 点击右上角的开始 Live Stream 查看模式，观察日志信息流的自动滚动效果，在 KQL 搜素框中输入 tags : demo-service ，体验它的搜索建议功能，在 Highlight 中输入 &lt;a class="link" href="http://192.168.50.10:5601/app/infra" target="_blank" rel="noopener"
>http://192.168.50.10:5601/app/infra&lt;/a> ，观察日志信息流显示的变化。&lt;/li>
&lt;li>点击左侧的 SIEM 图标，看看这里都有什么内容。&lt;/li>
&lt;/ol>
&lt;h2 id="后续">后续
&lt;/h2>&lt;ul>
&lt;li>用启用 Filebeat 的 Elasticsearch, Kibana 日志监控模块&lt;/li>
&lt;li>安装 Apache, MySQL 等软件，并开启 Filebeat 的日志监控模块&lt;/li>
&lt;/ul>
&lt;p>参考文档：
&lt;a class="link" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setting-system-settings.html" target="_blank" rel="noopener"
>https://www.elastic.co/guide/en/elasticsearch/reference/current/setting-system-settings.html&lt;/a>&lt;/p></description></item></channel></rss>