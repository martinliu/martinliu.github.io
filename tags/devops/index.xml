<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>DevOps on Martin Liu's Blog</title><link>https://martinliu.cn/tags/devops/</link><description>Recent content in DevOps on Martin Liu's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 21 Aug 2025 17:36:56 +0800</lastBuildDate><atom:link href="https://martinliu.cn/tags/devops/index.xml" rel="self" type="application/rss+xml"/><item><title>Grafana 12.1 正式发布！</title><link>https://martinliu.cn/blog/grafana-12-1-release-all-the-latest-features/</link><pubDate>Tue, 29 Jul 2025 14:34:27 +0800</pubDate><guid>https://martinliu.cn/blog/grafana-12-1-release-all-the-latest-features/</guid><description>&lt;img src="https://martinliu.cn/blog/grafana-12-1-release-all-the-latest-features/grafana-12.1-meta.png" alt="Featured image of post Grafana 12.1 正式发布！" />&lt;p>最新版本带来了多项新功能，简化了 &lt;strong>Grafana 实例（Grafana instances）&lt;/strong> 的管理方式，也优化了 &lt;strong>告警规则（alert rules）&lt;/strong> 的管理体验，方便你快速定位所需的告警内容。此外还有更多改进。&lt;/p>
&lt;p>以下是本次 Grafana 版本的一些亮点。如果你想了解本次发布的全部更新内容，请参考 &lt;a class="link" href="https://github.com/grafana/grafana/blob/main/CHANGELOG.md" target="_blank" rel="noopener"
>更新日志&lt;/a> 或 &lt;a class="link" href="https://grafana.com/docs/grafana/latest/whatsnew/whats-new-in-v12-1/?pg=blog&amp;amp;plcmt=body-txt&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>新版功能文档&lt;/a>。&lt;/p>
&lt;h2 id="grafana-advisor智能化运维监控">Grafana Advisor：智能化运维监控
&lt;/h2>&lt;p>我们一直在探索降低运维负担的方法，帮助你更高效地进行维护与故障排查。因此，在 Grafana 12.1 中，我们很高兴地宣布 &lt;a class="link" href="https://grafana.com/whats-new/2025-07-22-keep-instances-running-smoothly-with-grafana-advisor/?pg=blog&amp;amp;plcmt=body-txt&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>Grafana Advisor&lt;/a> —— 一个用于帮助管理员保持 Grafana 实例稳定和安全运行的监控工具 —— 现已进入公开预览阶段。&lt;/p>
&lt;p>&lt;strong>Grafana Advisor&lt;/strong> 最初在 Grafana 12 中作为实验性功能推出，如今它能够自动对你的 Grafana 服务器执行定期健康检查，提供可操作的洞见与建议，帮助你维持系统的最佳运行状态。&lt;/p>
&lt;p>目前，&lt;strong>Grafana Advisor&lt;/strong> 会定期检查 &lt;strong>数据源连接（data source connections）&lt;/strong>、&lt;strong>插件（plugins）&lt;/strong> 和 &lt;strong>SSO 设置（SSO settings）&lt;/strong>，未来版本中我们计划扩展其功能范围。&lt;/p>
&lt;p>在 &lt;strong>Grafana Cloud&lt;/strong> 中，Advisor 默认启用。若要在 &lt;strong>Grafana OSS&lt;/strong> 与 &lt;strong>Enterprise 版&lt;/strong> 中启用该功能，可通过配置开关 &lt;code>grafanaAdvisor&lt;/code> 实现。详情请参见我们的 &lt;a class="link" href="https://grafana.com/docs/grafana/latest/administration/grafana-advisor/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>技术文档&lt;/a>。&lt;/p>
&lt;h2 id="告警功能的重大升级">告警功能的重大升级
&lt;/h2>&lt;p>告警是任何可观测性策略中的关键组成部分。在 Grafana 12.1 中，我们带来了几项新的告警功能，包括重新设计的 &lt;strong>告警规则列表页面（alert rule list page）&lt;/strong>，帮助你以更可扩展、直观的方式管理告警。&lt;/p>
&lt;h3 id="全新设计的告警规则列表页面">全新设计的告警规则列表页面
&lt;/h3>&lt;p>&lt;em>适用于所有版本的 Grafana&lt;/em>&lt;/p>
&lt;p>在 &lt;a class="link" href="https://grafana.com/docs/grafana/latest/alerting/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>Grafana Alerting&lt;/a> 中，一个 &lt;a class="link" href="https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>告警规则（alert rule）&lt;/a> 定义了触发告警的评估条件。你可能拥有数百甚至上千条这样的规则，而在本次发布中，我们通过完全 &lt;a class="link" href="https://grafana.com/whats-new/2025-07-15-alert-rule-list-page-updates/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>重新设计的规则列表页面&lt;/a> 让浏览管理更加轻松。&lt;/p>
&lt;p>新版页面整体提供了更流畅、更快捷、更灵活的使用体验。它支持两种视图模式，满足不同使用场景：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>分组视图（Grouped view）&lt;/strong>：按命名空间组织，便于深入查看特定规则组。&lt;/li>
&lt;li>&lt;strong>列表视图（List view）&lt;/strong>：展示所有告警规则的完整列表，支持快速搜索与过滤。近期的性能优化大幅提升了使用效率。&lt;/li>
&lt;/ul>
&lt;p>我们还对界面进行了简化，聚焦于“管理告警规则”这一核心任务。现在你将看到一个更简洁、更清晰的视图，仅显示最关键的信息字段，包括 &lt;strong>规则名称（rule name）&lt;/strong>、&lt;strong>所属位置（location）&lt;/strong>、&lt;strong>类型（type）&lt;/strong> 和 &lt;strong>状态（state）&lt;/strong>。&lt;/p>
&lt;p>此外，我们还为规则列表页面引入了新的分页 API，使管理操作更轻松便捷。无论你是希望查看结构化的告警规则层级，还是需要快速检索和筛选成千上万条规则，现在都能获得更简洁、更流畅的体验。&lt;/p>
&lt;p>对于 &lt;strong>Grafana Cloud 用户&lt;/strong>，我们正逐步向所有实例推出新版规则页面；对于 &lt;strong>Grafana OSS 用户&lt;/strong>，当前可通过功能开关启用。请在 Grafana 配置文件的 &lt;code>feature_toggles&lt;/code> 部分中添加开关 &lt;code>alertingListViewV2&lt;/code>：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="l">feature_toggles]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">alertingListViewV2 = true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>重启 Grafana 后，即可访问新版规则列表页面。&lt;/p>
&lt;h3 id="支持-prometheus-yaml-文件导入规则">支持 Prometheus YAML 文件导入规则
&lt;/h3>&lt;p>我们近期还 &lt;a class="link" href="https://grafana.com/docs/grafana-cloud/alerting-and-irm/alerting/alerting-rules/alerting-migration/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>新增支持&lt;/a>：可以将由数据源管理的规则导入为由 Grafana 管理的告警规则（Grafana-managed alert rules）。不过，以前用户在没有配置 ruler 的情况下，无法导入现有的 &lt;strong>Prometheus 规则（Prometheus rules）&lt;/strong>。&lt;/p>
&lt;p>而在 Grafana 12.1 中，你现在可以直接 &lt;a class="link" href="https://grafana.com/whats-new/2025-06-02-add-ability-to-import-rules-to-gma-from-prometheus-yaml/?pg=blog&amp;amp;plcmt=body-txt&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>通过 Prometheus YAML 文件导入规则&lt;/a>，并使用同一套 Alerting UI 完成配置。&lt;/p>
&lt;h3 id="引入活动时间区间active-time-intervals">引入“活动时间区间”（active time intervals）
&lt;/h3>&lt;p>在本次告警功能更新中，我们将原先的 &lt;a class="link" href="https://grafana.com/docs/grafana/latest/alerting/configure-notifications/mute-timings/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>静默时间区间（mute time intervals）&lt;/a> 重命名为 &lt;a class="link" href="https://grafana.com/whats-new/2025-07-09-active-time-intervals-in-grafana-alerting/?pg=blog&amp;amp;plcmt=body-txt&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>活动时间区间（active time intervals）&lt;/a>，以更准确地反映其用途 —— 即定义告警“何时应当触发”。&lt;/p>
&lt;p>如需进一步了解 Grafana 告警功能中的这些改动和其他更新，请查看我们的 &lt;a class="link" href="https://grafana.com/docs/grafana/latest/alerting/?pg=blog&amp;amp;plcmt=body-txt&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>官方文档&lt;/a>。&lt;/p>
&lt;h2 id="用更灵活的方式查询与可视化数据">用更灵活的方式查询与可视化数据
&lt;/h2>&lt;p>无论你是想深入分析某项指标，还是构建复杂的仪表盘，这些新功能都将帮助你以更符合需求的方式探索数据。&lt;/p>
&lt;h3 id="趋势线转换trendlines-transformation">趋势线转换（Trendlines transformation）
&lt;/h3>&lt;p>&lt;em>适用于所有版本的 Grafana&lt;/em>&lt;/p>
&lt;p>在 Grafana 中，&lt;a class="link" href="https://grafana.com/docs/grafana/latest/panels-visualizations/query-transform-data/transform-data/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>转换操作（transformations）&lt;/a> 是一种强大手段，用于在系统进行可视化之前处理查询返回的数据。Grafana 12.1 中新增了一个全新的转换类型：&lt;a class="link" href="https://grafana.com/whats-new/2025-07-21-transformations--regression-analysis/?pg=blog&amp;amp;plcmt=body-txt&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>趋势线（trendlines，也称回归分析）&lt;/a>。&lt;/p>
&lt;p>这一新转换会对任意数据集拟合一个数学函数 —— 支持线性或多项式回归 —— 以预测原始数据中未直接体现的某一时间点的数值。&lt;/p>
&lt;p>换句话说，你可以基于统计模型生成一个新序列，用于表示趋势线中的预测值。这在处理波动剧烈、难以洞察趋势的数据时尤为有用。&lt;/p>
&lt;p>你可以在 &lt;a class="link" href="https://play.grafana.org/goto/9o1-SMyNg?orgId=1&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>Grafana Play 示例&lt;/a> 中查看这一转换的实际效果，或在我们的 &lt;a class="link" href="https://grafana.com/docs/grafana-cloud/visualizations/panels-visualizations/query-transform-data/transform-data/#regression-analysis?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>文档&lt;/a> 中了解更多细节。&lt;/p>
&lt;h3 id="可视化操作中支持自定义变量">可视化操作中支持自定义变量
&lt;/h3>&lt;p>&lt;em>适用于所有版本的 Grafana&lt;/em>&lt;/p>
&lt;p>我们很高兴地宣布，你现在可以在 &lt;a class="link" href="https://grafana.com/whats-new/2025-07-14-custom-variable-support-in-visualization-actions/?pg=blog&amp;amp;plcmt=body-txt&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>可视化操作（visualization actions）中定义自定义变量&lt;/a> 了。&lt;/p>
&lt;p>当你触发一个 &lt;a class="link" href="https://grafana.com/docs/grafana/latest/panels-visualizations/configure-data-links/#actions?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>操作（action）&lt;/a>（例如调用 API 创建支持工单）时，系统会提示你填写这些变量的值。这样一来，操作变得更加动态、交互性更强，你无需修改仪表盘配置就能实时定制请求内容。&lt;/p>
&lt;p>这项功能在触发告警、过滤 API 调用，或将用户定义参数传递给外部系统时尤其有用。&lt;/p>
&lt;h3 id="仪表盘支持服务器配置的快捷时间范围">仪表盘支持服务器配置的快捷时间范围
&lt;/h3>&lt;p>&lt;em>适用于 Grafana OSS 与 Grafana Enterprise&lt;/em>&lt;/p>
&lt;p>Grafana 服务器管理员现在可以为仪表盘的 &lt;a class="link" href="https://grafana.com/grafana/plugins/williamvenner-timepickerbuttons-panel/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>时间选择器（time picker）&lt;/a> 定义自定义的时间范围预设。这一功能非常适合那些需要经常分析特定上下文时间窗口的团队。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/grafana-12-1-release-all-the-latest-features/screenshot-custom-time-ranges-12-1.png"
width="594"
height="517"
srcset="https://martinliu.cn/blog/grafana-12-1-release-all-the-latest-features/screenshot-custom-time-ranges-12-1_hu_a241bb434e2a8f79.png 480w, https://martinliu.cn/blog/grafana-12-1-release-all-the-latest-features/screenshot-custom-time-ranges-12-1_hu_6a0f3af3c36a678c.png 1024w"
loading="lazy"
alt="服务器配置时间范围的截图"
class="gallery-image"
data-flex-grow="114"
data-flex-basis="275px"
>&lt;/p>
&lt;p>&lt;em>服务器配置时间范围的截图&lt;/em>&lt;/p>
&lt;p>只需在你的 &lt;a class="link" href="https://grafana.com/docs/grafana/next/setup-grafana/configure-grafana/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>服务器配置&lt;/a> 文件中配置 &lt;code>[time_picker] quick_ranges&lt;/code>，即可根据监控数据的实际情况设置全局默认值。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="l">time_picker]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="l">quick_ranges = &amp;#34;&amp;#34;&amp;#34;[&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>{&lt;span class="s2">&amp;#34;from&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;now-6s&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;to&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;now&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;display&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;Last 6 seconds&amp;#34;&lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>{&lt;span class="s2">&amp;#34;from&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;now-10m&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;to&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;now&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;display&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;Last 10 minutes&amp;#34;&lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>{&lt;span class="s2">&amp;#34;from&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;now-25h&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;to&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;now&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;display&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;Last 24 hours&amp;#34;&lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>{&lt;span class="s2">&amp;#34;from&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;now/w&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;to&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;now/w&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;display&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;This week&amp;#34;&lt;/span>}&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>{&lt;span class="s2">&amp;#34;from&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;now-1w/w&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;to&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;now-1w/w&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;display&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s2">&amp;#34;Last week&amp;#34;&lt;/span>}&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="l">&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>特别感谢社区成员 Chris Hodges &lt;a class="link" href="https://github.com/grafana/grafana/pull/102254" target="_blank" rel="noopener"
>为该功能贡献代码&lt;/a>！&lt;/p>
&lt;h3 id="增强的自定义货币格式">增强的自定义货币格式
&lt;/h3>&lt;p>&lt;em>适用于所有版本的 Grafana&lt;/em>&lt;/p>
&lt;p>你现在可以 &lt;a class="link" href="https://grafana.com/whats-new/2025-06-12-enhanced-custom-currency-format--display-exact-financial-values/?pg=blog&amp;amp;plcmt=body-txt&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>显示精确的财务数值&lt;/a>（或按需缩写），以便更灵活地控制仪表盘中的展示方式。&lt;/p>
&lt;p>此前，Grafana 会自动缩写较大的货币数值 —— 例如 &lt;code>$1,235,667&lt;/code> 会显示为 &lt;code>$1.24M&lt;/code>，&lt;code>$555,558&lt;/code> 会变成 &lt;code>$555.6K&lt;/code>。虽然这种方式适用于大多数可视化场景，但财务数据往往需要显示精确数值。&lt;/p>
&lt;p>为此，我们增强了自定义货币格式。你现在可以使用 &lt;code>currency:financial:&amp;lt;unit&amp;gt;&lt;/code> 格式完整显示数字。例如：使用 &lt;code>currency:financial:$&lt;/code> 会将 &lt;code>1235667&lt;/code> 格式化为 &lt;code>$1,235,667&lt;/code>，而非 &lt;code>$1.24M&lt;/code>。&lt;/p>
&lt;p>财务格式还支持灵活的货币符号位置，包括：&lt;/p>
&lt;p>&lt;strong>前缀&lt;/strong>（默认）：&lt;code>currency:financial:$&lt;/code> 会显示为 &lt;code>$1,235,667&lt;/code>&lt;/p>
&lt;p>&lt;strong>后缀&lt;/strong>：&lt;code>currency:financial:€:suffix&lt;/code> 会显示为 &lt;code>1,235,667€&lt;/code>&lt;/p>
&lt;h3 id="microsoft-entra-workload-identity-支持">Microsoft Entra Workload Identity 支持
&lt;/h3>&lt;p>&lt;em>适用于所有版本的 Grafana&lt;/em>&lt;/p>
&lt;p>Grafana 现在 &lt;a class="link" href="https://grafana.com/whats-new/2025-07-15-entra-workload-identity-support/?pg=blog&amp;amp;plcmt=body-txt&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>支持 Microsoft Entra Workload Identity&lt;/a>，显著增强了基于联合凭据的身份验证能力。该更新简化了 OAuth 流程，并提升了在 Microsoft Azure 上运行 Grafana 实例的安全性。&lt;/p>
&lt;p>关于 Entra ID（前身为 Azure AD）身份验证配置的更多信息，请参见我们的 &lt;a class="link" href="https://grafana.com/docs/grafana/next/setup-grafana/configure-security/configure-authentication/azuread/?pg=blog&amp;amp;plcmt=body-txt&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>官方文档&lt;/a>。感谢社区成员 &lt;a class="link" href="https://github.com/mehighlow" target="_blank" rel="noopener"
>mehiglow&lt;/a> 对该功能的宝贵贡献！&lt;/p>
&lt;h2 id="grafana-扩展性数据源新增功能">Grafana 扩展性：数据源新增功能
&lt;/h2>&lt;p>在 Grafana Labs，我们始终相信 —— 不论你的数据存储在哪里，你都应该能够查询和可视化它。因此，我们持续扩展并改进 Grafana 的数据源支持能力。&lt;/p>
&lt;p>以下是最新的数据源相关更新。&lt;/p>
&lt;h3 id="可视化-logicmonitor-数据">可视化 LogicMonitor 数据
&lt;/h3>&lt;p>&lt;a class="link" href="https://www.logicmonitor.com/" target="_blank" rel="noopener"
>LogicMonitor&lt;/a> 是一个可观测性平台，提供基础设施监控、AIOps 和 IT 运维洞察。现已进入公开预览阶段，全新的 &lt;a class="link" href="https://grafana.com/grafana/plugins/grafana-logicmonitor-datasource/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>LogicMonitor Devices Enterprise 数据源&lt;/a> 让你可以在 Grafana Cloud 或 Grafana Enterprise 中直接查询与可视化 &lt;code>Device Instance Data&lt;/code>，以及列出 &lt;code>Devices&lt;/code>、&lt;code>Datasources&lt;/code> 和 &lt;code>Instances&lt;/code>。&lt;/p>
&lt;p>你可以在我们的 &lt;a class="link" href="https://grafana.com/docs/plugins/grafana-logicmonitor-datasource/latest/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>官方文档&lt;/a> 中了解如何使用与安装该数据源。如需全面了解 Enterprise 数据源，请参考这篇 &lt;a class="link" href="https://grafana.com/blog/2024/05/13/grafana-enterprise-data-source-plugins-a-brief-guide-to-what-they-are-and-how-to-get-started/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>指南&lt;/a>。&lt;/p>
&lt;h3 id="bigquery-数据源支持服务账号模拟service-account-impersonation">BigQuery 数据源支持服务账号模拟（Service Account Impersonation）
&lt;/h3>&lt;p>为提升安全性，Google 建议使用服务账号令牌配合 &lt;a class="link" href="https://cloud.google.com/iam/docs/service-account-impersonation" target="_blank" rel="noopener"
>服务账号模拟（Service Account Impersonation）&lt;/a>。一旦服务账号令牌遭到泄露，若未关联可模拟的服务账号，该令牌将无法访问 Google Cloud API，从而显著降低未授权访问的风险。&lt;/p>
&lt;p>这一额外的安全层级现已在我们的 &lt;a class="link" href="https://grafana.com/grafana/plugins/grafana-bigquery-datasource/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>BigQuery 数据源&lt;/a> 配置中 &lt;a class="link" href="https://grafana.com/whats-new/2025-06-18-support-for-service-account-impersonation-in-bigquery/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>正式支持&lt;/a>，可有效防止令牌泄露后被滥用。目前该功能已全面开放。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/grafana-12-1-release-all-the-latest-features/bigquery-service-account-impersonation.png"
width="1388"
height="476"
srcset="https://martinliu.cn/blog/grafana-12-1-release-all-the-latest-features/bigquery-service-account-impersonation_hu_240ed6ee3e0fbace.png 480w, https://martinliu.cn/blog/grafana-12-1-release-all-the-latest-features/bigquery-service-account-impersonation_hu_2d64300ee7a6bafb.png 1024w"
loading="lazy"
alt="服务账号模拟开关的截图"
class="gallery-image"
data-flex-grow="291"
data-flex-basis="699px"
>&lt;/p>
&lt;p>你可以通过我们的 &lt;a class="link" href="https://grafana.com/grafana/plugins/grafana-bigquery-datasource/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>插件目录&lt;/a> 或这篇 &lt;a class="link" href="https://grafana.com/blog/2025/06/18/visualize-google-cloud-bigquery-data-in-grafana-the-latest-updates-key-features-and-more/?src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>最新博客文章&lt;/a> 深入了解 Grafana 中 BigQuery 数据源的使用方式。&lt;/p>
&lt;p>如需查看 Grafana 中全部新增功能，请参阅我们的 &lt;a class="link" href="https://grafana.com/docs/grafana/latest/?pg=blog&amp;amp;plcmt=body-txt&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>官方文档&lt;/a>、&lt;a class="link" href="https://github.com/grafana/grafana/blob/main/CHANGELOG.md" target="_blank" rel="noopener"
>更新日志&lt;/a>，或 &lt;a class="link" href="https://grafana.com/docs/grafana/latest/whatsnew/whats-new-in-v12-1/?pg=blog&amp;amp;plcmt=body-txt&amp;amp;src=li&amp;amp;mdm=social&amp;amp;camp=blog" target="_blank" rel="noopener"
>新版亮点文档&lt;/a>。&lt;/p></description></item><item><title>2024 年 Gartner 可观测性平台魔力象限</title><link>https://martinliu.cn/blog/2024-magic-quadrant-for-observability-platforms/</link><pubDate>Thu, 15 Aug 2024 10:04:45 +0800</pubDate><guid>https://martinliu.cn/blog/2024-magic-quadrant-for-observability-platforms/</guid><description>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-observability-platforms/pexels-pavel-danilyuk-9143804.jpg" alt="Featured image of post 2024 年 Gartner 可观测性平台魔力象限" />&lt;p>可观测性平台通过分析、可视化、自动化以及 AI 技术，将遥测数据转化为可执行的洞察。虽然大多数平台都包括应用性能监控（APM）功能，但仅靠 APM 是不够的。I&amp;amp;O 领导者可以参考此研究，探索相关供应商及解决方案。&lt;/p>
&lt;h2 id="市场定义与描述">市场定义与描述
&lt;/h2>&lt;p>Gartner 将可观测性平台定义为：能够从日志、指标、事件和追踪等多种来源获取遥测数据（运营数据）的产品。它们旨在帮助企业了解应用、服务及基础设施的健康状况、性能表现，及行为趋势。可观测性平台可以通过人工操作或机器智能分析遥测数据，识别影响终端用户体验的系统行为变化，例如服务中断或性能下降。这些平台可以让问题在早期，甚至是预防阶段就得到解决。可观测性解决方案被广泛的应用于 IT 运营/运维、站点稳定性工程师/SRE、云与平台团队、应用开发人员，以及产品负责人。&lt;/p>
&lt;p>现代企业高度依赖关键的数字应用和服务，这些应用和服务不仅是创收工具，还直接影响客户体验和企业运营效率。中断、性能下降和不稳定现象都会直接冲击企业的营收、客户满意度及品牌形象。&lt;/p>
&lt;p>可观测性平台能帮助企业提升关键应用和服务的可用性、性能和恢复力。成功投资和部署可观测性平台能够避免收入损失，同时加快产品开发周期，改善品牌形象。&lt;/p>
&lt;p>以下是可观测性平台解决的一些典型场景或业务问题：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>IT 运营&lt;/strong>：IT 运营团队负责确保生产环境中的应用和服务始终可用、迅速响应且性能卓越，尤其是在高峰期。可观测性平台可以在问题出现时及时发出告警，并帮助团队通过数据分析找到根本原因。&lt;/li>
&lt;li>&lt;strong>平台工程&lt;/strong>：平台工程师的工作类似于 IT 运营和软件开发。可观测性平台帮助他们确保生产环境始终达到服务质量目标 (SLO)，同时推动持续的数据驱动改进与平台优化。&lt;/li>
&lt;li>&lt;strong>软件开发&lt;/strong>：开发团队将可观测性平台集成到 CI/CD 流水线中，提供新代码部署的快速反馈，加快新功能发布，同时提高产品的恢复力。&lt;/li>
&lt;li>&lt;strong>业务分析&lt;/strong>：业务分析师利用可观测性平台分析企业的关键业务指标，例如零售商可能会评估放弃购物车的成本和客户的平均消费金额。&lt;/li>
&lt;/ul>
&lt;h3 id="必备功能">必备功能
&lt;/h3>&lt;p>可观测性平台至少应具备以下基本功能：&lt;/p>
&lt;ul>
&lt;li>获取、存储并分析运营遥测数据流，数据来源包括但不限于指标、事件、日志和追踪信息。&lt;/li>
&lt;li>识别并分析应用、服务或基础设施的行为变化，从而判断是否存在可用性中断、性能下降，或是否对终端用户体验产生了影响。&lt;/li>
&lt;li>通过提供拓扑依赖关系映射和业务服务之间的关联，为遥测数据增加上下文信息，进一步丰富数据内容。&lt;/li>
&lt;/ul>
&lt;h3 id="常见功能">常见功能
&lt;/h3>&lt;p>可观测性平台通常具备以下功能：&lt;/p>
&lt;ul>
&lt;li>监控通过浏览器、移动应用和 API 提供的应用与服务的用户体验。&lt;/li>
&lt;li>与其他运营管理、服务管理和软件开发技术集成，如 IT 服务管理、配置管理数据库、事件与事故响应管理、编排与自动化及 DevOps 工具。&lt;/li>
&lt;li>从公有云平台（如 Amazon CloudWatch、Microsoft Azure Monitor 和 Google Cloud Operations）收集遥测数据。&lt;/li>
&lt;li>支持多种遥测数据类型（如追踪、指标和日志）的交互式分析，帮助深入了解用户与应用行为。&lt;/li>
&lt;li>借助高级分析与机器学习，提供基于数据的洞察，超越手动查询或分析的能力。&lt;/li>
&lt;li>自动发现并映射相关的基础设施、网络和应用组件及服务。&lt;/li>
&lt;li>支持成本管理功能，能够度量和优化应用工作负载成本，或优化可观测性平台的利用率和支出。&lt;/li>
&lt;li>业务流程与活动监控，例如用户的登录到结账流程、转化率追踪漏斗分析、客户注册或贷款申请的流程。&lt;/li>
&lt;li>提供应用安全功能，能够识别受监控应用中的已知漏洞，并阻止对这些漏洞的攻击尝试。&lt;/li>
&lt;/ul>
&lt;h2 id="魔力象限">魔力象限
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/blog/2024-magic-quadrant-for-observability-platforms/Figure-1.png"
width="570"
height="592"
srcset="https://martinliu.cn/blog/2024-magic-quadrant-for-observability-platforms/Figure-1_hu_1975c31a63051b2f.png 480w, https://martinliu.cn/blog/2024-magic-quadrant-for-observability-platforms/Figure-1_hu_8dc0e52a0a3e012f.png 1024w"
loading="lazy"
alt="图 1: Y24Q3 可观测性平台魔力象限"
class="gallery-image"
data-flex-grow="96"
data-flex-basis="231px"
>&lt;/p>
&lt;p>供应商优势与注意事项分析如下。&lt;/p>
&lt;h3 id="amazon-web-services">Amazon Web Services
&lt;/h3>&lt;p>Amazon Web Services (AWS) 在此次魔力象限中被归类为挑战者。AWS 的可观测性解决方案包括 Amazon CloudWatch、AWS X-Ray、Amazon Managed Service for Prometheus、Amazon Managed Grafana 和 AWS Distro for OpenTelemetry，支持端到端的 observability 使用场景。这些服务是 AWS Cloud Operations 的一部分，涵盖治理和财务管理。AWS 的业务遍布全球，其客户主要为大型企业，并且 AWS 定期发布和更新产品。&lt;/p>
&lt;h4 id="优势">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>应用信号&lt;/strong>：AWS 于 2023 年末推出了 CloudWatch Application Signals，这是第一个专注于应用程序监控的 CloudWatch 服务。通过此服务，运维人员可以通过设定服务质量目标 (SLO) 并使用服务视图来管理系统健康和性能，同时对出现的问题进行分类。&lt;/li>
&lt;li>&lt;strong>统一的可观测性平台&lt;/strong>：AWS 支持 OpenTelemetry、Prometheus 和 Selenium 等行业标准，提升了跨平台的互操作性。即使没有使用代理，AWS 之外的工作负载也可以通过 Managed Grafana 服务进行监控和可视化。&lt;/li>
&lt;li>&lt;strong>全球影响力&lt;/strong>：AWS 在全球范围内扩展迅速，已宣布新增四个地区和 18 个本地区域。Observability 服务全球可用，客户可以根据需求决定如何设置遥测数据在生命周期中的存储策略。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>竞争环境&lt;/strong>：尽管 AWS 可观测性工具近年来有所改进，如推出 CloudWatch Application Signals 和 Internet Monitor，但 AWS 也为本研究中的许多供应商提供托管服务，并通过 AWS Marketplace 与其合作。此种合作关系在时间上优先考虑客户选择，但与 AWS 平台的统一性存在矛盾。&lt;/li>
&lt;li>&lt;strong>成本管理&lt;/strong>：与 AWS 其他服务类似，observability 按需付费，基于多种消费模式，可能不完全适应所有运营模式或使用场景。&lt;/li>
&lt;li>&lt;strong>服务复杂性&lt;/strong>：AWS 提供多达 28 种监控与 observability 服务，尽管这展示了广泛的产品线，但也容易引起客户混淆。改进的文档有助于客户根据实际需求区分 CloudWatch 的功能。&lt;/li>
&lt;/ul>
&lt;h3 id="bmc">BMC
&lt;/h3>&lt;p>BMC 在本次魔力象限中被归类为利基参与者。其 BMC Helix Operations Management 平台提供了丰富的 ServiceOps 和 observability 功能，涵盖 BMC Helix Discovery 及其他组件。BMC 在 IT 服务管理领域中拥有重要地位，其 BMC Helix ITSM（前称 Remedy）产品以及主机解决方案有着广泛的应用。BMC 的业务覆盖全球主要市场。&lt;/p>
&lt;h4 id="优势-1">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>广泛的客户基础&lt;/strong>：作为传统的“四大” IT 运营技术供应商之一，BMC 在大型企业和政府机构中具有重要影响力。这种既有的影响力使 BMC 在向 observability 过渡时具备优势。&lt;/li>
&lt;li>&lt;strong>服务运营集成&lt;/strong>：BMC 的可观测性解决方案可以与第三方工具兼容，同时与其自身的 ITSM、发现工具和 CMDB 紧密集成，具有潜在的工具整合优势。&lt;/li>
&lt;li>&lt;strong>故障分析工具&lt;/strong>：该平台提供健康时间线和健康评分功能，帮助用户了解应用程序或服务的性能变化，还支持快速检查变化情况。它还具备“情况解释”功能，通过 BMC HelixGPT 等 AI 技术，解释问题可能的根本原因。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-1">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>产品组合复杂性&lt;/strong>：BMC 的解决方案依赖其众多产品组件，尽管可以单独授权使用，但某些功能仍需依赖自定义仪表板。例如，SLO 功能并非开箱即用。&lt;/li>
&lt;li>&lt;strong>定价不透明&lt;/strong>：BMC 未公开其定价，除非是针对政府客户或云市场的定价。这与 observability 行业的趋势不符，客户通常希望在早期获取价格信息以进行成本评估。&lt;/li>
&lt;li>&lt;strong>现有 BMC 环境&lt;/strong>：BMC 的大部分客户仍在使用其旧有技术，如 BMC PATROL 和 TrueSight。BMC 已对其产品进行现代化改造，如推出云原生的 Helix 平台，并收购了 Netreo。因此，客户需要明确的升级路径指导，以顺利过渡到新平台。&lt;/li>
&lt;/ul>
&lt;h3 id="chronosphere">Chronosphere
&lt;/h3>&lt;p>Chronosphere 在此次魔力象限中被评为领导者。其可观测性平台解决方案包括 Chronosphere Observability Platform 和 Chronosphere Telemetry Pipeline，业务主要集中在美国和 EMEA 地区，客户大多来自北美。&lt;/p>
&lt;p>Chronosphere 的创始人在 Uber 工作期间开发了 M3DB 时间序列数据库，如今公司仍在支持这一开源项目。近期，Chronosphere 收购了遥测管道供应商 Calyptia（Fluent Bit 的创建者），并与 CrowdStrike 建立了合作，作为其日志获取和分析产品的基础。&lt;/p>
&lt;h4 id="优势-2">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>遥测数据管理与治理&lt;/strong>：Chronosphere 提供一个控制平面，客户可以使用该平台分析遥测数据的使用情况，并在数据收集时制定策略与规则。这使得成本优化和数据治理变得更加高效，这是其他供应商难以提供的功能。&lt;/li>
&lt;li>&lt;strong>依托开源技术&lt;/strong>：Chronosphere 支持 Prometheus 风格的指标采集以及 OpenTelemetry，用于收集指标、日志和追踪数据。这为那些不愿继续自行管理 Prometheus 或 Jaeger 环境的组织提供了迁移便利。收购 Calyptia 也带来了 Fluent Bit 这一开源工具，进一步丰富了 Chronosphere 的遥测管道能力。&lt;/li>
&lt;li>&lt;strong>单租户架构&lt;/strong>：Chronosphere 为每位客户提供独立的租户环境和专属存储空间。这有效避免了不同客户之间的资源争用，同时提高了数据安全性。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-2">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>地理覆盖范围&lt;/strong>：尽管 Chronosphere 的服务可以在全球使用，但其平台目前仅托管在美国的公有云区域。这可能会引发某些客户对数据主权的担忧，或在某些地区导致延迟问题。公司计划于 2024 年在 EMEA 地区部署托管服务。&lt;/li>
&lt;li>&lt;strong>数字体验监控功能缺乏&lt;/strong>：Chronosphere 目前不提供专门的数字体验监控功能，如合成监控或真实用户监控（RUM）。虽然客户可以将数字体验监控的遥测数据上传至 Chronosphere 进行分析，但这些数据的生成和传输需要客户自行解决。&lt;/li>
&lt;li>&lt;strong>缺少自带代理&lt;/strong>：Chronosphere 不包含自带的埋点代理，因此被监控的系统需要以与 Prometheus 或 OpenTelemetry 兼容的方式进行埋点，或使用 Fluent Bit 支持的格式。Chronosphere 也支持从其他供应商的代理获取遥测数据，客户可选择兼容的代理进行使用。&lt;/li>
&lt;/ul>
&lt;h3 id="datadog">Datadog
&lt;/h3>&lt;p>Datadog 在此次魔力象限中被评为领导者。其 SaaS 平台不仅提供可观测性解决方案，还覆盖云安全领域。Datadog 的业务主要集中在美国和 EMEA 地区，同时在亚太和拉丁美洲市场逐步扩展，服务的客户从初创企业到大型企业。近期，Datadog 对其平台进行了多项改进，包括升级仪表板、笔记本和 Watchdog AI 功能，推出了 Flex Logs、移动应用测试、数据流监控以及动态埋点功能。此外，还推出了事件管理功能，将 Datadog 和其他 可观测性工具中的事件整合到统一视图中进行管理。&lt;/p>
&lt;h4 id="优势-3">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>战略愿景与销售执行力&lt;/strong>：Datadog 迅速构建了多项新功能，涵盖 APM、日志管理、数字体验监控（DEM）、安全和软件交付等领域，赢得了许多寻求高端解决方案的企业的青睐。其产品驱动增长（PLG）模式帮助企业在大中小规模的组织中扩大客户基础并提升客户参与度。&lt;/li>
&lt;li>&lt;strong>可视化能力&lt;/strong>：Datadog 提供了强大且用户友好的可视化功能，使用户能够在一个界面中查看所有遥测数据，并支持通过小部件轻松定制仪表板。&lt;/li>
&lt;li>&lt;strong>产品发展路线&lt;/strong>：Datadog 具备强大的产品发展规划，专注于提升 observability、DevSecOps、自动化修复、软件交付以及遥测数据的治理。其策略是打造一个将所有功能无缝整合在一起的平台。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-3">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>定价问题&lt;/strong>：虽然 Datadog 在官网上提供了详细的定价信息，但一些客户反映，随着使用量的增长，成本可能迅速上升。为了应对这一问题，Datadog 提供了可配置的遥测数据获取控制，帮助客户在预算范围内管理成本。&lt;/li>
&lt;li>&lt;strong>复杂的业务模式&lt;/strong>：随着产品线的扩展，Datadog 目前在其官网上提供 20 个独立的产品模块，每个模块都有独立的定价结构，这可能让客户在理解和谈判价格时感到困惑。为了简化流程，Datadog 已开始推出捆绑产品选项。&lt;/li>
&lt;li>&lt;strong>代理管理功能缺乏&lt;/strong>：目前，Datadog 缺乏针对代理群组的管理和自动化部署功能，这给大规模部署带来了一定的复杂性。该公司表示，相关功能正在开发中，并已进入测试阶段。&lt;/li>
&lt;/ul>
&lt;h3 id="dynatrace">Dynatrace
&lt;/h3>&lt;p>Dynatrace 在此次魔力象限中被评为领导者。其 observability 和安全平台包含多个模块，包括基础设施与应用可观测性、安全分析与防护、数字体验管理、自动化功能以及业务分析。Dynatrace 的客户遍布全球，尤其集中在拉丁美洲、亚太地区等各大市场，主要为大型企业和科技驱动型公司。Dynatrace 最近收购了开发者工具供应商 Rookout 和安全厂商 Runecast，进一步扩展其产品线。&lt;/p>
&lt;h4 id="优势-4">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>广泛的产品组合&lt;/strong>：Dynatrace 提供全面的 observability 和安全解决方案，尤其受到大型企业的青睐。其覆盖范围包括现代架构（如 Kubernetes、容器、云函数）的可观测性，及主机和 SAP 等传统企业解决方案的监控。&lt;/li>
&lt;li>&lt;strong>AI 技术创新&lt;/strong>：Dynatrace 对其 Davis AI 引擎进行了重大升级，全面采用 AI 技术进行因果分析和预测建模，并且推出了基于生成式 AI 的智能助手，显著提升了平台的智能化水平。&lt;/li>
&lt;li>&lt;strong>平台的灵活性与扩展性&lt;/strong>：Dynatrace 的 AppEngine 和 AutomationEngine 使平台具备更强的扩展能力，用户和第三方开发者可以针对特定行业或业务需求开发定制应用和自动化流程，超越了简单的健康监控和性能分析。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-4">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>采购的复杂性&lt;/strong>：Dynatrace 于 2023 年引入了新的订阅模式 Dynatrace Platform Subscription（DPS），要求客户承诺年度最低消费额度并使用递减率定价机制。虽然很多客户接受了该模式，并能够使用所有的 Dynatrace 产品，但一些采购部门对最低承诺和新组件的定价模式保持谨慎。&lt;/li>
&lt;li>&lt;strong>日志管理应用的进展缓慢&lt;/strong>：尽管 Dynatrace 在 2023 年推出了新机制，能够高效处理大量日志数据，客户对此技术表示出浓厚兴趣，但目前并未出现广泛采用 Dynatrace 进行大规模日志管理的趋势。&lt;/li>
&lt;li>&lt;strong>对中小企业的适应性&lt;/strong>：Dynatrace 主要为大型企业设计，虽然通过公有云市场可以降低部分门槛，但中小企业可能因为成本原因，选择将其用于监控最核心的业务系统。&lt;/li>
&lt;/ul>
&lt;h3 id="elastic">Elastic
&lt;/h3>&lt;p>Elastic 在此次魔力象限中被评为领导者。Elastic Observability 基于广泛使用的 Elastic Search AI 平台（原 Elasticsearch）构建，同时支撑其搜索和安全产品。Elastic Observability 可以通过 SaaS 提供，也可自托管使用。公司总部位于北美，客户主要分布在美洲和 EMEA 地区，并在亚太地区实现了显著增长。Elastic 的未来发展规划包括通过新查询语言和 AI 助手提升分析能力和站点稳定性工程（SRE）效率。&lt;/p>
&lt;h4 id="优势-5">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>深度 AI 集成&lt;/strong>：Elastic 在其平台中深度集成了 AI，提供 30 多种机器学习模型、定制模型集成，并配备了基于检索增强生成（RAG）的 AI 助手，增强了传统数据分析能力。&lt;/li>
&lt;li>&lt;strong>开放性与灵活性&lt;/strong>：Elastic Observability 源自开源的 Elasticsearch 数据平台，能够在大规模下处理多样化的高基数数据。其开放架构为平台提供了极高的灵活性和可扩展性。&lt;/li>
&lt;li>&lt;strong>多样化的部署选择&lt;/strong>：Elastic Observability 支持全球多个区域的部署，涵盖所有主要云服务提供商，并提供自托管选项。这使得它能够满足不同客户的数据主权需求，并符合区域性法规要求，例如美国政府的 FedRAMP 认证。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-5">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>市场认知度低&lt;/strong>：尽管 Elastic 的搜索和安全产品知名度较高，但其可观测性产品的市场认知度和应用率仍有待提升。公司正在积极推动其可观测性产品的市场销售和推广。&lt;/li>
&lt;li>&lt;strong>学习曲线较陡峭&lt;/strong>：作为开源软件，Elastic 可能需要更多的学习和培训时间，尤其是对于计划自托管的组织，需确保有足够的技术能力支持。&lt;/li>
&lt;li>&lt;strong>定价模型复杂&lt;/strong>：Elastic 采用基于计算资源的定价模型，与其他厂商的定价模式不同。尽管 Elastic 提供了定价计算器，但在采购、成本评估和预算预测过程中，可能较难进行直观比较。&lt;/li>
&lt;/ul>
&lt;h3 id="grafana-labs">Grafana Labs
&lt;/h3>&lt;p>Grafana Labs 也是本次魔力象限中的领导者。公司创建于开源项目 Grafana 之上，并推出了诸如 Loki、Tempo、Mimir 等其他开源项目。Grafana Labs 的可观测性平台包括 Grafana Cloud 可视化、指标、日志、配置文件以及机器学习功能，客户遍布全球，主要集中在美洲和 EMEA 地区。&lt;/p>
&lt;h4 id="优势-6">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>全球托管灵活性&lt;/strong>：Grafana Cloud 目前在全球 19 个 AWS、Azure 和 GCP 区域托管，使客户能够根据延迟需求和数据主权选择合适的托管位置。&lt;/li>
&lt;li>&lt;strong>持续功能更新&lt;/strong>：在过去的 12 个月里，Grafana Labs 显著增强了 Grafana Cloud 的功能，特别是在应用程序监控、SLO 管理和自适应指标方面，这些功能可以帮助企业更有效地管理成本。&lt;/li>
&lt;li>&lt;strong>灵活的数据集成&lt;/strong>：Grafana 平台能够连接不同的遥测收集系统，并实现跨系统的数据可视化和告警，避免了数据迁移或存储在 Grafana Cloud 中的需求，极大增强了其组合能力。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-6">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>学习曲线较高&lt;/strong>：随着功能的不断扩展，掌握 Grafana 平台变得更加复杂，配置可能需要手动编辑 YAML 或 JSON 文件，这对初学者来说具有挑战性。&lt;/li>
&lt;li>&lt;strong>成本预测困难&lt;/strong>：新用户可能会发现难以预测在 Grafana Cloud 上的指标支出，尤其是活动系列和每分钟数据点等度量标准并不容易获得。使用免费的 Grafana Cloud 版本可能有助于缓解这一问题。&lt;/li>
&lt;li>&lt;strong>合作竞争关系的复杂性&lt;/strong>：Grafana Labs 与其他 observability 供应商之间的合作关系可能会变得复杂，尤其是在其自身业务快速扩展的情况下。尽管与 AWS、Google 和 Microsoft 的合作有助于缓解这一问题，但仍需保持关注。&lt;/li>
&lt;/ul>
&lt;h3 id="honeycomb">Honeycomb
&lt;/h3>&lt;p>Honeycomb 是本次魔力象限中的远见者。其 observability 服务基于优化的数据存储和查询引擎，专注于探测应用和基础设施中的模式和异常。Honeycomb 作为可观测性平台，支持 APM 使用场景，并以 SaaS 形式提供服务。其客户遍布全球，主要集中在北美和 EMEA 地区。&lt;br>
最近的更新包括推出了 Kubernetes 监控功能和前端可观测性功能（现阶段为早期访问版本）。&lt;/p>
&lt;h4 id="优势-7">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>Kubernetes 专用工具&lt;/strong>：2023 年，Honeycomb 推出了 Kubernetes 监控工具，使 SRE 能够更快速地诊断容器化环境中的问题。&lt;/li>
&lt;li>&lt;strong>高度参与的客户社区&lt;/strong>：Honeycomb 与其用户群保持紧密联系，定期举办研讨会，活跃的 Slack 社区以及社交媒体互动，让客户能够直接提供反馈。&lt;/li>
&lt;li>&lt;strong>全球化扩展&lt;/strong>：2024 年初，Honeycomb 在欧洲部署了基于 SaaS 的新实例，使客户能够根据数据主权要求选择将 observability 数据存储在美国、欧盟，或同时存储在两者之间。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-7">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>企业市场的影响力有限&lt;/strong>：虽然 Honeycomb 在云原生和技术驱动型企业中很受欢迎，但在更广泛的企业市场中其影响力相对较小，Gartner 客户较少将其作为可观测性平台的候选供应商。&lt;/li>
&lt;li>&lt;strong>技术导向的聚焦&lt;/strong>：Honeycomb 的宣传主要面向技术专家，特别是 SRE 和平台团队，可能忽略了提供商业和客户行为洞察的潜力，而这些内容往往是 I&amp;amp;O 预算持有者更关心的。&lt;/li>
&lt;li>&lt;strong>定价难以预测&lt;/strong>：Honeycomb 的定价基于摄取到平台中的事件量，客户难以预测事件数量以及未来 12 个月的增长。&lt;/li>
&lt;/ul>
&lt;h3 id="ibm">IBM
&lt;/h3>&lt;p>IBM 是本次魔力象限中的远见者。IBM 的 Instana可观测性平台既可以作为 SaaS 提供，也可以通过自托管方式部署，使用单代理架构。其客户主要为中大型企业，集中在北美和西欧。IBM 的监控产品覆盖从主机到现代云架构。IBM 还计划收购基础设施自动化公司 HashiCorp，该公司的 Terraform 产品与许多可观测性平台都有集成。&lt;/p>
&lt;h4 id="优势-8">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>精确的遥测数据&lt;/strong>：Instana 以每秒级别的精度收集指标，并在三秒内生成通知，这为提升可用性和确保服务质量目标 (SLO) 达成提供了支持。&lt;/li>
&lt;li>&lt;strong>简单的定价模式&lt;/strong>：IBM Instana 采用按主机计费的简单定价模式，在市场中具备竞争力。&lt;/li>
&lt;li>&lt;strong>AI 集成优势&lt;/strong>：Instana 提供自动化 observability，利用 AI 生成洞察并辅助决策。IBM 最近推出了 watsonx 和 Concert，这些生成式 AI 技术将进一步扩展 Instana 的智能化功能。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-8">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>有限的安全功能&lt;/strong>：Instana 的安全功能较为有限，更多依赖 IBM 其他产品提供这方面的支持。虽然 Gartner 认为安全功能是可选的，但客户需要根据需求决定是否需要集成安全解决方案。&lt;/li>
&lt;li>&lt;strong>市场认知度不足&lt;/strong>：IBM Instana 在市场中的知名度较低，很多现有的 IBM 客户甚至不知道这一产品的存在，即使他们正在寻找可观测性解决方案。虽然 IBM 为使用其传统 IT 工具的客户提供了升级到 Instana 的路径，但很多客户对此并不知情。&lt;/li>
&lt;li>&lt;strong>日志摄取的限制&lt;/strong>：目前 Instana 的日志摄取仅限于应用日志和容器化环境。扩展到更广泛的环境是其 2024 年的发展计划之一。&lt;/li>
&lt;/ul>
&lt;h3 id="logicmonitor">LogicMonitor
&lt;/h3>&lt;p>LogicMonitor 是本次魔力象限中的远见者。其 LM Envision 平台从混合基础设施监控发展为可观测性解决方案。LogicMonitor 提供无代理的 SaaS 平台，涵盖基础设施、网络、SD-WAN、云和应用监控，并具备 AI 功能。客户主要来自美洲和 EMEA，且在亚太地区业务不断扩展。过去一年内，LogicMonitor 发布了多项新工具，包括 Edwin AI（用于事件摄取与关联）、生成式 AI 聊天机器人 LM Copilot 以及用于云成本管理的 LM 成本优化。&lt;/p>
&lt;h4 id="优势-9">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>高扩展性&lt;/strong>：LogicMonitor 使用无代理收集器来监控资源，这些收集器可根据服务器容量和数据需求进行自动负载均衡，确保高数据处理能力，并支持故障切换。其平台提供 99.9% 的可用性 SLA，确保监控始终可用。&lt;/li>
&lt;li>&lt;strong>容器支持广泛&lt;/strong>：LogicMonitor 对 Kubernetes 容器环境提供了强大的支持，无需修改容器代码即可进行监控。&lt;/li>
&lt;li>&lt;strong>简单定价&lt;/strong>：LogicMonitor 的定价模式简洁明了，适用于各种规模的企业，尤其适合托管服务提供商（MSP）模式下的企业。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-9">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>observability 功能有限&lt;/strong>：尽管 LogicMonitor 近年来有所投资，但它仍然主要专注于基础设施和网络监控，缺乏数字体验监控和威胁检测等功能，与同行相比存在差距。&lt;/li>
&lt;li>&lt;strong>仪表板和用户界面&lt;/strong>：尽管提供了多种监控模板，但 LogicMonitor 的用户界面在市场上相对落后，操作时需要多次点击才能深入分析数据和获取上下文信息。公司正在发布新界面，预计将有所改善。&lt;/li>
&lt;li>&lt;strong>市场影响力&lt;/strong>：尽管投入了大量市场宣传，但 LogicMonitor 在市场上的认知度仍然有限，特别是在 observability 领域的扩展上，客户认知度仍需提升。&lt;/li>
&lt;/ul>
&lt;h3 id="logzio">Logz.io
&lt;/h3>&lt;p>Logz.io 作为远见者，基于开源技术提供其 Open 360可观测性平台，涵盖应用、Kubernetes 和基础设施监控，支持日志管理和云安全信息及事件管理（SIEM）。Logz.io 的客户多为开源技术友好的中小型企业，主要分布在美洲和 EMEA 地区。其未来规划包括进一步利用生成式 AI 增强平台能力，并引入业务导向功能，如 SLO 管理。&lt;/p>
&lt;h4 id="优势-10">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>成本优化&lt;/strong>：Logz.io 专注于降低 observability 成本，其数据优化中心提供强大的遥测成本管理功能，如数据过滤、分层存储、追踪采样等。&lt;/li>
&lt;li>&lt;strong>从开源到企业的无缝衔接&lt;/strong>：对于已经使用开源监控工具的企业，Logz.io 提供了快速实现企业级 observability 的路径。&lt;/li>
&lt;li>&lt;strong>全球化业务&lt;/strong>：Logz.io 的 Open 360 平台在全球多个 SaaS 实例上运行，支持多语言并符合区域性数据安全法规，客户遍布全球。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-10">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>缺乏前端监控&lt;/strong>：Logz.io 主要专注于通过开源技术收集后台遥测数据，但在前端用户监控和会话回放等功能方面支持不足。&lt;/li>
&lt;li>&lt;strong>技术导向过强&lt;/strong>：Logz.io 平台过于关注技术细节，缺少业务监控和漏斗分析等更贴合商业需求的功能。&lt;/li>
&lt;li>&lt;strong>市场知名度不足&lt;/strong>：尽管 Logz.io 的客户基础在增长，但主要集中在中小型企业，与其他供应商相比，其市场可见度较低，较少出现在客户的候选名单中。&lt;/li>
&lt;/ul>
&lt;h3 id="microsoft">Microsoft
&lt;/h3>&lt;p>Microsoft 在此次魔力象限中被评为挑战者。其 Azure Monitor 是一款原生的 Azure 可观测性平台，专注于中大型企业。公司业务遍布全球。除了引入生成式 AI 功能外，Microsoft 的未来计划还包括一种低成本的日志存储机制和基于服务组的应用建模。&lt;/p>
&lt;h4 id="优势-11">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>AI 集成&lt;/strong>：Microsoft 与 OpenAI 的合作带来了生成式 AI 能力，如通过 Copilot 接口集成到 Azure Monitor 中。Kusto Query Language (KQL) 也支持机器学习，并可以创建处理日志数据的机器学习流水线。&lt;/li>
&lt;li>&lt;strong>Prometheus 支持&lt;/strong>：Azure Monitor 引入了 Prometheus 托管服务，支持从 Azure Kubernetes Service (AKS) 等服务摄取数据，利用 PromQL 进行分析，并通过 Grafana 实现可视化和告警功能。&lt;/li>
&lt;li>&lt;strong>安全监控集成&lt;/strong>：Microsoft 的 Sentinel 和 Defender 产品与 Azure Monitor 无缝集成，提供跨运营和安全功能的统一分析和事件响应能力。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-11">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>SLO 管理缺乏&lt;/strong>：Azure Monitor 尚未提供直接的 SLO 管理功能，相关功能预计在 2024 年推出。当前的 SLO 管理流程相对繁琐。&lt;/li>
&lt;li>&lt;strong>OpenTelemetry 支持延迟&lt;/strong>：尽管 Azure Monitor 可以摄取 OpenTelemetry 数据，但尚不支持直接通过收集器接口处理 OpenTelemetry Protocol (OTLP) 数据。相关功能在 2024 年进入公测。&lt;/li>
&lt;li>&lt;strong>Prometheus 兼容性问题&lt;/strong>：Azure Monitor 对 Prometheus 的支持目前与开源版本存在一些不兼容问题。&lt;/li>
&lt;/ul>
&lt;h3 id="new-relic">New Relic
&lt;/h3>&lt;p>New Relic 在此次魔力象限中被评为领导者。其可观测性平台以 SaaS 形式提供，涵盖 APM、AI 监控、数字体验、基础设施监控、日志管理和安全功能。客户主要为中大型企业，遍布美洲、EMEA 和亚太地区。最近，New Relic 在日志存储优化、AI 监控和应用安全方面进行了增强，并在 2023 年 11 月被 Francisco Partners 和 TPG 收购。&lt;/p>
&lt;h4 id="优势-12">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>灵活的定价&lt;/strong>：New Relic 提供基于摄取量和用户数量的定价模式，以及新的基于计算量的定价，客户可以根据使用量灵活调整成本。&lt;/li>
&lt;li>&lt;strong>AI 监控&lt;/strong>：New Relic 的 AI 监控功能使工程师能够监控 AI 模型的性能，并比较大语言模型（LLM）的成本和效率。&lt;/li>
&lt;li>&lt;strong>统一的数据平台&lt;/strong>：New Relic 的遥测数据平台 (TDP) 专为高效管理遥测数据而优化，支持高基数数据，并原生支持 OpenTelemetry。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-12">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>实施复杂性&lt;/strong>：一些客户反映，初始设置和配置过程较为复杂，特别是对于不熟悉该平台的用户。&lt;/li>
&lt;li>&lt;strong>地理覆盖有限&lt;/strong>：New Relic 的服务交付平台主要位于美国和 EMEA，特别是依赖 AWS 托管的 SaaS 平台。亚太地区的企业可能需要确保其服务符合区域性要求。&lt;/li>
&lt;li>&lt;strong>收购影响&lt;/strong>：New Relic 被收购后，客户对其产品路线图和稳定性有所关注。公司表示已加大平台创新投资，但未来发展仍有待观察。&lt;/li>
&lt;/ul>
&lt;h3 id="oracle">Oracle
&lt;/h3>&lt;p>Oracle 在本次魔力象限中被评为利基参与者。其 Oracle Cloud Observability and Management (O&amp;amp;M) 平台支持混合和多云环境中的应用、日志、基础设施和数据库监控，尤其侧重于 Oracle Cloud Infrastructure (OCI) 和企业应用。Oracle 客户遍布全球，涵盖各行业的中大型企业，包括政府机构。未来，Oracle 计划进一步提升 O&amp;amp;M 为 SRE 团队的体验，集成 ITSM，并专注于日志管理和分析。&lt;/p>
&lt;h4 id="优势-13">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>全球覆盖&lt;/strong>：Oracle 拥有全球化的业务，支持多种语言，并符合区域性法规要求。通过欧盟主权云、FedRAMP 认证以及 OCI 专用区域，Oracle 提供了符合数据主权要求的解决方案。&lt;/li>
&lt;li>&lt;strong>全面的 Oracle 集成&lt;/strong>：Oracle 的 O&amp;amp;M 不仅适用于 OCI，还支持 E-Business Suite 和 PeopleSoft 等应用，客户可以使用定制仪表板和自动化监控，提升用户体验。&lt;/li>
&lt;li>&lt;strong>多云支持&lt;/strong>：Oracle 一直致力于提供支持多云环境的 O&amp;amp;M 解决方案，不局限于自家生态，适应多云工作负载的需求。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-13">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>市场认知度较低&lt;/strong>：虽然 Oracle 将 O&amp;amp;M 定位为多云解决方案，但该产品在现有客户群之外的认知度较低，较少出现在 Gartner 的客户咨询中。&lt;/li>
&lt;li>&lt;strong>生成式 AI 发展较慢&lt;/strong>：虽然大多数供应商在 2023 年都引入了生成式 AI，Oracle 在这方面的进展较为缓慢，目前相关功能仍在开发中。&lt;/li>
&lt;li>&lt;strong>缺乏业务导向功能&lt;/strong>：尽管支持 Apdex 评分，O&amp;amp;M 尚未引入全面的 SLO 管理或错误预算管理功能，难以完全满足 SRE 团队的需求。&lt;/li>
&lt;/ul>
&lt;h3 id="servicenow">ServiceNow
&lt;/h3>&lt;p>ServiceNow 是本次魔力象限中的远见者。其可观测性平台包括 Cloud Observability（原 Lightstep）以及 IT 运营管理 (ITOM) 和 IT 服务管理 (ITSM) 功能。ServiceNow 客户遍布全球，涵盖各行业，其产品路线图侧重于全面引入生成式 AI 功能。&lt;/p>
&lt;h4 id="优势-14">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>支持 OpenTelemetry&lt;/strong>：ServiceNow Cloud Observability 从设计上就支持 OpenTelemetry 数据的摄取和分析，包括基于 Open Agent 管理协议 (OpAmp) 的收集器管理功能。&lt;/li>
&lt;li>&lt;strong>强劲的市场影响力&lt;/strong>：ServiceNow 在企业市场中拥有稳固的基础，特别是在大型企业中，其 ITSM 产品的广泛应用使其能够推动 Cloud Observability 的使用。&lt;/li>
&lt;li>&lt;strong>全面的产品组合&lt;/strong>：Cloud Observability 正逐步与 ServiceNow 的 ITOM 和 ITSM 产品整合，成为 ServiceNow 客户寻求可观测性平台的一个自然选择。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-14">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>认知度不足&lt;/strong>：Gartner 的客户反馈表明，许多企业对 ServiceNow 的 Cloud可观测性解决方案并不熟悉，市场推广力度不及专注于 observability 的供应商。&lt;/li>
&lt;li>&lt;strong>产品组合复杂性&lt;/strong>：Cloud Observability 与 ServiceNow 的其他产品组合并行但独立存在，功能如 SLO 管理属于 ITOM，需要额外购买，增加了复杂性。&lt;/li>
&lt;li>&lt;strong>路线图缺乏创新&lt;/strong>：与市场领导者相比，ServiceNow 在 Cloud Observability 上的创新较少，未来发展方向较为保守。&lt;/li>
&lt;/ul>
&lt;h3 id="splunk">Splunk
&lt;/h3>&lt;p>Splunk 在本次魔力象限中被评为领导者。其可观测性平台包括 Splunk Platform、Splunk IT Service Intelligence 和 Splunk Observability Cloud。Splunk 的客户主要为全球的大型企业。2024 年 3 月 18 日，Cisco 完成了对 Splunk 的收购，并将 AppDynamics 整合到 Splunk 的可观测性产品中。本报告中的参考信息收集于收购完成之前，因此仍然使用 Splunk 的名称。&lt;/p>
&lt;h4 id="优势-15">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>支持 OpenTelemetry&lt;/strong>：Splunk 强大的 OpenTelemetry 支持使其在可观测性平台中表现出色，提供对 Linux、Windows 和 Kubernetes 的全方位支持。&lt;/li>
&lt;li>&lt;strong>SLO 管理功能&lt;/strong>：Splunk Observability 提供了便捷的工作流，帮助客户通过 UI 或自动化工具如 Terraform 管理 SLO，还支持 SLO 消耗率分析告警。&lt;/li>
&lt;li>&lt;strong>一体化解决方案&lt;/strong>：Splunk 通过紧密集成的可观测性平台，能够无缝地支持 IT 运营、工程和网络安全领域的多种使用场景。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-15">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>收购带来的不确定性&lt;/strong>：Cisco 收购 Splunk 后，产品线整合尚未完成，未来销售流程可能存在不确定性。&lt;/li>
&lt;li>&lt;strong>地理覆盖差异&lt;/strong>：Splunk Cloud 的覆盖范围大于 Splunk Observability Cloud，前者在北美、EMEA 和亚太地区有更广泛的分布。对于有严格数据主权要求的客户，需详细检查其具体位置。&lt;/li>
&lt;li>&lt;strong>定价复杂&lt;/strong>：Splunk 的定价模式较为复杂，可能会给客户带来预测成本的难题，特别是在数据摄取和使用量变化较大的情况下。&lt;/li>
&lt;/ul>
&lt;h3 id="sumo-logic">Sumo Logic
&lt;/h3>&lt;p>Sumo Logic 在此次魔力象限中被评为利基参与者。其可观测性平台专注于提供可用性、性能和安全分析，主要服务于全球中小型企业。Sumo Logic 最近推出了基于 AI 的异常检测和优化功能，客户主要分布在美洲和亚太地区。&lt;/p>
&lt;h4 id="优势-16">优势
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>灵活的定价模式&lt;/strong>：Sumo Logic 的定价基于分析而非数据摄取，这意味着客户只需为数据分析付费，而数据摄取成本为 $0。&lt;/li>
&lt;li>&lt;strong>支持 OpenTelemetry&lt;/strong>：Sumo Logic 为所有客户提供 OpenTelemetry 支持，简化了遥测数据的收集和分析。&lt;/li>
&lt;li>&lt;strong>全球覆盖&lt;/strong>：Sumo Logic 平台在全球多个 AWS 区域可用，支持数据驻留和主权要求。&lt;/li>
&lt;/ul>
&lt;h4 id="注意事项-16">注意事项
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>日志为中心&lt;/strong>：Sumo Logic 主要定位为日志分析工具，尽管支持追踪和指标，但对于需要深入应用监控的企业可能不够全面。&lt;/li>
&lt;li>&lt;strong>市场增速缓慢&lt;/strong>：尽管 Sumo Logic 总体收入有所增长，但可观测性平台的收入增长自 2022 年以来几乎停滞不前。&lt;/li>
&lt;li>&lt;strong>缺乏原生合成监控&lt;/strong>：Sumo Logic 没有提供原生的合成监控功能，客户需要使用其他工具来实现此功能，尽管它支持与 Catchpoint 的开箱即用集成。&lt;/li>
&lt;/ul>
&lt;h3 id="添加和删除的供应商">添加和删除的供应商
&lt;/h3>&lt;p>随着市场变化，我们会不断审查和调整魔力象限的纳入标准。因此，魔力象限中的供应商组合可能会随时间发生变化。一年中出现的供应商在次年消失，并不意味着我们对该供应商的看法发生了改变。这可能反映了市场的变化，进而调整了评估标准，或是供应商自身的重点发生了转移。&lt;/p>
&lt;h4 id="新增">新增
&lt;/h4>&lt;p>以下供应商符合纳入标准，并被添加至魔力象限：&lt;/p>
&lt;ul>
&lt;li>BMC&lt;/li>
&lt;li>Chronosphere&lt;/li>
&lt;li>LogicMonitor&lt;/li>
&lt;/ul>
&lt;h4 id="删除">删除
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>Broadcom&lt;/strong> 被删除是因为未能达到市场的客户兴趣指标 (CII) 门槛。&lt;/li>
&lt;li>&lt;strong>Cisco&lt;/strong> 被删除是因为 Cisco Observability Platform 产品已停用。&lt;/li>
&lt;li>&lt;strong>ManageEngine&lt;/strong> 被删除是因为未能达到 CII 门槛。&lt;/li>
&lt;li>&lt;strong>Riverbed&lt;/strong> 被删除是因为未能达到 CII 门槛。&lt;/li>
&lt;li>&lt;strong>SolarWinds&lt;/strong> 被删除是因为未能满足本次研究的纳入标准。&lt;/li>
&lt;/ul>
&lt;h2 id="纳入和排除标准">纳入和排除标准
&lt;/h2>&lt;p>魔力象限的研究通过识别并分析市场中最具相关性的供应商及其产品，帮助客户了解市场状况。为了支持市场识别，通常我们会选择不超过 20 个最具代表性的供应商进行研究。要符合纳入标准，供应商必须满足以下要求：&lt;/p>
&lt;h3 id="市场参与标准">市场参与标准
&lt;/h3>&lt;ul>
&lt;li>截至 2024 年 3 月 14 日，产品或服务必须普遍可用，能够通过常规销售渠道提供给所有客户。&lt;/li>
&lt;li>供应商必须直接销售可观测性平台，并提供至少一线的客户支持服务，包括产品文档、安装指南和参考示例。&lt;/li>
&lt;li>供应商应展示清晰的产品路线图和市场策略。&lt;/li>
&lt;/ul>
&lt;h3 id="性能门槛">性能门槛
&lt;/h3>&lt;p>-可观测性平台必须在两个或多个地理区域拥有至少 50 位付费的生产环境客户。
-可观测性平台在最近 12 个月内的年收入至少达到 7500 万美元，或者年收入至少达到 1000 万美元，并且年收入增长率达到 25%。&lt;/p>
&lt;p>此外，供应商必须在 Gartner 的客户兴趣指标 (CII) 中位居前列。CII 指标通过反映客户兴趣、供应商互动和客户反馈的加权组合来计算。&lt;/p>
&lt;h3 id="荣誉提名">荣誉提名
&lt;/h3>&lt;p>我们正在观察超过 40 家供应商的表现，虽然此次研究重点分析了 17 家供应商，但未被纳入并不意味着它们不具备实力。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Observe&lt;/strong>：这家公司是最早基于 Snowflake 数据平台构建可观测性平台的供应商之一，在其 2024 年 B 轮融资后表现强劲，尽管未达到此次研究的非功能性要求，但仍是市场中的重要力量。&lt;/li>
&lt;/ul>
&lt;h2 id="评估标准">评估标准
&lt;/h2>&lt;h3 id="执行能力">执行能力
&lt;/h3>&lt;p>Gartner 分析师根据供应商的质量和效率来评估其执行能力。我们评估供应商的过程、系统、方法或程序是否能够使其在市场中保持竞争力、运营高效且富有成效，并能够带来积极的收入增长、客户留存率和声誉。最终，供应商的表现评估将依据其利用自身愿景实现成功的能力。&lt;/p>
&lt;h3 id="产品">产品
&lt;/h3>&lt;p>此标准主要关注供应商在可观测性平台市场中的核心技术竞争力，涵盖当前产品功能、质量和特性。此外，还考虑其产品的可扩展性、稳定性、集成性以及安全特性。&lt;/p>
&lt;h3 id="整体可行性">整体可行性
&lt;/h3>&lt;p>评估供应商整体财务状况及其业务单元的财务健康度，考虑盈利能力、收入来源的地理分布以及研发投入。&lt;/p>
&lt;h3 id="销售执行定价">销售执行/定价
&lt;/h3>&lt;p>评估供应商在市场中的销售表现，重点关注其定价模式的透明度、价值以及复杂性。还包括对定价与折扣、新老客户业务以及与竞争对手的动态对比。&lt;/p>
&lt;h3 id="市场响应能力">市场响应能力
&lt;/h3>&lt;p>衡量供应商根据客户需求变化和市场动态调整策略的灵活性，评估其应对竞争和响应客户反馈的能力。&lt;/p>
&lt;h3 id="市场执行">市场执行
&lt;/h3>&lt;p>评估供应商的市场推广活动，关注其传递信息的清晰度、质量、创意和效果，以及其品牌影响力、产品知名度和客户认同感的提升。&lt;/p>
&lt;h3 id="客户体验">客户体验
&lt;/h3>&lt;p>重点评估客户通过供应商产品和服务实现预期结果的体验，包括客户支持计划、售后服务和区域内合作伙伴的支持情况。高端客户的特别支持项目也在评估范围内。&lt;/p>
&lt;h3 id="运营">运营
&lt;/h3>&lt;p>衡量供应商实现目标并履行承诺的能力，评估其组织结构、技能和合作关系的质量，特别是其遵守服务级别协议 (SLA) 的表现。还考虑其与云服务提供商的合作以及处理停机事件的能力。&lt;/p>
&lt;p>表 1 列出了魔力象限中关于执行能力的具体评估标准。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>评估标准&lt;/th>
&lt;th>权重&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>客户体验&lt;/td>
&lt;td>高&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>市场响应能力/记录&lt;/td>
&lt;td>高&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>市场推广执行&lt;/td>
&lt;td>中&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>运营&lt;/td>
&lt;td>低&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>整体可行性&lt;/td>
&lt;td>中&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>产品或服务&lt;/td>
&lt;td>高&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>销售执行/定价&lt;/td>
&lt;td>中&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="愿景的完整性">愿景的完整性
&lt;/h3>&lt;p>Gartner 分析师通过评估供应商对当前市场机会的理解能力，以及其阐述未来市场方向、创新和客户需求的能力来衡量其表现。最终，供应商的愿景展望和其实现未来目标的能力将作为评估依据。&lt;/p>
&lt;h3 id="市场理解">市场理解
&lt;/h3>&lt;p>此标准衡量供应商对客户需求的把握，以及如何将这些需求转化为产品。具有清晰市场愿景的供应商能够倾听和理解客户需求，并通过其创新推动市场发展。供应商对 observability 领域的深入理解及其与 APM 的区别也是评估的重要因素。&lt;/p>
&lt;h3 id="营销策略">营销策略
&lt;/h3>&lt;p>评估供应商是否具备清晰的差异化营销信息，以及是否通过社交媒体、广告和客户项目等渠道有效传递这些信息。创新的市场推广策略和真实的差异化也在考量范围内。&lt;/p>
&lt;h3 id="销售策略">销售策略
&lt;/h3>&lt;p>评估供应商的销售策略是否能够利用直接和间接销售、营销、服务和合作伙伴网络，扩大市场覆盖和客户基础。渠道策略及对购买决策者的理解也是关键考量因素。&lt;/p>
&lt;h3 id="产品策略">产品策略
&lt;/h3>&lt;p>评估供应商在产品开发和交付上的策略是否满足当前及未来的市场需求，是否具备差异化功能和持续创新的能力。产品路线图的质量及投资优先级也在评估范围内。&lt;/p>
&lt;h3 id="商业模式">商业模式
&lt;/h3>&lt;p>评估供应商的商业模式是否设计合理且执行有效，能否持续取得成功。考量因素包括对定价模式的预判、业务逻辑以及与开源社区的关系。&lt;/p>
&lt;h3 id="创新">创新
&lt;/h3>&lt;p>评估供应商在新兴技术领域的创新能力，以及对 AI/ML 等新技术的运用，是否能推动产品开发，并与第三方和合作伙伴建立协同效应。&lt;/p>
&lt;h3 id="地理战略">地理战略
&lt;/h3>&lt;p>评估供应商是否具备针对全球市场的战略，能否通过本地资源、合作伙伴和 SaaS 平台满足各地区的需求。考量因素包括区域员工数量、SaaS 平台位置及地区化市场策略的调整。&lt;/p>
&lt;p>本次魔力象限中使用的愿景完整性评估标准列于表 2。&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>评估标准&lt;/th>
&lt;th>权重&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>市场理解&lt;/td>
&lt;td>高&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>市场策略&lt;/td>
&lt;td>中&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>销售策略&lt;/td>
&lt;td>中&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>产品策略&lt;/td>
&lt;td>高&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>商业模式&lt;/td>
&lt;td>高&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>垂直行业策略&lt;/td>
&lt;td>未评级&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>创新&lt;/td>
&lt;td>高&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>地理策略&lt;/td>
&lt;td>中&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="象限描述">象限描述
&lt;/h2>&lt;h3 id="领导者">领导者
&lt;/h3>&lt;p>领导者象限中的供应商提供强大的可观测性产品，能够满足市场的广泛需求，并在扩展客户基础方面非常成功。他们拥有广泛的产品组合，提供卓越的分析能力和可见性，且能够与其他 ITOM 技术无缝集成。领导者具备优异的愿景与执行力，能够满足当前和未来市场的需求，同时持续在创新和客户体验方面表现出色。&lt;/p>
&lt;h3 id="挑战者">挑战者
&lt;/h3>&lt;p>挑战者象限中的供应商通常具备广泛的市场覆盖和大规模的客户部署。他们在执行方面表现强劲，得益于公司整体的销售和品牌影响力。这些供应商通常提供广泛的产品组合，部分供应商可能正处于产品转型阶段，逐步调整其市场焦点。&lt;/p>
&lt;h3 id="远见者">远见者
&lt;/h3>&lt;p>远见者象限中的供应商具备创新计划，能够应对市场需求，但其产品组合尚不成熟。他们在执行方面的能力略低，通常在应对市场变化、整合产品功能以及扩大市场份额方面相对较弱。&lt;/p>
&lt;h3 id="利基参与者">利基参与者
&lt;/h3>&lt;p>利基参与者象限中的供应商主要专注于特定市场或垂直领域，或仅满足有限的使用场景需求。由于他们无法在所有核心功能上表现出深度，通常无法满足更广泛市场的需求。纳入该象限并不意味着其在所竞争市场中的价值受到质疑。&lt;/p>
&lt;h3 id="背景">背景
&lt;/h3>&lt;p>&lt;strong>可观测性平台：未来展望&lt;/strong>&lt;/p>
&lt;p>过去几年里，observability 市场一直在快速发展，竞争激烈，供应商背景和规模各异，开源产品的比例也逐渐增加。虽然产品质量和功能不断提升，但随之而来的成本也在上涨。许多客户开始质疑是否值得为 observability 支付高昂的成本。&lt;/p>
&lt;p>IT 运营同样受到了 AI 技术的深刻影响，尤其是在本次魔力象限项目中，这一现象尤为明显。客户常常询问 AI 在 IT 运营中的角色，以及它与 AIOps 的关系。&lt;/p>
&lt;p>可观测性平台本质上是数据管理和分析工具，越来越多的工具开始将 AI 技术作为基础功能，包括自适应阈值、异常检测等。AI 在可观测性平台中的作用将继续演进，但 Gartner 鼓励客户根据具体的用例评估产品的适用性，而非仅仅关注特定技术的有无。&lt;/p>
&lt;p>市场中的可观测性产品种类繁多，几乎总有一个产品能够满足客户的独特需求。由于魔力象限的篇幅限制，许多优秀的供应商未能被纳入本次研究。如果有任何问题，欢迎联系我们。&lt;/p>
&lt;h2 id="市场概览">市场概览
&lt;/h2>&lt;p>从 APM（应用性能管理）到可观测性平台的发展，反映了市场的更广泛趋势。随着商业数字化、云的普及以及技术在日常生活中扮演的核心角色，工作负载和遥测数据的复杂性和规模都在不断增长，这对理解系统健康、性能和用户体验的能力提出了更高的要求。&lt;/p>
&lt;h3 id="市场扩展">市场扩展
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>现有客户中的扩展&lt;/strong>：过去，APM 工具主要用于监控少量关键应用。但随着可观测性平台功能的提升、部署的简化以及价格下降，更多的应用开始使用这些工具。面对经济波动，组织更倾向于选择能够全面覆盖遥测数据的“全栈”解决方案。&lt;/li>
&lt;li>&lt;strong>新行业的扩展&lt;/strong>：APM 和 可观测性工具最初多应用于 IT 系统成熟的大型企业。如今，中小企业也逐渐采用这些工具，特别是那些基于开源技术的解决方案，帮助他们更轻松地转向现代可观测性平台。&lt;/li>
&lt;li>&lt;strong>云服务商的竞争&lt;/strong>：随着企业在 observability 上的投入增加，云服务商（CSP）也开始推出具备竞争力的原生 可观测性工具，尤其在多平台环境中，它们的吸引力越来越大。&lt;/li>
&lt;/ul>
&lt;h3 id="未来趋势">未来趋势
&lt;/h3>&lt;p>未来几年，可观测性平台市场将继续受到以下趋势的推动：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>数据整合需求&lt;/strong>：用户需要在不切换工具的情况下，整合和分析来自不同源的遥测数据。&lt;/li>
&lt;li>&lt;strong>AI 驱动的自主功能&lt;/strong>：随着 AI 的进步，监控工具将逐渐融入自适应阈值、异常检测等自动化功能，甚至具备更高层次的优化能力。&lt;/li>
&lt;li>&lt;strong>网络安全集成&lt;/strong>：可观测性平台开始增加网络安全功能，未来可能成为此领域的重要竞争者。&lt;/li>
&lt;li>&lt;strong>AI 和 LLM 监控&lt;/strong>：随着 AI 和大语言模型工作负载的部署，可观测性平台将优先支持这些新兴领域。&lt;/li>
&lt;li>&lt;strong>集中式 observability 团队&lt;/strong>：越来越多的组织成立专门团队来集中管理 SLO、遥测数据和事故响应。&lt;/li>
&lt;li>&lt;strong>SaaS 和云服务监控&lt;/strong>：随着更多关键业务依赖 SaaS 和云服务，可观测性平台供应商将继续扩展对这些领域的支持。&lt;/li>
&lt;li>&lt;strong>并购与整合&lt;/strong>：市场的重组仍在继续，未来将有更多并购、产品更新和整合，这将改变供应商格局。&lt;/li>
&lt;/ul>
&lt;h2 id="证据">证据
&lt;/h2>&lt;p>本次研究基于过去 12 个月中超过 1000 次客户互动。此外，我们还结合了来自 Gartner Peer Insights、客户咨询以及公开资料的信息，以补充供应商提供的数据。&lt;/p>
&lt;h3 id="评估标准定义">评估标准定义
&lt;/h3>&lt;h4 id="执行能力-1">执行能力
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>产品/服务&lt;/strong>：评估供应商为市场提供的核心产品和服务，包括当前产品功能、质量、特性、以及是否通过 OEM 协议或合作伙伴提供。&lt;/li>
&lt;li>&lt;strong>整体可行性&lt;/strong>：衡量供应商整体的财务健康状况及其业务单元的成功，评估其继续投资、创新和提供产品的能力。&lt;/li>
&lt;li>&lt;strong>销售执行/定价&lt;/strong>：评估供应商在销售中的能力，包括交易管理、定价策略、售前支持和销售渠道的整体效率。&lt;/li>
&lt;li>&lt;strong>市场响应能力/记录&lt;/strong>：评估供应商根据市场机会、客户需求变化和竞争对手行为的响应能力，以及其在应对市场变化中的灵活性。&lt;/li>
&lt;li>&lt;strong>市场执行&lt;/strong>：评估供应商推广其品牌、提升产品知名度和影响客户心智的能力。包括宣传、促销、思想领导力等活动的效果。&lt;/li>
&lt;li>&lt;strong>客户体验&lt;/strong>：衡量供应商通过产品和服务帮助客户取得成功的能力，特别是技术支持、客户服务以及服务级别协议等方面的表现。&lt;/li>
&lt;li>&lt;strong>运营&lt;/strong>：评估供应商是否具备有效管理和运营其业务的能力，包括组织结构、项目管理、系统和其他运营工具的质量。&lt;/li>
&lt;/ul>
&lt;h4 id="愿景完整性">愿景完整性
&lt;/h4>&lt;ul>
&lt;li>&lt;strong>市场理解&lt;/strong>：衡量供应商理解客户需求并将其转化为产品和服务的能力，展示出清晰的愿景，并能够通过这些愿景引领市场发展。&lt;/li>
&lt;li>&lt;strong>营销策略&lt;/strong>：供应商的营销信息是否清晰、具有差异化，并通过多种渠道有效传达。&lt;/li>
&lt;li>&lt;strong>销售策略&lt;/strong>：评估供应商的销售策略是否覆盖全面，包括直接和间接销售渠道的利用，以及市场覆盖的深度和广度。&lt;/li>
&lt;li>&lt;strong>产品策略&lt;/strong>：供应商在产品开发和交付中的策略是否能够满足当前和未来的市场需求，并体现差异化。&lt;/li>
&lt;li>&lt;strong>商业模式&lt;/strong>：评估供应商的商业模式是否合理且具备可持续性。&lt;/li>
&lt;li>&lt;strong>垂直/行业策略&lt;/strong>：供应商在特定市场细分中的资源配置和产品战略。&lt;/li>
&lt;li>&lt;strong>创新&lt;/strong>：供应商在新技术、整合和协同创新方面的能力和投资力度。&lt;/li>
&lt;li>&lt;strong>地理战略&lt;/strong>：评估供应商是否具备全球扩展的战略，能够根据不同地区的需求调整资源和产品策略。&lt;/li>
&lt;/ul>
&lt;p>原文：&lt;a class="link" href="https://www.gartner.com/doc/reprints?id=1-2HXS17MG&amp;amp;ct=240627&amp;amp;st=sb" target="_blank" rel="noopener"
>https://www.gartner.com/doc/reprints?id=1-2HXS17MG&amp;ct=240627&amp;st=sb&lt;/a>&lt;/p>
&lt;p>❤️ Feature Photo by Pavel Danilyuk: &lt;a class="link" href="https://www.pexels.com/photo/a-bearded-man-with-a-hat-using-binoculars-9143804/" target="_blank" rel="noopener"
>https://www.pexels.com/photo/a-bearded-man-with-a-hat-using-binoculars-9143804/&lt;/a>&lt;/p></description></item><item><title>Google 白皮书：产品导向的 SRE 可靠性</title><link>https://martinliu.cn/blog/product-focused-reliability-for-sre/</link><pubDate>Wed, 12 Jun 2024 13:25:58 +0800</pubDate><guid>https://martinliu.cn/blog/product-focused-reliability-for-sre/</guid><description>&lt;img src="https://martinliu.cn/blog/product-focused-reliability-for-sre/pexels-pavel-danilyuk-7868970.jpg" alt="Featured image of post Google 白皮书：产品导向的 SRE 可靠性" />&lt;blockquote>
&lt;p>作者：Carl Crous, Parker Roth 和 Victoria Hurd；
译者：刘征
原文：&lt;a class="link" href="https://sre.google/resources/practices-and-processes/product-focused-reliability-for-sre/" target="_blank" rel="noopener"
>https://sre.google/resources/practices-and-processes/product-focused-reliability-for-sre/&lt;/a>&lt;/p>&lt;/blockquote>
&lt;h2 id="介绍">介绍
&lt;/h2>&lt;p>站点可靠性工程师（SRE）传统上通过其服务间接支持产品，负责服务质量目标（SLO），并提高服务的可靠性。然而，这种方法存在一些局限，有可能影响产品和用户体验：&lt;/p>
&lt;ul>
&lt;li>服务仅能部分满足用户需求和业务目标。度量服务的可靠性只是对用户需求或业务目标的近似。&lt;/li>
&lt;li>用户界面（UI）越来越复杂。在 UI 和 SRE 度量的服务之间存在许多层次，导致产品覆盖的显著差距。&lt;/li>
&lt;li>服务增长可能轻易超过组织的工程增长，导致服务被忽视或团队负担过重。&lt;/li>
&lt;li>服务支持优化了产品整体可靠性和性能的一小部分，而在这些服务范围之外存在显著风险。&lt;/li>
&lt;li>服务本质上是同步的。异步流程常常被忽视或难以优先处理，因为其成功无法通过单一服务来度量。&lt;/li>
&lt;/ul>
&lt;p>本文探讨了这些限制，并讨论了一些 Google SRE 团队如何通过将支持重新聚焦于产品和最终用户需求来解决这些问题，而不是集中于基础设施和服务。我们还讨论了 SLO 策略，描述了 Google SRE 如何定义产品，并解释了如何决定哪些因素对实现产品可靠性至关重要。&lt;/p>
&lt;p>&lt;strong>产品参与度&lt;/strong>&lt;/p>
&lt;p>为了支持产品，SRE 需要熟悉产品及其功能的设计和开发。同时，还需要了解终端用户在使用产品时的目标。&lt;/p>
&lt;p>为了获取产品和用户信息，SRE 需要与产品经理和用户体验研究人员合作。这些人根据“要完成的工作”（Jobs to be Done）和 Google 的关键用户旅程（CUJ）等框架定义产品和功能，这些框架识别终端用户的目标和期望结果。&lt;/p>
&lt;p>使用这些信息，SRE 可以识别出对产品及其用户重要的内容，并用定义产品的相同语言来定义可靠性。&lt;/p>
&lt;h2 id="服务支持模型">服务支持模型
&lt;/h2>&lt;p>SRE 的核心责任是“负责其支持服务的可用性、延迟、性能、效率、变更管理、监控、应急响应和容量规划”[3]。&lt;/p>
&lt;p>在这种模型中，服务是 SRE 团队的主要“所有权单位”和“工作对象”。这种对服务的关注是 SRE 团队从传统上所建立的方式。它驱动了 SRE 按怎样的优先级别处理工作、度量性能，并扩大范围，从而能支持到更多的服务。&lt;/p>
&lt;p>从传统上看，SRE 在基于服务的工作中表现出色，能确保他们所支持的服务具有高可用性。然而，服务的可用性并不总是能等同于：用户对产品的满意，原因如下：&lt;/p>
&lt;ul>
&lt;li>产品仍然会发生超出 SRE 团队范围的故障，例如 Web端 或移动应用中的问题。&lt;/li>
&lt;li>SRE 团队花时间响应了可能对用户并没有影响的状况。例如，HTTP 404 错误可能并不会影响用户。&lt;/li>
&lt;/ul>
&lt;p>当 SRE 的职责范围仅限于某一组服务时，SRE 团队通常并没有足够的信息来有效解决以上问题。相反，SRE 被迫在并不了解服务应如何表现的情况下，来评估这些服务。&lt;/p>
&lt;p>SRE 团队其实可以接受对产品本身的责任，而不仅限于对服务可靠性的责任。这种在更高层面上的 &lt;strong>优先考虑产品，而不是服务&lt;/strong> 的承诺。我们称其为产品支持模型，它开启了一种新的可靠性思维方式。&lt;/p>
&lt;h2 id="产品支持模型">产品支持模型
&lt;/h2>&lt;p>这种新产品支持模型的核心是: SRE 负责产品关键功能的可靠性。过去，SRE 会被分配了&lt;strong>一组服务&lt;/strong>，它们在彼时都是受到重视的关键服务。现在，SRE 会被分配了&lt;strong>一组功能和用户想要的结果&lt;/strong>。在没有传统服务所有权固定边界的情况下，SRE 团队可以将其优先事项与业务和用户结果对齐，并在每一层服务堆栈中处理更广泛和更有影响力的工作。&lt;/p>
&lt;blockquote>
&lt;p>“如果你不能度量它，你就不能改进它。” — 彼得·德鲁克&lt;/p>&lt;/blockquote>
&lt;p>在工程团队能够管理产品的可靠性之前，必须先能够度量其可靠性。建立一套提供足够广度和深度覆盖的度量标准是至关重要的，这有助于团队识别最具影响力的工程工作，同时避免想要过度优化任何特定系统的诱惑。&lt;/p>
&lt;p>在团队能够度量产品的可靠性之前，必须先知道要度量什么，以及如何度量。需要度量的内容：来自于将产品建模为一组用户可见的行为或功能，并根据它们给用户带来的价值，对这些用户行为进行优先级排序。在掌握了这份优先级列表后，团队可以开始从支持团队/服务，转型为支持产品及其用户。&lt;/p>
&lt;p>图 1 说明了如何通过与利益相关者对齐、产品建模和度量的坚实基础，来实现提高产品可靠性的终极目标。同在这些概念上达成的共识，能使团队能够将资源投入到对最终用户和业务最具影响力的问题上。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/product-focused-reliability-for-sre/prbw.webp"
width="3840"
height="1655"
srcset="https://martinliu.cn/blog/product-focused-reliability-for-sre/prbw_hu_17a862cd226ec73.webp 480w, https://martinliu.cn/blog/product-focused-reliability-for-sre/prbw_hu_49b07369473f2a0e.webp 1024w"
loading="lazy"
alt="图 1：产品可靠性引导工作流程"
class="gallery-image"
data-flex-grow="232"
data-flex-basis="556px"
>&lt;/p>
&lt;h2 id="开始">开始
&lt;/h2>&lt;p>在本节中，你将学习如何实施以产品为中心的可靠性参与（engage），包括以下关键步骤：&lt;/p>
&lt;ol>
&lt;li>与利益相关者对齐&lt;/li>
&lt;li>建模产品&lt;/li>
&lt;li>度量性能&lt;/li>
&lt;li>管理可靠性&lt;/li>
&lt;/ol>
&lt;p>每个步骤列出了为 SRE 团队带来价值的中间交付物及其解锁的机会。我们鼓励你按顺序进行，但也指出了可以利用现有指标和关系的领域。&lt;/p>
&lt;h3 id="1-与你的利益相关者对齐">1. 与你的利益相关者对齐
&lt;/h3>&lt;p>与任何 SRE 参与过程类似，第一步是确定相关的利益相关者。在基于服务的参与中，依赖于 SRE 和开发团队之间的合作，而以产品为中心的参与则需要更多样化的合作伙伴。这里的更广泛的合作伙伴通常包括以下角色：&lt;/p>
&lt;ul>
&lt;li>产品经理：定义产品策略和需求。&lt;/li>
&lt;li>UX 设计师和研究人员：将需求转化为用户体验。&lt;/li>
&lt;li>工程团队：开发必要的功能和基础设施以实现用户体验。【译者注：在以服务为支持对象的模式中，SRE 仅重点关注&amp;amp;合作此方】&lt;/li>
&lt;li>支持专家：通过直接或书面沟通与最终用户互动。&lt;/li>
&lt;/ul>
&lt;p>为了成功的管理产品可靠性，关键是要确定每个角色的责任。&lt;/p>
&lt;blockquote>
&lt;p>交付物：记录角色和职责的文档，例如 RACI 矩阵[7]。&lt;/p>&lt;/blockquote>
&lt;p>在确定了所有的利益相关者后，与他们会面沟通，启动 SRE 的合作伙伴关系。&lt;/p>
&lt;h3 id="2-建模产品">2. 建模产品
&lt;/h3>&lt;p>人们（用户）使用产品是为了实现他们在现实世界里的目标。为了帮助产品团队构建能够促进用户目标的产品和服务，你需要了解产品用户的目标。&lt;/p>
&lt;p>本节介绍了两个关键概念：用户目标和步骤。用户目标描述了用户的意图和他们想要实现的目标。例如，邮件服务的一个目标可能是“与人交流”。步骤是用户为实现其目标而采取的各个独立操作。&lt;/p>
&lt;p>“要完成的工作”（JTBD）[1,5] 框架将用户目标建模为工作，而 Google 的关键用户旅程（CUJs）[2] 将用户目标建模为伴随一系列任务或步骤的目标。&lt;/p>
&lt;p>了解用户在使用产品或功能时的目标是软件开发的有力工具，因为它为你提供了关于产品最重要方面的清晰信号。用户的意图也是 SRE 可以利用的强大可靠性工具。&lt;/p>
&lt;p>假设你的产品是使用“要完成的工作”框架构建的，那么你将拥有一份有待促进的&lt;strong>用户目标列表&lt;/strong>。产品经理、UX 设计师和其他非工程学科角色，也都可能拥有这份列表。这份列表提供了用户期望目标的高阶描述，基于跨职能的数据，为涉及软件开发生命周期的许多学科提供了共同的语言。利用这些共享的用户目标作为产品支持的基础是建模产品可靠性的基础第一步。&lt;/p>
&lt;p>然而，如果你还没有用户目标列表，可能就需要自己开发这份列表，这将带来显著的工程成本，并导致只有 SRE 愿意使用该列表。更好的方法是与产品经理合作，并鼓励他们采用某种框架，并来负责定义用户目标。&lt;/p>
&lt;p>用户目标被分解为：用户为实现其总体目标，所要采取的一系列步骤。每个步骤都是独立的工作单元，与其他步骤无关。这些步骤提供以下信息：&lt;/p>
&lt;ul>
&lt;li>解释当用户在使用产品时，他们在做什么，或用户目标是什么。&lt;/li>
&lt;li>定义每个步骤的开始条件和多个成功或失败条件。&lt;/li>
&lt;li>可以与产品界面或基础设施相关联的具体操作列表，例如用户发送电子邮件时调用的 RPC。&lt;/li>
&lt;/ul>
&lt;p>以上用户目标只是：一个将步骤组合在一起的组织元素。&lt;/p>
&lt;p>基于这些步骤，你可以确定完成这些步骤所需用到的产品界面和基础设施的哪些部分。某个界面或基础设施服务的某些部分可能会涉及到不同的目标，因此它们可以具有不同的重要性级别。&lt;/p>
&lt;blockquote>
&lt;p>交付物：一个产品的用户目标登记表，包含了所有用户目标和步骤的高阶描述。&lt;/p>&lt;/blockquote>
&lt;p>&lt;strong>邮件服务产品定义示例&lt;/strong>&lt;/p>
&lt;p>让我们考虑一个允许用户发送和接收电子邮件的邮件产品，还具有一些增值功能。我们将根据表 1 中描述的目标和步骤来建模此产品，并在图 2 中进行了说明。表 1 提供了可以被产品开发和支持中涉及的多个学科使用的基本产品模型。&lt;/p>
&lt;p>表 1: 用户目标和步骤示例&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>目标&lt;/th>
&lt;th>步骤&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>撰写邮件&lt;/td>
&lt;td>登录&lt;/td>
&lt;td>用户在登录页面进行身份验证。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>打开撰写对话框&lt;/td>
&lt;td>用户点击**“撰写”**按钮，撰写对话框被显示出来。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>查找地址&lt;/td>
&lt;td>用户开始输入收件人的电子邮件地址，系统显示匹配的地址供选择。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>检查拼写&lt;/td>
&lt;td>当用户输入消息时，系统会突出显示拼写错误。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>发送邮件&lt;/td>
&lt;td>用户点击**“发送”**按钮，邮件被排队等待发送。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>阅读邮件&lt;/td>
&lt;td>登录&lt;/td>
&lt;td>用户在登录页面进行身份验证。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>打开收件箱&lt;/td>
&lt;td>用户打开收件箱页面，显示所有邮件。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>打开邮件&lt;/td>
&lt;td>用户选择一封邮件，系统显示邮件内容。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>接收邮件（异步）&lt;/td>
&lt;td>当邮件服务收到新邮件时，它们会自动显示在用户的收件箱中。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;img src="https://martinliu.cn/blog/product-focused-reliability-for-sre/gmail.webp"
width="3593"
height="1443"
srcset="https://martinliu.cn/blog/product-focused-reliability-for-sre/gmail_hu_8d30cd89c8cf5506.webp 480w, https://martinliu.cn/blog/product-focused-reliability-for-sre/gmail_hu_6aac2f98b3fc6679.webp 1024w"
loading="lazy"
alt="图 2: 用户目标和步骤的流程图（见表 1）"
class="gallery-image"
data-flex-grow="248"
data-flex-basis="597px"
>&lt;/p>
&lt;p>&lt;strong>产品重要性和优先级&lt;/strong>&lt;/p>
&lt;p>在转型到&lt;strong>产品支持模型&lt;/strong>时，请记住，SRE 团队在学习这种新方法时会面临更大的认知负荷。请通过战略性选择支持的方式和位置，来管理 SRE 团队的额外工作量。&lt;/p>
&lt;p>例如，你可能希望将大量支持集中在核心用户目标及其步骤上，并用高成本但准确的端到端 SLO 对其进行监控。在这种情况下，你还可以通过更便宜和传统的基于服务器的 SLO 支持较不重要的目标。&lt;/p>
&lt;p>安排 SRE 工作的优先级本身就是一个具有挑战性的问题。我们通过基于特定目标与产品关键绩效指标（KPI）之间的关系，来定义重要性来解决这个问题。这些指标通常已被用来评估停机的严重性，因此使用这些 KPI 来安排 SRE 任务的优先度，可以确保 SRE 跟上不断变化的产品需求。&lt;/p>
&lt;p>在 Google，我们使用特定产品的严重性指南（如 Google Cloud 重大事故 [6] 的场景）来指示停机对产品的严重性和影响。在 Google Ads 中，收入是评估停机严重性的关键指标，而在 YouTube 中，严重性指南包括用户观看视频的时间。参见邮件服务严重性示例，了解如何为典型的邮件服务定义严重性指南。这种分类主要用于衡量停机的影响，但也提供了一个明确的重要性信号，你可以将其应用于其他领域。&lt;/p>
&lt;p>严重性指南通常以对用户的影响为准，因此与用户目标和步骤密切相关。使用严重性指南，你可以根据严重停机对产品或功能的影响来组织用户目标和步骤，这被定义为产品重要性。参见邮件服务产品重要性示例，了解如何为典型的邮件服务定义产品重要性。&lt;/p>
&lt;p>这种重要性定义为优先安排 SRE 工作提供了明确的指导方针。确保整个基础设施有良好的基本覆盖，并制定评估更有针对性努力的投资回报的原则。考虑在关注不太重要的目标之前，你希望为最重要的目标实现什么级别的可靠性。&lt;/p>
&lt;p>通常，团队会陷入寻求一种新方法来解决可靠性问题的陷阱，然后试图将这种方法应用于所有场景，而不考虑适用性。然而，监控的初始化成本和在各处部署改进的持续维护成本的总和其实并不都合理的。例如，离线或批处理流量与互动用户流量相比，具有不同的可用性和延迟需求，因此每类流量需要不同的 SLO。&lt;/p>
&lt;p>更深入地了解对产品重要的内容还具有许多优势，从知道测试覆盖的重要性，到更好的事故响应。如果 SRE 知道问题很严重，他们会更快地反应和升级，从而更快地解决问题。&lt;/p>
&lt;blockquote>
&lt;p>交付物：一套与产品的用户目标和步骤一致的严重性和重要性定义。&lt;/p>&lt;/blockquote>
&lt;p>&lt;strong>邮件服务严重性示例&lt;/strong>&lt;/p>
&lt;p>继续邮件服务产品定义示例，我们定义了产品的事故严重性分级如下：&lt;/p>
&lt;p>表 2: 事故严重性分级示例&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>严重性&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>重大&lt;/td>
&lt;td>任何影响接收或发送邮件的情况。对核心功能有 &amp;gt;20% 的影响。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>中等&lt;/td>
&lt;td>对核心功能有 &amp;gt;5% 的影响。对辅助功能有 &amp;gt;20% 的影响。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>轻微&lt;/td>
&lt;td>对任何功能有 &amp;gt;0% 的影响。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>在这个例子中，核心功能是用户需要用来阅读和撰写邮件的功能，例如认证系统或地址簿是辅助功能，例如拼写检查和自动补齐等，虽然增加了价值，但并不是产品使用的关键。&lt;/p>
&lt;p>影响的定义因产品而异，取决于独特的用户和业务需求。一些产品可能只关注技术影响，例如失败请求的百分比或延迟超过可接受阈值的请求百分比。其他产品可能关注收入损失、品牌损害或其他与业务 KPI 更直接相关的概念。无论为产品选择哪些标准，考虑以下关键原则是很重要的：&lt;/p>
&lt;ul>
&lt;li>结果集合应覆盖用户感知行为和业务优先级的所有方面。&lt;/li>
&lt;li>应能够以及时和可持续的方式确定事故的严重性。&lt;/li>
&lt;li>产品和工程领导层之间应对事故严重性非分级有广泛一致的意见。&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>邮件服务产品重要性示例&lt;/strong>&lt;/p>
&lt;p>使用邮件服务严重性示例中的严重性分级，下面我们来定义产品的重要性如下：&lt;/p>
&lt;p>表 3: 产品重要性定义示例&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>重要性&lt;/th>
&lt;th>描述&lt;/th>
&lt;th>用户目标 &amp;gt; 步骤&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>关键&lt;/td>
&lt;td>负责邮件传输和投递的服务，是核心功能的关键（非可有可无）依赖项。&lt;/td>
&lt;td>撰写邮件、 阅读邮件&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>重要&lt;/td>
&lt;td>非关键的核心功能依赖项（优雅降级）或辅助功能的依赖项。&lt;/td>
&lt;td>撰写邮件 &amp;gt; 检查拼写 、 阅读邮件 &amp;gt; 过滤垃圾邮件&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>无&lt;/td>
&lt;td>所有其他服务，通常是内部或未发布的功能。&lt;/td>
&lt;td>所有未被识别为产品优先级的其他产品功能。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>你可以看到，重要性定义是围绕用户目标（例如撰写和发送邮件）建模的，而不是系统如何实现这些需求。一些具体步骤（例如检查拼写和过滤垃圾邮件）如果不被视为目标的关键组成部分，其重要性可能会有所不同。一些方面没有明确列出，例如身份验证，因为这是大多数目标中的一个步骤。&lt;/p>
&lt;p>&lt;strong>附加价值&lt;/strong>&lt;/p>
&lt;p>虽然 &lt;strong>度量性能&lt;/strong> 讨论了如何使用这个产品模型作为衡量产品性能的基础，但这不是该模型提供的唯一价值。对产品的用户目标有清晰的理解，可以在对用户需求的达成共识的基础上，协调测试策略、产品使用指标和其他生产问题。&lt;/p>
&lt;h3 id="3-度量性能">3. 度量性能
&lt;/h3>&lt;p>服务质量目标（SLO）是任何 SRE 团队工作的关键组成部分，提供反映系统可靠性的实际指标。《Google SRE 工作手册》[4] 是定义 SLO 和服务质量指标（SLI）的详细资源，并描述了如何使用它们，特别是针对服务。&lt;/p>
&lt;p>基于服务的 SLO 通常无法提供足够的产品覆盖。一些问题无法通过对某个服务器的监控覆盖，例如网络间或移动应用程序中的问题，或异步操作产生的问题等。&lt;/p>
&lt;p>当 SRE 团队发现基于服务的 SLO 存在不足时，他们会开始以多种方式扩展 SLO。从而提供更广泛产品覆盖的 SLO 主要有三类：服务 SLO、客户端埋点和端到端 SLO。&lt;/p>
&lt;p>&lt;strong>服务 SLO&lt;/strong>&lt;/p>
&lt;p>服务 SLO 是最常见的 SLO 类型。它们通过服务本身的指标进行监控，例如应用服务器日志或实时监控指标【译者注：包括后台服务埋点的 APM 数据】。也可以通过服务上层的日志进行度量，例如负载均衡器。你还可以使用黑盒监控（如拨测）结果来度量服务正常运行时间。&lt;/p>
&lt;p>以下是服务 SLO 的主要特征：&lt;/p>
&lt;p>表格 4: 服务 SLO 特征&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>特征&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>低成本&lt;/td>
&lt;td>服务 SLO 常见且广泛使用。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>高信心&lt;/td>
&lt;td>服务 SLO 的数据在你的控制之下，可以提供非常高的可用性保证，例如对 SLO 数据的 SLO 保证。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>低延迟&lt;/td>
&lt;td>你可以以非常低的延迟收集和处理数据，从几秒到几分钟。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>覆盖范围狭窄&lt;/td>
&lt;td>这些 SLO 仅涵盖服务能看到的内容。通过在服务堆栈的更高层次度量 SLO，可以改善这一点。如果返回结果被服务视为成功，则 SLO 不受影响。然而，成功（正常）的结果并不总是保证结果有用（用户不受影响），例如返回空响应或向旧客户端返回不兼容的新数据。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>客户端埋点&lt;/strong>&lt;/p>
&lt;p>随着网络和移动应用程序的用户界面变得越来越复杂，越来越多的 SRE 团队开始直接支持这些界面。这可以通过直接从用户界面获取遥测数据来实现【译者注：包括真实用户监控-RUM】。&lt;/p>
&lt;p>这种遥测需要记录事件的日志或监控侧通道，这些事件可以处理并用于定义 SLO。&lt;/p>
&lt;p>这些数据通常需要批处理，并在后台发送，与交互式 RPC 请求分开。当应用程序关闭或失去网络连接时，一些遥测数据可能会丢失。所有这些因素都会影响数据的可靠性，预计会有一些个位数百分比的损失。此外，度量客户端设备上的信号还包括：测量设备的性能和互联网连接。&lt;/p>
&lt;p>然而，客户端 SLO 提供了用户实际体验到的产品性能的有用洞察信息。你可以使用这些 SLO 为连接较不可靠的用户提供更好的体验。当可以从用户界面度量开始和结束条件时，界面行为的复杂性，例如缓存、重试和异步 RPC 请求，都是透明的。&lt;/p>
&lt;p>在决定何时以及如何使用客户端 SLO 时，请考虑以下所有特征：&lt;/p>
&lt;p>表格 5 : 客户端 SLO 特征&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>特征&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>中等成本&lt;/td>
&lt;td>客户端 SLO 的埋点需要在用户界面中添加埋点探针功能以获取 RUM 数据，并需要一个系统来接收、处理数据，并设置 SLO 管理。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>低信心&lt;/td>
&lt;td>预期会有数据丢失。监控可能会受到性能较差的客户端设备和互联网连接的影响。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>中等延迟&lt;/td>
&lt;td>信号通常从客户端设备批量传输。这些信号量数据需要进行额外的处理后，才能用于 SLO 管理，从而导致 15 分钟到 1 小时的延迟。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>广泛覆盖&lt;/td>
&lt;td>来自客户端设备的指标允许 SLO 直接衡量用户对产品性能和可靠性的体验。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>端到端 SLO&lt;/strong>&lt;/p>
&lt;p>有些产品功能和业务指标不能通过服务或客户端埋点直接度量。这些通常需要结合来自多个来源的数据，并涉及异步任务。&lt;/p>
&lt;p>例如，用户可能要求生成报告。用户界面发送一个 RPC 请求，该请求在报告被排入系统队列后成功。但这并不意味着报告成功生成。某些后台系统从队列中取出报告并生成它，或未能生成。要度量报告是否成功生成，你需要将用户的原始 RPC 请求与最终的报告生成结果结合起来。&lt;/p>
&lt;p>端到端 SLO 通常根据用户交互来度量其 SLI，因此可以提供相当准确的结果。&lt;/p>
&lt;p>实现端到端 SLO 需要相当多的工程工作量，因为你需要完成以下任务：&lt;/p>
&lt;ul>
&lt;li>确定度量 SLI 所需的数据集。&lt;/li>
&lt;li>采集和存储所需的数据。&lt;/li>
&lt;li>汇总并结合来自多个来源的数据。&lt;/li>
&lt;/ul>
&lt;p>端到端 SLO 的主要特征如下：&lt;/p>
&lt;p>表格 6: 端到端 SLO 特征&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>特征&lt;/th>
&lt;th>描述&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>非常高的成本&lt;/td>
&lt;td>端到端 SLO 的埋点可能需要数月的工程工作。每个 SLO 都可能带来独特的工程挑战和约束。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>高信心&lt;/td>
&lt;td>你可以使用多个数据源，并且可以通过交叉引用来跟踪任何数据源中的丢失数据。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>高延迟&lt;/td>
&lt;td>结合来自多个来源的信号可能既耗时又复杂。持续处理新数据成本高，因此通常优先选择离线批处理解决方案（通常每天或每几小时运行一次）。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>覆盖范围窄&lt;/td>
&lt;td>端到端 SLO 旨在覆盖非常特定的功能或业务指标，并且以最高的信心度进行。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>优先级&lt;/strong>&lt;/p>
&lt;p>网络、移动应用程序和其他互联网连接设备变得越来越复杂，这推动了微服务架构的兴起，简化和扩展了运行现代应用程序所需的服务。&lt;/p>
&lt;p>全球服务器数量呈指数级增长，这在 GCP 等公共云提供商的增长中可以看到。然而，全球软件工程师的数量增长较为缓慢。&lt;/p>
&lt;p>需要认识到，每个 SLO 都有维护其底层数据，以及响应 SLO 失效的持续成本。某些产品功能也可能会随着时间的推移变得不那么重要，而其他功能可能在产品的整个生命周期中保持关键地位。&lt;/p>
&lt;p>软件工程师和站点可靠性工程师需要优先考虑哪些 SLO 仍然相当重要，它决定了 SRE 要在哪些方面投入时间以提高产品的可靠性。&lt;/p>
&lt;p>&lt;strong>产品 SLO&lt;/strong>&lt;/p>
&lt;p>产品级 SLO 是围绕用户实现目标的步骤定义的。通过利用&lt;strong>用户目标步骤&lt;/strong>信息注释（编者注：打标签或者元数据）和扩展，任何 SLO（如服务、客户端或端到端）都可以转换为产品级 SLO。&lt;/p>
&lt;p>进行将 SLO 与用户目标相互关联的工作看似比较简单，却能够使你理解 SLO 对用户的意义何在，以及它对产品的重要性。&lt;/p>
&lt;p>当 SLO 是以服务和基础设施为框架时，设置目标或延迟阈值存在一定挑战。但当 SLO 带有了用户目标的附加背景信息时，度量的内容会变得更加清晰。例如，与其问“用户数据服务器上的地址查找服务应该有多可靠和快速？”，不如问“用户在查找电子邮件地址时可以容忍多少错误，这些地址应该多快返回？”&lt;/p>
&lt;p>结合产品功能的关键性，你可以验证 SLO 设置是否合适，且不过于严格。这种方法为你提供了更宽的 SLO 目标范围，反应出了什么对产品重要。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/product-focused-reliability-for-sre/all-4.webp"
width="814"
height="325"
srcset="https://martinliu.cn/blog/product-focused-reliability-for-sre/all-4_hu_5bc38e212b5fbd42.webp 480w, https://martinliu.cn/blog/product-focused-reliability-for-sre/all-4_hu_ddb9e6216d6e0255.webp 1024w"
loading="lazy"
alt="图 3: 产品 SLO 如何围绕用户目标和步骤定义的示例"
class="gallery-image"
data-flex-grow="250"
data-flex-basis="601px"
>&lt;/p>
&lt;blockquote>
&lt;p>交付物：列出覆盖不同 SLO 类型（可用性、延迟）和监控方法（服务端、客户端、端到端）的产品 SLO 的优先级排序清单。实施最高优先级的 SLO，并将较低优先级的 SLO 创建为待办事项，稍后再进行优先级排序。&lt;/p>&lt;/blockquote>
&lt;p>&lt;strong>遥测&lt;/strong>&lt;/p>
&lt;p>在实施产品 SLO 之前，必须先采集相关指标（也称为 SLI），从而跟踪相关的产品功能。为开发出这些指标，需将产品 SLO 模型的概念世界与实际基础设施生产环境对应起来。这是实施产品可靠性模型的关键价值驱动因素。&lt;/p>
&lt;p>例如，团队对 SLO 性能的理解曾经仅限于“数据库写入的可用性为 98%”。而专注于产品的 SLO 需要说明清楚，这 2% 的错误是否导致了 100% 的“保存电子邮件草稿”步骤的失败。&lt;/p>
&lt;p>将概要的可用性度量指标转化为：准确且可操作的产品性能指标的关键在于，理解每个请求所支持的产品功能。除了简单的可观测性需求外，功能请求级信息还可用于流量路由和负载分发策略，确保低优先级功能不会损害更关键的功能。&lt;/p>
&lt;p>虽然你可以通过多种方式将请求与产品功能关联起来，但有需要考虑这样两种主要的方式：客户端注释和服务器端注释。&lt;/p>
&lt;p>表 7: 客户端注释和服务器端注释的比较&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>注释类型&lt;/th>
&lt;th>描述&lt;/th>
&lt;th>用例&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>客户端注释&lt;/td>
&lt;td>更新用户界面（网页和移动应用程序），将用户目标步骤的元数据附加好，并传播到后端服务的 RPC 请求上。这在技术上具有挑战性，需要 UI 团队协助设计，并最终负责维护这些注释。&lt;/td>
&lt;td>使用客户端注释是最准确的映射用户通过界面实现目标的方法。注释是由单个的 RPC 请求携带传播的，因此具有最高的保真度。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>服务器端注释&lt;/td>
&lt;td>分析后端服务器所接收到的 RPC 请求，并推断用户的目标步骤。&lt;/td>
&lt;td>当修改客户端的成本太高或你不拥有客户端（如 REST 服务）时，必须使用此方法。服务器端注释不如客户端注释准确，因为服务器需要做出许多假设来推断 RPC 请求所服务用户步骤（功能）。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>你可能无法注释所有流量。根据产品的关键性分级，你可以决定哪些地方值得添加注释；你可能只注释那些最关键的用户目标。&lt;/p>
&lt;p>注释一个 RPC 请求后，你的服务需要在整个基础设施堆栈中传播该注释。这有助于你在许多 SRE 工具和流程中理解用户的目标及其重要性，包括以下内容：&lt;/p>
&lt;ul>
&lt;li>在监控仪表板和应用程序日志中，通过用户目标步骤了解问题及其影响。&lt;/li>
&lt;li>快速确定哪个用户目标受到了问题影响，从而确定事故的严重性。&lt;/li>
&lt;li>识别只考虑特定的用户目标步骤的服务质量目标 (SLO)，并忽略不重要请求（如批处理和测试流量）。&lt;/li>
&lt;/ul>
&lt;h3 id="4-可靠性管理">4. 可靠性管理
&lt;/h3>&lt;p>现在你已经确定了利益相关者、用户目标和步骤、关键性定义以及产品 SLO，你已准备好支持产品。&lt;/p>
&lt;p>我们建议你从小规模开始支持一个产品或服务。可以先为一些 SLO 启动某一个目标或步骤，然后迭代扩展团队的责任和范围。支持产品是一个持续进行的过程。在每个阶段，你将与利益相关者一起确定在下列投资领域之间的权衡：&lt;/p>
&lt;ol>
&lt;li>改进支持目标集的指标，以增加这些目标符合预期的信心。&lt;/li>
&lt;li>扩展支持目标集，确保产品的所有方面都符合预期。&lt;/li>
&lt;li>解决由投资领域 #1 和 #2 产生的指标所突显的性能差距。&lt;/li>
&lt;/ol>
&lt;p>确保在所有三个领域都有所投资。在领域 #1 和 #2 投资不足会导致团队错过领域 #3 中最有影响力的问题。另一方面，仅在领域 #1 和 #2 投资不会导致对用户和组织业务目标有帮助的改进。使用在关键实施步骤中收集和产生的信息，帮助组织确定在每个领域投资多少。&lt;/p>
&lt;p>&lt;strong>纳管&lt;/strong>&lt;/p>
&lt;p>纳管是 SRE 团队评估其将承担责任的产品或服务的接手的过程。此过程通常包括了解产品或服务以充分支持，并确保其符合 SRE 团队定义的一系列要求。&lt;/p>
&lt;p>在 SRE 团队承担产品的用户目标和步骤责任之前，团队需要定义一个正式的纳管流程，以确保以下内容：&lt;/p>
&lt;ul>
&lt;li>目标和步骤足够重要。&lt;/li>
&lt;li>步骤映射到所使用的服务，并在这些服务中进行了注释。&lt;/li>
&lt;li>潜在的 SLO 已被识别，并在整体产品优先级中进行了优先排序。&lt;/li>
&lt;li>SLO 稳定，支持它们不会对团队或服务所有者构成过度负担。&lt;/li>
&lt;/ul>
&lt;p>SRE 团队推动这个过程，与相关利益相关者会面，并与产品团队合作解决任何不足之处。&lt;/p>
&lt;p>&lt;strong>迭代&lt;/strong>&lt;/p>
&lt;p>在完成一个目标和其部分步骤的纳管过程之后，你可以通过以下方式迭代和改进团队的覆盖范围：&lt;/p>
&lt;ul>
&lt;li>纳管更多的用户目标和步骤。&lt;/li>
&lt;li>优化已经纳管的用户目标和步骤的覆盖范围。&lt;/li>
&lt;li>改进工具，以更好地支持用户目标和步骤。&lt;/li>
&lt;/ul>
&lt;p>我们建议不要试图支持每一个用户目标，而是为你支持的产品中最重要的方面设定一个门槛。同样，我们建议你决定哪些用户目标使用更昂贵的 SLO 方法进行埋点。一些用户目标可能只需要基于服务的 SLO，而其他用户目标可能会受益于客户端或端到端的埋点。&lt;/p>
&lt;p>最后，为了确定在哪里和何时投资改进工具，请评估支持的可持续性。工具不足会导致扩展受限，使团队在支持目标集的无效分类、调试和缓解工作中不堪重负。&lt;/p>
&lt;p>&lt;strong>离岗&lt;/strong>&lt;/p>
&lt;p>为了确保团队专注于产品的正确部分，我们建议团队定期重新评估支持的用户目标、步骤和 SLO。一些 SLO 可能随着时间的推移变得不那么重要，而一些用户目标可能会变得过时。&lt;/p>
&lt;p>维护一个所有支持的用户目标、步骤和 SLO 的优先列表是很重要的。使用此列表来验证团队是否在最重要的领域上花费时间和资源。当列表中的项目不再重要（或远不如不支持的项目重要）时，请考虑将它们离岗，以便团队可以重新专注于产品的最重要方面。&lt;/p>
&lt;p>&lt;strong>服务器支持&lt;/strong>&lt;/p>
&lt;p>在关注产品的同时，不能忽视支撑产品的基础设施服务器。始终需要确保服务器及其提供的服务保持健康。无论服务器对产品有多么重要，确保服务器健康是必要的，因为你花费了资源来运行它们。&lt;/p>
&lt;p>在 Google 专注于产品之前，提出了提供基础支持的概念。基础支持是一组由 SRE 定义的标准和最佳实践，使他们能够在不了解服务器具体用途的情况下为任何服务器提供一般支持。例如，基础支持可以要求某些库和框架提供常见功能，如负载平衡、服务间通信（RPCs），甚至是由主要负责服务器的开发团队拥有的最小 SLO。在这种情况下，平台而不是 SRE 提供基础可靠性支持，从而使 SRE 能够专注于不包含在基本策略中的更具影响力的可靠性改进。&lt;/p>
&lt;p>对于最关键的基础设施，可能需要额外的支持，但这不是强制性的。如果 SRE 主要负责最关键的用户目标，关键基础设施中的重大故障将导致产品级别 SLO 失败。此外，基础设施层面上的故障如果不影响产品 SLO，将不会提醒 SRE，可以由拥有该服务的开发团队处理（如未发布的功能和不太关键的批处理服务的问题）。&lt;/p>
&lt;p>将 SRE 支持集中在产品 SLO 上而不是服务上，可以使 SRE 支持更多产品，并将这种支持与产品最重要的部分对齐。&lt;/p>
&lt;h2 id="产品可靠性模型的前提条件">产品可靠性模型的前提条件
&lt;/h2>&lt;p>产品导向支持模型并不适用于所有用例。在实施前，建议你评估项目是否满足以下要求，以确定模型的适用性。&lt;/p>
&lt;p>&lt;strong>明确的角色和责任&lt;/strong>&lt;/p>
&lt;p>该模型需要比传统以服务为导向的参与，需要牵扯更多的利益相关者。传统的 SRE 参与通常局限于工程团队，而产品导向的参与则需要与更多角色（如 PM 和 UX）协作。与利益相关者进行有效的互动需要明确的角色和责任分工。即使是加载主页这样简单的操作，也需要有人明确速度标准。如果无法达成共识，就无法用这些结果来度量和管理产品的可靠性。&lt;/p>
&lt;p>&lt;strong>用户目标和步骤定义&lt;/strong>&lt;/p>
&lt;p>正如在“建模产品”中提到的，采用产品导向支持模型需要明确的用户目标和步骤定义。&lt;/p>
&lt;p>SRE 可以尝试为现有产品重新调整和推导用户目标，但失去了组织级别的支持，它的许多其他优势也将丧失。如果决策者不接受产品的定义，也不及时维护，它将很快过时且不准确。&lt;/p>
&lt;p>因此，拥有正确的利益相关协作，并维护好产品模型是关键要求。&lt;/p>
&lt;p>&lt;strong>易于维护的服务器&lt;/strong>&lt;/p>
&lt;p>服务器支持需要提供产品支持模型所需的详细信息。&lt;/p>
&lt;p>基本要求是单个服务器必须相对容易支持。这需要足够的标准和框架，使开发团队能够自行部署和维护，并在必要时由 SRE 提供帮助。&lt;/p>
&lt;p>如果 SRE 大部分时间都在支持某个服务器，他们将没有精力关注产品级别的问题。&lt;/p>
&lt;p>&lt;strong>与用户功能的直接映射&lt;/strong>&lt;/p>
&lt;p>必须尽可能在接近用户的地方度量用户目标和步骤（例如，在用户界面或处理用户界面请求的服务器中），因此更紧密地与堆栈入口点的服务器对齐。&lt;/p>
&lt;p>提供服务API的基础设施服务通常解决特定问题，可能与用户目标无关。例如，数据存储服务可能有一个低级API，仅包含与用户目标无关的简单加载和存储命令。&lt;/p>
&lt;p>以下是将产品支持模型应用于基础设施服务的几种选项：&lt;/p>
&lt;p>表 8: 基础设施服务的产品支持模型的应用选项&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>选项&lt;/th>
&lt;th>描述&lt;/th>
&lt;th>用例&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>将基础设施客户端视为用户，并为基础设施的API定义用户目标和步骤。&lt;/td>
&lt;td>这是最不理想的选项，因为它等同于没有用户目标的产品。然而，在某些情况下，基础设施本身可以被视为一个产品。在这些情况下，产品决策者必须定义该产品，而不是SRE的责任。&lt;/td>
&lt;td>可能适用于基础设施本身被视为产品的情况。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>配置基础设施客户端，根据其终端用户的输入提供用户目标信息。&lt;/td>
&lt;td>此选项通过以下方式帮助基础设施团队：提供有关终端用户目标的有价值信息；帮助基础设施团队识别对终端用户重要的RPC请求。&lt;/td>
&lt;td>提供有关终端用户目标的有价值信息；识别对终端用户重要的RPC请求。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>不采用产品聚焦方法。&lt;/td>
&lt;td>基础设施服务由其服务API定义，可能会从传统的服务支持模型中受益。如果你希望获得产品支持模型的好处，考虑通过其他方式实现这些好处。&lt;/td>
&lt;td>传统的服务支持模型可能更适合基础设施服务。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="结论">结论
&lt;/h2>&lt;p>产品支持模型为 SRE 团队提供了一种框架，使他们能够将支持工作集中在对用户和业务最重要的方面。该模型使 SRE 团队与组织的其他团队保持一致，并支持统一的术语和目标。&lt;/p>
&lt;p>该模型通过帮助 SRE 团队理解产品的关键点，并利用这些知识更好地填补服务支持模型的空白，解决了传统服务支持模型的许多问题。最终，产品支持模型让 SRE 团队专注于用户，确保产品满足最终用户的实际需求。&lt;/p>
&lt;h2 id="参考文献">参考文献
&lt;/h2>&lt;p>[1] Ulwick, A.W. 和 Osterwalder, A. (2016). Jobs to be done: Theory to practice. [在线] Idea Bite Press. 可在： &lt;a class="link" href="https://jobs-to-be-done-book.com/" target="_blank" rel="noopener"
>https://jobs-to-be-done-book.com/&lt;/a>&lt;/p>
&lt;p>[2] chang, austin (2017). What To Do If Your Product Isn&amp;rsquo;t Growing. [在线] Initialized Capital. 可在： &lt;a class="link" href="https://medium.com/initialized-capital/what-to-do-if-your-product-isnt-growing-7eb9d158fc" target="_blank" rel="noopener"
>https://medium.com/initialized-capital/what-to-do-if-your-product-isnt-growing-7eb9d158fc&lt;/a>&lt;/p>
&lt;p>[3] Beyer, B., Jones, C., Petoff, J. 和 Murphy, N. (2016). Site reliability engineering: How Google runs production systems. Sebastopol, Ca: O&amp;rsquo;reilly Media.&lt;/p>
&lt;p>[4] Beyer, B., Murphy, N., Rensin, D.K., Kawahara, K. 和 Thorne, S. (2018). The site reliability workbook: Practical ways to implement SRE. Cambridge O&amp;rsquo;reilly.&lt;/p>
&lt;p>[5] Kalbach, J. (2020). The jobs to be done playbook: Align your markets, organizations, and strategy around customer needs. New York: Two Waves Books.&lt;/p>
&lt;p>[6] Google Cloud. (n.d.). Incidents and the Google Cloud Service Health Dashboard | Support Documentation. [在线] 可在： &lt;a class="link" href="https://cloud.google.com/support/docs/dashboard#major_incident" target="_blank" rel="noopener"
>https://cloud.google.com/support/docs/dashboard#major_incident&lt;/a> [访问时间：2023 年 4 月 20 日]。&lt;/p>
&lt;p>[7] Wikipedia Contributors (2019). Responsibility Assignment Matrix. [在线] Wikipedia. 可在： &lt;a class="link" href="https://en.wikipedia.org/wiki/Responsibility_assignment_matrix" target="_blank" rel="noopener"
>https://en.wikipedia.org/wiki/Responsibility_assignment_matrix&lt;/a>&lt;/p>
&lt;p>❤️ Photo by Pavel Danilyuk: &lt;a class="link" href="https://www.pexels.com/photo/group-of-people-discussion-on-a-wooden-table-7868970/" target="_blank" rel="noopener"
>https://www.pexels.com/photo/group-of-people-discussion-on-a-wooden-table-7868970/&lt;/a>&lt;/p></description></item><item><title>《可观测性工程》为软件系统开启第三只眼👁</title><link>https://martinliu.cn/blog/observability-engineering-book/</link><pubDate>Tue, 22 Aug 2023 11:10:46 +0800</pubDate><guid>https://martinliu.cn/blog/observability-engineering-book/</guid><description>&lt;img src="https://martinliu.cn/blog/observability-engineering-book/pexels-skitterphoto-63901.jpg" alt="Featured image of post 《可观测性工程》为软件系统开启第三只眼👁" />&lt;p>“可观测性工程”(Observability Engineering) 是一个近年来在软件工程和系统管理领域中逐渐受到关注的概念。它主要关注的是：如何更好地理解、监控和调试复杂的分布式系统。&lt;/p>
&lt;p>DevOps浪潮已经给“软件工程”相关的实践带来了极大的影响。首先表现在各个职能团队已经越来越更加紧密的协作和沟通，部门墙正在逐渐消失，有更多的产品团队转型为“Two pizza team”风格的全功能团队，开发、测试、运维、数据库专家、云计算专家都融合在一起，自给自足的独立发布产品。其次软件流水线的工艺也更加的自动化，有朋友曾这样告诉我：他们的 CI/CD 已经可以实现每日多次自动化发布，产品团队每周持续交付到了手发麻的程度。&lt;/p>
&lt;p>然而，不管我们如何娴熟的使用云平台、容器平台和微服务所带来的高可靠性、自愈能力和稳定性等等优势。当我们在生产环境中 debug 故障的时候，我们依然是云里雾里的凭经和灵感验猜测，还是不得不在多种监控工具之间解读着七长八段的数据， MTTR 故障修复时间仍然长的忍无可忍。我们应该能逐渐意识能到：应用系统的现代化所带来的也不都是好处，还有更多的是“复杂度”。软件应用系统本身和其运行环境的复杂度都在逐渐攀升，四分五裂的运维管理的工具集正在迅速蔓延。&lt;/p>
&lt;p>在最近的三年多以来，我逐渐开始对曾经经典的“可观测性 == 三根支柱”的理解有所动摇；简单的信号量数据的叠加和关联就足够了么？监控工具手段的更新换代是否就可以实现可观测性。在持续没有找到答案的时候，《observability engineering》这本书出版了。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/observability-engineering-book/learning.oreilly.jpg"
width="250"
height="328"
srcset="https://martinliu.cn/blog/observability-engineering-book/learning.oreilly_hu_ecaa9a5fb03df4a6.jpg 480w, https://martinliu.cn/blog/observability-engineering-book/learning.oreilly_hu_dc64651dbd02a1ad.jpg 1024w"
loading="lazy"
alt="Observability Engineering"
class="gallery-image"
data-flex-grow="76"
data-flex-basis="182px"
>&lt;/p>
&lt;ul>
&lt;li>作者： Charity Majors, Liz Fong-Jones, George Miranda&lt;/li>
&lt;li>出版日期： 2022 年 5 月&lt;/li>
&lt;li>出版社： O&amp;rsquo;Reilly Media, Inc.&lt;/li>
&lt;li>URL：&lt;a class="link" href="https://www.oreilly.com/library/view/observability-engineering/" target="_blank" rel="noopener"
>https://www.oreilly.com/library/view/observability-engineering/&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>Liz Fong-Jones 曾经是 Google 资深的 SRE 工程师和布道师。我几乎看过她的所有相关视频，也转发了一些在我的 B 站里。她离开了 Google 之后，与 Charity 一起创立了 Honeycomb 公司。 George Miranda 是后加入 Honeycomb 公司的员工，他加入这本书的写作时，这本书已经基本是个半成品。&lt;/p>
&lt;p>本书是第一本只讨论“可观测性”这一主题的书籍，围绕这个主题做了相当深度和广度的讨论。这本书的完整目录在网上都可以找到，下面是关于核心内的脑图。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/observability-engineering-book/o11y-book.png"
width="2340"
height="2002"
srcset="https://martinliu.cn/blog/observability-engineering-book/o11y-book_hu_7b734a6b307931d3.png 480w, https://martinliu.cn/blog/observability-engineering-book/o11y-book_hu_1e2fe2796d20eca.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="116"
data-flex-basis="280px"
>&lt;/p>
&lt;blockquote>
&lt;p>“可观测性” - 应该成为软件在交付生命周期中的不容忽视的一个重要属性。不只是一个技术问题，在软件系统中实现和提升可观测性同样需要 DevOps 风格的多团队协作。&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>&amp;ldquo;可观测性工程&amp;quot;的价值 - 增强可观测性的主要好处是提高系统的可靠性、性能和安全性。当系统出现问题时，拥有良好的可观测性意味着可以更快地发现、定位和解决问题。&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>“可观测性工程”的文化和实践：可观测性不仅仅是一组工具或技术，它也是一种文化和实践。这意味着，开发者和运维人员需要紧密合作，共同关心系统的健康和性能。&lt;/p>&lt;/blockquote>
&lt;p>随着现代软件系统变得越来越复杂，可观测性工程成为了确保高可用性、性能和用户满意度的关键要素。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/observability-engineering-book/s34584939.jpg"
width="391"
height="500"
srcset="https://martinliu.cn/blog/observability-engineering-book/s34584939_hu_b176f7e42bc19666.jpg 480w, https://martinliu.cn/blog/observability-engineering-book/s34584939_hu_376a7f9c1fb05531.jpg 1024w"
loading="lazy"
alt="中文版"
class="gallery-image"
data-flex-grow="78"
data-flex-basis="187px"
>&lt;/p>
&lt;p>《可观测性工程》这本书分为五个部分，从历史到未来，从理论到落地，从团队到组织，从商业到文化，内容非常全面。对不同角色和职位的人都有不同的意义：&lt;/p>
&lt;ul>
&lt;li>运维：学习掌握本书的内容，可以提升你的眼界和实践能力；你会更好的识别和反思当前所处的困局，你会从分门别类的监控工具集应用，转向“聚焦生产环境问题的快速识别和解决”。&lt;/li>
&lt;li>SRE：使你对基于 SLO 的监控更加有信心，特别是升级你对遥测数据采集、数据结构、后台存储和在团队中推广等方面的认知。你将会更有效的和产品团队合作。&lt;/li>
&lt;li>开发：希望这是你学习可观测性的第一本书，本书的前三个部分就是你需要学习掌握的部分。掌握了可观测性驱动开发的概念，你以后就会对应用系统的运行状态了如指掌，它是你 DevOps 和 SRE 技能组合中不可缺少的一个部分。&lt;/li>
&lt;li>经理和管理者：建议完整的阅读本书的所有内容，重点理解第一、四和五这三个部分。如果您已经熟知可观测性这个概念，可以直接重点阅读第四和第五部分。这是你在产品团队中，在整个组织里大范围落地可观测性左移的必备常识。分布在各个章节里的真实案例分析是不可错过的内容。&lt;/li>
&lt;li>CxO：建议至少阅读中的案例研究，然后重点了掌握第四和第五部分。从这些内容中，你可以轻易的了解到投资可管的测性的技术要点，用于前期的投资和收益的评判，用于中后期管理的成熟度模型（PS：适用于产品团队自身的成长和进度评估，不建议用于产品团队间/部门间的横向比较和绩效考核）。&lt;/li>
&lt;/ul>
&lt;p>《可观测性工程》书籍中的亮点和创新之处在于：将可观测性的基础知识部分，用开发一种全新的可观测性程序的方式进行描述。首先解释：这个程序最底层的构建要素的角度是什么？分析可观测性的最底层数据结构是什么？然后，我们可以很容易的将这些数据应用到用它们来描述：应用系统在生产环境中的状态的变化过程。同时还提到了如何对接开源的 OpenTelemetry 数据；希望开发的同学能对此种描述方法倍感亲切，同时让运维和 SRE 同学也能拥有一个全新的视角。&lt;/p>
&lt;p>《可观测性工程》一书的另外一个独特之处，是在第八章中引入的“用第一性原理调试应用故障”。虽然可观测性管理的基本流程也是收集、存储和分析使用数据的过程，这看起来和其它单点的监控功能相似。但是，有没有一个统一的思路可以贯穿这个过程始终，并且推动这个过程不断的循环起来。我总是听说马斯克怎样运用第一性原理指导他在造车和火箭过程中的各种创新，并没有想到和监控运维管理会有什么关系。但是本书中所描述的“核心分析循环”还是令我耳目一新。在生产环境排错的过程中，所有人都将关注点和焦虑点都放在“谁？什么时候？可以在系统中定位到哪个最准确的唯一（假想中的）的根因（root cause）”。这种过分关注的结果想法，让我们已经忽略了，在 Debug 过程中，我们应该使用什么思路，去探索未知现象中隐藏的未知的应用运行的多重故障原因。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/observability-engineering-book/core-analysis-loop.png"
width="513"
height="514"
srcset="https://martinliu.cn/blog/observability-engineering-book/core-analysis-loop_hu_c560b589e283561a.png 480w, https://martinliu.cn/blog/observability-engineering-book/core-analysis-loop_hu_1984bcc16080e9cd.png 1024w"
loading="lazy"
alt="本图源于 Honeycomb 文档网站"
class="gallery-image"
data-flex-grow="99"
data-flex-basis="239px"
>&lt;/p>
&lt;p>“核心分析循环”并不是系统宕机后的救命稻草，而是一种理性冷静的思考方法，你可以在事故的前中后的任何时刻想到它。它能指导我们进行更加深度的分析思考，在一个理智的探索过程中，你会更加有条理的得出一连串假设，并逐个求证，在评判各种已知数据的时候，你同样需要不停的怀疑一切，推翻一切结论的勇气。切勿让单点工具的片面观察角度、对历史经验数据的依懒性，限制了我们 debug 生产系统的想象力，限制了人脑更适合做网状的复杂关联分析的能力。&lt;/p>
&lt;p>下面是本书中的一些精彩片段。&lt;/p>
&lt;blockquote>
&lt;p>【序言 - Cindy Sridharan】：本书没有关注协议或标准，甚至各种遥测信号的低级表示，而是将可观测性的三大支柱
设想为结构化事件、假设的迭代验证以及“核心分析循环”的三位一体。根据第一性原理对可观测性的构建要素进行整体重构，有助于强调仅通过遥测信号（或简单使用获取这些信号的工具）并不能最大限度地践行观测系统的所有行为。&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>【11.6 章 &amp;ndash; 可观测性左移】：可观测性驱动开发允许工程团队将他们的玻璃城堡变成可以互动的游乐场。生产环境不是一成不变的，而是充满了活力。工程师应该有能力和自信来应对任何异常并且取得胜利。&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>【14.4 章 - Slack 案例研究结论】：我分享了Slack 如何探测CI 流水线以及如何调试分布式系统的示例。开发人员了解生产环境中的代码情况，首先要考虑的应该是调试分布式系统的复杂性。但是，在发布到生产环境之前，如何正确理解和调试分布式系统同样具有挑战性。&lt;/p>&lt;/blockquote>
&lt;p>我个人认为：本书完整的回答了大量的问题，可观测性是什么？如何构建？如何左移？实现可观测性管理平台中的重要技术要点？如何在团队和组织中落地和规模化可观测性？怎样构建可观测性文化？等等。即使作者在序言和文中郑重提出，作者团队尽量避免持有任何立场，避免推广其公司产品和技术的意图。但是从文章中所引用的工具界面上看，从对核心数据结构“事件”的论述过程中看，从所引用的他们与 Slack 公司的合作案例上看；都难免脱离所在公司产品的身影。而公正的看，我们无法称之为瑕疵和片面。读者需要在理解此背景的前提下，批判性吸收书里的内容，从而避免在理解上以偏概全的可能性。本书的行文内容上看，那些高调的、上得了厅堂的内容可以用来与 CxO 对话；那些深入的、下得了厨房的代码可以用来与开发工程师沟通。本书使用了大量的篇幅在讨论“可观测性”的来龙去脉，讨论与传统监控的区别和关系，论述落地实现的细节；总的来说：这是一本在“可观测性”主题上用心良苦的作品。意在苦口婆心的引导大家走上构建应用系统可观测性的正确道路。&lt;/p>
&lt;p>下面是在 Amazon 上关于本书的评论总结：&lt;/p>
&lt;ol>
&lt;li>本书深入介绍了可观测性的实际含义，强调它能够解决新问题，构建可观测系统不一定需要添加新遥测数据。&lt;/li>
&lt;li>书中讨论了可观测性的基本概念，指出它是社会技术系统，能够促进开发人员和业务人员之间的沟通。&lt;/li>
&lt;li>可观测性在大型公司内部的推广是社会问题，需要说服管理层，书中提供了这方面的指导。&lt;/li>
&lt;li>书籍中有关构建可观测性堆栈的高级方法的简要说明。&lt;/li>
&lt;li>可观测性不仅仅是监控，它强调了从&amp;quot;为什么&amp;quot;出发，涉及实现细节和相关技术。&lt;/li>
&lt;li>评论者强调可观测性是在分布式系统中获取有用信息的关键，提到了跟踪数据流和高基数跟踪的重要性。&lt;/li>
&lt;li>书中包含了一些行业领导者的案例研究，介绍了他们如何应用可观测性方法监控生产环境。&lt;/li>
&lt;li>书中涉及了日志、度量、span、追踪、警报等概念，强调了原则胜过具体代码。&lt;/li>
&lt;li>评论者强烈推荐本书，认为它适用于任何希望为客户构建系统的人，并具有实际应用价值。&lt;/li>
&lt;li>评论者认为本书是向可观测性转变的人的必读之作，介绍了关键概念和工具的应用。&lt;/li>
&lt;/ol>
&lt;p>中文版书籍在各大电商平台有出售。感兴趣的朋友可以入手学习。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/blog/observability-engineering-book/f11f3a292df5e0fe61162f18516034a85edf7299.jpg"
width="600"
height="392"
srcset="https://martinliu.cn/blog/observability-engineering-book/f11f3a292df5e0fe61162f18516034a85edf7299_hu_a574bb5c11289ec7.jpg 480w, https://martinliu.cn/blog/observability-engineering-book/f11f3a292df5e0fe61162f18516034a85edf7299_hu_8783ced4781a377c.jpg 1024w"
loading="lazy"
alt="第三只眼"
class="gallery-image"
data-flex-grow="153"
data-flex-basis="367px"
>&lt;/p>
&lt;p>最后，我认为一个软件系统应该拥有三只眼：&lt;/p>
&lt;ol>
&lt;li>👁 稳定之眼：从 SRE 站点稳定性工程的角度讲，系统的稳定性是最重要的feature，没有之一。我深度认同这个观点。稳定性包含了服务必须具备的可用性和足够的性能。只有运行在生产环境中，被用户能正常访问和使用的代码才能发挥出它应有的价值。在运行的过程中，应用系统会宕机，运行环境可能会出问题，这都会导致应用系统的无法访问和使用；或者系统的 Bug 导致的高错误率，让系统处于半死不活的状态，用户也能从界面上看到千奇百怪的错误。系统是否进入了非正常的不可用状态？系统是否正在经历着性能抖动的过程？错误率是否高涨到即将溃坝？这些现象本质是产品的稳定性不足导致的，而这些现象是否可见，故障根源是否能快速定位？我们就需要用到第三只眼。&lt;/li>
&lt;li>👁 混沌之眼：这是一只作死之眼，它是混沌工程。混沌工程旨在对生产环境中注入人为的故障，在云环境中可以使用的手段很多：随机的关闭虚拟机、随机的杀死正在运行的进程、在网络中注入导致网络拥塞的数据包等等。在错误注入的过程中，我们关注于应用系统还是否能正常使用？应用系统如果宕机了的话，它的故障模式是怎样的？然而，可视化这个过程，可视化应用宕机现场的细节，都需要用到第三只眼。对于混沌工程的复盘和数据分析能帮助应用系统提高稳定性，消除单点故障，提升故障容忍度和自动化迁移等等。&lt;/li>
&lt;li>👁 可观测之眼：可观测性是应用系统本身的一种属性，可观测性的呈现不仅需要在应用程序代码中进行埋点增强（充分条件），还需要方便的采集遥测数据，这些都需要用到可观测性管理平台：可观测信号量的收集、上报、存储和展现分析等功能。可观测性管理平台是‘可观测性’显现（外显）/表现出来的必要条件。&lt;/li>
&lt;/ol>
&lt;p>以上是我对《可观测性工程》这本书的简介，希望对大家学习可观测性知识有所帮助。在结尾我用比喻的方式引出了应用系统应该拥有的三只眼的观点，它们是相辅相成且相互成就的关系。&lt;/p>
&lt;p>❤️ Feature Photo by RealToughCandy.com: &lt;a class="link" href="https://www.pexels.com/photo/person-holding-a-sticker-11035393/" target="_blank" rel="noopener"
>https://www.pexels.com/photo/person-holding-a-sticker-11035393/&lt;/a>&lt;/p></description></item><item><title>DevOps社区峰会2021大连后记</title><link>https://martinliu.cn/blog/devops-summit-dalian-2021-best-ever/</link><pubDate>Sun, 12 Sep 2021 16:16:29 +0800</pubDate><guid>https://martinliu.cn/blog/devops-summit-dalian-2021-best-ever/</guid><description>&lt;img src="https://martinliu.cn/img/cos/2021-11-25-IMG_7942.JPG" alt="Featured image of post DevOps社区峰会2021大连后记" />&lt;p>这是一次激动人心的记忆。没有 DevOps 社区志愿者的共同努力，我们肯定无法将峰会办的如此成功。&lt;/p>
&lt;p>我在拖了很长时间之后，我还是一定要总结一下有关这次盛会的点滴记忆和感受。我曾经多次去大连出差，于我而言大连不算是一个陌生的城市。可以由于海滨城市对人吸引力，人们对大连一如既往的美誉，本次峰会让我尤为期待。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-11-25-113246.jpg"
loading="lazy"
alt="bangchuidao.jpg"
>&lt;/p>
&lt;p>对于美好的事情而言，它们都必然要符合天时地利人和。可是在新冠疫情的影响下，大连这座港口城市的地利，也几乎改写成了劣势。大连峰会本来是计划在 2020年就要举办的，但是去年大连在几乎每次的疫情爆发时，都参与了陪跑的角色；因此小伙伴们准备了一半的大连峰会，不得不往后顺延到了 2021 年。大连峰会在 2020 年无奈跳票，也导致我们不得不将其改到了北京，幸亏 DevOps 社区北京的小伙伴们也是不负众望，20年的北京峰会也在望京庆丰包子疫情事件期间如期举办。今年又在幸运之神的眷顾下，让我们终于得以圆梦大连。&lt;/p>
&lt;p>于 2021 年 9 ⽉ 4 ⽇，中国 DevOps 社区峰会⼤连站，在位于市中心的⽇航酒店隆重举⾏。本次峰会报名⼈数约 500 ⼈，峰会当天近 450 ⼈签到，这也创下 DevOps 社区有史以来，签到⼈数最多的纪录【2020 年 12 月北京，2020 年 9 月成都，2019 年 10 月杭州】。我们有幸邀请到了⼤连软件⾏业协会秘书⻓秦健致开幕辞，邀请到了来自全国各地的讲师和志愿者来到这个浪漫的海滨城市，大家在DevOps社区里欢聚一堂，火热的分享和交流 了一天的DevOps ⽂化、理念、技术和实践。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-11-25-110555.jpg"
loading="lazy"
alt="keynotes"
>&lt;/p>
&lt;p>每年“DevOps社区峰会的举办权”是 DevOps 社区各个城市的组织者们，通过公开竞投标的流程而产生的。因此，DevOps 社区下一年两次峰会的举办城市和时间具有不确定性。在当年第二次峰会的复盘回顾会议中，我们设置了一个峰会申办和竞标环节。任何有意申办的社区组织者都可以为其所在城市投标和拉票，所有参会的社区志愿者们会公开用投票的方式选举出得票数前两名的申办城市，这两个投标成功的城市会从此开始下次峰会的筹备工作。&lt;/p>
&lt;p>峰会举办城市的组织者会成立峰会筹备小组，本次⼤连峰会的筹备⼩组中有来⾃全国的 56 名志愿者，其中⼤连本地的志愿者占了绝⼤多数。在整个峰会举办的过程中大家用定期周会的方式组织和安排各种峰会的工作事项。大连的 DevOps 社区呈现出了极佳的多样性，志愿者们的背景、职位、公司类型、年龄和性别都非常多元化。在当天大会现场，据目测观测，女性参会者的人数和比例也略高于其他城市的同类会议。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-11-25-110725.jpg"
loading="lazy"
alt="IMG_7964"
>&lt;/p>
&lt;p>下⾯是我对⼤连社区环境的概要分析：&lt;/p>
&lt;ul>
&lt;li>据不完全统计，⼤连的软件从业⼈员是 20 万⼈。【2021 年常住人口 745 万】&lt;/li>
&lt;li>软件公司的业态主要为外包业务，给国内外企业提供项目开发、技术⽀持、运营和呼叫中⼼等服务，还有⼀些企业提供国内外电商平台的技术⽀撑服务，线上教育服务等等。通过云计算交付业务系统，全生命周期软件开发业务正在逐渐递增，交付⽔平受整个⾏业的带动，正逐年提⾼。&lt;/li>
&lt;li>⼤连软件企业所服务的客户既包括国内的⾏业⻰头企业【通信和金融等】，还有更多的是⼤量的⽇本企业，并且与很多优质的⽇本企业具有稳定而长期的业务关系。受疫情影响，⽇本等外资客户对⼤连软件企业的依赖性有提⾼的趋势。&lt;/li>
&lt;li>⼤连本地有⽐较丰富的社区存在，敏捷社区、云原⽣社区、项目管理社区都在⼤连举办过线下和线上的技术交流活动。DevOps 社区已经在⼤连持续发展了三年，我们和其他社区直接也有⼀定的⼈员重叠和合作关系。&lt;/li>
&lt;li>⼤连本地的软件从业者，基本上没有加班的习惯，在下班后或者周末里加班并不是常⻅的现象。⼯作之余他们会从事⾮常丰富的户外活动，跑步、滑雪和帆船等活动非常普遍。&lt;/li>
&lt;/ul>
&lt;p>历届 DevOps 社区峰会都是一个完整和复杂的项目。当社区组织者在全国社区核心运营团队的配合下，成功的完成了各项大会工作。包括峰会前的宣传⽂案、讲师招募、盲⻦票推广、讲师⽇程推广、赞助商⽂案、赞助商讲师海报推广等。这些工作过程和海报都会在 DevOps 社区全国的所有微信群发布，在其他合作社区的微信群⾥做了联合推荐。这些文案和过程都可以在社区的微信公众号（DevOpsMeetup）上查看到。本次大连峰会的总计注册人数是 492 人，由于大连峰会的举办日期距离这个城市上一次的疫情封闭时间并不遥远，因此这个注册人数确实来之不易，堪称相当完美；我们甚至做了转线上峰会的方案。而且实现了 80+%的签到率，更表现出了在一个解封不久之后的城市里，大家报复性的出门参与社区活动的现实。峰会后的宣传包括峰会总结⽂案（内含演讲者的 ppt 下载）。社区为每个演讲者都做了现场演讲稿的速记，随 PPT 图⽚⼀起发布⼀篇推广⽂案。还为演讲者制作了演讲 PPT 录屏视频（带同步⾳频），会后社区将所有视频都发布到了 &lt;a class="link" href="https://space.bilibili.com/370989874" target="_blank" rel="noopener"
>DevOp 社区的 B 站&lt;/a>【&lt;a class="link" href="https://space.bilibili.com/370989874%e3%80%91%e5%92%8c" target="_blank" rel="noopener"
>https://space.bilibili.com/370989874】和&lt;/a> &lt;a class="link" href="https://www.youtube.com/channel/UC_gVuu1g05VREvNp2pwJbvw" target="_blank" rel="noopener"
>YouTube 频道&lt;/a>【&lt;a class="link" href="https://www.youtube.com/channel/UC_gVuu1g05VREvNp2pwJbvw%e3%80%91%e3%80%82" target="_blank" rel="noopener"
>https://www.youtube.com/channel/UC_gVuu1g05VREvNp2pwJbvw】。&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-11-25-112907.jpg"
loading="lazy"
alt="2021-11-25_18-52-04"
>&lt;/p>
&lt;p>大连峰会⼀整天的活动内容包括上午半天的集中式主会场学习，下午设置了三个分会场和⼀个⼯作坊。分享演讲总数：21 个。&lt;/p>
&lt;p>为了给本次峰会的与会者提供更多层⾯的交流机会，我们在会前组织了夜跑活动。这又是一项DevOps社区的文化传统，首次峰会也跑是三年前的环杭州西湖夜跑，当时我们喊出了“随风奔跑，DevOps是方向”的口号，这句口号被沿用至今。这次大连峰会的夜跑活动的⼈数是有史以来最多的⼀次。在⼤会的前⼀天晚上参与者们分组完成了在星海湾⼤桥的夜跑活动，参与者最后合影留念，并领取了社区定制款夜跑服装。我完美的完成了首次星海湾大桥往返十公里的首刷，和其他社区的小伙伴们一起在桥上海上欣赏到了完美的大连市夜景。在跑步活动结束以后，又去参加了老同事安排的烧烤酒局，这真的是要感恩大连当地志愿者的完美会前准备工作，峰会前的当晚，社区居然没有任何人需要奋战在会场加班，我也首次实现了峰会前撸串的自由。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-11-25-113715.jpg"
loading="lazy"
alt="running"
>&lt;/p>
&lt;p>峰会当天的我，应该说是非常兴奋的，虽然我们没有能通过大连在9月开海季节的天时地利拉取到大量到外地参会者，但当天早晨的签到数量也让我们非常激动。也有参展商遇到了所有资料和礼品在上午就很快的全部发放完毕的情况。会场之外我们也能感受到热闹非凡的交流氛围。我的主题分享在下午，晚上我们为所有志愿者和讲师准备了晚宴；席间我们还请到了一桌CxO贵客，大家畅聊DevOps实践相见恨晚。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-11-25-112048.jpg"
loading="lazy"
alt="seafood"
>&lt;/p>
&lt;p>在峰会的第⼆天，DevOps 社区组织了志愿者的内部回顾会议和团建活动，在为期⼀天的社区交流活动中，参与者们详细的回顾了本次峰会的整个历程。大家组团游览了当地的部分经典名胜景点，包括：乘坐游艇出海东港投喂海鸥，游览棒槌岛景区和海滩，在渔老人码头的品海楼品尝大连当地特色的海鲜大餐，去老虎滩极地海洋公园畅游，最后大家回到市中心的星海广场观赏海景和星海大桥。在整天的社区团建活动中，我和所有人没完没了的聊天，内容大多还是围绕着大连本地的软件行业发展和现状。通过本次全国志愿者的团结活动，DevOps 社区的文化和凝聚⼒得到了巨大的提升，这进一步确信了全国社区一盘棋的发展方针。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-11-25-112517.jpg"
loading="lazy"
alt="team-building"
>&lt;/p>
&lt;p>会后，我们还向所有与会者推送了峰会满意度调查问卷，收到近签到人数20%的有效分析数据。从调查数据中看到：非常满意（67.82%）和满意（26.44%）。对本次活动的净推荐值 NPS 高达 9.01 分，推荐率为 64.37%，这个数据同比预全行业而言，是一个非常不错的成绩。反馈者们也给我们本次峰会提供了很多有价值的改进建议，非常感谢所有参会者对社区活动的参与。本次峰会到场⼈数（450）在此刷新了记录，随着社区影响⼒的扩⼤，参与者满意度调查的⼈数和满意程度均呈现上涨趋势。与会者中，公司项目经理、团队负责⼈、管理者和⾼管的报名⽐例⾼于以往历届峰会。参会者在自于各个本地知名的⼤型软件服务商东软、埃森哲、IBM、日立、IBM、中软等咨询公司，其他⼤型外企和软企业占⽐较多。&lt;/p>
&lt;p>和其它同类峰会不同的是，我们在峰会满意度调查问卷中加入了 Top10 Speaker 的评选环节，选出了本次峰会的民选十佳讲师：&lt;/p>
&lt;ol>
&lt;li>科创时代下的创新与敏捷 | 王立杰–IDCF&lt;/li>
&lt;li>中国DevOps社区 快乐中砥砺前行 | 姚冬 – 华为&lt;/li>
&lt;li>数字化转型成就业务价值 | 黄隽（黄岛主）- 腾讯&lt;/li>
&lt;li>云原生DevOps与Continuous Everything的实践 | 王宇博-亚马逊科技&lt;/li>
&lt;li>用OpenTelemetry通明数字化系统的可观测性 | 刘征– Elastic&lt;/li>
&lt;li>基于DevOps的开源治理 | 庄表伟 – 华为&lt;/li>
&lt;li>AI智能分析和数字化质量管控应用实践 | 高蕊 – 中信银行&lt;/li>
&lt;li>数字化转型趋势下NGINX KIC的高级应用技巧 | 罗剑锋 – F5/Nginx&lt;/li>
&lt;li>容器应用交付控制持续集成持续部署最佳实践 | 宋志麒– F5/Nginx&lt;/li>
&lt;li>从DevOps发展角度看应用架构的演进 | 张卫滨 – 大连金兰软件&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-11-25-111002.jpg"
loading="lazy"
alt="2021-11-25_18-48-55"
>&lt;/p>
&lt;p>以上就是我本次大连峰会完美体验的一些记录。我非常期待深圳峰会的举办，非常期待明年峰会城市的竞标结果。&lt;/p>
&lt;p>中国 DevOps 社区是⼀个公益、中⽴、开放的专业 DevOps 社区。我们会在社区的建设过程中，努⼒创新，着⼒打造⼀个充满温度的，对所有参与者友好的学习环境，同时实现多赢的局⾯，为全国软件开发行业的相关从业人员作出应有的贡献。社区的发展离不开所有赞助商和合作社区的支持，衷心感谢大连峰会的所有赞助商和合作方。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-11-25-111100.jpg"
loading="lazy"
alt="2021-11-25_18-50-43"
>&lt;/p>
&lt;p>基于本次峰会的整体感受，我也确实体会到了大连 DevOps 社区核心组织者黄隽（黄岛主）曾经在举办城市竞标拉票宣言中的那句话“大连是一个浪漫的海滨城市”；本文写在峰会结束了两个月以后，所有难忘瞬间还都历历在目。对我个人而言本次峰会意味着：会前与小伙伴们一起夜跑打卡星海大桥并观赏完美大连夜景；和老同事新朋友们品尝大连小海鲜和烧烤，喝到不醉不归；在峰会现场的主题分享，和会场的与会者们做各个层面的交流；在会后社区峰会团结活动中团体的享受和放松；这样的精彩还有很多很多，言之不尽。可是浪漫本身意味着：冒险、经历和激情；而这次黄岛主带领着大连本地的社区志愿者们，通过一次惊艳的社区峰会为我们完美的诠释了“何谓社区的浪漫❤️”，我们需要再次感谢所有大连本地的社区志愿者们，所有参会者和志愿者们都感受到了浓浓的社区情怀。这不禁给让社区种下了解锁中国所有其它著名网红城市的小愿望。&lt;/p></description></item><item><title>战斗机飞行员如何进行事故管理（译文）</title><link>https://martinliu.cn/blog/fighter-pilots-and-incident-management-cn/</link><pubDate>Tue, 23 Mar 2021 19:45:57 +0800</pubDate><guid>https://martinliu.cn/blog/fighter-pilots-and-incident-management-cn/</guid><description>&lt;img src="https://martinliu.cn/img/cos/2021-03-23-f-16-fighter-pilot-1-scaled.jpg" alt="Featured image of post 战斗机飞行员如何进行事故管理（译文）" />&lt;p>你的事故管理与战斗机飞行员的有什么共同点？经验丰富的战斗机飞行员，Transposit 的 Anthony &amp;ldquo;AB &amp;quot; Bourke 说，他最近在DevOps企业峰会的快乐时光上做了这个演讲。&lt;/p>
&lt;blockquote>
&lt;p>教练观点：incident management 在目前的所有出版物中，甚至大部分翻译软件中，都被翻译为 “事件管理”。在 IT 行业中，这个词汇的首次出现大约是在 20 年前，从 ITIL 引入运维管理的时候，从第一波 ITIL 在国内传播布道的时候，它就一直被翻译为 “事件管理”，“事件” 其实是一个没有好坏之分，好恶差异的中性词，不带有严重后果的含义。但是如果你在美剧中，在美国 NBC 新闻频道仔细的听；incident 往往和某人遭遇交通事故受伤亡相关；和就在今天美国科罗拉多的一个商场里发生的 10 人死亡的枪击案件相关。大部分企业的 ITIL/ITSM 软件中事件管理流程里所管理的其实都是 Event Management，而不是事故。希望本文能引起大家的注意。本文中将其翻译为“事故管理”，事故应该是 Incident 这个单词在 IT 服务管理这个语境里应该有的，精确的含义。&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://martinliu.cn/img/cos/2021-03-23-2021.10.20a.jpg"
loading="lazy"
>&lt;/p>
&lt;p>本文出处：&lt;a class="link" href="https://www.transposit.com/blog/fighter-pilots-and-incident-management/" target="_blank" rel="noopener"
>https://www.transposit.com/blog/fighter-pilots-and-incident-management/&lt;/a>&lt;/p>
&lt;p>想象一下。在你所从事的工作中，你是最棒的，你被招募为蓝天上的飞翔天使。&amp;ldquo;所以，现在我们希望你驾驶着你的喷气式飞机，在很低的高度上高速飞过大量的人群，并发出巨大的噪音。然后我们要做编队飞行，你和你领导机翼间隙只有18英寸。还有一件事我得提一下，有一半的时间里，我们希望你们是倒立的，倒过来的；&lt;strong>所以就像你的IT业务服务遭受了灾难一般，后果非常严重&amp;rdquo;&lt;/strong>&lt;/p>
&lt;p>他说的没错。事实上，作为一名值守的工程师，在新冠疫情期间，应付的是应用系统发生的各种状况，值守工程师承受的压力比以往任何时候都大，有多少时候会有 &amp;ldquo;倒飞&amp;quot;的感觉？这可能是一种令人头晕目眩的体验。而失败的后果往往很严重，同时大家对 &amp;ldquo;完美任务 &amp;ldquo;的期望也从未如此的高。&lt;/p>
&lt;p>在事故管理的坚实基础上，我们可以从战斗机飞行员那里学到什么？能否帮助我们运行和保障业务关键任务服务的安全？&lt;/p>
&lt;h2 id="如实汇报不可打折">如实汇报不可打折
&lt;/h2>&lt;p>虽然我们认为：飞行员所完成的史诗般的飞行，是他们工作中最重要的部分，但伯克强调，其实汇报与任务本身同等重要。&lt;/p>
&lt;p>每次任务结束后，无一例外的，战斗机飞行员在汇报上所花费的时间，几乎是他们飞行时间的两倍。事实上：&amp;ldquo;无论我们认为自己已经有多好了，无论我们的计划有多优秀，无论我们的技术有多完美，无论我们的人员素质多么无敌，其实战斗机飞行员并没有执行过所谓的完美任务。&amp;rdquo; 我们的大部分学习，并不是发生在任务或事故本身，而是发生在事后，是在我们恢复之后，在和同事讨论的过程中，用清醒的头脑看待所发生的事情。&lt;/p>
&lt;p>我们能，也应该将这种纪律性带入自己的事故管理实践中。&amp;ldquo;不要将这种汇报的概念，看作是只能在军队中发挥作用的东西，&amp;rdquo; 伯克说。&amp;ldquo;想一想，你是如何提高你在给予和接受反馈方面的标准的。&amp;rdquo; 你不仅会加速新员工的成长体验，而且你还会发现，你团队中经验丰富的人也能够突破他们自己的玻璃天花板，同时避免他们无法提升，无法适应不可避免的变化。&lt;/p>
&lt;h2 id="透明度是汇报的关键">透明度是汇报的关键
&lt;/h2>&lt;p>跟我们一起飞上一段旅程吧！假设你就是一名中级军官，你刚刚和一群军官一起执行训练任务归来，还有一名二星将军还在回家的路上。当你汇报任务时，你在视频中观察到，将军现在已经在目标之外的100英里了，而且他应该在离开目标50英里的时候，就将“主臂”置于保险状态，可是他现在的&amp;quot;主臂 &amp;ldquo;开关放了在手臂的位置上（这意味着武器仍然是发射就绪状态）。你会指出这个将军的操作失误么&amp;ndash;他可是负责着你的涨薪、晋升和降级？&lt;/p>
&lt;p>当伯克提出这个问题时，我们中的许多人都觉得，对一个权威人物，指出他们犯了一个错误的想法是非常恐怖的。但随后，他介绍了闭口不言的潜在后果。你们中队所驾驶的F16战机的载弹量是2000磅，它可以每分钟发射6000发子弹。在你返航接近基地时，错误的按下一个按钮，可能就是一个致命的错误，这会将自己部队的基地给摧毁掉。有了这些补充说明后，答案就很明显了。透明度不能是可有可无的。&lt;/p>
&lt;p>汇报的做法会让团队在下一次任务（或事故）来临时变得更强大，适应性更强。但汇报成功的奥秘并不神秘，但往往却求之不得：完全透明。&lt;/p>
&lt;p>在汇报过程中，官衔等级应该被抛弃，自我要放在一边。&amp;ldquo;当汇报室的门关上时，一些神奇的事情就会发生，&amp;ldquo;伯克说。&amp;ldquo;军衔铭牌从我们的胸前脱落了，我们举行的汇报并没有等级制度，唯一的目的就是学习和改善。&amp;rdquo; 伯克敦促队友成为 &amp;ldquo;自己最大的敌人&amp;rdquo;，暴露自己的错误，并承诺今后要做出改变。队友们不是将责任推给他人，而是从同伴那里获得信心。&lt;/p>
&lt;p>创造这种环境需要领导层有意识地付出努力，为各种等级的队友提供一个安全的空间，让他们坦诚相待。&amp;ldquo;我们的IT领导者必须找到一种方法，来创造这样的环境，让他们的员工能够给他们提供所需的诚实、实时的反馈，以帮助他们做出正确的决策，使他们领先于威胁，领先于竞争者，领先于不可避免的变化。&amp;rdquo;&lt;/p>
&lt;h2 id="通过事后回顾总结提升事故管理">通过事后回顾总结提升事故管理
&lt;/h2>&lt;p>接受伯克的说法：&amp;ldquo;汇报是世界上最强大的工具，组织中人员的经验可以得到加速度成长，帮助你团队中的每个人都成为奇才，并推动产生更好的成果。&amp;rdquo; 如果我们真正想实践持续改进，事后总结应该是一致的、彻底的、广泛分享的。&lt;/p>
&lt;ul>
&lt;li>第一步是确保你的团队在每一个事件发生后都要进行事后分析。&lt;/li>
&lt;li>其次，事后总结需要检查事故解决过程中实际发生的细节，而不仅仅是产生问题的原因。在一个安全的环境中，团队成员会很自在地分享他们可以做得更好的地方，并确定需要改进的地方。&lt;/li>
&lt;li>最后，还要在整个组织内分享学习成果，这样经验就不会被忽略，否则就无法积累组织的知识。你永远也不知道，谁可能需要在下一次事故中实施这些经验，这些学习将帮助他们更好地准备起来，应对各种状况。&lt;/li>
&lt;/ul>
&lt;p>我们的任务可能在飞行高度上有所不同，但在原则上非常相似。承受极端的压力。高风险。以及永无止境的学习空间。借鉴战斗机飞行员的实战经验，我们可以成为自己组织中的特立独行者，将我们的流程提升到新的高度。透明度、诚实，以及对学习和改进的承诺，将会使我们的事故管理飞速发展。&lt;/p></description></item><item><title>Elasticsearch 3 节点集群搭建 (7.9.0)</title><link>https://martinliu.cn/blog/elasticsearch-3-nodes-cluster-setup/</link><pubDate>Thu, 27 Aug 2020 13:54:46 +0800</pubDate><guid>https://martinliu.cn/blog/elasticsearch-3-nodes-cluster-setup/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-6.jpg" alt="Featured image of post Elasticsearch 3 节点集群搭建 (7.9.0)" />&lt;p>最近发布的 Elastic Stack 7.9 ，带来了很多新的特性。Elastic Agent 统一集成数据采集代理是一大亮点。另外还看增加了企业搜索、端点安全防护等组件。Ingest Manager 统一 Beat 配置管理功能让我们向 SaaS 风格的监控工具又迈进了一步。由代理端自行注册到后端，在后端统一纳管所有被管理服务器，将是一种以后非常通用的模式。这样做的好处是：将数据采集端点的配置工作量和复杂度降低到最低。Beats 的各种相关独立模块也在平行的发布，这种双轨模式也可以让用户更弹性的做出选择，能最大程度的保持旧版本部署环境管理模式的延续性。 Ingest manager 的前提条件是：后台 ES 需要启用 api key 安全，启用 ES 客户端的 HTTPS 访问。我们也可以看到这两个功能选项也有其非常广泛的应用需求。本文将用最简单的文字，向你描述一套 3 节点的 ES 集群的搭建方式，这套系统的核心特性如下：&lt;/p>
&lt;ul>
&lt;li>启用用户名和密码认证&lt;/li>
&lt;li>启用集群内 es 节点间 transport.ssl 通讯加密&lt;/li>
&lt;li>启用 es 的 http 客户端 http.ssl 加密通讯&lt;/li>
&lt;li>安装脚本中包括创建数字证书的必要命令（没猜错的话，大部分人可能会在这一步花费大量时间）&lt;/li>
&lt;/ul>
&lt;h2 id="演示环境介绍">演示环境介绍
&lt;/h2>&lt;p>我使用的是本地的测试环境，环境配置如下：&lt;/p>
&lt;ul>
&lt;li>Mac OS&lt;/li>
&lt;li>vagrant&lt;/li>
&lt;li>virtualBox - CentOS 8&lt;/li>
&lt;li>Elastic Stack 7.9.0&lt;/li>
&lt;li>ip 和主机名分配见 Vagrantfile 文件&lt;/li>
&lt;li>Vagrant 的 vagrant-hostsupdater 插件实现了 Mac OS 主机和所有虚拟机的 host 文件 DNS 解析的同步，保证所有相关虚拟机都可以解析其它虚拟机的 FQDN，尽量模拟生产环境。&lt;/li>
&lt;/ul>
&lt;p>本文所使用的所有配置文件和安装脚本见：&lt;a class="link" href="https://github.com/DevOps-Coach/elasticstack.git" target="_blank" rel="noopener"
>https://github.com/DevOps-Coach/elasticstack.git&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="n">elasticstack&lt;/span> &lt;span class="n">git&lt;/span>&lt;span class="p">:(&lt;/span>&lt;span class="n">master&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="err">✗&lt;/span> &lt;span class="n">vagrant&lt;/span> &lt;span class="n">up&lt;/span> &lt;span class="n">es1&lt;/span> &lt;span class="n">es2&lt;/span> &lt;span class="n">es3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Bringing&lt;/span> &lt;span class="n">machine&lt;/span> &lt;span class="s1">&amp;#39;es1&amp;#39;&lt;/span> &lt;span class="n">up&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="s1">&amp;#39;virtualbox&amp;#39;&lt;/span> &lt;span class="n">provider&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Bringing&lt;/span> &lt;span class="n">machine&lt;/span> &lt;span class="s1">&amp;#39;es2&amp;#39;&lt;/span> &lt;span class="n">up&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="s1">&amp;#39;virtualbox&amp;#39;&lt;/span> &lt;span class="n">provider&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Bringing&lt;/span> &lt;span class="n">machine&lt;/span> &lt;span class="s1">&amp;#39;es3&amp;#39;&lt;/span> &lt;span class="n">up&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="s1">&amp;#39;virtualbox&amp;#39;&lt;/span> &lt;span class="n">provider&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">es1&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Importing&lt;/span> &lt;span class="n">base&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="s1">&amp;#39;bento/centos-8&amp;#39;&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">es1&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Matching&lt;/span> &lt;span class="n">MAC&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">NAT&lt;/span> &lt;span class="n">networking&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">es1&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Checking&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="s1">&amp;#39;bento/centos-8&amp;#39;&lt;/span> &lt;span class="n">version&lt;/span> &lt;span class="s1">&amp;#39;202002.04.0&amp;#39;&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">up&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">date&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">省略中间大量输出。。。。。。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="err">●&lt;/span> &lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">Elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Loaded&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">loaded&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">systemd&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">enabled&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">vendor&lt;/span> &lt;span class="n">preset&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">disabled&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Active&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">active&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">running&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">since&lt;/span> &lt;span class="n">Thu&lt;/span> &lt;span class="mi">2020&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">08&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">27&lt;/span> &lt;span class="mi">05&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">55&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">21&lt;/span> &lt;span class="n">UTC&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="mi">223&lt;/span>&lt;span class="n">ms&lt;/span> &lt;span class="n">ago&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Docs&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">www&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">elastic&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">co&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Main&lt;/span> &lt;span class="n">PID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">4205&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">java&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Tasks&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">41&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">limit&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">11499&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Memory&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.2&lt;/span>&lt;span class="n">G&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">CGroup&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">slice&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="err">├─&lt;/span>&lt;span class="mi">4205&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">jdk&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">java&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Xshare&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">auto&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">networkaddress&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">60&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">networkaddress&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cache&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">negative&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">AlwaysPreTouch&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Xss1m&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Djava&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">awt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">headless&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dfile&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">UTF&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Djna&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">nosys&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">OmitStackTraceInFastThrow&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">ShowCodeDetailsInExceptionMessages&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dio&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">netty&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">noUnsafe&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dio&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">netty&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">noKeySetOptimization&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dio&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">netty&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">recycler&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">maxCapacityPerThread&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dio&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">netty&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">allocator&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">numDirectArenas&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dlog4j&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shutdownHookEnabled&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">false&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Dlog4j2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">disable&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">jmx&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Djava&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">locale&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">providers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">SPI&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">COMPAT&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Xms1g&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Xmx1g&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">UseG1GC&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">G1ReservePercent&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">25&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">InitiatingHeapOccupancyPercent&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Djava&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tmpdir&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">tmp&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">14730718416313121303&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">HeapDumpOnOutOfMemoryError&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">HeapDumpPath&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">ErrorFile&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">hs_err_pid&lt;/span>&lt;span class="o">%&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Xlog&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">gc&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">gc&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">age&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">trace&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">safepoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">gc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">utctime&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">pid&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">tags&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">filecount&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">filesize&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="n">m&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">MaxDirectMemorySize&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">536870912&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">home&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conf&lt;/span>&lt;span class="o">=/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">distribution&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">flavor&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">default&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">distribution&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">rpm&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">Des&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bundled_jdk&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="bp">true&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">cp&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/*&lt;/span> &lt;span class="n">org&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bootstrap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Elasticsearch&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">quiet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="err">└─&lt;/span>&lt;span class="mi">4360&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pack&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ml&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">platform&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">x86_64&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">controller&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Aug&lt;/span> &lt;span class="mi">27&lt;/span> &lt;span class="mi">05&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span> &lt;span class="n">es3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zenlab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span> &lt;span class="n">systemd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]:&lt;/span> &lt;span class="n">Starting&lt;/span> &lt;span class="n">Elasticsearch&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Aug&lt;/span> &lt;span class="mi">27&lt;/span> &lt;span class="mi">05&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">55&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">21&lt;/span> &lt;span class="n">es3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zenlab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span> &lt;span class="n">systemd&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]:&lt;/span> &lt;span class="n">Started&lt;/span> &lt;span class="n">Elasticsearch&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Provisioning&lt;/span> &lt;span class="n">script&lt;/span> &lt;span class="n">works&lt;/span> &lt;span class="n">good&lt;/span>&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">es3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Please&lt;/span> &lt;span class="n">access&lt;/span> &lt;span class="n">Elasticsearch&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.13&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9200&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后的系统登录验证命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="n">elasticstack&lt;/span> &lt;span class="n">git&lt;/span>&lt;span class="p">:(&lt;/span>&lt;span class="n">master&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="err">✗&lt;/span> &lt;span class="n">curl&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">cacert&lt;/span> &lt;span class="n">certs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ca&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ca&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">u&lt;/span> &lt;span class="n">elastic&lt;/span> &lt;span class="s1">&amp;#39;https://es1.zenlab.local:9200/_cat/nodes?v&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Enter&lt;/span> &lt;span class="n">host&lt;/span> &lt;span class="n">password&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">user&lt;/span> &lt;span class="s1">&amp;#39;elastic&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">heap&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">percent&lt;/span> &lt;span class="n">ram&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">percent&lt;/span> &lt;span class="n">cpu&lt;/span> &lt;span class="n">load_1m&lt;/span> &lt;span class="n">load_5m&lt;/span> &lt;span class="n">load_15m&lt;/span> &lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">master&lt;/span> &lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.13&lt;/span> &lt;span class="mi">26&lt;/span> &lt;span class="mi">95&lt;/span> &lt;span class="mi">8&lt;/span> &lt;span class="mf">0.03&lt;/span> &lt;span class="mf">0.31&lt;/span> &lt;span class="mf">0.18&lt;/span> &lt;span class="n">dilmrt&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">es3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.12&lt;/span> &lt;span class="mi">33&lt;/span> &lt;span class="mi">95&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mf">0.01&lt;/span> &lt;span class="mf">0.14&lt;/span> &lt;span class="mf">0.09&lt;/span> &lt;span class="n">dilmrt&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">es2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.11&lt;/span> &lt;span class="mi">36&lt;/span> &lt;span class="mi">93&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="mf">0.06&lt;/span> &lt;span class="mf">0.16&lt;/span> &lt;span class="mf">0.12&lt;/span> &lt;span class="n">dilmrt&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">es1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上命令需要输入 elastic 用户的密码，es1 节点初始化了所有 Elasticsearch 内置用户的密码，需要复制 console 中的那一段密码信息备用。&lt;/p>
&lt;p>创建以上所有数字证书和秘钥文件的种子文件是 certs/instance.yml ：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># instance.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">instances:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es1&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.11&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es1.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#34;es2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.12&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es2.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es3&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.13&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es3.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es4&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.14&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es4.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#34;es5&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.15&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es5.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es6&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.16&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es6.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es7&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.17&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es1.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#34;es8&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.18&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es2.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;es9&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.19&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;es3.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - name: &amp;#39;lk&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip: [&amp;#39;192.168.50.20&amp;#39;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns: [ &amp;#39;lk.zenlab.local&amp;#39; ]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里一次性生产了所有我这个本地测试环境里可能用到的数字证书文件。&lt;/p>
&lt;h2 id="elasticsearch-安装脚本">Elasticsearch 安装脚本
&lt;/h2>&lt;p>下面是第一个 Elasticsearch 节点的安装脚本和注释，pre-install-es1.sh ：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="c1"># author: Martin Liu&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># url:martinliu.cn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#指定安装的版本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">elastic_version&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;7.9.0&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#开始安装流程&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Provisioning a Elasticsearch &amp;#34;&lt;/span>&lt;span class="nv">$elastic_version&lt;/span>&lt;span class="s2">&amp;#34; Server...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo date &amp;gt; /etc/vagrant_provisioned_at
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#配置 ES 需要的操作系统参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo swapoff -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sysctl -w vm.max_map_count&lt;span class="o">=&lt;/span>&lt;span class="m">262144&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sysctl -p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &lt;span class="s2">&amp;#34;echo &amp;#39;elasticsearch - nofile 65535&amp;#39; &amp;gt;&amp;gt; /etc/security/limits.conf&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设置个性化 SSH 登录提示信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &lt;span class="s2">&amp;#34;echo &amp;#39;**** -- -- -- -- -- -- -- -- ****&amp;#39; &amp;gt; /etc/motd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &lt;span class="s2">&amp;#34;echo &amp;#39;**** Welcome to Elastic Stack Labs&amp;#39; &amp;gt;&amp;gt; /etc/motd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &lt;span class="s2">&amp;#34;echo &amp;#39;**** -- -- -- -- -- -- -- -- ****&amp;#39; &amp;gt;&amp;gt; /etc/motd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo sh -c &lt;span class="s2">&amp;#34;echo &amp;#39;*&amp;#39; &amp;gt;&amp;gt; /etc/motd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#安装 ES 软件包&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rpm -ivh /vagrant/rpm/elasticsearch-&lt;span class="nv">$elastic_version&lt;/span>-x86_64.rpm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#创建 ES 集群内部通信加密数字证书，提前清理旧的证书文件和目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -f /vagrant/certs/certs.zip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -rf /vagrant/certs/es*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -rf /vagrant/certs/ca
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo rm -rf /vagrant/certs/lk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo /usr/share/elasticsearch/bin/elasticsearch-certutil cert -in /vagrant/certs/instance.yml -pem -out /vagrant/certs/certs.zip -s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#解压缩所有证书备用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo /usr/bin/unzip /vagrant/certs/certs.zip -d /vagrant/certs/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#部署节点需要的秘钥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/certs/ca/ca.crt /etc/elasticsearch/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/certs/es1/* /etc/elasticsearch/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#更新 ES 默认的配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo cp /vagrant/es1.yml /etc/elasticsearch/elasticsearch.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#配置和启动 ES 系统服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl &lt;span class="nb">enable&lt;/span> elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl start elasticsearch.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl status elasticsearch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#初始化 ES 服务器内建用户的密码，这些密码需要在控制台上复制保存备用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo /usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto -b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#成功顺利的完成了安装&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> Provisioning script works good!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> Please access Elasticsearch https://192.168.50.11:9200
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>说明：你也可以参考以上脚本手工执行，如果是非 Vagrant 环境，请注意替换各个命令中相关文件的路径。第二个和第三个节点的安装脚本稍有不同，详情见代码库。&lt;/p>
&lt;h2 id="elasticsearch-配置文件">Elasticsearch 配置文件
&lt;/h2>&lt;p>下面是第一个 Elasticsearch 节点的参考配置文件， es1.yml ：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ---------------------------------- Cluster -----------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设定集群名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cluster&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">elk4devops&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------------ Node ------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设定节点名称，此处使用的是 hostname&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">es1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ----------------------------------- Paths ------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设定 es 服务器数据目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设定 es 服务器日志目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">logs&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">elasticsearch&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ---------------------------------- Network -----------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设定此节点加入网络的名称，这里使用的是 FQDN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">network&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">es1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">zenlab&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># --------------------------------- Discovery ----------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#设定初始的 master 节点为 es1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cluster&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">initial_master_nodes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;es1&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">discovery&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seed_hosts&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;es1.zenlab.local&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------- TLS and Cert ---------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#启用用户名和密码认证&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#启用 ES 集群内加密传输&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">certificate_authorities&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ca&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">transport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">certificate&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#启用 ES 集群客户端访问加密&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">certificate_authorities&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ca&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ssl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">certificate&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">node&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">crt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># For Elastic Agent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">authc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">api_key&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#启用监控数据收集&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xpack&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">monitoring&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">collection&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ------------------------------- App Search ---------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#提前为 App Search 做好准备&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">action&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">auto_create_index&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;.app-search-*-logs-*,-.app-search-*,+*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>说明：第二个和第三个节点的配置文件稍有不同，详情见代码库。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>在三节点集群的搭建过程中，最好建议启用各种安全和加密选项，用配置安装脚本最小化工作量；这样一步到位的安全性，可以为后续增加其他 Elastic Stack 的产品组件打下良好的基础，ES 集群的配置尽量完善，尽量覆盖后期的其他各种潜在需求，减少未来配置变更的工作量，让后续的测试越来越轻松。&lt;/p></description></item><item><title>腾讯云下部署 Elastic Stack 各种 Beat 的最佳实践</title><link>https://martinliu.cn/blog/beats-implement-on-qcloud/</link><pubDate>Fri, 07 Aug 2020 17:14:20 +0800</pubDate><guid>https://martinliu.cn/blog/beats-implement-on-qcloud/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-6.jpg" alt="Featured image of post 腾讯云下部署 Elastic Stack 各种 Beat 的最佳实践" />&lt;h2 id="概述">概述
&lt;/h2>&lt;p>使用 Elastic Stack 的各种 Beats 模块可以彻底的终结在服务器上手工捞日志查指标的扭曲实践。利用腾讯云提供的 Elasticsearch 服务，可以轻松搞定大规模云环境的运维。本文一次性的帮你梳理清楚了，必备的基础操作，确保你能用 Elastic Stack 安全、稳定和扩展的持续监控你的生产环境。&lt;/p>
&lt;h2 id="创建-es-集群">创建 ES 集群
&lt;/h2>&lt;p>登录腾讯云服务控制台，查询并进入 Elasticsearc 服务，点击新建按钮，创建 Elasticsearch 集群。如下图所示。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/qcloud-es.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>集群配置说明：&lt;/p>
&lt;ul>
&lt;li>北京区&lt;/li>
&lt;li>7.5.1 - 白金版&lt;/li>
&lt;li>单可用区&lt;/li>
&lt;li>冷热模式&lt;/li>
&lt;/ul>
&lt;p>本实例其它参数保持默认，可以根据实际业务需求修改这些参数。&lt;/p>
&lt;p>点击下一步后，设置 Elasticsearch 集群的超级用户名和密码。&lt;/p>
&lt;p>在几分钟之后这个集群就成功创建了。查看下面这些基础的配置。&lt;/p>
&lt;ul>
&lt;li>启用 Kibana 内网地址： &lt;a class="link" href="http://es-ot7wei87.internal.kibana.tencentelasticsearch.com:5601" target="_blank" rel="noopener"
>http://es-ot7wei87.internal.kibana.tencentelasticsearch.com:5601&lt;/a> 用于 Bests 的 Setup 命令&lt;/li>
&lt;li>启用 Kibana 公网地址： &lt;a class="link" href="https://es-ot7wei87.kibana.tencentelasticsearch.com:5601" target="_blank" rel="noopener"
>https://es-ot7wei87.kibana.tencentelasticsearch.com:5601&lt;/a> 用户Elastic Stack 的初始化配置，如创建角色和调整索引生命周期策略等。&lt;/li>
&lt;/ul>
&lt;p>这样我们就有了一个安全、可扩展和性能足够的 ES 后台服务。&lt;/p>
&lt;h2 id="创建-beats-写入角色和用户">创建 Beats 写入角色和用户
&lt;/h2>&lt;p>登录 Kibana ，点击角色和用户管理，创建用于 Beast 配置文件的‘只写’权限用户。&lt;/p>
&lt;ul>
&lt;li>创建 beats-writer 角色&lt;/li>
&lt;li>创建 beats-writer 用户，该用户只赋予beats-writer角色，自定义一个安全的复杂密码。&lt;/li>
&lt;/ul>
&lt;p>Beats-write 角色设置如下图所示：&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/beats-writer.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>这个用户会用到后面的所有 Beats 配置文件中，用最小化权限用户极大的降低了数据泄露的风险。&lt;/p>
&lt;h2 id="beats-初始化配置">Beats 初始化配置
&lt;/h2>&lt;p>登录准备好的一个 Linux 服务器，在这台机器上做 Beats 相关的初始化工作；也就是要执行一些列的 setup 命令；这些命令的作用是：&lt;/p>
&lt;ul>
&lt;li>在 ES 后台加载索引模板，以及索引的 ILM 策略。&lt;/li>
&lt;li>加载 Kibana 相关的对象和可视化仪表板。&lt;/li>
&lt;/ul>
&lt;p>注意这是一次性的工作，在一个虚拟机上，只需要成功执行一次。&lt;/p>
&lt;p>SSH 登录到准备的 Linux 服务器上，首先需要安装相关 beats 的 rpm 安装包，安装命令在这里忽略，否则无法执行这些命令。 安装好 filebeat 和 metricbeat 的rpm 包后， 执行下面参考命令。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">filebeat setup -e &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.logstash.enabled&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.hosts&lt;span class="o">=[&lt;/span>&lt;span class="s1">&amp;#39;192.168.0.43:9200&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.username&lt;span class="o">=&lt;/span>elastic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.password&lt;span class="o">=&lt;/span>YourPassWord &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E setup.kibana.host&lt;span class="o">=&lt;/span>es-ot7wei87.internal.kibana.tencentelasticsearch.com:5601
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metricbeat setup -e &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.hosts&lt;span class="o">=[&lt;/span>&lt;span class="s1">&amp;#39;192.168.0.43:9200&amp;#39;&lt;/span>&lt;span class="o">]&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.username&lt;span class="o">=&lt;/span>elastic &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E output.elasticsearch.password&lt;span class="o">=&lt;/span>YourPassWord &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -E setup.kibana.host&lt;span class="o">=&lt;/span>es-ot7wei87.internal.kibana.tencentelasticsearch.com:5601
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>运行以上命令的时候 Beats 处于默认安装的状态，这些命令行参数是必要的查收，有了这些参数 beats 会忽略默认的配置文件。&lt;/p>
&lt;p>以上命令根据需求，如果需要使用到其它的 Beats，请使用相关的 setup 命令。其中的 es 和 kibana 相关信息需求参考上一步创建的 es 集群信息。&lt;/p>
&lt;p>以上所有命令成功之后，登录 Kibana 界面，点击 Dashboard 菜单，这里应该已经加载了很多仪表板。目前为止 Elastic Stack 后台就初始化成功了。&lt;/p>
&lt;h2 id="在节点上正式部署-beats">在节点上正式部署 Beats
&lt;/h2>&lt;p>参考和修改安装脚本，一键式安装和配置 Beats&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git clone https://github.com/martinliu/elastic-stack-lab.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd tencent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sh add-agent.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>成功执行完以上脚本后，相关的 beats 服务应是正常运行的状态。执行完这个命令之后，在 Linux 服务器上使用检查服务是否正常运行 &lt;code>sudo systemctl status filebeat&lt;/code> ；使用这个命令应该可以看到filebeat 服务都是正常运行的。&lt;/p>
&lt;p>这个脚本所使用的配置文件中的要点：&lt;/p>
&lt;ul>
&lt;li>删除了所有和数据摄入无关的配置（例如 es 和 kibana 的配置和初始化等）&lt;/li>
&lt;li>加入了最小化的必要的最佳实践参数集合&lt;/li>
&lt;li>建议根据需求增加 beats 相关的模块&lt;/li>
&lt;li>根据需求加入必要的 Beat 配置参数&lt;/li>
&lt;/ul>
&lt;p>实例配置文件如。&lt;/p>
&lt;p>filebeat.yml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#=========================== Filebeat inputs =============================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">filebeat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">inputs&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="n">type&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">paths&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#============================= Filebeat modules ===============================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">filebeat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">period&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">60&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-------------------------- Elasticsearch output ------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hosts&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;${INT_ES_SRV}&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">BEATS_WRITER_PW&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">BEATS_WRITER_USERNAME&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#================================ Processors =====================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">processors&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_host_metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">netinfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cache&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_cloud_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_docker_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_kubernetes_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_fields&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">target&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fields&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;Joint Lab&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;es-qq&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#==================== Best Practice Configuration ==========================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">setup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ilm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">check_exists&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">level&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">error&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">queue&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">spool&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">monitoring&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>metricbeat.yml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># =========================== Modules configuration ============================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">metricbeat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">modules&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">/*.&lt;/span>&lt;span class="n">yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">period&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-------------------------- Elasticsearch output ------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">output&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">elasticsearch&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hosts&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;${INT_ES_SRV}&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">BEATS_WRITER_PW&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">BEATS_WRITER_USERNAME&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#================================ Processors =====================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">processors&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_host_metadata&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">netinfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cache&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ttl&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="n">m&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_cloud_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_docker_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_kubernetes_metadata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">add_fields&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">target&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fields&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;Joint Lab&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;es-qq&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#==================== Best Practice Configuration ==========================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">setup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ilm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">check_exists&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">level&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">error&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">queue&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">spool&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">monitoring&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">enabled&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="bp">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上配置文件使用了这些通用最佳实践配置参数。&lt;/p>
&lt;ul>
&lt;li>使用 ECS 扩展字段，丰富上下文含义&lt;/li>
&lt;li>启用 beats 端点监控&lt;/li>
&lt;li>用 keystore 隐藏所有敏感信息&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#禁用索引 ilm 策略检查，避免无用动作
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">setup.ilm.check_exists: false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#把Beats自身的日志记录调到最低级别降低
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">logging.level: error
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#开启本地默认的端点缓存行为
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">queue.spool: ~
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#启用端点的监控
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">monitoring:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enabled: true
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="排错方法">排错方法
&lt;/h2>&lt;h3 id="filebeat-setup-不成功">filebeat setup 不成功
&lt;/h3>&lt;p>在任何 beats 首次做 setup 命令的时候，它可能是会在分钟级别成功结束。如果发生失败或者卡顿的情况，可以等一下，等更长时间看看。不成功的话，需要反复执行，排查 es 和 kibana 服务是否能正常工作。知道陈功了，才能进行下一步的安装工作。&lt;/p>
&lt;h3 id="配置文件错误导致的服务不能启动">配置文件错误导致的服务不能启动
&lt;/h3>&lt;p>由于上面的定制化配置文件也可能出现错误，特别是在首次部署这个配置文件的时候，可以先把日志级别 error 哪一行注释掉，把启动服务那两行也注释掉。&lt;/p>
&lt;p>然后在命令行执行 &lt;code>filebeat -e&lt;/code> 查看整个 feilebeat 的启动过程，这个命令会读取定制化的配置文件，然后开始连接后台 es 服务，然后进入正常数据传送的状态。这个过程中如果有任何配置错误，也可以直观的看到相关信息，直到调整到正常的状态。&lt;/p>
&lt;p>以上过程的调整好了以后，一定要通过 git 版本管理起来，然后可以放心的在其它节点上执行 beast 的一键式部署工作。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>以上是在 Beats 部署相关基础最佳实践，也就是说在生产环境中 ES 后台和 beats 的搭配，以及本文所涉及的内容都是基线配置。建议根据自己的需求做更多的调优，这里使用 shell 脚本的方式部署 beats 和相关的配置，shell 脚本适合用于演示原理，建议替换成你所熟悉的自动化运维工具，例如 ansible 等工具。从而保证更大规模的自动化部署和维护。&lt;/p>
&lt;p>本相关的配置文件和脚本位于：&lt;a class="link" href="https://github.com/martinliu/elastic-stack-lab.git" target="_blank" rel="noopener"
>https://github.com/martinliu/elastic-stack-lab.git&lt;/a>&lt;/p></description></item><item><title>APM 分布式追踪为何这么难？</title><link>https://martinliu.cn/blog/apm-why-it-so-hard/</link><pubDate>Sun, 02 Aug 2020 20:48:30 +0800</pubDate><guid>https://martinliu.cn/blog/apm-why-it-so-hard/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-3.jpg" alt="Featured image of post APM 分布式追踪为何这么难？" />&lt;p>用跟踪的方式调试计算机程序的调用堆栈的实践其实由来已久，这种方法可能仅次于用 print 输出各种信息。在云原生的时代里，我们还会遭遇工具过剩的情况，工具之间的相生相克加剧了实施分布式追踪的难度。&lt;/p>
&lt;p>总的来说有三个基础难点：&lt;/p>
&lt;ol>
&lt;li>生成追踪数据难。对已有应用系统的代码库进行埋点处理的挑战巨大，你的应用程序系统的模式可能也不符合埋点的模式需求。&lt;/li>
&lt;li>采集存储追踪数据难。捕获和管理大量追踪数据包，即照顾到查询和使用的需求，又要设定成本合理的数据存储策略，处理数据收集能力的扩缩容。&lt;/li>
&lt;li>从数据中获益难。如何理解和使用数据产生可执行行动，如何用它优化微服务的遥测，怎么将它的利益扩展到各个相关团队。&lt;/li>
&lt;/ol>
&lt;p>分布式追踪系统的实施结果是落地一条能深度洞察目标系统的工具。让人们能轻松的理解局部和整体的状态，特别是在请求堆栈中的任何局部服务出现故障时，可以最快速的定位故障根源。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/screenshot-apm-service-map.png"
loading="lazy"
>&lt;/p>
&lt;p>上图是用追踪数据生成的服务地图。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/blog-k8s-o11y-apm-trace-correlation.jpg"
loading="lazy"
>&lt;/p>
&lt;p>上图是一次用户请求的全部细节，还可以一键式的跳转到相应的日志或者指标。&lt;/p>
&lt;p>以上三个难点覆盖了部署实施分布式追踪系统的核心领域。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>埋点&lt;/strong> OpenTelemetry是目前受到广泛支持的埋点框架，对棕地应用和绿地应用进行埋点处理的挑战是不同的，需要遵循不同的额最佳实践。&lt;/li>
&lt;li>&lt;strong>部署&lt;/strong> 在理解了目标追踪应用系统的运行时状态后，最好使用一种弹性的方式收集和存储追踪数据。满足分析数据量需求的同时平衡存储成本。&lt;/li>
&lt;li>&lt;strong>收益&lt;/strong> 将其与日志和指标工具关联起来，定义和监控重要有意义的监控点，用于优化系统性能基线，并最小化 MTTR。&lt;/li>
&lt;/ul>
&lt;p>在云计算、Kubernetes、容器化大行其道的今天，分布式追踪的实施是不是正处在进退维谷的尴尬境地呢？其实并非如此，特别是监控运维挑战越高的应用，其实越需要需要使用分布式追踪 APM 工具。分布式追踪对云原生的容器化微服务应用尤为适用。APM 对单纯使用日志和指标的场景具有极大的补充和提高作用，而且它是可观测性策略的关键组成部分。&lt;/p>
&lt;p>总的来说分布式追踪工具可以通过追踪的方式展现请求在系统中的流动状态。流行的开源埋点框架使之与应用的编程语言、运行时环境无关，可以适配与所有类型的应用和服务。有些 APM 工具可以支持运行时埋点（或称为运行框架埋点），在不改变代码的情况下采集追踪数据。APM 的实施虽然有一定难度，但是当开始实施埋点处理，收集追踪数据以后，相关的价值和收益也就会慢慢显现出来了。&lt;/p>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://opentelemetry.io/" target="_blank" rel="noopener"
>https://opentelemetry.io/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.elastic.co/cn/apm" target="_blank" rel="noopener"
>https://www.elastic.co/cn/apm&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>应用开发 DBA 技巧集锦</title><link>https://martinliu.cn/blog/sql-tricks-application-dba/</link><pubDate>Fri, 31 Jul 2020 22:23:44 +0800</pubDate><guid>https://martinliu.cn/blog/sql-tricks-application-dba/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-1.jpg" alt="Featured image of post 应用开发 DBA 技巧集锦" />&lt;h2 id="前言">前言
&lt;/h2>&lt;p>DBA 可能是经常被其它团队依赖的一种角色、团队，因此他们也会有着很长的等待队列，也经常是事故救火中的英雄和常客。DevOps 强调用跨角色的学习和培训来解决这种依赖，也就是 DevOps 工作三步法的第三步，学习与持续改进。 本文写给所有的应用开发者，希望大家能多学习一些 DBA 知识，减少对专家 DBA 的依赖，加速你们的业务的交付，消除由于等待而造成的浪费。&lt;/p>
&lt;p>本文转载自：&lt;a class="link" href="https://hakibenita.com/sql-tricks-application-dba" target="_blank" rel="noopener"
>https://hakibenita.com/sql-tricks-application-dba&lt;/a>&lt;/p>
&lt;p>以下是正文原文：&lt;/p>
&lt;p>当我开始我的开发生涯时，我的第一份工作是DBA。那时，在AWS RDS、Azure、Google Cloud和其余云服务之前，有两种类型的DBA。&lt;/p>
&lt;p>&lt;strong>基础设施 DBA&lt;/strong> 负责建立数据库配置存储，并负责备份和复制。设置好数据库后，基础架构DBA会时不时地冒出来做一些 &amp;ldquo;实例调整&amp;rdquo;，比如调整缓存的大小。&lt;/p>
&lt;p>&lt;strong>应用 DBA&lt;/strong> 从基础架构DBA那里得到了一个干净的数据库，并负责模式设计：创建表、索引、约束和调优SQL。应用DBA也是实现ETL流程和数据迁移的人。在使用存储过程的团队中，应用DBA也会维护这些存储过程。&lt;/p>
&lt;p>应用DBA通常是开发团队的一部分。他们会拥有深厚的领域知识，所以通常他们只会在一两个项目上工作。基础架构DBA通常是某个IT团队的一部分，他们会同时在多个项目上工作。&lt;/p>
&lt;p>&lt;strong>我是一名应用DBA&lt;/strong> 我从来没有任何欲望去摆弄备份或调整存储（我相信这很迷人！）。直到今天，我都喜欢说自己是一个懂得开发应用的DBA，而不是一个懂得数据库的开发者。&lt;/p>
&lt;p>在本文中，我将分享我一路走来收集到的一些关于数据库开发的非浅显技巧。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/00-sql-tricks-dba.jpg"
loading="lazy"
>&lt;/p>
&lt;p>Be that guy&amp;hellip;&lt;!-- raw HTML omitted -->Image by &lt;!-- raw HTML omitted -->CommitStrip&lt;!-- raw HTML omitted -->&lt;/p>
&lt;h2 id="只更新需要更新的内容">只更新需要更新的内容
&lt;/h2>&lt;p>UPDATE是一个相对昂贵的操作。为了加快UPDATE命令的速度，最好确保只更新需要更新的内容。&lt;/p>
&lt;p>以这个查询为例，它对电子邮件列进行了标准化处理。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">lower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1010000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1583&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">935&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">01&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">584&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>看起来很无辜吧，查询更新了1010,000个用户的邮箱。但是，真的需要更新所有的行吗？&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">lower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">lower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">299&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">470&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>只需要更新10000行。通过减少受影响的行数，执行时间从1.5秒降到了不到300ms。更新的行数少了，也节省了后期的数据库维护工作。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1264.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>这种类型的大更新在数据迁移脚本中非常常见。所以下次写迁移脚本时，一定要只更新需要更新的内容。&lt;/p>
&lt;h2 id="在批量加载过程中禁用约束和索引">在批量加载过程中禁用约束和索引
&lt;/h2>&lt;p>约束是关系型数据库的重要组成部分：它们能保持数据的一致性和可靠性。不过它们的好处是有代价的，在加载或更新大量行时最明显。&lt;/p>
&lt;p>为了演示，为一个存储设置一个小模式。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IF&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXISTS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CASCADE&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">serial&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">TEXT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">INT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">price&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()::&lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">)::&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IF&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXISTS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CASCADE&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">serial&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">TEXT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()::&lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IF&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXISTS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">serial&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">created&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">timestamptz&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">customer_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NULL&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>模式定义了不同类型的约束，如 &amp;ldquo;非空 &amp;ldquo;和唯一约束。&lt;/p>
&lt;p>要设置一个基线，首先要向销售表添加外键，然后将一些数据加载到表中:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ADD&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CONSTRAINT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_product_fk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FOREIGN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">REFERENCES&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">18&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">413&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ADD&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CONSTRAINT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_customer_fk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FOREIGN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">customer_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">REFERENCES&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">464&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_created_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">created&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">605&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SALE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">created&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">interval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;1 hour&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10000&lt;/span>&lt;span class="p">)::&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="p">)::&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">15410&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">234&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">410&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>定义约束和索引后，将100万行加载到表中，耗时约15.4s。&lt;/p>
&lt;p>接下来，尝试先将数据加载到表中，然后才添加约束和索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">SALE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">created&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">interval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;1 hour&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">10000&lt;/span>&lt;span class="p">)::&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="p">)::&lt;/span>&lt;span class="nb">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2277&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">824&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">02&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">278&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ADD&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CONSTRAINT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_product_fk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FOREIGN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">product_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">REFERENCES&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">product&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">169&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">193&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ADD&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CONSTRAINT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_customer_fk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FOREIGN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">customer_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">REFERENCES&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">customer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">185&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">633&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_created_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">created&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">484&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">244&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将数据加载到没有索引和约束的表中，速度快了很多，2.27s，而之前是15.4s。在数据加载到表中后创建索引和约束花了一点时间，但总体上整个过程快了很多，3.1s，而之前是15.4s。&lt;/p>
&lt;p>遗憾的是，对于索引，PostgreSQL并没有提供一个简单的方法，除了放弃和重新创建索引。在其他数据库中，如Oracle，你可以禁用和启用索引，而不必重新创建索引。&lt;/p>
&lt;h2 id="中间数据中使用-unlogged-的表">中间数据中使用 UNLOGGED 的表
&lt;/h2>&lt;p>当你修改PostgreSQL中的数据时，修改的内容会被写入提前写日志&lt;a class="link" href="https://www.postgresql.org/docs/current/wal-intro.html" target="_blank" rel="noopener"
>（WAL）&lt;/a>。WAL用于维护完整性，在恢复期间快速推进数据库，并维护复制。&lt;/p>
&lt;p>写入WAL是经常需要的，但在某些情况下，你可能愿意放弃它的一些用途来使事情变得更快。一个例子是中间表。&lt;/p>
&lt;p>中间表是一次性的表，它存储了用于实现某些过程的临时数据。例如，ETL过程中一个非常常见的模式是将数据从CSV文件加载到中间表，清理数据，然后加载到目标表。在这种用例中，中间表是一次性的，在备份或复制中没有用处。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1265.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>在灾难发生时不需要恢复的中间表，以及在副本中不需要的中间表，可以设置为 UNLOGGED。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UNLOGGED&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">staging_table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="cm">/* table definition */&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>**注意：**在使用UNLOGGED之前，请务必了解其全部含义。&lt;/p>
&lt;h2 id="使用-with-和-returning-实施完成的流程">使用 WITH 和 RETURNING 实施完成的流程
&lt;/h2>&lt;p>假设你有一个用户表，你发现表中有一些重复的内容。&lt;/p>
&lt;p>表的设置：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">SERIAL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">TEXT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">UNIQUE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">SERIAL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">PRIMARY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">INT&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">CONSTRAINT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders_user_fk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FOREIGN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">KEY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">REFERENCES&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">USERS&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">VALUES&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;foo@bar.baz&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;me@hakibenita.com&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ME@hakibenita.com&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">VALUES&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>表的内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">order_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">JOIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">order_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">----+-------------------+----------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foo&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bar&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">baz&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foo&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bar&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">baz&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">me&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ME&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ME&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>用户haki benita注册了两次，一次是用邮箱&lt;a class="link" href="mailto:ME@hakibenita.com" >ME@hakibenita.com&lt;/a>，另一次是用&lt;a class="link" href="mailto:me@hakibenita.com" >me@hakibenita.com&lt;/a>。由于我们在将邮件插入表中时没有将其规范化，现在我们必须处理重复的问题。&lt;/p>
&lt;p>为了合并重复的用户，我们要。&lt;/p>
&lt;ol>
&lt;li>通过小写的电子邮件来识别重复的用户。&lt;/li>
&lt;li>更新订单以引用其中一个重复的用户。&lt;/li>
&lt;li>从用户表中删除重复的用户&lt;/li>
&lt;/ol>
&lt;p>整合重复用户的一种方法是使用中间表。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">UNLOGGED&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">lower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">normalized_email&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">array_remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ARRAY_AGG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">GROUP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">normalized_email&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">HAVING&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">normalized_email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-------------------+-----------------+--------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">me&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>中间表持有重复用户的映射。对于每一个使用相同的标准化电子邮件地址出现不止一次的用户，我们定义最小ID的用户作为我们将所有重复用户转换为的用户。其他用户被保存在一个数组列中，这些用户的所有引用都将被更新。&lt;/p>
&lt;p>利用中间表，我们更新订单表中重复用户的引用。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANY&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Now&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">that&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">there&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">are&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">no&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">more&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">references&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">we&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">can&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">safely&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">delete&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DELETE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">unnest&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">DELETE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>请注意，我们使用了函数 unnest 来 &amp;ldquo;转置 &amp;ldquo;数组，即把每个数组元素变成一行。&lt;/p>
&lt;p>这就是结果：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">order_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">JOIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">u&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">order_id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">----+-------------------+----------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foo&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bar&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">baz&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foo&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bar&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">baz&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">me&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">me&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">me&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>很好，用户3(&lt;a class="link" href="mailto:ME@hakibenita.com" >ME@hakibenita.com&lt;/a>)的所有出现都转换为用户2(&lt;a class="link" href="mailto:me@hakibenita.com" >me@hakibenita.com&lt;/a>)。&lt;/p>
&lt;p>我们还可以验证重复的用户是否从用户表中被删除。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">----+-------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">foo&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">bar&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">baz&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">me&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">hakibenita&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>现在我们可以摆脱中间表了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个很好，但是非常长，需要清理! 有没有更好的方法？&lt;/p>
&lt;h3 id="使用通用表表达式cte">使用通用表表达式(CTE)
&lt;/h3>&lt;p>使用常见的表表达式，也就是所谓的WITH子句，我们只需要一条SQL语句就可以执行整个过程。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">WITH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">array_remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ARRAY_AGG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">GROUP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">lower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">HAVING&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">update_orders_of_duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANY&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">DELETE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">unnest&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我们不创建中间表，而是创建一个通用的表表达式，并多次重复使用。&lt;/p>
&lt;h3 id="从-cte-返回结果">从 CTE 返回结果
&lt;/h3>&lt;p>在WITH子句中执行DML的一个很好的特性是，你可以使用&lt;a class="link" href="https://www.postgresql.org/docs/current/dml-returning.html" target="_blank" rel="noopener"
>RETURNING关键字&lt;/a>来返回数据。例如，让我们报告更新和删除的行数：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">WITH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">array_remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ARRAY_AGG&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">min&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">GROUP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">lower&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">HAVING&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">update_orders_of_duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">UPDATE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">orders&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SET&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">convert_to_user&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">user_id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANY&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">du&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">RETURNING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">o&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">delete_duplicate_user&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">DELETE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">unnest&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">convert_from_users&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">duplicate_users&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">RETURNING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">update_orders_of_duplicate_users&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">orders_updated&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">delete_duplicate_user&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_deleted&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个结果是:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">orders_updated&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_deleted&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">----------------+---------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这种方法的主要吸引力在于，整个过程是在一条命令中执行的，所以不需要管理一个事务，也不需要担心在过程失败时清理中间表。&lt;/p>
&lt;p>**注意：**Reddit上的&lt;a class="link" href="https://www.reddit.com/r/programming/comments/hyv0xh/some_sql_tricks_of_an_application_dba/fzhqzw5?utm_source=share&amp;amp;utm_medium=web2x" target="_blank" rel="noopener"
>一位读者&lt;/a>给我指出了在&lt;a class="link" href="https://www.postgresql.org/docs/current/queries-with.html#QUERIES-WITH-MODIFYING" target="_blank" rel="noopener"
>普通表表达式中执行DML的一个可能无法预测的行为&lt;/a>。&lt;/p>
&lt;blockquote>
&lt;p>WITH中的子语句相互之间以及与主查询同时执行。因此，当在WITH中使用数据修改语句时，指定的更新实际发生的顺序是不可预测的。&lt;/p>&lt;/blockquote>
&lt;p>这意味着你不能依赖独立子语句的执行顺序。看来，当子语句之间存在依赖关系时，比如在上面的例子中，你可以依靠依赖的子语句在被使用之前执行。&lt;/p>
&lt;h2 id="避免在选择性低的列上使用索引">避免在选择性低的列上使用索引
&lt;/h2>&lt;p>假设你有一个注册流程，用户用电子邮件地址注册。为了激活帐户，他们必须验证他们的电子邮件。你的表可以是这样的。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">serial&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">boolean&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>你的大部分用户都是好公民，他们用有效的邮箱注册，并立即激活账号。让我们用用户数据来填充表格，其中大概有90%的用户被激活。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">md5&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()::&lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1000000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">GROUP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">count&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-----------+--------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">102567&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">897433&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">VACUUM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">VACUUM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>要查询已激活和未激活的用户，你可能会想在列激活上创建一个索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_activated_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当你试图查询未激活的用户时，数据库正在使用索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1923&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">32&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">11282&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">99&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">102567&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">38&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Filter&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">NOT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_activated_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">1897&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">68&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">102567&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">false&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>数据库估计，过滤后会有102567个，这大概是表的10%。这与我们填充的数据是一致的，所以数据库对数据的感觉很好。&lt;/p>
&lt;p>但是，当你尝试查询激活用户时，你发现数据库决定不使用索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Seq&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">18334&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">897433&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">38&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Filter&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>很多开发人员在数据库没有使用索引的时候，往往会感到困惑。解释为什么索引并不总是最好的选择的一种方法是：&lt;strong>如果你必须读取整个表，你会使用索引吗？&lt;/strong>&lt;/p>
&lt;p>答案可能是否定的，因为你为什么要这样做？从磁盘上读取是很昂贵的，你希望尽可能少地读取。例如，如果一个表是10MB，索引是1MB，要读取整个表，你就必须从磁盘上读取10MB。如果要使用索引来读取表，你就必须从磁盘上读取11MB。这是很浪费的。&lt;/p>
&lt;p>有了这样的理解，我们来看看PostgreSQL对表的收集统计。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">n_distinct&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">most_common_vals&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">most_common_freqs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pg_stats&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;users&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;activated&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">------------------+------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">n_distinct&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">most_common_vals&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">most_common_freqs&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">89743334&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">10256667&lt;/span>&lt;span class="err">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当PostgreSQL分析该表时，发现激活的列有两个不同的值。most_common_vals列中的值t对应的是most_common_freqs列中的频率0.89743334，值f对应的是频率0.10256667。也就是说，经过分析，数据库估计表中89.74%是激活用户，其余10.26%是未激活用户。&lt;/p>
&lt;p>通过这些统计，PostgreSQL决定，如果希望90%的行满足条件，最好扫描整个表。过了这个阈值，数据库可能会决定使用或不使用索引，这取决于很多因素，没有一个经验法则可以使用。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1266.jpeg"
loading="lazy"
>&lt;/p>
&lt;h2 id="使用部分索引">使用部分索引
&lt;/h2>&lt;p>在上一节中，我们在布尔值列上创建了一个索引，其中90%的值为真（激活用户）。当我们试图查询活跃用户时，数据库没有使用该索引。然而，当我们查询未激活的用户时，数据库却使用了该索引。&lt;/p>
&lt;p>这就引出了下一个问题&amp;hellip;&amp;hellip;如果数据库不打算使用索引来过滤活跃用户，那么我们为什么要首先使用索引呢？&lt;/p>
&lt;p>在回答这个问题之前，我们先来看看激活列上的完整索引有多大重量。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">\&lt;/span>&lt;span class="n">di&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_activated_ix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Schema&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Owner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Size&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------+--------------------+-------+-------+-------+------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_activated_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">haki&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">MB&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>索引是21MB。仅供参考，用户表是65MB。这意味着索引的重量约为表的32%。我们也知道~90%的索引可能不会被使用。&lt;/p>
&lt;p>在PostgreSQL中，有一种方法可以只在表的一部分创建索引，&lt;a class="link" href="https://www.postgresql.org/docs/current/indexes-partial.html" target="_blank" rel="noopener"
>使用所谓的部分索引&lt;/a>。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_unactivated_partial_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">not&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用WHERE子句，我们限制了索引所索引的行。首先让我们确认一下它是否有效。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">not&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activated&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">using&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_unactivated_partial_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">29&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">3493&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">60&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">102567&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">38&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>令人惊奇的是，数据库很聪明，它明白我们在查询中使用的谓词可以通过部分索引来满足。&lt;/p>
&lt;p>使用部分索引还有一个好处。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">\&lt;/span>&lt;span class="n">di&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_unactivated_partial_ix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">of&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">relations&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Schema&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Owner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Size&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------+------------------------------+-------+-------+-------+---------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users_unactivated_partial_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">haki&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">users&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2216&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kB&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>部分索引仅重2.2MB。列上的全索引重达21MB。部分索引的大小正好是全索引的10%，这与表中非活跃用户的比例相匹配。&lt;/p>
&lt;h2 id="始终加载排序过的数据">始终加载排序过的数据
&lt;/h2>&lt;p>这是我在代码评审中评论最多的事情之一。它不像其他提示那样直观，它对性能的影响很大。&lt;/p>
&lt;p>比如说你有一个大的销售事实表。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">serial&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">Every&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">night&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">during&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">some&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ETL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">process&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">load&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">data&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">into&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">table&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">md5&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()::&lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-01-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">interval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;1 day&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">round&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">365&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">VACUUM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">VACUUM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>为了伪造一个加载过程，我们使用了随机数据。我们插入了10万行随机的用户名，销售日期从2020-01-01到未来两年。&lt;/p>
&lt;p>该表主要用于制作汇总销售报表。大多数报表都是通过日期来过滤，得到特定时期的销售情况。为了加快范围扫描，你可以在sold_at上创建一个索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>让我们看看一个查询的执行计划，以获取2020年6月的所有销售。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BETWEEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-----------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">108&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">1107&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">69&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4293&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Recheck&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Blocks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">exact&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">927&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">107&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">22&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4293&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Planning&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">191&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Execution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">906&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在执行了几次查询预热缓存后，时间稳定在约6ms。&lt;/p>
&lt;h3 id="bitmap-scan">Bitmap Scan
&lt;/h3>&lt;p>从执行计划来看，我们可以看到数据库使用了位图扫描。位图扫描的工作分为两个阶段。&lt;/p>
&lt;ul>
&lt;li>位图索引扫描。浏览整个索引sale_fact_sold_at_ix 并映射所有包含相关记录的表页。&lt;/li>
&lt;li>位图堆扫描：读取包含相关行的页面。读取包含相关行的页面，并在这些页面中找到满足条件的行。&lt;/li>
&lt;/ul>
&lt;p>页面可以包含多条记录。第一步使用索引来查找页面。第二步检查这些页面里面的行，因此执行计划中的 &amp;ldquo;Recheck Cond &amp;ldquo;操作。&lt;/p>
&lt;p>这时，很多DBA和开发人员都会收工，继续进行下一个查询。BUT，有一个方法可以让这个查询变得更好。&lt;/p>
&lt;h3 id="index-scan">Index Scan
&lt;/h3>&lt;p>为了让事情变得更好，我们会在加载数据的方式上做一个小小的改变。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TRUNCATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">TRUNCATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">md5&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()::&lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-01-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">interval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;1 day&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">round&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">365&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ORDER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">VACUUM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">VACUUM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这次，我们加载的数据是按sold_at排序的。&lt;/p>
&lt;p>让我们看看现在完全相同的查询的执行计划是什么样子的。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BETWEEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">using&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">29&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">184&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">73&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4272&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Planning&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">145&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Execution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">294&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在运行了几次查询后，我们得到了一个稳定在2.3ms的轮回时间。与之前的查询耗时约6ms相比，我们得到了约60%的稳定节省。&lt;/p>
&lt;p>还有一点我们可以马上看到，这次数据库没有使用位图扫描，而是使用了 &amp;ldquo;常规 &amp;ldquo;索引扫描。为什么会这样呢？&lt;/p>
&lt;h3 id="correlation">Correlation
&lt;/h3>&lt;p>当数据库在分析一张表时，它会收集各种统计数据。其中一个统计是&lt;a class="link" href="https://www.postgresql.org/docs/current/view-pg-stats.html" target="_blank" rel="noopener"
>相关性&lt;/a>。&lt;/p>
&lt;blockquote>
&lt;p>物理行排序和逻辑列值排序之间的统计相关性。这个范围从-1到+1。当该值接近-1或+1时，由于减少了对磁盘的随机访问，估计对该列进行索引扫描会比接近零时更便宜。&lt;/p>&lt;/blockquote>
&lt;p>正如官方文档所解释的那样，相关性衡量了特定列值在磁盘上的 &amp;ldquo;排序 &amp;ldquo;程度。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1267.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>当相关性为1，或接近1时，意味着表中的页在磁盘上的存储顺序与表中的行大致相同。这其实是很常见的。例如，自动递增的ID通常会有接近1的相关性。跟踪行创建时间的日期和时间戳列通常也会有接近于1的相关性。&lt;/p>
&lt;p>当相关性为-1时，表的页面相对于列的排序顺序是相反的。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1268.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>当相关性接近0时，意味着列中的值与表的页面存储方式没有相关性或相关性很小。&lt;/p>
&lt;p>回到我们的sale_fact表，当我们将数据加载到表中时，没有先进行排序，这些就是相关性。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pg_stats&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;sale_fact&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-----------+----------+--------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">005344716&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">011389783&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>自动生成的列id的相关性为1，sold_at列的相关性很低：连续的值分散在整个表中。&lt;/p>
&lt;p>当我们将排序数据加载到表中时，这些是数据库计算出的相关性。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-----------+----------+----------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00041992788&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>现在sold_at的相关性为1。&lt;/p>
&lt;p>那么为什么数据库在相关性较低的时候使用位图扫描，而在相关性接近1的时候使用索引扫描呢？&lt;/p>
&lt;ul>
&lt;li>当相关性为1时，数据库估计请求范围内的行很可能在连续的页面中。在这种情况下，索引扫描很可能读取很少的页面。&lt;/li>
&lt;li>当相关性接近0时，数据库估计请求范围内的行很可能分散在整个表中。在这种情况下，使用位图扫描来映射存在行的表页是有意义的，只有这样才能获取行并应用条件。&lt;/li>
&lt;li>&lt;/li>
&lt;/ul>
&lt;p>下次将数据加载到表中时，请考虑如何查询数据，并确保以用于范围扫描的索引能够受益的方式进行排序。&lt;/p>
&lt;h3 id="cluster-command">CLUSTER Command
&lt;/h3>&lt;p>另一种按特定索引对磁盘上的表进行 &amp;ldquo;排序 &amp;ldquo;的方法是使用CLUSTER命令。&lt;/p>
&lt;p>例如：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TRUNCATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">TRUNCATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-- Insert rows without sorting
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INTO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">md5&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()::&lt;/span>&lt;span class="nb">text&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-01-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">interval&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;1 day&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">round&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">random&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">365&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AS&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">generate_series&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">INSERT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">100000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pg_stats&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;sale_fact&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-----------+-----------+----------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">9702674&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">05&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">010033822&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我们按照随机顺序向表中加载数据，结果sold_at的相关性接近于零。&lt;/p>
&lt;p>为了按sold_at对表进行 &amp;ldquo;重新排列&amp;rdquo;，我们使用CLUSTER命令，根据索引sale_fact_sold_at_ix对磁盘上的表进行排序。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CLUSTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">USING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CLUSTER&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pg_stats&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;sale_fact&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">tablename&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">attname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">correlation&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">-----------+----------+--------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">002239401&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">013389298&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>表格聚类后，我们可以看到sold_at的相关性为1。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1269.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>关于CLUSTER命令需要注意的一些事情。&lt;/p>
&lt;ul>
&lt;li>通过特定列对表进行聚类可能会影响其他列的相关性。例如，请看我们将表按sold_at聚类后，列id的相关性。&lt;/li>
&lt;li>CLUSTER是一个重度、阻塞的操作，所以请确保不要在活表上执行。&lt;/li>
&lt;/ul>
&lt;p>基于这两个原因，最好是将数据分类插入，不要依赖CLUSTER。&lt;/p>
&lt;h2 id="使用-brin-索引高相关性的列">使用 BRIN 索引高相关性的列
&lt;/h2>&lt;p>说到索引，大多数开发人员会想到B-Tree索引。但是，PostgreSQL提供了其他类型的索引，比如&lt;a class="link" href="https://www.postgresql.org/docs/current/brin.html" target="_blank" rel="noopener"
>BRIN&lt;/a>。&lt;/p>
&lt;blockquote>
&lt;p>BRIN是为处理非常大的表而设计的，在这些表中，某些列与它们在表中的物理位置有一些自然的关联。&lt;/p>&lt;/blockquote>
&lt;p>BRIN是Block Range Index的缩写。根据文档，BRIN索引对于相关性高的列效果最好。正如我们在前面的章节中已经看到的，一些字段如自动递增的ID和时间戳与表的物理结构有天然的相关性，因此它们是BRIN索引的良好候选。&lt;/p>
&lt;p>在某些情况下，与类似的B-Tree索引相比，BRIN索引在大小和性能上可以提供更好的 &amp;ldquo;性价比&amp;rdquo;。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1270.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>BRIN索引的工作原理是将值的范围保持在表内相邻的若干页内。假设我们在一列中有这些值，每个值都是单表页。&lt;/p>
&lt;p>&lt;code>1, 2, 3, 4, 5, 6, 7, 8, 9&lt;/code>&lt;/p>
&lt;p>BRIN索引在表中相邻页的范围内工作。如果相邻页数设置为3，索引将把表格分为以下范围：&lt;/p>
&lt;p>&lt;code>[1,2,3], [4,5,6], [7,8,9]&lt;/code>&lt;/p>
&lt;p>对于每个范围，BRIN指数保持最小值和最大值。&lt;/p>
&lt;p>&lt;code>[1–3], [4–6], [7–9]&lt;/code>&lt;/p>
&lt;p>利用上面的索引，尝试搜索数值5。&lt;/p>
&lt;ul>
&lt;li>[1–3] - Definitely not here&lt;/li>
&lt;li>[4–6] - Might be here&lt;/li>
&lt;li>[7–9] - Definitely not here&lt;/li>
&lt;/ul>
&lt;p>利用BRIN索引，我们设法将搜索范围限制在4-6块。&lt;/p>
&lt;p>让我们再举一个例子，这次列中的值会有一个接近于零的相关性，这意味着它们没有被排序。&lt;/p>
&lt;p>&lt;code>[2,9,5], [1,4,7], [3,8,6]&lt;/code>&lt;/p>
&lt;p>将3个相邻的块进行索引，会产生以下范围。&lt;/p>
&lt;p>&lt;code>[2–9], [1–7], [3–8]&lt;/code>&lt;/p>
&lt;p>让我们试着搜索一下数值5。&lt;/p>
&lt;p>[2–9] - 可能在这
[1–7] - 可能在这
[3–8] - 可能在这&lt;/p>
&lt;p>在这种情况下，索引根本没有限制搜索，因此它是没有用的。&lt;/p>
&lt;h3 id="理解-pages_per_range">理解 pages_per_range
&lt;/h3>&lt;p>相邻页面的数量由参数pages_per_range决定。每个范围的页数会影响BRIN索引的大小和精度。&lt;/p>
&lt;p>大的pages_per_range会产生一个小而不准确的索引。
小的pages_per_range会产生更大更准确的索引。
默认的页面_per_range为128页。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1271.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>为了演示，让我们在2个相邻页面的范围上创建一个BRIN索引，并搜索值5。&lt;/p>
&lt;ul>
&lt;li>[1–2] - 肯定不在这&lt;/li>
&lt;li>[3–4] - 肯定不在这&lt;/li>
&lt;li>[5–6] - 可能在这&lt;/li>
&lt;li>[7–8] - 肯定不在这&lt;/li>
&lt;li>[9] - 肯定不在这&lt;/li>
&lt;/ul>
&lt;p>使用每个范围为2页的索引，我们能够将搜索限制在第5和第6块。当范围为3页时，索引将搜索范围限制在4、5和6块。&lt;/p>
&lt;p>两个索引之间的另一个区别是，当范围是3页时，我们只需要保留3个范围。当范围为2时，我们必须保留5个范围，所以索引更大。&lt;/p>
&lt;p>&lt;strong>创建 BRIN 索引&lt;/strong>&lt;/p>
&lt;p>使用之前的sales_fact，让我们在sold_at列上创建一个BRIN索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_bix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">USING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BRIN&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WITH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pages_per_range&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这就创建了一个BRIN索引，默认的页面_per_range = 128。&lt;/p>
&lt;p>让我们尝试查询销售日期的范围。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BETWEEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">13&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">11&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">1135&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">61&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4319&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Recheck&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Rows&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Removed&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Recheck&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">23130&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Blocks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lossy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">256&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_bix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">03&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">12500&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Execution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">877&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>数据库使用我们的BRIN索引得到了一系列的销售日期，但这不是有趣的部分&amp;hellip;&amp;hellip;。&lt;/p>
&lt;p>&lt;strong>优化 pages_per_range&lt;/strong>&lt;/p>
&lt;p>根据执行计划，数据库从使用索引找到的页面中删除了23130条记录。这可能表明我们为索引设置的范围对于这个特定的查询来说太大。让我们尝试创建一个每个范围内页数较少的索引。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_bix64&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">USING&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">BRIN&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WITH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pages_per_range&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">ANALYZE&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BETWEEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">13&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">1048&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4319&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Recheck&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Rows&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Removed&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Recheck&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">9434&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Heap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Blocks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">lossy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Bitmap&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_bix64&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">02&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">6667&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Execution&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Time&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">491&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ms&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在每个范围为64页的情况下，数据库从使用索引找到的页面中删除的记录较少，只删除了9,434条，而当范围为128页时，删除了23,130条。这意味着数据库需要做更少的IO，查询速度也稍快，约5.5ms，而不是约8.9ms。&lt;/p>
&lt;p>用不同的pages_per_range值测试索引，产生了以下结果。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">PAGES_PER_RANGE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ROWS_REMOVED_BY_INDEX_RECHECK&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">23&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">130&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">434&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">874&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">446&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">446&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我们可以看到，当我们减少pages_per_range时，索引更加准确，并且从使用索引找到的页面中删除的行数更少。&lt;/p>
&lt;p>注意，我们针对一个非常特殊的查询进行了优化。这对于演示目的来说是可以的，但在实际生活中，最好使用满足大多数查询需求的值。&lt;/p>
&lt;p>&lt;strong>评估指数大小&lt;/strong>&lt;/p>
&lt;p>BRIN索引的另一大卖点是其大小。在前面的章节中，我们在sold_at字段上创建了一个B-Tree索引。该索引的大小是2224kB。page_per_range=128的BRIN索引的大小只有48kb。这比B-Tree索引小了46倍。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Schema&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Owner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Size&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------+-----------------------+-------+-------+-----------+-------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_bix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">haki&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">48&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kB&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">haki&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2224&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kB&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>BRIN索引的大小也会受到pages_per_range的影响。例如，page_per_range=2的BRIN索引重56kb，仅比48kb稍大。&lt;/p>
&lt;h2 id="让索引-不可见">让索引 &amp;ldquo;不可见&amp;rdquo;
&lt;/h2>&lt;p>PostgreSQL有一个很好的功能，叫做事务性DDL。在使用Oracle多年后，我已经习惯了诸如CREATE、DROP和ALTER等结束事务的DDL命令。然而，在PostgreSQL中，你可以在事务中执行DDL命令，而且只有当事务提交时，更改才会生效。&lt;/p>
&lt;p>正如我最近发现的那样，使用事务性DDL，你可以使索引不可见! 当你想看看一个执行计划在没有一些索引的情况下是什么样子的时候，这就很方便了。&lt;/p>
&lt;p>例如，在上一节的sale_fact表中，我们在sold_at上创建了一个索引。获取7月份销售额的执行计划是这样的。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BETWEEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">using&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">182&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">80&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4319&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Cond&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="n">P&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>为了看看如果索引sale_fact_sold_at_ix不存在，执行计划会是什么，我们可以在一个事务里面放弃索引，然后立即回滚。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BEGIN&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">BEGIN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">INDEX&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">EXPLAIN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">SELECT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">-#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WHERE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BETWEEN&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">QUERY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">PLAN&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">---------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Seq&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Scan&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cost&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">..&lt;/span>&lt;span class="mi">2435&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">rows&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4319&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">Filter&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-01&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">AND&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sold_at&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;2020-07-31&amp;#39;&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="nb">date&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ROLLBACK&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">ROLLBACK&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我们首先使用BEGIN开始一个事务。然后我们放弃索引并生成一个执行计划。注意，现在执行计划使用了全表扫描，就像索引不存在一样。此时事务仍在进行中，所以还没有丢弃索引。为了在不丢弃索引的情况下完成事务，我们使用ROLLBACK命令回滚事务。&lt;/p>
&lt;p>现在，确保索引仍然存在。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">db&lt;/span>&lt;span class="o">=#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">\&lt;/span>&lt;span class="n">di&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">List&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">of&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">relations&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">Schema&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Name&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Type&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Owner&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Table&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Size&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">--------+----------------------+-------+-------+-----------+---------
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact_sold_at_ix&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">index&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">haki&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sale_fact&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">2224&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">kB&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其他不支持事务性DDL的数据库提供了其他方法来实现同样的目标。例如，Oracle让你将一个索引标记为不可见，这将导致优化器忽略它。&lt;/p>
&lt;p>注意：在事务内部丢弃索引会在事务处于活动状态时锁定表的并发选择、插入、更新和删除。请在测试环境中谨慎使用，并避免在生产数据库中使用。&lt;/p>
&lt;h2 id="不要在圆周时间安排长期运行的流程">不要在圆周时间安排长期运行的流程
&lt;/h2>&lt;p>众所周知，当一只股票的价格达到一个漂亮的整数，如10元、100元、1000元时，就会发生奇怪的事情，这是投资者都知道的事实。&lt;a class="link" href="https://www.investopedia.com/trading/support-and-resistance-basics/#mntl-sc-block_1-0-38" target="_blank" rel="noopener"
>正如下面的文章&lt;/a>所解释的。&lt;/p>
&lt;blockquote>
&lt;p>[&amp;hellip; &amp;hellip;]资产的价格可能会有一个困难的时间 超过一个整数，如50元或100元/股。大多数没有经验的交易者倾向于在价格处于整数时买入或卖出资产，因为他们更有可能觉得一只股票在这种水平上的价值相当高。&lt;/p>&lt;/blockquote>
&lt;p>开发商在这个意义上与投资者并没有什么不同。当他们需要安排一个长期运行的过程时，他们通常会把时间安排在一个整点。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/WechatIMG1272.jpeg"
loading="lazy"
>&lt;/p>
&lt;p>这种在圆周时间安排任务的倾向，会在这些时间内造成一些异常的负载。所以，如果你需要安排一些长期运行的进程，如果你在其他时间安排，你有更好的机会找到一个系统在休息。&lt;/p>
&lt;p>另一个好主意是给任务的日程安排应用一个随机的延迟，这样它就不会每次都在同一时间运行。这样，即使另一个任务安排在同一时间运行，也不会有大问题。如果你使用systemd定时器单元来安排任务，你可以使用&lt;a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd.timer.html#RandomizedDelaySec=" target="_blank" rel="noopener"
>RandomizedDelaySec&lt;/a>选项来实现。&lt;/p>
&lt;h2 id="结束语">结束语
&lt;/h2>&lt;p>本文涵盖了我自己经验中的一些琐碎和非琐碎的技巧。其中有些技巧很容易实现，有些则需要更深入地了解数据库的工作原理。数据库是大多数现代系统的支柱，所以花一些时间来了解它们的工作原理对任何开发人员来说都是一项很好的投资!&lt;/p></description></item><item><title>Skaffold 让 K8s 开发者更加酸爽</title><link>https://martinliu.cn/blog/skaffold-make-local-k8s-dev-easy/</link><pubDate>Wed, 15 Jul 2020 00:09:53 +0800</pubDate><guid>https://martinliu.cn/blog/skaffold-make-local-k8s-dev-easy/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-1.jpg" alt="Featured image of post Skaffold 让 K8s 开发者更加酸爽" />&lt;p>&lt;img src="https://martinliu.cn/images/skaffold.png"
loading="lazy"
>&lt;/p>
&lt;p>今天介绍一个本地 Kubernetes 开发的利器 Skaffold。
这是我偶然间发现的一个工具，询问了一下周围的人，居然还没有人用过。测试之后，确实有一种不吐不快的感觉。&lt;/p>
&lt;h2 id="简介">简介
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/intro.gif"
loading="lazy"
>&lt;/p>
&lt;p>Skaffold Google 开发的一个开源项目。是一个非常轻量的命令行工具，就是一个可执行文件。它的主页上是这样的介绍它的。&lt;/p>
&lt;ul>
&lt;li>轻量：Skaffold只是一个客户端工具。由于集群上不需要任何的相关组件，您的集群没有任何开销或维护负担。&lt;/li>
&lt;li>运行在任何地方：Skaffold是与世界分享你的项目的最简单的方法：&amp;ldquo;git clone&amp;rdquo;，然后 &amp;ldquo;skaffold run&amp;rdquo;。此外，你还可以使用配置文件、本地用户配置、环境变量和标志来轻松地集成不同环境的差异。&lt;/li>
&lt;li>功能丰富：Skaffold拥有许多Kubernetes原生开发的基本功能，包括基于策略的打镜像标签、资源端口转发和日志、文件同步等。&lt;/li>
&lt;li>优化你的开发：Skaffold使内部循环紧密，高度优化，让您在开发的同时得到即时反馈。&lt;/li>
&lt;/ul>
&lt;h2 id="客户评价">客户评价
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/forgerock.png"
loading="lazy"
>&lt;/p>
&lt;p>&amp;ldquo;我们的客户很喜欢[Kubernetes]，但一直给我们反馈说在Kubernetes上开发很麻烦。Skaffold一针见血地解决了这个问题。以前需要几分钟才能部署的docker镜像或配置的更改，现在只需要几秒钟。Skaffold的插件架构使我们能够部署到Helm或Kustomize，并使用各种docker构建插件，如Kaniko。Skaffold用一个精简的工具取代了我们定制的实用程序和脚本集合，并且易于使用。&amp;rdquo;
Warren Strange，ForgeRock的工程总监。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/quora.png"
loading="lazy"
>&lt;/p>
&lt;p>&amp;ldquo;当我们评估我们可以使用Kubernetes的工作流程时，Skaffold脱颖而出，成为我们在开发和部署中都想要的工具。它为我们提供了一个跨应用程序的通用入口点，我们也可以为CI/CD重用。现在，我们所有的Kubernetes应用的CI/CD管道在构建和部署时都使用Skaffold。&amp;rdquo;
Taylor Barrella，Quora的软件工程师&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/tng.png"
loading="lazy"
>&lt;/p>
&lt;p>&amp;ldquo;Skaffold是一个了不起的工具，它为我们简化了开发和交付。Skaffold通过覆盖两个维度，击中了我们的甜蜜点。第一，从本地开发、集成测试到交付的整个开发周期。第二，Skaffold让我们能够在Linux、OSX和Windows上独立开发，不需要特定的平台逻辑。&amp;rdquo;
Martin Höfling，TNG技术咨询有限公司首席顾问&lt;/p>
&lt;h2 id="推荐首次测试流程">推荐首次测试流程
&lt;/h2>&lt;p>前置条件，你的开发用工作电脑上已经安装了它需要调用的 kubectl 和 docker 命令，kubectl 需要有至少一个可用的配置，这个配置可以指向任一一个你有权限部署的 Kubernetes 集群。&lt;/p>
&lt;p>我在 macOS 上，直接运行 &lt;code>‌brew install skaffold&lt;/code> 即可，其它系统参考：&lt;a class="link" href="https://skaffold.dev/docs/install/" target="_blank" rel="noopener"
>https://skaffold.dev/docs/install/&lt;/a>&lt;/p>
&lt;p>克隆 Skaffold 的代码库到本地，获取必要的测试应用代码。&lt;/p>
&lt;p>&lt;code>‌git clone https://github.com/GoogleContainerTools/skaffold&lt;/code>&lt;/p>
&lt;p>进入代码库中的‘hello world’示例应用。&lt;/p>
&lt;p>执行：&lt;code>‌cd skaffold/examples/getting-started&lt;/code>&lt;/p>
&lt;p>执行 &lt;code>‌skaffold dev&lt;/code> ，你会看到 Skaffold 进入了这个项目的构建和运行的状态，执行结果是持续的输出 ”[getting-started] Hello world!“&lt;/p>
&lt;p>现在 Skaffold 就进入了 /getting-started 的监视状态。观察任何代码文件的修改存盘动作，每次代码的变更会触发 Skaffold 流水线的执行，skaffold.yaml 文件中描述了本地流水线中的相关动作：&lt;/p>
&lt;ul>
&lt;li>使用 Dockerfile 从源头构建Docker镜像。&lt;/li>
&lt;li>用Docker镜像的内容的sha256哈希值来打上标签。&lt;/li>
&lt;li>更新 Kubernetes manifest k8s-pod.yaml，以使用上一步构建的镜像。&lt;/li>
&lt;li>使用 kubectl apply -f 部署 Kubernetes manifest。&lt;/li>
&lt;li>从已部署的应用程序取回日志在本地控制台显示。&lt;/li>
&lt;/ul>
&lt;p>现在用代码编辑器打开这个项目唯一的程序文件 main.go ，修改其中的 Hello World 为其它你想到的词，保存后，观察构建的过程。&lt;/p>
&lt;h2 id="推荐微服务测试">推荐微服务测试
&lt;/h2>&lt;p>参考以下视频，测试 Skaffold 代码库中的 microservice 项目。&lt;/p>
&lt;h2 id="skaffold-流水线阶段">Skaffold 流水线阶段
&lt;/h2>&lt;p>Skaffold 主要会用到五个阶段。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/workflow.png"
loading="lazy"
>&lt;/p>
&lt;p>其所有阶段如下：&lt;/p>
&lt;ul>
&lt;li>Init ： generate a starting point for Skaffold configuration&lt;/li>
&lt;li>Build ：build images with different builders&lt;/li>
&lt;li>Tag ： tag images based on different policies&lt;/li>
&lt;li>Test ：test images with structure tests&lt;/li>
&lt;li>Deploy ：deploy with kubectl, kustomize or helm&lt;/li>
&lt;li>File Sync ： sync changed files directly to containers&lt;/li>
&lt;li>Log ： Tailing tail logs from workloads&lt;/li>
&lt;li>Port Forwarding ：forward ports from services and arbitrary resources to localhost&lt;/li>
&lt;li>Cleanup ： cleanup manifests and images&lt;/li>
&lt;/ul>
&lt;p>当你启动Skaffold时，它就会收集你项目中的源代码，并使用你所选择的工具构建工件；工件一旦成功构建，就会根据你的需要进行标记，并推送到你指定的仓库中。在工作流程的最后，Skaffold还帮助你将工件部署到你的Kubernetes集群中，同样使用你喜欢的工具。&lt;/p>
&lt;p>Skaffold允许你跳过各个阶段。例如，如果你在本地使用Minikube运行Kubernetes，Skaffold不会将工件推送到远程仓库。&lt;/p>
&lt;p>每个阶段的详情见：&lt;a class="link" href="https://skaffold.dev/docs/pipeline-stages/" target="_blank" rel="noopener"
>https://skaffold.dev/docs/pipeline-stages/&lt;/a>&lt;/p>
&lt;h2 id="架构设计">架构设计
&lt;/h2>&lt;p>Skaffold 秉承着插件化的设计思想。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/architecture.png"
loading="lazy"
>&lt;/p>
&lt;p>以上架构内置了对下来工具的支持：&lt;/p>
&lt;ul>
&lt;li>Build
&lt;ul>
&lt;li>Dockerfile locally, in-cluster with kaniko or on cloud using Google Cloud Build&lt;/li>
&lt;li>Jib Maven and Jib Gradle locally or on cloud using Google Cloud Build&lt;/li>
&lt;li>Bazel locally&lt;/li>
&lt;li>Cloud Native Buildpacks locally or on cloud using Google Cloud Build&lt;/li>
&lt;li>Custom script locally or in-cluster&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Test
&lt;ul>
&lt;li>container-structure-test&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Tag&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>Git tagger&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>
&lt;p>Sha256 tagger&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Env Template tagger&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DateTime tagger&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Deploy&lt;/p>
&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>Kubernetes Command-Line Interface (kubectl)&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>Helm&lt;/li>
&lt;li>kustomize&lt;/li>
&lt;/ul>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>Skaffold 确实让基于 Kubernetes 的开发者的本地工作环境更加优化和整洁了。希望本文对你的工作有所帮助。&lt;/p></description></item><item><title>如何在墙内正常导入 Vagrant 虚拟机模板</title><link>https://martinliu.cn/blog/download-import-vagrant-box/</link><pubDate>Thu, 26 Mar 2020 08:57:57 +0800</pubDate><guid>https://martinliu.cn/blog/download-import-vagrant-box/</guid><description>&lt;img src="https://martinliu.cn/images/vagrant-download-box.jpg" alt="Featured image of post 如何在墙内正常导入 Vagrant 虚拟机模板" />&lt;p>当你满心欢喜的安装完了 vagrant 之后，在你第一次 &lt;code>vagrant up&lt;/code> 命令的时候，是下载超时么？你的内心是什么感受？想放弃了么？&lt;/p>
&lt;p>其实你只需要找到国内的 box 文件镜像服务器，或者下载地址，然后手工下载对应的 Box 文件（操作系统镜像文件），并导入即可，本文将帮你铲除这只官方镜像文件下载失败的拦路虎。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/vagrant-home-page.png"
loading="lazy"
>&lt;/p>
&lt;p>Vagrant 的优势：&lt;/p>
&lt;ul>
&lt;li>虚拟机对于系统级开发和测试工作具有不可替代的作用&lt;/li>
&lt;li>手工安装的虚拟机非常&lt;/li>
&lt;/ul>
&lt;h2 id="准备工作">准备工作
&lt;/h2>&lt;p>我的测试环境如下，如果你的测试环境和我的不同，但是本操作方法和过程也同样的适用于相似的环境。&lt;/p>
&lt;p>环境描述：&lt;/p>
&lt;ul>
&lt;li>macOS catalina version 10.15.3&lt;/li>
&lt;li>vagrant 2.2.4&lt;/li>
&lt;li>Virtuabox 6.0.15r135660&lt;/li>
&lt;/ul>
&lt;p>如果你也百度了’ vagrant box 国内镜像‘的话，结果会使你很失望，清华大学等站点只是缓存了个别的镜像文件，并没有其它版本特别全面的网站，更没有完整的镜像。如果你知道其它国内的镜像站点请告诉我，我会增加到本文。&lt;/p>
&lt;p>Ubuntu 的可以浏览这两个目标下载网址。&lt;/p>
&lt;p>&lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/vagrant/" target="_blank" rel="noopener"
>https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/vagrant/&lt;/a>&lt;/p>
&lt;p>然后用vagrant 下面的命令就可以将 box 下载并且添加到本地。&lt;/p>
&lt;ul>
&lt;li>ubuntu 18.04 LTS:&lt;/li>
&lt;/ul>
&lt;p>vagrant box add &lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/bionic/current/bionic-server-cloudimg-amd64-vagrant.box" target="_blank" rel="noopener"
>https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/bionic/current/bionic-server-cloudimg-amd64-vagrant.box&lt;/a> &amp;ndash;name ubuntu18&lt;/p>
&lt;ul>
&lt;li>ubunt 16.04 LTS：&lt;/li>
&lt;/ul>
&lt;p>vagrant box add &lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/xenial/current/xenial-server-cloudimg-amd64-vagrant.box" target="_blank" rel="noopener"
>https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/xenial/current/xenial-server-cloudimg-amd64-vagrant.box&lt;/a> &amp;ndash;name ubuntu16&lt;/p>
&lt;ul>
&lt;li>ubuntu14：&lt;/li>
&lt;/ul>
&lt;p>vagrant box add &lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/vagrant/trusty/current/trusty-server-cloudimg-amd64-vagrant-disk1.box" target="_blank" rel="noopener"
>https://mirrors.tuna.tsinghua.edu.cn/ubuntu-cloud-images/vagrant/trusty/current/trusty-server-cloudimg-amd64-vagrant-disk1.box&lt;/a> &amp;ndash;name ubuntu14&lt;/p>
&lt;p>对于 CentOS 而言，它的官网整理的比较好，提供了各种格式的下载，可能需要科学上网才能访问到 Centos 的下载网址。&lt;/p>
&lt;p>&lt;a class="link" href="http://cloud.centos.org/centos/7/vagrant/" target="_blank" rel="noopener"
>http://cloud.centos.org/centos/7/vagrant/&lt;/a>
&lt;a class="link" href="http://cloud.centos.org/centos/8/vagrant/" target="_blank" rel="noopener"
>http://cloud.centos.org/centos/8/vagrant/&lt;/a>&lt;/p>
&lt;p>实战建议：你并不需要下载过多的 box 操作系统镜像文件，够用即可。建议将最近有可能使用到的 Box 文件用断点续传的多线程下载工具下载到本机磁盘备用。我下载了一些，关注的微信号‘ MyDevOps ’ 回复 box1 即可获得百度网盘下载地址，这个共享目录中有本文中所提到的所有 Box 文件。&lt;/p>
&lt;h2 id="导入-box-文件">导入 Box 文件
&lt;/h2>&lt;p>用 &lt;code>vagrant box add&lt;/code> 命令将本地下载好的 box 文件导入到 vagrant 的主目录中，macOS 下是在&lt;code>~/.vagrant/&lt;/code> 目录里。&lt;/p>
&lt;p>使用&lt;code>vagrant box list&lt;/code>名先查看本地已有的 box 清单，下面的执行结果如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">➜ ~ vagrant box list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Puppetlabs Ubuntu 12.04.2 x86_64, VBox 4.2.10, No Puppet or Chef (virtualbox, 0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bento/centos-7.1 (virtualbox, 2.2.2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bento/centos-7.2 (virtualbox, 2.3.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bento/centos-8 (virtualbox, 202002.04.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bento/ubuntu-16.04 (virtualbox, 0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">coreos-alpha (virtualbox, 1451.2.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">geerlingguy/centos6 (virtualbox, 0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">geerlingguy/centos7 (virtualbox, 0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">geerlingguy/ubuntu1604 (virtualbox, 0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu/trusty64 (virtualbox, 20161207.0.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu/trusty64 (virtualbox, 20170307.0.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu/wily64 (virtualbox, 20160715.0.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu/xenial64 (virtualbox, 20161214.0.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ubuntu/xenial64 (virtualbox, 20170307.0.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">➜ ~
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用&lt;code>vagrant box add&lt;/code>导入，并确认。 参考下面的执行过程&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="n">vagrant&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="o">~/&lt;/span>&lt;span class="n">Downloads&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">box&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bionic&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cloudimg&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bionic&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">box&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Box&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">was&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">detected&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">metadata&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Adding&lt;/span> &lt;span class="n">it&lt;/span> &lt;span class="n">directly&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">box&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Adding&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="s1">&amp;#39;ubuntu/bionic&amp;#39;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">v0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">provider&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">box&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Unpacking&lt;/span> &lt;span class="n">necessary&lt;/span> &lt;span class="n">files&lt;/span> &lt;span class="n">from&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">file&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">///&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">martin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Downloads&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">box&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bionic&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cloudimg&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">box&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Successfully&lt;/span> &lt;span class="n">added&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="s1">&amp;#39;ubuntu/bionic&amp;#39;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">v0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="s1">&amp;#39;virtualbox&amp;#39;&lt;/span>&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="n">vagrant&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="n">list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Puppetlabs&lt;/span> &lt;span class="n">Ubuntu&lt;/span> &lt;span class="mf">12.04&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">x86_64&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">VBox&lt;/span> &lt;span class="mf">4.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">No&lt;/span> &lt;span class="n">Puppet&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">Chef&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bento&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">centos&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">7.1&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">2.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bento&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">centos&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">7.2&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">2.3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bento&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">centos&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">202002.04&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bento&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">16.04&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">coreos&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">alpha&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">1451.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">geerlingguy&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">centos6&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">geerlingguy&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">centos7&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">geerlingguy&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ubuntu1604&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bionic&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">trusty64&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">20161207.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">trusty64&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">20170307.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">wily64&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">20160715.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">xenial64&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">20161214.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">xenial64&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">virtualbox&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mf">20170307.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="校验所导入的-box">校验所导入的 Box
&lt;/h2>&lt;p>创建一个测试目录，并执行&lt;code>vagrant init ubuntu/bionic&lt;/code> ，然后使用 vagrant up 测试。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">pwd&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">martin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">code&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">➜&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">test&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">init&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bionic&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">Vagrantfile&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">has&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">been&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">placed&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">this&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">directory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">You&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">are&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">ready&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">vagrant&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">up&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">first&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">virtual&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">environment&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Please&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">read&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">comments&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Vagrantfile&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">well&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">documentation&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">vagrantup&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">more&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">information&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">on&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">using&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Vagrant&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>test 目录下面现在生成了一个默认的 Vagrantfile 文件，查看这个默认的 Vagrantfile 配置文件。这是一个很好的学习资料。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="n">test&lt;/span> &lt;span class="n">cat&lt;/span> &lt;span class="n">Vagrantfile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -*- mode: ruby -*-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vi: set ft=ruby :&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># All Vagrant configuration is done below. The &amp;#34;2&amp;#34; in Vagrant.configure&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># configures the configuration version (we support older styles for&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># backwards compatibility). Please don&amp;#39;t change it unless you know what&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># you&amp;#39;re doing.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Vagrant&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="o">|&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># The most common configuration options are documented and commented below.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># For a complete reference, please see the online documentation at&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># https://docs.vagrantup.com.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Every Vagrant development environment requires a box. You can search for&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># boxes at https://vagrantcloud.com/search.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">vm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">box&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;ubuntu/bionic&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Disable automatic box update checking. If you disable this, then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># boxes will only be checked for updates when the user runs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># `vagrant box outdated`. This is not recommended.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.box_check_update = false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Create a forwarded port mapping which allows access to a specific port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># within the machine from a port on the host machine. In the example below,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># accessing &amp;#34;localhost:8080&amp;#34; will access port 80 on the guest machine.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># NOTE: This will enable public access to the opened port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.network &amp;#34;forwarded_port&amp;#34;, guest: 80, host: 8080&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Create a forwarded port mapping which allows access to a specific port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># within the machine from a port on the host machine and only allow access&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># via 127.0.0.1 to disable public access&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.network &amp;#34;forwarded_port&amp;#34;, guest: 80, host: 8080, host_ip: &amp;#34;127.0.0.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Create a private network, which allows host-only access to the machine&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># using a specific IP.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.network &amp;#34;private_network&amp;#34;, ip: &amp;#34;192.168.33.10&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Create a public network, which generally matched to bridged network.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Bridged networks make the machine appear as another physical device on&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># your network.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.network &amp;#34;public_network&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Share an additional folder to the guest VM. The first argument is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># the path on the host to the actual folder. The second argument is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># the path on the guest to mount the folder. And the optional third&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># argument is a set of non-required options.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.synced_folder &amp;#34;../data&amp;#34;, &amp;#34;/vagrant_data&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Provider-specific configuration so you can fine-tune various&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># backing providers for Vagrant. These expose provider-specific options.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Example for VirtualBox:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.provider &amp;#34;virtualbox&amp;#34; do |vb|&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # Display the VirtualBox GUI when booting the machine&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># vb.gui = true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # Customize the amount of memory on the VM:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># vb.memory = &amp;#34;1024&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># View the documentation for the provider you are using for more&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># information on available options.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Enable provisioning with a shell script. Additional provisioners such as&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Puppet, Chef, Ansible, Salt, and Docker are also available. Please see the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># documentation for more information about their specific syntax and use.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># config.vm.provision &amp;#34;shell&amp;#34;, inline: &amp;lt;&amp;lt;-SHELL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># apt-get update&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># apt-get install -y apache2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># SHELL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>现在可以踏实的运行 vagrant up 了，Ubuntu 的 Box 文件导入通常没有什么问题。默认配置的 Ubuntu 版本 bionic 的 vm 现在就正常启动了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="n">test&lt;/span> &lt;span class="n">vagrant&lt;/span> &lt;span class="n">up&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Bringing&lt;/span> &lt;span class="n">machine&lt;/span> &lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span> &lt;span class="n">up&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="s1">&amp;#39;virtualbox&amp;#39;&lt;/span> &lt;span class="n">provider&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Importing&lt;/span> &lt;span class="n">base&lt;/span> &lt;span class="n">box&lt;/span> &lt;span class="s1">&amp;#39;ubuntu/bionic&amp;#39;&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Matching&lt;/span> &lt;span class="n">MAC&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">NAT&lt;/span> &lt;span class="n">networking&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Setting&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">VM&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">test_default_1585496539631_90780&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Clearing&lt;/span> &lt;span class="n">any&lt;/span> &lt;span class="n">previously&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">interfaces&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Preparing&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">interfaces&lt;/span> &lt;span class="n">based&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">configuration&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Adapter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">nat&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Forwarding&lt;/span> &lt;span class="n">ports&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">22&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">guest&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="mi">2222&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">adapter&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Running&lt;/span> &lt;span class="s1">&amp;#39;pre-boot&amp;#39;&lt;/span> &lt;span class="n">VM&lt;/span> &lt;span class="n">customizations&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Booting&lt;/span> &lt;span class="n">VM&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Waiting&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">machine&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">boot&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">may&lt;/span> &lt;span class="n">take&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">few&lt;/span> &lt;span class="n">minutes&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">SSH&lt;/span> &lt;span class="n">address&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">127.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2222&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">SSH&lt;/span> &lt;span class="n">username&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">vagrant&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">SSH&lt;/span> &lt;span class="n">auth&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">private&lt;/span> &lt;span class="n">key&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Warning&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Connection&lt;/span> &lt;span class="n">reset&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Retrying&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Vagrant&lt;/span> &lt;span class="n">insecure&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="n">detected&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Vagrant&lt;/span> &lt;span class="n">will&lt;/span> &lt;span class="n">automatically&lt;/span> &lt;span class="n">replace&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">newly&lt;/span> &lt;span class="n">generated&lt;/span> &lt;span class="n">keypair&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">better&lt;/span> &lt;span class="n">security&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Inserting&lt;/span> &lt;span class="n">generated&lt;/span> &lt;span class="n">public&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="n">within&lt;/span> &lt;span class="n">guest&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Removing&lt;/span> &lt;span class="n">insecure&lt;/span> &lt;span class="n">key&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">guest&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">it&lt;/span>&lt;span class="s1">&amp;#39;s present...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Key&lt;/span> &lt;span class="n">inserted&lt;/span>&lt;span class="o">!&lt;/span> &lt;span class="n">Disconnecting&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">reconnecting&lt;/span> &lt;span class="n">using&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="n">SSH&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Machine&lt;/span> &lt;span class="n">booted&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">ready&lt;/span>&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Checking&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">guest&lt;/span> &lt;span class="n">additions&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">VM&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">guest&lt;/span> &lt;span class="n">additions&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="n">VM&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">match&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">installed&lt;/span> &lt;span class="n">version&lt;/span> &lt;span class="n">of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">VirtualBox&lt;/span>&lt;span class="o">!&lt;/span> &lt;span class="n">In&lt;/span> &lt;span class="n">most&lt;/span> &lt;span class="n">cases&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">fine&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">but&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">rare&lt;/span> &lt;span class="n">cases&lt;/span> &lt;span class="n">it&lt;/span> &lt;span class="n">can&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">prevent&lt;/span> &lt;span class="n">things&lt;/span> &lt;span class="n">such&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">shared&lt;/span> &lt;span class="n">folders&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">working&lt;/span> &lt;span class="n">properly&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">If&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">see&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">shared&lt;/span> &lt;span class="n">folder&lt;/span> &lt;span class="n">errors&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">please&lt;/span> &lt;span class="n">make&lt;/span> &lt;span class="n">sure&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">guest&lt;/span> &lt;span class="n">additions&lt;/span> &lt;span class="n">within&lt;/span> &lt;span class="n">the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">virtual&lt;/span> &lt;span class="n">machine&lt;/span> &lt;span class="n">match&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">version&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">VirtualBox&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">have&lt;/span> &lt;span class="n">installed&lt;/span> &lt;span class="n">on&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">host&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">reload&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">VM&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Guest&lt;/span> &lt;span class="n">Additions&lt;/span> &lt;span class="n">Version&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">5.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">34&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">VirtualBox&lt;/span> &lt;span class="n">Version&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">6.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">==&amp;gt;&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Mounting&lt;/span> &lt;span class="n">shared&lt;/span> &lt;span class="n">folders&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">vagrant&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">Users&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">martin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">code&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>现在 ssh 登录到这个崭新的 vm 。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="err">➜&lt;/span> &lt;span class="n">test&lt;/span> &lt;span class="n">vagrant&lt;/span> &lt;span class="n">ssh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Welcome&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">Ubuntu&lt;/span> &lt;span class="mf">18.04&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">4&lt;/span> &lt;span class="n">LTS&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">GNU&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Linux&lt;/span> &lt;span class="mf">4.15&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">91&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">generic&lt;/span> &lt;span class="n">x86_64&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="n">Documentation&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">help&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="n">Management&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">landscape&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">canonical&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="n">Support&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">advantage&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span> &lt;span class="n">information&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">Sun&lt;/span> &lt;span class="n">Mar&lt;/span> &lt;span class="mi">29&lt;/span> &lt;span class="mi">15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">53&lt;/span> &lt;span class="n">UTC&lt;/span> &lt;span class="mi">2020&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">System&lt;/span> &lt;span class="nb">load&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.25&lt;/span> &lt;span class="n">Processes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">99&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Usage&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">%&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="mf">9.63&lt;/span>&lt;span class="n">GB&lt;/span> &lt;span class="n">Users&lt;/span> &lt;span class="n">logged&lt;/span> &lt;span class="ow">in&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Memory&lt;/span> &lt;span class="n">usage&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">12&lt;/span>&lt;span class="o">%&lt;/span> &lt;span class="ne">IP&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">enp0s3&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Swap&lt;/span> &lt;span class="n">usage&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">0&lt;/span> &lt;span class="n">packages&lt;/span> &lt;span class="n">can&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">updated&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">0&lt;/span> &lt;span class="n">updates&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">security&lt;/span> &lt;span class="n">updates&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">vagrant&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bionic&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">~$&lt;/span> &lt;span class="n">top&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="导入-centos-7-可能遇到的问题">导入 CentOS 7 可能遇到的问题
&lt;/h2>&lt;p>CentOS 7 和 8 的相关版本在我的测试环境中都出现了导入正常 vagrant up 异常的问题，通常网络搜索错误代码后，就可以解决了，如果有任何问题，欢迎到我的微信公众后台留言。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>Vagrant 的功能性和必要性是非常高的，特别是对于天朝的码农而言，就更加重要了。它是 DevOps 工具链上的知名工具，而它的使用率和广泛性却不高。后续还会出这方面的系列内容，讲解更多关于 Vagrant 的优化和功能。&lt;/p>
&lt;p>2io&lt;/p></description></item><item><title>SLA、SLO 和 SLI 还是傻傻分不清么？</title><link>https://martinliu.cn/blog/sre-sla-slo-sli/</link><pubDate>Thu, 05 Mar 2020 17:37:29 +1100</pubDate><guid>https://martinliu.cn/blog/sre-sla-slo-sli/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-6.jpg" alt="Featured image of post SLA、SLO 和 SLI 还是傻傻分不清么？" />&lt;p>SLA、SLI 和 SLO 是 SRE 工程实践里非常核心的概念，但是大家在同时提到这些概念的时候，经常容易混淆。&lt;/p>
&lt;p>长篇大论的文章反而容易使人更加疑惑，还不如画一张示意图说明一下，帮助大家一次性彻底梳理清楚这些不可以含糊不清的核心概念。说明一下，下图假设所讨论的 SLA 个数为 1，使用了软件工程中 ER 图的表达方式，但也有所变化。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/sla-sli-slo.jpeg"
loading="lazy"
alt="SLA、SLO、SLI"
>&lt;/p>
&lt;p>一图讲清 SLA、SLO、SLI&lt;/p>
&lt;p>本文不讲 why，只是帮助大家梳理清楚这些概念在以上人机系统中的相互关系。虽然不想做名词解释。但是为了方便起见，整理一个术语清单。&lt;/p>
&lt;ul>
&lt;li>SLA = Service Level Agreement = 服务质量/水平协议&lt;/li>
&lt;li>SLO = Service Level Objective = 服务质量/水平目标&lt;/li>
&lt;li>SLI = Services Level Indicator = 服务质量/水平指标&lt;/li>
&lt;/ul>
&lt;p>下面用人、事、物的逻辑进行阐释。&lt;/p>
&lt;h2 id="人和事">人和事
&lt;/h2>&lt;p>用从上到下，从左到右的顺序。&lt;/p>
&lt;p>客户 - 每 1 个客户在使用产品服务时，都显性或隐性的基于某 1 个 SLA，SLA 和客户之间是一种 1 对 1 的文档关系，这份协议文档就显性或者隐性的存在于系统中。客户使用 1 种，或者 n 种连接方式访问产品服务的 1 个或者 n 个应用系统。&lt;/p>
&lt;p>销售 - SLA 本身是所销售产品服务的一部分，它规定了承诺给客户的产品功用和质量。基于 SLA，客户可以选择用付费或者免费的方式使用产品。1 个/份 SLA 的销售工作可以由 1 到 n 位销售完成。销售和客户都幻想着几乎完美的 SLA，这样代表企业利益的销售，以及产品的客户就都可以达到双赢的局面，皆大欢喜。&lt;/p>
&lt;p>产品 - 通过与销售的间接互动，或者直接的客户调研，产品经理能够确定应用系统所应该具有的功能和发展方向。&lt;/p>
&lt;p>SRE - SRE 和产品共同制定了每个 SLA 相关应用系统的 SLO，SLO 定量的定义了每 1 个应用系统所应该具备的服务质量，1 个应用系统的 SLO 被该产品服务的 SLO 文档定义，在该文档中 SLO 被映射到 1 个或者 n 个 SLI，每个 SLI 都需要用监控工具持续采集数据，通常它们的数值单位各不相同。所有 SLO 都是用百分比数值形式表达的，例如：99.99% 的成功率，90％ 的请求延迟 &amp;lt; 400 毫秒等。SRE 和产品经理/专家还应该共同关注运行应用系统的基础设施层，确保基础设施的可用性和容量足以满足目标数量的用户访问，而且还要考虑和设计底层资源的容灾和跨区多活等复杂场景。&lt;/p>
&lt;p>开发/运维 - 重要但暂不做讨论。&lt;/p>
&lt;h2 id="事">事
&lt;/h2>&lt;p>用从下往上的顺序。&lt;/p>
&lt;p>IaaS 云服务 - 也可以是其它类型的可以供应用系统运行的环境。这里存在着 1 到 n 种子服务。它和上层的 n 个应用系统通常是 n 对 n 的关系。&lt;/p>
&lt;p>应用系统 - 1 个到 n 个应用系统构成了 1 个产品服务（内含SLA），在和客户的互动中实现着产品服务的业务价值。&lt;/p>
&lt;p>文档 - 以网页或者纸张的形式向用户描述了某个应用服务所提供的服务内容和质量信息。向用户提供这个文档并不是强制、显性和必须的。&lt;/p>
&lt;h2 id="结束">结束
&lt;/h2>&lt;p>请根据以上解释，结合你的实际工作场景，想象并描绘一下 SLA 、SLO 和 SLI 在你周围的人事物中关系网。在SRE 的工作实践中，定义 SLO，并梳理 SLI，将量化以后的目标和说明文档化，并让各个干系人认同并签署，是一项基础的起步工作。&lt;/p>
&lt;p>本文参考了 Google 出品的两本SRE 书籍，这两本书的英文版在 Google 的官网可以免费在线阅读。SRE Workbook 的简体中文版会在2020 年中出版。&lt;/p></description></item><item><title>怎样使用两个DevOps研究模型？</title><link>https://martinliu.cn/blog/2019-state-devops-report-insight-2/</link><pubDate>Sun, 01 Sep 2019 17:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/2019-state-devops-report-insight-2/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/1-jafadjf.jpg" alt="Featured image of post 怎样使用两个DevOps研究模型？" />&lt;p>本文要覆盖的章节是《 How to use the research models》 这一章。双模型在今年的报告中首次出现了，它们是效能模型和生产力模型。为什么会存在两个模型？有什么区别？有什么相似之处？最重要的问题是，你怎么用它们来指导你的DevOps工作？&lt;/p>
&lt;p>本文的阅读建议：&lt;/p>
&lt;ul>
&lt;li>下载我整理的最新版的《DevOps能力成长模型》，含双模型分解图。&lt;/li>
&lt;li>阅读和参考前5年的DevOps状态调查报告，了解今年这份报告的历史和发展历程。以前的文章中有下载链接/二维码。&lt;/li>
&lt;li>阅读2019年的调查问卷的中文版，感谢中国DevOps社区翻译团队对英文原版问卷的翻译工作，如果你都不知道这些调查结果是通过什么问卷调查得出的，那真的是很可惜。如果你想用这套问卷工具在企业内部做调研，请使用前文中的免费调查服务申请流程。样例问卷的访问地址：&lt;a class="link" href="https://www.wjx.cn/jq/43837840.aspx" target="_blank" rel="noopener"
>https://www.wjx.cn/jq/43837840.aspx&lt;/a>&lt;/li>
&lt;li>在Google的网站上做极简版DevOps行业基础测试，它是6年行业调查结果数据库的首次对外开放。&lt;/li>
&lt;/ul>
&lt;h2 id="模型是怎么诞生的">模型是怎么诞生的？
&lt;/h2>&lt;p>首先，我们需要了解一下这份持续了6年的报告是谁主导并开发的？这是一个怎样的团队？从DORA公司网站的这个页面上，可以看到团队人员介绍。&lt;a class="link" href="https://devops-research.com/about.html" target="_blank" rel="noopener"
>https://devops-research.com/about.html&lt;/a> 如下所示。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567336555/1sajldfkj.png"
loading="lazy"
>&lt;/p>
&lt;p>不做其它任何解读和评论，只想请大家关注一下分析报告的主持者的title : Dr Nicole Forsgren, CEO and Chief Scientist ; 翻译一下 Nicole Forsgren 博士，CEO和首席科学家。她是一个长期的IT行业从业人员，最早专注于DevOps的行业调研员。她持有管理信息系统的博士学位和会计硕士学位。从社交媒体上可以看出她和行业大咖Jez Humber和Gene Kim都是好朋友。&lt;/p>
&lt;p>其次，如果你也回顾了所有往届的DevOps状态调查报告，我们应该能体会到这场历时6年行业调研的基本逻辑和脉络。在第一年就已经提出了四大黄金度量指标，并且以此为主线；每年反复验证状态，以及其他相关影响因素。使用了&lt;strong>穷举&lt;/strong>的逻辑，每年根据行业的发展动态，根据和其它业内大咖的讨论，适当的加入新的调查点。当然每个调查的能力点也是需要每年反复确认和验证，调查点之间的逻辑关系也越来越明显，经过二次研究之后就形成了DevOps能力成长模型。&lt;/p>
&lt;p>最后，DevOps能力成长模型诞生于《Accelerate:The Science of Lean Software and DevOps: Building and Scaling High Performing Technology Organizations 》这本书。
&lt;a class="link" href="https://www.amazon.com/Accelerate-Software-Performing-Technology-Organizations/dp/1942788339" target="_blank" rel="noopener"
>https://www.amazon.com/Accelerate-Software-Performing-Technology-Organizations/dp/1942788339&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1530036828/Accelerate.jpg"
loading="lazy"
>&lt;/p>
&lt;p>在这本书里分模块（局部）的介绍了DevOps能力模型的影响逻辑关系，从转型型领导力一直推导出模型的最右侧：组织效能和非商业效能。这个模型应该就是历届DevOps状态调查研究背后的理论基础，当然它也应该是慢慢发展和完善出来的，起码数字转型这个话题是2018年才出现的热点。模型的数值计算算法，见近两年报告的附录部分。这个模型在本书中是从各个不同的局部关系逐渐介绍的。如下图所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567337105/3-jsfjaksjf333.png"
loading="lazy"
>&lt;/p>
&lt;p>Accelerate全书的逻辑不仅在于介绍各种DevOp实践、技术、文化、领导力等等相关因素有哪些，更重要的是揭示出这些影响因素（能力点）之间的关联关系。在书的最后展示了DevOps能力成长模型的全图，如下图所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567337168/4-ruwiur848.png"
loading="lazy"
>&lt;/p>
&lt;p>Accelerate这本书也提供了这幅图的电子版下载链接：&lt;a class="link" href="https://devops-research.com/assets/transformation_practices.pdf" target="_blank" rel="noopener"
>https://devops-research.com/assets/transformation_practices.pdf&lt;/a>&lt;/p>
&lt;p>这是一份非常棒的学习资料，如果你还没有买本书的话，也可以下载学习这份精华资料。这份文档的总标题是：”调研总体策划“，除了模型之外该文档还提供了一张全面复杂的表格，表格的名字：”高效能团队，管理、领导力行为和实践调查表，由Steve Bell，Karen Whitley Bell“；如果你想对自己的组织进行全面的调研的话，这也是一份优秀的调研方案。调研的矩阵如下：&lt;/p>
&lt;ul>
&lt;li>纵向：文化、组织结构、直接学习和对齐价值、部署策略、通过分析提高流动性和训练有素的问题解决、工作方式节奏化&amp;amp;日常化&lt;/li>
&lt;li>横向：团队实践、管理实践、领导力实践。&lt;/li>
&lt;/ul>
&lt;p>我很有幸2017年在北京DevOpsDays大会上参加Jez先生的培训，并获赠了Jez先生的签名版《Accelerate》纸版书，其实在这以前我已经购买了Kindle的电子版和Audible的有声书版。我反复研读了这本书的各种版本，再次强烈推荐所有DevOps相关的管理者一定要学习这本书。&lt;/p>
&lt;p>以书中的模型为基础，2018年的DevOps状态报告里以又进一步做了各种扩展，如果你读过去年的报告，你可以看到如下的各种局部的扩展。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567337168/7asdfweruui238.png"
loading="lazy"
>&lt;/p>
&lt;p>大家注意看2018年的这个局部模型图的标题”精益和敏捷实践“，这里也包含敏捷开发实践。我在反复琢磨这个模型之后，用Twitter私信问过Nicole博士。我问他为何没有专项调查过敏捷开发实践？模型上为何不给敏捷开发一个位置？她的回复是，我们之前已经调研过了，而且模型上也提到了。可能在全球的软件开发工程水平看，有可能Nicole博士团队认为敏捷开发应该是比较基础的软件开发实践，据我个人了解国外高水平公司要么都已经规范照做了，要么也有像Google这样的高水平公司确实也不显性的宣传自己是敏捷开发，甚至吐槽敏捷的。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567337168/8jfasjflsdf.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567337168/9ruwueriowur.png"
loading="lazy"
>&lt;/p>
&lt;p>2018年对模型的扩展力度还是很大的，提出了很多新的调查项；为了能看到方便的看到一个DevOps能力模型的全景视图，我使用OmniGraffle软件基于《Accelerate》书中的模型，扩充绘制了如下的模型图：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567338260/12-23ru83.png"
loading="lazy"
>&lt;/p>
&lt;p>这幅图向我们完整的揭示了到2018年以来的所有DevOps调研点，有些点是经过多年反复验证的，有些是2018年新引入的。这幅图花了我几天时间，在这个过程中也反复的推敲了其中的逻辑关系。这幅图仅代表我个人的观点，不代表DORA和《Accelerate》书籍的任何观点；需要声明的是：我绘制的DevOps能力成长模型并非我的个人著作，引用了DORA和《Accelerate》的著作，但我力求精确无误的表达整个模型。再次声明，这个模型图非官方出品，是我的个人研究。&lt;/p>
&lt;p>研究模型的研究逻辑是穷举法，是从左到右的推导和影响关系。最新发布的2019年DevOps状态调查报告显示了新的变化，这触发了对以上模型的更新。本文将提供最新版高清大图的下载。&lt;/p>
&lt;h2 id="为何两个模型">为何两个模型？
&lt;/h2>&lt;p>为何2019年会分化出两个模型，简单的讲：穷举的范围越来越大了，生产力作为一个新的全局共享目标进入了调查问卷的范围。我们之前社区的小伙伴已经将2019年的近100道调查题问题翻译成中文了，敬请参阅参考DevOps状态调研问卷。在翻译完那些题目后，我并没有意识到今年可能会新增出这样一个全局共享目标的调研对象，真的以为：这个效能模型（组织效能和非商业效能）会一条道走到最后。&lt;/p>
&lt;h3 id="效能模型">效能模型
&lt;/h3>&lt;p>对效能模型的更新变化如下图所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567339754/2019-dora-perf.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="生产力模型">生产力模型
&lt;/h3>&lt;p>新增的生产力模型令我感到相当意外，它的结构如下所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567339754/2019-dora-prod.jpg"
loading="lazy"
>&lt;/p>
&lt;p>总之，还无法预测明年的调研范围会有怎样的更新。可以确认的是行业DevOps的能力模型是在动态变化的，想跟上世界级的水平还必须不断刷新自己的能力组合。否则你的同行的对手可能早就一骑绝尘而去了。DevOps能力发展不是一个有限游戏（例如刷黄金5级），是每年都和整个行业一起发展的无限游戏。&lt;/p>
&lt;h2 id="如何使用模型">如何使用模型？
&lt;/h2>&lt;p>2019年的报告中给出了模型的使用和阅读方法的官方解释，见2019年报告英文原版的27页。本文对其的解读如下。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567379589/11-3kgsfdgjds.png"
loading="lazy"
>&lt;/p>
&lt;h3 id="使用模型指导转型">使用模型指导转型
&lt;/h3>&lt;p>识别你将要改善的能力点。模型中的每个被箭头所指向的方块被称之为构造，构造有单级构造，也有二级构造（如精益产品开发、软件开发实践），历年来的报告中已经为你展示和所有DevOps能力点，你现在需要做的是从中选择出你需要改进的候选能力点。&lt;/p>
&lt;p>开展加速度的组织转型需要一个前提条件，一个扎实的基础作为起点。报告中并没有解释这个条件，你需要自己理解。聚焦在转型所急需的那些候选能力点上，在多个候选能力点里选择出亟需改进的”约束点“「此处参考TOC限制理论，相关书籍《目标》」。想想：那些能力的不足造成了最大的延期？「记住这里说的是最大值，这需要一个量化的跨组织的分析调研」什么最让你头痛？什么是最大的问题？经过以上的引导问题的提示，从清单中选出3~5个候选优化发展的能力项，安排出专项人力和财力资源，先重拳出击改善第一波能力点。不要担心你还有其他的很多问题；现阶段不妨聚焦在那个最大的问题上；这样你才能将瓶颈（约束点）各个击破，发掘这个其他的协同功效，避免不必要的工作。这个部分基本上是经典TOC理论的应用，关于这个理论在DevOps实施中的详细使用方法描述，请参考《DevOps实践指南》的第二章 2.5 持续识别和改善约束点。&lt;/p>
&lt;p>以上DevOps转型工作还有其他的产出。那些追求SDO组织效能的组织还会得到这些收益，降低职业透支（996icu）和部署的痛，提高安全水平。附加的好处还包括，它能提高生产力，提高了生产力就可以获得工作生活平衡且降低职业透支。&lt;/p>
&lt;h3 id="怎样阅读模型">怎样阅读模型？
&lt;/h3>&lt;p>报告使用了结构方程模型 （Structural equation modeling &lt;a class="link" href="https://en.wikipedia.org/wiki/Structural_equation_modeling%ef%bc%89" target="_blank" rel="noopener"
>https://en.wikipedia.org/wiki/Structural_equation_modeling）&lt;/a> ，来作为一种预测模型，用它测试各个构造之间的关系。模型中的每个方块就是一个调研度量的点，就是一个构造。剪头表示了构造之间的关系。一个大的包含多个构造的方框称之为二级构造。淡蓝色的构造表示一个控制变量，它用点线连接。&lt;/p>
&lt;p>在报告原文中，将第31页和57页的模型称之为全模型，见报告的27页的原文：”See pages 31 and 57 for full models.“；而在我的系列文章中，则将下图称之为全模型。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567339751/2019-dora-DevOps-all.jpg"
loading="lazy"
>&lt;/p>
&lt;p>以上阅读方法同样的适用于上图。总之请仔细理解了左下角的图例，正确的阅读和理解模型。不管你是将DevOps实践的实施视为组织转型也好，把它当做项目做也罢；当你识别你的目标的时候，都可以参考这个模型。&lt;/p>
&lt;h3 id="两个研究模型的重叠">两个研究模型的重叠
&lt;/h3>&lt;p>由于SDO效能和生产力在很多方面本来就是相关的。它们的产出都是使用各种优秀的方法创造和交付各种技术，从而为组织和个人交付价值。那些优化软件交付的支持工作也将使生产力受益，这也是理所当然的。虽然他们的某些诱因是相同的，它们看起来很相似，但是他们度量的产出确实不同的，报告团队也是组织了独立的分析调研。总之，SDO效能和生产力是两个不同的调研模型。&lt;/p>
&lt;h3 id="重叠模型的妙用">重叠模型的妙用
&lt;/h3>&lt;p>当你在应用SDO效能模型的时候，可以在消减职业透支方面做出聪明点的投资，更高的生产力也同样能降低职业透支。因此这个应该是向各种组织和技术团队大力提倡的做法，由于工作需求是持续增长的。工作是没完没了的，这个项目完了，还有下一个项目。而我们需要注意，我们也要关注生活和工作的平衡，而降低职业透支。&lt;/p>
&lt;p>心理安全性文化也能对SDO效能、组织效能和生产力作出贡献。研究结果表明了创造和发展健康的文化对组织和个人都有好处。&lt;/p>
&lt;p>投资在代码可维护性、松耦合架构和监控方面，也能同时帮助SDO效能、生产力（它们是通过消减技术债间接的影响到生产力的）。好的工具和系统也非常值得关注。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>通过本文我相信你已经可以正确的理解2019年状态报告中的模型了，模型包括SDO效能模型和生产力模型。包括我绘制的全模型。希望DORA官方能后续推出官方版模型全图。&lt;/p>
&lt;blockquote>
&lt;p>模型的意义在于：DevOps能力点是整个软件开发和交付行业都应该关注的，在投资DevOps实践的时候，需要能聚焦到组织各自不同的急需改进的能力约束点组合上。通过模型最右侧的组织级统一共享目标来度量和验证DevOps的实践是否实际有效。&lt;/p>&lt;/blockquote>
&lt;p>TOC是一个值得关注的问题解决套路，参考其它的相关文章和其它各种书籍。&lt;/p>
&lt;p>请关注DevOps教练的公众号，在后台输入2019，下载本文中各种模型的高清大图。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566516259/DevOps-Coach-qrcode_for_gh_bce38ef330e5_430.jpg"
loading="lazy"
>&lt;/p>
&lt;hr></description></item><item><title>如何做横向行业的DevOps表现基准测试？</title><link>https://martinliu.cn/blog/2019-state-devops-report-insight-1/</link><pubDate>Wed, 28 Aug 2019 07:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/2019-state-devops-report-insight-1/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/1-jafadjf.jpg" alt="Featured image of post 如何做横向行业的DevOps表现基准测试？" />&lt;p>长期关注我的blog和微信公众号（DevOps教练）的朋友可以发现，我今年从这个调查问卷开始，陆续发布了一些列文章。如果给这些文章一个文集标题的话，那么应该是：死磕2019年加速度全球DevOps状态调查报告系列。 为了帮助大家充分利用这份优秀的行业报告，我会用一些列文章，分章节的解读这份长达80多页的报告。上一篇文章如果你已经解读了该报告的核心重要发现和看点。本文要覆盖的章节是 How do we compare 这一章。&lt;/p>
&lt;p>本文的阅读建议：&lt;/p>
&lt;ul>
&lt;li>先阅读和参考前5年的DevOps状态调查报告，了解今年这份报告的历史和发展历程。以前的文章中有下载链接/二维码。&lt;/li>
&lt;li>阅读2019年的调查问卷的中文版，感谢中国DevOps社区翻译团队对英文原版问卷的翻译工作，如果你都不知道这些调查结果是通过什么问卷调查得出的，那真的是很可惜。如果你想用这套问卷工具在企业内部做调研，请使用前文中的免费调查服务申请流程。样例问卷的访问地址：&lt;a class="link" href="https://www.wjx.cn/jq/43837840.aspx" target="_blank" rel="noopener"
>https://www.wjx.cn/jq/43837840.aspx&lt;/a>&lt;/li>
&lt;li>在Google的网站上做极简版DevOps行业基础测试，它是6年行业调查结果数据库的首次对外开放。&lt;/li>
&lt;/ul>
&lt;h2 id="why-devops">WHY DEVOPS？
&lt;/h2>&lt;p>这是一个可以持续反复问自己的问题，首先让我们澄清一件事情：为什么要做DevOps？&lt;/p>
&lt;p>是否是为了提高研发效能？是否是为了提高生产力？是否是为了提高效率？这些答案可能都对，也可都不对。对于一个组织而言：如果IT对它的使命和目标至关重要的情况下，组织对IT会产生强依赖关系，DevOps才对该组织才有意义。历年来的DevOps状态调查告诉我们：DevOps对于那些以IT为命脉的组织而言直观重要，对所有从事软件交付的组织广泛有效。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/12-23ru83.png"
loading="lazy"
>&lt;/p>
&lt;p>从DevOps能力成长模型中可以看出，图中的诸多能力项都正向贡献/预测到最右侧的两个组织级别目标，他们是：组织效能和非商业效能（商业和非商业目标），它们是：&lt;/p>
&lt;ul>
&lt;li>盈利能力 （商业）&lt;/li>
&lt;li>生产力&lt;/li>
&lt;li>市场份额 （商业）&lt;/li>
&lt;li>客户数量 （商业）&lt;/li>
&lt;li>产品或服务的数量 （商业）&lt;/li>
&lt;li>运营效率&lt;/li>
&lt;li>客户满意度 （商业）&lt;/li>
&lt;li>提供的产品或服务的质量 （商业）&lt;/li>
&lt;li>实现组织或使命目标&lt;/li>
&lt;/ul>
&lt;p>如果你的某项/某几项DevOps实践能够直接贡献到以上的商业目标，或者说能持续的创造客户价值，即商业价值；那么你的DevOps就是成功的。反之，如果你仅仅期望研发效能、生产力、效率能够就等同于创造出了很多的客户价值，那是一种幻觉；这就像是：你经过了很多预赛和体能的准备，而在冠军争夺赛中，你依然名落孙山，当你的组织的绩效远远低于预期的商业目标的时候，你的各种XXX效率都是无用的。&lt;/p>
&lt;h2 id="四大黄金度量指标">四大黄金度量指标
&lt;/h2>&lt;p>6年来的DevOps状态调查报告（我只关注DORA主导和执行的这个）已经在用量化的方式，帮助我们作出了精英表现者的画像，当然还有其它的落后者。可以明确的一点是：强者从四个维度上同时都表现强劲。（去年已经打破了常见的一个误区：过度的保守主义导致在组织四个指标之中做折中选择，常见的是牺牲吞吐量指标，确保稳定性，可是后果往往是相反的。）&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/10-2373.png"
loading="lazy"
>&lt;/p>
&lt;p>先来回顾和梳理所谓的四大黄金度量指标的分类：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>吞吐量&amp;ndash;部署频率&lt;/strong>：对于您工作的主要应用程序或服务，您的组织在生产环境进行代码部署或向最终用户做发布的频率。调查这个指标的问题见2019年加速度DevOps状态调查问卷中的第二部分的第二题。&lt;/li>
&lt;li>&lt;strong>吞吐量&amp;ndash;前置时间&lt;/strong>：对于您工作的主要应用程序或服务，从代码提交到在生产中成功运行的过程需要的时间。调查这个指标的问题见2019年加速度DevOps状态调查问卷中的第二部分的第一题。&lt;/li>
&lt;li>&lt;strong>稳定性&amp;ndash;服务恢复时间&lt;/strong>：对于您工作的主要应用程序或服务，当服务中断或出现影响用户Bug时（如：计划外中断、服务受损），恢复服务通常需要的时间。调查这个指标的问题见2019年加速度DevOps状态调查问卷中的第二部分的第四题。&lt;/li>
&lt;li>&lt;strong>稳定性&amp;ndash;变更失败率&lt;/strong>：对于您所工作的主要应用程序或服务，对于生产变更，或向最终用户发版的变更，百分之多少会导致服务质量下降（如：服务受损或服务中断），并需要进行后续的修复工作（需要热补丁、回滚，前向修复，打补丁修复）。调查这个指标的问题见2019年加速度DevOps状态调查问卷中的第二部分的第五题。&lt;/li>
&lt;/ul>
&lt;p>上面的四个指标是DevOps状态调查报告使用cluster算法做受众分类的主要依据，这个类聚分析的结果就是那张四大DevOps等级的泡泡图。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567001372/11-w97459438isuuf.png"
loading="lazy"
>&lt;/p>
&lt;p>在这个泡泡图中，我们可以看到有多少比例的受访者处于精英、高效、中等和低效的阵营。复述一下今年的一个重大发现：精英表现者已经从去年的高效能表现者集团中脱颖而出，他们在指标的绝对值和总体数量上都增长迅敏，增长率高达将近3倍。&lt;em>【DevOps教练点评：回顾一下这份报告的标题中加入的加速度的关键字，一旦某个组织的实施方法得当，一个持续优化的组织的整体效能就可能做上火箭，加速度的飞离地球。而加速度不足的企业则处于持续跌回地面的窘境。】&lt;/em>&lt;/p>
&lt;p>这四大黄金度量指标的采集方法就是调查问卷中那些四个问题。对所有实践DevOps的组织而言，我们需要的是持续实施和优化追踪这些度量指标的方法和系统，确保能实时查看这四个指标的状态是最完美的。可是目前几乎还没有什么企业能够做到，手工分别统计上报，定期公布到全体IT部门也是非常可取的做法。总之，没有度量就不存在管理，就无从系统性的改进。&lt;/p>
&lt;h2 id="我在行业里的表现如何">我在行业里的表现如何？
&lt;/h2>&lt;p>这是我写作本文想要回答的核心问题。如果你能够度量自己的四个黄金指标了，也能够随时拿出一组确切的数据，我们就能做行业基准测试比较了。&lt;/p>
&lt;p>这可能是Google收编DORA团队所买到的最有价值的一部分资产，历年来的DevOps调查问卷参与者的问卷答案数据库。Google今年将这个数据库向公众开放了，网址在 &lt;a class="link" href="https://beta.devops-research.com/performance.html" target="_blank" rel="noopener"
>https://beta.devops-research.com/performance.html&lt;/a> (这个网址应该不用科学上网，会出现证书错误提示，请忽略继续访问该页面)。在你回答了下面的五个问题后，就可以获得一份自己的行业基准测试报告。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/2-faldjfald.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/3-adfjafdasldf.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/4-9578921374.png"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/5-faljdfl2e44.png"
loading="lazy"
>&lt;/p>
&lt;p>最后一个问题是，从13个行业中选择出一个最合适的所在行业。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/6-ajflasjfd22.png"
loading="lazy"
>&lt;/p>
&lt;p>下图是你在整个所有行业里的横向对比。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/7-fjlasf.png"
loading="lazy"
>&lt;/p>
&lt;p>下图是你在所在行业里的横向对比。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/8-ajflasjf2.png"
loading="lazy"
>&lt;/p>
&lt;p>下图是四个黄金指标在四个表现级别/集团上的度量；表明你每个指标处于哪个等级。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/9-asjfl23uu.png"
loading="lazy"
>&lt;/p>
&lt;p>经过以上的最简版DevOps表现状态基准测试以后，你就看到了你在所有行业中和所在行业中的横向比较。当然，我们也能预测一下自己处于那个阵营和等级。然而，这并不是你的DevOps旅程的剧终情节。&lt;/p>
&lt;p>所有DevOps的实践者一旦上路以后，都是一条不归路的感觉，我们可以定期的关注我们的基准测试结果，并观察自己在动态变化的行业基线中的位置，而更重要的是：找到每个现阶段的改进空间，并且持续突破自己DevOps的能力瓶颈和极限。持续的无限制的加速度发展所有DevOps能力点才是这个DevOps旅程的终极意义。&lt;/p>
&lt;h2 id="关于服务运维效能">关于服务运维效能
&lt;/h2>&lt;p>服务效能指标是在去年的效能报告中新引进的，而在去年和今年的调查问卷和结果报告中并没有直接的关于这项指标的采集数据和结果。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1567000726/10-2373.png"
loading="lazy"
>&lt;/p>
&lt;p>从上图中我们可以直接的理解一下，左侧的四大黄金指标都关乎于软件开发部门，而这个指标关乎于服务运维部门。去年并没有给出关于可用性指标的度量方法，今年也没有在调查问卷中做直接/显性的问题设置。只是在今年2019年的报告中做了进一步的解释，说这个可用性指标的实施方法论是SRE套路。我正在翻译SRE Workbook，这本书比起之前翻译的DevOps Handbook，更具有实操性。我们拭目以待，明年的状态调查问卷是如何对可用性设问和调查分析的。关于SRE的基础概念和实施方法，心急的朋友不妨参加中国DevOps社区今年10月在杭州举办的年度大会，我有一个关于SRE的主题分享，让我们一起讨论SRE的落地套路，让用SRE套路使我们的DevOps故事闭环。&lt;/p>
&lt;p>总之我们实践DevOps的时候要全局的关注“软件交付和运维效能”，简称SDO效能（software delivery and operational performance）；有O了才完整的闭环了。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>本文写道这里，我认为你可以无障碍的阅读2019年加速度全球DevOps状态调查报告到第25页了。我们总结一下，你应该能理解吞吐量和稳定性的四大黄金度量指标的定义；持续度量和关注这些指标的正确方法；使用Google所提供的极简版度量工具，找到自己在行业中的定位和所处的效能级别。关注SDO效能的完整性，尝试了解和实践SRE实践，让你的DevOps体验闭环和完整起来。下一期死磕2019年加速度全球DevOps状态调查报告系列将为你呈现更新版本的DevOps能力成长模型，进一步讲解如何应用今年分化出来的两个研究模型：SDO和组织效能模型与生产力模型。&lt;/p>
&lt;hr></description></item><item><title>2019年加速度DevOps状态调查报告-导读</title><link>https://martinliu.cn/blog/2019-state-devops-survey-report/</link><pubDate>Thu, 22 Aug 2019 07:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/2019-state-devops-survey-report/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/abstract-4.jpg" alt="Featured image of post 2019年加速度DevOps状态调查报告-导读" />&lt;p>凭借六年多的来自全球31,000多名专业人士的数据的研究，2019年加速发展状态报告是同类研究中规模最大、持续时间最长的研究。2019年加速度DevOps状态调查首发，首发的位置在Google Cloud网站上的Blog栏目，发布于产品新闻分类下。&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>文章使用的主标签 DevOps 、SRE。&lt;/li>
&lt;/ul>&lt;/blockquote>
&lt;ul>
&lt;li>文章地址：&lt;a class="link" href="https://cloud.google.com/blog/products/devops-sre/the-2019-accelerate-state-of-devops-elite-performance-productivity-and-scaling" target="_blank" rel="noopener"
>https://cloud.google.com/blog/products/devops-sre/the-2019-accelerate-state-of-devops-elite-performance-productivity-and-scaling&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>下文为对Google文章原文的翻译和整理。并且加入了我本人的各种判断和见解。&lt;/p>
&lt;p>关于今年的DevOps状态调查报告有什么更新和变化？报告文章中给我们了一句话的概要介绍：今年会对部署工具链、云计算、灾难恢复和工作方式等主题进行深度调查。更详细的情况，详细的参过问卷调查的您自有评判。&lt;/p>
&lt;p>‘DevOps之研究和评估’（DORA）是通过数据驱动的洞察力，帮助组织实现DevOps和高效能组织的先驱，而Google Cloud很高兴地宣布推出2019年加速DevOps报告 。（前期文章介绍过DORA加入Google Cloud的细节） 该报告提供了DevOps行业的全景视图，为各种规模和所有行业的组织提供可操作的指导，从而提高他们的软件交付效能，最终使之成为精英DevOps实践者。&lt;/p>
&lt;h2 id="2019年的新洞见">2019年的新洞见
&lt;/h2>&lt;p>我们看到：有持续的证据表明了软件的速度、稳定性和可用性有助于提高组织绩效，今年我们能够发现一些关于推动DevOps高绩效表现，以及实践和功能的新洞见。 部分如下所示：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>DevOps已经‘跨越了鸿沟’&lt;/strong>：各个行业的组织继续地提高着他们的DevOps专业知识，特别是在表现最高那部分人群中。 精英表现者的比例几乎提高了两倍，目前他们占所有组织的&lt;em>20％。 这也得到了其他行业分析师报告的证实。&lt;/em>【教练解读：精英表现者实现了从7%到20%的增长。】&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566509912/DevOps_insights.0986061310991192.max-2000x2000.png"
loading="lazy"
alt="DevOps insights"
>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>精英表现者更有可能使用云计算 ：快速自动扩缩容、成本可见性和可靠性是云计算提供的一些关键优势。更具国家标准与技术研究院（NIST）定义的云计算所具有的五项特征功能，效能最高的DevOps团队比低效能团队在这些方面执行的可能性高24倍，5大特性包括按需的自助服务、广泛的网络访问、资源池，快速弹性和可度量的服务。 &lt;em>【教练解读：你们家使用的云计算是假的。】&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>大多数云计算用户并未充分发挥其潜力 ：只有29％的使用云计算的受访者符合NIST上述的五项标准特征。 这证明了这样一个事实，即声称使用云计算的组织，未必采用了所有必要的云计算特征模式来实现精英水平的业绩，这也有可能会阻碍他们通过云计算获益。 &lt;em>【教练解读：你号称的优势正在阻碍你。】&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>首次呈现出了行业差异性 ：在今年的报告中，零售行业在速度和稳定性方面都展示出了更好的表现。然而，与前几年保持一致的是，根据持续的证据表明，DevOps更好或更差的表现，并没有其行业的差异性。这依然表明：各种类型和规模的组织，包括金融服务、政府和零售等高度监管的行业，也都是可以通过应用DevOps实践来实现高水平的绩效。【教练解读：今年零售业做的很突出，还是你们进来刷榜了？】&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DevOps走进企业 - 第1部分 ：我们首次发现，根据证据显示大型企业组织（员工人数超过5,000人）的效能低于小型企业（员工人数少少于5,000人）。重量级的流程和控制措施，以及紧耦合的体系架构是导致较低速度，以及相关不稳定性的部分原因。&lt;em>【教练解读：大型组织的坑也更大。】&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DevOps走进企业 - 第2部分 ：我们的分析显示最高能的DevOps表现者（即高级和精英表现者），专注于通过结构化的解决方案来构建DevOps社区，这些解决方案包括以下四种模式之一：社区建设者、大学、涌现和实验者（Community Builders, University, Emergent, and Experimenters）。&lt;em>【教练解读：需要给它山之石提供存在的土壤。】&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>没有“一刀切”的方法，成功有赖于一致的努力付出 ：在投资于DevOps的各项能力时，特别是在大型组织中，需要同时关注团队级别和组织级别的工作成果。在团队层面上，持续集成、自动化测试和监控等实践的一些工作投入运作良好。组织级能力包括：在多个部门和团队之间，设置系统体系结构或变更审批策略的能力。 该报告分解了这些能力并概述了应该采取的策略，因此您也可以执行相关的DevOps策略，并从中获得最大的效果。&lt;em>【教练解读：单纯的刷某个团队或者项目也是然并卵。】&lt;/em>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>表现较差的组织比高级和精英表现者使用的软件更多 ：维护和支持私有商业软件的成本可能过高，这促使高级和精英表现者使用开源解决方案。 这和以前报告中的结果一致。 事实上， 2018年的加速度 DevOps报告就表明，精英表现者大量使用开源组件、库和平台的可能性是其它组织的 1.75倍。&lt;em>【教练解读：开源软件正在吞噬着整个世界。】&lt;/em>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="你如何改进devops">你如何改进DevOps？
&lt;/h2>&lt;p>今年的报告提供了有助于推动DevOps改进性能和生产力的两种研究模型。&lt;/p>
&lt;p>&lt;strong>效能研究模型&lt;/strong> 着眼于哪些能让你提升组织绩效的结构和抓手，提供相关的云计算、持续交付、灾难恢复测试，明确变更管理和心理安全文化是如何对软件交付绩效产生积极作用的见解。 本次研究还发现重量级的变革流程是不起作用的。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566512814/performance_research_model.max-2000x2000.png"
loading="lazy"
alt="效能研究模型"
>&lt;/p>
&lt;p>图片翻译参考：&lt;/p>
&lt;ul>
&lt;li>左侧的一列，从上至下：清晰的变更流程、重量级变更流程、灾难恢复测试、代码的可维护性、松耦合的架构、监控、主干开发、自动化部署。&lt;/li>
&lt;li>中间的一列，从上至下：心理安全感文化、持续交付、云计算、持续集成、自动化测试。&lt;/li>
&lt;li>右侧的一列，从上至下：行业（控制）企业（控制）、工作恢复、透支&lt;/li>
&lt;li>图例，从上至下：结构、二级结构、团队或者组织的统一目标、控制变量、正向预测关系、双向影响、负面影响关系、粗体字-今年新的调查结果（左侧1～4，中间1）&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>生产力研究模型&lt;/strong> 表明：组织可以通过投资易于易用的工具和信息搜索引擎、心理安全文化，以及消除技术债务的方式来提高工程师的生产力。 提高生产力还有助于提高员工的工作-生活平衡，并降低职业透支（教练注释-996icu）。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566513555/productivity_research_model.max-1600x1600.png"
loading="lazy"
alt="生产力研究模型"
>&lt;/p>
&lt;p>图片翻译参考：&lt;/p>
&lt;ul>
&lt;li>左侧的一列，从上至下：实用且易用的工具、内部搜索引擎、外部搜索引擎、代码可维护性。&lt;/li>
&lt;li>中间的一列，从上至下：心理安全感文化、生产力、技术债、松耦合的架构、监控。&lt;/li>
&lt;li>右侧的一列，从上至下：多年的经验（控制）、SDO效能、软件交付效能、可用性、组织级效能、透支&lt;/li>
&lt;li>图例，从上至下：结构、正向预测关系、负面影响关系、团队或者组织的统一目标、控制变量、弱关联性、粗体字-今年新的调查结果（左侧1～4，中间1～2，右侧2）&lt;/li>
&lt;/ul>
&lt;p>今年的报告再次确认了连续第六年各种重要发现：首先，可以在不牺牲速度的情况下优化稳定性。 其次，DevOps通过影响商业和非商业目标为​​客户和最终用户提供价值。&lt;/p>
&lt;p>感谢为调查做出贡献的所有人。 我们希望此报告能够帮助各种规模，行业和地区的组织改进。 我们期待听到您对报告的想法和反馈。 您可以通过以下方式了解有关2019年加速状态报告的更多信息。&lt;/p>
&lt;h2 id="相关材料和扩展">相关材料和扩展
&lt;/h2>&lt;h3 id="报告尝鲜试读">报告尝鲜试读
&lt;/h3>&lt;h4 id="报告封面">报告封面
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518180/state-of-devops-2019.jpg"
loading="lazy"
>&lt;/p>
&lt;p>关注点：DORA + Google， 新的赞助商的支持。&lt;/p>
&lt;h4 id="报告目录">报告目录
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518068/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.51.36.png"
loading="lazy"
>&lt;/p>
&lt;p>目录结构很类似，内容大不同。&lt;/p>
&lt;h4 id="devops四大核心度量指标">DevOps四大核心度量指标
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518068/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.51.58.png"
loading="lazy"
>&lt;/p>
&lt;p>四个级别的表现者在四大度量维度上的比较，以及今年的数据更新。&lt;/p>
&lt;h4 id="精英表现者">精英表现者
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518069/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.52.10.png"
loading="lazy"
>&lt;/p>
&lt;p>他们始终遥遥领先。重点是所有的指标同时都好。&lt;/p>
&lt;h4 id="两大研究模型的分化">两大研究模型的分化
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518069/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.52.23.png"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>效能模型&lt;/li>
&lt;li>生产力模型&lt;/li>
&lt;/ul>
&lt;h4 id="灾难恢复测试">灾难恢复测试
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518069/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.52.49.png"
loading="lazy"
>&lt;/p>
&lt;p>灾难恢复测试和DevOps强相关。&lt;/p>
&lt;h4 id="心理安全性">心理安全性
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518068/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.53.04.png"
loading="lazy"
>&lt;/p>
&lt;p>文化建设的一个关键组成。&lt;/p>
&lt;h4 id="devops转型的策略一览表">DevOps转型的策略一览表
&lt;/h4>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566518068/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7_2019-08-23_%E4%B8%8A%E5%8D%887.53.41.png"
loading="lazy"
>&lt;/p>
&lt;p>你们都用了哪些推广DevOps的策略呢？抱歉并没有刷成熟度这一项。&lt;/p>
&lt;h3 id="下载报告">下载报告
&lt;/h3>&lt;p>目前Google的官网上提供了所有DORA的DevOps状态调查报告的下载包括2019年度最新的状态调查报告。为了方便国内DevOp实践者的学习，我将它下载到了百度网盘。请大家需要的按照一下方法下载阅读。&lt;/p>
&lt;p>报告下载方法：&lt;/p>
&lt;ol>
&lt;li>扫码下面的二维码，关注DevOps教练的微信公众号&lt;/li>
&lt;li>进入DevOps教练的微信公众号的文字输入状态&lt;/li>
&lt;li>输入数字 ： 2019&lt;/li>
&lt;li>识别自动回复的二维码&lt;/li>
&lt;li>下载pdf版本的2019加速度DevOps状态调查报告&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1566516259/DevOps-Coach-qrcode_for_gh_bce38ef330e5_430.jpg"
loading="lazy"
alt="DevOps教练"
>&lt;/p>
&lt;h3 id="使用2019调查问卷服务">使用2019调查问卷服务
&lt;/h3>&lt;p>前面的文章发布了2019DevOps问卷调查的中文翻译版本，&lt;a class="link" href="https://martinliu.cn/posts/2019-state-devops-survey-chinese-version/" target="_blank" rel="noopener"
>https://martinliu.cn/posts/2019-state-devops-survey-chinese-version/&lt;/a> 这是对原版英文调查问卷的翻译，由中国DevOps社区翻译组完成，现在我们已经将它通过问卷星平台转化成了可以使用的调查服务。&lt;/p>
&lt;p>如果你的企业正在实施DevOps，如果你想了解一下这种称之为DevOps的科学的调查问卷，不妨可以通过下面的流程申请使用这个问卷服务：&lt;/p>
&lt;ol>
&lt;li>发邮件到 &lt;a class="link" href="mailto:info@DevOpsChina.org" >info@DevOpsChina.org&lt;/a> ；邮件标题为 dora 2019&lt;/li>
&lt;li>邮件内容请包含：公司名称、使用范围（全公司、团队）、使用其实时间、联系人姓名、联系人手机/微信、调查问卷的套数（题套问卷对应一个网站，可下载一份数据采集结果）&lt;/li>
&lt;li>本服务为免费社区服务，在收到邮件后就会尽快为您提供所需要数量的网址，并在约定的结束时间发送调查结果到你的邮箱。&lt;/li>
&lt;/ol>
&lt;h2 id="后续">后续
&lt;/h2>&lt;p>经过了多年对这项行业顶级调查问卷和报告的追逐。今年的报告内容量大，新发现多，而且引入了新的研究模型。我会从内容和模型层面做更多的总结和研究。后续用一系列的文章进行报道。请关注“DevOps教练”微信号的更新文章和本网址的更新。&lt;/p>
&lt;hr></description></item><item><title>中文版：2019年DevOps状态调查问卷</title><link>https://martinliu.cn/blog/2019-state-devops-survey-chinese-version/</link><pubDate>Mon, 06 May 2019 12:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/2019-state-devops-survey-chinese-version/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-dora.png" alt="Featured image of post 中文版：2019年DevOps状态调查问卷" />&lt;p>本文是中文版《2019年加速度DevOps状态调查》问卷。如果你还没有填写该问卷的话，可以在线上填写英文版，点击这个链接 &lt;a class="link" href="https://bit.ly/2UzLMH2" target="_blank" rel="noopener"
>https://bit.ly/2UzLMH2&lt;/a> ，进入问卷调查网站。本文可以作为你的帮助文档。&lt;/p>
&lt;blockquote>
&lt;p>译者团队：刘征、张晔、刘頲、朱婷、王英伟、王虹、李建芳、沈越飞、井建宇、申屠欣欣&lt;/p>&lt;/blockquote>
&lt;p>本文由以上翻译团队经过两周的时间，在业余时间翻译完成，如果对本文有任何改进建议请发邮件到 martin AT DevOpsCoach.org&lt;/p>
&lt;p>发布本文的另外一个原因：作为历时6年，被称之为DevOps界之科学的调查研究，我们可以透过这套问卷，洞察如何用问卷的方式定量的度量DevOps的现状。对于已经实施了多年DevOps企业，本问卷可谓是一道营养丰富的大餐。&lt;/p>
&lt;h2 id="历年来的devops状态报告">历年来的DevOps状态报告
&lt;/h2>&lt;p>如果你需要下载学习的话，请点击下面的链接（扫码二维码），这里还有历年来英文版报告全集和部分中文版本。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1555778529/reports-download.png.png"
loading="lazy"
alt="下载"
>&lt;/p>
&lt;hr>
&lt;p>下面是2019年DevOps状态调查问卷的简体中文版译文。&lt;/p>
&lt;h2 id="第一部分">第一部分
&lt;/h2>&lt;p>欢迎参加2019年全球DevOps全球行业调查。&lt;/p>
&lt;ul>
&lt;li>我们有兴趣了解您的工作方式以及工作环境。&lt;/li>
&lt;li>答案并没有对错。&lt;/li>
&lt;li>如果您不知道答案，可以选择“我不知道或不适用”，您的作答将被忽略。&lt;/li>
&lt;/ul>
&lt;p>非常感谢您花时间帮助我们去探索那些能使技术进步的秘密！&lt;/p>
&lt;h3 id="1-您的组织主要属于哪个行业">1. 您的组织主要属于哪个行业？
&lt;/h3>&lt;ul>
&lt;li>教育&lt;/li>
&lt;li>能源&lt;/li>
&lt;li>金融服务&lt;/li>
&lt;li>政府&lt;/li>
&lt;li>医疗保健和制药&lt;/li>
&lt;li>工业与制造业&lt;/li>
&lt;li>保险&lt;/li>
&lt;li>媒体/娱乐&lt;/li>
&lt;li>非盈利&lt;/li>
&lt;li>零售/消费品/电子商务&lt;/li>
&lt;li>技术&lt;/li>
&lt;li>电信&lt;/li>
&lt;li>其他。请明确说明： [____]&lt;/li>
&lt;/ul>
&lt;h3 id="2-有多少员工在您的组织里工作">2. 有多少员工在您的组织里工作？
&lt;/h3>&lt;ul>
&lt;li>1-4&lt;/li>
&lt;li>5-9&lt;/li>
&lt;li>10-19&lt;/li>
&lt;li>20-99&lt;/li>
&lt;li>100-499&lt;/li>
&lt;li>500-1,999&lt;/li>
&lt;li>2,000-4,999&lt;/li>
&lt;li>5,000-9,999&lt;/li>
&lt;li>10,000+&lt;/li>
&lt;li>我不知道&lt;/li>
&lt;/ul>
&lt;h3 id="3-你们的服务器上都部署了哪些操作系统">3. 你们的服务器上都部署了哪些操作系统？
&lt;/h3>&lt;ul>
&lt;li>Windows 2003 / 2003R2&lt;/li>
&lt;li>Windows 2008 / 2008R2&lt;/li>
&lt;li>Windows 2012 / 2012R2&lt;/li>
&lt;li>Windows 其他&lt;/li>
&lt;li>Linux Debian / Ubuntu变种&lt;/li>
&lt;li>Linux Enterprise Linux变体（RHEL，Oracle，CentOS）&lt;/li>
&lt;li>Linux Fedora&lt;/li>
&lt;li>Linux SUSE Linux Enterprise Server&lt;/li>
&lt;li>Linux OpenSUSE&lt;/li>
&lt;li>Linux Arch&lt;/li>
&lt;li>Linux其他&lt;/li>
&lt;li>其他的UNIX&lt;/li>
&lt;li>FreeBSD / NetBSD / OpenBSD系统&lt;/li>
&lt;li>AIX&lt;/li>
&lt;li>Solaris&lt;/li>
&lt;li>其他&lt;/li>
&lt;/ul>
&lt;h3 id="4-在过去一年中关于下列绩效指标您的组织实现的程度如何">4. 在过去一年中，关于下列绩效指标，您的组织实现的程度如何？
&lt;/h3>&lt;ul>
&lt;li>您组织的整体表现&lt;/li>
&lt;li>您组织的整体盈利能力&lt;/li>
&lt;li>主要产品的相对市场份额&lt;/li>
&lt;li>客户数量增加&lt;/li>
&lt;/ul>
&lt;p>（表现远低于目标 表现低于目标 略低于目标 达到了目标 略高于目标 表现高于目标 表现远高于目标 不适用或我不知道）&lt;/p>
&lt;h3 id="5-我们也有兴趣了解其他一些目标选择指示您的组织在过去一年中如何针对以下目标执行的选项">5. 我们也有兴趣了解其他一些目标。 选择指示您的组织在过去一年中如何针对以下目标执行的选项
&lt;/h3>&lt;ul>
&lt;li>产品或服务的数量&lt;/li>
&lt;li>运营效率&lt;/li>
&lt;li>消费者满意度&lt;/li>
&lt;li>所提供的产品或服务的质量&lt;/li>
&lt;li>实现组织的/使命的目标&lt;/li>
&lt;li>通过其它的方面向外部各方证明了贵组织实现预期成果&lt;/li>
&lt;/ul>
&lt;p>（表现远低于目标 表现低于目标 略低于目标 达到了目标 略高于目标 表现高于目标 表现远高于目标 不适用或我不知道）&lt;/p>
&lt;h3 id="6-我们有兴趣了解devops或敏捷方法是怎样在您组织的各个团队中传播的">6. 我们有兴趣了解DevOps或敏捷方法是怎样在您组织的各个团队中传播的。
&lt;/h3>&lt;p>在这里，我们将描述我们看到过的那些常见的模式，并要求您从中选择出&lt;strong>哪些在自己的组织中最常见&lt;/strong>方式（请选择所有适用的选项）&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>培训中心（有时也称为&lt;strong>&lt;strong>DOJO&lt;/strong>&lt;/strong>）&lt;/strong> - 让人们暂时脱离正常的工作惯例，以便在一段时间内学习新的工具或技术、实践甚至文化，然后再回到正常的工作环境中，目标（希望？）是：他们会坚持使用新的工作方式，甚至可能推广给其他的人。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>卓越中心&lt;/strong> - 一个所有专业知识都具足，然后为内部各方提供咨询的地方。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>止步于概念证明&lt;/strong> - 进行概念证明（PoC）项目，通常执行团队可以突破组织规范（通常是官方的规则）的羁绊，从而自由的按照所认为的最好的方式构建。然而，在PoC之后，那些付出就停滞不前了。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>用概念证明当模板&lt;/strong> - 也是从小规模的概念证明（PoC）项目（如上所述）开始，然后开始使用这个最初的模式在组织中的其它团队进行复制。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>用概念证明做种子&lt;/strong> - 也是从小规模的概念证明（PoC）开始，然后将PoC知识传播给其他团队。这是通过打散PoC（可以是第一个PoC团队，或是后续/并行的PoC团队）执行团队，并将他们派发到其他团队，去分享他们所学到的知识和实践的方式来完成的。也可以称此为轮岗，那些前PoC团队成员沉浸在其他团队中，发挥着传播新的实践和文化，并兼做导师的职责。他们可能会无限期地留在这个新的群体中，或者只是用足够长的时间来确保，他带来的新的做法是可持续的。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>实践社区&lt;/strong> - 在组织内培养对工具、语言或方法有共同兴趣的团体，以便在他们的彼此之间、团队之间，以及在组织内部分享他们的知识和专业技能。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>大爆炸式&lt;/strong> - 组织进行整体一次性的DevOps方法（当然他们要选择对其下的定义）转型，通常采用自上而下的指令。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>自下而上或草根方式&lt;/strong> - 那些在一线工作的小团队将资源整合在一起，然后在整个组织中，通过非官方的形式分享所取得的成功，并进行推广，而无需任何组织官方的支持或资源。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>混搭型&lt;/strong> - 组织实施过了上述的若干种方法，通常由于无法得到成功所需的资源和重视，只能是半途而废了。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="第二部分">第二部分
&lt;/h2>&lt;p>这部分涉及您的工作及其成果，以及它对您自身的影响。&lt;/p>
&lt;h3 id="1-在你工作的过程中你的感受是怎样的">1. 在你工作的过程中，你的感受是怎样的？
&lt;/h3>&lt;p>请评价您对以下陈述的同意或不同意程度。&lt;/p>
&lt;ul>
&lt;li>我经常处于高水平的生产力&lt;/li>
&lt;li>我经常能够进入一个良好的“流程”，在那里我可以完成复杂、耗时的任务，同时最大限度地减少干扰和中断。&lt;/li>
&lt;li>我对我的工作很满意。&lt;/li>
&lt;li>我有足够的工具和资源来完成我的工作。&lt;/li>
&lt;li>我的工作很好地利用了我的技能和能力。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h3 id="2-对于您工作的主要应用程序或服务变更前置时间即从代码提交到在生产中成功运行的过程需要的时间是多长">2. 对于您工作的主要应用程序或服务，变更前置时间（即：从代码提交到在生产中成功运行的过程需要的时间）是多长？
&lt;/h3>&lt;ul>
&lt;li>超过六个月&lt;/li>
&lt;li>一个月到六个月之间&lt;/li>
&lt;li>一周到一个月之间&lt;/li>
&lt;li>一天到一周之间&lt;/li>
&lt;li>不到一天&lt;/li>
&lt;li>不到一个小时&lt;/li>
&lt;li>我不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="3-对于您工作的主要应用程序或服务您的组织在生产环境进行代码部署或向最终用户做发布的频率是什么">3. 对于您工作的主要应用程序或服务，您的组织在生产环境进行代码部署或向最终用户做发布的频率是什么？
&lt;/h3>&lt;ul>
&lt;li>每六个月少于一次&lt;/li>
&lt;li>每一到六个月一次&lt;/li>
&lt;li>每周到每月一次&lt;/li>
&lt;li>每天到每周一次&lt;/li>
&lt;li>每小时到每天一次&lt;/li>
&lt;li>按需（每天都要进行多次部署）&lt;/li>
&lt;li>我不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="4-对于您工作的主要应用程序或服务当服务中断或出现影响用户bug时如计划外中断服务受损恢复服务通常需要多长时间">4. 对于您工作的主要应用程序或服务，当服务中断或出现影响用户Bug时（如：计划外中断、服务受损），恢复服务通常需要多长时间？
&lt;/h3>&lt;ul>
&lt;li>超过六个月&lt;/li>
&lt;li>一个月到六个月之间&lt;/li>
&lt;li>一周到一个月之间&lt;/li>
&lt;li>一天到一周之间&lt;/li>
&lt;li>一天之内&lt;/li>
&lt;li>一小时之内&lt;/li>
&lt;li>我不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="5-对于您所工作的主要应用程序或服务对于生产变更或向最终用户发版的变更百分之多少会导致服务质量下降如服务受损或服务中断并需要进行后续的修复工作需要热补丁回滚前向修复打补丁修复">5. 对于您所工作的主要应用程序或服务，对于生产变更，或向最终用户发版的变更，百分之多少会导致服务质量下降（如：服务受损或服务中断），并需要进行后续的修复工作（需要热补丁、回滚，前向修复，打补丁修复）
&lt;/h3>&lt;ul>
&lt;li>0％-15％&lt;/li>
&lt;li>16％-30％&lt;/li>
&lt;li>31％-45％&lt;/li>
&lt;li>46％-60％&lt;/li>
&lt;li>61％-75％&lt;/li>
&lt;li>76％-100％&lt;/li>
&lt;li>我不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="6-接下来的问题会询问可靠性以及您和您的团队如何看待它">6. 接下来的问题会询问可靠性，以及您和您的团队如何看待它。
&lt;/h3>&lt;p>请评价您对以下陈述的同意或不同意程度。
对于您所工作的主要应用程序或服务：&lt;/p>
&lt;ul>
&lt;li>定义了明确的可用性目标（如服务级别协议/服务级别目标），这些目标在团队和客户之间达成了清晰的共识。&lt;/li>
&lt;li>我知道最近一段时间实际的可用性。&lt;/li>
&lt;li>在最近一段时间内，我的团队达到或超过了可用性目标。&lt;/li>
&lt;li>当我们未达成可用性目标时，就会进行改进工作，也或将对调整工作的优先级。&lt;/li>
&lt;li>如果使用云服务，我的团队就会借助云计算的高可用性（如：使用多个可用区）来提高可靠性。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h3 id="7-工作的可持续性很重要而职场透支是一个相关的重要度量指标您能否回答几个问题让我们知道您的工作对您有何影响">7. 工作的可持续性很重要，而职场透支是一个相关的重要度量指标。您能否回答几个问题，让我们知道您的工作对您有何影响？
&lt;/h3>&lt;p>请评价您对以下声明的同意或不同意程度：&lt;/p>
&lt;ul>
&lt;li>我感觉透支很严重。&lt;/li>
&lt;li>我感到筋疲力尽。&lt;/li>
&lt;li>我对所从事的工作无语或愤世嫉俗。&lt;/li>
&lt;li>我觉得工作效率低下。&lt;/li>
&lt;li>我觉得工作应对业余的正常生活产生负面影响。&lt;/li>
&lt;li>我能够完成工作并保持良好的整体状态。&lt;/li>
&lt;li>我能够有效应对与工作有关的压力。&lt;/li>
&lt;li>我可以在业余时间中（即，当我选择不工作时）脱离工作。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h2 id="第三部分">第三部分
&lt;/h2>&lt;p>当你回答以下问题的时候，请回想一下你在团队中的经历&lt;/p>
&lt;h3 id="1-请评价您对以下声明的同意或不同意程度">1. 请评价您对以下声明的同意或不同意程度
&lt;/h3>&lt;ul>
&lt;li>如果我对我们的团队犯了错误，也不会有不良影响。&lt;/li>
&lt;li>我们团队的成员能够发现问题和提出棘手的问题。&lt;/li>
&lt;li>我们团队的成员不会因为差异性而互相拒绝。&lt;/li>
&lt;li>对我们的团队而言冒风险是安全的。&lt;/li>
&lt;li>想让我们团队的其人提供帮助并不困难。&lt;/li>
&lt;li>我们团队中没有人会以任何形式故意破坏我的工作成果。&lt;/li>
&lt;li>团队非常重视我独特的技术和才能。&lt;/li>
&lt;li>我们的团队能够在出现冲突时解决冲突。&lt;/li>
&lt;li>我们团队内部有很高的信任度。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h3 id="2-当你回答以下问题时回想你是如何和你的团队合作的">2. 当你回答以下问题时，回想你是如何和你的团队合作的
&lt;/h3>&lt;p>请评价您对以下声明的同意或不同意程度：&lt;/p>
&lt;ul>
&lt;li>当我的团队成员之间存在相反的意见时，我们会互相尊重。&lt;/li>
&lt;li>我可以依靠我的团队来产出高质量的成果。&lt;/li>
&lt;li>我的团队提供了一个可以创新的环境。&lt;/li>
&lt;li>我的团队有明确的角色和责任。&lt;/li>
&lt;li>我的团队所承担的项目对我来说具有个人和专业意义。&lt;/li>
&lt;li>我能够获得有效完成工作所需的必要的信息（例如，战略、新产品、组织变革，我们的优先事项和价值观）。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h3 id="3-回想一下你的团队是如何工作和组织的">3. 回想一下你的团队是如何工作和组织的
&lt;/h3>&lt;p>请评价您对以下陈述的同意或不同意程度。&lt;/p>
&lt;p>对于您使用的主要应用程序或服务：&lt;/p>
&lt;ul>
&lt;li>为了完成我自己的工作，我不需要与团队外的人沟通和协调。&lt;/li>
&lt;li>在我的团队中，我们可以对系统的设计进行大规模更改，而无需为其他团队创建重要的工作。&lt;/li>
&lt;li>在我的团队中，我们可以对系统的设计进行大规模更改，而不用依赖于其他团队的大量工作。&lt;/li>
&lt;li>我的团队可以根据需要独立部署和发布我们的产品或服务，而不依赖于其依赖的其他服务。&lt;/li>
&lt;li>我们可以按需的进行大部分的测试，而无需等待一个集成测试环境。&lt;/li>
&lt;li>在我的团队中，我们在正常工作指端中执行部署，停机时间可忽略不计。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h3 id="4-最后我们想了解一下您的组织文化">4. 最后，我们想了解一下您的组织文化
&lt;/h3>&lt;p>请评价您对以下声明的同意或不同意程度：&lt;/p>
&lt;ul>
&lt;li>我的组织氛围宜人，重视各种不同的观点。&lt;/li>
&lt;li>我的组织是一个所有类型的员工（例如，所有性别，种族，文化背景）都能够完全发挥其能力的地方。&lt;/li>
&lt;li>当我在组织中发言时，我的意见很受重视。&lt;/li>
&lt;/ul>
&lt;p>（强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用）&lt;/p>
&lt;h2 id="第四部分">第四部分
&lt;/h2>&lt;p>这部分关于你所处环境中知识是如何供给和获取的。
让我们换个角度，告诉我们您的日常工作。&lt;/p>
&lt;h3 id="1-当您工作时您会在哪里寻找信息">1. 当您工作时，您会在哪里寻找信息？
&lt;/h3>&lt;ul>
&lt;li>当我需要相关知识用于解决问题时，我会频繁访问外部信息（如Stack Overflow、百度等）。&lt;/li>
&lt;li>当我遇到具有挑战性的问题，需要寻找类似问题的解决方案时，我经常访问外部信息 (如Stack Overflow、百度等)。&lt;/li>
&lt;li>当我处理困难的任务时，我经常和可能遇到类似问题的人沟通。&lt;/li>
&lt;li>当我需要工作相关主题或问题的知识时，我经常与其他人讨论。&lt;/li>
&lt;li>在处理任务时，我经常会参考内部知识库或工具来帮助找到解决方案。&lt;/li>
&lt;li>当我处理具有挑战性的问题时，我经常搜索内部工具或代码库以便找到类似问题或示例的解决方案。&lt;/li>
&lt;li>当我有疑问或寻找代码示例时，我经常搜索组织的源代码库&lt;/li>
&lt;li>当我有疑问或遇到有挑战的问题时，我会搜索内部文档&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="2-当您遇到问题时您会定期检查哪些信息来源请选择所有适用项">2. 当您遇到问题时，您会定期检查哪些信息来源？请选择所有适用项
&lt;/h3>&lt;ul>
&lt;li>内部(组织)知识库、论坛或文档&lt;/li>
&lt;li>内部(组织)代码库&lt;/li>
&lt;li>Stack Overflow 网站&lt;/li>
&lt;li>在线教程和视频&lt;/li>
&lt;li>百度、Bing或其它类似的公开搜索引擎&lt;/li>
&lt;li>外部(公共)参考文档&lt;/li>
&lt;li>当面请教同事&lt;/li>
&lt;li>通过电子邮件、文本或聊天工具请教同事&lt;/li>
&lt;li>朋友或同行(如微信、网络兴趣组、微博等)&lt;/li>
&lt;li>您自己的个人笔记&lt;/li>
&lt;li>其它。请填写&lt;/li>
&lt;li>以上都不是&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h2 id="第五部分">第五部分
&lt;/h2>&lt;p>这部分关于你的角色，以及你们团队做变更的特征和模式等。&lt;/p>
&lt;h3 id="1-现在让我们谈谈您工作时的感受">1. 现在让我们谈谈您工作时的感受
&lt;/h3>&lt;p>无论您的正式职位是什么，让我们谈谈您所做的工作。在您的日常工作中，您负责多少个不同的角色（或工作类型）？请选择所有适用项&lt;/p>
&lt;ul>
&lt;li>软件开发&lt;/li>
&lt;li>测试&lt;/li>
&lt;li>基础设施/运营&lt;/li>
&lt;li>数据库管理&lt;/li>
&lt;li>信息/应用安全&lt;/li>
&lt;li>人员管理&lt;/li>
&lt;li>项目或产品管理&lt;/li>
&lt;li>文档&lt;/li>
&lt;li>需求分析&lt;/li>
&lt;li>用户体验&lt;/li>
&lt;li>随时待命/事件响应&lt;/li>
&lt;li>其它。请列出您执行的其他角色&lt;/li>
&lt;/ul>
&lt;h3 id="2-您每天在这些角色之间切换多少次">2. 您每天在这些角色之间切换多少次？
&lt;/h3>&lt;ul>
&lt;li>不想回应&lt;/li>
&lt;li>0&lt;/li>
&lt;li>1&lt;/li>
&lt;li>2&lt;/li>
&lt;li>3&lt;/li>
&lt;li>4&lt;/li>
&lt;li>5&lt;/li>
&lt;li>6&lt;/li>
&lt;li>7&lt;/li>
&lt;li>8&lt;/li>
&lt;li>9&lt;/li>
&lt;li>10&lt;/li>
&lt;li>11&lt;/li>
&lt;li>12&lt;/li>
&lt;li>13&lt;/li>
&lt;li>14&lt;/li>
&lt;li>15&lt;/li>
&lt;li>16&lt;/li>
&lt;li>17&lt;/li>
&lt;li>18&lt;/li>
&lt;li>19&lt;/li>
&lt;li>20或以上&lt;/li>
&lt;/ul>
&lt;h3 id="3-您现在正工作在多少个项目或产品上">3. 您现在正工作在多少个项目或产品上？
&lt;/h3>&lt;ul>
&lt;li>不想回应&lt;/li>
&lt;li>0&lt;/li>
&lt;li>1&lt;/li>
&lt;li>2&lt;/li>
&lt;li>3&lt;/li>
&lt;li>4&lt;/li>
&lt;li>5&lt;/li>
&lt;li>6&lt;/li>
&lt;li>7&lt;/li>
&lt;li>8&lt;/li>
&lt;li>9&lt;/li>
&lt;li>10&lt;/li>
&lt;li>11&lt;/li>
&lt;li>12&lt;/li>
&lt;li>13&lt;/li>
&lt;li>14&lt;/li>
&lt;li>15&lt;/li>
&lt;li>16&lt;/li>
&lt;li>17&lt;/li>
&lt;li>18&lt;/li>
&lt;li>19&lt;/li>
&lt;li>20或以上&lt;/li>
&lt;/ul>
&lt;h3 id="4-您通常在一周中工作在多少个项目上">4. 您通常在一周中工作在多少个项目上？
&lt;/h3>&lt;ul>
&lt;li>不想回应&lt;/li>
&lt;li>0&lt;/li>
&lt;li>1&lt;/li>
&lt;li>2&lt;/li>
&lt;li>3&lt;/li>
&lt;li>4&lt;/li>
&lt;li>5&lt;/li>
&lt;li>6&lt;/li>
&lt;li>7&lt;/li>
&lt;li>8&lt;/li>
&lt;li>9&lt;/li>
&lt;li>10&lt;/li>
&lt;li>11&lt;/li>
&lt;li>12&lt;/li>
&lt;li>13&lt;/li>
&lt;li>14&lt;/li>
&lt;li>15&lt;/li>
&lt;li>16&lt;/li>
&lt;li>17&lt;/li>
&lt;li>18&lt;/li>
&lt;li>19&lt;/li>
&lt;li>20或以上&lt;/li>
&lt;/ul>
&lt;h3 id="5-思考下你过去3个月的工作-请以这些记忆里的工作对以下陈述进行回应">5. 思考下你过去3个月的工作。 请以这些记忆里的工作对以下陈述进行回应
&lt;/h3>&lt;p>我遇到过的代码，脚本，配置或系统&amp;hellip;&amp;hellip;&lt;/p>
&lt;ul>
&lt;li>包含已知的错误，这些错误不支持新功能开发&lt;/li>
&lt;li>没有足够的测试或测试覆盖率&lt;/li>
&lt;li>与低下的代码质量或设计有关&lt;/li>
&lt;li>取消或放弃项目后尚未进行清理&lt;/li>
&lt;li>在我所在的团队中没有人有专业知识能够理解&lt;/li>
&lt;li>有不完全或不正确的迁移&lt;/li>
&lt;li>使用了过时的技术&lt;/li>
&lt;li>文档和/或注释存在缺失、不完整或过时的情况&lt;/li>
&lt;/ul>
&lt;h3 id="6-现在思考在你的组织中的进行变更及相应流程是什么样的">6. 现在思考在你的组织中的进行变更及相应流程是什么样的
&lt;/h3>&lt;p>在我的组织中&amp;hellip;&amp;hellip;&lt;/p>
&lt;ul>
&lt;li>在实施或部署之前，必须由外部机构（例如，变更审批委员会，经理等）批准生产变更&lt;/li>
&lt;li>我的组织有一个正式的流程来批准在实施或发布之前对应用程序或生产系统进行变更。&lt;/li>
&lt;li>我清楚地了解批准实施​​变更的流程&lt;/li>
&lt;li>我相信我能够及时通过审批流程来实施变更&lt;/li>
&lt;li>对于我通常所做的各类变更，我知道每次从“提交”到“已接受”所需的步骤。&lt;/li>
&lt;li>我们依靠同事的同行评审（例如代码审查或结对编程）来管理或批准变更。&lt;/li>
&lt;li>我的团队遵循基于风险的政策来批准变更，通过自动化方法推进低风险变更，只有高风险变更才需要人工批准。&lt;/li>
&lt;li>所有重大变更必须在实施前由高级经理批准&lt;/li>
&lt;/ul>
&lt;h2 id="第6部分">第6部分
&lt;/h2>&lt;p>对于此页面上的问题，请思考你为测试生产系统的弹性所做的工作。&lt;/p>
&lt;h3 id="1以下哪些活动用于测试我们的it系统服务的弹性">1.以下哪些活动用于测试我们的IT系统/服务的弹性？
&lt;/h3>&lt;ul>
&lt;li>未在真实系统上进行沙盘推演&lt;/li>
&lt;li>基础设施（包括数据中心）故障转移&lt;/li>
&lt;li>应用程序故障转移&lt;/li>
&lt;li>模拟破坏类生产的测试系统（包括故障注入、如降级网络链路、关闭路由器等）&lt;/li>
&lt;li>模拟破坏生产系统（包括故障注入，如降级网络链路，关闭路由器等）&lt;/li>
&lt;li>创建自动化和系统，定期，持续地破坏生产系统&lt;/li>
&lt;li>其他。 请明确说明：&lt;/li>
&lt;li>以上都不是&lt;/li>
&lt;/ul>
&lt;h3 id="2-你所在的组织多久执行一次中断生产系统的模拟包括故障注入例如降级网络链路关闭路由器等">2. 你所在的组织多久执行一次中断生产系统的模拟（包括故障注入，例如降级网络链路、关闭路由器等）
&lt;/h3>&lt;ul>
&lt;li>从不&lt;/li>
&lt;li>仅在初次部署&lt;/li>
&lt;li>按周&lt;/li>
&lt;li>按月&lt;/li>
&lt;li>按年&lt;/li>
&lt;li>少于一年一次&lt;/li>
&lt;li>不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="3-你所在的组织多久执行一次基础设施包括数据中心故障转移以测试弹性">3. 你所在的组织多久执行一次基础设施（包括数据中心）故障转移以测试弹性？
&lt;/h3>&lt;ul>
&lt;li>从不&lt;/li>
&lt;li>仅在初次部署&lt;/li>
&lt;li>按周&lt;/li>
&lt;li>按月&lt;/li>
&lt;li>按年&lt;/li>
&lt;li>少于一年一次&lt;/li>
&lt;li>不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="4-你所在的组织多久执行一次应用程序故障转移以测试弹性">4. 你所在的组织多久执行一次应用程序故障转移以测试弹性？
&lt;/h3>&lt;ul>
&lt;li>从不&lt;/li>
&lt;li>仅在初次部署&lt;/li>
&lt;li>按周&lt;/li>
&lt;li>按月&lt;/li>
&lt;li>按年&lt;/li>
&lt;li>少于一年一次&lt;/li>
&lt;li>不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="5-如果我的组织在灾备演习时发现了任何改进的机会我们会创建行动任务并在下一次演习前修复这些改进项">5. 如果我的组织在灾备演习时发现了任何改进的机会，我们会创建行动任务并在下一次演习前修复这些改进项
&lt;/h3>&lt;ul>
&lt;li>非常同意&lt;/li>
&lt;li>同意&lt;/li>
&lt;li>有点同意&lt;/li>
&lt;li>既不赞成也不反对&lt;/li>
&lt;li>不太同意&lt;/li>
&lt;li>不同意&lt;/li>
&lt;li>强烈反对&lt;/li>
&lt;li>不适用或我不知道&lt;/li>
&lt;/ul>
&lt;h2 id="第七部分">第七部分
&lt;/h2>&lt;p>此页将会询问您或您的组织关于云应用的一些问题&lt;/p>
&lt;h3 id="1-我主要负责的产品或服务在哪运行请选择所有适用的选项">1. 我主要负责的产品或服务在哪运行？（请选择所有适用的选项）
&lt;/h3>&lt;ul>
&lt;li>公有云（包含多个公有云）&lt;/li>
&lt;li>私有云&lt;/li>
&lt;li>混合云（将公有云和私有云/数据中心/本地设施结合在一起）&lt;/li>
&lt;li>在数据中心或本地（不是云）&lt;/li>
&lt;li>我桌面下的一个小服务器&lt;/li>
&lt;li>其他&lt;/li>
&lt;/ul>
&lt;h3 id="2采用多个云提供商的驱动因素是什么请最多选择3个">2.采用多个云提供商的驱动因素是什么？（请最多选择3个）
&lt;/h3>&lt;ul>
&lt;li>我们只有一个云提供商, 或者我们没有使用公有云&lt;/li>
&lt;li>法律合规性&lt;/li>
&lt;li>灾备可用性&lt;/li>
&lt;li>对一个供应商缺乏信任&lt;/li>
&lt;li>利用每个提供商的独特优势&lt;/li>
&lt;li>谈判策略或采购要求&lt;/li>
&lt;li>其他&lt;/li>
&lt;/ul>
&lt;h3 id="3请评价您对以下陈述同意或不同意的程度">3.请评价您对以下陈述同意或不同意的程度
&lt;/h3>&lt;ul>
&lt;li>我主要负责的产品或服务最初是设计在云中运行或基于云设计架构的。&lt;/li>
&lt;li>对于我主要负责的产品或服务, 环境配置和部署仅使用存储在版本控制库中的脚本和信息, 无需手动步骤 (审批除外)。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="4请评价您使用云服务时对以下陈述的同意或不同意程度">4.请评价您使用云服务时对以下陈述的同意或不同意程度
&lt;/h3>&lt;ul>
&lt;li>一旦我有了访问权限, 我就可以根据需要独立地配置和配置产品或服务所需的云资源和功能, 而无需提高票证或需要人工交互。&lt;/li>
&lt;li>我主要负责的服务或产品设计为通过网络从各种设备 (如智能手机、平板电脑、笔记本电脑) 访问, 而不需要专有插件或协议。&lt;/li>
&lt;li>我的产品或服务所运行的云，服务于多个团队和应用程序, 并根据需要动态分配和重新分配计算和基础架构资源。&lt;/li>
&lt;li>我可以根据需求动态地增加或减少可用于主要支持的服务或产品的云资源。&lt;/li>
&lt;li>我可以监视或控制我主要支持的服务或产品所使用的云资源的数量和成本。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="5换个主题在您工作的时候您是怎样看待成本的">5.换个主题，在您工作的时候，您是怎样看待成本的？
&lt;/h3>&lt;ul>
&lt;li>我的团队可以准确地估计操作我们软件的成本。&lt;/li>
&lt;li>我的团队可以轻松识别我们运营成本最高的应用程序。&lt;/li>
&lt;li>我的团队很少超出我们的成本费用或支出预算。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h2 id="第八部分">第八部分
&lt;/h2>&lt;p>关于版本控制系统、分支模型、自动化测试、持续集成、持续交付等一直到生产环境的反馈等等实践。
现在让我们谈谈您和您的团队所做的技术工作。&lt;/p>
&lt;h3 id="1请介绍一下您和您的团队如何开发软件我的团队">1.请介绍一下您和您的团队如何开发软件。我的团队
&lt;/h3>&lt;ul>
&lt;li>我们的组织将所有代码存储在一个单一庞大的版本控制存储库中&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>组织中所有工程师都可以查看和搜索组织中所有代码&lt;/li>
&lt;li>我可以在自己之外的项目中编辑代码，并适时提交&lt;/li>
&lt;li>我们将应用程序的所有依赖项源代码（例如软件库）都存储到版本控制存储库中&lt;/li>
&lt;li>我们为发行版本创建的所有包，包括依赖项，都是在单个版本控制中创建的，而不是从多个版本或分支中创建的&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="2我们关注您工作中使用什么代码请评价您对以下陈述同意或不同意程度">2.我们关注您工作中使用什么代码，请评价您对以下陈述同意或不同意程度
&lt;/h3>&lt;ul>
&lt;li>如果需要，我们很容易更改其他团队维护的代码&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>我很容易在代码库中找到示例&lt;/li>
&lt;li>我经常从团队之外的工程师那里收到项目的更新。&lt;/li>
&lt;li>我很容易重新使用别人的代码&lt;/li>
&lt;li>我很容易对我的项目增加新的依赖项&lt;/li>
&lt;li>我很容易移动新的依赖项版本&lt;/li>
&lt;li>我的依赖项是稳定的很少破坏我的代码&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="3我们关注您在工作中遵循的开发实践和模式">3.我们关注您在工作中遵循的开发实践和模式
&lt;/h3>&lt;ul>
&lt;li>我团队中的所有开发人员至少每天都会将代码推送到trunk / master&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>应用程序的代码库中不到三个活动分支&lt;/li>
&lt;li>我们的应用程序团队从来没有代码锁定期，任何时候没有人可以签入代码或由于合并配置而执行请求。&lt;/li>
&lt;li>在合并到master之前，分支和分叉的生命周期非常短（不到一天）。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="4下一组问题是关于在工作中提交代码搭建和部署软件">4.下一组问题是关于在工作中提交代码、搭建和部署软件
&lt;/h3>&lt;p>对于您使用的主要应用程序或服务：&lt;/p>
&lt;ul>
&lt;li>代码提交会自动生成软件&lt;/li>
&lt;li>代码提交会运行一系列自动化测试&lt;/li>
&lt;li>每天成功地执行自动化的构建和测试&lt;/li>
&lt;li>当构建中断时，它通常在十分钟内修复&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="5许多团队使用自动化测试来优化他们的软件">5.许多团队使用自动化测试来优化他们的软件
&lt;/h3>&lt;p>请评价您对以下陈述的同意或不同意程度
回答这些问题时，请考虑您自己的测试过程：&lt;/p>
&lt;ul>
&lt;li>当自动化测试通过时，我确信软件是可发布的&lt;/li>
&lt;li>自动测试失败可能表明存在真正的缺陷&lt;/li>
&lt;li>开发人员很容易重现和修复验收失败的测试&lt;/li>
&lt;li>我们测试必要的数据，以便每一步都能轻松运行自动化测试&lt;/li>
&lt;li>我可以在十分钟内从自动测试中得到反馈&lt;/li>
&lt;li>我们经常使用之前的测试运行数据来提高自动化测试套件的质量&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="6请评价您对以下陈述的同意或不同意程度">6.请评价您对以下陈述的同意或不同意程度
&lt;/h3>&lt;p>对于您使用的主要应用程序或服务：&lt;/p>
&lt;ul>
&lt;li>我们的软件在整个生命周期中都处于可部署状态&lt;/li>
&lt;li>我的团队优先考虑保持软件可部署而不是处理新功能&lt;/li>
&lt;li>团队中的任何人都可以获得系统在质量和可部署性方面的快速反馈&lt;/li>
&lt;li>当人们得到系统不可部署的反馈时（例如构建或测试失败），他们将优先解决这些问题&lt;/li>
&lt;li>我们可以根据需要随时将我们的系统部署到生产或最终用户&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="7-请结合自己的测试过程回答以下问题">7. 请结合自己的测试过程回答以下问题
&lt;/h3>&lt;ul>
&lt;li>当通过自动化测试后，我相信软件是可发布的。&lt;/li>
&lt;li>自动化测试失败表明存在真正的缺陷。&lt;/li>
&lt;li>开发人员很容易重现并修复验收测试发现的缺陷。&lt;/li>
&lt;li>我们有必要的测试数据，用于每个步骤中轻松地运行自动化测试。&lt;/li>
&lt;li>我可以在10分钟内收到自动化测试反馈。&lt;/li>
&lt;li>我们经常使用以前测试运行的数据来提高自动化测试套件的质量。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="8-对于您工作的主要应用或服务">8. 对于您工作的主要应用或服务
&lt;/h3>&lt;ul>
&lt;li>我们的软件始终处于可部署的状态。&lt;/li>
&lt;li>在我的团队中，保持软件处于可部署状态的优先级高于实现新需求。&lt;/li>
&lt;li>任何团队成员都可以快速反馈系统的质量和可部署性。&lt;/li>
&lt;li>团队成员将修复导致系统无法部署的问题（如编译失败、测试失败等）置于最高优先级。&lt;/li>
&lt;li>我们可以随时根据需要将系统部署到生产环境或最终用户。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="9-对于您工作的主要应用或服务实现完全自动化部署到生产环境或最终用户的比例是">9. 对于您工作的主要应用或服务，实现完全自动化部署到生产环境或最终用户的比例是
&lt;/h3>&lt;ul>
&lt;li>0%-15%&lt;/li>
&lt;li>16%-30%&lt;/li>
&lt;li>31%-45%&lt;/li>
&lt;li>46%-60%&lt;/li>
&lt;li>61%-75%&lt;/li>
&lt;li>76%-100%&lt;/li>
&lt;li>我不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="10-对于您工作的主要应用或服务部署过程需要多长时间才能使软件新版本可供用户使用">10. 对于您工作的主要应用或服务，部署过程需要多长时间才能使软件新版本可供用户使用
&lt;/h3>&lt;ul>
&lt;li>小于1小时&lt;/li>
&lt;li>在1小时和1天之间&lt;/li>
&lt;li>在1天和3天之间&lt;/li>
&lt;li>在3天和1周之间&lt;/li>
&lt;li>在1周和1个月之间&lt;/li>
&lt;li>大于1个月&lt;/li>
&lt;li>我不知道或不适用&lt;/li>
&lt;/ul>
&lt;h3 id="11-您如何监控和了解正在运行的系统">11. 您如何监控和了解正在运行的系统
&lt;/h3>&lt;ul>
&lt;li>我的团队有一套技术解决方案用以报告系统的整体健康状况（如系统功能是否正常？系统是否有充足的可用资源等？）。&lt;/li>
&lt;li>我的团队有一套技术解决方案用以报告基于用户使用情况的系统状态（如用户是否知道系统已关闭，是否有不良的体验等？）。&lt;/li>
&lt;li>我的团队有一套技术解决方案用以监控主要业务和系统参数。&lt;/li>
&lt;li>我的团队有工具用于协助我们了解和调试生产环境上的系统。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h2 id="第九部分">第九部分
&lt;/h2>&lt;p>这页面询问了一些细节关于您的技术环境和工作&lt;/p>
&lt;p>请选择以下之一&lt;/p>
&lt;h3 id="1--为了部署我们的软件解决方案我的团队使用以下ci--cd-测试自动化工具链">1. 为了部署我们的软件解决方案，我的团队使用以下CI / CD /测试自动化工具链
&lt;/h3>&lt;ul>
&lt;li>主要是内部开发（自研）的，且所有权属于我的组织&lt;/li>
&lt;li>混合使用专有工具，开源和商业现成软件&lt;/li>
&lt;li>主要是开源和商用现货，高度定制&lt;/li>
&lt;li>主要是开源和商用现货，很少定制&lt;/li>
&lt;li>主要是商业现成的套装软件&lt;/li>
&lt;li>主要是开源的，高度定制&lt;/li>
&lt;li>主要是开源的，很少定制&lt;/li>
&lt;li>其他&lt;/li>
&lt;li>不适用或我不知道&lt;/li>
&lt;/ul>
&lt;h2 id="2-请评价您对以下说法的同意或不同意程度">2. 请评价您对以下说法的同意或不同意程度
&lt;/h2>&lt;ul>
&lt;li>在我的团队中，与组织中的其他团队相比，我们的CI/CD/自动化测试过程和工具是为我们的需求而定制的&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="3-请评价您对以下说法的同意或不同意程度-通过ci--cd工具链部署软件时">3. 请评价您对以下说法的同意或不同意程度。 通过CI / CD工具链部署软件时
&lt;/h3>&lt;ul>
&lt;li>使用CI / CD工具链可以提高我的效率在我的工作中&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>使用CI / CD工具链在我的工作中提高我的生产力&lt;/li>
&lt;li>使用Ci/CD工具链提高了我的工作效率&lt;/li>
&lt;li>我发现CI / CD工具链在我的工作中很有用。&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="4-请评价您对以下说法的同意或不同意程度-通过ci--cd-测试自动化工具链部署软件时">4. 请评价您对以下说法的同意或不同意程度。 通过CI / CD /测试自动化工具链部署软件时
&lt;/h3>&lt;ul>
&lt;li>我的交互在工具链是清晰易懂的&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>与工具链交互并不需要我的大量精力&lt;/li>
&lt;li>我发现工具链容易使用&lt;/li>
&lt;li>我发现容易让工具链做我想要做的事&lt;/li>
&lt;/ul>
&lt;p>(强烈反对 不同意 不太同意 既不赞成也不反对 有点同意 同意 非常同意 我不知道/不适用)&lt;/p>
&lt;h3 id="5-选择最能代表谁负责创建和维护ci--cd-测试自动化工具链及其配置的选项">5. 选择最能代表谁负责创建和维护CI / CD /测试自动化工具链及其配置的选项
&lt;/h3>&lt;ul>
&lt;li>我们的团队有完全自治选择和配置自己的CI / CD /自动化测试的工具链。&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>我们需要使用一个统一工具链，但是我们为构建/测试/部署过程维护自己的脚本，并且在配置方式上有很多自主权。&lt;/li>
&lt;li>我们需要使用一个统一工具链具有预配置脚本和构建步骤，测试和部署过程的步骤，我们可以根据需要重构或自定义。&lt;/li>
&lt;li>我们需要使用带有预配置脚本和步骤的统一工具链，而我们几乎没有能力重构它&lt;/li>
&lt;li>所有构建，测试和部署软件，都由我们建立的统一团队处理&lt;/li>
&lt;li>不适用或我不知道&lt;/li>
&lt;/ul>
&lt;h3 id="6-我的工具链包括以下内容请选择所有适用的选项">6. 我的工具链包括以下内容（请选择所有适用的选项）
&lt;/h3>&lt;ul>
&lt;li>自动化构建&lt;/li>
&lt;/ul>
&lt;ul>
&lt;li>自动化单元测试&lt;/li>
&lt;li>自动化验收测试&lt;/li>
&lt;li>自动化性能测试&lt;/li>
&lt;li>自动安全测试&lt;/li>
&lt;li>自动化配置和部署到测试环境&lt;/li>
&lt;li>自动化部署到生产&lt;/li>
&lt;li>与chatbots / Slack集成&lt;/li>
&lt;li>与生产监控和可视化工具集成&lt;/li>
&lt;li>以上都不是&lt;/li>
&lt;/ul>
&lt;h2 id="第十部分">第十部分
&lt;/h2>&lt;p>最后一页！请花几分钟时间告诉我们你自己。
请注意，此数据仅用于研究目的，此调查是匿名的，仅以匿名方式汇总报告。&lt;/p>
&lt;h3 id="1-你的性别">1. 你的性别？
&lt;/h3>&lt;ul>
&lt;li>男&lt;/li>
&lt;li>女&lt;/li>
&lt;li>非二元&lt;/li>
&lt;li>不想回应&lt;/li>
&lt;/ul>
&lt;h3 id="2-在您的团队中工作的女性比例是多少">2. 在您的团队中工作的女性比例是多少？
&lt;/h3>&lt;p>请输入0到100之间的数字。&lt;/p>
&lt;ul>
&lt;li>女性团队的百分比： [___]&lt;/li>
&lt;li>不想回应&lt;/li>
&lt;/ul>
&lt;h3 id="3-您是否认定为少数派群体的成员">3. 您是否认定为少数派群体的成员？
&lt;/h3>&lt;ul>
&lt;li>是&lt;/li>
&lt;li>没有&lt;/li>
&lt;li>不想回应&lt;/li>
&lt;/ul>
&lt;h3 id="4-你认定是残疾人吗">4. 你认定是残疾人吗？
&lt;/h3>&lt;p>包括与视觉，听觉，步行，记忆/集中，自我保健或沟通相关的残疾&lt;/p>
&lt;ul>
&lt;li>是&lt;/li>
&lt;li>没有&lt;/li>
&lt;li>不想回应&lt;/li>
&lt;/ul>
&lt;h3 id="5-哪个最贴切地描述了你的工作角色">5. 哪个最贴切地描述了你的工作角色？
&lt;/h3>&lt;ul>
&lt;li>开发或工程师&lt;/li>
&lt;li>DevOps或SRE&lt;/li>
&lt;li>信息安全&lt;/li>
&lt;li>IT运营或基础设施&lt;/li>
&lt;li>网络运营&lt;/li>
&lt;li>产品管理&lt;/li>
&lt;li>用户体验或软件分析&lt;/li>
&lt;li>经理&lt;/li>
&lt;li>专业服务&lt;/li>
&lt;li>质量工程师或QA&lt;/li>
&lt;li>发布工程师&lt;/li>
&lt;li>销售工程师&lt;/li>
&lt;li>销售或营销&lt;/li>
&lt;li>我是顾问、教练或培训师&lt;/li>
&lt;li>我是C级高管&lt;/li>
&lt;li>我是学生&lt;/li>
&lt;li>我不属于任何部门&lt;/li>
&lt;li>其他&lt;/li>
&lt;li>不想回答&lt;/li>
&lt;/ul>
&lt;h3 id="6-你有多少年的经验">6. 你有多少年的经验？
&lt;/h3>&lt;ul>
&lt;li>0-2&lt;/li>
&lt;li>3-5&lt;/li>
&lt;li>6-10&lt;/li>
&lt;li>11-15&lt;/li>
&lt;li>超过16&lt;/li>
&lt;li>不想回应&lt;/li>
&lt;/ul>
&lt;h3 id="7-请选择您所在的地理区域">7. ­­­­­请选择您所在的地理区域
&lt;/h3>&lt;ul>
&lt;li>非洲&lt;/li>
&lt;li>亚洲&lt;/li>
&lt;li>中美洲&lt;/li>
&lt;li>东欧洲&lt;/li>
&lt;li>欧洲联盟&lt;/li>
&lt;li>中东&lt;/li>
&lt;li>北美&lt;/li>
&lt;li>大洋洲&lt;/li>
&lt;li>南美洲&lt;/li>
&lt;li>加勒比&lt;/li>
&lt;/ul>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>本文是否帮你解答了这样一个疑问：每年的DevOps状态报告中的参考数据是从哪里来的？是通过什么方式采集的？到目前为止，我们还不清楚这些数据是通过什么打分规则和算法处理的。如果你是这方面的专家，请和我们分享以下你的观点。&lt;/p></description></item><item><title>2019年DevOps状态调查问卷开放中</title><link>https://martinliu.cn/blog/2019-state-devops-survey-open/</link><pubDate>Sat, 20 Apr 2019 22:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/2019-state-devops-survey-open/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/abstract-4.jpg" alt="Featured image of post 2019年DevOps状态调查问卷开放中" />&lt;p>2019年加速度DevOps状态调查首发，首发的位置在Google Cloud网站上的Blog栏目，发布于产品新闻分类下。&lt;/p>
&lt;ul>
&lt;li>文章使用的主标签 DevOps 、SRE。&lt;/li>
&lt;li>文章地址：https://cloud.google.com/blog/products/devops-sre/make-your-voice-heard-take-the-2019-accelerate-state-of-devops-survey&lt;/li>
&lt;/ul>
&lt;p>关于今年的状态调查有什么更新和变化，文章中只给出了一句话的概况：今年会对部署工具链、云计算、灾难恢复和工作方式等主题进行深度调查。更详细的情况，详细你参与完问卷调查只有自由评判。&lt;/p>
&lt;h2 id="如何参与2019年devops状态调查">如何参与2019年DevOps状态调查
&lt;/h2>&lt;p>点击这个链接 &lt;a class="link" href="https://bit.ly/2UzLMH2" target="_blank" rel="noopener"
>https://bit.ly/2UzLMH2&lt;/a> ，进入问卷调查网站。&lt;/p>
&lt;p>从围观到参与是一种积极的态度。与其观望这份行业报告的产生过程，倒不如参与其中。由于今年这个问卷调查是Google发起的，可能会有更多的人会参与。&lt;/p>
&lt;p>精通英文的人应该能在半个小时内完成这个调查。如果英文不好的话，最多也用不了2个小时，以上推测，基于我去年的填写经历。&lt;/p>
&lt;p>我还想发起一个基于这个调查的兴趣小组，请符合以下条件之一的人进微信群交流：&lt;/p>
&lt;ol>
&lt;li>正在认证填写这份问卷，想从群里获得必要的帮助，从而可以能正确的作答。&lt;/li>
&lt;li>想研究这份文件的题库，大家共同分析DORA设问的目标和结构。&lt;/li>
&lt;li>跟进一步的，交流关于DevOps度量方面的话题&lt;/li>
&lt;/ol>
&lt;h2 id="关于2018年的devops状态报告">关于2018年的DevOps状态报告
&lt;/h2>&lt;p>有幸去年策划和参与了这份报告的翻译工作。也算是相对其他人更深入的学习和研究了去年的结果。并对它的总结和推论都有非常深刻的印象，也受益匪浅。&lt;/p>
&lt;p>2018年DevOps状态调查报告的中文版本，在2018年DevOpsDays 深圳大会上做了发布，我也在台上和张乐一起向与会者做了简短的分享。如果你需要下载学习的话，请点击下面的链接（扫码二维码），这里还有历年来英文版报告全集和部分中文版本。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1555778529/reports-download.png.png"
loading="lazy"
alt="下载"
>&lt;/p>
&lt;p>在2018年里Nicole Forsgren博士发布了《Accelerate》这本书，书里算是对这场从2014年开始的，持续对年的行业专项调查研究的一个总结。书中对度量DevOps这个主题做了详解科学的解读，它是那些需要度量DevOps成果的组织的一本很好的参考书。中文版本据说在翻译的过程中，期待它的出版。等不及的话可以去国外买英文电子版，这本书我是读了不下三遍，也做了相关的分享演讲，确实有很多收获。&lt;/p>
&lt;p>分享几个我观察到的小细节：&lt;/p>
&lt;ul>
&lt;li>DORA在2018年结束了与Puppet公司的合作调查，因此2018年的报告标题中增加了一个单词“加速度”，即：2018 Acclerate State of DevOps Report； 以前的都叫做 xxxx年 State of DevOps Report。&lt;/li>
&lt;li>Puppet公司也没有闲着，Puppet和Splunk公司携手也进行了状态调查和分析，也发布了名为《2018 State of DevOps Report》，问卷的问题肯定和以前无法延续和持续的，但是报告的命名保持下来了。我猜这也是为何DORA的报告需要加一个词的原因，&lt;/li>
&lt;/ul>
&lt;p>总结一下，由Nicole Forsgren博士主持进行的DevOps状态调查报告的下载站点都在 &lt;a class="link" href="https://puppet.com/resources/whitepaper" target="_blank" rel="noopener"
>https://puppet.com/resources/whitepaper&lt;/a> ， 在这里依然可以下载到名为 2018 State of DevOps Report 的报告，但是这一个和Nicole博士无关；所有她主持的报告下载地址在她的DORA网站上 &lt;a class="link" href="https://devops-research.com/research.html" target="_blank" rel="noopener"
>https://devops-research.com/research.html&lt;/a> 。 在DORA加入了Google Cloud以后，Nicole博士主持的调查问卷名为“ Accelerate State of DevOps Report” ； 相信我们所期待的最终的分析结果的标题应该是“ 2019 Accelerate State of DevOps Report” ； 而Puppet公司应该还是会持续发布名为“2019 State of DevOps Report”的报告。我相信肯定会有很多人在2018年去年就有点晕了，怎么出来两个名字相似，可是内容大相径庭的DevOps状态报告。&lt;/p>
&lt;h2 id="devops背后的科学访谈nicole-forsgren">DevOps背后的科学：访谈Nicole Forsgren
&lt;/h2>&lt;p>最近在Nicole Forsgren正式发布了2019年的DevOps状态调查报告之后，她接受了RealWorldDevOps电台的访问。Nicole Forsgren保持这一贯的爽朗、认真和理性的特点，与电台主播迈克进行了42分钟的畅谈。&lt;/p>
&lt;ul>
&lt;li>访谈英文原文：https://www.realworlddevops.com/episodes/the-science-behind-devops-with-dr-nicole-forsgren 在这个页面上还可以收听或者下载这期访谈节目。&lt;/li>
&lt;li>英文原文的翻译版本（Google机器翻译，为修订）见下文。&lt;/li>
&lt;li>访谈中的几个关键内容（并不是所有观点）：
&lt;ul>
&lt;li>2014年开始DevOps状态调查分析和报告工作&lt;/li>
&lt;li>这项工作前期与Puppet公司合作进行&lt;/li>
&lt;li>Nicole和Jez Humble建立了独立的DORA，即DevOps Research &amp;amp; Assessment公司 &lt;a class="link" href="https://devops-research.com/" target="_blank" rel="noopener"
>https://devops-research.com/&lt;/a>&lt;/li>
&lt;li>2018年12月DORA被Google收购，Nicole加入Google后，Google将作为DORA的特别调查样本和支持公司，保持DORA持续进行。&lt;/li>
&lt;li>Nicole叙述了最有意义的三件事：架构高于技术，云计算很重要，外包是不起作用的。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>在这次访谈中，我们也可以听出一点关于这个行业调查的宗旨和调性。紧跟时代发展步伐，每年做一定的突破和更新，保持厂商/工具无关性等等。具体内容详见下面的机器翻译文字。&lt;/p>
&lt;h3 id="访谈笔录">访谈笔录
&lt;/h3>&lt;p>以下为电台网站英文版本的直接机器翻译，未做修订，不保证能够被人正确理解；有疑问的地方请参考英文原文和访谈音频。&lt;/p>
&lt;hr>
&lt;p>迈克朱利安：这是真实的世界DevOps播客，我是你的主持人迈克朱利安。我正准备在DevOps世界中遇到最有趣的人。从您喜爱的工具的创作者到精彩会议的组织者，以及出色的公共演讲者的伟大着作的作者，我想向您介绍我能找到的最有趣的人。&lt;/p>
&lt;p>迈克朱利安：啊，崩溃报道。经常被遗忘的一块坚实的监控策略。您是否很难复制您从用户那里听到的错误或难以捉摸的性能问题？你应该看看Raygun。无论你是负责网络应用程序还是移动应用程序，Raygun都可以在几分钟内轻松找到并诊断出问题，而不是你通常做的事情，如果你像我一样，请问最近的人，“嘿，是app适合你？“得到一个空白的凝视，因为嘿，这是星巴克，谁是一个奇怪的人提出有关移动应用程序性能的问题？无论如何，Raygun，我个人感谢他们帮助使这个播客成为可能。您可以访问raygun.com查看今天的免费试用版。&lt;/p>
&lt;p>迈克朱利安：嗨伙计们。我是Mike Julian，你是Real World DevOps Podcast的主持人。本周我的客人是Nicole Forsgren博士。您可能知道她是“加速：精益软件和DevOps的科学”一书的作者，或者可能是年度DevOps状态报告背后的研究员。当然，这不是全部。她也是最近被谷歌收购的DevOps研究和评估的创始人，他是管理信息系统和会计教授，同时也是一名性能工程师和系统管理员。说我很高兴与你交谈，这可能是一种轻描淡写。所以，欢迎来到节目。&lt;/p>
&lt;p>Nicole Forsgren：谢谢。很高兴来到这里。我很高兴我们终于联系了。我们试图做多久了？&lt;/p>
&lt;p>迈克朱利安：几个月。我想我已经联系过你了，现在已经是三月了。我在11月份到达了，你说，“嗯，你知道，我还有其他的东西在继续，顺便说一句，我的公司被收购了。”&lt;/p>
&lt;p>Nicole Forsgren：那么，那时候，我必须狡猾，对吧？我不得不说，“我有一个真正的大项目。我很抱歉。我们以后可以见面吗？”而且，上帝保佑，你是非常仁慈和善良的，你说，“当然 - ”&lt;/p>
&lt;p>迈克朱利安：谢谢你。&lt;/p>
&lt;p>Nicole Forsgren：&amp;hellip;&amp;hellip;“我们以后可以聊聊。”然后我想你在说：“哦，恭喜你的&amp;rsquo;大项目&amp;rsquo;&amp;lsquo;之后给我发了一条消息。”我说，“谢谢。”&lt;/p>
&lt;p>迈克朱利安：听起来不错。&lt;/p>
&lt;p>Nicole Forsgren：我很感激。是啊。然后，你再次伸出手，我说，“哦，我正在做另一个大项目。但是，这一次&amp;hellip;&amp;hellip;”&lt;/p>
&lt;p>迈克朱利安：这不是收购。&lt;/p>
&lt;p>Nicole Forsgren：是的，这不是收购。这一次，这是一个正常的大项目，这是今年的DevOps状态报告。我们刚刚启动了调查，所以我非常兴奋，我们再次收集数据。&lt;/p>
&lt;p>迈克朱利安：所以我们可以解决这个问题，你在哪里可以找到DevOps状态报告？&lt;/p>
&lt;p>Nicole Forsgren：所有DevOps状态报告都在DORA网站上发布。我们仍然有网站。我们所参与的所有报道，我想说我们从2014年开始，我已经很老了，我已经忘记了。我们完成的所有报告都是托管的。我们会在演出笔记中发布它们。如果你可以拿自己的健怡可乐或咖啡或茶或水，或者你想要波本威士忌。舒服。坐下来，大约需要25分钟。我知道，对，每个人都喜欢，“女孩，25分钟？”&lt;/p>
&lt;p>迈克朱利安：这是一项重大调查。&lt;/p>
&lt;p>妮可福斯格伦：我知道。它是。但这是因为DevOps状态报告是科学的，对吧？我们研究预测，而不仅仅是相关性。但请坐下来，舒服一点，让我知道做你的工作是什么感觉。因为今年我们正在挖掘其他一些东西;生产力，工具链，关于职业倦怠和幸福的额外事情，以及我们如何进入流动，以及真正的样子。还有一些非常棒的事情是，在以非常深思熟虑的方式进行调查之后，已经有很多人已经准备好了。顺便说一下，如果你有的话，我爱你们所有人。与同事分享，与同行分享。&lt;/p>
&lt;p>但是他们已经说过，仅仅通过参加调查，他们已经离开了，甚至在报告出来之前，他们已经走开了有关如何使他们的工作更好的非常有趣的想法和技巧和见解。&lt;/p>
&lt;p>迈克朱利安：是的，想到这一点很疯狂，参加调查的行为实际上改善了我的工作。因为我采取的大多数调查，我已经完成了，我想，“嗯，这有点浪费时间。”感觉就像我只是放弃了一堆东西而没有得到任何东西。&lt;/p>
&lt;p>Nicole Forsgren：是的，我认为这种方式起作用的原因是因为我们对问题的处理方式非常谨慎，有时只是采取调查的行为可以帮助你思考你的工作方式。因此，采取某些问题的行为可以帮助人们思考他们正在做的事情。然后，当然，就像我开玩笑说，这是我的生活圈，调查将持续到5月3日，然后我将进入数据分析和报告撰写。我们预计报告本身将在8月中旬左右公布。&lt;/p>
&lt;p>迈克朱利安：嗯，为什么我们不退后几步说&amp;hellip;每个人都喜欢一个好的起源故事。很多年前，我相信你和我在一次LISA会面。您正在与Carolyn Rowland联合举办研讨会 -&lt;/p>
&lt;p>Nicole Forsgren：哦，我喜欢Carolyn。&lt;/p>
&lt;p>迈克朱利安：是的，她也很精彩。我应该让她在这里。&lt;/p>
&lt;p>妮可福斯格伦：我的双胞胎。是。绝对。&lt;/p>
&lt;p>迈克朱利安：所以当我第一次见到你时你就是一名教授。我想，你知道教授在LISA上闲逛，并就如何理解商业价值给出了所有这些很好的建议，我认为这绝对令人着迷。教授，在DevOps世界中闲逛，这是怎么发生的？&lt;/p>
&lt;p>Nicole Forsgren：哦，天哪。好的，有趣的是，我实际上是从工业开始的。我的第一份工作是在一个主框架上，编写医疗系统，然后编写财务系统。所以我是一名大型机程序员。然后支持我的主框架系统，对吧？这就是Ops中我们这么多人在Ops中开始的原因，有人说，“好吧，有人必须这样做。”对？我还在学校，然后我最终成为DEV，对吗？我在IBM担任软件工程师已有好几年了，然后转向学术界。我得到了博士学位，在那里我开始询问有关如何分析系统的问题，所以我实际上在做NLP，自然语言处理。&lt;/p>
&lt;p>迈克朱利安：很有意思。&lt;/p>
&lt;p>Nicole Forsgren：是的，我在做&amp;hellip;&amp;hellip;&lt;/p>
&lt;p>迈克朱利安：是的，这是一个奇怪的切入点。绝对不是我所期望的。&lt;/p>
&lt;p>Nicole Forsgren：是的，所以疯狂的事情，我的第一年实际上是欺骗检测。&lt;/p>
&lt;p>迈克朱利安：我打赌这太棒了。&lt;/p>
&lt;p>Nicole Forsgren：这真的很有趣，非常有趣。但是我从系统工作中充分利用了我的背景，对吧？因为我们做什么？我们分析日志系统。&lt;/p>
&lt;p>迈克朱利安：对。&lt;/p>
&lt;p>妮可福斯格伦：对吗？我们习惯于以凌乱的格式分析大量数据，很多时候基于文本，超级嘈杂，不能总是信任它，对吧？现在人们都说，“我不相信调查。人们撒谎。”孩子们，我们的系统也是如此。&lt;/p>
&lt;p>迈克朱利安：一直以来。&lt;/p>
&lt;p>妮可福斯格伦：对吗？所以，他们喜欢我的一大堆这项工作。突然间，我随机对系统管理员进行了可用性研究。我们写了结果，把它们还给了IBM，IBM就像是，“你的意思是什么？我们遵循UCD指南，用户中心设计指南。这应该是适用的。”我就像是，“等等，哇哇哇哇哇哇哇哇哇哇哇哇哇哇&lt;/p>
&lt;p>当时，他们为所有用户提供了一套UCD指南。超级先进，高级别的高级系统管理员，他们正在做备份，灾难恢复，一切。那些买过笔记本电脑并且在生命中第一次使用电子邮件的人。&lt;/p>
&lt;p>迈克朱利安：我确信那个过得很好。&lt;/p>
&lt;p>妮可福斯格伦：什么？我想，“就是这样。改变我的论文。”当然，这让我的顾问惊慌失措。他们就像是，“你会去做什么？”所以我开始做什么，当时是DevOps的基础。那是什么，你如何理解和预测信息系统？通过信息系统，技术，自动化，使用和预测，然后是团队，组织层面的个人团队的结果和影响。&lt;/p>
&lt;p>现在，我说了所有这些，那是大词，这是学术用语，基本上是什么是DevOps。我如何理解人们何时使用自动化和流程以及工具和文化，以及我如何知道它汇总起来以产生影响并增加价值？现在我们就像，“哦，那是DevOps。”&lt;/p>
&lt;p>这是2007年末。&lt;/p>
&lt;p>迈克朱利安：哦，哇。所以你和我们在一起很早。&lt;/p>
&lt;p>Nicole Forsgren：是的。这是一个非常有趣的平行轨道，因为现在我们回顾过去，我们就像，大约10年前。这与DevOps同时是新生的起源，对吧？所以，我们这么多人在同一时间偶然发现了它。我不知道这是在工业中发生的事情。我一直在偷偷摸摸，我一直这样做，偶然发现LISA，试图连接数据，当然，就像每个好学者一样。拼命想找到数据。&lt;/p>
&lt;p>偶然发现，撞到了一个收集类似东西但使用不同粗糙方法的小组。一个来自一个可爱的小配置管理创业公司的团队叫做Puppet，对吧？开始与他们合作，邀请自己参与该项目。上帝保佑他们，我对他们有如此多的爱和尊重，因为他们基本上让这个随机的，随机的学术撕裂他们的研究并重做它并亲切地告诉我以前从未见过的这两个家伙，在电话中，名叫Jean和Jez，他们做错了什么，他们使用的这个词不是正确的词。 Redid，在2013年末，DevOps状态报告，使其在学术上严谨，然后，持续了几年，对吗？然后突然间，我们在几年后重新编写了一堆东西。&lt;/p>
&lt;p>我离开学术界，离开即将任职的地方，去另一个可爱的小配置管理创业公司Chef，这很有趣，对吗？因此，我正在与Puppet合作，为Chef工作，并继续研究并与组织和公司合作。我离开了学术界，因为我看到这个疯狂的DevOps事情有所作为。但是在学术界，他们还没有完全掌握它。而且我想确保我可以做出更大的改变，因为我在98,99,2000开始在大学的科技工作;我们举起这个疯狂的网络泡沫破灭。&lt;/p>
&lt;p>它不是一场萧条，因为一切都崩溃了，世界就像人们想象的那样结束了，但公司失败了，它对人们的遭遇产生了巨大的影响和影响。他们失去了工作，打破了家庭，他们感到沮丧，影响了他们的生活，有些人正在自杀。而且我非常担心当我们再次击中这一波时会发生什么，我们又开始看到那次击中。那么，如果公司和组织不了解制造技术的智能方法会发生什么，因为你不能只是让人们不顾问题，或者让同样的人陷入困境。当我说同样的人扔我的意思时，七天强行游行。&lt;/p>
&lt;p>当他们让我们这样做时，我在IBM，对吗？他们陷入集体诉讼，你不能这样做。这不是一种生活方式。&lt;/p>
&lt;p>迈克朱利安：是的，我参与其中很多，他们是残酷的。而且它们没有任何有用的结果。&lt;/p>
&lt;p>Nicole Forsgren：这只是破碎的心灵和破碎的生命，对吧？所以，有些人喜欢说，你真的关心这个。我只是这个书呆子的学者，他只关心我做的事情。因此，如果我们真的可以，从根本上改变人们制作软件的方式，因为如果它实际上实际上，从根本上改善了他们的生活&amp;hellip;&amp;hellip;让我们这样做。&lt;/p>
&lt;p>然后，感谢上帝，我们发现它确实存在。当然，它很好地为企业提供价值，但这很重要，因为那时它的作用是帮助他们做出更明智的投资，因为这样可以减少倦怠。它让人们更快乐，让他们的生活更美好，我认为这是重要的部分。&lt;/p>
&lt;p>迈克朱利安：所以你发现的是，一家公司实施所有这些更好的持续部署实践，更快的交付时间，更快的价值实现&amp;hellip;&amp;hellip;它使人们的生活更好地完成了工作？&lt;/p>
&lt;p>Nicole Forsgren：是的，John Shook也发现了这一点。对？他在精益中做了这项伟大的工作，为了改变&amp;hellip;有些人说，“你如何改变文化？”让我们找到改变文化的方法。有时，改变文化的最佳方式是改变你的工作方式，我相信我们已经看到了自己，对吗？在我们生活的其他方面。改变我们的感受，改变家庭的工作方式，改变我们的关系工作方式。你实际上改变了你的生活经历，或者你生活经历的某些方面。&lt;/p>
&lt;p>因此，如果我们改变我们制作软件的方式，我们将改变我们团队的运作方式，这正在改变文化的方式。换句话说，如果我们可以告诉我们的组织在技术和流程方面做出哪些明智的投资，那么我们也可以改善文化。我们也可以改变人们的生活吧？微软Bing团队发现了这个，对吧？他们希望在持续交付方面进行明智的投资。&lt;/p>
&lt;p>在一年之内，他们看到了工作生涯的分数，我将其从头脑中拉下来，但我想说它从38％上升到75％。那太大了。&lt;/p>
&lt;p>迈克朱利安：这是一个令人难以置信的跳跃。&lt;/p>
&lt;p>妮可福斯格伦：对。这是因为人们能够在工作中离开工作然后回家。你可以去看你的家人，你可以去看电影，你可以去吃饭，你可以有爱好，或者你可以去狂欢看格雷的解剖。你可以做你想做的。&lt;/p>
&lt;p>迈克朱利安：这对我来说最令人难以置信的事情之一是，为了让公司取得成功，他们必须推动员工，让他们通过振铃器。直观地说，这是永远不会正确的。而你实际上有数据表明这是不对的。做这些事实上让每个人都变得更好。业务得到了显着改善，人们的生活得到了极大的改善，而且一切都很棒。&lt;/p>
&lt;p>Nicole Forsgren：是的，如果我们想要推动人们，这是不可持续的。如果有的话，我们希望推动人们做他们擅长的事情，我们希望利用自动化来实现自动化擅长的事情。那是什么意思呢？&lt;/p>
&lt;p>我们希望让人们做有创意，创新，新颖的事情。让我们让人们解决问题，让自动化做我们需要的一致性，可靠性，可重复性，可自动性。让我们不要让人敲打锤子并不断进行手动测试。让我们让人们弄清楚如何解决问题，做一两次以确保这是正确的事情，自动化，将其委托给自动化，机器和工具，交付，完成，然后拉人回到循环中进入循环，找出新的东西。&lt;/p>
&lt;p>我认为是Jesse Purcell说：“我想让自己不断自动化。”对？使自己脱离当前的工作，然后找到一份新工作，让自己再次自动化。我们永远不会失业。&lt;/p>
&lt;p>Mike Julian：是的，当我第一次开始使用DevOps时，我常常担心这一点，实际上，当我第一次开始自动化时，当时并不是DevOps，它是在大学中自动化Windows桌面部署。这是在21世纪初。我最大的担忧之一是，因为我花了半个星期的时间来做这件事，如果我要自动化，我会花一个小时做这个，剩下的时间我会做什么呢？他们只是要解雇我，因为他们不再需要我了。&lt;/p>
&lt;p>事实证明，不，这根本不是发生的事情。更高的工作价值变得有效，因为我并没有那么专注于辛劳。&lt;/p>
&lt;p>Nicole Forsgren：对，那些类型的东西，机器和电脑都做不到。而另一件事，我曾经告诉我的所有朋友，在工作保障方面不考虑这一点，对吧？不要试图将自己描绘成一个别人无法做到的事情，因为那样你就无法被替换，因为这也意味着你永远无法得到晋升。&lt;/p>
&lt;p>如果我们始终确保工作的某些方面可以实现自动化，以便我们有机会获得新工作，那么这只会为创造更多的事物创造更多机会。总会有问题，我们总有一些问题需要解决。我不想被困在做无聊的工作。&lt;/p>
&lt;p>迈克朱利安：是的，上帝知道这是事实。&lt;/p>
&lt;p>妮可福斯格伦：哦，天哪，我知道。我不想被困在做无聊，重复的工作。这简直令人头痛。如果我们能找到，特别是真正具有挑战性的复杂事物，如果我们能找到自动化的方法，相信我，我们永远不会把自己挖到那个洞的底部。那总是存在的。&lt;/p>
&lt;p>Mike Julian：所以我想谈谈DevOps状态报告，我想先问一个你之前提到过的问题。你提到这句话，学术严谨。那是什么意思？&lt;/p>
&lt;p>Nicole Forsgren：学术严谨包括一些事情，好吗？因此学术严谨的一部分是研究设计。所以这不只是在回答一堆问题&amp;hellip;&amp;hellip;对不起，yolo是我的简写，“你的方法论是有问题的。”&lt;/p>
&lt;p>迈克朱利安：我最近看到很多调查结果出来了。&lt;/p>
&lt;p>Nicole Forsgren：是的。所以一个是研究设计。有人说，“妮可，研究设计是什么意思？”那么研究设计是，您要求的问题类型是否与您用于收集数据的方法相匹配？对？这些东西是否匹配？对于某些事情，调查是恰当的。一次，所以一次是横截面，一个时间跨整个行业的调查。有些事情适合。有些事情不适合。&lt;/p>
&lt;p>一个很好的例子，很多人真的希望我在DevOps状态报告中做开放空间和问题。&lt;/p>
&lt;p>迈克朱利安：这是什么意思？喜欢开放式问题？&lt;/p>
&lt;p>Nicole Forsgren：不，开放空间。所以很多人对开放式办公空间有很多感觉。我应该在开放的办公空间工作吗？开放办公空间会影响生产力吗？或配对编程&amp;hellip;&amp;hellip;配对编程会影响生产力吗？配对编程会影响质量吗？人们对这些事情有很多感觉。在DevOps状态报告中使用的研究设计类型是一个完全匿名部署的调查，在整个行业中的单个时间点，并不适合回答其中任何一个问题的研究设计。&lt;/p>
&lt;p>迈克朱利安：那是为什么？&lt;/p>
&lt;p>Nicole Forsgren：因为您需要做的是拥有更加可控的研究设计。所以我需要知道，例如，你和谁一起工作。我需要知道，所以让我们继续进行同行评审，我需要知道你正在处理的问题类型，代码问题的类型，我现在需要问题的复杂性，我需要知道它花了多长时间，对吧？如果你现在想要提高生产力，对吧？因为我需要了解一定的生产力。我需要知道结果是什么。因此，如果我的结果是生产力，我需要衡量生产力，因为我需要控制困惑，对吧？因为事情比较复杂，我们希望花更长的时间。那些不那么复杂的东西，我希望不会那么久，对吧？&lt;/p>
&lt;p>然后我需要匹配和控制。对？甚至像开放式办公空间这样的东西，对吧？因为如果你在一个开放的办公空间而不是一个开放的办公空间进行同行编程，如果你在办公室里这样做，我需要知道这个人的资历，或者一些资历代理。我现在需要你如何配对，你是否与你的近似经验水平的人配对，如果不是资历经验水平。我需要知道配对编程是如何工作的，我需要知道所涉及的技术，我需要知道你是否偏远，或者你是否真的坐在一起。我需要知道你是否能够同时输入文本，或者是否有人插入而另一个人没有。&lt;/p>
&lt;p>因此，当我进行比较时，我知道比较是什么样的。&lt;/p>
&lt;p>迈克朱利安：这是一个令人难以置信的信息量。我没想到你必须知道这么多才能从中得到一个好的答案。&lt;/p>
&lt;p>Nicole Forsgren：这不是我的头脑。是的，因为你问了我一个很好的问题，我吐了一口气。这只是研究设计，然后你继续分析，对吗？当您继续进行分析时，我们需要了解您提出的问题类型。这些类型的问题，我们是否在考虑相关性？我们在看预测吗？我们在考虑因果关系吗？我们提供哪些类型的数据以及适合哪种类型的分析和问题？&lt;/p>
&lt;p>同样，他们需要以正确的方式匹配。某些类型的数据不适用于某些类型的分析或问题。所以你真的需要确保每一个都适合于正确类型的东西。对？某些类型的分析，如机械，调查问题，永远不适合机械分析，对吧？虽然，老实说，没有人会做机械分析。从来没有，顺便说一句，如果有人来找我并说他们正在做机械分析，我会坐下来非常专心地听你的，非常感兴趣，因为我认为没有人在做机械&amp;hellip;&amp;hellip;这不是一个事情。&lt;/p>
&lt;p>迈克朱利安：所以当你分析调查结果时，我们看到的是一个问题，然后是另一个问题，接下来是另一个问题，你知道数百个问题。当您分析这些内容时，您是在一次查看问题，还是在查看多个问题，然后根据您在几个不同问题中看到的内容来解释答案？&lt;/p>
&lt;p>Nicole Forsgren：所以当我写完结果时，当我写这份报告时，我正在写出我的分析结果，而我的分析正在考虑一个非常非常仔细的研究设计。现在意味着什么，我的研究设计经过精心构建，以尽量减少误解。它试图尽量减少答案中的漂移。所以，我们这样做的一种方式，这在加速的第二部分中概述，如果有任何想要阅读的统计数据书呆子，我们做的事情称为潜在结构。&lt;/p>
&lt;p>所以，你问过只有几个问题或几个问题。我提到过，我们这样做的一种方式称为潜在构造。如果我想问你关于文化的话，我可以向10个人询问文化，我会得到15个答案。因为文化可能意味着许多不同的事情，对吗？一般来说，当我们在DevOps环境中谈论文化时，我们倾向于得到一些东西&amp;hellip;&amp;hellip;人们会说非常常见的事情，如打破孤岛，拥有良好的信任，拥有新奇，对吧？&lt;/p>
&lt;p>因此，我们所做的是从定义开始，然后我们将提出几个项目，问题，捕获每个维度。所以你可能想要考虑一个涂料维恩图，其中每个问题都被覆盖，然后是所有他们拥有最大或完美覆盖的东西，它们是中心，那个小坚果，这就是构造是什么。这就是文化，即文化所代表的。&lt;/p>
&lt;p>然后每个圈子都是问题。这就是我们在研究设计中所做的。研究设计的一部分。当我进入统计分析模式时，我会考虑所有问题，所有项目，不仅仅是文化，而是我正在考虑的每一件事。因此，在过去的几年里，我已经完成了监视可观察性，我已经完成了CI，我已经完成了自动化测试，我已经完成了版本控制，我已经完成了所有这些工作，并且我将所有这些都扔进了漏斗，对？&lt;/p>
&lt;p>迈克朱利安：我敢肯定，这可能是你庞大的Excel电子表格。&lt;/p>
&lt;p>Nicole Forsgren：不，这是SPSS。我使用SPSS但您可以使用几种不同的统计工具。我们做主成分分析。而我们所做的就是它们如何加载？基本上，他们如何组合在一起，我们是否具有收敛有效性？它们会聚合吗？他们只测量他们应该测量的东西吗？我们是否有判别有效性？他们不衡量他们不应该衡量的东西吗？我们有可靠性吗？每个阅读这些问题的人都会以非常相似的方式阅读吗？&lt;/p>
&lt;p>一旦我们掌握了所有这些，并且对所有这些事情进行了几次统计测试，那么我说，“好的，这些项目，通常是三到五项，所有这些项目都是文化，”或“所有这些项目一起是CI，“或”所有这些，正确的这些项目分组，代表了这一点。“好的，现在，现在，我可以开始查看关联，预测或其他内容，然后我会看到报告，现在我只想谈谈文化。&lt;/p>
&lt;p>所以我把它作为一件事情谈论，但实际上是几件事，然后当我谈到文化时，我可以说，“这就是文化是什么”，我可以用这种细微的，多维的方式谈论它，我知道那些维度是什么，因为它由三到五，六到七个问题组成，顺便说一下，如果其中一个问题不合适，因为我从统计分析中知道，我可以抛弃它，我知道为什么。我总是有几件事。如果您只有一个问题或者您只有两个问题，那就是风险。如果其中一个不起作用，哪一个是错误的？你不知道。对？因为，是A还是B？我不知道。&lt;/p>
&lt;p>至少如果我从三开始，一个失败，那么它可能是好的两个。&lt;/p>
&lt;p>迈克朱利安：是的。这里的许多听众已经采取了很多由营销组织进行的调查，除了调查也是由营销人员设计的&amp;hellip;&lt;/p>
&lt;p>Nicole Forsgren：他们是由想要特定答案的人设计的。&lt;/p>
&lt;p>迈克朱利安：没错。&lt;/p>
&lt;p>Nicole Forsgren：这就是挑战。&lt;/p>
&lt;p>迈克朱利安：是的，然而，为了清楚地说明，DevOps状态报告根本就不是这样。正如你所说，有很多东西都是严格的。&lt;/p>
&lt;p>Nicole Forsgren：好的一点是，我们一直是供应商和工具无关的。&lt;/p>
&lt;p>迈克朱利安：你不是在寻找一个非常特别的答案，你想知道实际上是什么。&lt;/p>
&lt;p>Nicole Forsgren：我们并不是在寻找产品的答案。那么，在CI的例子中，什么是CI？我不关心工具。我说，如果你正在做CI，如果你正在进行CI，持续集成，以一种预测智能结果的方式，你将拥有这四样东西。其中的力量是，任何人都可以回过头来看待这个评估工具。如果您是经理，领导者或开发人员，您可以说，“我使用的任何工具，世界上的任何工具，我应该寻找这四件事”，或“我自己构建的任何工具，或者如果我正在做CI，我应该有这四件事。“&lt;/p>
&lt;p>如果你是一个供应商，你应该说，“如果我认为我正在建立或销售CI，我最好有这四件事。对吗？这就是伟大的事情，我必须说，上帝保佑我的新团队。他们让我以同样的方式运行它。它仍然是相同的。它仍然是供应商和工具无关，它仍然是能力集中。你寻找的每一件事，无论是自动化或流程，文化或结果，它的供应商和工具不可知，它的能力集中，再次，权力是你可以用它作为一个评估工具。&lt;/p>
&lt;p>我的团队是这样做的吗？我的工具是这样做的吗？我的技术是这样做的吗？我能做到吗？如果我不是，我的弱点是什么？我的约束是什么？因为如果我把我们带回到开头，是什么驱使我和DORA团队，那么我们想要摆脱这一点是什么？我们想让事情变得更好。我们该怎么做？我们可以为人们提供简单的评估标准。而且我并不是说这很容易，因为所有这些都很简单，需要工作。但如果有明确的评估标准，我们就有了可以去的地方。&lt;/p>
&lt;p>Mike Julian：因为我知道你喜欢谈论你几年来所做的事情。您提出了哪些最有趣的结果？&lt;/p>
&lt;p>Nicole Forsgren：哦，有很多好的。&lt;/p>
&lt;p>迈克朱利安：让我们选择你的前三名。&lt;/p>
&lt;p>Nicole Forsgren：好的，我认为我的最爱之一是，我会用俗气的营销方式来做&amp;hellip;&lt;/p>
&lt;p>迈克朱利安：请接受。我们已经做好了准备。&lt;/p>
&lt;p>Nicole Forsgren：有一个小创业公司并且不得不假装它作为营销人员一分钟的人，我们将看到我在这方面做了什么。&lt;/p>
&lt;p>架构很重要，而不是技术没有。第一。好的。那是什么意思呢？这意味着，我们发现如果您以正确的方式构建它，您的架构结果会比您的技术堆栈产生更大的影响。所以架构成果，一些关键问题是：我可以测试吗？我可以部署吗？我可以建立没有细粒度的沟通和协调吗？&lt;/p>
&lt;p>迈克朱利安：细粒度意味着什么？&lt;/p>
&lt;p>Nicole Forsgren：我是否必须与他人见面并一起工作并征用一些东西，我是否需要开辟一些疯狂的新测试环境，还是必须获得17个不同团队的批准？请注意，我刚刚提到过团队。沟通和协调可能是技术限制，也可能是人的限制。这让人很难回到康威定律。&lt;/p>
&lt;p>迈克朱利安：我最喜欢的法律之一。&lt;/p>
&lt;p>妮可福斯格伦：对吗？这是一个DevOp的事情。但是，这是真的。无论我们的沟通模式如何，我们通常最终会融入我们的技术。现在，我将说这在云和云原生环境中通常更容易实现，但它也可以在Legacy和Mainframe环境中完全实现。我们没有看到前几年布朗菲尔德和格林菲尔德受访者之间存在统计学上的显着差异。&lt;/p>
&lt;p>迈克朱利安：很高兴知道。&lt;/p>
&lt;p>Nicole Forsgren：是的，我喜欢那个。那个人很有趣。&lt;/p>
&lt;p>好的，第二个。云很重要，但只有你做得对。&lt;/p>
&lt;p>迈克朱利安：噢，这意味着什么？&lt;/p>
&lt;p>Nicole Forsgren：Dun dun duh。所以，这是我最喜欢的统计数据之一。我们发现，如果您正在执行所有五个重要的云特征，那么您成为精英表演者的可能性要高23倍。根据美国国家标准技术研究院（NIST）的说法，我想你可以说你是否正在完成云计算的所有五个基本特征。所以我没有提出这个，这来自NIST，好吗？&lt;/p>
&lt;p>所以它很有趣，因为我们询问了很多人是否在云端。他们就像，当然我们在云端，我们完全在云端，对吗？但只有22％的人正在做五件事。那这五个是什么？所以这五个是按需自助服务。您可以在没有人工干预的情况下配置资源，如果您必须填写一张票并等待一个人办票，这不算数。没有积分。&lt;/p>
&lt;p>另一个是广泛的网络访问。因此，您可以通过任何类型的平台访问您的云端内容;手机，平板电脑，笔记本电脑，工作站。大多数人都非常擅长这一点。另一个是资源池，因此可以根据需要动态分配和重新分配资源。另一个是快速弹性，对，爆裂魔法。我们通常都知道这个。&lt;/p>
&lt;p>现在最后一个是测量服务。所以我们只支付我们使用的费用。因此，最常查看的通常是广泛的网络访问和按需自助服务。&lt;/p>
&lt;p>迈克朱利安：是的，有趣的是，对我来说，那里没有任何东西阻止，比如说，从排位赛开始的内部开放堆栈集群。&lt;/p>
&lt;p>Nicole Forsgren：没错，对。所以这可能是私有云。我爱你指出了这一点。之所以如此重要的原因是，它只是归结为执行。它可以完成，另一个挑战是组织，管理人员或董事会经常说你必须去云，所以有人说，“哦，是的，我们要去云端。”但后来有人重新定义了云中的意义。对？所以，你到达那里，有人检查他们的小盒子，把金星放在某人的图表上，他们走开了，他们就像是，“好吧，我们没有看到任何好处。”好吧，是的，因为你没有这样做。&lt;/p>
&lt;p>迈克朱利安：对。是的。&lt;/p>
&lt;p>Nicole Forsgren：就像是，“我买了一个健身房会员，我已经完成了。”不，再说一遍，我不是说这很容易，对吧？有一些工作涉及。现在我喜欢的另一件事是，让我们说你不在云端，由于某种原因你必须留在Legacy环境中，你可以看看这五件事你可以尽可能多地实现，你仍然可以实现利益。&lt;/p>
&lt;p>迈克朱利安：对。这不是一个全有或全无的方法。你可以做其中的一些，并从中获得很多好处。&lt;/p>
&lt;p>Nicole Forsgren：这几乎就像一个骗子回到了第一，这是建筑问题，技术没有。我怎么能做一个备忘单，看看如何到达那里的一些非常好的技巧？&lt;/p>
&lt;p>迈克朱利安：那你的三号是什么？&lt;/p>
&lt;p>Nicole Forsgren：我的第三个可能是，外包不起作用。&lt;/p>
&lt;p>迈克朱利安：是的。&lt;/p>
&lt;p>Nicole Forsgren：有些人讨厌我，他们从他们的眼睛射出激光束。所以我们说外包不起作用*。&lt;/p>
&lt;p>迈克朱利安：好的，什么是星号？&lt;/p>
&lt;p>Nicole Forsgren：Asterisk，星号将是功能性外包不起作用。&lt;/p>
&lt;p>迈克朱利安：好的，所以说外包我的待命职责，可能不会那么好用。&lt;/p>
&lt;p>Nicole Forsgren：拿走所有的DEV，把它运走。全部采用TEST，将其运走。拿走所有OPS，运送它。现在，为什么呢？因为那样，你们所做的一切都是另一套交接，你们创造了另一个孤岛。你还批量完成了大量的工作，而你却让每个人都等待这种情况发生。目标是创造价值而不是让人们等待。如果现在每个人都必须等待所有东西回来，如果你正在做高价值的工作等待低价值的工作，因为它必须回到一起，这通常是它的工作方式，你是骨头。&lt;/p>
&lt;p>现在，功能外包。如果您有一个与您合作并与您协调并以相同的节奏交付的外包合作伙伴，那么这不是功能性外包。那是星号。&lt;/p>
&lt;p>迈克朱利安：好的，有问题。&lt;/p>
&lt;p>Nicole Forsgren：另外，如果他们是你的团队的一部分，他们是你公司的一部分，但他们基本上一次消失了三个月。对不起孩子，这是功能外包。我没有任何积分，愿上帝怜悯你的灵魂。这没用。&lt;/p>
&lt;p>迈克朱利安：对。在我看来，你怎么知道你是否处于这种困境中，如果你的团队和你给这些项目的人之间有明显的交接，你就有功能外包。那会是对的吗？&lt;/p>
&lt;p>Nicole Forsgren：是的，特别是如果有一个明显的手，然后是一个黑盒子的神秘。&lt;/p>
&lt;p>迈克朱利安：就像，工作是如何完成的？&lt;/p>
&lt;p>Nicole Forsgren：第一步，第二步，问号，第三步：获利。&lt;/p>
&lt;p>迈克朱利安：也许吧。所以前两个，这一切都很好，因为我们可以看到从哪里去，但第三个实际上看起来有点困难，因为如果我是一个系统管理员，我完全无法控制这个功能外包。我可能也讨厌它，我可能自己讨厌它，但我对它没有任何控制权。我可以做什么作为系统管理员，或操作员，开发人员，我该如何改善这种情况？&lt;/p>
&lt;p>妮可福斯格伦：所以一些想法可能包括一些事情，看看是否有任何方法可以改善过渡期间的沟通或节奏。对？您可能仍然拥有该外包合作伙伴，因为这就是它的方式。但是，假设您已经以三个月的增量进行了工作，有没有办法将切换增加到每月一次？有没有什么方法可以让我们知道我们知道我们导入的功能，小批量工作，只是增加切换？有什么方法可以将它们整合到我们的节奏中，融入我们的团队吗？&lt;/p>
&lt;p>现在我意识到这里有一些挑战，因为从法律的角度来看，我们不能像我们的团队那样对待他们，因为那时，至少从美国的角度来看，一旦我们像对待员工那样对待他们，那么我们就要对就业税负责以及所有其他合法的东西。但是，如果我们能够将它们整合到我们的工作节奏中，或者更接近我们的工作节奏，那么我们的结果就会得到改善。&lt;/p>
&lt;p>迈克朱利安：好的，很酷。这更有意义。这听起来并不像我担心的那么难。&lt;/p>
&lt;p>Nicole Forsgren：所以它可以开始减少节奏的延迟，要求稍微更清楚地了解正在发生的事情，如果它是一个完整的黑盒子，那就是寻找它。&lt;/p>
&lt;p>迈克朱利安：妮可，这绝对是太棒了。非常感谢你加入我。我有两个最后的问题。人们在哪里可以找到这个DevOps状态报告来进行调查？调查在哪里？&lt;/p>
&lt;p>Nicole Forsgren：哦，我们已经发布了调查结果。我可以将它包含在演出笔记中吗？&lt;/p>
&lt;p>迈克朱利安：当然。好的，大家，查看链接的节目说明。我的最后一个问题是除了这项调查之外，人们可以在哪里找到更多关于你和你的工作的信息？&lt;/p>
&lt;p>Nicole Forsgren：我有几个地方。所以我自己的网站是在nicolefv.com，我总是在Twitter上，通常谈论冰淇淋和健怡可乐，那是@nicolefv。&lt;/p>
&lt;p>迈克朱利安：我确实爱你Twitter推特。这是我的最爱之一。&lt;/p>
&lt;p>Nicole Forsgren：是的，每个人都来打个招呼。我的DM是开放的。&lt;/p>
&lt;p>迈克朱利安：我最喜欢你的Twitter提要大概是在你写报告的时候，说：“天哪，我为什么要这样做？”&lt;/p>
&lt;p>Nicole Forsgren：是的，我试着把它锁起来，但每隔一段时间就会有什么东西会滑落，比如“哦，我的天哪，一件好事正在发生”，或者“哦，我忘记了这一件事”，或“那么多好事正在发生。“&lt;/p>
&lt;p>迈克朱利安：是的，我记得去年就像，“哦，我的上帝，这太酷了，但我无法告诉你。”&lt;/p>
&lt;hr></description></item><item><title>2019年关于DevOps的几个预测</title><link>https://martinliu.cn/blog/2019%E5%B9%B4%E5%85%B3%E4%BA%8Edevops%E7%9A%84%E5%87%A0%E4%B8%AA%E9%A2%84%E6%B5%8B/</link><pubDate>Sat, 09 Mar 2019 22:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/2019%E5%B9%B4%E5%85%B3%E4%BA%8Edevops%E7%9A%84%E5%87%A0%E4%B8%AA%E9%A2%84%E6%B5%8B/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15218597150085.jpg" alt="Featured image of post 2019年关于DevOps的几个预测" />&lt;p>本文汇聚了来自3个网站的预测文章，他们分别是XebiaLabs、G20Group和Veritis。在总共22项预测中，个别预测是相同的。DevOps是一个持续进化和发展的过程，同时也受到目前各种新技术的影响。&lt;/p>
&lt;h2 id="xebialabs的7个预测">XebiaLabs的7个预测
&lt;/h2>&lt;p>英文原文： &lt;a class="link" href="https://blog.xebialabs.com/2019/01/10/7-predictions-for-devops-in-2019/" target="_blank" rel="noopener"
>https://blog.xebialabs.com/2019/01/10/7-predictions-for-devops-in-2019/&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://blog.xebialabs.com/wp-content/uploads/2019/01/crystal-ball-768x450.jpg"
loading="lazy"
alt="XebiaLabs的7个预测"
>&lt;/p>
&lt;h3 id="1-持续集将成作为流水线的重要代办事项">1. 持续集将成作为流水线的重要代办事项
&lt;/h3>&lt;p>如果企业希望提高团队用在功能开发上的可用时间，从而加速向生产环境中交付的话，那么在整个DevOps流水线中，引进持续集成CI部分将成为高优先级且重要的事项。监控CI流水线相关的数据、活动和流程的能力将变得非常重要，这样可以使发布流程中的所有人都能看到最新的流程状态，从而减少开发人员花费在无关任务上的时间。 【来自：XebiaLabs产品开发副总裁Andreas Prins】&lt;/p>
&lt;h3 id="2-价值流映射将被广泛使用">2. 价值流映射将被广泛使用
&lt;/h3>&lt;p>目前，随着软件交付的速度和质量正成为大型企业的巨大竞争优势，越来越多的组织将会探索价值流映射（Value stream mapping）的使用方式，从而确保他们的软件开发是和整体业务价值保持一致的。这种转变将会减少软件发布流水线中的浪费，并创建出更强大的跨职能团队协作。【来自：Lisa Wells，XebiaLabs产品营销副总裁】&lt;/p>
&lt;h3 id="3-实时挖掘软件交付流水线所产生的数据">3. 实时挖掘软件交付流水线所产生的数据
&lt;/h3>&lt;p>在2019年，IT部门通过软件持续不断创造业务价值的压力将会越来越高。因此，组织将用各种方法挖掘在软件交付流程中大量的由机器所生成的数据，而不只是在事后才进行分析，甚至还包括DevOps的可预测性。这样才能够更好地预测软件交付流程和基础架构中所发生的问题，而这些问题可能对应用程序的质量和安全性产生负面影响，可能会使产品上市时间延期。【来自： Lisa Wells，XebiaLabs产品营销副总裁】&lt;/p>
&lt;h3 id="4-在人和流程中培养责任共但文化">4. 在人和流程中培养责任共但文化
&lt;/h3>&lt;p>DevOps同时关乎于人、流程和工具。对于任何DevOps实施计划而言，需要将人和流程视为首要的交付价值的因素。在2019年，我们将看到企业会越来越重视培养承担责任的文化，团队在复杂的应用程序交付流水线中共同承担质量和效率的责任。各个团队需要及时了解协作和进度。关键是在项目的进展过程中，及时的与整个公司分享那些取得了成功的措施和及其成果。除了证明他们的努力能够带来重大成果之外，毕竟，也没有什么比这种方式更能激励团队的了。【来自：T.J. Randall，客户成功副总裁，XebiaLabs】&lt;/p>
&lt;h3 id="5-自服务部署将成为主流">5. 自服务部署将成为主流
&lt;/h3>&lt;p>随着自动化部署已经成为企业的标准实践，随着组织逐渐地意识到可以将信息安全和合规性也融入到他们的交付流程中，在2019年，自助服务式部署会成为主流的工作实践。【来自：T.J. Randall，客户成功副总裁，XebiaLabs】&lt;/p>
&lt;h3 id="6-建立自己的devops能力度量组合">6. 建立自己的DevOps能力度量组合
&lt;/h3>&lt;p>随着DevOps的投资增加，管理层将需要更多的投资回报率证据。团队需要建立他们基于全局测量（不仅仅是单个团队或个人）和结果（具有速度和稳定性的软件交付）的组合来测量DevOps（DevOps Intelligence）的能力。【来自：Vincent Lussenburg，DevOps战略总监，XebiaLabs】&lt;/p>
&lt;h3 id="7-devsecops融入到devops流程中">7. DevSecOps融入到DevOps流程中
&lt;/h3>&lt;p>对信息安全“前置（左移）”的需求将会在DevOps实践中得到更好的理解和更有效的应用。在2018年，“前置（左移）”经常被滥用，被误以为会把软件的安全性责任推给开发人员。在2019年，DevSecOps将成为DevOps的另一个自然的选择，将安全性融入到流程中的每个阶段，并且所有人都对安全性有责任。【来自：Vincent Lussenburg, Director of DevOps Strategy, XebiaLabs】&lt;/p>
&lt;h2 id="g20group的5个预测">G20Group的5个预测
&lt;/h2>&lt;p>原文：https://www.go2group.com/blog/devops-trends-2019-our-top-five-predictions-for-the-year/&lt;/p>
&lt;p>&lt;img src="https://cdn.go2group.com/wp-content/uploads/2019/01/CC-173-devops-trendsV3.jpg"
loading="lazy"
alt="5个预测"
>&lt;/p>
&lt;p>由于文章比较长，下面是核心观点的概述。&lt;/p>
&lt;ol>
&lt;li>使用AI加速/优化的DevOps将开始被逐渐应用。基于AI的预测性可以被用在CI或者CD栋流水线过程中，确保交付流程的有效性。这个趋势将加速应用开发者和数据科学家之间的协作。&lt;/li>
&lt;li>容器化应用不在是新鲜事物了。DevOps和多云架构加速了容器相关的技术在大型企业中国的使用。越来越巨大的软件开发和部署规模也进一步提高了容器生产环境集群的规模和复杂性。Kubernets的广泛使用也进一步加速了应用容器化的进程。&lt;/li>
&lt;li>Functions-as-a-Service (FaaS) 将会崭露头角。随着越来越多的专业人士在生产环境中广泛的使用容器技术。相信FaaS也会逐渐被应用起来，它也比称之为无服务器计算。这种技术的实现包括：AWS Lambda、Google Cloud Functions, Microsoft Azure Functions, IBM 等。&lt;/li>
&lt;li>DevSecOps会变得更加重要。随着企业应用DevOps的范围逐渐扩大化，将安全性和合规性无缝的集成到DevOps转型过程中也得到了广泛的接受。主流的DevOps实践者会把安全性视为代码，安全团队会在DevOps工作流中和各种团队携手打造安全性。&lt;/li>
&lt;li>自动化将会依然非常重要。企业越来越意识到在软件开发周中提高响应速度、运维的可恢复性、更快的上市时间的重要性；这需要将软件开发和运维工作通过自动化更好的链接起来。组织在复杂的生态系统中扩大自动化的应用还是有些难度。&lt;/li>
&lt;/ol>
&lt;h2 id="来自veritis的10个预测">来自Veritis的10个预测
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/DevOps-top-10-Predictions-2019-768x1152.jpg"
loading="lazy"
alt="10个预测"
>&lt;/p>
&lt;p>原文： &lt;a class="link" href="https://www.veritis.com/blog/devops-trends-top-10-predictions-for-devops-in-2019/" target="_blank" rel="noopener"
>https://www.veritis.com/blog/devops-trends-top-10-predictions-for-devops-in-2019/&lt;/a>&lt;/p></description></item><item><title>产品管理遇上Devops</title><link>https://martinliu.cn/blog/csg-product-meet-devops/</link><pubDate>Thu, 07 Mar 2019 12:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/csg-product-meet-devops/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1551950710/bjxysnye.png" alt="Featured image of post 产品管理遇上Devops" />&lt;p>DevOps企业峰会是历史悠久的DevOps主题企业级峰会，近年来在北美的拉斯维加斯和欧洲的伦敦每年各举办一次。
&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_15-50-17.jpg"
loading="lazy"
alt="2019-03-07_09-17-49"
>&lt;/p>
&lt;p>这个大会的官网：&lt;a class="link" href="https://events.itrevolution.com/" target="_blank" rel="noopener"
>https://events.itrevolution.com/&lt;/a> 2019年的会议时间已经发布，感兴趣的可以参加。&lt;/p>
&lt;p>CSG公司连续多年参加DevOps企业峰会，本分享主题是CSG在2018年美国拉斯维加斯的峰会上的主旨演讲之一。本文是对这个演讲的视频回放的整理，该视频已经上传到了腾讯视频。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_15-50-44.jpg"
loading="lazy"
alt="2019-03-07_09-17-49"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;h2 id="csg-international公司简介">CSG International公司简介
&lt;/h2>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_09-17-49.jpg"
loading="lazy"
alt="2019-03-07_09-17-49"
>&lt;/p>
&lt;p>CSG是一个基于SaaS的客户支持和计费公司。CSG是美国最大的账单打印和呼叫中心公司。帮助他们的合作伙伴公司完成水电费、宽带费、通信费等相关业务的收款工作，并为最终客户提供热线电话支持。&lt;/p>
&lt;p>CSG的技术堆栈范围广泛，从Mainframe主机到Linux开放系统到AWS云服务，CSG认为如果正确的运用DevOps技术的话，技术堆栈并不是阻力和限制。&lt;/p>
&lt;p>CSG的DevOps旅程经历了如下几个阶段。&lt;/p>
&lt;h2 id="2012年-敏捷转型">2012年 敏捷转型
&lt;/h2>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_09-31-46.jpg"
loading="lazy"
alt="2019-03-07_09-31-46"
>&lt;/p>
&lt;p>敏捷转型历经四年，进行了组织结构调整，在这个过程中关注点和亮点如下：&lt;/p>
&lt;ul>
&lt;li>应用精益思想消除了各种等待队列&lt;/li>
&lt;li>应用康威定律重组重组了团队&lt;/li>
&lt;li>重组团队之后形成跨职能团队，将设计团队，开发和测试团队融为一体&lt;/li>
&lt;li>实施持续集成技术，落地持续部署流水线作为业务开发的基础设施&lt;/li>
&lt;li>实施了测试自动化&lt;/li>
&lt;li>实施了共享的遥测数据，这就是今天所热议的可观察性&lt;/li>
&lt;li>将作业批量尺寸缩减为以前的一半&lt;/li>
&lt;li>成立了多个独立于研发团队的共享的运维团队【注意：运维还没有和研发团队融为一体，共享运维团队管理所有IT环境并和所有产品团队协作】&lt;/li>
&lt;/ul>
&lt;p>敏捷转型的效果：&lt;/p>
&lt;ol>
&lt;li>发布影响业务的事件数量下降（在固定的时间周期里统计由于发布导致的影响客户服务的事件数量）&lt;/li>
&lt;li>变更失败率下降&lt;/li>
&lt;/ol>
&lt;h2 id="2012-2015-敏捷转型和devops早期">2012-2015 敏捷转型和DevOps早期
&lt;/h2>&lt;p>在敏捷转型的持续集成的基础上，CSG实施了持续部署实践，持续部署被视为应用DevOps实践的标志性动作，将所有部署转为为可重复执行的自动化部署。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_09-46-07.jpg"
loading="lazy"
alt="2019-03-07_09-46-07"
>&lt;/p>
&lt;p>上图是运维工程师们在工作时段里进行日间部署的场景，但是平均每天进行15.1个部署，71个面向最终用户的特性发布。在部署期间，运维工程师们在信心满满的打着电动。由于每一个生产环境的部署都已经做过了大量的自动化测试，且在其它环境中至少部署过7遍了。&lt;/p>
&lt;h2 id="2016-反作用力和挣扎期">2016 反作用力和挣扎期
&lt;/h2>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_09-57-30.jpg"
loading="lazy"
alt="2019-03-07_09-57-30"
>&lt;/p>
&lt;p>上图的情形应该很常见，CSG也经历了这个阶段。&lt;/p>
&lt;p>开发团队追逐：&lt;/p>
&lt;ul>
&lt;li>交付速度&lt;/li>
&lt;li>更好、更快的环境&lt;/li>
&lt;li>更好的服务请求工具&lt;/li>
&lt;li>憎恨变更请求队列（流程）&lt;/li>
&lt;/ul>
&lt;p>运维团队追逐：&lt;/p>
&lt;ul>
&lt;li>稳定性！&lt;/li>
&lt;li>高质量代码&lt;/li>
&lt;li>更敏捷的工具&lt;/li>
&lt;li>憎恨变更请求队列（流程）&lt;/li>
&lt;/ul>
&lt;p>开发和运维团队都厌恶的：&lt;/p>
&lt;ul>
&lt;li>变更管理流程&lt;/li>
&lt;li>发布管理流程&lt;/li>
&lt;li>生产环境的运维部门&lt;/li>
&lt;li>PMO项目经理&lt;/li>
&lt;/ul>
&lt;p>客户想要的是：“更快得到高质量的特性！”&lt;/p>
&lt;h2 id="2016-devops团队融合阶段">2016 DevOps团队融合阶段
&lt;/h2>&lt;p>大家一起反思这个问题：“我们为何不站在同一条战线上，一起追逐相同的目标？”&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_10-05-41.jpg"
loading="lazy"
alt="2019-03-07_10-05-41"
>&lt;/p>
&lt;p>设置共同（共享）目标：更快、更稳定和更安全！融为同一个团队，为了更好的服务客户而努力奋斗。&lt;/p>
&lt;h2 id="20162018-后devops时代">2016~2018 后DevOps时代
&lt;/h2>&lt;p>为了化解在的研发和运维之间的依然持续存的矛盾现象，在大家反思之后；进行了再次的团队组织结构调整，消除了所有共享的运维团队，将运维团队的工程师融入了各个研发团队。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_10-34-22.jpg"
loading="lazy"
alt="2019-03-07_10-34-22"
>&lt;/p>
&lt;p>CSG的DevOps转型阶段的重点：&lt;/p>
&lt;ul>
&lt;li>运用了不同于双模IT的模型，即”统模IT“，在DevOps实践面前，各种类型的IT架构都一视同仁&lt;/li>
&lt;li>转型后的开发团队统一负责产品的构建、测试、运行和服务质量&lt;/li>
&lt;li>下放变更管理委员会（CAB）职责到各个开发团队，成立本地化的CAB（详见ITIL的术语表）&lt;/li>
&lt;li>建立了群策群力的服务支持响应机制（参考精益思想的安灯拉绳），因此大幅度缩短了MTTR时间&lt;/li>
&lt;li>实施了反向布兰特操作，消除大量普遍存在的布兰特（这是一个比喻，详见《凤凰项目》的人物布兰特）&lt;/li>
&lt;li>建立整合的Backlog，将开发、测试和运维的工作统筹管理&lt;/li>
&lt;li>实施基础设施自动化&lt;/li>
&lt;li>将运维问题（目标不一致、反作用力、部门墙）视为工程实践问题：更好的工程实践，更少的苦活累活！&lt;/li>
&lt;/ul>
&lt;p>【注意】如上图所示，新增了一个度量指标：Inc/Mo 每月的事件数量（ITIL的术语），这是生产环境中每月发生的事件单的数量，数量的降低说明了生产环境的稳定性的提高。&lt;/p>
&lt;p>CSG在这个阶段中所引入的DevOps实践参考指南书籍是《DevOps Handbook》，中文版封面如下图所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1524360305/devops-handboo-3d-500x500.jpg"
loading="lazy"
alt="DevOps Handbook"
>&lt;/p>
&lt;p>&lt;a class="link" href="https://book.douban.com/subject/30186150/" target="_blank" rel="noopener"
>https://book.douban.com/subject/30186150/&lt;/a>&lt;/p>
&lt;p>在始于2016年的DevOps旅程中，CSG从改善负面指标阶段，步入了追逐正向业务价值目标的阶段。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_11-01-46.jpg"
loading="lazy"
alt="2019-03-07_11-01-46"
>&lt;/p>
&lt;p>CSG通过打敏捷开发、精益思想和DevOps实践的组合拳，实现了稳定性和业务的同步增长。&lt;/p>
&lt;ul>
&lt;li>从2012年到2018年业务订阅用户数增长了27%。&lt;/li>
&lt;li>生产系统的交易吞吐量（TPS每秒的交易数），增长了433%&lt;/li>
&lt;/ul>
&lt;h2 id="产品管理遇上devops的主旋律">产品管理遇上DevOps的主旋律
&lt;/h2>&lt;p>产品管理和DevOps之间的关系该如何协调和处理，在这个阶段里得到了定义。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_11-13-18.jpg"
loading="lazy"
alt="2019-03-07_11-13-18"
>&lt;/p>
&lt;p>整个集体应该遵从的三大主旋律：&lt;/p>
&lt;ol>
&lt;li>将策略连接落实到人，从而改善了产品管理和DevOp的关系，基于相同的业务诉求：实现了更好的价值产出&lt;/li>
&lt;li>IT不是是独立于业务之外：管理的应该是产品价值流，而非项目。&lt;/li>
&lt;li>运维问题是一个同时于与工程和产品都相关的问题&lt;/li>
&lt;/ol>
&lt;p>见上图，寻找划出的重点和关键词。&lt;/p>
&lt;p>出现了新的度量指标：&lt;/p>
&lt;ul>
&lt;li>Impact minutes ：业务恢复时间 MTRR&lt;/li>
&lt;li>Release on demand ： 特性按需发布比率&lt;/li>
&lt;li>eNPS ：员工对企业的点赞比率&lt;/li>
&lt;/ul>
&lt;p>以上数据的度量周期是从2017年至今的，影响这些指标的内因包括：&lt;/p>
&lt;ul>
&lt;li>精益领导力组合&lt;/li>
&lt;li>产品经理遇上DevOps&lt;/li>
&lt;/ul>
&lt;h2 id="产品管理为何要遇上devops">产品管理为何要遇上DevOps？
&lt;/h2>&lt;p>在CSG工作了19年之久，经历和目睹敏捷和DevOps转型全过程的项目经理，Brian Clark（VP Product management）的简单版答案：“业务成果”。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_11-32-23.jpg"
loading="lazy"
alt="2019-03-07_11-32-23"
>&lt;/p>
&lt;p>CSG的处于一个非常稳定的成熟市场，而且是市场的领导者；上游的电信运营商公司和宽带网络公司的业务都已经很难成长了。&lt;/p>
&lt;p>CSG所在行业的复合年均增长率约等于2%，CSG公司的复合年均增长率是3.92%。他们面临着如何保留高级技术人才的挑战。而在实施了DevOps实践之后，业务成果好转，新增了两个BBS企业客户。雇员的eNPS增长了400%，人员保有率大于95%，目标市场的业务占用率提高了。&lt;/p>
&lt;p>从2015开始产品经理和DevOps团队开始讨论“团队的精益领导力组合”，定义了组织级别的愿景：“将工作可视化，把我们的人员和策略链接在一起，驱动参与度、价值和兴奋度。”&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_11-59-38.jpg"
loading="lazy"
alt="2019-03-07_11-59-38"
>&lt;/p>
&lt;p>所谓的精益领导力组合如下图所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_12-02-46.jpg"
loading="lazy"
alt="2019-03-07_12-02-46"
>&lt;/p>
&lt;p>主要有三部分组成：&lt;/p>
&lt;ol>
&lt;li>组合管理&lt;/li>
&lt;li>发布管理&lt;/li>
&lt;li>转型赋能&lt;/li>
&lt;/ol>
&lt;p>回顾一下CSG过去的三年，主要经历了6里程碑。
&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-18-48.jpg"
loading="lazy"
alt="2019-03-07_14-18-48"
>&lt;/p>
&lt;h3 id="1-服务请求管理">1 服务请求管理
&lt;/h3>&lt;p>从梳理服务目录开始，将100多种IT服务梳理在一个服务目录中，需要这些服务的人通过服务请求并获得服务。以前这些服务工作交付所付出的大量运维性劳动是无法可视化和计量的。通过服务目录的不断完善，以前不可见的运维工作都可以察觉到，并可以计量和统计。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_12-11-29.jpg"
loading="lazy"
alt="2019-03-07_12-11-29"
>&lt;/p>
&lt;p>到2018年为止，统计数据表明：&lt;/p>
&lt;ul>
&lt;li>服务目录管理的服务条目数量是 620 个&lt;/li>
&lt;li>从服务目录创建并完成的服务请求单数量是 53000+ 个&lt;/li>
&lt;li>使用同一个服务目录增加了工作的可视化程度，并且还具有潜在的成长空间&lt;/li>
&lt;li>服务目录请求站点的访问量达到了 75000+ 次&lt;/li>
&lt;/ul>
&lt;p>服务目录的实施结果是可以被统计的，将这些数据呈现给了领导层团队；领导层随后决定增加了这些方面的投资，从而优化和消除了大量可重复的工作。这个阶段的成果也是非常突出的。举两个简单的例子如下：&lt;/p>
&lt;ol>
&lt;li>自动化了一个非常耗时的服务，该项服务每年需要消耗5000+人工时，这几乎是3个专职工程师一年的工作量。&lt;/li>
&lt;li>优化了一个通常需要耗时10天才能完成的服务，后来该项服务现可以在请求的当天就得以满足。&lt;/li>
&lt;/ol>
&lt;p>随着以上成果的逐渐扩大化，服务请求方和交付方都更加愿意和领导团队接触，并参与到等多的提议和计划中。这些成果足以值得让团队兴奋起来，下图是史诗一号团队在举行团建活动，以此来庆祝第一步的成功。【注：想获取兴奋度就喝起来！】&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_12-16-40.jpg"
loading="lazy"
alt="2019-03-07_12-16-40"
>&lt;/p>
&lt;h3 id="2-建立技术和产品组合规划室---tam-room">2 建立技术和产品组合规划室 - TAM Room
&lt;/h3>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_12-57-06.jpg"
loading="lazy"
alt="2019-03-07_12-57-06"
>&lt;/p>
&lt;p>为了让项目执行过程和项目中的工作内容都更加可视化，建立了“技术和产品组合规划室”。在这个房间的墙上设立大型工作看板，将不同类型的工作用不同的颜色表示。这面墙展示了所有团队当前的工作内容，是产品和项目级别管理的全貌，任何事情如果不在这面墙上，团队不会对它耗费一秒钟。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_12-57-20.jpg"
loading="lazy"
alt="2019-03-07_12-57-20"
>&lt;/p>
&lt;ul>
&lt;li>蓝色： 安全相关&lt;/li>
&lt;li>红色：客户相关&lt;/li>
&lt;li>黄色：云计算相关&lt;/li>
&lt;li>绿色：技术相关&lt;/li>
&lt;li>橙色：项目管理&lt;/li>
&lt;/ul>
&lt;p>这些是史诗级别的工作，是经过客户优先级排序的工作。 接下来构建了十六个团队的团队级别看板，团队会把这些实施工作拿走到他们自己的看板上。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_13-01-47.jpg"
loading="lazy"
alt="2019-03-07_13-01-47"
>&lt;/p>
&lt;p>当团队工作在这个看板上之后，团队可以很好的处理计划外工作。如果有什么经理人员向团队提出其它工作的时候，团队可以回答“Yes”；然后请他看看当前的工作状态，说出可能的选项是什么？【注：讨论的结果很可能是，用Yes婉拒了计划外工作，或者请工作提出者交换他的进行中的工作。】&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_13-08-31.jpg"
loading="lazy"
alt="2019-03-07_13-08-31"
>&lt;/p>
&lt;p>TAP Room还是每个一个项目周期结束时，大家一起做回顾的场所，房间里提供了汉堡和热狗等午餐，团队成员用午餐会的形式交流各自的收获和想法。&lt;/p>
&lt;h3 id="3-向全员推广并提升参与度---各种坛子">3 向全员推广，并提升参与度 - 各种坛子
&lt;/h3>&lt;p>如何将以上的成功经验传播到整个组织里，如何让更多的人参与其中，并提升全员的参与度。CSG创建了各种坛子的想法。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_13-15-03.jpg"
loading="lazy"
alt="2019-03-07_13-15-03"
>&lt;/p>
&lt;p>每个坛子都有各自的负责人和执行周期。如Shark Tank是两周进行一次，如果任何人对产品和技术有谏言建议都会发到这里，负责人会统一收集和用不同的优先级排序。&lt;/p>
&lt;ul>
&lt;li>Shark Tank 组织战略级别的，由VP们管理&lt;/li>
&lt;li>Think Tank 产品组合级别的，由产品经理/负责人管理&lt;/li>
&lt;li>DO Tank Scrum团队级别，由团队的负责人管理&lt;/li>
&lt;/ul>
&lt;p>上面一行的三个坛子是把组织级别的业务战略直接贯彻和对齐到底（Engineer）方式，当然任何人也可以在各个层面上提出反馈建议，并实现了每个人的参与度的从下而上的反馈回路。&lt;/p>
&lt;p>下面一行的三个坛子和他们的组织架构相关，也分别有各种独立的定义和用法，所有坛子都是两周执行一次回顾和处理。&lt;/p>
&lt;h3 id="4-倡导价值驱动和交付">4 倡导价值驱动和交付
&lt;/h3>&lt;p>在这个阶段中，CSG不想仅仅止步于成功经验的传播和反馈，希望让更多人知道能从哪里，获得他们需要的信息和帮助，从而复制那些在组织级别已经取得成功的套路。&lt;/p>
&lt;p>CSG制作了视频短片，用阶段性回顾的方式，总结了他们所谓的参与度、有趣、有价值和有意义等概念，希望人多人能加入到史诗团队中。让人们觉得是和公司息息相关的。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_13-33-37.jpg"
loading="lazy"
alt="2019-03-07_13-33-37"
>&lt;/p>
&lt;p>这个短片用产品周报发布的全公司，根据数据统计显示，有大约500人在发布的当天从头看到尾。使所有人都参与到价值交付中，并感受到激动。&lt;/p>
&lt;h3 id="5-产能洞察管理---capacity-insights">5 产能洞察管理 - Capacity Insights
&lt;/h3>&lt;p>CSG也和其它所有公司一样，每个团队都很忙，项目经理和交付的工程师团队也存在在感受不一致的情况。如下高压力对话也很常见。&lt;/p>
&lt;ul>
&lt;li>你们能做更多工作么？&lt;/li>
&lt;li>不能！&lt;/li>
&lt;li>怎么会啊！&lt;/li>
&lt;li>我们很忙！&lt;/li>
&lt;li>给我一个忙的证据！&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_13-52-11.jpg"
loading="lazy"
alt="2019-03-07_13-52-11"
>&lt;/p>
&lt;p>产能管理工具（Capacity Insights）的出现缓解了这个问题，首先，CSG把计划内的工作输入到这个工具里，并进行工作量的跟踪和记录。同时还把计划外的工作也纳入这个系统，进行统一的跟踪和记录。这里的数据在项目、产品和团队级别上被透明的分享和沟通，从此团队的高压力对话现象得到了大幅度的缓解，大家更有意愿进行合作了。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_13-53-16.jpg"
loading="lazy"
alt="2019-03-07_13-53-16"
>&lt;/p>
&lt;p>这些数据可以按照各种价值流的维度将耗费的工作时间（计划和实用）统计出来，并按照产品、团队和技术技能等各种维度进行钻去和统计。这样就可以把宝贵的产能合理的使用，实现了好钢用在刀刃上。&lt;/p>
&lt;h3 id="6-生活和工作平衡">6 生活和工作平衡
&lt;/h3>&lt;p>CSG不希望工程师团队周末加班，当然一周工作时间超长的情况也很常见，CSG希望他们能过上正常人的生活。领导层关注到这个问题后，开始实施一些措施。建立了产品迭代回顾的画廊，如下图所示。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-05-09.jpg"
loading="lazy"
alt="2019-03-07_14-05-09"
>&lt;/p>
&lt;p>在这个画廊上关注着一些数据的状态。&lt;/p>
&lt;ul>
&lt;li>31个团队的总工作时间是15000小时&lt;/li>
&lt;li>削减了25%的值守加班时间&lt;/li>
&lt;li>削减了100%的测试数据配置工作，用自动化的方法削减了相当于3个全职工程师的工作量&lt;/li>
&lt;li>用自动化的方式消除了某个业务流程确认环节90%的时间&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-14-16.jpg"
loading="lazy"
alt="2019-03-07_14-14-16"
>&lt;/p>
&lt;p>CSG的成功秘诀是人，这都仰仗于赋能的员工：开放、分享、参与和兴奋。&lt;/p>
&lt;h2 id="产品和项目的pk">产品和项目的PK
&lt;/h2>&lt;p>对于这个话题的总结如下。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-21-06.jpg"
loading="lazy"
alt="2019-03-07_14-21-06"
>&lt;/p>
&lt;ul>
&lt;li>部门墙（Queue）有碍于学习进步&lt;/li>
&lt;li>基于项目的团队管理有碍于学习进步&lt;/li>
&lt;li>基于产品的团队才可以精进成长&lt;/li>
&lt;/ul>
&lt;p>CSG公司在2017年以前的工作模式，产品和项目并存。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-25-21.jpg"
loading="lazy"
alt="2019-03-07_14-25-21"
>&lt;/p>
&lt;p>开发团队 - 产品工作&lt;/p>
&lt;ul>
&lt;li>基于业务需求的史诗 （最左侧的）&lt;/li>
&lt;li>基于发布节奏的工作&lt;/li>
&lt;li>管理产品代办工作&amp;amp;排序&lt;/li>
&lt;li>交付工作完成的解决方案&lt;/li>
&lt;/ul>
&lt;p>运维团队 - 项目工作&lt;/p>
&lt;ul>
&lt;li>处理临时、非计划的发布工作&lt;/li>
&lt;li>被各种会议驱动和中断&lt;/li>
&lt;li>接受研发发布过来的解决方案（临时和计划的）&lt;/li>
&lt;li>同时处理各种基础设施的IT项目（最右侧的）&lt;/li>
&lt;/ul>
&lt;p>当两者的工作节奏交织在一起的时候，就会产生各种冲突。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-32-34.jpg"
loading="lazy"
alt="2019-03-07_14-32-34"
>&lt;/p>
&lt;p>出现了各种明显的问题：&lt;/p>
&lt;ul>
&lt;li>双向的依赖关系&lt;/li>
&lt;li>多个任务工作时间计划相互撞车&lt;/li>
&lt;li>缺乏统一的依赖管理和产能规划，这进一步产生了大量进行中工作（WIP）&lt;/li>
&lt;li>项目制的工作模式导致研发在迫于发布周期的情况下，交付了质量很低的解决方案&lt;/li>
&lt;/ul>
&lt;p>CSG随后进行了基于价值流的产品条线的聚焦，将开发和运维团队的代办工作事项都整合到了统一的单独入口，从而进行统一的管理。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-40-40.jpg"
loading="lazy"
alt="2019-03-07_14-40-40"
>&lt;/p>
&lt;ul>
&lt;li>单一的工作入口管理可以更好的在统一的时间轴上进行优先级排序管理，并且能够实现所有工作的可视化和排序。&lt;/li>
&lt;li>设置不同的发布节奏，从2周到12周不等，还有特性的按需发布&lt;/li>
&lt;li>根据完成度、业务需求和耦合程度，不同工作任务选取不同的发布节奏&lt;/li>
&lt;li>进行工程上的重构：自动化、架构和运维即服务模式&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-46-45.jpg"
loading="lazy"
alt="2019-03-07_14-46-45"
>&lt;/p>
&lt;p>完全参考和接受了ThoughtWorks技术雷达提出的：应用产品管理的方式到内部平台。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-47-58.jpg"
loading="lazy"
alt="2019-03-07_14-47-58"
>&lt;/p>
&lt;p>运维团队的人也将IT工作转为产品交付的方式，指定专人专家管理内部的平台。安全运维被视为工程和产品问题，通过重构的工程方法优化平台。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_14-53-24.jpg"
loading="lazy"
alt="2019-03-07_14-53-24"
>&lt;/p>
&lt;p>基于产品/服务价值流交付的管理方式是多个迭代，往复循环的迭代，而不会是简单的停止于测试完毕的验收发布。&lt;/p>
&lt;p>配置管理、服务请求变更管理、遥测、监控管理、安全、事件问题管理和相应都是产品管理的一部分，这些运行态的工作是产品生命周期中不可或缺的。也不应该被其它孤立的外部团操作。&lt;/p>
&lt;p>因此服务持续性管理也变成为一种内置的持续的动作，而不是这个流程之外的独立事件。&lt;/p>
&lt;p>CSG提倡：运维是工程和产品的问题，在本图中也得到体现，运维工作是产品的运行时管理工作，也是包括在持续的产品开发迭代中，最好有一个统一的持久的团队负责。&lt;/p>
&lt;p>CSG举例说明了”运维是工程和产品的问题“；CSG的业务系统需要处理信用卡信息，因此需要满足PCI的合规需求。在这个业务需求的驱动下，运维团队花费了无数的安全审计时间（20000+小时）去满足合规的标准。在产品驱动的思维下，运维团队和安全专家合作开发了，实现PCI合规的配置管理工具。这些安全管理工具是基于Chef开发的，也在Chef的开发者大会上分享过，而且现在是一个开源的产品，任何人都可以下载使用。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_15-06-49.jpg"
loading="lazy"
alt="2019-03-07_15-06-49"
>&lt;/p>
&lt;p>通过以下的对比发现CSG在这个思维转型了以后所得到的收益。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_15-09-19.jpg"
loading="lazy"
alt="2019-03-07_15-09-19"
>&lt;/p>
&lt;p>CSG在跨价值流的工作可视化管理方面也取得了一定的收益。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_15-14-10.jpg"
loading="lazy"
alt="2019-03-07_15-14-10"
>&lt;/p>
&lt;p>以前各种不同工作分类的工作内容，上图每种颜色的方框就是一个分类，每个分类的工作都有各自不同的跟踪管理系统（工单系统）。在这种情况下如果跨价值流分析相关的工作内容，则非常困难，要依赖大量的手工统计和集成工作。统一的工作可视化无法实现。因此CSG使用Jira来统一管理和跟踪以上各种工作，从而得到准确和实时的视图。&lt;/p>
&lt;h2 id="2019年的目标">2019年的目标
&lt;/h2>&lt;p>CSG的2019年DevOps的发展目标和举措也很值得参考。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/2019-03-07_15-22-01.jpg"
loading="lazy"
alt="2019-03-07_15-22-01"
>&lt;/p>
&lt;ul>
&lt;li>Impact Minutes 服务受影响的时间 ： 4700分钟，实现年同步增长50%；计划实施系统的强壮性工程，落实人的可恢复性&lt;/li>
&lt;li>Release on Demond 按需发布 ： 希望最终是消除发布这个环节，或者是高于70%的按需发布比例；计划实施的举措是重构架构、自动化、解耦。&lt;/li>
&lt;li>eNPS 员工推荐率 ： 提升这个比例；计划实施的举措有精益领导力组合，链接到每个人，工作生活平衡。&lt;/li>
&lt;/ul></description></item><item><title>成熟度模型已死</title><link>https://martinliu.cn/blog/maturity-is-dead/</link><pubDate>Wed, 27 Jun 2018 21:34:04 +0800</pubDate><guid>https://martinliu.cn/blog/maturity-is-dead/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/v1549271017/Anubis-Background-Download-Free.jpg" alt="Featured image of post 成熟度模型已死" />&lt;p>上一篇文章重要观点回顾：&lt;/p>
&lt;ul>
&lt;li>应用DevOps的企业不应该使用成熟度模型度量&lt;/li>
&lt;li>应用DevOps的不同企业/部门不会参考某个所谓标准&lt;/li>
&lt;li>应用DevOps的不同企业/部门应该参考5大类24项的能力成长模型，来度量其发展进度，在磨练这些能力的过程中，选择符合自身业务需求的，且优先级别高能力先发展。&lt;/li>
&lt;/ul>
&lt;h2 id="成熟度模型已死">成熟度模型已死
&lt;/h2>&lt;p>这个模型在各行各业都可能存在，而且可能是最容易被人接受的模型之一。对于很多新生的领域，如法炮制的套用这个模型合适么？无论合适与否，它还是会出现在DevOps的领域中。为了避免实践者试错，我们不得来分析一下这种模型的特点。&lt;/p>
&lt;h3 id="特征1">特征1
&lt;/h3>&lt;p>它总是阶梯式的，而且从来都是5个等级，人们经常戏称为Golden 5。常见的5级成熟度模型有下列几种。&lt;/p>
&lt;p>&lt;em>CMMI 能力成熟度模型集成&lt;/em>&lt;/p>
&lt;p>&lt;img src="https://pic.baike.soso.com/p/20131203/20131203141932-427475281.jpg"
loading="lazy"
alt="CMMI"
>&lt;/p>
&lt;p>&lt;em>ITIL/ITSM的成熟度模型&lt;/em>&lt;/p>
&lt;p>&lt;img src="http://www.jp1.cn/image/h1/2_200644102151993.jpg"
loading="lazy"
alt="ITIL"
>&lt;/p>
&lt;p>&lt;em>IT与业务融合的成熟度&lt;/em> &lt;a class="link" href="http://www.cio.com.cn/eyan/1431.html" target="_blank" rel="noopener"
>http://www.cio.com.cn/eyan/1431.html&lt;/a>&lt;/p>
&lt;p>&lt;img src="http://www.cio.com.cn/source/attachments/image/20120417/20120417164221_20236.jpg"
loading="lazy"
alt="ITIL"
>&lt;/p>
&lt;p>&lt;em>德勤网络安全合规成熟度示意图&lt;/em>&lt;/p>
&lt;p>&lt;img src="https://www2.deloitte.com/content/dam/Deloitte/cn/Images/inline_images/serv-risk/cn-ra-cyberrisk-compliance-model-3.jpg/_jcr_content/renditions/cq5dam.web.700.350.desktop.jpeg"
loading="lazy"
alt="网络安全合规"
>&lt;/p>
&lt;p>&lt;em>持续交付流程成熟度&lt;/em>&lt;/p>
&lt;p>&lt;img src="http://www.ibm.com/developerworks/cn/rational/1402_zhaojing_urbancode1/image011.jpg"
loading="lazy"
alt="CD"
>&lt;/p>
&lt;p>如果你百度“成熟度模型”，还可以轻易地找到很多类似模型。客观的讲，这个模型是被广泛应用的神五级。&lt;/p>
&lt;p>这个模型对于任何使用的组织来说都是统一的，不会说对于有些企业是8级的，对于另外一些企业是10级的。&lt;/p>
&lt;p>这种模型的另外一个代名词是“XXX标准”，或者“XX行业标准”。&lt;/p>
&lt;h3 id="特征2">特征2
&lt;/h3>&lt;p>通常对于每个等级上还可以定义出3到7个不同的维度。维度的数量少则3个级别，多字7到10个维度；可以要在每一个级别的不同维度上进行评价。这些维度一旦确定下来，也通常是十年如一日的静止不变。&lt;/p>
&lt;p>只是一种纵横交叉的矩阵的模式，如以上的持续交付流程成熟度、德勤网络安全合规成熟度示意图和IT与业务融合的成熟度都是这样。&lt;/p>
&lt;p>维度和等级往往都是静态的，通常模型发布之后，在很长一段时间里，不会发生改变。&lt;/p>
&lt;h3 id="特征3">特征3
&lt;/h3>&lt;p>这些模型对于不同的组织而言，组织的目标都是一致而单纯的，即“通过/到达”某个级别。请你回忆一下以前的经历。一个软件开发组织经过一年的奋斗，他们通过了CMMI3级认证；第二年的时候，项目组一狠心，一跺脚一次性通过了5级认证。请问他们为什么一定要在第二年通过5级？在第三年里，相比以前，软件开发的质量提高了么？在第四年，有没有可能出现倒退的现象？如果你回答不了这些问题的话，可以尝试请教一个更资深一些的，工作10年以上的朋友或者同事。&lt;/p>
&lt;h2 id="成熟度模型的局限性">成熟度模型的局限性
&lt;/h2>&lt;p>根据以上的三个主要特征，这种模型的局限性大概有以下几个方面：&lt;/p>
&lt;p>每一个企业的自身条件、业务环境、资源约束都是不同的。让他们都对标一个统一的静态成熟度模型是不合适的。这就像是目前某些国家的教育体制一样。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload//3-levels.jpeg"
loading="lazy"
alt="3levels"
>&lt;/p>
&lt;p>IT行业每天都在发生着巨大的变化，这就是我么经常提到的乌卡时代，今年流行的技术，很快就会过时，明年也将出现新的、未知的技术领域。很多行业的特点就是，在不断反复的被颠覆。而这些成熟度模型通常是永恒不变的。&lt;/p>
&lt;p>成熟度模型通常是在微观上进行考察，对很多考察点做孤立的分析和评测。这样做只能度量到技术、工具或者流程本身的一些方面。而忽视了组织通过它们所获得的总体成果产出。举个例子一个企业在通过了CMMI5级之后，发现收入/利润比以前还下降了；解释CMMI到达顶级的企业，业务收入还退步了，这本来就是一件比较尴尬的事情。&lt;/p>
&lt;p>如果一个集团企业，在所有IT组织/部门中强推某种成熟度模型的话，还有可能出现停滞不前的博弈现象。某些组织可能会宁愿待在中间的某个不成熟等级，并不愿意快速的提升到最高等级。那样的话，他们将失去每年一定数量的，用于提高成熟度等级的资源和预算。从最大化局部利益的角度考虑，最高级的成熟度可能等于最低级的资源支持。&lt;/p>
&lt;p>最后，无论到达了那个等级的成熟度，这种明确而清晰的满足感，滋生出了锚定效应。这其实阻碍了组织持续的探索和尝试未知领域，组织因此学习的知识就会越来越少。甚至于出现能力的下滑和倒退。&lt;/p>
&lt;p>综上所述，在DevOps的领域里，成熟度模型和统一标准已经过时了，它不适合用于DevOps的度量；而且，纵观整个行业，国际上目前还没有那一个适用的DevOps成熟度模型被应用于任何组织。那么还有什么其他DevOps适用的模型？&lt;/p>
&lt;h2 id="devops能力成长模型">DevOps能力成长模型
&lt;/h2>&lt;p>这个模型是在《Accelerate-加速器》这本书里被提出的。相信大家对Nicole博士联合Puppet Lab发起的DevOps状态调查和年度报告并不陌生。这本书分析了DevOps状态报告四年的历史数据，书里所展示的内容，其实也正好是作者Nicole Forsgren博士对DevOps现状调研的第一个迭代的阶段性成果。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Accelerate.jpg"
loading="lazy"
alt="模型"
>&lt;/p>
&lt;p>这本书的目标是解密高效能组织的高明之处，以及背后的原因。从探寻影响组织绩效的因素为起点，经过了四年的不断调研，Nicole博士向我们展示了一个相对比较完整的，各种影响因素的关系网。特别说明的是：下图来自于《加速器》这本书，这个形态是经过4年演进出来的，我们无法猜测2018年Nicole博士究竟怎样地拓展了调研的范围；更无法猜测的是：在2018年的状态报告结果中，这幅图会变成什么样子？&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/devops-cap-mod.jpg"
loading="lazy"
alt="开始"
>&lt;/p>
&lt;p>Nicole博士总结出了DevOps能力的5大分类，包含的能力点有24项。&lt;/p>
&lt;h3 id="第一类持续交付">第一类：持续交付
&lt;/h3>&lt;ol>
&lt;li>对生产环境的所有工件进行版本控制&lt;/li>
&lt;li>运用自动化部署流程&lt;/li>
&lt;li>实施持续集成&lt;/li>
&lt;li>运用基于主干的开发方法&lt;/li>
&lt;li>实施测试自动化&lt;/li>
&lt;li>进行测试数据管理&lt;/li>
&lt;li>前置信息安全管理&lt;/li>
&lt;li>实施持续交付&lt;/li>
&lt;/ol>
&lt;h3 id="第二类系统架构">第二类：系统架构
&lt;/h3>&lt;ol>
&lt;li>应用松耦合的架构设计&lt;/li>
&lt;li>授权团队进行架构重构的决策&lt;/li>
&lt;/ol>
&lt;h3 id="第三类产品和流程">第三类：产品和流程
&lt;/h3>&lt;ol>
&lt;li>收集和实施客户反馈&lt;/li>
&lt;li>运用价值流模式可视化工作流&lt;/li>
&lt;li>运用小批量的工作模式&lt;/li>
&lt;li>培养和赋能团队进行试验&lt;/li>
&lt;/ol>
&lt;h3 id="第四类精益管理和监控">第四类：精益管理和监控
&lt;/h3>&lt;ol>
&lt;li>应用轻量变更审批流程&lt;/li>
&lt;li>业务决策得到从应用到基础架构的全堆栈支持&lt;/li>
&lt;li>前瞻性地监控系统的状况&lt;/li>
&lt;li>应用WIP来进行价值流的工作管理&lt;/li>
&lt;li>通过可视化来监控团队工作质量和进行沟通&lt;/li>
&lt;/ol>
&lt;h3 id="第五类企业文化">第五类：企业文化
&lt;/h3>&lt;ol>
&lt;li>发展并支持生机型企业文化&lt;/li>
&lt;li>鼓励和支持学习&lt;/li>
&lt;li>支持和辅助团队间的协作&lt;/li>
&lt;li>提供工作所需要的资源和工具&lt;/li>
&lt;li>支持和落实领导力转型&lt;/li>
&lt;/ol>
&lt;h2 id="devops能力成长模型的特点">DevOps能力成长模型的特点
&lt;/h2>&lt;p>首先，这个模型是基于4年以上的、科学的调查分析而来的。Nicole博士和全球最顶尖的DevOps公司，以及各种业内大咖，历经了多年的协作。其次，此模型是演变出来的，而且一定会持续更新。最后，分析一下这个模型的特点。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/devops-cap-mod1.jpg"
loading="lazy"
alt="模型"
>&lt;/p>
&lt;ul>
&lt;li>它目标是适用于能力和起点本来就参差不齐的不同的组织/团队。&lt;/li>
&lt;li>它适用于每个团队在能力上优劣各不相同的情况。而且每个团队的业务使命和向下文也不相同。&lt;/li>
&lt;li>它使每个团队聚焦在各自不同的能力点上，发展和解决各不相同的约束点/弱点。&lt;/li>
&lt;li>以上能力模型来上游调查数据就是一个行业基线（基线也在不断变化中），不同的团队参考每一项能力的行业基线定义各自的下一步的发展目标。&lt;/li>
&lt;/ul>
&lt;h2 id="建议的度量套路">建议的度量套路
&lt;/h2>&lt;p>可以将DevOps能力成长模型作为企业应用DevOps的一个有效的度量工具。通过持续的度量，现状分析和改进，让DevOps的优化全局价值产出的特性加速企业客户价值的增长。这里简单描述一下建议的套路&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/outcome1.jpg"
loading="lazy"
alt="模型"
>&lt;/p>
&lt;ul>
&lt;li>度量关键产出：这些指标是衡量你的团队软件交付的好坏与否的一个高阶的度量。相关指标有：IT效能、前置时间、部署频率、MTTR、变更失败率、加班程度和部署痛点。&lt;/li>
&lt;li>能力驱动的改进：这些能力是你提升关键产出的抓手。由于你提高了一些能力，你在这些能力得到提升的同时，还能更快且可靠的交付软件。&lt;/li>
&lt;li>按优先级改进：通过能力模型的评估，你识别出了那些能力约束点/瓶颈，是它们在阻止你达到更高的技术阶段，然后确定那些能力需要先优先发展。&lt;/li>
&lt;/ul></description></item><item><title>参与2018年DevOps状态调查报告</title><link>https://martinliu.cn/blog/2018-devops-survey/</link><pubDate>Wed, 27 Jun 2018 00:09:21 +0800</pubDate><guid>https://martinliu.cn/blog/2018-devops-survey/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/abstract-6.jpg" alt="Featured image of post 参与2018年DevOps状态调查报告" />&lt;p>听说这里有一个15分钟就能完成的DevOps调查问卷，有25位参与者或将得到总值为3200美元的亚马逊购物券。一年也就是这一次机会。问卷调查将在10天后就关闭。&lt;/p>
&lt;p>这是DevOps状态报告调查问卷的第七年。在过去的6年里，已经有两万七千多人参与了这项调查。这项调查已经获得了丰硕的成果，主要是帮助你了解在DevOps之旅上当前的进展。今年又扩展了调查的范围，再度加深了对DevOps之旅的调研。&lt;/p>
&lt;p>我已经帮你把问题的套路摸清楚了，其实问题都很清晰直白，很容易和你所在企业的DevOps状态做匹配。填写问卷调查也是一个学习的过程，可以用开放的心态去了解一下，调查报告对DevOps的观察角度都有哪些？&lt;/p>
&lt;p>对其中的部分问题做出了简要的说明，预祝你在参加这项全球性著名调查的过程中，有一个愉快的体验。&lt;/p>
&lt;h2 id="今年的看点">今年的看点
&lt;/h2>&lt;p>据说DevOps状态调查报告的一个最大的价值就是：在你的组织中，你可以用这些数据展示出DevOps的价值，从而取得管理层的支持，并启动DevOps项目。&lt;/p>
&lt;p>在今年的调查研究工作中，新加入的，对在企业中应用和推广DevOps有深度洞察的专家包括：&lt;/p>
&lt;ul>
&lt;li>Andi Mann, the chief technology advocate at Splunk and co-author of Visible Ops – Private Cloud and and The Innovative CIO.&lt;/li>
&lt;li>Michael Stahnke, a director of engineering at Puppet and the author of Pro OpenSSH.&lt;/li>
&lt;li>Alanna Brown, the director of product marketing at Puppet and creator of the first State of DevOps Report in 2013.&lt;/li>
&lt;/ul>
&lt;p>参加这项问卷调查将有25人会得到亚马逊购物券，价值 $100, $200 或 $500 ； 抽奖说明：&lt;/p>
&lt;ol>
&lt;li>$500 2 人&lt;/li>
&lt;li>$200 8 人&lt;/li>
&lt;li>$100 15 人&lt;/li>
&lt;/ol>
&lt;p>注：规则完整版 &lt;a class="link" href="https://puppet.com/2018-devops-survey-contest-rules" target="_blank" rel="noopener"
>https://puppet.com/2018-devops-survey-contest-rules&lt;/a>&lt;/p>
&lt;h2 id="参与此项调研报告">参与此项调研报告
&lt;/h2>&lt;p>每道问题选择了答案之后，会影响到后续所出现的问题，我选择了金融（含保险）行业的DevOps软件工程师的路径。&lt;/p>
&lt;p>这个调查的问题库非常强大，每一个问题的回答都在影响下一个问题的范围。有些问题是情景设定和分析题，会预设一个阶段（有可能是你还未达到的），在这种情况里作出你的判断和选择。&lt;/p>
&lt;p>翻墙之后网页刷新速度会更快一些。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/survery.jpg"
loading="lazy"
alt="开始"
>&lt;/p>
&lt;h3 id="第一部分">第一部分
&lt;/h3>&lt;ol>
&lt;li>Where do you work? / 你在那个大洲工作？&lt;/li>
&lt;li>In which country do you work? / 在那个国家工作？&lt;/li>
&lt;li>What is the principal industry of your organization? / 你的组织是什么行业的？&lt;/li>
&lt;li>Which of the following best describes your title or role in your company? / 下面的各种头衔/角色那个和你最匹配？&lt;/li>
&lt;li>What department do you work in? / 你什么部门工作？&lt;/li>
&lt;li>And what team do you work on? / 你在什么团队工作？&lt;/li>
&lt;li>Which of the following describes your level of knowledge regarding your organization’s IT operations and software delivery? / 下面那一项最准确地描述了你的组织在IT运维和软件交付方面的知识程度？&lt;/li>
&lt;/ol>
&lt;h3 id="第二部分">第二部分
&lt;/h3>&lt;p>Many people say that there are four elements of DevOps that work together as enterprises evolve. They are:&lt;/p>
&lt;ul>
&lt;li>Culture 文化&lt;/li>
&lt;li>Automation 自动化&lt;/li>
&lt;li>Measurement 度量&lt;/li>
&lt;li>Sharing 分享&lt;/li>
&lt;/ul>
&lt;p>The next few questions will ask about each of these elements.&lt;/p>
&lt;p>这部分是对企业的CAMS调查的。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Where would you say you are at culture-wise, on your DevOps journey so far? / 在你目前的DevOps旅程中，DevOps文化存在于怎样的范围里？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Where would you say you are at automation-wise, on your DevOps journey so far? / 在你目前的DevOps旅程中，自动化的程度是怎样的？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Where would you say you are at measurement-wise, on your DevOps journey so far? Please select all that apply. / 在你目前的DevOps旅程中，在那些方面实施了度量？- 多选&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Where would you say you are at sharing-wise, on your DevOps journey so far? / 在你目前的DevOps旅程中，在分享方面是怎么做的？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>How frequently do each of these practices occur in your organization? / 下列实践在你的组织中发生的频率？从来没用过 ~ 总是在用 5级&lt;/p>
&lt;ul>
&lt;li>We balance lowering technical debt, with new feature work&lt;/li>
&lt;li>Configurations are managed by a configuration management tool&lt;/li>
&lt;li>A cross-functional review is done before implementation of a project&lt;/li>
&lt;li>Teams use continuous delivery&lt;/li>
&lt;li>Before starting a project, we establish concrete success criteria&lt;/li>
&lt;li>We create learning opportunities across teams (e.g., training, internal DevOps workshops, etc.)&lt;/li>
&lt;li>We expose data and services via APIs&lt;/li>
&lt;li>Success metrics for projects are visible&lt;/li>
&lt;li>DevOps initiatives are supported by senior leadership&lt;/li>
&lt;li>Teams use agile approaches across development and operations&lt;/li>
&lt;li>Developers are on-call for production issues&lt;/li>
&lt;li>Teams use continuous integration&lt;/li>
&lt;li>Source code is made available to other teams&lt;/li>
&lt;li>Experiences and lessons are shared externally (e.g., meetups / conferences, blog posts, etc.)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>How frequently were each of these practices used when you were first starting out with DevOps? / 在你的DevOps刚刚起步的阶段，下列实践的使用频率是怎样的？从来没用过 ~ 总是在用 5级&lt;/p>
&lt;ul>
&lt;li>Application configurations are in version control&lt;/li>
&lt;li>Infrastructure teams use version control&lt;/li>
&lt;li>Automate system configurations (e.g. operating system baselines)&lt;/li>
&lt;li>System configurations are in version control&lt;/li>
&lt;li>Automate provisioning (e.g. server, VM, cloud instances, etc.)&lt;/li>
&lt;li>Application development teams use version control&lt;/li>
&lt;li>Automate security policy configurations&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>How frequently were these practices used after you started to see some traction with DevOps? / 在你开始感受到DevOps的优势以后，下列实践的使用频率是怎样的？从来没用过 ~ 总是在用&lt;/p>
&lt;ul>
&lt;li>We reuse deployment patterns for building applications or services&lt;/li>
&lt;li>Monitoring and alerting are configurable by the team operating the service&lt;/li>
&lt;li>We deploy on a single standardized operating system&lt;/li>
&lt;li>We deploy on a set of standardized operating systems&lt;/li>
&lt;li>We build on a standardized set of technologies&lt;/li>
&lt;li>Configurations are managed by a configuration management tool&lt;/li>
&lt;li>We reuse testing patterns for building applications or services&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>How frequently were the following used while you were expanding DevOps practices? / 在你推广DevOps实践的过程中，下列实践的使用频率是怎样的？从来没用过 ~ 总是在用 5级&lt;/p>
&lt;ul>
&lt;li>We have post-incident reviews and share results&lt;/li>
&lt;li>Security teams are involved in technology design and deployment&lt;/li>
&lt;li>Teams contribute improvements to tooling provided by other teams&lt;/li>
&lt;li>We reuse testing patterns for building applications or services&lt;/li>
&lt;li>Individuals can do their work without manual approval from outside of their team&lt;/li>
&lt;li>We reuse deployment patterns for building applications or services&lt;/li>
&lt;li>Monitoring and alerting are configurable by team operating service&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>How frequently were these practices used while you were optimizing your DevOps practices? / 当你在优化DevOps实践的过程中，下列实践的使用频率是怎样的？从来没用过 ~ 总是在用 5级&lt;/p>
&lt;ul>
&lt;li>Infrastructure changes are tested before deploying to production&lt;/li>
&lt;li>Rearchitect applications based on business needs (e.g., reducing operational costs, ease of deployment, etc.)&lt;/li>
&lt;li>Individuals accomplish changes without significant wait times&lt;/li>
&lt;li>Monitoring and alerting are configurable by team operating service&lt;/li>
&lt;li>Teams contribute improvements to tooling provided by other teams&lt;/li>
&lt;li>Service changes can be made during business hours&lt;/li>
&lt;li>Incident responses are automated&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>How frequently were these practices used while you were enabling self-service? / 在你管理自助服务的情况下，下列实践的使用频率是怎样的？从来没用过 ~ 总是在用 5级&lt;/p>
&lt;ul>
&lt;li>Teams contribute improvements to tooling provided by other teams&lt;/li>
&lt;li>Resources (e.g., accounts, infrastructure, etc.) made available via self-service&lt;/li>
&lt;li>Logging configuration is deployed with the application or service&lt;/li>
&lt;li>Monitoring and alerting are configurable by team operating service&lt;/li>
&lt;li>App developers deploy testing environments on their own&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Which, if any, of the following processes or tools are “self-service” in your DevOps approach? Please select all that apply. / 在你的DevOps计划中，下列哪些流程或者工具会做成自助服务？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Which of the following organizational structures have you used in your DevOps journey? / 在你DevOps的旅程中，你曾经用过下列哪些组织结构？&lt;/p>
&lt;ul>
&lt;li>Cross-functional teams that are responsible for specific services or applications&lt;/li>
&lt;li>A centralized IT team and multiple application development teams&lt;/li>
&lt;li>A Site Reliability Engineering (SRE) team&lt;/li>
&lt;li>A service provider that provides DevOps capabilities (e.g. builds test environments, provides monitoring, etc.)&lt;/li>
&lt;li>A dedicated DevOps team&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Please tell us what kind of development your organization does. / 你的组织开发各种类型软件的比例是多少？5个问题填写百分比，凑够100&lt;/p>
&lt;ul>
&lt;li>We do custom development for internal users&lt;/li>
&lt;li>We do custom development for COTS (commercial off-the-shelf software)&lt;/li>
&lt;li>We manage COTS (commercial off-the-shelf software (e.g., upgrades)&lt;/li>
&lt;li>We do in-house development of custom applications for external users&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>If you could move the needle on one metric related to DevOps, what would it be? / 如果让你仅仅选择一个度量DevOps的指标，这个指标是什么？ - 描述题&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Just a few more questions to help us categorize your answers. / 下列问题帮助我们对你的组织进行分类。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>What figure best describes your company’s annual revenue in US$ equivalent? / 你们公司的年营业额是多少美元？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>What is the proportion of genders working on your team? / 你所在的团队男女比例？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Please tell us how you identify. / 请问告诉我们你认为自己是什么性别。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>What is your current annual salary in US dollars? / 你的年薪是多少美元？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Do you consider yourself to be part of a visible or invisible minority where you work? / 你认为自己工作是显耀的还是无足轻重（少数派）的？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Please tell us of what minority(ies) you consider yourself to be a member. Please select all that apply. / 请告诉我们你的这种无足轻重是指哪方面？-多选&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Would you like to receive an email with the report link when it is available? / 你是否希望收到这份报告的下载链接？&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="完毕">完毕
&lt;/h3>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/survy.jpg"
loading="lazy"
alt="开始"
>&lt;/p>
&lt;p>本文来源：&lt;a class="link" href="https://puppet.com/blog/introducing-2018-state-devops-survey-new-research-focus" target="_blank" rel="noopener"
>https://puppet.com/blog/introducing-2018-state-devops-survey-new-research-focus&lt;/a>&lt;/p>
&lt;p>调查问卷网址：&lt;a class="link" href="https://polls.onresearch.net/DevOps/blog" target="_blank" rel="noopener"
>https://polls.onresearch.net/DevOps/blog&lt;/a>&lt;/p>
&lt;h2 id="后记">后记
&lt;/h2>&lt;p>DevOps圈子里的人都知道，这项问卷调查在IT行业里的知名度和权威性。它的目的在于：通过持续的研究DevOps在各个企业中应用的状态特征，定量的收集大量行业基础分析数据，这样所有的企业就有了一个可以参照的基线数据。更重要的是，它还将企业的绩效分成了高中低三个等级；对这些数据，用科学的分析方法，总结出了高绩效企业之所以高明的原因，将这些结论/假设/原因还在逐年推演和求证中。因此它形成了最具说服力的一些列结论。这些结论都展示在了历年来的DevOps状态报告中。&lt;/p>
&lt;p>今年 Nicole Forsgren博士，《Accelerate》一书的主要作者，用此书对多年来的DevOps状态分析做了一个总结。此书一出版就高居亚马逊畅销榜榜首，还被誉为DevOps界的科学。这本书为你展示了历年来的状态分析报告是怎么来的？调查的范围和方向是如何演进的？为什么会得出这样的分析结果？&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Accelerate.jpg"
loading="lazy"
alt="开始"
>&lt;/p>
&lt;p>调查报告的分析结果是客观而科学的。而这本书向你展示了这些报告数据背后的How和Why。它提出了一个全新的主题“DevOps能力发展模型”；该书的一些结论也是非常具有颠覆性：&lt;/p>
&lt;ul>
&lt;li>应用DevOps的企业不应该使用成熟度模型度量&lt;/li>
&lt;li>应用DevOps的不同企业/部门不会参考某个共同标准&lt;/li>
&lt;li>应用DevOps的不同企业/部门应该参考5大类24项的能力成长模型，来度量其发展进度，在磨练这些能力的过程中，选择符合自身业务需求的，且优先级别高能力先发展。&lt;/li>
&lt;/ul>
&lt;p>下图是24项能力的分解表：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/nengli.jpg"
loading="lazy"
alt="开始"
>&lt;/p>
&lt;p>我在这本刚发布的时候购买了电子版。在参加5月份的DevOpsDays大会北京站的深度培训“持续交付”课上，遇到了这个培训老师的Jez Humble先生，他也是本书的合著者之一。意外地获赠了一本他的签名实体书。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/my-acceleate.jpg"
loading="lazy"
alt="开始"
>&lt;/p>
&lt;p>在学习了一段时间以后，我总结和归纳了一些内容：关于对DevOps能力发展模型的详细剖析，对24项DevOps主要发展能力之间的关联关系的解读；这些内容将会在8月份上海的DevOpsDays大会上呈现。&lt;/p></description></item><item><title>Kops on Aws</title><link>https://martinliu.cn/blog/kops-on-aws/</link><pubDate>Mon, 02 Apr 2018 00:22:44 +0800</pubDate><guid>https://martinliu.cn/blog/kops-on-aws/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/BingWallpaper-2018-03-17.jpg" alt="Featured image of post Kops on Aws" />&lt;p>kops这种方式是我找到的最佳的，最适合于培训课堂需要的安装方式，当然对有类似需求的人有帮助。&lt;/p>
&lt;h2 id="route53-dns配置">Route53 DNS配置
&lt;/h2>&lt;p>kops需要使用DNS服务，用主机名提供k8s的相关服务访问。配置的注意点：&lt;/p>
&lt;ul>
&lt;li>域名还是有必要有一个的，没有的话注册一个也不贵，以后用着也方便&lt;/li>
&lt;li>建议在aws的Route53里做一个二级域名，例如：k8s.devopscoach.org&lt;/li>
&lt;li>这个二级域名最好是能被正常公网解析的，为了便于直接访问集群里的服务&lt;/li>
&lt;li>用 dig NS k8s.devopscoach.org 可以能正常解析（Mac上是这个命令）&lt;/li>
&lt;/ul>
&lt;p>由于全球的域名同步会需要一些时间，因此可以先做这一步，用到的时候，可能就已经同步好了。&lt;/p>
&lt;p>kops会将所有主机的域名解析都自动化的添加A记录到这里。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/dns.png"
loading="lazy"
alt="kops On aws"
>&lt;/p>
&lt;h2 id="安装工具准备">安装工具准备
&lt;/h2>&lt;p>需要安装的工具包括 kubectl, kops 和 AWS CLI 工具。kops需要调用 AWS CLI来创建所需要的资源。我觉得简单的方法是：在目标的Region里创建一台Amazon AMI的虚拟机，这样AWS CLI就不用装了，而且在云里的话，执行kops的时候，由于有一大堆资源创建更新的api调用，感觉速度比在本机快很多，而且还用担心断网。&lt;/p>
&lt;p>可以启动一台t2.micro规格的Amazon AMI即可，另外需要给这个实例配置如下IAM用户权限，在启动的时候选择合适的IAM Role。&lt;/p>
&lt;ul>
&lt;li>AmazonEC2FullAccess&lt;/li>
&lt;li>AmazonRoute53FullAccess&lt;/li>
&lt;li>AmazonS3FullAccess&lt;/li>
&lt;li>IAMFullAccess&lt;/li>
&lt;li>AmazonVPCFullAccess&lt;/li>
&lt;/ul>
&lt;p>这台虚拟机启动之后，安装kubectl和kops。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">curl&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">LO&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">googleapis&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">release&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">release&lt;/span>&lt;span class="o">/$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">curl&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">storage&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">googleapis&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">release&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">release&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">stable&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">txt&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">amd64&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kubectl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">chmod&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="n">kubectl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">mv&lt;/span> &lt;span class="n">kubectl&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kubectl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">wget&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kubernetes&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kops&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">1.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kops&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">chmod&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="n">kops&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">mv&lt;/span> &lt;span class="n">kops&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">amd64&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kops&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>准备ssh登陆秘钥，用户ssh登录各个ec2实例&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$ ssh-keygen
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generating public/private rsa key pair.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter file in which to save the key (/home/ec2-user/.ssh/id_rsa):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter passphrase (empty for no passphrase):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter same passphrase again:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your identification has been saved in /home/ec2-user/.ssh/id_rsa.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your public key has been saved in /home/ec2-user/.ssh/id_rsa.pub.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The key fingerprint is:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SHA256:oSPZf85vNsC7l9z24umLJs4tQ6qDMCrWfqAVXGYoA34 ec2-user@ip-172-31-27-182
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The key&amp;#39;s randomart image is:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+---[RSA 2048]----+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|o . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|.o . + |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| .+E+ . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| .o o . . |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| + + S. |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| oo . o + |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| .+o.. .o.+ o |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|oo .... .==.O.+. |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">|o ... .o .*@+==+.|
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----[SHA256]-----+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="创建s3-bucket">创建S3 bucket
&lt;/h2>&lt;p>这是用来存储Kubernetes群集的配置信息的，kops在创建、运行、更新和管理它创建的群集过程中，没个Cluster的信息可以保存在bucket的一个目录中。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">ec2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">ip&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">172&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">31&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">27&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">182&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">aws&lt;/span> &lt;span class="n">s3&lt;/span> &lt;span class="n">mb&lt;/span> &lt;span class="n">s3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">clusters&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">devopscoach&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">make_bucket&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">clusters&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">devopscoach&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">ec2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">ip&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">172&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">31&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">27&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">182&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="n">KOPS_STATE_STORE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">s3&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">clusters&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">k8s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">devopscoach&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>创建完成后，将其放入环境变量中待用。&lt;/p>
&lt;p>在集群安装完成之后，bucket里面的文件如下：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/s3.png"
loading="lazy"
alt="kops On aws"
>&lt;/p>
&lt;h2 id="创建kubernetes-cluster">创建Kubernetes Cluster
&lt;/h2>&lt;p>命令行参数如下：&lt;/p>
&lt;ul>
&lt;li>kops create cluster //创建集群&lt;/li>
&lt;li>&amp;ndash;cloud=aws //使用aws&lt;/li>
&lt;li>&amp;ndash;zones=ap-northeast-1a //使用这个指定的zone&lt;/li>
&lt;li>&amp;ndash;name=dev.k8s.devopscoach.org //集群的名字&lt;/li>
&lt;li>&amp;ndash;dns-zone=k8s.devopscoach.org //集群所使用的DNS解析区&lt;/li>
&lt;li>&amp;ndash;dns public //对公可访问&lt;/li>
&lt;/ul>
&lt;p>命令的执行结果如下。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$ kops create cluster --cloud=aws --zones=ap-northeast-1a --name=dev.k8s.devopscoach.org --dns-zone=k8s.devopscoach.org --dns public
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:05:06.003257 30031 create_cluster.go:971] Using SSH public key: /home/ec2-user/.ssh/id_rsa.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:05:07.132058 30031 subnets.go:184] Assigned CIDR 172.20.32.0/19 to subnet ap-northeast-1a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Previewing changes that will be made:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*********************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A new kops version is available: 1.8.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Upgrading is recommended
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">More information: https://github.com/kubernetes/kops/blob/master/permalinks/upgrade_kops.md#1.8.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*********************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:05:12.605297 30031 executor.go:91] Tasks: 0 done / 73 total; 31 can run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:05:13.546597 30031 executor.go:91] Tasks: 31 done / 73 total; 24 can run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----此处删除了n个字符------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPC/dev.k8s.devopscoach.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CIDR 172.20.0.0/16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> EnableDNSHostnames true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> EnableDNSSupport true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Shared false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tags {Name: dev.k8s.devopscoach.org, KubernetesCluster: dev.k8s.devopscoach.org, kubernetes.io/cluster/dev.k8s.devopscoach.org: owned}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPCDHCPOptionsAssociation/dev.k8s.devopscoach.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPC name:dev.k8s.devopscoach.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> DHCPOptions name:dev.k8s.devopscoach.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Must specify --yes to apply changes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cluster configuration has been created.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Suggestions:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * list clusters with: kops get cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * edit this cluster with: kops edit cluster dev.k8s.devopscoach.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * edit your node instance group: kops edit ig --name=dev.k8s.devopscoach.org nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * edit your master instance group: kops edit ig --name=dev.k8s.devopscoach.org master-ap-northeast-1a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Finally configure your cluster with: kops update cluster dev.k8s.devopscoach.org --yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>kops命令列出了所有需要建立的资源清单。而真实的开始资源创建，并搭建和配置Kubernetes集群还需要执行，以上输出中提示的最后一条命令: &lt;code>kops update cluster dev.k8s.devopscoach.org --yes &lt;/code>&lt;/p>
&lt;p>执行结果如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$ kops update cluster dev.k8s.devopscoach.org --yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*********************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A new kops version is available: 1.8.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Upgrading is recommended
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">More information: https://github.com/kubernetes/kops/blob/master/permalinks/upgrade_kops.md#1.8.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*********************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:02.482203 30077 executor.go:91] Tasks: 0 done / 73 total; 31 can run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:04.389402 30077 vfs_castore.go:430] Issuing new certificate: &amp;#34;apiserver-aggregator-ca&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:04.628667 30077 vfs_castore.go:430] Issuing new certificate: &amp;#34;ca&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:07.291294 30077 executor.go:91] Tasks: 31 done / 73 total; 24 can run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:09.273293 30077 vfs_castore.go:430] Issuing new certificate: &amp;#34;kubelet-api&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:09.803612 30077 vfs_castore.go:430] Issuing new certificate: &amp;#34;kubelet&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:09.809131 30077 vfs_castore.go:430] Issuing new certificate: &amp;#34;kube-scheduler&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:09.973826 30077 vfs_castore.go:430] Issuing new certificate: &amp;#34;apiserver-proxy-client&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:10.317412 30077 vfs_castore.go:430] Issuing new certificate: &amp;#34;kops&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:10.321177 30077 vfs_castore.go:430] Issuing new certificate: &amp;#34;apiserver-aggregator&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:10.440919 30077 vfs_castore.go:430] Issuing new certificate: &amp;#34;kube-controller-manager&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:10.630182 30077 vfs_castore.go:430] Issuing new certificate: &amp;#34;kubecfg&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:11.020560 30077 vfs_castore.go:430] Issuing new certificate: &amp;#34;master&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:11.040010 30077 vfs_castore.go:430] Issuing new certificate: &amp;#34;kube-proxy&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:12.698208 30077 executor.go:91] Tasks: 55 done / 73 total; 16 can run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:13.609559 30077 launchconfiguration.go:333] waiting for IAM instance profile &amp;#34;nodes.dev.k8s.devopscoach.org&amp;#34; to be ready
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:13.656221 30077 launchconfiguration.go:333] waiting for IAM instance profile &amp;#34;masters.dev.k8s.devopscoach.org&amp;#34; to be ready
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:24.156701 30077 executor.go:91] Tasks: 71 done / 73 total; 2 can run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:24.864262 30077 executor.go:91] Tasks: 73 done / 73 total; 0 can run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:24.864379 30077 dns.go:153] Pre-creating DNS records
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">I0401 17:13:26.454177 30077 update_cluster.go:248] Exporting kubecfg for cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kops has set your kubectl context to dev.k8s.devopscoach.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cluster is starting. It should be ready in a few minutes.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Suggestions:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * validate cluster: kops validate cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * list nodes: kubectl get nodes --show-labels
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * ssh to the master: ssh -i ~/.ssh/id_rsa admin@api.dev.k8s.devopscoach.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The admin user is specific to Debian. If not using Debian please use the appropriate user based on your OS.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * read about installing addons: https://github.com/kubernetes/kops/blob/master/docs/addons.md
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上这套组合拳打出去之后，需要等几分钟才能完成Kubernetes集群的部署。&lt;/p>
&lt;p>在以上实例中创建的Ec2实例如下：&lt;/p>
&lt;ul>
&lt;li>master-ap-northeast-1a.masters.dev.k8s.devopscoach.org //m3.medium&lt;/li>
&lt;li>nodes.dev.k8s.devopscoach.org //t2.medium&lt;/li>
&lt;li>nodes.dev.k8s.devopscoach.org //t2.medium&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/ec2.png"
loading="lazy"
alt="kops On aws"
>&lt;/p>
&lt;p>也创建了两个ASG：&lt;/p>
&lt;ul>
&lt;li>一个是针对master的扩容规则&lt;/li>
&lt;li>另外一个是针对worker node的扩容规则&lt;/li>
&lt;/ul>
&lt;p>从扩容规则为空可以看出，它主要是用于定义集群规格的，而非自动化扩容的。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/asg.png"
loading="lazy"
alt="kops On aws"
>&lt;/p>
&lt;p>在安装完成之后，用一下命令确认集群状态如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$ kops validate cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using cluster from kubectl context: dev.k8s.devopscoach.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Validating cluster dev.k8s.devopscoach.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INSTANCE GROUPS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME ROLE MACHINETYPE MIN MAX SUBNETS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master-ap-northeast-1a Master m3.medium 1 1 ap-northeast-1a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nodes Node t2.medium 2 2 ap-northeast-1a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NODE STATUS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME ROLE READY
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip-172-20-38-48.ap-northeast-1.compute.internal master True
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip-172-20-45-235.ap-northeast-1.compute.internal node True
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip-172-20-63-157.ap-northeast-1.compute.internal node True
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your cluster dev.k8s.devopscoach.org is ready
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$ kubectl get nodes --show-labels
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME STATUS ROLES AGE VERSION LABELS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip-172-20-38-48.ap-northeast-1.compute.internal Ready master 5m v1.8.7 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/instance-type=m3.medium,beta.kubernetes.io/os=linux,failure-domain.beta.kubernetes.io/region=ap-northeast-1,failure-domain.beta.kubernetes.io/zone=ap-northeast-1a,kops.k8s.io/instancegroup=master-ap-northeast-1a,kubernetes.io/hostname=ip-172-20-38-48.ap-northeast-1.compute.internal,kubernetes.io/role=master,node-role.kubernetes.io/master=
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip-172-20-45-235.ap-northeast-1.compute.internal Ready node 4m v1.8.7 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/instance-type=t2.medium,beta.kubernetes.io/os=linux,failure-domain.beta.kubernetes.io/region=ap-northeast-1,failure-domain.beta.kubernetes.io/zone=ap-northeast-1a,kops.k8s.io/instancegroup=nodes,kubernetes.io/hostname=ip-172-20-45-235.ap-northeast-1.compute.internal,kubernetes.io/role=node,node-role.kubernetes.io/node=
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip-172-20-63-157.ap-northeast-1.compute.internal Ready node 4m v1.8.7 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/instance-type=t2.medium,beta.kubernetes.io/os=linux,failure-domain.beta.kubernetes.io/region=ap-northeast-1,failure-domain.beta.kubernetes.io/zone=ap-northeast-1a,kops.k8s.io/instancegroup=nodes,kubernetes.io/hostname=ip-172-20-63-157.ap-northeast-1.compute.internal,kubernetes.io/role=node,node-role.kubernetes.io/node=
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="创建并访问服务">创建并访问服务
&lt;/h2>&lt;p>如下所示的创建两副本的nginx部署，部署的命令 sample-nginx。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$ kubectl run sample-nginx --image=nginx --replicas=2 --port=80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps &amp;#34;sample-nginx&amp;#34; created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$ kubectl get pods
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sample-nginx-7588757c8f-jvkjt 1/1 Running 0 5s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sample-nginx-7588757c8f-zq8tj 1/1 Running 0 5s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$ kubectl get deployments
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sample-nginx 2 2 2 2 13s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后将这个部署暴露为服务，使用到Kubernetes的命令如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$ kubectl expose deployment sample-nginx --port=80 --type=LoadBalancer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service &amp;#34;sample-nginx&amp;#34; exposed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ec2-user@ip-172-31-27-182 ~]$ kubectl get services -o wide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTOR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubernetes ClusterIP 100.64.0.1 &amp;lt;none&amp;gt; 443/TCP 10m &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sample-nginx LoadBalancer 100.64.127.19 ae3a1ca9235d111e890d706038dd676b-392190656.ap-northeast-1.elb.amazonaws.com 80:30363/TCP 25s run=sample-nginx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这条命令 &lt;code>ubectl expose deployment sample-nginx --port=80 --type=LoadBalancer &lt;/code> 会创建一个ELB并将，集群里容正在运行的 sample—nginx 服务注册到这个ELB，然后就可以访问浏览到Nginx的默认页面了。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/nginx.png"
loading="lazy"
alt="kops On aws"
>&lt;/p>
&lt;h2 id="删除集群">删除集群
&lt;/h2>&lt;p>用一条命令就能删除以上所建立的Kubernetes集群。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">kops delete cluster --name=dev.k8s.devopscoach.org --yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>容器化应用的设计原则</title><link>https://martinliu.cn/blog/cloud-native-container-design/</link><pubDate>Sat, 24 Mar 2018 20:51:01 +0800</pubDate><guid>https://martinliu.cn/blog/cloud-native-container-design/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/BingWallpaper-2018-03-20.jpg" alt="Featured image of post 容器化应用的设计原则" />&lt;p>本文来自于Red Hat咨询顾问Bilgin Ibryam所编写的一篇白皮书，名为《PRINCIPLES OF CONTAINER-BASED APPLICATION DESIGN》。这篇文章在作者的Blog上发表后，作者的twitter被Kubernetes官方twitter转发。白皮书在Red Hat官网的下载地址：&lt;a class="link" href="https://www.redhat.com/en/resources/cloud-native-container-design-whitepaper" target="_blank" rel="noopener"
>https://www.redhat.com/en/resources/cloud-native-container-design-whitepaper&lt;/a> 文本是对这篇文章的学习和整理。&lt;/p>
&lt;p>先回顾经典的软件设计原则：&lt;/p>
&lt;ul>
&lt;li>保持简单，愚蠢（KISS）&lt;/li>
&lt;li>不要重复自己（DRY）&lt;/li>
&lt;li>你不会需要它 （YAGNI）&lt;/li>
&lt;li>关注点分离（SoC）&lt;/li>
&lt;li>Single responsibility, Open/closed, Liskov substitution, Interface segregation, Dependency inversion （SOLID）&lt;/li>
&lt;/ul>
&lt;p>然后是Red Hat的云原生容器设计原则：&lt;/p>
&lt;ul>
&lt;li>唯一关注性原则（SCP）&lt;/li>
&lt;li>高度可观测性原则（HOP）&lt;/li>
&lt;li>生命周期一致性原则（LCP）&lt;/li>
&lt;li>镜像不可变性原则（IIP）&lt;/li>
&lt;li>进程可处置性原则（PDP）&lt;/li>
&lt;li>自包含性原则（S-CP）&lt;/li>
&lt;li>运行时约束性原则（RCP）&lt;/li>
&lt;/ul>
&lt;p>很多组织都理解云原生的重要性和必要性，但是并不知道从哪里开始。那么请确保：云原生平台和容器化应用能无缝的运行在一起，并且具备抵御故障的能力，甚至在底层的基础架构出现宕机的时候，也能通过过弹性扩展的方式表现出可靠性。本文描述了容器化应用时需要遵循的基本准则，实施这些原则有助于使之与云原生平台Kubernetes更加适配。&lt;/p>
&lt;h2 id="唯一关注性原则-single-concern-principlescp">唯一关注性原则 SINGLE CONCERN PRINCIPLE（SCP）
&lt;/h2>&lt;p>在许多方面，唯一关注性原则与来自SOLID的SRP是类似的，它建议一个类应该只有一个责任。SRP背后的动机是每个责任是变更的一个轴心，一个类应该有，且也只有一个需要改变的理由。SCP原则中的“关注”一词强调关注是一种更高层次的抽象的责任，而且它更好地将范围描述为一个容器而不是一个类。虽然SRP的主要动机是变化原因的唯一性，而SCP的主要动机是容器镜像重用和可替换性。如果你创建一个解决单个问题的容器，并且以功能完整的方式来实现，不同应用程序中的容器镜像重用的可能性就会更高。&lt;/p>
&lt;p>因此，SCP原则规定每个集容器都应该解决一个问题，并做得很好。 实现这一点，通常比在面向对象的世界中实现SRP更容易，容器通常管理的一个单一的进程，大多数情况下一个进程解决一个问题。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/scp.png"
loading="lazy"
alt="scp 容器化应用的设计原则"
>&lt;/p>
&lt;p>如果你的容器化微服务需要解决多个问题，它可以使用这样的模式，将多个容器用sidecar和init-containers的模式合并成一个部署单元（pod），这样每个容器仍然是处理单个问题。同样，您可以替换处理同样问题的容器。 例如，将Web服务器容器或队列实现容器，更新为更具可扩展性的容器。&lt;/p>
&lt;h2 id="高度可观测性原则-high-observability-principlehop">高度可观测性原则 HIGH OBSERVABILITY PRINCIPLE（HOP）
&lt;/h2>&lt;p>容器提供了一种统一的方式来打包和运行应用程序，将它们视为一个黑盒子对象。 但任何旨在成为云原生公民的容器都必须提供API支持，要为运行时环境编写接口（API），以观察容器的健康状况和行为。 这是自动化容器更新和生命周期回收的基本先决条件和统一的方式，从而提高系统的弹性和用户体验。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/hop.png"
loading="lazy"
alt="hop 容器化应用的设计原则"
>&lt;/p>
&lt;p>实际上，您的容器化应用程序必须至少为其提供不同类型的健康检查的API&amp;ndash;活动和就绪等状态。更好的应用程序的行为则必须提供其他手段来观察容器化应用程序的状态。应用程序应该将重要事件记录到标准错误（STDERR）和标准输出（STDOUT）中，从而通过统一的日志聚合工具（诸如Fluentd和Logstash之类的工具）进行分析，并与跟踪和指标收集库相结合，例如OpenTracing，Prometheus等。&lt;/p>
&lt;p>将您的应用程序视为黑盒子，但实施所有必要的API以帮助平台对其进行观测，并以最佳方式管理您的应用程序。&lt;/p>
&lt;h2 id="生命周期一致性原则-life-cycle-conformance-principlelcp">生命周期一致性原则 LIFE-CYCLE CONFORMANCE PRINCIPLE（LCP）
&lt;/h2>&lt;p>HOP规定了你的容器提供供平台观测的API。 LCP则规定：您的应用程序有办法读取来自平台的事件。 此外，除了获得事件以外，容器还应该对这些事件相应地作出反应。这就是此原则名字由来。这几乎就像在应用程序通过一个“写入API”与平台进行交互。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/lcp.png"
loading="lazy"
alt="lcp 容器化应用的设计原则"
>&lt;/p>
&lt;p>来自管理平台的各种事件都是为了帮助您管理您的容器的生命周期的。决定处理哪些事件取决于您的应用程序 以及是否对这些事件做出反应。&lt;/p>
&lt;p>但有些事件比其他事件更重要。例如，任何需要一个干净的关闭进程，这就需要捕获信号：终止（SIGTERM）消息，并尽可能迅速关闭。 这是为了避免通过强制关闭信号：kill（SIGKILL），之后跟随一个SIGTERM。&lt;/p>
&lt;p>还有其他事件，例如PostStart和PreStop，可能对您的应用程序生命周期管理也非常重要。 例如，某些应用程序需要在服务之前进行预热请求和一些需要在关闭干净之前释放资源。&lt;/p>
&lt;h2 id="镜像不可变性原则-image-immutability-principleiip">镜像不可变性原则 IMAGE IMMUTABILITY PRINCIPLE（IIP）
&lt;/h2>&lt;p>IMAGE IMMUTABILITY PRINCIPLE（IIP）容器化的应用程序是不可变更的，镜像一旦完成了构建，预计在不同的环境中运行都不会改变。这意味着在因外部环境的不同，在需要的时候需要使用外部手法处理所依赖的外部配置数据，而不是每个环境修改或者构建不同的容器。而容器应用程序中的任何变更，都应该因此触发构建新的容器映像，并在所有环境中重用它。相同于这个原理的，不可变服务器和不可变基础架构的概念也很受欢迎，并且对于服务器/主机管理也是如此。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/iip.png"
loading="lazy"
alt="iip 容器化应用的设计原则"
>&lt;/p>
&lt;p>在遵循IIP原则的情况下，应该防止为不同的环境创建相似的容器镜像，要始终坚持为所有环境只配置一个容器映像。 这个原则允许在应用程序更新期间，采用自动回滚和前滚等做法，这是云原生自动化的重要方面。&lt;/p>
&lt;h2 id="进程可处置性原则-process-disposability-principlepdp">进程可处置性原则 PROCESS DISPOSABILITY PRINCIPLE（PDP）
&lt;/h2>&lt;p>迁移到容器应用程序的主要动机之一是：容器需要尽可能做到临时性，并做好在任何时候被另一个容器实例替换的准备。需要更换容器的原因有很多，比如：健康检查失败、缩容、应用程序将容器迁移到不同的主机，平台资源匮乏或其它的问题。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/pdp.png"
loading="lazy"
alt="pdp 容器化应用的设计原则"
>&lt;/p>
&lt;p>这意味着容器化的应用程序必须保持其状态为向外扩展的或分布式和冗余的。这也意味着应用程序应该快速启动和关闭，甚至为彻底的硬件故障做好准备。 实施这一原则的另一个有用的做法是创建小容器。 容器在云原生环境可以自动调度并在不同的主机上启动。较小的容器可以实现更快启动时间，因为在重新启动之前容器镜像需要被物理地复制到主机系统。&lt;/p>
&lt;h2 id="自包含性原则-self-containment-principles-cp">自包含性原则 SELF-CONTAINMENT PRINCIPLE（S-CP）
&lt;/h2>&lt;p>这个原则规定一个容器应该在构建时包含所有需要的东西。容器的存在应该仅仅依赖于Linux®内核，在并添加相关额外的库，在容器构建时加入它们。除了库之外，它还应该包含语言运行时，应用程序平台（如果需要），以及运行所需的其他依赖关系，等运行容器化应用所需要的诸如此类的东西。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/s-cp.png"
loading="lazy"
alt="s-cp 容器化应用的设计原则"
>&lt;/p>
&lt;p>唯一的例外是：由于不同环境之间差异，并且只能在运行时提供的配置; 例如，通过Kubernetes提供的ConfigMap。&lt;/p>
&lt;p>某些应用程序由多个容器组件组成。 例如，容器化的Web应用程序也可能需要数据库容器。 根据这个原则，并不建议合并两个容器。相反，它建议的是数据库容器只包含运行数据库所需的所有内容，Web应用程序容器只包含运行Web应用程序所需的所有内容，如Web服务器。 在运行时，Web应用程序容器将根据需要依赖于并访问数据库容器。&lt;/p>
&lt;h2 id="运行时约束性原则-runtime-confinement-principlercp">运行时约束性原则 RUNTIME CONFINEMENT PRINCIPLE（RCP）
&lt;/h2>&lt;p>S-CP从构建时的角度查看容器，并关注于生成的二进制文件及其内容。但是容器不仅仅是磁盘上一个只有尺寸大小的单一维度的黑盒子。 容器运行时有多个维度，例如内存使用维度，CPU使用维度等资源消耗维度。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/rcp.png"
loading="lazy"
alt="rcp 容器化应用的设计原则"
>&lt;/p>
&lt;p>这个RCP原则建议每个容器申报资源需求，并发送信息到平台。它应该分享容器的资源配置文件，从CPU，内存，网络，磁盘的角度声明。这影响到平台如何执行调度，自动扩展，容量 管理以及容器常规的服务级别协议（SLA）等。&lt;/p>
&lt;p>除了向平台声明容器的资源需求之外，还有一点也很重要， 应用被约束在使用所声明的资源需求内。如果应用程序对资源的使用保持在约束的范围内，则当资源匮乏发生时，平台不太可能将其终止和迁移。&lt;/p>
&lt;h2 id="结论">结论
&lt;/h2>&lt;p>云原生不仅仅是一种最终状态 - 它也是一种工作方式。 本份白皮书描述了一系列容器应用的基本原则，必须遵守才能成为优秀的云原生公民。&lt;/p>
&lt;p>除了这些原则之外，创建良好的容器应用程序还需要熟悉其他容器相关的最佳实践和技术。 尽管上述原则非常根本，适用于大多数用例，下面列出的最佳实践在应用和不应用的时候，则需要判断力。以下是一些与容器相关的更常见的最佳实践：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>镜像要尽可能的小&lt;/strong>。 通过清理临时文件，并避免安装不必要的软件包来构建小尺寸镜像。 这减少了容器的尺寸，构建时间和复制容器镜像的网络传输时间。&lt;/li>
&lt;li>&lt;strong>支持任意用户ID&lt;/strong>。 避免使用sudo命令或要求特定用户名运行你的容器。&lt;/li>
&lt;li>&lt;strong>标记重要的端口&lt;/strong>。 虽然可以在运行时指定端口号，然而使用EXPOSE命令在运行的时候指定，则可以让镜像的使用者更轻松。&lt;/li>
&lt;li>&lt;strong>为持久数据使用卷&lt;/strong>。 在容器摧毁之后还需要保存的容器数据的，必须将数据写入一个数据卷。&lt;/li>
&lt;li>&lt;strong>设置镜像元数据&lt;/strong>。 以标签和注释形式存在的镜像元数据可以使您的容器镜像更加实用，从而为使用您的容器的开发人员提供了更好的体验。&lt;/li>
&lt;li>&lt;strong>使主机和镜像同步&lt;/strong>。 一些容器应用需要容器在某些属性（如时间和机器ID）上与主机同步。&lt;/li>
&lt;/ul>
&lt;p>这里是指向各种模式和最佳实践的资源的链接，以帮助您能有效地实现上述目标：&lt;/p>
&lt;ul>
&lt;li>• &lt;a class="link" href="https://www.slideshare.net/luebken/container-patterns" target="_blank" rel="noopener"
>https://www.slideshare.net/luebken/container-patterns&lt;/a>&lt;/li>
&lt;li>• &lt;a class="link" href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices" target="_blank" rel="noopener"
>https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices&lt;/a>&lt;/li>
&lt;li>• &lt;a class="link" href="http://docs.projectatomic.io/container-best-practices" target="_blank" rel="noopener"
>http://docs.projectatomic.io/container-best-practices&lt;/a>&lt;/li>
&lt;li>• &lt;a class="link" href="https://docs.openshift.com/enterprise/3.0/creating_images/guidelines.html" target="_blank" rel="noopener"
>https://docs.openshift.com/enterprise/3.0/creating_images/guidelines.html&lt;/a>&lt;/li>
&lt;li>• &lt;a class="link" href="https://www.usenix.org/system/files/conference/hotcloud16/hotcloud16_burns.pdf" target="_blank" rel="noopener"
>https://www.usenix.org/system/files/conference/hotcloud16/hotcloud16_burns.pdf&lt;/a>&lt;/li>
&lt;li>• &lt;a class="link" href="https://leanpub.com/k8spatterns/" target="_blank" rel="noopener"
>https://leanpub.com/k8spatterns/&lt;/a>&lt;/li>
&lt;li>• &lt;a class="link" href="https://12factor.net" target="_blank" rel="noopener"
>https://12factor.net&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>7种DevOps工程师必备技能</title><link>https://martinliu.cn/blog/7-skills-devops-engineer/</link><pubDate>Sat, 24 Mar 2018 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/7-skills-devops-engineer/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Nyala_ZH-CN13349334824_1920x1080.jpg" alt="Featured image of post 7种DevOps工程师必备技能" />&lt;p>使用DevOps的目的是改变和改善开发与IT运营之间的关系，倡导两个部门之间更好的沟通与协作。虽然这看起来有些简单，然后，DevOps工程师还需要做更多的工作，才能成功部署代码，并将Dev和Ops两个部分成功地绑定在一起。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15218598197884.jpg"
loading="lazy"
alt="7种DevOps工程师必备技能"
>&lt;/p>
&lt;p>从应付DevOps压力的角度出发，DevOps工程师除了需要日常技能的基础，每个工程师都必须具备多种技能。DevOps工程师除了要对脚本和编码有着强烈的热情之外，还必须具有开放的思想和协作精神，才能成功地执行该过程。&lt;/p>
&lt;p>“DevOps教练”参考一些文献，已经为你设计了一个清单，列出了下面的7种必备技能，公司的DevOps工程师的招聘需求里，应该明确提出下列所有品质。&lt;/p>
&lt;h2 id="1-灵活性">1. 灵活性
&lt;/h2>&lt;p>编码是一个持续的过程，不断变化，总是需要更新。要成为一个成功而有效的DevOps工程师，理想的候选人必须有能力不断地开发新的系统，并将其集成到主干代码中。DevOps工程师必须具有灵活的工作技能并适应不断变化的代码。&lt;/p>
&lt;p>无论是集成、测试、发布还是部署，工程师都必须能够轻松地从一个软件构建领域迁移到另一个领域。例如，持续集成需要具备快速有效地管理变更的技术技能，并且能够在团队中协作，以保证每个人都朝着共同的目标努力。&lt;/p>
&lt;h2 id="2-安全技能">2. 安全技能
&lt;/h2>&lt;p>与许多其他所熟练的领域一样，安全始终是最重要的，尤其是在编码方面。黑客进入系统的一个简单方法是利用漏洞，破坏现有的系统并获取数据。
&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15218597269514.jpg"
loading="lazy"
alt="7种DevOps工程师必备技能"
>&lt;/p>
&lt;p>DevOps带来了更快的代码开发和部署周期，这意味着漏洞也比以前更容易引入代码。因此，工程师必须具备编写安全代码的技能，以保护应用程序免受不期望的攻击，此外还要确保系统针对常见的网络安全漏洞建立防御机制。&lt;/p>
&lt;p>DevOps工程师在受雇时必须具备安全技能，因为软件从部署一开始就内置了安全性(而不是在以后添加)是至关重要。如果从一开始就没有安全措施，那么黑客就有更多的机会通过网络注入破坏性代码。因此，在招聘下一位DevOps工程师时，确保安全性是技能列表中最重要的一项。&lt;/p>
&lt;h2 id="3-协作">3. 协作
&lt;/h2>&lt;p>对于一个成功的DevOps工程师来说，不具备八面玲珑的和周围打成一片的能力是不行的——协作实际上是DevOps概念的核心，它将软件开发和软件运维结合在一起。DevOps工程师必须具备团队合作的能力，在DevOps流程中协作提供了更多的跨职能的联动。&lt;/p>
&lt;h2 id="4-脚本编写技巧">4. 脚本编写技巧
&lt;/h2>&lt;p>尽管这一点听起来很显然，但任何开发人员都必须具备编写代码的高超技能。无论是JavaScript、Python、Perl还是Ruby，一个成功的开发工程师都必须能够编写代码。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15218597150085.jpg"
loading="lazy"
alt="7种DevOps工程师必备技能"
>&lt;/p>
&lt;p>从编写手动代码到替换手动操作流程(如分配IP地址或DNS代码)，必须团队里必须具有能够编写这些代码的人员，这是完美的候选人应该能够做到的。&lt;/p>
&lt;h2 id="5-决策">5. 决策
&lt;/h2>&lt;p>一个优柔寡断的候选人不是你想要的业务开发工程师。一个成功DevOps工程师候选人将有能力自信而迅速地作出决定，即使是在繁忙的环境工作。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15218598592359.jpg"
loading="lazy"
alt="7种DevOps工程师必备技能"
>&lt;/p>
&lt;p>代码不断变化的特性使得必须快速决定如何修复代码中任何不连贯的元素。果断性必须是雇用DevOps工程师时要考虑的一个因素，因为快速决策允许工程师保持快速开发和部署新编码更改的能力。&lt;/p>
&lt;h2 id="6-基础架构知识">6. 基础架构知识
&lt;/h2>&lt;p>脚本编写只是开发人员应具备的关键技能之一，仅次于云和基础架构的经验。工程师应该对基于数据中心和云基础架构的各种组件的工作方式有一定了解。这包括软件如何联网、并运行在虚拟网络上等要素。&lt;/p>
&lt;p>如果没有理解基础架构的能力，要成为全栈软件开发工程师可能会有些困难。整合基础架构技能将使有效的DevOps工程师能够使用最佳的平台，有效地设计和部署应用程序。还能提出优化建议。&lt;/p>
&lt;h2 id="7-软技能">7. 软技能
&lt;/h2>&lt;p>如上所述，当一名DevOps工程师不是一个人在工作，所以在这种情况下，任何未来的员工必须具备软技能和技术。在信任的前提下，DevOps文化使所有员工能够与流程进行沟通和理解，在需要的时候作出变化。&lt;/p>
&lt;p>当开发人员有效地相互沟通时，应用程序可以在比某些工作人员不在上下文中的情况里要短得多的时间内交付。以及更快的进入市场，良好的通信将导致更少的错误，从而降低成本并提高代码质量。&lt;/p></description></item><item><title>2018年必须认识到的6个DevOps趋势</title><link>https://martinliu.cn/blog/6-devops-trends-aware/</link><pubDate>Fri, 23 Mar 2018 17:50:25 +0800</pubDate><guid>https://martinliu.cn/blog/6-devops-trends-aware/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Decaying_Startrails_nimiaRM_165652_1080_HD_ZH-CN1933491271.jpg" alt="Featured image of post 2018年必须认识到的6个DevOps趋势" />&lt;p>DevOps已经出现了很长时间，我们中的很多人都认为它只是一个时髦词。现在我们知道这并不是一个神话。DevOps已经成为一个IT主流的焦点，并且在过去的几年里一直在重塑着软件世界。专家表示，DevOps将成为主流，2018年DevOps的人气将达到顶峰。&lt;/p>
&lt;p>下面是术语“DevOps”在Google趋势里的现状，以及对2018年预计增长的假设。
&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15217987958903.png"
loading="lazy"
>&lt;/p>
&lt;p>谈到统计数据，从2015年到2016年，DevOps的应用企业数增加了约8%，预计2018年这一数字将大幅增长，如上所示。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15217988516530.png"
loading="lazy"
>&lt;/p>
&lt;p>你可以阅读&lt;a class="link" href="https://www.rightscale.com/blog/cloud-industry-insights/new-devops-trends-2016-state-cloud-survey" target="_blank" rel="noopener"
>RightScale&lt;/a>的整个报告。甚至&lt;a class="link" href="https://go-forrester.clclp.me/blogs/2018-the-year-of-enterprise-devops" target="_blank" rel="noopener"
>Forrester的报告&lt;/a>也明确提到2018年将是DevOps的一年。&lt;/p>
&lt;p>最近发表的关于DevOps的事实和统计数据的文章得到了DevOps爱好者的热烈响应，它只是表明许多技术布道者者对了解更多DevOps并在他们的组织中实施DevOps很感兴趣。&lt;/p>
&lt;p>今天，我们将看到以下事实将塑造DevOps的未来。&lt;/p>
&lt;h2 id="1-将重心从ci流水线移到devops装配线">1 将重心从CI流水线移到DevOps装配线
&lt;/h2>&lt;p>通过CI流水线可以显示应用程序从源代码管理到生产的完整可视化。你可以在一个统一的视图上看到一切。它不仅仅只关于CI，它更多是作为CD (连续交付)的基础；组织正在投入时间和精力来进一步了解自动化其完整的软件开发流程。2018年，第一大DevOps转变将是从单纯的CI流水线转变为&lt;a class="link" href="http://blog.shippable.com/the-difference-between-ci-pipelines-and-devops-assembly-lines-0" target="_blank" rel="noopener"
>DevOps的装配线&lt;/a>链接是Shippable关于装配线的描述。&lt;/p>
&lt;h2 id="2-自动化将成为主要关注点">2 自动化将成为主要关注点
&lt;/h2>&lt;p>在DevOps中，我们经常谈论自动化。如果可能，对服务器的零接触自动化将是未来的趋势。这并不意味着你必须自动化一切，但如果你必须这样做，那么你应该能够做到。了解DevOps循环的6个C，并确保在这些阶段之间应用自动化是关键，这将是2018年的主要目标。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15217988430927.png"
loading="lazy"
>&lt;/p>
&lt;h2 id="3-测试人员需要学会编写代码">3 测试人员需要学会编写代码
&lt;/h2>&lt;p>在DevOps中，需要测试人员知道如何编写自动化脚本来测试各种情况。如果您是一名测试人员，如果在是否学习编码的问题上进退两难，那么我建议您学习编码。了解不同的DevOps工具和自动化脚本，在当今的软件开发中起着至关重要的作用，这将在2018年占据主导地位。&lt;/p>
&lt;p>如果测试人员不学习自己编写自动化测试脚本，他们将会灭亡。手动测试将在2018年过时，它将占用大量时间。自动化测试不仅可以提高效率，还可以确保功能更快地交付给市场。&lt;/p>
&lt;h2 id="4-微服务体系结构应用的增加">4 微服务体系结构应用的增加
&lt;/h2>&lt;p>DevOps和微服务最近正是天作之合。微服务是独立的实体，因此不会在出现问题时由于任何依赖关系而中断其他系统。微服务体系结构可帮助公司轻松进行部署和添加新功能。预计公司将转向微服务体系结构，以提高其运行时间和效率。不要因为别人采用了微服务体系结构就跟着他们走，点这个文章：&lt;a class="link" href="http://blog.shippable.com/why-you-should-adopt-microservices" target="_blank" rel="noopener"
>了解自己并理解为什么应该采用微服务体系结构&lt;/a>。&lt;/p>
&lt;h2 id="5-预计将有更多的公司选择企业版devops工具">5 预计将有更多的公司选择企业版DevOps工具
&lt;/h2>&lt;p>目前有许多公司仍然处于建造还是购买的两难境地。但是，我们建议您做您最擅长的事情，并根据您的要求购买工具。这不仅有助于您专注于自己的目标，而且通过完全依赖第三方平台来提高工作效率。许多公司现在都在寻求企业版本，以获得自己的DevOps基础架构，并确保安全性尽可能掌握在最佳人员手中。&lt;/p>
&lt;h2 id="6-kubernetes将会大行其道">6 KUBERNETES将会大行其道
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.upwork.com/hiring/for-clients/kubernetes-vs-openshift-vs-tectonic/" target="_blank" rel="noopener"
>Kubernetes&lt;/a>因其优异的功能性和易用性，从而成为增长最快的容器技术。kubernetes围绕它建立了一个伟大的开源社区。在全球范围内，许多首席信息官和技术人员都采用了Kubernetes，采用比例预计将在2018年进一步提升。&lt;/p>
&lt;p>最近，&lt;a class="link" href="https://events.linuxfoundation.org/events/kubecon-cloudnativecon-north-america-2018/" target="_blank" rel="noopener"
>在KubeCon + CloudberNativeCon北美&lt;/a>( 2017年12月6日至8日)之前，云计算基金会进行了一项调查，并分享了容器编排环境正在发生的变化和向Kubernetes的转变。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15218007889881.png"
loading="lazy"
>&lt;/p>
&lt;p>来源:容器业务流程环境正在更改。&lt;/p>
&lt;p>以上是将在2018年复现的DevOps的6个趋势。&lt;/p></description></item><item><title>2018值得关注的15个DevOps大会</title><link>https://martinliu.cn/blog/2018-best-devops-event/</link><pubDate>Thu, 22 Mar 2018 08:30:13 +0800</pubDate><guid>https://martinliu.cn/blog/2018-best-devops-event/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/carauari-brazil.png" alt="Featured image of post 2018值得关注的15个DevOps大会" />&lt;p>本文向你简要介绍2018年DevOps界的15大最重要的大会活动。DevOps的一个方面就是持续&amp;hellip;&amp;hellip;.参加大会学习！全球范围内看，基本上每个月都至少有一个我们值得重点关注的大会。我们不能奢望都你有机会参加，但是作为DevOps业内人士，如果你不了解这个大会的情况，你就Out了。&lt;/p>
&lt;p>这些大会中有些社偏技术的、有些是注重社交和体验；根据你的业务需求和学习目标，今年走出去参加最高端DevOps盛会的奢望可以有。不提前做功课，怎么能说服领导支持你呢？万一领导批准了呢？&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/15216787212180.jpg"
loading="lazy"
>&lt;/p>
&lt;h2 id="1-cloud--devops-world">1. Cloud &amp;amp; DevOps World
&lt;/h2>&lt;p>June 12-14, London&lt;/p>
&lt;p>cloud&amp;amp;DevOps World是techxl 8的一部分，是一系列各种技术会议、网络机会和博览会的一部分。cloud&amp;amp;DevOps World涵盖云创新和管理微服务、DevOps、容器、无服务器体系结构和监管实践。云与云世界的一大亮点是，您可以通过展览的其他部分(如物联网和虚拟现实会议)看到云概念和云概念在发挥作用。&lt;/p>
&lt;p>与会者还可以向观众演示他们的云解决方案，并享受联网、交互式会话和讨论面板。在去年的展会上，有300多家参展商和15000多名与会者参加，使这成为业界最大的展会之一。&lt;/p>
&lt;h2 id="2-devops-enterprise-summit-does">2. DevOps Enterprise Summit (DOES)
&lt;/h2>&lt;p>June 25-26, London&lt;/p>
&lt;p>DevOps企业峰会针对的是参与DevOps革命的主要企业的高级经理。该大会深入探讨了各种重要的主题，一方面涉及技术和架构问题，另一方面涉及领导力挑战。DevOps Enterprise Summit的主题演讲、专题小组讨论、聊天室、社交圈区和展览大厅。&lt;/p>
&lt;p>伦敦活动的讲演者包括来自IBM、Puppet、微软和各行各业的资深人士。DOES是一项每年举办两次的活动，地点在美国和欧洲之间变化。上一次在旧金山举行的展览有1400多人参加。&lt;/p>
&lt;h2 id="3-oreilly-velocity-conference">3. O’Reilly Velocity Conference
&lt;/h2>&lt;p>June 11-14, San Jose&lt;/p>
&lt;p>Velocity会议是本列表上排名第三的活动，由O’Reilly Media欧莱利媒体公司举办，该公司是一家技术媒体公司，在各种技术领域举办了无数的展览。Velocity会议在讨论站点可靠性工程、基础架构(如代码)、混沌工程、自动化、连续交付、恢复能力和安全性时，吸引了web ops、系统工程师和开发专家。圣何塞展览(今年在不同城市实际上有三个Velocity会议)的演讲者包括来自微软、Netflix、亚马逊和谷歌的代表。&lt;/p>
&lt;h2 id="4-chefconf">4. ChefConf
&lt;/h2>&lt;p>May 22-25, Chicago&lt;/p>
&lt;p>ChefConf面向开发、自动化和法规遵从性感兴趣的管理员和开发人员。ChefConf关注处理整个应用程序开发和管理生命周期所需的策略和技能。本次活动侧重于实践和经验，以涵盖构建云应用程序、持续法规遵从性和广泛的自动化等活动。去年的ChefConf吸引了大约1，500名与会者，来自Chef和其他重要科技公司的演讲者。&lt;/p>
&lt;h2 id="5-continuous-lifecycle">5. Continuous Lifecycle
&lt;/h2>&lt;p>May 15-18, London&lt;/p>
&lt;p>Continuous Lifecycle每年在伦敦举行，主要集中在开发、容器化、连续交付和敏捷方面。这是一个为期三天的活动，包括会议和研讨会，与会者包括开发负责人、架构师、开发人员、CTO、工程师和工具/基础架构专家。每一个行业都有代表，从高技术的最高水平到制造企业。&lt;/p>
&lt;h2 id="6-devops-con">6. DevOps Con
&lt;/h2>&lt;p>May 28-31, Berlin&lt;/p>
&lt;p>你是德国人吗？就算你只能说有点德文，DevOps Con也是值得一游的。它可能被认为是一年中最重要的持续交付会议，在微服务、Docker、云计算和精益业务方面进行了出色的讨论。今年的演讲者包括优步、红帽和西门子的高级职员。DevOps Con演讲者使用德语和英语，让与会者忙于实际的研讨会、会议和主旨演讲。&lt;/p>
&lt;h2 id="7-devops-days">7. DevOps Days
&lt;/h2>&lt;p>今年DevOpsDays在国内举办三场：北京-5月，上海-8月，深圳-11月。&lt;/p>
&lt;p>如果你还不能参加一个DevOps Days会议，那你肯定是住在了月球上。从亚特兰大到苏黎世，DevOps日一年四季都在不断发生，一个月内有多达几十个大会活动，遍布全球。DevOps Days活动关注软件开发和IT基础架构运营，重点关注自动化、测试、安全性和组织文化。&lt;/p>
&lt;p>每场大会的地点都不尽相同，因此如果您有特定的感兴趣区域，请确保您注册了最感兴趣的城市，以便充分利用2018年DevOps的重大活动。DevOps Days甚至鼓励专业人士在大会上组织自己的日程。&lt;/p>
&lt;h2 id="8-dockercon">8. DockerCon
&lt;/h2>&lt;p>June 11-15, San Francisco&lt;/p>
&lt;p>Docker大会的演讲者人大多来Docker本身，这并不奇怪。然而，在过去的几年里，来自AWS、Puppet、Cisco和cloudBee的演讲者也逐渐加入。为期三天的会议探讨了分布式、基于容器的应用程序的未来，并提供了一个引人入胜的视角，看看领先公司目前是如何开发Docker平台和容器的。&lt;/p>
&lt;p>与会者将有机会参加技术演示、实验教程和主题演讲。上一届会议有5 000多人出席。&lt;/p>
&lt;h2 id="9-gartner-it-operations-strategies-and-solutions">9. Gartner IT Operations Strategies and Solutions
&lt;/h2>&lt;p>May 15-17, Orlando&lt;/p>
&lt;p>由于Gartner分析师的数量超过了您的能力范围，因此IT运营战略和解决方案展览是向真正了解DevOps行业全局的专家学习的绝佳途径。&lt;/p>
&lt;p>该活动非常适合IT运营管理、云运营和IT服务支持专业人员。今年展会的主题包括IT运营优化、开发与敏捷、云与自动化、新兴IT运营趋势和战略。&lt;/p>
&lt;h2 id="10-itdev-connections">10. IT/Dev Connections
&lt;/h2>&lt;p>Oct 15-18, Dallas&lt;/p>
&lt;p>IT/Dev Connections将自己描述为“反基调”会议。这意味着它集中于实践科目和培训，避免了供应商过多的营销。说到实际，IT/Dev Connections的组织者甚至有一个“出勤证明中心”。&lt;/p>
&lt;p>除了各种讲习班、小组讨论和网络活动外，该会议还值得一提的是其妇女参与技术午餐会。IT/Dev Connections分为五个方面，涉及云和数据中心、数据平台、业务智能、企业协作、管理、移动性、安全性和DevOps的会话超过250个。&lt;/p>
&lt;h2 id="11-jenkins-world">11. Jenkins World
&lt;/h2>&lt;p>September 16-19, San Francisco&lt;/p>
&lt;p>DevOps只是Jenkins World涵盖的主题之一，它还涉及社区、CloudBee和生态系统等不同领域。虽然这一活动更倾向于一个特定的工具集，但它仍然非常受欢迎，2017年的活动约有2，000人参加。过去的讲演者代表了诸如Docker、Red Hat和亚马逊网络服务等公司。&lt;/p>
&lt;h2 id="12-large-installation-system-administration-conference-lisa">12. Large Installation System Administration Conference (LISA)
&lt;/h2>&lt;p>October 29–31, Nashville&lt;/p>
&lt;p>LISA会议将自己标榜为“供应商中立”，以便将市场营销保持在最低限度。LISA由美国先进计算系统协会Usenix组织，每年在美国不同的城市举办。本次大会吸引了大量供应商和系统管理员，重点关注关键系统的设计、构建和维护，以及围绕体系结构、文化和工程的实际考虑。讲演者包括戴尔、Netflix、Facebook和fasty等公司的高级代表。&lt;/p>
&lt;h2 id="13-microsoft-ignite">13. Microsoft Ignite
&lt;/h2>&lt;p>September 24-28, Orlando&lt;/p>
&lt;p>这将是2018年DevOps所有活动的母亲，因为这个大会看起来将超过2017年的人数，将有超过24000人参加。事实上，微软于2014年开始将Ignite作为合并多个会议的一种方式，数字反映了这一点。预计Ignite将非常繁忙，因为它涉及700多个演讲。然而，并不是所有的事情都与微软有关，因为展会包括100多家供应商，他们都是展会和会议演示的一部分。&lt;/p>
&lt;h2 id="14-monitorama">14. Monitorama
&lt;/h2>&lt;p>June 4-6, Portland&lt;/p>
&lt;p>Monitorama是另一个特别的大会，它只限于关于软件和基础架构监控工具和技术的主题。它还主办了一次黑客马拉松活动。Monitorama是为数不多的只有一个主题的大会之一，这样与会者就可以专注于一个问题，避免FOMO体验。该大会自2013年以来一直在进行，观众人数限制在600人左右，因此尽早预订是个好主意。&lt;/p>
&lt;h2 id="15-puppetconf-2018">15. PuppetConf 2018
&lt;/h2>&lt;p>October 9-11, San Francisco&lt;/p>
&lt;p>Puppet是一种开源配置管理工具，它对DevOps、云管理、下一代基础架构、应用程序交付、安全性、法规遵从性和持续交付的影响非常重要。&lt;/p>
&lt;p>PuppetConf由100多位专家提供了80多个课程，是一个非常棒的学习体验，无论是初学者还是老兵。PuppetConf由IT主管参加，他们希望获得有关DevOps转换、云迁移和持续交付的建议。2017年活动的讲演者包括来自Twitter、Yelp、谷歌、销售人员和Slack的Puppet员工和专业人士。&lt;/p>
&lt;h2 id="后记">后记
&lt;/h2>&lt;p>本文的清单是15个比较出名的大会，我发起并动态更新的全球DevOps重要大会的日历，访问的地址在这里：&lt;a class="link" href="https://teamup.com/ks5kh2kcca4w6xva4y" target="_blank" rel="noopener"
>https://teamup.com/ks5kh2kcca4w6xva4y&lt;/a>&lt;/p>
&lt;p>目前整理的全球大会日程表见下图（持续更新中，请直接查看线上版本）：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Screen_Shot_2018-03-23_at_5.26.39_PM.png"
loading="lazy"
alt="p1"
>
&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Screen_Shot_2018-03-23_at_5.26.52_PM.png"
loading="lazy"
alt="p2"
>
&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Screen_Shot_2018-03-23_at_5.27.25_PM.png"
loading="lazy"
alt="p3"
>&lt;/p>
&lt;p>最后一招：参加大会是为了学习先进思想和实践，这些大会是货真价实的真理发源地，在诸位参会学会了以后，回到公司，万一领导还是不理解，不支持怎么办？而且领导也不感冒参加这些大会。那么你可以在公司内部举办类似的大会，可以请外部的和尚来自己的庙里念经。这也是我们中国DevOpsDays核心组织者的一个想法，希望能够提供协助和支持，帮助所有传统企业早上走上上下一心的DevOps转型之旅。&lt;/p></description></item><item><title>基础架构的持续集成和应用部署</title><link>https://martinliu.cn/blog/devops-infrastructure-ci-app-deployment/</link><pubDate>Sat, 17 Mar 2018 10:50:57 +0800</pubDate><guid>https://martinliu.cn/blog/devops-infrastructure-ci-app-deployment/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/coding-snippet.jpg" alt="Featured image of post 基础架构的持续集成和应用部署" />&lt;p>持续集成通常是针对应用而言的，可是基础架构的持续集成应该怎么做？基础架构的持续集成应该属于持续交付/部署的基础。贯串本文的一个问题，或者在阅读本文时，您应该不断地问自己这个问题：我们的应用部署流程是怎样的？&lt;/p>
&lt;p>在回答这个问题之前，我们先来回顾一下，目前几乎所有人正在使用的手工环境和资源交付流程。在源码被编译打包了以后，安装包文件被上传保存到了内部的某个文件服务器上。Ops团队的某个组/人被分配到工单，根据工单描述的需求，它在测试或者生产环境中开始工作：&lt;/p>
&lt;ul>
&lt;li>用图形界面进行虚拟机模板的手工克隆工作，或者由于没有相应的权限或者自助服务，不得不给虚拟化管理员发任务单，然后等待回复。&lt;/li>
&lt;li>获取用户名和密码手工登录服务器，有些企业还要是等待领导的审批，才能得到密码信封和所需要的访问密码。&lt;/li>
&lt;li>根据工单（变更单）里的描述和自己的经验对虚拟机的操作系统进行配置，在这个过程中，Ops往往可能还需和需求方进行不止一次的沟通，确认相关参数。&lt;/li>
&lt;li>手工的下载应用安装包，然后分别手工上传到目标的服务器，凭经验和工单信息部署应用，然后测试部署结果，可能是看下页面有没有正常显示，或者服务起没起.&lt;/li>
&lt;li>手工测试和确认这些虚拟机的服务和状态，凭经验觉得OK了以后，回复工单，关闭工单。&lt;/li>
&lt;/ul>
&lt;p>以上的工作场景，可能是Ops人员很常规的一天，或者是几天内的工作，当然在这个过程中，他们还需要参与一些救火行动；他们在这个过程中也可能会有疑问，也可能会对此工作结果不确定；但是，日常的工作经验告诉他，差不多了，关闭任务单要紧，还有好多项目催活呢！就这样，配置并不精确的虚拟机环境就交给了下游的需求方。&lt;/p>
&lt;p>以上工作过程的问题如下：&lt;/p>
&lt;ol>
&lt;li>工作周期长，速度慢。实际上工作周期拖延的越久，工作结果的质量就越差，而并不是我们想想中的慢工出细活。&lt;/li>
&lt;li>所有步骤都是纯手工操作，不仅费事费力，而且出错几率高，也几乎不可能无痛的回退。可能有人会说了，我们不需要那么快，我们也不是互联网公司；可是从精益思想的角度看，以上这些工作都属于对业务价值的交付贡献为零的工作；你可能是由于公司给你发着工资，才错误的感觉到，这项工作活动应该有它的价值。&lt;/li>
&lt;li>上游传递来的信息可能不全面，不准确，因此Ops很有可能造成错误配置，因此会返工。&lt;/li>
&lt;li>传递给下游的虚拟机很可能会在后续的部署过程中，由于应用需求的变化，而需要下游的人员对其重新配置，产生重复的劳动。&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>手工部署的时间和代价 = 应的数量 X 应用版本数量 X 环境数量&lt;/p>&lt;/blockquote>
&lt;p>对以上工作系统进行优化的原则：如果某一项活动的重复频率越高，那么对它进行优化，所产生的回报也会越明显；这里还要参考限制理论，优化的顺序要正确。&lt;/p>
&lt;p>我们从这个角度出发，就可以来设定基础架构持续集成和应用部署流程的改进目标了：&lt;/p>
&lt;ul>
&lt;li>减少总体人工工作时间和代价&lt;/li>
&lt;li>提高交付的速度、可靠性和频率&lt;/li>
&lt;li>能进行应用部署，能进行数据库Schema的更新&lt;/li>
&lt;li>能够实现部署流程的自服务，让任何需要部署应用的人能一键式部署任何版本&lt;/li>
&lt;/ul>
&lt;p>到了这里我们就必须将上述手工劳动，变为自动化的过程。因此，基础架构即代码IaC （Infrastructure as code）和相关的配置管理工具就会用到。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/delivery-Pipeline.png"
loading="lazy"
alt="delivery-Pipeline"
>&lt;/p>
&lt;p>上图是一个典型的持续交付流水线模型，在此我们对它的关注点如下：&lt;/p>
&lt;ul>
&lt;li>代码的变更被Jenkins自动化的构建（CI是基础），打包后的安装包被存储在Artifactory里，Artifactory里面还可以存储应用包的其它相关元数据，如测试结果，能否可以用于下一步部署的标签等等。&lt;/li>
&lt;li>Jenkins自动化的搭建所需要的环境，调用虚拟化或者公有云资源池的API，制备虚拟机资源，然后调用Chef完成对虚拟机的配置，完成应用包部署所需要的所有层次的配置。&lt;/li>
&lt;li>环境配置完成后，应用正常运行了，在相关的测试工具对部署后的环境做验收测试，Chef具有支持测试驱动的相关工具。&lt;/li>
&lt;/ul>
&lt;h2 id="基础架构的持续集成">基础架构的持续集成
&lt;/h2>&lt;p>为了实现完整的基础架构持续集成流程，以上持续交付流水线必须具备的能力和概念包括：分层的系统管理、基础架构即代码IaC、配置管理、Chef工具等。下面详细对它们进行描述。&lt;/p>
&lt;h3 id="分层的系统管理">分层的系统管理
&lt;/h3>&lt;p>系统管理的层次涉及到OS相关的三个层次。下面自下而上地简单描述一下。&lt;/p>
&lt;ol>
&lt;li>制备管理：涉及到虚拟化层，这一层是资源表达层，目前所有主流的虚拟化都支持标准的Rest API，包括VMWare、EC2和Nuanix等。大多数主流配置管理工具都具备用于虚拟机生命周期管理（从生成、到开机、到删除等）的API功能，能按需的获得任何数量、规模、网络和操作系统类型的部署环境。&lt;/li>
&lt;li>配置管理：在任何类型的操作系统里自动化的安装和配置软件包，将所有配置参数配置好以后，持续保持这些配置点的状态。对于简单应用，来说按配置参数启动服务即任务完成。&lt;/li>
&lt;li>应用编排管理：对于复杂的分布式系统，由于各个自服务之间存在着依赖关系，所有自服务之前需要互通一些配置参数才能实现，应用程序整体的正常运行，配置应用服务器的odbc数据库连接，配置web前端的ldap认证服务器等等。目前微服务所涉及的服务发现和路由，是应用编排必备的配套设施。&lt;/li>
&lt;/ol>
&lt;p>不同的DevOps配置管理工具也都力求能覆盖以上三个层次，但是他们所追求的方向，或者想解决的主要问题并不相同。因此各个工具之间功能上有重叠。&lt;/p>
&lt;p>因此在运用这些工具的时候，不仅要追求其卓越的功能，还要能意识到，并有意的在不同层面上做取舍。&lt;/p>
&lt;h3 id="基础架构即代码">基础架构即代码
&lt;/h3>&lt;p>IaC这个概念最早是被Chef这类工具提出并实现，它的基本想法就是让Ops人员象开发人员一样的，工作在基础架构的代码上，而不是面对着数十个图形和文字终端界面。使用类似于开发应用程序的方式，开发和管理基础架构环境，因此基础架构能通过API访问和操控是基础，目前所有主流的虚拟化/云计算平台都具备很好的API接口；可惜的是在传统的企业环境中，这些资源池的API功能几乎没有被用到。&lt;/p>
&lt;p>像开发应用代码一样的管理IT基础架构，基础架构的开发和管理也需要遵循与应用开发类似的原则，这些原则包括：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>一切从源代码开始&lt;/strong>:并对其进行严格的版本管理，要对基础架构变更，就需要对相应的代码进行变更和测试，最后发布这些代码。从而力求做到服务器的无人登录运维。&lt;/li>
&lt;li>&lt;strong>模块化设计&lt;/strong>:不同应用底层所使用的基础架构有着大量的相似之处，模块化的设计不仅意味着标准化，也意味着更少的重复代码。我所用过的Terraform、Chef和Puppet这三种工具，都具有高度的模块化特性。&lt;/li>
&lt;li>&lt;strong>抽象能力&lt;/strong>：能够使用不同的模块和参数对任何特征的应用进行建模，用IaC代码进行表达，基础架构的代码开发也就是借助这种抽象能力，将所有管理对象（配置管理项）具体化地描述为应用服务模型。编写出来的基础架构代码，不仅包含了所有对应用配置描述性的语义，而且还是能够被执行的代码，在IaC代码执行之后，你就得到了所期望的虚拟机、应用配置和应用服务。&lt;/li>
&lt;li>&lt;strong>可测试性&lt;/strong>：这是一个经常忽略的能力，而在了解之后，你会发现IaC也是编程语言，就是对基础架构进行高级的编程，而且IaC代码本身和它的运行结果都是可以测试的。在执行前对其语义语法测试，在运行以后对其运行结果测试。Chef在这方面表现的尤为突出。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/chef-logo.png"
loading="lazy"
alt="Chef"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/LogoTerraform.png"
loading="lazy"
alt="Terraform"
>&lt;/p>
&lt;h3 id="配置管理">配置管理
&lt;/h3>&lt;p>我可能是最早的一批进行ITIL配置管理实践，CMDB建设的这批人；我以前和甲方客户有着大量的关于配置管理和CMDB的对话，所经历过的项目也非常煎熬。而在DevOps场景下，感觉以前的经历也是很有意思的，只是我现在说到的CI，在没有特指的情况下，是持续集成的概念，还不是配置项了。&lt;/p>
&lt;blockquote>
&lt;p>Process for establishing and maintaining consistency of a product’s performance, functional and physical attributes with its requirements, design and operational
information throughout its life。&lt;/p>&lt;/blockquote>
&lt;p>以上是配置管理在维基百科里的定义，它所表达的含义还是值得借鉴的；而如今很多人对DevOps的认识，还有人是建立在DevOps配置管理相关的工具上的。为了纠正这个错误观点，我们经常说：“天文学并不只是关于望远镜的。”&lt;/p>
&lt;p>配置管理工具中有很多是基于主机（OS）的管理工具，包括：CFEngine、Puppet、Chef、Salt和Ansible等。它们都具有基础架构即代码的相关原则和特征。都能实现：定义服务器的目标期望状态的能力，在每一次执行周期里，它们都进行状态检查，汇报当前状态和目标状态的偏差，在必要的时候也可以自动的执行必要的状态修复操作。&lt;/p>
&lt;p>Chef这种配置管理工具，使用了Ruby风格的DSL语言，使用者只需要用Chef代码表达”What“即可，而不需要明白”How“；”What“既是对目标配置状态的描述，使用者只需要将需求转换为Chef代码，然后用Chef客户端工具运行它即可。Chef的代码清晰，描述能力强大。在编码的时候遵循DSL规则，如果有必要的话也可以调用Ruby。&lt;/p>
&lt;p>Chef是客户端服务器的架构，安装了&lt;strong>Chef-client&lt;/strong>程序的节点可以注册到一个&lt;strong>Chef管理服务器&lt;/strong>里。&lt;/p>
&lt;p>Chef的开发人员（IaC编码者），在安装了用于和Chef服务器交互的名为&lt;strong>knife&lt;/strong>的工具，称之为&lt;strong>工作站&lt;/strong>的系统上开发基础架构代码。Chef使用大量内置的DSL资源（例如：package，service，file，directory等操作系统资源分类）对目标节点的配置进行建模，代码可以映射到内部的用来执行这些代码的各种&lt;strong>提供者&lt;/strong>上。&lt;/p>
&lt;p>所能实现的示例代码如下所示，下面是配置Linux操作系统中的Apache服务器。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">package&lt;/span> &lt;span class="s1">&amp;#39;httpd&amp;#39;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">action&lt;/span> &lt;span class="ss">:install&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">service&lt;/span> &lt;span class="s1">&amp;#39;httpd&amp;#39;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">action&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="ss">:enable&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">:start&lt;/span> &lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>下面是在Linux操作系统里配置 &lt;code>/a/b/c&lt;/code> 目录&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">directory&lt;/span> &lt;span class="s1">&amp;#39;/a/b/c&amp;#39;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">owner&lt;/span> &lt;span class="s1">&amp;#39;admin&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">group&lt;/span> &lt;span class="s1">&amp;#39;admin&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="s1">&amp;#39;0755&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">action&lt;/span> &lt;span class="ss">:create&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">recursive&lt;/span> &lt;span class="kp">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以下面就是 &lt;code>/a/b/c&lt;/code> 目录的配置结果状态：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$ls&lt;/span> ‐ld /a/b/c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-­‐xr-­‐x. &lt;span class="m">5&lt;/span> admin admin &lt;span class="m">4096&lt;/span> Feb &lt;span class="m">14&lt;/span> 11:22 /a/b/c
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Chef其它的重要术语：&lt;/p>
&lt;ul>
&lt;li>recipe ：包含了一个或者对个资源描述定义（Chef预定义了文件、用户、软件包、服务等等资源，可以扩展开发自定义资源类）&lt;/li>
&lt;li>cookbook ：包含了一个或多个recipe配方&lt;/li>
&lt;li>data bag ：包含了一个或多个配置数据点(data bag item)，是JSON格式，一个cookbook食谱可以包含一个或者多个数据袋&lt;/li>
&lt;li>run list ：包含了一个或者多个cookbook食谱，可将其部署在被管理的node节点上&lt;/li>
&lt;li>role ：一组特定内容的run list运行清单构成了一个角色&lt;/li>
&lt;li>environments：同我们现在对环境的定义，并可以一一对应起来&lt;/li>
&lt;/ul>
&lt;p>Chef是偏主机配置管理的非常的Iac语言，它具有很丰富的扩展能力和生态系统。它有很好的扩展能力，很强的逻辑性，能够进行深度的表达和锻造。它和Terraform和Ansible都有较大差异。&lt;/p>
&lt;h2 id="部署流程设计">部署流程设计
&lt;/h2>&lt;p>将以上手工处理过程转换为自动化执行的、一键式触发或者自动触发的流程需要关注很多个要点。&lt;/p>
&lt;p>使用Chef部署自开发的应用程序，包括配置所依赖的操作系统配置和软件，以及自身所需的应用配置。可以使用Liquibase进行数据库的schema部署和更新。可以用Jenkins协调和组织所有工序的执行。使用Jenkins管理部署流程的感觉和用它执行CI是类似。&lt;/p>
&lt;p>从简单开始，尽量将一组彼此相关的、版本化的可部署物组织在一起发布，例如在一个发布集合中可以包含：UI、REST服务器、消息服务和数据库。尽量使用一条命令构建，使用一条命令部署。&lt;/p>
&lt;h3 id="cookbook设计类型">Cookbook设计类型
&lt;/h3>&lt;p>&lt;strong>Library Cookbook 库食谱&lt;/strong> ：这种类型的食谱涵盖了通用的、可重用的逻辑。例如所有配置基线，也可以是安全基线。例如：dns、ntp、主机登录提示、用户和组、禁用服务清单等等。开发扩展的自定义chef资源，用来部署自开发应用。&lt;/p>
&lt;p>&lt;strong>Application Cookbook 应用系统食谱&lt;/strong> ：在以上库食谱的基础上，为一个套应用系统开发一个Cookbook食谱，每个应用可是一个recipe配方，recipe配方使用自定义开发的Chef资源。这样就形成了非常轻量的代码库。&lt;/p>
&lt;p>&lt;strong>Data Bag 数据袋&lt;/strong>：包含了各种应用配置，例如：服务端口、JAVA_OPTS等等。一个应用系统Cookbook食谱对应一个数据袋，袋子里面包含了该应用在每一套环境里的相关所有配置点。&lt;/p>
&lt;p>上线一个应用的新版本意味着新版本IaC代码的更新和部署，大致的流程是：编辑Chef代码、推送到Chef管理服务器、在节点上运行Chef客户端程序执行部署动作。Chef服务器的版本始终和版本控制库里的Master主干保持一致，这同样意味着环境配置和Master主干代码保持一致。&lt;/p>
&lt;p>用Chef开发自定义应用资源的实例代码如下，这段代码表示了一个Java应用war包的部署。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/carbon.png"
loading="lazy"
alt="carbon"
>&lt;/p>
&lt;p>基于类似于以上的自定义资源类型，在必要的情况下，还可以对其开发Action（chef资源的操作），可能的操作定义有：&lt;/p>
&lt;ul>
&lt;li>从Artifactory服务器下载Java、Tomcat和WAR包。&lt;/li>
&lt;li>在标准的路径安装Java和Tomcat。&lt;/li>
&lt;li>创建和配置Tomcat容器&lt;/li>
&lt;li>在特定的容器里安装WAR包&lt;/li>
&lt;li>在主机上开防火墙端口&lt;/li>
&lt;li>生成应用属性文件&lt;/li>
&lt;li>启动Tomcat容器&lt;/li>
&lt;/ul>
&lt;p>Data Bag数据袋的实例代码结构如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ruby" data-lang="ruby">&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;1.4.9&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;runtime&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;my-­app-­ui&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;java_opts&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;-­‐Xmx2G -­‐XX:MaxPermSize=1024m&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;app_config&amp;#34;&lt;/span>&lt;span class="p">:{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;db.url&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;jdbc:postgresql://devdb:5432/myapp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;svc.foo.url&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;http://devsvc:9000/foo&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上是data_bags/my_app/DEV.json的定义，还可以有其它环境的定义data_bags/my_app/TEST.json和data_bags/my_app/PROD.json等。&lt;/p>
&lt;h2 id="人员角色">人员角色
&lt;/h2>&lt;p>基础架构的持续集成需要Dev和Ops的相互协作，才能做通，才能全面覆盖应用所需要的技术栈。&lt;/p>
&lt;p>&lt;strong>部署人员&lt;/strong> 更data_bag新数据袋和环境定义文件，触发生产环境部署的动作，调度chef-client客户端的运行，或者推送新版本的Chef代码更新。&lt;/p>
&lt;p>&lt;strong>技术负责人&lt;/strong> 维护应用系统Cookbook食谱。&lt;/p>
&lt;p>&lt;strong>框架开发人员&lt;/strong> 维护库Cookbook食谱，维护框架，持续改进流程。&lt;/p>
&lt;p>以上这三种角色，从上到下是从Ops到Dev的过渡。对于传统IT组织的架构，部署人员是Ops团队的，框架开发人员是Dev团队的。&lt;/p>
&lt;p>这三种角色都凑齐了，才能起到全套应用系统的整体建模和编码，而且每个角色都有负责的部分。技术负责人可能是来自Ops和Dev团队的技术大拿。他们对整体的正确性和完整性负责。&lt;/p>
&lt;p>目前也有Dev团队在其内部招聘运维研发的角色。这三种角色是基础架构即代码的层次结构和人员团队架构的对应，在实际工作中可以灵活应用；一方面覆盖所有技术层次，另外一方面引入所有必要的人员，是团队形成合力。&lt;/p>
&lt;p>如果不是本着将全套应用系统做全量的部署，以上任何角色做自己职责范围内的IaC自动化实践，其实效果是事倍功半的，或者机会只有技术学习和探索的价值。&lt;/p>
&lt;h2 id="构建cookbook">构建Cookbook
&lt;/h2>&lt;p>在开发了各种Cookbook之后，我们就需要对其进行持续测试，因此就需要使用Cookbook的持续构建流程。这个步骤就如同我们对应用程序的代码做CI一样。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/cookbook-build.png"
loading="lazy"
alt="cookbook-build"
>&lt;/p>
&lt;p>开发人员（程序员不是业务应用开发者的专业名词，这里指IaC开发者，可能来自任何团队）在Workstations工作站上开发Chef的Cookbook代码，将代码提交到GitHub上的Chef代码仓库。&lt;/p>
&lt;p>Jenkins的Master服务器会触发CI Job，调用Ruby Slave对Cookbook代码进行集成和测试，然后触发EC2临时实例的创建，将Cookbook在EC2实例中进行测试，使用Artifactory中存储的应用软件包部署应用。如果测试都通过了，就触发Release Job，它将Cookbook代码上传到Chef服务器，供所各种环境中的被管理节点使用。&lt;/p>
&lt;p>上图用EC2作为Chef代码的CI环境，可以替代的方案有Vagrant+虚拟化（Virtual Box或者kvm），或者使用其它虚拟机资源池，如Ovirt KVM、Xen、Nutanix。我实际测试过使用Terraform对接Nutanix资源池，虚拟机创建超级快，几乎是秒得的速度。现有的虚拟化资源池就是最方便的对接对象，需要了解一下API和对接工具即可。&lt;/p>
&lt;p>对于Jenkins构建服务器而言，每一套应用系统对应的Cookbook组/集合的测试和发布都会在同一个构建服务器上发生，一般情况下这个服务器也是这些应用的CI服务器；这个Jenkins服务器也是相关Cookbook的CI作业和发布作业的运行地点。这个服务器上会安装所需要的Ruby gem包，应该能访问到与Chef服务器链接所需要的秘钥；应该可以使用到创建EC2测试节点虚拟机的秘钥，或者说访问其他类型虚拟机资源池的用户名和密码。&lt;/p>
&lt;h3 id="cookbook-ci-job">Cookbook CI Job
&lt;/h3>&lt;p>Cookbook CI作业的触发条件是：当有新Chef代码被合并的时候。它会进静态代码扫码和测试工作，包括如下内容：&lt;/p>
&lt;ul>
&lt;li>使用json和gem的相关工具分析JSON的句法&lt;/li>
&lt;li>使用Tailor做Ruby的句法和风格扫描&lt;/li>
&lt;li>使用Knife做Chef代码的句法分析&lt;/li>
&lt;li>使用Foodctritic做Che代码的句法分析和正确性分析&lt;/li>
&lt;/ul>
&lt;p>Chef代码在测试虚拟机里的集成测试是本文的重点，集成测试工具使用Test Kitchen，这个工具有一系列和虚拟化/云环境对接的插件，如 kitchen-ec2插件等。能按需临时的创建用于集成测试的虚拟机，在测试完毕，得出了测试结果之后，就删除本作业所创建的临时虚拟机。&lt;/p>
&lt;p>在集成测试的生命周期过程中也可能创建多个测试虚拟机/EC2实例，这个过程使对应用系统里的所有组件进行仿真的、实际的安装包和服务部署，进行单节点或者多节点的全量应用系统部署。在每个节点上都执行Chef代码，在Chef对应用系统的配置和部署完成之后，在对运行中的应用进行验证测试，测试包括测试相关的服务端口是否能访问，返回结果是否正常等等，Chef是可以进行测试驱动开发的，因此可以写出较细致的测试代码，从而分析本Cookbook集成测试通过与否。在测试结束了以后（最好是10分钟左右或更短），删除所有测试的虚拟机资源。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/nutanix-logo.png"
loading="lazy"
alt="Nutanix"
>&lt;/p>
&lt;p>应该尽可能的优化这个集成测试，尽量缩短它的执行时间。可以创建专用的EC2-AMI/Nutanix/Kvm/VMWare操作系统镜像，预装所需要的Ruby环境和Chef工具。&lt;/p>
&lt;p>使用Chef Solo（不依赖chef服务器）执行Chef代码的测试，以免将临时节点也添加到了Chef服务器，同时也消除了Chef的客户端和服务器架构之间相互通讯的消耗，这个场景里其实没有使用Chef服务器的必要。使用一个名为CHEFDEV的伪环境来测试代码，而JSON文件里定义的真实环境则被保留用于正式生产环境。在创建EC2虚拟机的时候，给它们打上特定的标签，从而保持一定的可追踪性和环境的可维护性。&lt;/p>
&lt;h3 id="cookbook-release-job">Cookbook Release Job
&lt;/h3>&lt;p>这个作业的运行内容和CI Job基本一致的，而它是靠人为手工触发的，从Chef角度看，可以说：本文上述的所有描述，属于Chef风格的基础架构即代码程序的持续交付。本作业将测试成功的代码在GitHub/GitLab里打上标签，并且上传Cookbook的新版本到正式的Chef生产服务器上。&lt;/p>
&lt;p>可以想象经过多个Cookbook的build job之后，Cookbook的某个版本被发布到了生产环境中，用于环境的配置和应用的部署。本Job作业交付了IaC的开发结果到生产环境中的Chef管理服务器。&lt;/p>
&lt;p>其它IaC的基础架构持续及集成与本文描述的也应该是类似流程。&lt;/p>
&lt;h2 id="应用部署流程">应用部署流程
&lt;/h2>&lt;p>Cookbook的开发和集成完毕了以后，它的结果产物是一些列新版本的Cookbook代码，它们最终上传到Chef服务器。支持生产环境应用部署的Chef服务器与各种环境保持连接，包括测试、预发布和生产等等。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/app-deploy-process.png"
loading="lazy"
alt="app-deploy-process"
>&lt;/p>
&lt;p>在发布过程中所使用到的制品是从Artifactory中拉取的。下面简单说下这个架构中的关键点。&lt;/p>
&lt;p>&lt;strong>Jenkins部署服务器&lt;/strong> 这是专门用于各种部署工作的Jenkins Master服务器，它和上一个步骤里Cookbook的Build服务器是不同的。它的Slave应该满足这些需求：安装了所需要Ruby环境和gem包。安装了Chef工具，并且具有能更新Chef服务器的秘钥。具有能访问各种虚拟化环境中节点的SSH秘钥。&lt;/p>
&lt;p>&lt;strong>部署作业的类型&lt;/strong> 可以对于每一个应用组（一套应用系统）设置两个部署作业：在开发环境中的，用于开发人员使用的DEV部署作业；另外是运维人员所使用的Non-Dev部署作业。在实践过程中也能发展出其他类型。&lt;/p>
&lt;p>部署人员的工作流程：&lt;/p>
&lt;ol>
&lt;li>变更Chef相关代码和配置，包括：编辑应用的data bag配置数据点，有必要的话编辑环境文件，合并代码。&lt;/li>
&lt;li>然后在Jenkins部署服务器上执行作业。&lt;/li>
&lt;/ol>
&lt;p>通过以上的流程和工具，开发、测试和运维的相关人员，如果需要部署应用了，就可以用一键式的、自助式的部署模式，将任何应用应用系统通过一键式的方式自动化的部署到各种应用环境中。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/push-button-deploy.png"
loading="lazy"
alt="push-button-deploy"
>&lt;/p>
&lt;p>这样我们将大量各种角色人员都从事的、没有附加值的应用部署工作，彻底的消灭掉了，节省的时间可以用来做更多有意义的工作，Dev人员有更多时间编码、测试人员不需要等待时间、运维人员也降低的工作压力。&lt;/p>
&lt;h2 id="总结">总结
&lt;/h2>&lt;p>关于基础架构的持续集成，还有下列值得参考的原则：&lt;/p>
&lt;ul>
&lt;li>尽可能的标准化：包括技术、设计和流程等方面；要能够支持环境的规模化扩展，例外是可以的，但是要尽量避免。&lt;/li>
&lt;li>所有工具最好有API：避免在某个工具，在工具链上的任何环节的脱节。&lt;/li>
&lt;li>使用多种形式的沟通路径：这个实践需要用各种方式进行宣传和推广，包括：全员大会的主题分享、每个团队的启动会议、与开发人员的随时沟通，使用文档进行知识传播和沟通。&lt;/li>
&lt;li>保持乐观，尽量发现和找到那些志同道合的早期响应者，让他们和你站在一条战线上。&lt;/li>
&lt;/ul>
&lt;h2 id="引用">引用
&lt;/h2>&lt;h3 id="参考视频">参考视频
&lt;/h3>&lt;p>&lt;a class="link" href="https://www.youtube.com/watch?v=PQ6KTRgAeMU" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=PQ6KTRgAeMU
&lt;/a>&lt;/p>
&lt;h3 id="参考书籍">参考书籍
&lt;/h3>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/book-infrastructure-as-code.png"
loading="lazy"
>&lt;/p>
&lt;hr></description></item><item><title>DevOps on Nutanix[Beta]</title><link>https://martinliu.cn/blog/devops-on-nutanix/</link><pubDate>Mon, 26 Feb 2018 11:08:53 +0800</pubDate><guid>https://martinliu.cn/blog/devops-on-nutanix/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/testdrive_background.jpg" alt="Featured image of post DevOps on Nutanix[Beta]" />&lt;p>Nutanix是什么？中文名字是路坦力，是我目前所在的公司；我负责运营商行业以及与云服务商的合作业务，解决客户在售前、架构和DevOps等方面的问题，我是Nutanix Calm产品的专家。&lt;/p>
&lt;p>之前也发过一些介绍Nutanix和超融合技术的文章，本文会是一篇持续更新的文章，我会把在Nutanix上开展超融合的方法，持续的更新在这里。&lt;/p>
&lt;p>本文上属于Beta版本，会持续更新，欢迎各种类型的反馈信息，发邮件到： &lt;a class="link" href="mailto:martin.liu@nutanix.com" >martin.liu@nutanix.com&lt;/a>&lt;/p>
&lt;p>变更日志：&lt;/p>
&lt;ul>
&lt;li>2018-2-26，发表了相关概况介绍性内容&lt;/li>
&lt;/ul>
&lt;h2 id="什么是devops">什么是DevOps？
&lt;/h2>&lt;blockquote>
&lt;p>我的定义：DevOps是为了将软件开发、运维和质量保证等部门紧密地协作和集成在一起，而运用的一组成熟的、相互融合在一起的最佳实践。它使人们能准时/及时地生产软件产品或服务，从而满足企业的某个业务目标，开发与运维工作将在一个统一的目标之下协同工作，它是对IT组织内部各个角色之间的相互依存关系的一种新的理解。这个实践集合主要包含了四种最佳实践，如下图所示：&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="http://res.cloudinary.com/martinliu/image/upload/q_auto:eco/devops-house.png"
loading="lazy"
alt="DevOps 定义"
>&lt;/p>
&lt;p>注意：上图里Nutanix的定位在持续交付，超融合平台能高速平滑的交付IT服务。&lt;/p>
&lt;p>来自网络的其它定义还有如下。&lt;/p>
&lt;blockquote>
&lt;p>定义2：You cannot buy DevOps and install it. DevOps is not just automation or infrastructure as code. DevOps is people following a process enabled by products to deliver value to end users. &amp;ndash; Donovan Brown, Microsoft DevOps Program Manager&lt;/p>&lt;/blockquote>
&lt;p>以上出自：&lt;a class="link" href="http://www.donovanbrown.com/post/2015/09/01/what-is-devops" target="_blank" rel="noopener"
>Donovan&amp;rsquo;s blog post on &amp;ldquo;What is DevOps&amp;rdquo;.&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>定义3：DevOps（Development和Operations的组合词）是一种重视“软件开发人员（Dev）”和“IT运维技术人员（Ops）”之间沟通合作的文化、运动或惯例。透过自动化“软件交付”和“架构变更”的流程，来使得构建、测试、发布软件能够更加地快捷、频繁和可靠。&lt;/p>&lt;/blockquote>
&lt;p>以上出自：&lt;a class="link" href="http://zh.wikipedia.org/wiki/DevOps" target="_blank" rel="noopener"
>维基百科 Wikipedia - DevOps&lt;/a>&lt;/p>
&lt;h2 id="什么是hci-超融合基础架构">什么是HCI-超融合基础架构
&lt;/h2>&lt;p>我对超融合的定义：将计算、存储和网络这三种资源的至少两种融合在一起的技术就可以称之为超融合技术。Nutanix是将计算和存储融合在了一个系统只能，这里说的系统可以理解一个物理的机箱，并且在这个机箱里搭载了目前业内最通用的KVM虚拟化功能。Nutanix的超融合系统是开箱即用的IaaS平台，可以无节点数限制的水平扩展，能够支持服务器虚拟化、VDI、Oracle RAC等关键性数据库、企业核心业务系统、大数据和私有云等工作负载。在性能和功能上是专门为HCI而打造的。HCI技术正在颠覆着传统的三层架构技术堆栈（指的是：服务器-存储网络-集中存储）。&lt;/p>
&lt;p>Nutanix在2018年Gartner融合基础架构分析报告中，Nutanix在领导象限里遥遥领先。&lt;/p>
&lt;p>&lt;img src="http://res.cloudinary.com/martinliu/image/upload/Gartner-report-2018.png"
loading="lazy"
alt="Gartner 报告"
>&lt;/p>
&lt;p>2018 年 2 月 9 日，北京 ——企业云计算领域的领先企业 Nutanix（纳斯达克：NTNX）今天宣布， Gartner 将 Nutanix 评为 2018 年 Gartner 超融合基础架构（HCI）魔力象限领导者。Nutanix 认为，此次跻身“领导者”象限有力印证了 Nutanix 在其率先开拓的市场上的领导地位，也充分彰显了公司致力于提供下一代企业云操作系统的愿景。&lt;/p>
&lt;p>随着越来越多的企业机构认识到超融合基础架构（HCI）的优势，企业基础设施正在经历根本性的转变。这些企业机构采用了一种新的架构设计，将网络规模技术和消费级设计相融合，实现“隐形基础设施”，从而使 IT 团队能将更多的时间投入到业务应用中。同时，这些企业机构还纷纷采取了能够利用多云基础设施和云服务的 IT 战略。&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>Nutanix 认为，利用其企业云操作系统软件，用户不但能实现公有云的精简性、敏捷性以及部分 IT 消费收益，还能保障企业数据中心的高可控性与安全性。在融合了私有云、公有云和分布式云的统一 IT 操作环境下，Nutanix 企业云操作系统软件提供单点控制来管理任何云的基础设施与应用，从而为云运营商和采用云交付式服务及应用的用户提供统一、高性能、无缝的使用体验。&lt;/p>
&lt;p>关于Nutanix的更多视频，&lt;a class="link" href="http://i.youku.com/i/UMzM5NzI4MDg1Mg==?spm=a2hzp.8244740.0.0" target="_blank" rel="noopener"
>请访问Youku的频道。&lt;/a>&lt;/p>
&lt;h3 id="学习nutanix核心技术">学习Nutanix核心技术
&lt;/h3>&lt;p>关于Nutanix超融合系统的核心技术特性请访问：&lt;a class="link" href="http://nutanixbible.com/" target="_blank" rel="noopener"
>Nutanix 圣经&lt;/a>，圣经网站上有中文版本pdf下载，最近会有一次中文版的修订请关注。&lt;/p>
&lt;h3 id="试用nutanix产品">试用Nutanix产品
&lt;/h3>&lt;p>Nutanix提供免费的社区版本，对此感兴趣的人都可以下载和使用。使用这个版本，你能够在几个小时内，搭建起数量为1、3或者4个的物理服务器组成的Nutanix集群。&lt;/p>
&lt;p>关于如何安装和试用Nutanix CE版本的技术文档，访问我的Nutanix实验室文档站点：&lt;a class="link" href="https://nutanix.martinliu.cn/" target="_blank" rel="noopener"
>https://nutanix.martinliu.cn/&lt;/a>&lt;/p>
&lt;h2 id="使用nutanix-calm实现devops持续交付">使用Nutanix Calm实现DevOps持续交付
&lt;/h2>&lt;p>Nutanix是一种开箱即用的高性价比的虚拟化资源池，你可以用最小的时间成本完成大规模资源池的搭建和部署。而现实情况下：所有企业的虚拟化管理员的工作模式还是基于工单的手工VM模板克隆的方式。还没有人能将基于vm的业务系统做到自动化的持续交付。Nutanix Calm就是一项解决这个问题的技术。它是Nutanix超融合系统内置的一个功能，可以一键式的开启这项功能。&lt;/p>
&lt;p>&lt;img src="http://res.cloudinary.com/martinliu/image/upload/WechatIMG224.jpeg"
loading="lazy"
alt="Nutanix Calm"
>&lt;/p>
&lt;p>Nutanix Calm的主要功能如下所示：&lt;/p>
&lt;ul>
&lt;li>应用生命周期管理：利用预定义的应用蓝图，全面地实现了传统型多层应用和流行的分布式服务的自动化运维，包括系统制备、扩缩容和资源释放等操作。应用蓝图将极大地简化了私有云和公有云的应用管理和运维。&lt;/li>
&lt;li>应用蓝图管理：将应用系统的所有组成部分（包括相关的虚拟机、配置和可执行程序）融入到了一个可视化的、操作直观的蓝图里，从而简化了企业应用的配置管理和日常运维。应用蓝图提升了基础架构团队的管理效率。IT团队再也不用像以前那样，在应用管理的日常工作上花费大量时间。&lt;/li>
&lt;li>Nutanix应用市场：应用蓝图可以在Nutanix 应用市场（Marketplace）里把应用直接发布给最终用户，使产品经理和开发人员能够持续交付产品，快速地供给应用，及时地满足IT服务请求。&lt;/li>
&lt;li>应用治理：Calm基于角色的访问控制机制可以限制用户的操作权限。此外，系统会集中地记录所有操作活动和变更，可以实现端到端的可追溯性，这些信息可以提供给安全团队，用来配合相关合规审核工作。&lt;/li>
&lt;li>混合云管理：能在混合云的架构里，自动化地制备应用，包括AWS公有云环境，能实现多层应用和分布式应用的弹性扩缩容。Calm能全局统计资源用量，让您对公有云的实际消费成本一目了然，方便您按照业需求和预算做出合理的决策。&lt;/li>
&lt;/ul>
&lt;p>Nutanix Calm的蓝图编辑器如下所示。&lt;/p>
&lt;p>&lt;img src="http://res.cloudinary.com/martinliu/image/upload/blueprint.png"
loading="lazy"
alt="Nutanix Calm Blueprint"
>&lt;/p>
&lt;p>在我的&lt;a class="link" href="https://nutanix.martinliu.cn/" target="_blank" rel="noopener"
>Nutanix实验室：&lt;/a>文档站点里已经写了一些操作使用的方法和产品截图。如果您已经是Nutanix用户了，请参考和使用这些文档。如果你还不是的话，可以联系Nutanix试用这个产品。&lt;/p>
&lt;hr>
&lt;p>后续会持续更新这一部分，会根据DevOps的逻辑将Nutanix Calm的能力全面的展示出来，敬请期待。&lt;/p>
&lt;h2 id="使用nutanix实现完美的docker-datacenter体验">使用Nutanix实现完美的Docker Datacenter体验
&lt;/h2>&lt;p>CaaS on IaaS的简洁实现方式莫过于在Nutanix超融合平台上部署Docker Datacenter产品。其实Docker Datacenter还是一个很容易使用的Docker平台，易用性非常好，入门级Docker用户建议走这条路试试，毕竟K8s的学习曲线目前还比较陡峭。&lt;/p>
&lt;p>这个组合的免费试用方法：&lt;/p>
&lt;ol>
&lt;li>安装部署Nutanix CE（文档见Nutanix实验室）&lt;/li>
&lt;li>申请和下载Docker Datacenter的安装包和许可证文件（10个节点免费试用，30天到期了还可以无限次延续）&lt;/li>
&lt;li>在Nutanix上创建10个虚拟机用于部署Docker Datacenter&lt;/li>
&lt;li>安装部署Docker Datacenter （&lt;a class="link" href="https://nutanix.martinliu.cn/04-nucalm-advance/02-owncloud-dvp/" target="_blank" rel="noopener"
>文档见Nutanix实验室&lt;/a>）&lt;/li>
&lt;li>Enjoy it forever!&lt;/li>
&lt;/ol>
&lt;p>如果你使用4台物理服务器安装Nutanix CE，建议的服务器配置：2路20核 Intel XeonCPU，内存256，SSD 512GB一块，SAS HDD 4TB两块；这样形成的群集的总资源量：&lt;/p>
&lt;ul>
&lt;li>160个物理CPU核，一个物理核跑两个虚拟机的话，你可以跑320个虚拟机；当然内存够的情况下，你还可以尝试更高的整合比，如1个物理的核带5到10个虚拟机&lt;/li>
&lt;li>总存储空间为18TB，使用两副本存数据，你有9TB可用空间，打开去重压缩等功能的话你可以拥有更多的存储空间。&lt;/li>
&lt;li>2TB的SSD存储可以让你应付大量的热数据，所有热数据相当于使用了全闪存储一般。&lt;/li>
&lt;li>建议这些服务器使用10GB或更高速的以太网，以保证更优雅的性能&lt;/li>
&lt;li>不建议这个环境跑生产负载，记住不要把研发环境不算生产负载。&lt;/li>
&lt;li>如果需要生产级别的保障，请考虑使用费CE版本的正式Nutanix产品。&lt;/li>
&lt;/ul>
&lt;h2 id="使用nutanix-acs20实现完美的k8s体验">使用Nutanix ACS2.0实现完美的K8s体验
&lt;/h2>&lt;p>此产品预计18年发布，敬请期待。&lt;/p></description></item><item><title>Devops Handbook《DevOps实践指南》简介</title><link>https://martinliu.cn/blog/devops-handbook/</link><pubDate>Sun, 25 Feb 2018 22:27:16 +0800</pubDate><guid>https://martinliu.cn/blog/devops-handbook/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/IT_Revolution_press.png" alt="Featured image of post Devops Handbook《DevOps实践指南》简介" />&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/TMNS-book-review-DevOps-1.png"
loading="lazy"
alt="本文内容主要来源"
>&lt;/p>
&lt;p>企业如何通过DevOps实践提高盈利能力，改善工作文化，实现卓越的生产力目标。如今这些高绩效管理技术比以往的任何时候都要更加重要，由于这对于企业的商业竞争力而言是至关重的，数十年以来，技术组织的领导者们始终在努力地维持这IT系统的敏捷性、可靠性和安全性。然后惨痛的案例依然比比皆是&amp;ndash;不论是healthcare.gov的崩溃，持卡人数据的泄露；还是在云计算环境中大数据的丢失。&lt;/p>
&lt;p>然而，那些运用DevOps原则的高绩效企业（例如Google，Amazon，Facebook，Etsy和Netflix）则每天都可以在生产环境中成百上千次频繁地部署代码。那么DevOps理论、原则和实践到底是何等的殊胜呢？相信所有人在看了本书之后一定会得到答案。&lt;/p>
&lt;h2 id="通过数字看这本书">通过数字看这本书
&lt;/h2>&lt;h3 id="基础数据">基础数据
&lt;/h3>&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/devops-handbook-by-number.png"
loading="lazy"
alt="本文内容主要来源"
>&lt;/p>
&lt;h3 id="原作者4人">原作者4人
&lt;/h3>&lt;p>Jene Kim是这本书的主要作者，他在出版了《凤凰项目》之后，开始与其他三位作者编写本书的。Jez Humble是《持续交付》的作者，是持续交付实践和概念的重要发起人。Patrick Debios是DevOpsDays大会的发起人，是他最早在Twiter是用 #DevOps 这个短标签的，是DevOps运动和社区的重要人物。John Willis是DevOps社区早期的推动者之一，曾任Docker公司生态系统发展总监。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/handbook-AUTHORS.png"
loading="lazy"
alt="authors"
>&lt;/p>
&lt;h3 id="译者4人">译者4人
&lt;/h3>&lt;p>在我和人民邮电出版社联系并进行试译之后，组织了翻译小组。王磊和马博文是我这几年结识的DevOps圈内的技术大拿；曾朝京是IT管理领域的资深专家，是我的前同事。王磊的著作有&lt;a class="link" href="https://www.amazon.cn/dp/B018SRCFI6/" target="_blank" rel="noopener"
>《微服务架构与实践》&lt;/a>；马博文翻译的书籍有&lt;a class="link" href="https://www.amazon.cn/dp/B01LWLRQF3/" target="_blank" rel="noopener"
>《DevOps 实践》&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/devops-handbook-translator.png"
loading="lazy"
alt="translator"
>&lt;/p>
&lt;blockquote>
&lt;p>刘征，Nutanix路坦力资深架构师。Exin首批国内DevOps Master和DevOps Professional认证讲师。持有红帽RHCA认证和AWS高级架构师认证。谙熟企业数据中心的IT服务管理。目前致力于推广DevOps相关的理念和实践，在DevOps社区中积极地参与培训和研讨会等活动，DevOpsDays大会活动在中国的核心组织者。&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>王磊，前ThoughtWorks首席咨询师，EXIN首批国内DevOps Master认证教练。较早倡导和实践微服务的先行者，著有国内首本微服务架构相关书籍《微服务架构与实践》一书。超过10年以上的软件行业经验，对服务化架构、持续交付以及DevOps转型等有丰富的实践经验，同时他也是西安DevOpsMeetup联合发起人，西安GDCR组织者，并译有《Ruby Gems开发实战》一书。&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>马博文, 前ThoughtWorks 高级咨询师，AWS助理架构师。曾从事多年web开发和DevOps，熟悉持续交付，微服务。参与翻译《Scala编程实战》、《DevOps实践》等书，是西安DevOps Meetup活动的发起人。&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>曾朝京，Micro Focus资深解决方案顾问，参加Exin首批国内Devops Master讲师认证培训。长期从事IT运维管理领域咨询工作，曾为能源、金融、航空运输、政府行业中的多个大型企业提供 IT 运维管理规划。目前致力于探索Devops理念在企业IT部门的实践。&lt;/p>&lt;/blockquote>
&lt;p>翻译小组完成翻译，并提交给出版社的日期是2017年12月8日。&lt;/p>
&lt;h2 id="目录提前曝光">目录提前曝光
&lt;/h2>&lt;p>本书目前（本文的发布日期）正处于出版社编辑阶段。预计在五月份左右正式出版。下面是本书的目录。&lt;/p>
&lt;ul>
&lt;li>序言&lt;/li>
&lt;li>前言&lt;/li>
&lt;li>导言：展望DevOps新世界&lt;/li>
&lt;li>第一部分 三步工作法
&lt;ul>
&lt;li>第1章 敏捷、持续交付和三步法&lt;/li>
&lt;li>第2章 第一步，流动原则&lt;/li>
&lt;li>第3章 第二步，反馈原则&lt;/li>
&lt;li>第4章 第三步，持续学习与实验原则&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>第二部分 从何处开始
&lt;ul>
&lt;li>第5章 选择合适的价值流作为切入点&lt;/li>
&lt;li>第6章 理解、可视化和运用价值流&lt;/li>
&lt;li>第7章 参考康威定律设计组织结构&lt;/li>
&lt;li>第8章 将运维融入日常开发工作&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>第三部分 第一步：流的技术实践
&lt;ul>
&lt;li>第9章 为部署流水线奠定基础&lt;/li>
&lt;li>第10章 实现快速可靠的自动化测试&lt;/li>
&lt;li>第11章 应用和实践持续集成&lt;/li>
&lt;li>第12章 自动化和低风险发布&lt;/li>
&lt;li>第13章 降低发布风险的架构&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>第四部分 第二步：反馈的技术实践
&lt;ul>
&lt;li>第14章 建立能发现并解决问题的遥测系统&lt;/li>
&lt;li>第15章 分析遥测数据以更好地预测故障和实现目标&lt;/li>
&lt;li>第16章 应用反馈实现安全部署&lt;/li>
&lt;li>第17章 将假设驱动的开发和A/B测试融入日常工作&lt;/li>
&lt;li>第18章 建立评审和协作流程以提升当前工作的质量&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>第五部分 第三步：持续学习与实验的技术实践
&lt;ul>
&lt;li>第19章 将学习融入每天的工作中&lt;/li>
&lt;li>第20章 将局部经验转化为全局改进&lt;/li>
&lt;li>第21章 预留组织学习和改进的时间&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>第六部分 集成信息安全、变更管理和合规性的技术实践
&lt;ul>
&lt;li>第22章 将信息安全融入每个人的日常工作&lt;/li>
&lt;li>第23章 保护部署流水线&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>行动起来 - DevOps手册总结&lt;/li>
&lt;li>附录&lt;/li>
&lt;li>附加资源&lt;/li>
&lt;/ul>
&lt;p>以上目录标题有可能在出版社的编辑过程中会有所调整。不过已经可以看出其主要内容。&lt;/p>
&lt;h2 id="来自出版社-it-revolution-press-october-6-2016">来自出版社-IT Revolution Press (October 6, 2016)
&lt;/h2>&lt;p>&lt;img src="http://res.cloudinary.com/martinliu/image/upload/q_auto:eco/handbook-1.jpg"
loading="lazy"
alt="DevOps Handbook"
>&lt;/p>
&lt;p>&lt;a class="link" href="https://itrevolution.com/book/the-devops-handbook/" target="_blank" rel="noopener"
>IT Revolution Press&lt;/a>是 &lt;em>DevOps Handbook&lt;/em> 一书的的出版社，位于美国的波特兰市。这本书的简体中文版的书名是《DevOps实践指南》，它是作者继《凤凰项目》之后的一个重大作品，它向你展示了如何将产品经理、开发、质量保证、IT运维和信息安全集成在一起，从而帮助你提升企业的竞争力并赢得市场；如何复制前人那些惊人的DevOps经验成果。&lt;/p>
&lt;p>那么《DevOps实践指南》是否适合你？本书的作者Gene Kim、Jez Humble、Patrick Debois和John Willis为那些希望对IT组织进行转型的人共同编写了此书；特别是为那些想通过DevOps实际进行重大的变革，从而提高生产力、盈利能力并赢得市场的人。这本书涉及DevOps转型的很多方面，是一本从规划到实操的全方位指南，同时它还介绍了DevOps的历史背景，支撑DevOps的各种原则，以及数十个DevOps案例研究。它还提供了各种最佳实践，能有助于组织团结团队一心，使他们实现共同目标，同时获得高层领导支持。&lt;/p>
&lt;p>《DevOps实践指南》深入地研究了DevOps的三个基本原则，现在我们称其为“DevOps工作三步法”，它们是流动、反馈、持续学习与实验”。 《DevOps实践指南》是Gene Kim继《凤凰项目》一书之后编写的，在那本书里也对“三步法”作了概括的描述，后来发展成为本书第一部分的重要内容。&lt;/p>
&lt;p>随着本书循序渐进地揭示DevOps工作三步法，读者将能够清晰的了解到，那些高绩效公司是如何利用这些原则取得成功的。希望任何大型组织也能够复制这些高绩效企业所使用过的成功经验，从而指导他们自己也进行一场成功的DevOps转型。本书用六个部分描述了详实的内容，其中包括：&lt;/p>
&lt;ul>
&lt;li>在五年时间里，4位合著者为本书投入了2000多小时的工作时间&lt;/li>
&lt;li>40多个DevOps案例研究，包括亚马逊，Etsy，Capital One，Google，Facebook，Intuit，Nationwide保险等等&lt;/li>
&lt;li>编写了长达400多页的DevOps实践指南、经验总结和工作指导。&lt;/li>
&lt;li>参考和使用来来自25,000多个数据收集点的DevOps相关数据。&lt;/li>
&lt;/ul>
&lt;p>《Phoenix项目》（英文版）已经售出35万本，2018年2月进行了第五次印刷。《DevOps实践指南》从DevOps的历史开始讲起，解释了它是怎样从数十年的相关联的知识体系中发展出来的，以及由此应运而生的相关技术、架构和文化实践。在为读者奠定了这些历史基础后，读者就能够深入了解三步工作法的原则了。读者将逐步对当今的DevOps相关理论和原则有更深入的理解。在本书的相关章节里介绍了各种具体原则和模式，以及如何将它们应用在实际的技术价值流中。&lt;/p>
&lt;p>我们很自豪的宣布 DevOps Handbook - 《DevOps实践指南》获得了2016年，年度DevOps最佳图书奖，详见：&lt;a class="link" href="https://devops.com/the-2016-devops-dozen-winners-announced/" target="_blank" rel="noopener"
>https://devops.com/the-2016-devops-dozen-winners-announced/&lt;/a>&lt;/p>
&lt;h2 id="在亚马逊书网上书店">在亚马逊书网上书店
&lt;/h2>&lt;p>本书的英文版本在亚马逊有三种格式：Kindle、纸质印刷版和有声书版本。这本书的排名和评价如下，下图的抓取时间是：2018-2-25。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/handbook-rank.png"
loading="lazy"
alt="排名"
>&lt;/p>
&lt;ul>
&lt;li>在信息管理分类里排名：7&lt;/li>
&lt;li>在流程和基础架构里排名：107&lt;/li>
&lt;li>在管理书籍里排名：111&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/handbook-reviews.png"
loading="lazy"
alt="书评"
>&lt;/p>
&lt;p>有85%的读者给本书了5星的评价。关于这本书在亚马逊的最新状态，&lt;a class="link" href="https://www.amazon.com/DevOps-Handbook-World-Class-Reliability-Organizations/dp/1942788002/ref=tmm_pap_swatch_0?_encoding=UTF8&amp;amp;qid=&amp;amp;sr=" target="_blank" rel="noopener"
>请点这里。&lt;/a>&lt;/p>
&lt;p>本书的日文版是在2017年6月在日本发布的，&lt;a class="link" href="http://amzn.asia/2Yqn47O" target="_blank" rel="noopener"
>详情见日本亚马逊网站&lt;/a>。&lt;/p>
&lt;h2 id="本书的使用方式">本书的使用方式
&lt;/h2>&lt;p>在上一篇文章《DevOps登山指南》里我分析和介绍了美国金融行业Nationwide保险公司的DevOps案例，&lt;a class="link" href="https://martinliu.cn/posts/devops-climbing-guide/" target="_blank" rel="noopener"
>原文点这里&lt;/a>。这家公司在实施DevOps的过程中将本书做为参考指南，所有DevOps团队通过每周一次的读书会的方式，持续地对照和改进自己的DevOps实践状态。他们总结出来的DevOps项目实施指南如下图所示：&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/devops-climbing-guide.jpg"
loading="lazy"
alt="DevOps登山指南手册"
>&lt;/p>
&lt;p>本图在Nationwide公司内部的使用场景如下：&lt;/p>
&lt;ol>
&lt;li>本图将DevOps实施核心团对指导产品开发团队（也可以说是业务团队、服务团队、这样的团队他们有200多个）取得的经验总结在一张纸上，供其它有实施DevOps想法的团队参考。&lt;/li>
&lt;li>该登山指南简化了对其它非DevOps团队的教育和指引。&lt;/li>
&lt;li>他们将DevOps的实施分成三个阶段，分别用大本营、北坡营地和顶峰作比喻。&lt;/li>
&lt;li>这三个阶段里的技术实践都来自于DevOps Handbook，通过他们的筛选和整理，并根据自己的经验做了分阶段的规划。&lt;/li>
&lt;/ol></description></item><item><title>DevOps工作三步法：第一步流动原则</title><link>https://martinliu.cn/blog/devops-first-way-flow/</link><pubDate>Wed, 21 Feb 2018 23:10:01 +0800</pubDate><guid>https://martinliu.cn/blog/devops-first-way-flow/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/IT_Revolution_press.png" alt="Featured image of post DevOps工作三步法：第一步流动原则" />&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/TMNS-book-review-DevOps-1.png"
loading="lazy"
alt="本文内容主要来源"
>&lt;/p>
&lt;p>本文内容主要来源于《DevOps Handbook》-DevOps实践指南，本文概述的原则是DevOps工作三步法的第一步，它的目标是先建立最底层的基础，即：DevOps技术实践和合理的应用架构；只有这样才能使工作快速而稳定地从开发端流动到运维端；与此同时还能保证不会给生产环境带来混乱，不会中断客户的服务。这就意味着需要降低在生产环境中部署和发布变更的风险。可以通过 &lt;em>持续交付&lt;/em> 的技术实践来实现这个目标。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/first_way.png"
loading="lazy"
alt="The first way flow"
>&lt;/p>
&lt;p>持续交付基于稳定的自动化部署流水线，团队能够使用自动化测试持续验证代码，确保代码始终处于可部署的状态，开发人员要保证每天都向主干提交代码，以及设计和实现有利于实施低发布风险的环境和软件架构。&lt;/p>
&lt;p>在流动原则的指导下，需要开展的重要的工作内容如下：&lt;/p>
&lt;ul>
&lt;li>奠定部署流水线的基础&lt;/li>
&lt;li>实现快速、可靠的自动化测试&lt;/li>
&lt;li>实现并实践持续集成和持续测试&lt;/li>
&lt;li>通过自动化、架构解耦等方式实现低风险发布&lt;/li>
&lt;/ul>
&lt;p>以上技术实践能够有效地缩短创建类生产环境的前置时间。同时，持续测试可以为所有团队成员提供快速的反馈，使小型团队能够安全、独立地开发、测试和向生产环境部署代码，从而将生产环境的部署和发布作为日常工作的一部分。&lt;/p>
&lt;p>此外，通过将QA人员和运维人员的任务集成到DevOps实施团队的日常工作中，能够减少救火、困境以及繁琐的重复劳动的发生，使团队成员的工作高效且充满乐趣。这不仅能提升团队的工作质量，还能提高组织的竞争力。&lt;/p>
&lt;p>流动原则相关的详细技术实践请参考请《DevOps实践指南》一书的第三部分，这部分包含第10章到第13章，一共描述了5个技术实践。&lt;/p>
&lt;p>在流动原则里我们强调的而是全局的目标而不是局部的目标，局部目标的例子如下所示：&lt;/p>
&lt;ul>
&lt;li>特性开发完成率&lt;/li>
&lt;li>测试发现/修复缺陷的比例&lt;/li>
&lt;li>运维的可用性指标&lt;/li>
&lt;/ul>
&lt;p>我们需要减少价值流中的工作交接的次数，由于当交接次数多到一定程度时，所有人就会彻底的迷失，无法回答工作的上下文联系是什么？也不清楚我们要解决的是什么问题？或者组织的全局目标是什么？&lt;/p>
&lt;h2 id="价值流的应用实例">价值流的应用实例
&lt;/h2>&lt;p>如果我们选择做DevOps转型的项目是棕地项目，我们就需要对当前的工作，进行细致的值流研讨和分析；需要画出当前的状态。如下图的示例所示（注：这是一个示例，你的棕地项目分析完之后并非如此）。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/VSM-As-Is.jpg"
loading="lazy"
alt="VSM as is"
>&lt;/p>
&lt;p>为了在实施DevOps的过程中持续的度量和改进，我们需要分析出当前价值流的核心定量指标：&lt;/p>
&lt;ol>
&lt;li>总计前置时间 = 求和价值流中每个工作步骤里的LT 【这个指标是DevOps项目的北极星】&lt;/li>
&lt;li>总计增值时间 = 求和值流中每个工作步骤里的VA&lt;/li>
&lt;li>完成且精确百分比 = 连乘值流中每个工作步骤的%C/A&lt;/li>
&lt;/ol>
&lt;p>如果是绿地项目，我们在第一个工作周里，价值流图是没有这些数值的。我们需要每天都在CI/CD流水线工具中采集相关数据，在每个人的日常工作中关注和记录相关数据，在第二周和后续的每一周里度量和分析以上指标，最好用仪表板展示工具，将这些数据实时地显示在所有项目组成员都可以轻松看到的位置。&lt;/p>
&lt;p>对这个价值流进行持续的优化，使它更高效的工作，并不断的进化和改进。如果是棕地项目，那么在分析完以上的机制流之后，可以定制新的进化版的价值流图，并按照新版本的价值流图重新开始项目的执行。如下图的示例所示（注：这是一个示例，你的棕地项目改进优化完之后并非如此）。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/VSM-To-Be.jpg"
loading="lazy"
alt="VSM as is"
>&lt;/p>
&lt;h2 id="优化和改进日常工作">优化和改进日常工作
&lt;/h2>&lt;h3 id="goldratt博士的约束理论toc">Goldratt博士的约束理论(TOC)
&lt;/h3>&lt;p>在实践运用流动原则的技术实践时，可以使用Goldratt博士给出的方法，随时识别并解决价值流中的约束点，这个五步法如下：&lt;/p>
&lt;ul>
&lt;li>识别系统的约束点。&lt;/li>
&lt;li>决定如何利用这个系统约束点。&lt;/li>
&lt;li>基于上述决定，考虑全局工作。&lt;/li>
&lt;li>改善系统的约束点。&lt;/li>
&lt;li>如果约束点已经突破了，请回到第一步，但要杜绝惯性导致的系统约束。&lt;/li>
&lt;/ul>
&lt;p>以上五步法是DevOps实施项目组日常工作的必备流程优化工具。&lt;/p>
&lt;h3 id="常见的4个约束点">常见的4个约束点
&lt;/h3>&lt;p>传统企业或者团队里最容易发生的约束点有一定的共性，一般可能会按照以下顺序逐个攻克和优化：&lt;/p>
&lt;ol>
&lt;li>环境搭建&lt;/li>
&lt;li>代码部署&lt;/li>
&lt;li>测试的准备和执行&lt;/li>
&lt;li>紧密耦合的架构&lt;/li>
&lt;/ol>
&lt;p>可以清楚的看到大多数约束点比较偏Ops这一侧，而攻克所有这些约束点需要Dev和Ops一起协作完成。&lt;/p>
&lt;h3 id="常见的9中浪费">常见的9中浪费
&lt;/h3>&lt;p>在DevOps工作团队里需要尽快能地避免以下浪费现象的发生：&lt;/p>
&lt;ul>
&lt;li>半成品&lt;/li>
&lt;li>额外/多余工序&lt;/li>
&lt;li>额外/多余功能&lt;/li>
&lt;li>任务切换&lt;/li>
&lt;li>等待&lt;/li>
&lt;li>移动&lt;/li>
&lt;li>缺陷&lt;/li>
&lt;li>非标准或手工操作&lt;/li>
&lt;li>填坑侠&lt;/li>
&lt;/ul>
&lt;p>以上浪费现象最早是从制造行业的精益管理中总结出来的，这些也是完全可以应用到技术价值流中，IT相关的工作能对每一条有很多痛点清晰的解读，你可以尝试在自己的工作环境中寻找以上所有浪费现象。&lt;/p>
&lt;h2 id="devops工作三步工作法-in凤凰项目">DevOps工作三步工作法 in《凤凰项目》
&lt;/h2>&lt;p>在本书中，我们阐述了这一基础原理，即所有开发运维模式都来自“三步工作法”，它旨在阐明指导开发运维的流程与实践的价值观与理念。&lt;/p>
&lt;p>&lt;strong>第一工作法&lt;/strong>是关于从开发到IT运维再到客户的整个自左向右的工作流。为了使流量最大化，我们需要小的批量规模和工作间隔，绝不让缺陷流向下游工作中心，并且不断为了整体目标（相对于开发功能完成率、测试发现/修复比率或运维有效性指标等局部目标）进行优化。&lt;/p>
&lt;p>必要的做法包括持续构建、集成以及部署，按需创建环境，严控半成品，以及构建起能够顺利变更的安全系统和组织。&lt;/p>
&lt;p>&lt;strong>第二工作法&lt;/strong>是关于价值流各阶段自右向左的快速持续反馈流，放大其效益以确保防止问题再次发生，或者更快地发现和修复问题。这样，我们就能在所需之处获取或嵌入知识，从源头上保证质量。&lt;/p>
&lt;p>“必要的做法包括：在部署管道中的构建和测试失败时“停止生产线”；日复一日地持续改进日常工作；创建快速的自动化测试套装软件，以确保代码总是处于可部署的状态；在开发和IT运维之间建立共同的目标和共同解决问题的机制；建立普遍的产品遥测技术，让每个人都能知道，代码和环境是否在按照设定的运行，以及是否达到了客户的目标。&lt;/p>
&lt;p>&lt;strong>第三工作法&lt;/strong> 是关于创造公司文化，该文化可带动两种风气的形成：不断尝试，这需要承担风险并从成功和失败中吸取经验教训；理解重复和练习是熟练掌握的前提。”&lt;/p>
&lt;p>“尝试和承担风险让我们能够不懈地改进工作系统，这经常要求我们去做一些与几十年来的做法大不相同的事。一旦出了问题，不断重复的日常操练赋予我们的技能和经验，令我们可以撤回至安全区域并恢复正常运作。&lt;/p>
&lt;p>必要的做法包括营造一种勇于创新、敢于冒险（相对于畏惧或盲目服从命令）以及高信任度（相对于低信任度和命令控制）的文化，把至少20%的开发和IT运维周期划拨给非功能性需求，并且不断鼓励进行改进。”&lt;/p>
&lt;p>From: [美] 金（Gene Kim ），[美] 贝尔（Kevin Behr），[美] 斯帕福德（George Spafford）. “凤凰项目一个IT运维的传奇故事.”。&lt;/p></description></item><item><title>DevOps登山指南</title><link>https://martinliu.cn/blog/devops-climbing-guide/</link><pubDate>Tue, 20 Feb 2018 00:34:09 +0800</pubDate><guid>https://martinliu.cn/blog/devops-climbing-guide/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/q_auto:eco/Evest.jpg" alt="Featured image of post DevOps登山指南" />&lt;p>美国金融行业Nationwide保险公司DevOps案例研究，来源DOES17 San Francisco，主题-DevOps Handbook Experiments in Accelerating Delivery&lt;/p>
&lt;p>全美互惠保险公司(Nationwide)美国公司。在2017年6月7日，《财富》2017年美国500强排行榜发布，全美互惠保险公司排名第68位。营业收入40074.1百万美元。&lt;/p>
&lt;p>这家公司是DevOps Handbook（DevOps实践指南）书中的案例研究之一。这是一家DevOps水平较高的企业，是DevOpsDays大会上分享嘉宾的常客，也是各个DevOps工具厂商（New Relic）经常邀请的案例分享嘉宾。他们也经常参加DevOps企业峰会，曾多次做过自己的DevOps应用状况案例分享。&lt;/p>
&lt;p>本文分析和整理了他们在2017年11月旧金山站DevOps企业峰会上他们的演讲，主题为《DevOps Handbook Experiments in Accelerating Delivery - Nationwide》（翻译：使用DevOps Handbook在加速开发交付的过程中的实验）&lt;/p>
&lt;p>本文根据这个演讲的YouTube视频整理而成。视频已经上传到腾讯视频，&lt;a class="link" href="https://v.qq.com/x/page/v0555haemus.html" target="_blank" rel="noopener"
>点这里观看该视频。&lt;/a>&lt;/p>
&lt;hr>
&lt;h2 id="devops登山指南手册">DevOps登山指南手册
&lt;/h2>&lt;p>我在翻译DevOps Handbook的过程中，感觉书中所描述的这家公司的案例研究，并不像本演讲里所说的这样的精彩。&lt;/p>
&lt;p>而时光已经很快的流转到了将近2018年，他们的DevOps也经过了几年的发展，本文案例向我们展示了一个金融行业（我们往往认为不太容易实施DevOps的行业）企业，在很大的企业规模了，所取得的令人敬佩的成就。&lt;/p>
&lt;p>下面这张图是本文的精华，先给各位呈现出来。他们使用攀登珠穆朗玛峰做为比喻，对DevOps的实施做了生动的诠释。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/devops-climbing-guide.jpg"
loading="lazy"
alt="DevOps登山指南手册"
>&lt;/p>
&lt;p>本图在Nationwide公司内部的使用场景如下：&lt;/p>
&lt;ol>
&lt;li>本图将DevOps实施核心团对指导产品开发团队（也可以说是业务团队、服务团队、这样的团队他们有200多个）取得的经验总结在一张纸上，供其它有实施DevOps想法的团队参考。&lt;/li>
&lt;li>该登山指南简化了对其它非DevOps团队的教育和指引。&lt;/li>
&lt;li>他们将DevOps的实施分成三个阶段，分别用大本营、北坡营地和顶峰作比喻。&lt;/li>
&lt;li>这三个阶段里的技术实践都来自于DevOps Handbook，通过他们的筛选和整理，并根据自己的经验做了分阶段的规划。&lt;/li>
&lt;/ol>
&lt;p>为了知其所以然，我们将继续向下发掘，详细了解这个案例分享所讲的主要内容。下面的内容也包含了我对他们的分析和评论，欲了解原始资料，请请参看我上传到腾讯的视频。&lt;/p>
&lt;hr>
&lt;h2 id="主题devops-handbook-在加速交付中的各种实验">主题：DevOps Handbook-在加速交付中的各种实验
&lt;/h2>&lt;p>分享者介绍。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-001.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;p>这个演讲距2018年2月也就是三个月，还算是很新鲜的一个案例。Cindy是DevOps团队中的核心人员之一，她的头衔是Director，角色是夏尔巴人（后面会详细解释这个比喻的含义），为业务产品组提供内部的DevOps咨询和辅导。Jim属于业务条线/BU的Dev这一侧，他是业务部门的解决方案架构师。&lt;/p>
&lt;h2 id="nationwide的核心价值保护对你最有价值的">Nationwide的核心价值：保护对你最有价值的
&lt;/h2>&lt;p>公司简介和状况。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-002.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>在很多险种上Nationwide都在业内排名第一名，包括：宠物保险、农场保险、公司寿险等等。&lt;/li>
&lt;li>这是一家有90年历史的老店&lt;/li>
&lt;li>汽车保险也行业排名第八（后面就是用这个业务为例，来佐证DevOps实施的效果）&lt;/li>
&lt;li>不光在财富500强企业排名68，还是财富所评选的前100个最佳的工作企业。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="nationwide-it的规模很大">Nationwide IT的规模很大
&lt;/h2>&lt;p>IT组织的特点和相关数据。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-003.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>IT组织庞大，结构复杂，业务条线众多&lt;/li>
&lt;li>在选择应用某个DevOps实践的时候，总是要考虑到规模因素，需要评估该实践是否能在200多个业务开发团队的规模上全面地推广和实施&lt;/li>
&lt;li>IT人员总数超过5100人，其中程序员和测试人员的数量超过2600人；在电脑世界的IT最佳工作地点的排行帮上位居第51名&lt;/li>
&lt;li>该公司有用200多个产品开发团队，他们服务于23个业务部门BU&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="nationwide-it的组织结构">Nationwide IT的组织结构
&lt;/h2>&lt;p>典型、复杂和庞大的组织结构&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-004.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>I&amp;amp;O是基础架构和操作运维团队，该组织不仅运维了所有的IT服务，还服务于所有的业务开发团队。&lt;/li>
&lt;li>多个共享服务团队提供企业级的共享服务，包括Scrum测试等传统开发服务，同时也为企业内部的DevOps实践提供技术咨询，他们支持所有类型的企业应用堆栈&lt;/li>
&lt;li>业务部门如前所述有23个，有200多个开发团队，Jim服务于金融业务BU&lt;/li>
&lt;li>该公司的架构模型近似于典型的Dev、QA和Ops架构；他们的Ops组织也是集中式的；如此复杂的架构带来了DevOps流水线的复杂度方面的挑战，为某个业务BU实施的持续交付流水线会横跨多个BU，有时候甚至需要三个BU的CIO级别领导一起来参与决策，这里也会出现项目投资方和项目决策方不统一的难题。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="从哪里开始">从哪里开始
&lt;/h2>&lt;p>应用DevOps的企业环境背景和定位。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-005.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>IT组织十年以来追求的战略目标：构建具有全球竞争力的内包式软件开发能力；为此而采用了不同的管理框架和实践，应用和开始的时间点也不同
&lt;ul>
&lt;li>Agile：敏捷软件开发是10年前就开始的，定位和目标是通过敏捷软件开发交付高质量的软件&lt;/li>
&lt;li>DevOps：今年加入了DevOps实践，定位是如何实现速度、效率和降低风险。&lt;/li>
&lt;li>Lean IT：定位是确保将IT管理的各种实践（包括以上的敏捷和DevOps）提升和推广到企业级规模。（他们认为在团队级别上任何敏捷和DevOps相关的实践都是很容易实现的，而企业级规模的推广是更高等级的管理，是不容易达到的）&lt;/li>
&lt;li>CMMI：使用行业规范的软件开发成熟度标准评价和考量自身的软件开发能力，为自身的不断提高提供标准参考。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>该公司DevOps实践是最晚开始应用的，其它的三个方面使用的历史比较长了，为了达成一个战略目标，需要4个战术层面实践的支持，这些战术的采用时期和定位不同；4个战术从不同的侧面支持了战略目标的实现。该企业也在Lean IT的论坛上分享和演讲过。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="从哪里开始续">从哪里开始（续）
&lt;/h2>&lt;p>应用DevOps的时间轨迹和历程，各个时期的关键词。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-006.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>2015-简化：DevOps小屋是入手DevOps实践时，最早使用过的参考框架；他们分析梳理了所有相关的方法论；工具方面专注在部署工具的改进上，所有产品线采用了IBM UrbanCode作为统一的部署工具；可是这个阶段接触的实践还是比较庞杂。&lt;/li>
&lt;li>2016-组织：在获得了高层领导的支持以后，他们同时在三个方向出击：软件开发模型、精益IT管理和供应链管理；在三个方面都直接提高和优化了DevOps的速度。&lt;/li>
&lt;li>2017-实验：在取得了天时地利人和之后，他们展开了所谓的“双模实验”的实践道路；从业务需求入手（规划了使用了MMP最小化可市场产品的概念），逐渐抛开了纷繁复杂的实践和方法论，他们开始聚焦在了“程序员体验”上，通过各种实验验证DevOps Handbook中描述的实践是如何影响并提升他们的。孵化和实验各种DevOps Handbook书里的实践。&lt;/li>
&lt;li>2018-促动：如何把相关的工具推广到200多个开发团队，如何引入Google的SRE模型，将交付流水线作为产品对待，在复杂的组织中，实施跨部门的流水线的挑战依旧不轻。&lt;/li>
&lt;li>该公司的DevOps实践道路是一步一个台阶的持续改进过程，经历了三年多时间，每个阶段的关键词代表了他们的成果和挑战。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="devops团队间的交互模型">DevOps团队间的交互模型
&lt;/h2>&lt;p>【重点】团队组织结构和交互方式。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-007.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>这是实验各种DevOps实践的团队组织模型，开展每项DevOps实践都遵循PDCA的持续改进方法。&lt;/li>
&lt;li>所有团队遵循着三个基础原则：1速度，江湖武功唯快不破，这是他们清醒而简单的唯一追求目标，成为检验所有优化改进的唯一验收标准和条件。2实践者之成功，他们做的并不是自顶向下的、政令式的强推，而是让参与DevOps实践的团队自己提出工作想法，自己来决定在哪里尝试改进能提升速度。3范围，从端到端的价值流全局看，既不推崇极左的做法，也不推崇极右的做法，他们将范围限定在，从一张工作卡片进入DevOps产品代办工作（Backlog）开始，直至将它的成果发布到生产环境中。&lt;/li>
&lt;li>实施“双模实验”团队的模型，两个团队都提出自己想做的实验想法，双方的工作内容都汇总到一个集中的DevOps产品代办工作队列中，每一项工作/卡片都是一项实验，每一项实验都由两个团队分别完成，A/B团队的做法和实现结果可能不同，这样也自然地应用到了A/B测试的模型。&lt;/li>
&lt;li>DevOps Leadership Team团队里是Cindy和Jim所在的团队（应该是一个虚拟团队组织），他们确保所有代办工作都遵循以上的三个基础原则，另外使用系统性思考来确保每种实验如果取得了成功，在推敲是否它能推广并应用到其它的200多个开发团队。&lt;/li>
&lt;li>DevOps平台团队辅助和优化双模实验团队的工作，例如双模团队可能都需要自动化变更流程（ITSM的管理范畴）的API，而这些工作就可以踢给平台团队做，平台团队负责设计实现这个API，并且保证它具有企业级规模的能力，然后交付双模团队使用即可。&lt;/li>
&lt;li>治理团队是由该公司的各个CIO级别的利益干系人组成的，上文说过某些复杂的DevOps持续交付流水线会跨三个以上的部门，这些BU的大佬会在这个团队中；他们在每个迭代都会出现在双模团队的工作现场，一起现场查看状况，现场解决问题。Jim认为他们亲自临场观察和了解实验工作的效果，远远比将实验成果作出PPT后再给他们去汇报的效果要好。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="epic史诗">EPIC史诗
&lt;/h2>&lt;p>【重点】DevOps团队根据Handbook为基础，提出了所有想实验的工作内容。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-008.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>开发团队从寻找什么拖慢了速度出发，寻找优化和改进工作内容的方法，在渐梳理和过滤以后，发现最后确定要做的工作都可以在Handbook中得到确认。甚至有些人在讨论某个工作条目的时候，能清晰的告诉大家可以参考Handbook书中的章节和页数。&lt;/li>
&lt;li>DevOps产品代办工作里的EPIC史诗工作必须是在Handbook书中能够出现和参考到的，如果不是的话，团队可能会对它表示质疑。&lt;/li>
&lt;li>这里Cindy简述了自动化测试这项工作的实验，故事是这样的：开发团队自己描述到，当前的Test Bed已经大到不可管理的程度，测试运行的时间太长了，因此不能保持测试的精简和有效性，这样的情况持续了一段时间以后，大家就失去了对自动化测试的信心。而且由于开发和测试人员不在同一个组织/团队里，团队之间必须进行工作交接（部门墙），导致了大量复测试案例的存在。他们的解决方法是，让开发和测试人员结对子，这样就减少了重复测试。当测试套件又变得精简和绿色了以后，大家又开始相信这些自动化测试了，之后大家对自动化测试的文化转变为：将自动化测试案例失败视为零容忍事件（失败的测试会导致全team的人停下来，并在1天内解决）。另外一个故事关于性能测试，性能测试是通过一个位于俄亥俄州的集中式性能测试团队做的，任何开发团队的申请时间是90天（被识别为最长时间的约束点），他们认为这个前置时间是无法接受的。解决方法是，将性测试脚本和运行权限交还给了开发团队，最后90天的性能周期被缩短为了2小时。&lt;/li>
&lt;li>DevOps团队和管理层对Handbook书里的实践内容达成了共识和一致，上下一致的参考书中这些业界已经验证过的实践，节省了决策和探索DevOps做法和套路的时间。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="开发者程序员体验十八般神兵利器大量的上下文切换">开发者/程序员体验：十八般神兵利器，大量的上下文切换
&lt;/h2>&lt;p>【重点】2017年的实践核心是“开发者/程序员体验”（程序员要“富养”）&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-009.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;p>在专注于开发者体验优化的过程中，应用了大量DevOps工具，最后发现如果开发者把它们都用一遍的话，要花好几个小时的时间。为了解决这个问题，他们体验了Rocket.Chat工具，开发者们对此工具提出了一致好评。&lt;/p>
&lt;p>为了让公司领导层支持增加这个工具，他们请领导们到现场亲自视察观看开发人员在使用了Rocket.Chat之后，优化的体验。领导们就这样决策增加的这个工具。&lt;/p>
&lt;hr>
&lt;h2 id="开发者程序员体验拥抱聊天机器人减少上下文切换">开发者/程序员体验：拥抱聊天机器人，减少上下文切换
&lt;/h2>&lt;p>优化后的开发者工具集如下所示。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-010.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>开发者直接面对的工具精简了很多，他们几乎只需要专注于写代码和处理代码的提交和PR即可。&lt;/li>
&lt;li>之前开发者如果需要部署代码，就需要手工的在UrbanCode里点击十几二十次鼠标，才能完成一次部署操作。&lt;/li>
&lt;li>在使用了聊天机器人之后，他们只需要对聊天机器人说：deploy；即可&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="devops登山指南">DevOps登山指南
&lt;/h2>&lt;p>通过这一页纸的手册，为新来的DevOps实践者提供了清晰的指导。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-011.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;p>攀登高山隐喻了这是一个艰难的旅程。&lt;/p>
&lt;hr>
&lt;h2 id="北极星---前置时间">北极星 - 前置时间
&lt;/h2>&lt;p>【重点】各项DevOps工作的唯一参考指标是“前置时间”（指南针）&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-012.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;p>选用这个指标的三个原因：&lt;/p>
&lt;ul>
&lt;li>这个指标可以在横向的200多个敏捷开发团队里实施；在纵向的组织级、部门级和团队级上，大家都能理解和认可这一指标，都能够掌握前置时间的计算和测量方法。缩短前置时间的目标是清晰的：及时要加快交付速度。&lt;/li>
&lt;li>各个开发团队可以自行选择优化前置时间的方法和路径，其实这鼓励了团队的创造性。&lt;/li>
&lt;li>对此指标的度量和持续改进，是可以按天实时进行的，同时还要保证实现部署的零宕机时间。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="devops登山用品地图和装备">DevOps登山用品：地图和装备
&lt;/h2>&lt;p>DevOps实践者基础的精神和物质需求。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-013.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;ul>
&lt;li>工具和DevOps实践直接相关&lt;/li>
&lt;li>每个工具都有其价值和应用场景（例如Rocket.Chat）&lt;/li>
&lt;li>DevOps Handbook（中文书名：DevOp实践指南）的作用是地图，每个DevOps实践团队都进行至少每周一次的读书俱乐部活动，每次都对书中具体的章节进行团队讨论和学习。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="devops的支持模型">DevOps的支持模型
&lt;/h2>&lt;p>DevOps支持团队的作用。&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-014.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;p>为了满足企业级的支持规模，让水平参差不齐的200多个开发团队都能顺利应用DevOps实践，没有这个支持模型是不可能走远的。&lt;/p>
&lt;ul>
&lt;li>夏尔巴人团队的作用是支持和辅导DevOps实践团队，提升团队的思想意识观念和技能，帮助它们构建某些特定领域的工作能力。&lt;/li>
&lt;li>参与DevOps实践的开发团队必须自己登上山顶，哪怕是爬也是自己爬上去。绝不勉强，不想进步的团队就不要参与了。&lt;/li>
&lt;li>逐渐开展了沉浸式配对的支持模式，让低水平团队的人员在DevOps高水平团队中进行交叉培训，让他们现场看到相同的工作确实可以有不同的、更好的做法。&lt;/li>
&lt;li>他们进行每月一次的DevOps道场，在道场里DevOps技术顾问现场指导和帮助前来提高的团队。&lt;/li>
&lt;li>将流水线视为产品，流水线的管理确实也是他们的痛点之一。&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="devops成功的那一刻">DevOps成功的那一刻
&lt;/h2>&lt;p>DevOps对业务有毛用？！&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/Grafmeyer_Jim_Payne_Cindy_DevOps_Handbook_Experiments_in_Accelerating_Delivery-page-015.jpg"
loading="lazy"
alt="Grafmeyer, Jim, Payne, Cindy, DevOps Handbook Experiments in Accelerating Delivery"
>&lt;/p>
&lt;p>这个故事是该公司刚开始品尝DevOps成功硕果的那一刻。飓风哈维（是2017年大西洋飓风季中的一个热带气旋。2017年8月25日，登陆美国德克萨斯州沿岸，时速130英里）导致车辆涉水险的申报数量剧增。业务部门的人处理这些车险事件的过程中意识到，他们的业务流程对这个险种的索赔并不友好，于是就来找到了IT部门，提出想要优化这个险种报案和索赔处理。&lt;/p>
&lt;p>这是第一次业务部门找上门来提出的业务需求，IT部门在当天就搞定的经历。业务人员和IT部门的人用了一个小时的时间讨论优化方案，决定去掉索赔流程里40%的多余步骤。IT部门开始设计和实施这个想法，决定需要变更多个应用，他们在当天里，在剩下的7个小时内就完成了这些业务需求的开发和测试，这些业务变更的生产环境部署工作是在工作时段进行的，变更在当天的营业时间结束前就上线了。他们始终以速度为先的实践原则在一年后，在这一天里得到了回报。以前需要至少90天的周期才能完成这样的变更，性能测试会就会占用一半以上的前置时间。而他们觉得这次在整个的设计、实施和部署过程中，其实并没有感到什么压力和风险。&lt;/p>
&lt;hr>
&lt;h2 id="后记">后记
&lt;/h2>&lt;p>本文的价值在于，向你展示一个有参考价值的DevOps案例。它的很多特征和成功之处都值得借鉴和思考。本文的文字主要来源于对视频中的叙述，其中也包含了大量我个人的观点和分析；&lt;a class="link" href="https://v.qq.com/x/page/v0555haemus.html" target="_blank" rel="noopener"
>欢迎读者在观看本案例视频后&lt;/a>，与我分享和讨论以上内容。&lt;/p></description></item><item><title>Kubecon 2017演讲稿和视频下载</title><link>https://martinliu.cn/blog/kubecon17/</link><pubDate>Wed, 03 Jan 2018 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/kubecon17/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-10.jpg" alt="Featured image of post Kubecon 2017演讲稿和视频下载" />&lt;p>Kubernetes 无疑当下最火热的技术之一，Google 公司围绕着它下了更大的一盘棋 CNCF。这是在国际寡头 IT 软件公司的统治局面渐渐退去之后，各种新鲜技术百花齐放了一段时间以后，再通过 CNCF 的形式又逐渐集中化起来的趋势。KubeCon 的人气很旺，演讲分享的人很多。&lt;/p>
&lt;p>最近一次的 KubeCon，2017 年在奥斯汀站的演讲稿和视频下载的清单已经发布出来了：&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/cloudyuga/kubecon17" target="_blank" rel="noopener"
>https://github.com/cloudyuga/kubecon17&lt;/a>&lt;/p>
&lt;p>我在 YouTube 里听了一部分视频，感觉确实有很多新鲜的工程实践经验的分享。下面分享一个觉得不错的实战案例分享。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/15149407077880.jpg"
loading="lazy"
>&lt;/p>
&lt;h2 id="box-公司分享持续交付实战经验">Box 公司分享持续交付实战经验
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/2341514940915_.pic_hd.jpg"
loading="lazy"
alt="2341514940915_.pic_hd"
>&lt;/p>
&lt;p>关于这个分享的看点：&lt;/p>
&lt;ul>
&lt;li>Box 公司全面实施 Kubernetes 的案例，涵盖了所有的环境：Dev、Staging 和 Prod&lt;/li>
&lt;li>遇到的挑战和问题共性强&lt;/li>
&lt;li>Jenkins 流水线+金丝雀部署+持续交付的组合&lt;/li>
&lt;li>解决问题的模式值得借鉴&lt;/li>
&lt;li>工具集里开发出来的核心组件已经开业分享在 Github 上&lt;/li>
&lt;/ul>
&lt;p>分享者经典语录：&lt;/p>
&lt;blockquote>
&lt;p>我们是软件工程师，我们不是坐在那按按钮的猴子！&lt;/p>&lt;/blockquote>
&lt;p>&lt;img src="https://martinliu.cn/images/2251514938283_.pic.jpg"
loading="lazy"
alt="2251514938283_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2261514938305_.pic.jpg"
loading="lazy"
alt="2261514938305_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2271514938328_.pic.jpg"
loading="lazy"
alt="2271514938328_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2281514938357_.pic.jpg"
loading="lazy"
alt="2281514938357_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2291514938389_.pic.jpg"
loading="lazy"
alt="2291514938389_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2301514938410_.pic.jpg"
loading="lazy"
alt="2301514938410_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2311514938432_.pic.jpg"
loading="lazy"
alt="2311514938432_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2321514938453_.pic.jpg"
loading="lazy"
alt="2321514938453_.pi"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/2331514938477_.pic.jpg"
loading="lazy"
alt="2331514938477_.pi"
>&lt;/p>
&lt;p>以上分享的持续交付方案里 kube-applier 的源代码分享：&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/box/kube-applier" target="_blank" rel="noopener"
>https://github.com/box/kube-applier&lt;/a>&lt;/p>
&lt;p>PS：非常敬佩这种开放和分享的工程式文化。很符合开源的精神，爱分享的人，不把东西分享出来的话可能会不爽。&lt;/p>
&lt;p>延伸阅读：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://blog.box.com/blog/introducing-kube-applier-declarative-configuration-for-kubernetes/" target="_blank" rel="noopener"
>https://blog.box.com/blog/introducing-kube-applier-declarative-configuration-for-kubernetes/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.box.com/blog/kubernetes-box-microservices-maximum-velocity/" target="_blank" rel="noopener"
>https://blog.box.com/blog/kubernetes-box-microservices-maximum-velocity/
&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="观看以上演讲视频">观看以上演讲视频
&lt;/h2>&lt;!-- raw HTML omitted --></description></item><item><title>Tips for Docker on Mac</title><link>https://martinliu.cn/blog/tips-for-docker-on-mac/</link><pubDate>Tue, 26 Sep 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/tips-for-docker-on-mac/</guid><description>&lt;img src="https://martinliu.cn/images/sandrali-3.JPG" alt="Featured image of post Tips for Docker on Mac" />&lt;h1 id="tips-for-docker-on-mac">Tips for Docker on Mac
&lt;/h1>&lt;p>在macOS上使用Docker很长时间了，本文总结一些我不想忘记的tips，方便自己反复使用的同时，也顺便总结分享一下，留下本文作为长期更新的备忘录。&lt;/p>
&lt;h2 id="搭建私有镜像库">搭建私有镜像库
&lt;/h2>&lt;p>运行一个本地镜像库&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d -p 5000:5000 --restart=always --name registry registry:2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这条命令会从docker hub 下载 registry:2 镜像，在本机运行一个镜像库服务。&lt;/p>
&lt;p>下载一个测试用的镜像。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker pull ubuntu:16.04
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>给这个镜像打上私有镜像库的标签&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker tag ubuntu:16.04 localhost:5000/ubuntu:16.04
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>push这个测试镜像到本地的镜像库&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker push localhost:5000/ubuntu:16.04
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这时候你会发现我的本地这样岂不是有了两份相同的镜像了，有这个必要么？是不是多余了？下面几个场景中会用到：&lt;/p>
&lt;p>当你用docker-machine在本机启动1个vm的时候，你运行任何docker run或者docker-compose up的时候你可能需要一个之前在本地就有的image，这是一种分享本机image给docker-machine vm的一种方式。&lt;/p>
&lt;p>当你用docker-machine在本机启动多个个vm的时候，你可能会把它们作出docker Swarm群集，当你在这个群集上启动一个服务的时候，docker compose文件中的镜像地址可以引用这个本地地址，引用地址类似这样 image: 192.168.99.1:5000/influxdb&lt;/p>
&lt;p>当你用 minikube start启动了一个minikube的vm的时候，你可能也需要本机的docker镜像，尤其是在你做demo的时候，这是最快的下载途径。
需要注意的是，以上三种情况都需要指定一下&amp;ndash;engine-insecure-registry 192.168.99.1:5000 这个参数。&lt;/p>
&lt;h2 id="自动化创建docker-swarm群集">自动化创建Docker Swarm群集
&lt;/h2>&lt;p>在我的文件目录中存放着这个脚本&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cat create-swarm.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine create manager --engine-insecure-registry 192.168.99.1:5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine create agent1 --engine-insecure-registry 192.168.99.1:5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine create agent2 --engine-insecure-registry 192.168.99.1:5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine create agent3 --engine-insecure-registry 192.168.99.1:5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">eval `docker-machine env manager`
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker swarm init --advertise-addr `docker-machine ip manager`
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine ssh agent1 docker swarm join --token `docker swarm join-token -q worker` `docker-machine ip manager`:2377
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine ssh agent2 docker swarm join --token `docker swarm join-token -q worker` `docker-machine ip manager`:2377
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker-machine ssh agent3 docker swarm join --token `docker swarm join-token -q worker` `docker-machine ip manager`:2377
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker node ls
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>解释一下上面的代码：创建四个docker-machine vm，初始化swarm群集，把三个worker节点加入群集。这样四节点的群集就up and running了。&lt;/p>
&lt;p>清除以上群集虚拟机的命令如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker-machine rm -y manager agent1 agent2 agent3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>关于DevOps 的那些事</title><link>https://martinliu.cn/blog/about-devops-china/</link><pubDate>Sat, 23 Sep 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/about-devops-china/</guid><description>&lt;img src="https://martinliu.cn/images/tf_5.jpg" alt="Featured image of post 关于DevOps 的那些事" />&lt;p>DevOps是孕育于敏捷社区，又反哺给整个IT技术行业的，是一次彻底而全面的技术和文化运动。本文从它的出处谈起，一直描述到当前国内的现状。最后总结了相关的核心技术和主要实践。&lt;/p>
&lt;h2 id="devops简史">DevOps简史
&lt;/h2>&lt;p>在2008年多伦多举办的敏捷大会（Velocity Conf 2008 ）上，Patrick DeBois 和AndrewClay Shafer 先生首次提议讨论“敏捷基础架构”这个话题。在第二年的敏捷大会上有一个具有里程碑的意义技术分享，来自Flickr公司《每天部署10次》的分享，它激发了随后Patrick DeBios在同年十月，在比利时的根特市举办的首届DevOpsDays活动，这个活动是两天的日程，为了大家方便在twitter上的传播，人们把DevOpsDays这个词简写为 “#DevOps” 。 此后，“DevOps”一词问世了，这个词所包含的理念和实践一时在越来越广大的人群中产生了共鸣，随后成为全球IT界在各种大会和论坛里热议和讨论的焦点话题，很多大型IT论坛也都开设出了DevOps专题讨论。这就是DevOps这个词的由来。DevOpsDays活动随后在Patrick DeBios等相关核心发起人的推动下，在全球范围内蓬勃发展了起来。2010年在美国山景城(Mountain View) 举办的DevOpsDays 活动中，Damon Edwards先生使用“CAMS”这个缩写，高度概括和诠释了DevOps，即文化（Culture）、自动化（Automation）、度量（Measurement or Metrics）和分享（Sharing）。随后Jez Humble先生将“L”精益 (Lean) 原则也加入其中，最终变成了CALMS。&lt;/p>
&lt;ul>
&lt;li>Culture（文化）- 是指拥抱变革，促进协作和沟通&lt;/li>
&lt;li>Automation（自动化）- 是指将人为干预的环节从价值链中消除&lt;/li>
&lt;li>Lean（精益）- 是指通过使用精益原则促使高频率循环周期&lt;/li>
&lt;li>Metrics（指标）- 是指衡量每一个环节，并通过数据来改进循环周期&lt;/li>
&lt;li>Sharing（分享）- 是指与他人开放分享成功与失败的经验，并在错误中不断学习改进&lt;/li>
&lt;/ul>
&lt;p>“CALMS”完全吻合Patrick DeBois先生所一向倡导的“DevOps is a human problem” (DevOps 是关于人的问题) 的理念 。&lt;/p>
&lt;h2 id="devopsdays活动的现状">DevOpsDays活动的现状
&lt;/h2>&lt;p>从DevOps概念的产生，到如今它在全球范围内的蔓延和认同，已经经历了9个年头的时间。它的火爆推广也伴随着IT行业的迅速变迁和发展，现在已经到了移动互联网时代的后半场，国内的信息化建设已经完成了很多年；如今各行各业的企业也都亟待完成全方位的数字化转型。IT信息技术的先进程度标志着一个企业的核心能力，任何一个成功的企业，敏捷高效的软件开发创新实力和IT管理综合能力不只是门面而已，而是实实在在的市场竞争能力。DevOps倡导打敏捷、持续交付和ITIL三种实践的组合拳，同时应用精益生产理念为基础的管理思想，这正在逐渐地被广泛的接受和认可。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/devopsdays-map.png"
loading="lazy"
alt="devopsdays-map"
>&lt;/p>
&lt;p>在过去的几年中，国内的各种IT大会也蓬勃发展，其中DevOps相关的专题和分会场也颇受人们的关注。各种云计算、运维等IT技术的社交媒体也都非常重视DevOps这个话题的分享。一个专属于DevOps社群的、国际性的、有影响力的DevOps大会正呼之欲出。在这样的时代背景下DevOpsDays大会北京站在2017年的3月18日来到中国，在同年的8月18日上海，还要举办DevOpsDays Shanghai站的大会。&lt;/p>
&lt;p>下面列举一些DevOpsDays大会的相关数据，&lt;!-- raw HTML omitted -->数据来源于DevOpsDays.org&lt;!-- raw HTML omitted --> 网站。从2009年到2016年，已经在全球的61个城市/国家成功地举办了117场。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/year.png"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://martinliu.cn/images/devops-citys.png"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>在谈这个话题前先看一下DevOps相关工具集的全貌，如下图所示：&lt;!-- raw HTML omitted -->&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/devops-tools.png"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://martinliu.cn/images/devops-v20.png"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://martinliu.cn/images/devops-house.png"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;p>（上图来源于：Exin DevOps白皮书）&lt;!-- raw HTML omitted -->&lt;/p>
&lt;!-- raw HTML omitted --></description></item><item><title>用Minikube体验单节点K8S</title><link>https://martinliu.cn/blog/install-minikube-k8s/</link><pubDate>Thu, 21 Sep 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/install-minikube-k8s/</guid><description>&lt;img src="https://martinliu.cn/images/abstract-1.jpg" alt="Featured image of post 用Minikube体验单节点K8S" />&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://martinliu.cn/images/minikube-logo.png"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>Usage:
minikube [command]&lt;/p>
&lt;p>Available Commands:
addons Modify minikube&amp;rsquo;s kubernetes addons
completion Outputs minikube shell completion for the given shell (bash)
config Modify minikube config
dashboard Opens/displays the kubernetes dashboard URL for your local cluster
delete Deletes a local kubernetes cluster
docker-env Sets up docker env variables; similar to &amp;lsquo;$(docker-machine env)&amp;rsquo;
get-k8s-versions Gets the list of available kubernetes versions available for minikube
ip Retrieves the IP address of the running cluster
logs Gets the logs of the running localkube instance, used for debugging minikube, not user code
mount Mounts the specified directory into minikube
profile Profile sets the current minikube profile
service Gets the kubernetes URL(s) for the specified service in your local cluster
ssh Log into or run a command on a machine with SSH; similar to &amp;lsquo;docker-machine ssh&amp;rsquo;
ssh-key Retrieve the ssh identity key path of the specified cluster
start Starts a local kubernetes cluster
status Gets the status of a local kubernetes cluster
stop Stops a running local kubernetes cluster
update-context Verify the IP address of the running cluster in kubeconfig.
version Print the version of minikube&lt;/p>
&lt;p>Flags:
&amp;ndash;alsologtostderr log to standard error as well as files
-b, &amp;ndash;bootstrapper string The name of the cluster bootstrapper that will set up the kubernetes cluster. (default &amp;ldquo;localkube&amp;rdquo;)
-h, &amp;ndash;help help for minikube
&amp;ndash;log_backtrace_at traceLocation when logging hits line file:N, emit a stack trace (default :0)
&amp;ndash;log_dir string If non-empty, write log files in this directory
&amp;ndash;loglevel int Log level (0 = DEBUG, 5 = FATAL) (default 1)
&amp;ndash;logtostderr log to standard error instead of files
-p, &amp;ndash;profile string The name of the minikube VM being used.
This can be modified to allow for multiple minikube instances to be run independently (default &amp;ldquo;minikube&amp;rdquo;)
&amp;ndash;stderrthreshold severity logs at or above this threshold go to stderr (default 2)
-v, &amp;ndash;v Level log level for V logs
&amp;ndash;vmodule moduleSpec comma-separated list of pattern=N settings for file-filtered logging&lt;/p>
&lt;p>Use &amp;ldquo;minikube [command] &amp;ndash;help&amp;rdquo; for more information about a command.
&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>Starting local Kubernetes v1.7.5 cluster&amp;hellip;
Starting VM&amp;hellip;
Getting VM IP address&amp;hellip;
Moving files into cluster&amp;hellip;
Setting up certs&amp;hellip;
Connecting to cluster&amp;hellip;
Setting up kubeconfig&amp;hellip;
Starting cluster components&amp;hellip;
Kubectl is now configured to use the cluster.
&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;h1 id="we-have-now-launched-an-echoserver-pod-but-we-have-to-wait-until-the-pod-is-up-before-curlingaccessing-it">We have now launched an echoserver pod but we have to wait until the pod is up before curling/accessing it
&lt;/h1>&lt;h1 id="via-the-exposed-service">via the exposed service
&lt;/h1>&lt;h1 id="to-check-whether-the-pod-is-up-and-running-we-can-use-the-following">To check whether the pod is up and running we can use the following
&lt;/h1>&lt;p>$ kubectl get pod
NAME READY STATUS RESTARTS AGE
hello-minikube-3383150820-vctvh 1/1 ContainerCreating 0 3s&lt;/p>
&lt;h1 id="we-can-see-that-the-pod-is-still-being-created-from-the-containercreating-status">We can see that the pod is still being created from the ContainerCreating status
&lt;/h1>&lt;p>$ kubectl get pod
NAME READY STATUS RESTARTS AGE
hello-minikube-3383150820-vctvh 1/1 Running 0 13s&lt;/p>
&lt;h1 id="we-can-see-that-the-pod-is-now-running-and-we-will-now-be-able-to-curl-it">We can see that the pod is now Running and we will now be able to curl it
&lt;/h1>&lt;p>$ curl $(minikube service hello-minikube &amp;ndash;url)
CLIENT VALUES:
client_address=172.17.0.2
command=GET
real path=/
query=nil
request_version=1.1
request_uri=&lt;a class="link" href="http://192.168.99.100:8080/" target="_blank" rel="noopener"
>http://192.168.99.100:8080/&lt;/a>&lt;/p>
&lt;p>SERVER VALUES:
server_version=nginx: 1.10.0 - lua: 10001&lt;/p>
&lt;p>HEADERS RECEIVED:
accept=&lt;em>/&lt;/em>
host=192.168.99.100:31721
user-agent=curl/7.54.0
BODY:
-no body in request-%
&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>$ APISERVER=$(kubectl config view | grep https | cut -f 2- -d &amp;ldquo;:&amp;rdquo; | tr -d &amp;quot; &amp;ldquo;)&lt;/p>
&lt;p>$ curl $APISERVER &amp;ndash;header &amp;ldquo;Authorization: Bearer $TOKEN&amp;rdquo; &amp;ndash;insecure
{
&amp;ldquo;paths&amp;rdquo;: [
&amp;ldquo;/api&amp;rdquo;,
&amp;ldquo;/api/v1&amp;rdquo;,
&amp;ldquo;/apis&amp;rdquo;,
&amp;ldquo;/apis/&amp;rdquo;,
&amp;ldquo;/apis/admissionregistration.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/admissionregistration.k8s.io/v1alpha1&amp;rdquo;,
&amp;ldquo;/apis/apiextensions.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/apiextensions.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/apiregistration.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/apiregistration.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/apps&amp;rdquo;,
&amp;ldquo;/apis/apps/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/authentication.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/authentication.k8s.io/v1&amp;rdquo;,
&amp;ldquo;/apis/authentication.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/authorization.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/authorization.k8s.io/v1&amp;rdquo;,
&amp;ldquo;/apis/authorization.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/autoscaling&amp;rdquo;,
&amp;ldquo;/apis/autoscaling/v1&amp;rdquo;,
&amp;ldquo;/apis/autoscaling/v2alpha1&amp;rdquo;,
&amp;ldquo;/apis/batch&amp;rdquo;,
&amp;ldquo;/apis/batch/v1&amp;rdquo;,
&amp;ldquo;/apis/batch/v2alpha1&amp;rdquo;,
&amp;ldquo;/apis/certificates.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/certificates.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/extensions&amp;rdquo;,
&amp;ldquo;/apis/extensions/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/networking.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/networking.k8s.io/v1&amp;rdquo;,
&amp;ldquo;/apis/policy&amp;rdquo;,
&amp;ldquo;/apis/policy/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/rbac.authorization.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/rbac.authorization.k8s.io/v1alpha1&amp;rdquo;,
&amp;ldquo;/apis/rbac.authorization.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/apis/settings.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/settings.k8s.io/v1alpha1&amp;rdquo;,
&amp;ldquo;/apis/storage.k8s.io&amp;rdquo;,
&amp;ldquo;/apis/storage.k8s.io/v1&amp;rdquo;,
&amp;ldquo;/apis/storage.k8s.io/v1beta1&amp;rdquo;,
&amp;ldquo;/healthz&amp;rdquo;,
&amp;ldquo;/healthz/autoregister-completion&amp;rdquo;,
&amp;ldquo;/healthz/ping&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/apiservice-registration-controller&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/apiservice-status-available-controller&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/bootstrap-controller&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/ca-registration&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/extensions/third-party-resources&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/generic-apiserver-start-informers&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/kube-apiserver-autoregistration&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/start-apiextensions-controllers&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/start-apiextensions-informers&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/start-kube-aggregator-informers&amp;rdquo;,
&amp;ldquo;/healthz/poststarthook/start-kube-apiserver-informers&amp;rdquo;,
&amp;ldquo;/logs&amp;rdquo;,
&amp;ldquo;/metrics&amp;rdquo;,
&amp;ldquo;/swagger-2.0.0.json&amp;rdquo;,
&amp;ldquo;/swagger-2.0.0.pb-v1&amp;rdquo;,
&amp;ldquo;/swagger-2.0.0.pb-v1.gz&amp;rdquo;,
&amp;ldquo;/swagger.json&amp;rdquo;,
&amp;ldquo;/swaggerapi&amp;rdquo;,
&amp;ldquo;/ui&amp;rdquo;,
&amp;ldquo;/ui/&amp;rdquo;,
&amp;ldquo;/version&amp;rdquo;
]
}%&lt;/p>
&lt;p>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;p>&lt;img src="https://martinliu.cn/images/Overview---Kubernetes-Dashboard.jpg"
loading="lazy"
alt="year-map"
>&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted --></description></item><item><title>2017年DevOps采用和趋势现状-信息图</title><link>https://martinliu.cn/blog/state-devops-adoption-trends-2017/</link><pubDate>Sat, 11 Feb 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/state-devops-adoption-trends-2017/</guid><description>&lt;img src="https://martinliu.cn/images/BingWallpaper-2017-02-10_Fotor.jpg" alt="Featured image of post 2017年DevOps采用和趋势现状-信息图" />&lt;p>&lt;img src="https://martinliu.cn/images/14868257964355.jpg"
loading="lazy"
>&lt;/p>
&lt;p>在过去的一两年里DevOps持续升温，逐渐成为一场IT行业内的谁不可回避的运动。&lt;/p>
&lt;h2 id="devops-定义">DevOps 定义
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/1-X.jpg"
loading="lazy"
alt="1-X"
>&lt;/p>
&lt;p>我个人是一直以来反对给DevOps做一个名词解释样式的定义的。不过这种需求实在强大，摘抄几条供大家参考，上图是一种定义。&lt;/p>
&lt;blockquote>
&lt;p>定义2：You cannot buy DevOps and install it. DevOps is not just automation or infrastructure as code. DevOps is people following a process enabled by products to deliver value to end users. &amp;ndash; Donovan Brown, Microsoft DevOps Program Manager&lt;/p>&lt;/blockquote>
&lt;p>以上出自：&lt;a class="link" href="http://www.donovanbrown.com/post/2015/09/01/what-is-devops" target="_blank" rel="noopener"
>Donovan&amp;rsquo;s blog post on &amp;ldquo;What is DevOps&amp;rdquo;.&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>定义3：DevOps（Development和Operations的组合词）是一种重视“软件开发人员（Dev）”和“IT运维技术人员（Ops）”之间沟通合作的文化、运动或惯例。透过自动化“软件交付”和“架构变更”的流程，来使得构建、测试、发布软件能够更加地快捷、频繁和可靠。&lt;/p>&lt;/blockquote>
&lt;p>以上出自：&lt;a class="link" href="http://zh.wikipedia.org/wiki/DevOps" target="_blank" rel="noopener"
>维基百科 Wikipedia - DevOps&lt;/a>&lt;/p>
&lt;h2 id="兴趣和搜索量">兴趣和搜索量
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/2.jpg"
loading="lazy"
alt="2"
>&lt;/p>
&lt;p>以上结果来自Google趋势，上图是从2004年到现在，一共13年的趋势图。下面再看一下最近五年的趋势详情。&lt;/p>
&lt;h3 id="最近5年的搜索趋势">最近5年的搜索趋势
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/images/2-2.png"
loading="lazy"
alt="2-2"
>&lt;/p>
&lt;h3 id="国际关注度">国际关注度
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/images/2-1.png"
loading="lazy"
alt="2-1"
>&lt;/p>
&lt;h3 id="相关话题和查询">相关话题和查询
&lt;/h3>&lt;p>&lt;img src="https://martinliu.cn/images/2-3.png"
loading="lazy"
alt="2-3"
>&lt;/p>
&lt;h2 id="关注者年龄和性别">关注者年龄和性别
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/3.jpg"
loading="lazy"
alt="3"
>&lt;/p>
&lt;p>上图年龄分布情况。&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/4.jpg"
loading="lazy"
alt="4"
>
上图是性别分布情况。&lt;/p>
&lt;h2 id="devops应用状态">DevOps应用状态
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/5.jpg"
loading="lazy"
alt="5"
>&lt;/p>
&lt;ul>
&lt;li>正在应用的:从66%上升到74%&lt;/li>
&lt;li>没有应用的:从19%下降到16%&lt;/li>
&lt;li>不知道的：从15%下降到6%&lt;/li>
&lt;/ul>
&lt;h2 id="devops-checklist">DevOps Checklist
&lt;/h2>&lt;p>不管你做不做DevOps？不管你知不知道你是不是DevOps？不管你从哪个角度入手DevOps？看看这个清单中有几项和您相关，就知道你和DevOps的关系是否密切。
&lt;img src="https://martinliu.cn/images/6.jpg"
loading="lazy"
alt="6"
>&lt;/p>
&lt;p>检查清单如下：&lt;/p>
&lt;ul>
&lt;li>基础架构即代码&lt;/li>
&lt;li>每天多次部署
&lt;ul>
&lt;li>研发人员直接部署都生产环境&lt;/li>
&lt;li>研发和运维共同奋战在支持的一线&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>消除研发和运维的部门墙&lt;/li>
&lt;/ul>
&lt;h2 id="devops流程">DevOps流程
&lt;/h2>&lt;p>下面看看两种相关流程图。
&lt;img src="https://martinliu.cn/images/7.jpg"
loading="lazy"
alt="7"
>&lt;/p>
&lt;ul>
&lt;li>持续业务计划&lt;/li>
&lt;li>协作型软件开发&lt;/li>
&lt;li>持续测试&lt;/li>
&lt;li>持续发布和部署&lt;/li>
&lt;li>持续监控&lt;/li>
&lt;li>协作式客户反馈和优化&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://martinliu.cn/images/C_Success_with_enterprise_DevOps_CN_pdf.jpg"
loading="lazy"
alt="C_Success_with_enterprise_DevOps_CN_pdf"
>&lt;/p>
&lt;p>上图来源于《Exin DevOps Master 白皮书 - 企业DevOps的成功之路》 作者：Koichiro(Luke) Toda、Nobuyuki Mitsui、译者：刘颋，史鹏程；审校：EXIN，刘征&lt;/p>
&lt;ul>
&lt;li>计划&lt;/li>
&lt;li>需求&lt;/li>
&lt;li>设计&lt;/li>
&lt;li>开发&lt;/li>
&lt;li>部署&lt;/li>
&lt;li>运营&lt;/li>
&lt;li>终止&lt;/li>
&lt;/ul>
&lt;h2 id="7大devops-趋势">7大DevOps 趋势
&lt;/h2>&lt;ol>
&lt;li>DevOps将进入主流，并产生大量关注；因此2017年将成为“DevOps之年”。&lt;/li>
&lt;li>随着DevOps的推广，三个C：持续集成、持续部署和持续交付，将形成巨大的势头。&lt;/li>
&lt;li>即将产生越来越多新的DevOps自动化工具，这些工具改变了我们软件开发的方式。&lt;/li>
&lt;li>“容器化”也将引人注目（例如使用Docker容器）。&lt;/li>
&lt;li>许多软件公司将转向微服务架构。&lt;/li>
&lt;li>自动化测试和持续测试将变得更加普遍，且更加重要。&lt;/li>
&lt;li>必须拥有的工具和平台，包括Docker、AWS、GitHub和JIRA将在开发者社区更受欢迎。&lt;/li>
&lt;/ol>
&lt;p>本文参考来源：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="http://www.rightscale.com/blog/cloud-industry-insights/new-devops-trends-2016-state-cloud-survey" target="_blank" rel="noopener"
>http://www.rightscale.com/blog/cloud-industry-insights/new-devops-trends-2016-state-cloud-survey&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.storybase.com" target="_blank" rel="noopener"
>https://www.storybase.com&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://pt.slideshare.net/johnpviner/devops-be-careful-what-you-wish-for" target="_blank" rel="noopener"
>http://pt.slideshare.net/johnpviner/devops-be-careful-what-you-wish-for&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://en.wikipedia.org/wiki/DevOps" target="_blank" rel="noopener"
>https://en.wikipedia.org/wiki/DevOps&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://www.Google.com" target="_blank" rel="noopener"
>http://www.Google.com&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>DevOps术语表</title><link>https://martinliu.cn/2017/01/07/devops-glossary/</link><pubDate>Sat, 07 Jan 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/2017/01/07/devops-glossary/</guid><description>&lt;img src="https://martinliu.cn/images/pexels-photo.jpg" alt="Featured image of post DevOps术语表" />&lt;h2 id="简介">简介
&lt;/h2>&lt;p>这份术语表的旨在为DevOps实践者提供参考，在重要的专业术语上保持一致。最初的来源是《DevOps Handbook》英文版。译者在翻译的过程中，梳理和总结了一部分。Exin的DOP认证考试基于此书，考试样题也影响和参考了本术语表。本术语表是开放的，欢迎各界业内人士对其修订和增补。目标是形成一份较为完整和准确的参考资料。参与修订的方式见页脚。欢迎但不限于以下方面的专家参与评审和修订：&lt;/p>
&lt;ul>
&lt;li>敏捷开发&lt;/li>
&lt;li>精益/精益UX/精益创业&lt;/li>
&lt;li>丰田生产系统&lt;/li>
&lt;li>ITIL&lt;/li>
&lt;li>互联网公司&lt;/li>
&lt;li>传统企业&lt;/li>
&lt;/ul>
&lt;p>这个页面的另外一个存在：&lt;a class="link" href="https://handbook.martinliu.cn/glossary/" target="_blank" rel="noopener"
>https://handbook.martinliu.cn/glossary/&lt;/a>&lt;/p>
&lt;h2 id="变更日志">变更日志
&lt;/h2>&lt;ul>
&lt;li>2017年1月7日，在Martin‘s Blog和Github上发布了第一个版本。有几个人在Github上参与了修订（请参与者通过邮件或者其他方式告诉我，这里希望再次申明致谢。）&lt;/li>
&lt;li>2017年12月27日，参与修订的人包括卢梦纯（Exin）、刘征、张乐、Wang Jun和许峰。&lt;/li>
&lt;li>本网页当前接受繁体中文的增补，&lt;a class="link" href="https://github.com/DevOps-Handbook/DevOps-Handbook.github.io/graphs/contributors" target="_blank" rel="noopener"
>所有参与者名单&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="术语表">术语表
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>英文&lt;/th>
&lt;th>中文&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>A/B Testing&lt;/td>
&lt;td>A/B测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Acceptance Stage&lt;/td>
&lt;td>验收阶段&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Acceptance Test-Driven Development (Atdd)&lt;/td>
&lt;td>验收测试驱动开发&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Acceptance Tests&lt;/td>
&lt;td>验收测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Accident&lt;/td>
&lt;td>事故&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Affinity&lt;/td>
&lt;td>亲和&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Agile&lt;/td>
&lt;td>敏捷&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Andon Cord&lt;/td>
&lt;td>安灯拉绳&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Anomaly Detection Techniques&lt;/td>
&lt;td>异常探测技术&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Antifragility&lt;/td>
&lt;td>抗脆弱性&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Application Deployment&lt;/td>
&lt;td>应用部署&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Artifact Management&lt;/td>
&lt;td>构件制品库管理&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Artifacts&lt;/td>
&lt;td>制品&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Automated Tests&lt;/td>
&lt;td>自动化测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Automation&lt;/td>
&lt;td>自动化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Backlog&lt;/td>
&lt;td>待办事项列表&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Bad Apple Theory&lt;/td>
&lt;td>坏苹果理论&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Bad Paths&lt;/td>
&lt;td>失败路径&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Batch Sizes&lt;/td>
&lt;td>批次尺寸、批量大小&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Blame&lt;/td>
&lt;td>责备&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Blameless Post Mortem&lt;/td>
&lt;td>免责事后分析&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Blamelessness&lt;/td>
&lt;td>免责&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Blue-Green Deployment&lt;/td>
&lt;td>蓝绿部署&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Blue-Green Deployment Pattern&lt;/td>
&lt;td>蓝绿部署模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Branching Strategy&lt;/td>
&lt;td>分支策略&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Brownfield&lt;/td>
&lt;td>棕地&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Build&lt;/td>
&lt;td>构建&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Business Value&lt;/td>
&lt;td>业务价值&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Canary Release&lt;/td>
&lt;td>金丝雀发布&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Canary Release Pattern&lt;/td>
&lt;td>金丝雀发布模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Card&lt;/td>
&lt;td>卡片&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Change Categories&lt;/td>
&lt;td>变更类别&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Change Schedules&lt;/td>
&lt;td>变更计划&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Cloud Computing&lt;/td>
&lt;td>云计算&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Cloud Configuration Files&lt;/td>
&lt;td>云配置文件&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Cluster Immune System Release Pattern&lt;/td>
&lt;td>集群免疫系统发布模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Code Branch&lt;/td>
&lt;td>代码分支&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Code Review Forms&lt;/td>
&lt;td>代码审查表&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Codified Nfr&lt;/td>
&lt;td>成文的非功能需求&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Collaboration&lt;/td>
&lt;td>协作&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Commit Stage&lt;/td>
&lt;td>提交阶段&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Commit Code&lt;/td>
&lt;td>提交代码&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Compliance Requirement&lt;/td>
&lt;td>合规性要求&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Compliance Checking&lt;/td>
&lt;td>合规性检查&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Compliancy Officer&lt;/td>
&lt;td>合规检测官&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Configuration Management&lt;/td>
&lt;td>配置管理&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Container(S)&lt;/td>
&lt;td>容器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Continuous Deployment&lt;/td>
&lt;td>持续部署&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Continuous Integration&lt;/td>
&lt;td>持续集成(CI)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Continuous Delivery&lt;/td>
&lt;td>持续交付(CD)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Conways Law&lt;/td>
&lt;td>康威定律&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Cycle Time&lt;/td>
&lt;td>周期时间&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Defect Tracking&lt;/td>
&lt;td>缺陷跟踪&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Definition Of Done (Dod)&lt;/td>
&lt;td>完成的定义&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Dev Rituals&lt;/td>
&lt;td>开发仪式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Developer&lt;/td>
&lt;td>开发人员&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Development&lt;/td>
&lt;td>开发&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Devops Transformation&lt;/td>
&lt;td>DevOps转型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Downstream/Upstream&lt;/td>
&lt;td>下游/上游&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Downwards Spiral&lt;/td>
&lt;td>恶性循环&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>E-Mail Pass-Around&lt;/td>
&lt;td>电子邮件轮查&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Expand/Contract Pattern&lt;/td>
&lt;td>扩张/收缩模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Exploratory Test&lt;/td>
&lt;td>探索性测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Fast Feedback&lt;/td>
&lt;td>快速反馈&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Feature&lt;/td>
&lt;td>特性&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Feature Flag&lt;/td>
&lt;td>特性标志&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Feature Toggles&lt;/td>
&lt;td>特性开关&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Feedback/Feedback Loop&lt;/td>
&lt;td>反馈/反馈回路&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Feedforward/Feedforward Loop&lt;/td>
&lt;td>前馈/前馈回路&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Flow&lt;/td>
&lt;td>流&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Gated Commit&lt;/td>
&lt;td>门控提交&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Gaussian Distribution&lt;/td>
&lt;td>高斯分布&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Green Build&lt;/td>
&lt;td>绿色构建&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Greenfield&lt;/td>
&lt;td>绿地&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Handoff&lt;/td>
&lt;td>交接&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Hand-Off Readiness Review&lt;/td>
&lt;td>交接就绪评审&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Happy Paths&lt;/td>
&lt;td>快乐路径&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Hypothesis-Driven Development&lt;/td>
&lt;td>假设驱动开发&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Incident&lt;/td>
&lt;td>事件&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Information Radiators&lt;/td>
&lt;td>信息辐射器&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Infosec&lt;/td>
&lt;td>信息安全&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Infrastructure Automation&lt;/td>
&lt;td>基础架构自动化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Infrastructure As Code&lt;/td>
&lt;td>基础设施即代码&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Integration Tests&lt;/td>
&lt;td>集成测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>I-Shaped, T-Shaped, E-Shaped&lt;/td>
&lt;td>I型，T型，E型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Iteration&lt;/td>
&lt;td>迭代&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Itsm (It Service Management)&lt;/td>
&lt;td>IT服务管理&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Ji-Kotei-Kanketsu (Jkk)&lt;/td>
&lt;td>质量检查（JKK）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Just Culture&lt;/td>
&lt;td>公正文化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Just-In-Time (Jit)&lt;/td>
&lt;td>准时制&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Kaizen (In Lean)&lt;/td>
&lt;td>持续改善&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Kaizen Blitz (Or Improvement Blitz)&lt;/td>
&lt;td>持续改善闪电战&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Kanban&lt;/td>
&lt;td>看板&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Kata&lt;/td>
&lt;td>Kata&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Large Batch Size Merge&lt;/td>
&lt;td>大批量合并&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Latent Defects&lt;/td>
&lt;td>潜在缺陷&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Lauching Guidance&lt;/td>
&lt;td>发布指导&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Launch Readiness Review&lt;/td>
&lt;td>投产就绪评审&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Lead Time&lt;/td>
&lt;td>前置时间&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Lean&lt;/td>
&lt;td>精益&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Learning Culture&lt;/td>
&lt;td>学习文化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Logging Levels&lt;/td>
&lt;td>日志级别&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Loosely Coupled Architecture&lt;/td>
&lt;td>松耦合架构&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Micro-Services&lt;/td>
&lt;td>微服务&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Minimum Viable Product&lt;/td>
&lt;td>最小化可行产品&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monitoring Framework&lt;/td>
&lt;td>监控框架&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monolithic Applications&lt;/td>
&lt;td>单体应用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Monolytics&lt;/td>
&lt;td>单体应用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Mttr&lt;/td>
&lt;td>平均恢复时间&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Non-Functional Requirement (Nfr)&lt;/td>
&lt;td>非功能性需求&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Non-Functional Requirement (Nfr) Testing&lt;/td>
&lt;td>非功能需求测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>(Non) Ideal Testing Pyramid&lt;/td>
&lt;td>（非）理想测试金字塔模型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>One-Piece-Flow&lt;/td>
&lt;td>单件流&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Operations&lt;/td>
&lt;td>运维&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Operations Story&lt;/td>
&lt;td>运维故事&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Ops Liaison&lt;/td>
&lt;td>运维联络人&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Organisational Typology Model&lt;/td>
&lt;td>组织结构模型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Organization Archetypes&lt;/td>
&lt;td>组织原型&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Organizational Learning&lt;/td>
&lt;td>组织级学习&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Over-The-Shoulder&lt;/td>
&lt;td>观察者评审&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Packages&lt;/td>
&lt;td>包&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Pair Programming&lt;/td>
&lt;td>结对编程&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Peer Review&lt;/td>
&lt;td>同行评审&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Pilot&lt;/td>
&lt;td>试点&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Pipeline&lt;/td>
&lt;td>流水线&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Plan-Do-Check-Act Cycle (Pdca Cycle)&lt;/td>
&lt;td>计划-实施-检查-改进 （戴明环）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Post Mortems&lt;/td>
&lt;td>事后回顾&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Post-Mortem&lt;/td>
&lt;td>事后剖析&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Process Time&lt;/td>
&lt;td>处理时间&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Product Owner&lt;/td>
&lt;td>产品负责人&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Pull Request Process&lt;/td>
&lt;td>拉动请求流程&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Qa&lt;/td>
&lt;td>质量保证&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Reduce Batch Size&lt;/td>
&lt;td>降低批次尺寸&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Reduce Number Of Handoffs&lt;/td>
&lt;td>减少交接次数&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Regression Test&lt;/td>
&lt;td>回归测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Release Branch&lt;/td>
&lt;td>发布分支&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Release Managers&lt;/td>
&lt;td>发布经理&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Release Patterns&lt;/td>
&lt;td>发布模式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Retrospective&lt;/td>
&lt;td>回顾&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Rhythm&lt;/td>
&lt;td>节奏&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Roll-Back&lt;/td>
&lt;td>回滚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Sad Path&lt;/td>
&lt;td>悲伤路径&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Safety Culture&lt;/td>
&lt;td>安全文化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Safety Conditions&lt;/td>
&lt;td>安全条件&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Scaling&lt;/td>
&lt;td>规模化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Scrum&lt;/td>
&lt;td>Scrum&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Scrum Master&lt;/td>
&lt;td>Scrum Master&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Security Testing&lt;/td>
&lt;td>安全测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Self Service Capability&lt;/td>
&lt;td>自服务能力&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Service Deployment&lt;/td>
&lt;td>服务部署&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Service Level Agreement (Sla)&lt;/td>
&lt;td>服务级别协议(SLA)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Shared Goals&lt;/td>
&lt;td>共享目标&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Shared Operations Team (Sot)&lt;/td>
&lt;td>共享运维团队&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Shared Version Control&lt;/td>
&lt;td>共享版本控制&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Single Repository&lt;/td>
&lt;td>单一存储库&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Smoke Testing&lt;/td>
&lt;td>冒烟测试&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Sprint&lt;/td>
&lt;td>冲刺&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Staging&lt;/td>
&lt;td>Staging&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Staging Environments, Sit&lt;/td>
&lt;td>准生产环境&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Stakeholder&lt;/td>
&lt;td>利益干系人&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Standard Deviation&lt;/td>
&lt;td>标准差&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Standard Operations&lt;/td>
&lt;td>标准运维&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Static Code Analysis&lt;/td>
&lt;td>静态代码分析&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Swarm&lt;/td>
&lt;td>聚集、聚焦、会诊、围观（动词）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Swarming&lt;/td>
&lt;td>聚集&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>System Of Engagement (Soe)&lt;/td>
&lt;td>交互系统&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>System Of Records (Sor)&lt;/td>
&lt;td>记录系统&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Technical Debt&lt;/td>
&lt;td>技术债务&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Technology Adaption Curve&lt;/td>
&lt;td>技术适应曲线&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Technology Executives&lt;/td>
&lt;td>技术主管&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Telemetry&lt;/td>
&lt;td>遥测&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Test Coverage Analysis&lt;/td>
&lt;td>测试覆盖率分析&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Test Story&lt;/td>
&lt;td>测试故事&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Test-Driven Development&lt;/td>
&lt;td>测试驱动开发&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>The Downward Spiral - Tds&lt;/td>
&lt;td>下行螺旋&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>The Agile Manifesto&lt;/td>
&lt;td>敏捷宣言&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>The Lean Movement&lt;/td>
&lt;td>精益运动&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>The Simian Army: Chaos Gorilla, Chaos Kong, Conformity Monkey, Doctor Monkey, Janitor,Monkey, Latency Monkey, Security Monkey&lt;/td>
&lt;td>猿猴军团（可靠性监控服务），Chaos Gorilla（混沌大猩猩）， Chaos Kong（混沌金刚）, Conformity Monkey（一致性猴子）, Doctor Monkey（医生猴子）, Janitor Monkey（看门猴子）, Latency Monkey（延迟猴子）, Security Monkey（安全猴子）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>The Three Ways&lt;/td>
&lt;td>三步工作法&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Theory Of Constraints&lt;/td>
&lt;td>约束理论&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Ticketing System&lt;/td>
&lt;td>工单系统&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tightly-Coupled&lt;/td>
&lt;td>紧耦合&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tool-Assisted Review&lt;/td>
&lt;td>工具辅助评审&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Tools&lt;/td>
&lt;td>工具&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Toyota Production System (Tps)&lt;/td>
&lt;td>丰田生产系统&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Toyoto Kata&lt;/td>
&lt;td>丰田套路&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Transformation Team&lt;/td>
&lt;td>转型团队&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Trunk&lt;/td>
&lt;td>主干&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>User Story&lt;/td>
&lt;td>用户故事&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Value Stream Mapping&lt;/td>
&lt;td>价值流映射&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Value Stream&lt;/td>
&lt;td>价值流&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Velocity&lt;/td>
&lt;td>速率&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Version Control&lt;/td>
&lt;td>版本控制&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Virtualized Environment&lt;/td>
&lt;td>虚拟化环境&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Visible&lt;/td>
&lt;td>可视的&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Visualisation&lt;/td>
&lt;td>可视化&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Waste&lt;/td>
&lt;td>浪费&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Waste Reduction&lt;/td>
&lt;td>减少浪费&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Waterfall&lt;/td>
&lt;td>瀑布式&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wip (Work In Progress / Process)&lt;/td>
&lt;td>在制品&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Wip Limit&lt;/td>
&lt;td>在制品限制&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Work Center&lt;/td>
&lt;td>工作中心&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="参与修订说明">参与修订说明
&lt;/h2>&lt;p>请帮忙改进本术语表，请直接Fork本代码库，然后提交PR；或者发邮件到：&lt;a class="link" href="mailto:liuzh66@gmail.com" >liuzh66@gmail.com&lt;/a>&lt;/p>
&lt;p>建议最好提供修订原文的简要说明和参考依据。&lt;/p>
&lt;p>GitHub操作注意事项：&lt;/p>
&lt;ul>
&lt;li>建议Fork整个repo做批量更新，小批量可以直接在github网页上提交&lt;/li>
&lt;li>请不要完全删除之前的翻译，可以把旧翻译划横线（使用markdown），在右边添加新的中文意思。&lt;/li>
&lt;/ul></description></item><item><title>Nutanix资源站点清单</title><link>https://martinliu.cn/blog/nutanix-resource-sites/</link><pubDate>Sat, 07 Jan 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/blog/nutanix-resource-sites/</guid><description>&lt;img src="https://martinliu.cn/images/google-earth-view-6043.jpg" alt="Featured image of post Nutanix资源站点清单" />&lt;p>做Nutanix的那些不可不知道的资源网站，这里列出了常用的官方和非官方网站。&lt;/p>
&lt;h2 id="nutanix-官方站点">Nutanix 官方站点
&lt;/h2>&lt;h3 id="">&lt;a class="link" href="http://portal.nutanix.com/" target="_blank" rel="noopener"
>http://portal.nutanix.com/&lt;/a>
&lt;/h3>&lt;p>&lt;a class="link" href="http://portal.nutanix.com/" target="_blank" rel="noopener"
>http://portal.nutanix.com/&lt;/a>&lt;/p>
&lt;ul>
&lt;li>在线文档&lt;/li>
&lt;li>在线技术支持，case查看和操作&lt;/li>
&lt;li>产品和补丁下载&lt;/li>
&lt;/ul>
&lt;h3 id="">&lt;a class="link" href="https://next.nutanix.com/" target="_blank" rel="noopener"
>https://next.nutanix.com/&lt;/a>
&lt;/h3>&lt;p>&lt;a class="link" href="https://next.nutanix.com/" target="_blank" rel="noopener"
>https://next.nutanix.com/&lt;/a>&lt;/p>
&lt;ul>
&lt;li>产品网上论坛和社区&lt;/li>
&lt;li>社区版论坛&lt;/li>
&lt;li>博客， Nutanix Connect Blog&lt;/li>
&lt;/ul>
&lt;h2 id="技术达人网站和博客">技术达人网站和博客
&lt;/h2>&lt;h3 id="myvirtualcloudnet-by-andre-leibovici">myvirtualcloud.net by Andre Leibovici
&lt;/h3>&lt;p>&lt;a class="link" href="http://myvirtualcloud.net/nutanix/" target="_blank" rel="noopener"
>http://myvirtualcloud.net/nutanix/&lt;/a>&lt;/p>
&lt;h3 id="virtual-life-style-by-joep-piscaer">Virtual life style by Joep Piscaer
&lt;/h3>&lt;p>&lt;a class="link" href="https://www.virtuallifestyle.nl/" target="_blank" rel="noopener"
>https://www.virtuallifestyle.nl/&lt;/a>&lt;/p>
&lt;h3 id="the-nutanix-bible-by-steven-poitras">The Nutanix Bible by Steven Poitras
&lt;/h3>&lt;p>&lt;a class="link" href="http://nutanixbible.com/" target="_blank" rel="noopener"
>http://nutanixbible.com/&lt;/a>&lt;/p>
&lt;h3 id="marks-blog-by-mark-lavi">Mark&amp;rsquo;s Blog by Mark Lavi
&lt;/h3>&lt;p>&lt;a class="link" href="http://mlavi.github.io/" target="_blank" rel="noopener"
>http://mlavi.github.io/&lt;/a>&lt;/p>
&lt;h3 id="jeremy-sallee----nutanix-uifrontend-设计师">Jeremy Sallee - Nutanix UI/Frontend 设计师
&lt;/h3>&lt;p>&lt;a class="link" href="http://salleedesign.com/stuff/sdwip/home/" target="_blank" rel="noopener"
>http://salleedesign.com/stuff/sdwip/home/&lt;/a>&lt;/p>
&lt;p>想知道Prism是怎么设计出来的：&lt;a class="link" href="http://salleedesign.com/stuff/sdwip/blog/nutanix-case-study/" target="_blank" rel="noopener"
>点这里&lt;/a>&lt;/p>
&lt;h3 id="virtual-dennis-by-dennis-laube">Virtual Dennis by Dennis Laube
&lt;/h3>&lt;p>&lt;a class="link" href="http://www.virtualdennis.com/category/nutanix/" target="_blank" rel="noopener"
>http://www.virtualdennis.com/category/nutanix/&lt;/a>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="http://www.virtualdennis.com/importing-an-ovf-ova-into-nutanix-ahv-using-prism/" target="_blank" rel="noopener"
>如何ova格式的虚拟机导入Nutanix AHV&lt;/a> 镜像服务能够支持Web界面上传导入的格式包括：raw, vhd, vmdk, vdi, iso 和 qcow2 磁盘，导入为Disk后，即可用做模板&lt;/li>
&lt;li>&lt;a class="link" href="http://www.virtualdennis.com/nutanix-acropolis-hypervisor-ahv-create-an-image-service-template-from-an-existing-vm/" target="_blank" rel="noopener"
>如何在Nutanix中制作AHV虚拟机模板&lt;/a> 使用acli命令：vm.disk_get；image.create W2K12R2-Template clone_from_vmdisk=69df5abd-6570-4ce1-ba77-2d117c3df7e5 image_type=kDiskImage&lt;/li>
&lt;li>&lt;/li>
&lt;/ul>
&lt;h2 id="其他资源">其他资源
&lt;/h2>&lt;h3 id="nutanix-viso-图标下载">Nutanix viso 图标下载
&lt;/h3>&lt;p>&lt;a class="link" href="http://www.visiocafe.com/nutanix.htm" target="_blank" rel="noopener"
>http://www.visiocafe.com/nutanix.htm&lt;/a>&lt;/p></description></item><item><title>DevOps书单</title><link>https://martinliu.cn/2017/01/03/devops-booklist/</link><pubDate>Tue, 03 Jan 2017 00:00:00 +0000</pubDate><guid>https://martinliu.cn/2017/01/03/devops-booklist/</guid><description>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/pexels-photo.jpg" alt="Featured image of post DevOps书单" />&lt;p>学习DevOps应该会使用到的书籍清单。&lt;/p>
&lt;p>我在豆瓣建立了一个书单，欢迎在豆瓣给我留言，评论和建议。&lt;a class="link" href="https://www.douban.com/doulist/46341810/" target="_blank" rel="noopener"
>豆瓣书单点这里。&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-25.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-22-24.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-19-21.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-16-18.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-13-15.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-10-12.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-7-9.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-4-6.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;p>&lt;img src="https://res.cloudinary.com/martinliu/image/upload/booklist-1-3.png"
loading="lazy"
alt="DevOps书单"
>&lt;/p>
&lt;hr>
&lt;p>本清单来自于《DevOps Handbook》书中提到的书，更新到第五本；《看板方法》、《精益思想》、《Implementing Lean Software Development: From Concept to Cash》、《第五项修炼:学习型组织的艺术与实践》、《探索吧!深入理解探索式软件测试》&lt;/p>
&lt;h2 id="看板方法-科技企業漸進變革成功之道">《看板方法-科技企業漸進變革成功之道》
&lt;/h2>&lt;p>转自：&lt;a class="link" href="https://ruddyblog.wordpress.com/2014/09/30/%E7%9C%8B%E6%9D%BF%E6%96%B9%E6%B3%95-%E7%A7%91%E6%8A%80%E4%BC%81%E6%A5%AD%E6%BC%B8%E9%80%B2%E8%AE%8A%E9%9D%A9%E6%88%90%E5%8A%9F%E4%B9%8B%E9%81%93/" target="_blank" rel="noopener"
>Rubbyblog.wordpress.com&lt;/a>/images/&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/kanban-book.png"
loading="lazy"
alt="kanban-book"
>&lt;/p>
&lt;p>今天要介紹看板方法的由來， 上面這本書是由看板方法之父 David J. Anderson 於: 2010年 4月所著。簡字版是 2014 年2月出版。這篇文章在我上 TechDays 課程時就想登出來了，想把好書介紹給大家。但由於台灣的書商都沒有進口，所以一直等到我拿到第一批書後，肯定大家可以在坊間買到書時才把他登出來。原文書名: Kanban: Successful Evolutionary Change for Your Technology Business.&lt;/p>
&lt;p>看板方法：它是敏捷陣營中實施起來阻力最小，生產力又能大幅提升、前置時間大幅下降，而可預測性又絕佳的敏捷解決方案之一。好神奇喔 … 哈哈! 確實如此，所以我才會這麼急切的推薦給大家。另一個原因是Kanban Method 現在在美國正熱烈風行中，而我們現在開始追正是時候。為此放下了許多手上正在做的工作(包括一本 Scrum的教本)，努力開始推廣希望大家能受用。首先說明: 為何他推廣起來阻力最小?&lt;/p>
&lt;p>※ 實施起來阻力最小:&lt;/p>
&lt;p>因為David J. Anderson 本身是一個微軟的 PM出身，他跟大家一樣知道變革會讓許多人害怕，人們會認為自己的技術是否落伍了，開始擔心害怕變革會對自己的工作事業帶來不利，這種恐懼常常會帶來一種莫名的對立，因此在還沒開始變革之前就已經採取抵制的態度了。所以他創始的看板方法選擇從哪裡開始實施呢? 就從現在既有的流程開始。由工作者本身最熟悉的地方開始。起步的秘訣是甚麼呢? 是精實精神中從豐田系統中學來的原則，先從不浪費開始，作法: 在識別浪費後消除浪費。&lt;/p>
&lt;p>※ 如何能讓生產力大幅提升?&lt;/p>
&lt;p>由審視既有流程，依據 Little’s law的最大產出方法，接著找出阻礙最大產能的瓶頸所在，然後正視這個造成瓶頸的問題，把它顯現在看板上面，讓大家一起站在看板前面討論如何解決它，解決之後再持續進行改善的作業。&lt;/p>
&lt;p>※ 前置時間大幅下降&lt;/p>
&lt;p>過去我們都以為唯有透過良好的規劃及配合才能夠讓前置作業時間下降，但豐田企業的及時(Just In Time)備料讓庫存降至最低，讓半成品減至最少改變了工作流程的前置時間(Lead time)，因此得到大幅下降。&lt;/p>
&lt;p>看板還是看板方法 (Kanban or Kanban Method) 英文叫 Kanban，上網去搜尋會得到一大堆有關製造業的看板資料。所以請使用 Kanban Method去搜尋，因此中文就該叫做「看板方法」。簡體版的作者有用心在翻譯因此翻對了，值得買來閱讀。全書分成四部分:&lt;/p>
&lt;p>※ 第一部分；導讀: 作者說出他的想法，以及創作看板方法的原由。&lt;/p>
&lt;p>※ 第二部分；談使用看板方法的好處: 這裡有他個人做顧問時的經驗談，值得仔細閱讀。&lt;/p>
&lt;p>※ 第三部分；開始談實施看板方法的步驟了。(由六到十五章，好長又夠完整)&lt;/p>
&lt;p>※ 第四部分；談持續改進。在這裡你終於可以感受到精實軟體開發對作者的影響，以及作者由經濟學的角度來看精實軟體開發的第一原則: 消除浪費。&lt;/p>
&lt;p>接下來我就不在多說了，請讀者自己去看吧!(透漏一下，為了共襄盛舉，我正在寫一本有關精實開發的書，內容除了看板方法之外會大幅談到精實軟體開發，在這裡不想打廣告，因此書名就等出版後再說了!)&lt;/p>
&lt;h2 id="精益思想白金版">精益思想(白金版)
&lt;/h2>&lt;p>这本书在亚马逊中国有售：&lt;a class="link" href="https://www.amazon.cn/%e7%b2%be%e7%9b%8a%e6%80%9d%e6%83%b3-%e8%a9%b9%e5%a7%86%e6%96%afP-%e6%b2%83%e9%ba%a6%e5%85%8b" target="_blank" rel="noopener"
>https://www.amazon.cn/精益思想-詹姆斯P-沃麦克&lt;/a>
&lt;img src="https://martinliu.cn/images/14836204523398.jpg"
loading="lazy"
>&lt;/p>
&lt;p>&lt;strong>简介&lt;/strong>&lt;/p>
&lt;p>《精益思想》于1996年秋季首次出版，历经20年，畅 销十多个国家，累计销量上百万册。本书的成功在于它对精益生产方式做了最 好的总结，为读者提供了精益的核心原则，实地考察了美国、德国、日本若干具有代表性的大小企业推行精益的实际情况和心得，为准备跨入精益之门和进一步学习、实施精益的人提供了最 好的指南，从而成为精益方面的经典著作。&lt;/p>
&lt;p>&lt;strong>基本信息&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">出版社: 机械工业出版社; 第1版 (2015年8月1日)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">外文书名: Lean Thinking ：Banish Waste and Create Wealth in Your Corporation
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">丛书名: 精益思想丛书
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">平装: 365页
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">语种： 简体中文
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">开本: 16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN: 7111510712, 9787111510710
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">条形码: 9787111510710
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品尺寸: 24 x 17.4 x 1.8 cm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品重量: 621 g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">品牌: 机械工业出版社
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ASIN: B0142EC7AA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">用户评分: 平均4.5 星 浏览全部评论 (82 条商品评论)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">亚马逊热销商品排名: 图书商品里排第7,694名
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="implementing-lean-software-development-from-concept-to-cash">Implementing Lean Software Development: From Concept to Cash
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14837758468347.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="基本信息">基本信息
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">出版社: Addison-Wesley Professional; 1 (2009年10月31日)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">丛书名: Addison-Wesley Signature Series (Beck)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">平装: 312页
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">语种： 英语
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN: 0321620704
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">条形码: 9780321620705
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品尺寸: 17.5 x 1.8 x 22.9 cm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品重量: 499 g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">品牌: Pearson
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ASIN: 0321620704
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">用户评分: 分享我的评价
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">亚马逊热销商品排名: 图书商品里排第1,441,726名 (查看图书商品销售排行榜)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">第64位 - 图书 &amp;gt; 进口原版书 &amp;gt; Computers &amp;amp; Technology（计算机与科技） &amp;gt; Business &amp;amp; Management（商业与管理） &amp;gt; Project Management
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">第393位 - 图书 &amp;gt; 进口原版书 &amp;gt; Computers &amp;amp; Technology（计算机与科技） &amp;gt; Programming（编程） &amp;gt; Software Design, Testing &amp;amp; Engineering &amp;gt; Software Development
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="作者简介">作者简介
&lt;/h3>&lt;p>Mary Poppendieck has led teams implementing various solutions ranging from enterprise supply chain management to digital media. Mary is the president of Poppendieck LLC, which specializes in bringing lean techniques to software development.&lt;/p>
&lt;p>Tom Poppendieck, an enterprise analyst, architect, and agile process mentor, currently assists organizations in applying lean principles and tools to software development processes. The Poppendiecks are authors of Lean Software Development, winner of the 2004 Jolt Software Development Productivity Award, and Implementing Lean Software Development (both from Addison-Wesley).&lt;/p>
&lt;h2 id="the-fifth-discipline-the-art--practice-of-the-learning-organization">The Fifth Discipline: The Art &amp;amp; Practice of The Learning Organization
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14840700653952.jpg"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/14840700772382.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="基本信息--第五项修炼学习型组织的艺术与实践">基本信息 第五项修炼：学习型组织的艺术与实践
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">出版社: 中信出版社; 第1版 (2009年10月1日)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">外文书名: The Fifth Discipline:The Art &amp;amp; Practice of The Learning Organization
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">平装: 455页
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">语种： 简体中文
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">开本: 16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN: 7508616820, 9787508616827
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">条形码: 9787508616827
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品尺寸: 22.8 x 17 x 2.8 cm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品重量: 739 g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">品牌: 中信出版股份有限公司
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ASIN: B002QMKJ4C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">用户评分: 平均4.5 星 浏览全部评论 (322 条商品评论)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">亚马逊热销商品排名: 图书商品里排第1,333名 (查看图书商品销售排行榜)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">第6位 - 图书 &amp;gt; 经济管理 &amp;gt; 管理学理论与方法论 &amp;gt; 管理学基础理论
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">第17位 - 图书 &amp;gt; 经济管理 &amp;gt; 企业经营与管理 &amp;gt; 管理指南
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">第617位 - 图书 &amp;gt; 在线试读
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="编辑推荐">编辑推荐
&lt;/h3>&lt;p>《第五项修炼:学习型组织的艺术与实践(新世纪全新扩充修订版)》由当代最杰出的新管理大师彼得•圣吉撰写的著作，被誉为21世纪的管理圣经、20世纪屈指可数的几本管理经典、世界上影响最深远的管理书籍之一，并被《哈佛商业评论》评为过去75年具有影响力的管理类图书，还荣获世界企业学会荣誉的开拓者奖！
进入21世纪以来，全球经济的迅猛发展，使得全球企业管理趋势、管理理念也顺应发生了巨大的变化，作为新世纪全新扩充修订版，《第五项修炼:学习型组织的艺术与实践(新世纪全新扩充修订版)》其背后是15年来把原书理念付诸实践的经验和案例。圣吉明确指出，从长远来看，你的组织可持续的竞争优势，就是比对手更好更快的学习能力。15年前，许多《第五项修炼》的核心理念都曾显得很激进。但这些理念的许多应用方法，后来已经被融入到人们观察世界的方式中，也被整合到人们的管理实践中；《第五项修炼:学习型组织的艺术与实践(新世纪全新扩充修订版)》对前一版进行了全面修订，新版书中的领导力案例故事揭示了这些经历。并增添了新的内容：实践中的反思，为企业、个人读者更准确理解最新管理理念，对学习型组织进行了有效的反思，对建设学习型组织所面临的新疑惑提供了新的思维。&lt;/p>
&lt;h3 id="名人推荐">名人推荐
&lt;/h3>&lt;p>流行的管理体系很摧残人……教育界、工商界和政府机构的管理层的任务，应该是使系统最优化……彼得·圣吉的著作《第五项修炼》是帮助开始这项工作的好书，它让我学到了许多东西。
——爱德华·戴明博士，全面质量管理运动(TQM）的先驱。&lt;/p>
&lt;h3 id="媒体推荐">媒体推荐
&lt;/h3>&lt;p>《第五项修炼》是过去75年来最有影响力的管理学著作之一。
——《哈佛商业评论》
圣吉的这本著作已经是一本不折不扣的管理学经典。
——《波士顿环球报》&lt;/p>
&lt;h3 id="作者简介-1">作者简介
&lt;/h3>&lt;p>作者：（美国）彼得•圣吉 译者：张成林&lt;/p>
&lt;p>彼得•圣吉博士（Dr.Peter M. Senge），麻省理工学院斯隆管理学院的高级教授讲师，国际组织学习学会（SoL）和索奥中国（SoL China）的创始主席。除《第五项修炼》之外，他还与人合著了《第五项修炼实践篇》（1994）、《变革之舞》（1999）、《学习型学校》（Schools that Learn, 2000）、《体悟当下》（Presence, 2004），以及最近出版的《必要的革命》（The Necessary Revolution, 2008）等著作。圣吉被誉为最富创新精神的世界级管理学和领导学思想大师之一。他早年毕业于斯坦福大学工程专业，并获得麻省理工社会系统模型硕士和管理学博士，现家居美国马萨诸塞州。&lt;/p>
&lt;h2 id="explore-it-reduce-risk-and-increase-confidence-with-exploratory-testing">Explore It!: Reduce Risk and Increase Confidence with Exploratory Testing
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14841498198916.jpg"
loading="lazy"
>&lt;/p>
&lt;p>&lt;img src="https://martinliu.cn/images/14841498461381.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="探索吧深入理解探索式软件测试">探索吧!深入理解探索式软件测试
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">出版社: 机械工业出版社; 第1版 (2014年1月1日)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">外文书名: Explore It! Reduce Risk and Increase Confidence with Exploratory Testing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">丛书名: 软件工程技术丛书
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">平装: 151页
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">语种： 简体中文
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">开本: 16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN: 9787111451587
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">条形码: 9787111451587
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品尺寸: 24.2 x 16.8 x 0.8 cm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品重量: 281 g
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">品牌: 机械工业出版社
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ASIN: B00IHQBQZC
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>编辑推荐
《探索吧!深入理解探索式软件测试》给出实用性很强的理念，可用于探索从典型GUI场景到测试软件需求的一切，还包括如何探索低层级代码的建议。此书不只是给软件测试人员看的，对软件管理人员、开发人员也具有重大意义。&lt;/p>
&lt;p>名人推荐
“Elisabeth开创了将探索式测试应用于敏捷开发的先河，并推动它不断演进，使其成为了一种主流实践。”
——Ward Cunnningham wiki概念的发明者 设计模式和敏捷软件方法的先驱之一&lt;/p>
&lt;p>“这是我看到的最佳书籍之一。优良的测试设计源自优良的测试思路，这本书里满是各种优秀的测试思路，辅以故事情节烘托，涎玉沫珠。”
——Alan Page 微软公司Principal SDEI《微软的软件测试之道》作者&lt;/p>
&lt;h2 id="the-field-guide-to-understanding-human-error">The Field Guide to Understanding &amp;lsquo;Human Error‘
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14842313763902.jpg"
loading="lazy"
>&lt;/p>
&lt;p>This latest edition of The Field Guide to Understanding ‘Human Error&amp;rsquo; will help you understand how to move beyond &amp;lsquo;human error&amp;rsquo;; how to understand accidents; how to do better investigations; how to understand and improve your safety work. You will be invited to think creatively and differently about the safety issues you and your organization face. In each, you will find possibilities for a new language, for different concepts, and for new leverage points to influence your own thinking and practice, as well as that of your colleagues and organization.&lt;/p>
&lt;h3 id="product-details">Product Details
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">File Size: 3149 KB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Print Length: 247 pages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Publisher: Ashgate; 3 edition (December 28, 2014)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Publication Date: December 28, 2014
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sold by: Amazon Digital Services LLC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Language: English
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ASIN: B00Q8XCSFI
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Text-to-Speech: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">X-Ray:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Not Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Word Wise: Enabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Lending: Not Enabled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="about-the-author">About the Author
&lt;/h3>&lt;p>Sidney Dekker (PhD Ohio State University, USA, 1996) is currently professor at Griffith University in Brisbane, Australia, where he runs the Safety Science Innovation Lab. He is also Professor (Hon.) of psychology at The University of Queensland, and Professor (Hon.) of human factors and patient safety at the Royal Children&amp;rsquo;s Hospital in Brisbane. Previously, Sidney was Professor of human factors and system safety at Lund University in Sweden. After becoming full professor, he learned to fly the Boeing 737, working part-time as an airline pilot out of Copenhagen. Sidney is the best-selling author of a multitude of human factors and safety books, including, most recently, Safety Differently (2014), Second Victim (2013), Just Culture (2012), Drift into Failure (2011), and Patient Safety (2011).&lt;/p>
&lt;h2 id="lean-it-enabling-and-sustaining-your-lean-transformation">Lean IT: Enabling and Sustaining Your Lean Transformation
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14844093662859.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="review">Review
&lt;/h3>&lt;p>This book will have a permanent place in my bookshelf. In my ten-year study of high performing IT organizations, I’ve found that businesses rely on IT far more than they think. The impacts of poor flow from application development into IT operations can be devastating: ever increasing cycle times and amounts of rework, and an ever increasing amount of heroics required in IT operations to preserve the illusion of stability and reliability.
―Gene Kim, Chief Technology Officer, Tripwire, Inc.&lt;/p>
&lt;p>There has never been a more critical time to improve how IT integrates with the global business enterprise. This book provides an unprecedented look at the role that Lean will play in making this revolutionary shift and the critical steps for sustained success.
―Steve Castellanos, Lean Enterprise Director; Nike, Inc.&lt;/p>
&lt;p>Twenty years from now the firms which dominate their industries will have fully embraced lean strategies throughout their IT organizations. Ten years from now those organizations will have started pulling ahead of their competitors as the result of lean IT. Today this book will show those organizations the path they need to start out on. Will your organization be one of them?
―Scott W. Ambler, Chief Methodologist for Agile and Lean, IBM Rational&lt;/p>
&lt;p>&amp;hellip; goes both wide and deep in its exploration of Lean … a great survival manual for those needing nimble and adaptive systems.
―Dr. David Labby, MD, PhD, Medical Director and Director of Clinical Support and Innovation, CareOregon&lt;/p>
&lt;p>This book makes a major contribution in an often-ignored but much-needed area. It ranges over a huge area – including excellent cases – that will bring IT professionals into the Lean fold but will also enable Lean managers to reach out to IT.
―John Bicheno, Program Director MS in Lean Operations, Cardiff University&lt;/p>
&lt;p>… a comprehensive view into the world of Lean IT, a must read!
―Dave Wilson, Quality Management, Oregon Health &amp;amp; Science University&lt;/p>
&lt;h3 id="about-the-author-1">About the Author
&lt;/h3>&lt;p>Steve Bell, CFPIM brings over twenty years&amp;rsquo; experience in finance, operations management and information systems. He is the author of Lean Enterprise Systems, Using IT for Continuous Improvement. (2006)&lt;/p>
&lt;p>Mike Orzen, CMA, CFPIM, PMP delivers a unique blend of IT, operations management, Lean, Six Sigma, and project management. With a BA from Stanford University in economics and an MBA from the University of Oregon, Mike has been consulting, coaching, and teaching for over 20 years.&lt;/p>
&lt;p>Steve and Mike are faculty members of the Lean Enterprise Institute. Together, the authors combine their experience in information systems and process improvement to share their lessons learned.&lt;/p>
&lt;h3 id="product-details-1">Product Details
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Hardcover: 370 pages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Publisher: Productivity Press; 1 edition (September 14, 2010)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Language: English
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN-10: 1439817561
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN-13: 978-1439817568
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Product Dimensions: 6.1 x 1 x 9 inches
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Shipping Weight: 1.4 pounds (View shipping rates and policies)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Average Customer Review: 4.9 out of 5 stars See all reviews (20 customer reviews)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Amazon Best Sellers Rank: #129,956 in Books (See Top 100 in Books)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="true-north-discover-your-authentic-leadership">True North: Discover Your Authentic Leadership
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14844095698595.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="review-1">Review
&lt;/h3>&lt;p>&amp;ldquo;With great clarity and insight, Bill George and Peter Sims make a persuasive argument that the journey toward authentic leadership—that finding and pursuing your own True North&amp;ndash;is the key to leadership in all fields, whether in business, government, or the nonprofit arena.&amp;rdquo;
—From the Foreword by David Gergen&lt;/p>
&lt;p>&amp;ldquo;In True North, Bill George once again provides a roadmap for leadership in the 21st Century. The future belongs to leaders who want to win, without ever losing track of their own values. We live in a day when the best people can work anywhere. They will follow only authenticity—a person who leads with passion and purpose.&amp;rdquo;
—Jeff Immelt, CEO, General Electric&lt;/p>
&lt;p>&amp;ldquo;True North is an awe-inspiring gift to the world. The 125 men and women whose leadership journeys are so beautifully rendered in this book show us that we can have enormous impact without compromising our values—indeed, that we are more successful when we stay true to our ideals. Every aspiring leader (or leader who aspires to become even better) will draw strength and wisdom from this wonderful book.&amp;rdquo;
—Rosabeth Moss Kanter, Harvard Business School professor and best-selling author of Confidence: How Winning Streaks &amp;amp; Losing Streaks Begin &amp;amp; End&lt;/p>
&lt;p>&amp;ldquo;True North is about the power of authentic leadership. Great leaders are defined by a sense of passion and purpose and by a profound desire to make a difference. Anyone can find their own True North, if you care deeply and love what you do. This book is a wonderful roadmap for how to get started on the journey.&amp;rdquo;
—Andrea Jung, chairman and CEO, Avon Products, Inc.&lt;/p>
&lt;p>&amp;ldquo;If you want to move your leadership in the right direction, read True North. Drawing on the personal stories of some of the world’s most effective leaders, the book shows that you become a successful leader when you stay on course with your highest self.&amp;rdquo;
—Ken Blanchard, coauthor of The One Minute Manager® and Leading at a Higher Level&lt;/p>
&lt;p>&amp;ldquo;True North provides a new leadership paradigm and a window into the stories and approaches of dozens of our nation’s best leaders. It is an inspirational, invaluable source of guidance for those who want to make a significant impact.&amp;rdquo;
—Wendy Kopp, president and founder of Teach for America&lt;/p>
&lt;p>&amp;ldquo;True North reveals just how powerful authentic leadership can be and, best of all, how to achieve it.&amp;rdquo;
—Warren Bennis&lt;/p>
&lt;h3 id="product-details-2">Product Details
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Hardcover: 251 pages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Publisher: Jossey-Bass; 1 edition (March 9, 2007)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Language: English
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN-10: 0787987514
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN-13: 978-0787987510
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Product Dimensions: 6.3 x 1 x 9.4 inches
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Shipping Weight: 1 pounds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Average Customer Review: 4.5 out of 5 stars See all reviews (129 customer reviews)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Amazon Best Sellers Rank: #17,250 in Books (See Top 100 in Books)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="gemba-walks">Gemba Walks
&lt;/h2>&lt;p>&lt;img src="https://martinliu.cn/images/14844099928904.jpg"
loading="lazy"
>&lt;/p>
&lt;h3 id="editorial-reviews">Editorial Reviews
&lt;/h3>&lt;p>In 12 new essays, ranging from the provocative to the practical and written specially for the second edition of Gemba Walks author and management expert Jim Womack reflects on the past 30 years of lean, and assesses the current state of lean today.
He also shares thoughts on how lean thinking and practice can continue to make the world a better place by gaining traction in areas such as government and healthcare, provides practical guidance for how leaders everywhere can realize the full benefits of a lean management system, and shares hope for continued improvement on the path to better work and more value.
Over the past 30 years, Womack has developed a method of going to visit the gemba at countless companies and keenly observing how people work together to create value. He has shared his thoughts and discoveries from these visits with the lean community through a monthly letter. With Gemba Walks second edition, Womack has selected and re-organized his key letters, as well as written 12 new essays.
Gemba Walks shares his insights on topics ranging from the application of specific tools, to the role of management in sustaining lean, as well as the long-term prospects for this fundamental new way of creating value. Reading this book will reveal to readers a range of lean principles, as well as the basis for the critical lean practice of: go see, ask why, and show respect.
Womack explains:
• whatever happened to Toyota and what happens next to lean?
• how lean got its name 25 years ago; a special essay co-authored by Jim and John Krafcik, president and CEO, Hyundai Motors America
• work, management, and leadership &amp;ndash; what is the real work of the lean leader?
• don’t offshore or reshore –leanshore
• why companies need fewer heroes and more farmers (who work daily to improve the processes and systems needed for perfect work and who take the time and effort to produce long-term improvement)
• how “good” people who work in “bad” processes become as “bad” as the process itself
• how the real practice of showing respect comes down to helping workers frame and solve their own problems
• how the short-term gains from lean tools can be translated to enduring change from lean management.
• how the lean manager has a “restless desire to continually rethink the organization’s problems, probe their root causes, and lead experiments to test the best currently known countermeasures”
By sharing his personal path of discovery, Womack sheds new light on the continued adoption and development of the most important new business system of the past fifty years. His journey will provide courage and inspiration for every lean practitioner today.&lt;/p>
&lt;h3 id="product-details-3">Product Details
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Paperback: 311 pages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Publisher: Lean Enterprise Institute, Inc.; 2nd ed. edition (January 1, 2013)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Language: English
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN-10: 193410938X
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISBN-13: 978-1934109380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Product Dimensions: 6 x 1 x 8.9 inches
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Shipping Weight: 1.6 pounds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Average Customer Review: 3.7 out of 5 stars See all reviews (10 customer reviews)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Amazon Best Sellers Rank: #357,633 in Books (See Top 100 in Books)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 11799 in Books &amp;gt; Textbooks &amp;gt; Business &amp;amp; Finance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 39798 in Books &amp;gt; Business &amp;amp; Money
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Continuous Delivery: Reliable Software Releases Through Build, Test, and Deployment Automation&lt;/p>
&lt;p>持续交付：发布可靠软件的系统方法&lt;/p>
&lt;p>&lt;a class="link" href="http://item.jd.com/10843669.html" target="_blank" rel="noopener"
>http://item.jd.com/10843669.html&lt;/a>&lt;/p>
&lt;p>Eric J.Evans在《领域驱动设计》一书中&lt;/p>
&lt;p>**Domain Driven Design by Eric J. Evans.&lt;/p>
&lt;p>《Architecture and Patterns for IT Service Management, Resource Planning, and Governance: Making Shoes for the Cobbler’s Children, observes》&lt;/p>
&lt;p>正如Steven j. Spear在他的书《The High-Velocity Edge》&lt;/p>
&lt;p>1984年由Eliyahu M. Goldratt博士写的《目标：简单而有效的常识管理》。&lt;/p>
&lt;p>2009年，Mike Rother编写了《丰田套路：转变我们对领导力与管理的认知》（&lt;em>Toyota Kata: Managing People for Improvement, Adaptiveness and Superior Results&lt;/em>）&lt;/p>
&lt;p>Value Stream Mapping: How to Visualize Work and Align Leadership for Organizational Transformation&lt;/p>
&lt;p>(英语) 精装 – 2013年12月16日
Karen Martin (作者), Mike Osterling (作者)&lt;/p>
&lt;p>&lt;a class="link" href="https://www.amazon.com/dp/B00EHIEJLM/ref=dp-kindle-redirect?_encoding=UTF8&amp;amp;btkr=1" target="_blank" rel="noopener"
>https://www.amazon.com/dp/B00EHIEJLM/ref=dp-kindle-redirect?_encoding=UTF8&amp;btkr=1&lt;/a>&lt;/p>
&lt;p>In the book Implementing Lean Software Development: From Concept to Cash, Mary and Tom Poppendieck describe waste and hardship in the software development stream as anything that causes delay for the customer, such as activities that can be bypassed without affecting the result.&lt;/p>
&lt;p>“点名、责备和羞辱”模式是Sydney Dekker博士批评的坏苹果理论的一部分，在他的书《The Field Guide to Understanding Human Error》里有深入讨论。&lt;/p>
&lt;p>《Gemba Walks》的作者Jim Womack描述了领导者和前线工作者之间必须发生的互补工作关系和相互尊重。根据Womack的说法，这种关系是必要的，因为谁都无法单独解决问题 - 领导者并不会足够的贴近一线工作，这是解决任何问题所需要的，而前线工作者也没有更广的组织背景的认知或权&lt;/p>
&lt;p>After the near-death experience of eBay in the late 1990s, Marty Cagan, author of Inspired: How To Create Products Customers Love, the seminal book on product design and management, codified the following lesson:&lt;/p>
&lt;p>界定上下文(Bounded contexts)是Eric J.Evans在《领域驱动设计》一书中提出的概念。其思路是开发人员能够理解和更新服务的代码，而不需要知道其关联服务（peers）的内部逻辑。同时，服务间严格通过API协作，不共享数据结构、数据库Schema或内部的对象。界定上下文确保服务间职责的划分，并具有良好定义的接口，同时也提高了可测试性。&lt;/p>
&lt;p>Scrumisanagiledevelopmentmethodology,describedas“aflexible,holisticproductdevel- opment strategy where a development team works as a unit to reach a common goal.” It was first fully described by Ken Schwaber and Mike Beedle in the book Agile Software Development with Scrum. In this book, we use the term “agile development” or “iterative development” to encompass the various techniques used by special methodologies such as Agile and Scrum.&lt;/p></description></item><item><title>EXIN DevOps Master 认证考试</title><link>https://martinliu.cn/2016/11/07/exin-devops-master-e8aea4e8af81e88083e8af95/</link><pubDate>Mon, 07 Nov 2016 15:19:08 +0000</pubDate><guid>https://martinliu.cn/2016/11/07/exin-devops-master-e8aea4e8af81e88083e8af95/</guid><description>&lt;p>DevOps 这个词在去年参加红帽全球用户大会的时候就深深吸引了我，实际上哪个会上 Docker 容器的概念要比 DevOps 还火爆。Docker／openshift 相关的 session 都尝尝是爆满的。从那里开始我逐渐感觉到了开源容器技术的强大和吸引力。&lt;/p>
&lt;p>从红帽开始 OpenShift 的考试就是我在完成 RHCA 红帽认证架构师之后的一个心结，至今也没有完成。不过这根草我早晚是要拔掉的。主要是由于 OpenShift 是 Docker ＋ kubernetes 的组合；是如今企业级 PaaS 容器平台的主要技术路线。总之离开红帽是如此的仓促，说实话这也是我职业生涯中的一个不小的遗憾。当时确实觉得 kubernetes 的命令行操作不是很方便，而且在 OpenShift 并没有降低这个门槛，也即是说在 OpenShift 里面还是要有一定的工作量和技能的要求在编写 kubernetes 的 yml 文件上。在这一点上，及时我熟练掌握了 Rancher 之后，同样发现编写 compose file 也是难以逃避的。在推广一步，大部分 Docker PaaS 平台也都是这样，很多产品也是在界面上提供一个文本输入框，让人输入容器服务定义文件的内容。&lt;/p>
&lt;p>在最近的半年中，我的所有技术研究都集中在 Docker 和其服务编排技术上。与很多用户做过技术交流，PoC 测试，有些单子也落地。总结后，有些结果让我感叹。国内的所有企业不区分规模和行业，其实他们对国内原生的创业公司是欢迎的，由于这些公司提供的是国产软件和技术服务。在 Docker 这个火热的领域中，已经有 20 多家国内创业公司，我想所有的公司也都已经接受到了这一点的福利了。外国软件通常给人的感觉是：不是国产软件（不要小看国内公司对国产软件的诉求），纯英文操作界面和文档，可能的水土不服，高昂的软件价格和服务费，如果技术太新的化很可能厂商也不具备足够的技术实力和服务力量。&lt;/p>
&lt;p>经过了一些 Docker 容器项目之后，可以断言的是容器市场的火爆和它的技术优势是直接相关的。容器化之后的应用可以通过服务编排工具快速地部署／更新、弹性地伸缩和使用资源，优化其传统应用运维的若干缺陷。容器的轻量和 just enough 的隔离技术让资源池的管理更加简单，利用率大幅度提升，这对研发部门的环境管理是不小的提升，使 CI 的过程更加高效和经济。Docker 对微服务的支持也深深地诱惑了所有开发者，做系统微服务实施开发者能想到的实施技术大多数会是容器。&lt;/p>
&lt;p>以上容器的优势和特性使得国内的这些项目落地和实施的可能性进一步提高，甚至很多项目的速度远远超预期；按照我多年的经验看，一个软件技术型的项目，用户纠结半年到一年以上是很正常的。可能也跟国内企业包容本土化软件公司，追捧新潮技术直接相关；我观察到的一些项目，在 2 ～ 4 个月内落单的屡见不鲜。有些试点的 DevOps 咨询项目也落地很快。&lt;/p>
&lt;p>这些项目都殊途同归地指向了 DevOps 这个关键词，这让我不得不从去年开始就关注和学习这个最佳实践。当然，我对 DevOps 的前途非常看好，因此当我听说业内出现了相关认证考试之后，我毫不犹豫地报名参加了。经过 2 个多月的缜密的准备，我终于幸运地一次通过了这个考试。考试获得了两个证书。&lt;/p>
&lt;p>&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2016/11/EXIN-DevOps-Master-Cert-Martin-Liu.jpg"
loading="lazy"
alt="exin-devops-master-cert-martin-liu"
> DevOps Master&lt;/p>
&lt;p>&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2016/11/certificate-devops-freelance-trainer-Liu-Zheng.jpg"
loading="lazy"
alt="DevOps Master 认证自由讲师"
> DevOps Master 认证自由讲师&lt;/p>
&lt;p>我参加的是讲师认证培训 TTT，很高兴能成为 Exin 在国内的首批 5 个认证人员之一。在准备这个考试的过程中我学习了一些书籍，现在还在深度学习的书有两本。&lt;/p>
&lt;p>&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2016/11/14678659256890.jpg"
loading="lazy"
alt="14678659256890"
>&lt;/p>
&lt;p>我完成了这本黑皮书的读书笔记，很遗憾的是，我发现它的最新版，把封面改成了白底的了，我不能在叫它黑皮书／黑宝书了。这本书我起码看了两遍；目前正在调试它的书中的代码，代码中的营养还是很高的，计划尽快把所有代码调试通过；从而完成我许下多次的线上分享本书的诺言。&lt;/p>
&lt;p>&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2016/11/14749866044733.jpg"
loading="lazy"
alt="14749866044733"
>&lt;/p>
&lt;p>这本书被我称为 CD 红皮书／红宝书。本书早在 10 年就出版了，也就是说比 Docker 早好多年。他给我最大的印象就是，作者每一页上似乎都在介绍这做事情的原则和规矩是什么？我一点也不夸张，他对 CD 的介绍，就是通过讲解一系列在项目上的经验总结。对作者这种级别的经验，和写书的房子只能用一个词总结“服”。这本书太干，我至今还没有消化完。他让我看到了解决发布和变更风险的终极解决方案，没有一次性解决问题的部署／配置／发布工具，有的是历练和打磨了千万次的持续部署流水线；隐约地觉得没用入手的企业都会慢慢跟上的。&lt;/p>
&lt;p>以上是我对 DevOps 的阶段性总结，跨度有半年之久。这半年中我逐渐看清了我的主要兴趣点，抛除所有其他主题，目前剩下的就是：云计算和 DevOps。一方面觉得年纪不饶人，不能可能在和年轻人拼精力、体力和创意；我的背景和经验都让我感觉，在这两个话题上，我还是有很多年的经验和技术积累和总结的。云计算是（公有云＋私有云）未来企业 IT 基础架构的走向；DevOps 是目前看比较正确的运作实践。一个便技术，一个便管理，正好完整覆盖了我的经验；在其对应的开源技术这个分支里，我想它们都还有这很多的为探索和研究的项目。&lt;/p></description></item><item><title>红帽媒体日</title><link>https://martinliu.cn/2015/07/14/e7baa2e5b8bde5aa92e4bd93e697a5/</link><pubDate>Tue, 14 Jul 2015 14:20:24 +0000</pubDate><guid>https://martinliu.cn/2015/07/14/e7baa2e5b8bde5aa92e4bd93e697a5/</guid><description>&lt;p>本次演讲用了大约 25 分钟，超时了大约 5 分钟多，但是其中有些观点还是没有叙述的很倒位。只能算是我的一种理解和解读，希望对道场的媒体朋友们对认识红帽公司有帮助。&lt;/p>
&lt;p>演讲源版 slide 和录音在这个网页上： &lt;a class="link" href="http://investors.redhat.com/events.cfm" target="_blank" rel="noopener"
>http://investors.redhat.com/events.cfm&lt;/a> 的这部分：&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>Jun 24, 2015&lt;/p>
&lt;p>10:30 AM - 1:00 PM ET&lt;/p>
&lt;!-- raw HTML omitted -->
&lt;!-- raw HTML omitted -->
&lt;p>Red Hat Analyst Day&lt;/p>
&lt;p>&lt;a class="link" href="http://edge.media-server.com/m/p/mhayc7rh" target="_blank" rel="noopener"
> Listen to webcast &lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="http://investors.redhat.com/common/download/download.cfm?companyid=RHAT&amp;amp;fileid=838366&amp;amp;filekey=633328A1-EAD6-471D-9934-C43F4CDC5666&amp;amp;filename=RH_Summit_Analyst_Day_FINAL.pdf" target="_blank" rel="noopener"
>View Presentation&lt;/a>&lt;/p>
&lt;p>12.2 MB&lt;/p>
&lt;p>&lt;a class="link" href="http://investors.redhat.com/events.cfm#" target="_blank" rel="noopener"
>Add to Briefcase&lt;/a>&lt;/p>
&lt;p>View Additional Information&lt;/p>
&lt;!-- raw HTML omitted --></description></item></channel></rss>