<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Foreman on Martin Liu's Blog</title><link>https://martinliu.cn/tags/foreman/</link><description>Recent content in Foreman on Martin Liu's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sun, 09 Oct 2022 21:44:15 +0800</lastBuildDate><atom:link href="https://martinliu.cn/tags/foreman/index.xml" rel="self" type="application/rss+xml"/><item><title>在 RHEL 7 上安装 Foreman 1.8</title><link>https://martinliu.cn/2015/06/16/e59ca8-rhel-7-e4b88ae5ae89e8a385-foreman-1-8/</link><pubDate>Tue, 16 Jun 2015 16:25:34 +0000</pubDate><guid>https://martinliu.cn/2015/06/16/e59ca8-rhel-7-e4b88ae5ae89e8a385-foreman-1-8/</guid><description>&lt;p>首先安装 RHEL7 使用光盘安装最小化系统，安装完成之后，关闭防火墙和 SELinux（为了测试方便），配置主机名为 FQDN 格式，如 fm1.8.xenlab.com； 加本机的主机名解析到/etc/hosts 文集中。之后注册到 RHN。&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>[root@fm18 ~]# subscription-manager register
[root@fm18 ~]# subscription-manager attach  &amp;ndash;auto
[root@fm18 ~]# subscription-manager repos &amp;ndash;disable=&amp;quot;*&amp;quot;
[root@fm18 ~]# subscription-manager repos &amp;ndash;enable=rhel-7-server-optional-rpms
[root@fm18 ~]# subscription-manager repos &amp;ndash;enable=rhel-server-rhscl-7-rpms
[root@fm18 ~]# subscription-manager repos &amp;ndash;enable=rhel-7-server-rpms
[root@fm18 ~]# rpm -ivh &lt;a class="link" href="http://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm" target="_blank" rel="noopener"
>http://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm&lt;/a>
[root@fm18 ~]# yum -y install &lt;a class="link" href="http://yum.theforeman.org/releases/1.8/el7/x86_64/foreman-release.rpm" target="_blank" rel="noopener"
>http://yum.theforeman.org/releases/1.8/el7/x86_64/foreman-release.rpm&lt;/a>
[root@fm18 ~]# yum -y install &lt;a class="link" href="http://ftp.sjtu.edu.cn/fedora/epel/epel-release-latest-7.noarch.rpm" target="_blank" rel="noopener"
>http://ftp.sjtu.edu.cn/fedora/epel/epel-release-latest-7.noarch.rpm&lt;/a>
[root@fm18 ~]# yum clean all
[root@fm18 ~]# yum makecache
[root@fm18 ~]# yum update -y
[root@fm18 ~]# reboot
[root@fm18 ~]# yum install foreman-installer&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;p>安装 foreman-installer 可能会出现的错误是 ruby 包依赖的问题，导致这个问题的原因可能有：网速太满导致的 yum meta-data 失效，国外的 epel 源下载失败等。解决方法是：使用国内较快的 epel 源，在安装 foreman-installer 前，清除 yum 缓存，重新建立 yum 原数据缓存。&lt;/p>
&lt;p>我的测试机的 yum 源配置如下：&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>[root@fm18 yum.repos.d]# yum repolist
Loaded plugins: fastestmirror, product-id, subscription-manager
Loading mirror speeds from cached hostfile&lt;/p>
&lt;ul>
&lt;li>epel: mirrors.neusoft.edu.cn
repo id repo name status
epel/x86_64 Extra Packages for Enterprise Linux 7 - x86_64 8,076
foreman/x86_64 Foreman 1.8 379
foreman-plugins/x86_64 Foreman plugins 1.8 199
puppetlabs-deps/x86_64 Puppet Labs Dependencies El 7 - x86_64 17
puppetlabs-products/x86_64 Puppet Labs Products El 7 - x86_64 175
rhel-7-server-optional-rpms/7Server/x86_64 Red Hat Enterprise Linux 7 Server - Optional (RPMs) 5,832
rhel-7-server-rpms/7Server/x86_64 Red Hat Enterprise Linux 7 Server (RPMs) 7,036
rhel-server-rhscl-7-rpms/7Server/x86_64 Red Hat Software Collections RPMs for Red Hat Enterprise Linux 7 Server 3,596
repolist: 25,310
[root@fm18 yum.repos.d]# cat /etc/yum.repos.d/epel.repo
[epel]
name=Extra Packages for Enterprise Linux 7 - $basearch
baseurl=http://download.fedoraproject.org/pub/epel/7/$basearch
#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-7&amp;amp;arch=$basearch
failovermethod=priority
enabled=1
gpgcheck=1
gpgkey=https://fedoraproject.org/static/352C64E5.txt&lt;/li>
&lt;/ul>
&lt;p>mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-7&amp;amp;arch=$basearch
[epel-debuginfo]
name=Extra Packages for Enterprise Linux 7 - $basearch - Debug
baseurl=http://ftp.sjtu.edu.cn/fedora/epel/7/$basearch/debug
#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-7&amp;amp;arch=$basearch
failovermethod=priority
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
gpgcheck=1&lt;/p>
&lt;p>[epel-source]
name=Extra Packages for Enterprise Linux 7 - $basearch - Source
baseurl=http://ftp.sjtu.edu.cn/fedora/epel/7/SRPMS
#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-source-7&amp;amp;arch=$basearch
failovermethod=priority
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
gpgcheck=1
[root@fm18 yum.repos.d]#&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;p>以上应该是安装 foreman-installer 宝过的攻略了。接下来该安装 foreman 的各个组建和插件了。使用 foreman-installer -i 发现是个不错的方法。还可以顺便了解一下当前 foreman 版本的各个主要功能项，如下所示：&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>[root@fm18 yum.repos.d]# foreman-installer -i
Welcome to the Foreman installer!&lt;/p>
&lt;hr>
&lt;p>This wizard will gather all required information. You can change any parameter
to your needs.&lt;/p>
&lt;p>Ready to start? (y/n) y&lt;/p>
&lt;p>Main Config Menu&lt;/p>
&lt;ol>
&lt;li>[✓] Configure foreman&lt;/li>
&lt;li>[✓] Configure foreman_cli&lt;/li>
&lt;li>[✗] Configure foreman_compute_ec2&lt;/li>
&lt;li>[✗] Configure foreman_compute_gce&lt;/li>
&lt;li>[✓] Configure foreman_compute_libvirt&lt;/li>
&lt;li>[✗] Configure foreman_compute_openstack&lt;/li>
&lt;li>[✓] Configure foreman_compute_ovirt&lt;/li>
&lt;li>[✗] Configure foreman_compute_rackspace&lt;/li>
&lt;li>[✗] Configure foreman_compute_vmware&lt;/li>
&lt;li>[✓] Configure foreman_plugin_bootdisk&lt;/li>
&lt;li>[✗] Configure foreman_plugin_chef&lt;/li>
&lt;li>[✓] Configure foreman_plugin_default_hostgroup&lt;/li>
&lt;li>[✗] Configure foreman_plugin_digitalocean&lt;/li>
&lt;li>[✓] Configure foreman_plugin_discovery&lt;/li>
&lt;li>[✗] Configure foreman_plugin_docker&lt;/li>
&lt;li>[✗] Configure foreman_plugin_hooks&lt;/li>
&lt;li>[✗] Configure foreman_plugin_openscap&lt;/li>
&lt;li>[✗] Configure foreman_plugin_ovirt_provision&lt;/li>
&lt;li>[✗] Configure foreman_plugin_puppetdb&lt;/li>
&lt;li>[✗] Configure foreman_plugin_salt&lt;/li>
&lt;li>[✓] Configure foreman_plugin_setup&lt;/li>
&lt;li>[✓] Configure foreman_plugin_tasks&lt;/li>
&lt;li>[✗] Configure foreman_plugin_templates&lt;/li>
&lt;li>[✓] Configure foreman_proxy&lt;/li>
&lt;li>[✗] Configure foreman_proxy_plugin_abrt&lt;/li>
&lt;li>[✗] Configure foreman_proxy_plugin_chef&lt;/li>
&lt;li>[✗] Configure foreman_proxy_plugin_openscap&lt;/li>
&lt;li>[✗] Configure foreman_proxy_plugin_pulp&lt;/li>
&lt;li>[✗] Configure foreman_proxy_plugin_salt&lt;/li>
&lt;li>[✓] Configure puppet&lt;/li>
&lt;li>Display current config&lt;/li>
&lt;li>Save and run&lt;/li>
&lt;li>Cancel run without Saving
Choose an option from the menu&amp;hellip;&lt;/li>
&lt;/ol>
&lt;p>[root@fm18 yum.repos.d]# puppet agent &amp;ndash;test
Info: Retrieving pluginfacts
Info: Retrieving plugin
Info: Caching catalog for fm18.xenlab.com
Info: Applying configuration version &amp;lsquo;1434466089&amp;rsquo;
Notice: Finished catalog run in 0.21 seconds
[root@fm18 yum.repos.d]#&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;p>输入数字即可进入每个选项打开和关闭这个功能和服务，这个是对 foreman 的功能配置管理，不光是首次安装可以使用，以后的服务器功能变更也可以这么作，这个对我这样不感冒 answerfile 的人来说甚好。如果是首次安装，可以什么都不选择，来一个说装就装的默认安装也不错。安装完全成功之后，就会显示登陆网址和 管理与密码等信息。用初始的 admin 密码登陆后，修改密码，你的全新的 foreman 就安装成功了。注意在，运行 foreman-installer 过程中是需要联网的，安装过程会按照需求，下载所需要的组建包，例如数据库和 web 服务器等等其它必须的包。登陆后界面如下：&lt;/p>
&lt;p>[gallery size=&amp;ldquo;medium&amp;rdquo; link=&amp;ldquo;file&amp;rdquo; ids=&amp;ldquo;53781,53782,53783&amp;rdquo;]&lt;/p>
&lt;p>接下来需要作配置自动化的测试了，我做了一个录像，通过一个简单的示例来说明，如何在 foreman 中测试 pupput module。过程中我使用一个最简单的 /etc/motd 文件的配置的类。演示的内容涉及：&lt;/p>
&lt;p>[su_list icon=&amp;ldquo;icon: check-square&amp;rdquo;]&lt;/p>
&lt;ul>
&lt;li>
&lt;p>安装 puppet module 到生产环境中&lt;/p>
&lt;/li>
&lt;li>
&lt;p>导入并且定制 puppet 类的功能&lt;/p>
&lt;/li>
&lt;li>
&lt;p>测试和验证 puppet 类是否工作正常&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>[/su_list]&lt;/p>
&lt;p>视频下载：[su_button url=&amp;ldquo;http://pan.baidu.com/s/1ntpBXfN&amp;rdquo; target=&amp;ldquo;blank&amp;rdquo; style=&amp;ldquo;stroked&amp;rdquo; background=&amp;quot;#cccccc&amp;quot; size=&amp;ldquo;6&amp;rdquo; icon=&amp;ldquo;icon: cloud-download&amp;rdquo;]下载在这里[/su_button]&lt;/p>
&lt;p>本文参考文档：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="http://theforeman.org/manuals/1.8/index.htm" target="_blank" rel="noopener"
>http://theforeman.org/manuals/1.8/index.htm&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="http://itgeeker.net/centos-7-epel-china-mirror-repository/" target="_blank" rel="noopener"
>http://itgeeker.net/centos-7-epel-china-mirror-repository/&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>在CentOS 7上安装部署Katello2.2</title><link>https://martinliu.cn/2015/06/07/e59ca8centos-7e4b88ae5ae89e8a385e983a8e7bdb2katello2-2/</link><pubDate>Sun, 07 Jun 2015 16:35:05 +0000</pubDate><guid>https://martinliu.cn/2015/06/07/e59ca8centos-7e4b88ae5ae89e8a385e983a8e7bdb2katello2-2/</guid><description>&lt;p>Katello 的系统架构如下图：&lt;/p>
&lt;p>&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2015/06/katello-arch-diagram.png"
loading="lazy"
alt="katello-arch-diagram"
>&lt;/p>
&lt;p>Katell 系统是一个复合型开源项目，是 Pulp, Candlepin 和 Foreman 的组合。Foreman 默认使用 Puppet 作配置管理。&lt;/p>
&lt;p>它的安装文档见官方手册：&lt;a class="link" href="http://www.katello.org/docs/2.2/installation/index.html" target="_blank" rel="noopener"
>http://www.katello.org/docs/2.2/installation/index.html&lt;/a>&lt;/p>
&lt;p>为了简化安装，请下在本站提供的 CentOS7 完美安装模板。使用它来创建一个虚拟机，6GB 内存，2VCPU；网络上为了方便，请在 virt-manger 中新建如下所示的网络。&lt;/p>
&lt;p>&lt;img src="http://7bv9gn.com1.z0.glb.clouddn.com/wp-content/uploads/2015/06/QEMU-KVM-Connection-Details_006.png"
loading="lazy"
alt="QEMU-KVM Connection Details_006"
>&lt;/p>
&lt;p>虚拟机启动之后，确保 host 能正常联网。启动刚才创建的虚拟机，配置好 IP，ping 外网网站，确保它能正常联网即可。其它安装命令如下：&lt;/p>
&lt;p>[bash]&lt;/p>
&lt;p>yum -y localinstall &lt;a class="link" href="http://fedorapeople.org/groups/katello/releases/yum/2.2/katello/RHEL/7Server/x86_64/katello-repos-latest.rpm" target="_blank" rel="noopener"
>http://fedorapeople.org/groups/katello/releases/yum/2.2/katello/RHEL/7Server/x86_64/katello-repos-latest.rpm&lt;/a>
yum -y localinstall &lt;a class="link" href="http://yum.theforeman.org/releases/1.8/el7/x86_64/foreman-release.rpm" target="_blank" rel="noopener"
>http://yum.theforeman.org/releases/1.8/el7/x86_64/foreman-release.rpm&lt;/a>
yum -y localinstall &lt;a class="link" href="http://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm" target="_blank" rel="noopener"
>http://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm&lt;/a>
yum -y localinstall &lt;a class="link" href="http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm" target="_blank" rel="noopener"
>http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm&lt;/a>
yum -y install foreman-release-scl&lt;/p>
&lt;p>yum -y install katello&lt;/p>
&lt;p>katello-installer -v &lt;br>
&amp;ndash;foreman-admin-username admin &lt;br>
&amp;ndash;foreman-admin-password smartvm &lt;br>
&amp;ndash;capsule-dns true &lt;br>
&amp;ndash;capsule-dns-interface eth0 &lt;br>
&amp;ndash;capsule-dns-zone xenlab.com &lt;br>
&amp;ndash;capsule-dns-forwarders 192.168.10.1 &lt;br>
&amp;ndash;capsule-dns-reverse 10.168.192.in-addr.arpa &lt;br>
&amp;ndash;capsule-dhcp true &lt;br>
&amp;ndash;capsule-dhcp-interface eth0 &lt;br>
&amp;ndash;capsule-dhcp-range &amp;ldquo;192.168.10.100 192.168.10.240&amp;rdquo; &lt;br>
&amp;ndash;capsule-dhcp-gateway 192.168.10.1 &lt;br>
&amp;ndash;capsule-dhcp-nameservers 192.168.10.10 &lt;br>
&amp;ndash;capsule-tftp true &lt;br>
&amp;ndash;capsule-tftp-servername $(hostname) &lt;br>
&amp;ndash;capsule-puppet true &lt;br>
&amp;ndash;capsule-puppetca true&lt;/p>
&lt;p>[/bash]&lt;/p>
&lt;p>以上的安装命令如果成功，katello 服务器将具有一下功能：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Foreman 服务器：用于自动化网络安装 linux 系统&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Puppet Master 服务器&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Repos 管理服务器&lt;/p>
&lt;/li>
&lt;li>
&lt;p>DNS，DHCP，PXE 服务器&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>安装成功之后，使用默认的用户名和密码就可以登陆了。&lt;/p></description></item></channel></rss>